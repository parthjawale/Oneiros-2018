"use strict";define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.ContentCache.Utils"),c=function(){function a(){babelHelpers.classCallCheck(this,a);var b=this;b.map={},b._length=0}return babelHelpers.createClass(a,[{key:"clear",value:function(){var a=this;delete a.map,a.map={},a._length=0}},{key:"add",value:function(a,b){var c=this;c.map[a]=b,c._length+=1}},{key:"isPresent",value:function(a){var b=this,c=b.map;return!!c.hasOwnProperty(a)}},{key:"get",value:function(a){var b=this,c=b.map;return c[a]}},{key:"update",value:function(a,b){var c=this;c.map[a]=b}},{key:"remove",value:function(a){var b=this;delete b.map[a],b._length-=1}},{key:"getLength",value:function(){return this._length}}]),a}();return b.SimpleMap=c,c}),define([],function(){var a=zmail.Core.Namespaces,b=a.get("zmail.Components.ContentCache.Utils"),c=function(a){var b="";return b+=a.key+"---> "},d=function(a){var b="";b+="Freq set: "+a.getCounter()+" ";for(var d=a._head;d;)b+=c(d),d=d.next;window.console.log(b)},e=function(a){var b=a.getCacheLib(),c=b.head;for(window.console.log("#####START LIST#####");c;)d(c),window.console.log("-------"),c=c.next;window.console.log("#####END LIST#####")};return b.PaintList=e,e}),define([],function(a){var b=zmail.Core.Namespaces,c=b.create("zmail.Components.ContentCache"),d=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,a);var c=this;c.prev=b.prev||null,c.next=b.next||null,c.key=b.key}return babelHelpers.createClass(a,[{key:"getNext",value:function(){return this.next}},{key:"getPrev",value:function(){return this.prev}},{key:"getKey",value:function(){return this.key}}]),a}();return c.NodeEntity=d,d}),define([],function(a){var b=zmail.Core.Namespaces,c=b.create("zmail.Components.ContentCache"),d=c.NodeEntity,e=function(){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,b);var c=this;c._counter=a.counter||0,c.next=a.next||null,c.prev=a.prev||null,this._items={},this._head=null,this._tail=null,c._length=0}return babelHelpers.createClass(b,[{key:"getCounter",value:function(){return this._counter}},{key:"add",value:function(a){var b=this;if(!this._items[a]){var c=new d({key:a,next:b._head});b._head?b._head.prev=c:b._tail=c,b._head=c,b._items[a]=c,b._length+=1}}},{key:"remove",value:function(b){var c=this,d=c._items[b];if(d){var e=d.prev,f=d.next;e?e.next=f:this._head=f,f?f.prev=e:c._tail=e,a("zmUtil").debugLog("Node to be removed: "+b),delete this._items[b],this._length-=1}}},{key:"getHead",value:function(){return this._head}},{key:"getTail",value:function(){return this._tail}},{key:"isEmpty",value:function(){return 0===this._length}}]),b}();return c.FrameSet=e,e}),define([],function(a){var b=zmail.Core.Namespaces,c=b.create("zmail.Components.ContentCache"),d=c.Utils.SimpleMap,e=c.NodeEntity,f=100,g=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,a);var c=this;c.maxSize=b.maxSize||f,c.head=c.tail=null,c.map=new d}return babelHelpers.createClass(a,[{key:"setThresholdLimit",value:function(a){var b=this;b.threshold=a}},{key:"clear",value:function(){var a=this;a.map.clear(),a.head=a.tail=null}},{key:"getKeys",value:function(){}},{key:"hasKey",value:function(a){var b=this;return b.map.isPresent(a)}},{key:"get",value:function(a){var b=this,c=b.map;if(!c.isPresent(a))return!1;var d=c.get(a),f=d.value,g=new e({key:a});return b.remove(a),b._setHead(g),b.map.add(a,{value:f,set:g}),f}},{key:"_setHead",value:function(a){var b=this;a.next=b.head,a.prev=null,null!==b.head&&(b.head.prev=a),b.head=a,null===b.tail&&(b.tail=a)}},{key:"add",value:function(a,b){var c=this,d=c.map;if("undefined"==typeof a&&"undefined"==typeof b)return!1;d.isPresent(a)||c.map.getLength()!==c.maxSize||c.evict(),d.isPresent(a)&&c.remove(a);var f=new e({key:a});c._setHead(f),c.map.add(a,{value:b,set:f})}},{key:"remove",value:function(a){var b=this,c=b.map;if(!c.isPresent(a))return!1;var d=c.get(a),e=d.set;null!==e.prev?e.prev.next=e.next:b.head=e.next,null!==e.next?e.next.prev=e.prev:b.tail=e.prev,b.map.remove(a)}},{key:"evict",value:function(){var a=this,b=a.tail;a.remove(b.key)}},{key:"toString",value:function(){for(var a=this,b=a.head;null!==b;)window.console.log(b.key+" ---> "),b=b.next}}]),a}();return c.LRUCacheSystem=g,g}),define([],function(a){var b=zmail.Core.Namespaces,c=b.create("zmail.Components.ContentCache"),d=c.Utils.SimpleMap,e=c.FrameSet,f=100,g=function(){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,b);var c=this;c.maxSize=a.maxSize||f,c.head=c.tail=new e,c.map=new d}return babelHelpers.createClass(b,[{key:"setThresholdLimit",value:function(a){var b=this;b.threshold=a}},{key:"clear",value:function(){var a=this;a.map.clear(),a.head=a.tail=new e}},{key:"getKeys",value:function(){}},{key:"hasKey",value:function(a){var b=this;return b.map.isPresent(a)}},{key:"get",value:function(a){var b=this,c=b.map.get(a);if(!c)return!1;var d=c.set,f=d.next;return f&&f.getCounter()===d.getCounter()+1||(f=new e({counter:d.getCounter()+1,prev:d,next:d.next}),d.next&&(d.next.prev=f),d.next=f,d===b.tail&&(b.tail=f)),d.remove(a),f.add(a),c.set=f,d.isEmpty()&&b._removeFrameSet(d),c.value}},{key:"add",value:function(a,b){var c,d=this,f=d.map;if("undefined"==typeof a||"undefined"==typeof b)return!1;if(f.isPresent(a))return c=d.map.get(a),c.value=b,void d.map.update(a,c);d.map.getLength()===d.maxSize&&d.evict();var g=d.head,h=d.head.getCounter();h>0&&(d.head=new e({next:g}),g.prev=this.head),d.head.add(a),d.map.add(a,{value:b,set:d.head})}},{key:"_removeFrameSet",value:function(b){var c=this;a("zmUtil").debugLog("Freq Frame set to be removed"+b.getCounter());var d=b.next;b===c.head?null===d?c.head=c.tail=new e:(d.prev=null,c.head=d):b===c.tail?(c.tail=b.prev,b.prev.next=null):(b.prev.next=b.next,b.next.prev=b.prev)}},{key:"remove",value:function(a){var b=this,c=b.map;if("undefined"==typeof a&&!c.isPresent(a))return!1;var d=c.get(a);return!!d&&(b.map.remove(a),d.set.remove(a),void(d.set.isEmpty()&&b._removeFrameSet(d.set)))}},{key:"evict",value:function(){}}]),b}();return c.BaseReplacementCacheSystem=g,g}),define([],function(a){var b=zmail.Core.Namespaces,c=b.create("zmail.Components.ContentCache"),d=c.BaseReplacementCacheSystem,e=function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"evict",value:function(){var a=this,b=a.head;if(b){var c=b.getTail();if(c){var d=a.map.get(c.key);d&&(a.map.remove(c.key),d.set.remove(c.key),d.set.isEmpty()&&a._removeFrameSet(d.set))}}}}]),b}(d);return c.LFUCacheSystem=e,e}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.ContentCache"),c=b.BaseReplacementCacheSystem,d=function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"evict",value:function(){var a=this,b=a.tail;if(b){var c=b.getTail();if(c){var d=a.map.get(c.key);d&&(a.map.remove(c.key),d.set.remove(c.key),d.set.isEmpty()&&a._removeFrameSet(d.set))}}}}]),b}(c);return b.MFUCacheSystem=d,d}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Components.ContentCache"),c=function(){function a(){babelHelpers.classCallCheck(this,a)}return babelHelpers.createClass(a,[{key:"getCacheSystem",value:function(a,c){var d;return new(d="LRU"===a?b.LRUCacheSystem:"MFU"===a?b.MFUCacheSystem:b.LFUCacheSystem)(c)}}]),a}();return b.CacheSystemFactory=c,c}),define([],function(a){var b,c=a("$"),d=zmail.Core.Namespaces,e=d.get("zmail.Components.ContentCache"),f="MFU",g=function(){return c.Deferred()},h=function(){function d(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,d);var c=this,e=a.type||f;delete a.type,c.keyParam=a.keyParam,delete a.keyParam,c._requestURI=a.requestURI,delete a.requestURI,c._requestType=a.requestType,delete a.requestType,c._defaultParams=a.defaultParams||{},c._cacheLib=b.getCacheSystem(e,a),c._hooks={},c._hooks.beforeAdd=a.beforeAdd}return babelHelpers.createClass(d,[{key:"_fetch",value:function(b,d){var e=this,f={p:c.extend({},e._defaultParams,b.p),onerror:d.error,fn:d.success,u:e._requestURI,t:e._requestType};f=c.extend({},b,f),a("zmAjq").XHR(f)}},{key:"_getSingleItem",value:function(a,b){var c=this,d=c._cacheLib,e=g(),f=c._hooks,h=function(b){a=b},i=function(c){var g;"function"==typeof f.beforeAdd&&(c=f.beforeAdd(c,a,{updateKey:h})),b.avoidCache?g=c:(d.add(a,c),g=d.get(a)),e.resolve(g)},j=function(a){e.reject(a)},k={success:i,failure:j};return d.hasKey(a)&&!b.forceFetch?e.resolve(d.get(a)):c._fetch(b,k),e.promise()}},{key:"_getMultipleItems",value:function(a,b){var c=this,d=g(),e=c._cacheLib,f=c._hooks,h={},i=[],j=function(a){var c=Object.keys(a);c.forEach(function(c){var d=function(a){c=a};"function"==typeof f.beforeAdd&&(a[c]=f.beforeAdd(a[c],c,{updateKey:d})),b.avoidCache?h[c]=a[c]:(e.add(c,a[c]),h[c]=e.get(c))}),d.resolve(h)},k=function(a){var b={};h.length>0&&(b.type="partial"),b.result=h,d.reject(a,b)},l={success:j,failure:k};return a.forEach(function(a,b,c){e.hasKey(a)?h[a]=e.get(a):i.push(a)}),a=i,a.length?(b.p[c.keyParam]=a.join(","),c._fetch(b,l)):d.resolve(h),d.promise()}},{key:"get",value:function(){var a,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=this,d=b.p,e=c._getSingleItem.bind(c);return a=d[c.keyParam],a=a.split(","),1===a.length?a=a[0]:e=c._getMultipleItems.bind(c),e(a,b)}},{key:"put",value:function(a,b){var c=this,d=c._cacheLib;d.add(a,b)}},{key:"clear",value:function(){var a=this;a._cacheLib.clear()}},{key:"remove",value:function(a){var b=this;b._cacheLib.remove(a)}},{key:"getCacheLib",value:function(){return this._cacheLib}}]),d}(),i=function(){b=new e.CacheSystemFactory};return i(),e.ContentCacheComp=h,h});
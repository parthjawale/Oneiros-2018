"use strict";!function(){var a=zmText.get("taskUtil"),b={};b.leftTreeContextMenu=[{htm:a.left.createProj,id:"zt_create_proj",cEdit:!0,data:{action:"createProj"}},{sep:!0,id:"zmLTMenu_lne1"},{htm:a.left.renameProj,id:"zt_rename_proj",cEdit:!0,data:{action:"editProj"}},{htm:a.center.deleteTask,cEdit:!1,data:{action:"deleteProj"}}],b.splitTask=function(){return zdom("div",{className:"SC_simg zmInlineOption"},a.center.splitTask,zdom("div",{className:"SC_PUbtm"},zdom("span",{id:"splittask"}," ",a.common.yesbutton," "),zdom("span",{id:"donotsplittask","data-val":"Cancel"}," ",a.common.nobutton," ")),zdom("font",{className:"SC_frt",id:"clearTask"}," ",a.common.clearlink," "))},b.emptyTask=function(){var b={height:"50px","padding-top":"25px"};return zdom("center",{id:"notask",style:b},zdom("span",null,a.common.notask+" "),zdom("a",{href:"#",id:"addnewtask"},a.center.addTask))},b.noTaskTemplate=function(b){var c={height:"50px","padding-top:":"25px"},d="today"===b?a.center.noDueTask:a.common.notask;return zdom("center",{id:"notask",style:c},d)},b.cheatSheetLink=function(){return zdom("ul",null,zdom("li",{className:"SCtxt zt_cheat",id:"cheatlink"},zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-cheatSheet"}),zdom("span",null,a.cheatsheet.cheatsheet)))))},b.printLink=function(){return zdom("ul",null,zdom("li",{className:"SCtxt",id:"printlink"},zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-print"}),zdom("span",null,a.common.print)))))},b.viewTaskStreams=function(a){var b="msi-uncheck zmtMAC",c="";"3"===a.status&&(b="msi-check zmtMAC",c="Stask_Complete");var d="";"2"===a.priority?d="SC_red":"4"===a.priority&&(d="SC_blue");var e=zdom("li",{className:c},zdom("i",{className:b}),zdom("strong",null," ",zmTask.Util.unescapeSpecialChar(a.title)),zdom("div",{className:"Stask_list_icon"}),zdom("div",{className:"Stask_list_desc"}," ",a.summary," ")),f=e.querySelector("strong");if("-1"!==a.attendees){var g=zmail.ContactBook.get({zuid:a.attendees,promise:!1}),h=g[0]?g[0].get("fn"):"",i=zdom("span",{className:a.mentionClass,"data-zid":a.attendees},h);f.appendChild(i)}var j=e.querySelector("div.Stask_list_icon");if(a.duedate){var k=zdom("span",null,a.duedate);j.appendChild(k)}if(d.length){var l="msi-priority "+d,m=zdom("i",{className:l});j.appendChild(m)}return e},b.viewTaskStreamsHolder='<div class="Smsg" style="white-space:normal;"><ul class="mtask_list stask_list"></ul><ul class="stask_list"></ul></div>',b.addtaskStreams=function(){return zdom("div",null,zdom("div",{className:"Stask_parent"},zdom("textarea",{className:"SC_w100 SC_nobdr ZT_prvTitle"}),zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-attachment"}))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"SC_dib SC_dyn"},zdom("input",{readOnly:"true",className:"ztDate"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"})))))),zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"})),zdom("div",{className:"sTaskContainer"}),zdom("div",{className:"Stask_sub Stask_sub_add"},zdom("i",{className:"msi-add"}),zdom("div",{className:"zm_mention"},zdom("div",{className:"zm_mentionbg"}),zdom("textarea",{className:"add-sub",placeholder:a.preview.placeholder.subtask}))))},b.addSmartTask=function(){return zdom("div",null,zdom("div",{className:"Stask_parent Stask_update"},zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"SC_dib SC_dyn"},zdom("input",{readOnly:"true",className:"ztDate"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"}))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-watch"})))))),zdom("div",{className:"zmpr SC_disab"},zdom("div",{className:"Stask_reminder"},zdom("label",{id:"labelRemind"},zdom("i",{id:"setRemind",className:"msi-uncheck"}),a.preview.display.setReminder),zdom("div",{className:"Stask_remInput ZM_date"},zdom("input",{type:"text",className:"ztRDate",placeholder:a.preview.placeholder.selectDate}),zdom("i",{className:"text msi-calendar"})),zdom("div",{className:"Stask_remInput ZM_time"},zdom("input",{type:"text",className:"ztRTime",placeholder:a.preview.placeholder.selectDate}),zdom("i",{className:"msi-clock"}))),zdom("div",{className:"Stask_reminder"},zdom("div",{className:"Stask_remInput"},zdom("i",{className:"msi-uncheck",id:"cpopup"}),zdom("span",{id:"cpopupspan"},a.common.notify)),zdom("div",{className:"Stask_remInput"},zdom("i",{className:"msi-uncheck",id:"cemail"}),zdom("span",{id:"cemailspan"},a.common.mail)))),zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"})),zdom("div",{className:"Stask_subCont Stask_update"},zdom("div",{className:"sTaskContainer"}),zdom("div",{className:"Stask_sub Stask_sub_add"},zdom("i",{className:"msi-add"}),zdom("div",{className:"zm_mention"},zdom("div",{className:"zm_mentionbg"}),zdom("textarea",{className:"add-sub",placeholder:a.preview.placeholder.subtask})))))},b.addtaskNew=function(b,c,d,e){var f=zdom("div",null),g="Stask_action";if(d||(g+=" SC_dyn"),!c){var h=zdom("div",{className:"SC_lnk"},zdom("span",{id:"viewParent"}));f.appendChild(h)}var i=zdom("div",{className:"Stask_parent"});if(!d){var j=zdom("i",{className:"msi-check zmtMAC"});i.appendChild(j)}i.appendChild(zdom("textarea",{className:"SC_w100 SC_nobdr ZT_prvTitle"})),i.appendChild(zdom("div",{className:"Stask_act"},zdom("div",{className:"SCmb SC_dyn zmTaskAction"},zdom("ul",null,zdom("li",{className:"SC_dyn"},zdom("b",null,zdom("i",{className:"msi-alarm"})))))));var k=zdom("div",{className:g},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null," ",zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"SC_dib SC_dyn"},zdom("i",{className:"msi-calendar"}),zdom("input",{className:"ztDate",readOnly:"true"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null," ",zdom("b",null,zdom("i",{className:"msi-attachment"})," ")),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"})))))),l=k.querySelector("ul"),m=l.children[1],n=l.children[2];if(!d){var o=zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-label"})));$(o).insertAfter(m)}if(c){var p=zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-watch"})));$(p).insertAfter(n)}if(!e){var q=zdom("li",null,zdom("b",null,zdom("i",{className:"msi-close"})));$(q).insertAfter(n)}if(i.appendChild(k),d){var r=zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"});i.appendChild(r)}else{var s=zdom("div",{className:"zmpdtl SC_dyn"},zdom("div",{className:"zmpr"},zdom("div",{className:"zm_lbl"},zdom("div",{className:"zmLblGrp zmViewLblName"}))));i.appendChild(s)}if(f.appendChild(i),c&&d){var t=zdom("div",{className:"sTaskContainer zmDrgbleSubtsk"});f.appendChild(t);var u=zdom("div",{className:"Stask_sub Stask_sub_add"},zdom("i",{className:"msi-add"}),zdom("div",{className:"zm_mention"},zdom("div",{className:"zm_mentionbg"}),zdom("textarea",{className:"add-sub",placeholder:a.preview.placeholder.subtask})));f.appendChild(u)}else if(c){var v=zdom("div",{className:"Stask_sub Stask_sub_add"},zdom("i",{className:"msi-add"}),zdom("textarea",{className:"add-sub",placeholder:a.preview.placeholder.subtask}));f.appendChild(v)}var w=zdom("div",{className:"SC_tdtl"},zdom("div",null,zdom("div",{className:"zmpr SC_disab"},zdom("i",{id:"setRemind",className:"msi-uncheck"}),zdom("span",{className:"sum"},a.center.remindOn," "),zdom("div",{className:"SC_dib"},zdom("div",{id:"dtReminder",className:"SC_dib"},zdom("div",{className:"ZM_date SC_dib"},zdom("input",{className:"ztRDate SC_tiput",type:"textbox"})),zdom("div",{className:"ZM_time SC_dib"},zdom("input",{className:"SC_tiput ztRTime",type:"textbox"}))),zdom("div",{id:"relReminder",className:"SC_dyn SC_dib"},zdom("input",{className:"SC_tiput ztReDate",type:"textbox",value:a.center.samedayReminder})),"  ",zdom("i",{className:"msi-uncheck",id:"cpopup"}),zdom("span",{id:"cpopupspan"}," ",a.common.notify),zdom("i",{id:"cemail",className:"msi-uncheck"}),zdom("span",{id:"cemailspan"}," ",a.common.mail," ")))));f.appendChild(w);var x=zdom("div",{className:"SC_tdtl"},zdom("div",{className:"SC_flt SC_fst",id:"zt_ws"},zdom("input",{placeholder:a.left.workspace,className:"SC_tiput",readOnly:"readonly"})),zdom("div",{className:"SC_flt",id:"ZT_prvProj"})),y=x.querySelector("#ZT_prvProj");if(c){var z={display:"none",position:"absolute",top:"7px",right:"5px"},A={display:"inline-block",readOnly:"readonly"},B=zdom("span",{id:"clearproject",style:z},zdom("i",{className:"msi-close"})),C=zdom("input",{className:"SC_tiput",placeholder:a.center.projName,style:A});y.appendChild(B),y.appendChild(C)}else{var D={display:"inline-block",readOnly:"readonly",disabled:"disabled"},E=zdom("input",{className:"SC_tiput",placeholder:a.center.projName,style:D});y.appendChild(E)}var F=zdom("div",{className:"SC_tdtl"},zdom("div",{className:"SC_tiput ZT_prvDescrip zt_edtDesc",contentEditable:"true"}));if(f.appendChild(x),f.appendChild(F),d){var G={display:"none","padding-top":"10px"};f.appendChild(zdom("div",{className:"SC_tdtl",style:G},zdom("i",{className:"msi-check",id:"sharemail"}),zdom("span",{id:"sharemailspan"},a.common.sharemail,zdom("b",null))))}return f},b.addSubTaskNew=function(b,c,d){var e=zdom("div",{className:"Stask_sub"});d||e.appendChild(zdom("i",{className:"msi-check zmtMAC"})),e.appendChild(zdom("textarea",{rows:"1",className:"SC_w100 SC_nobdr ZT_prvTitle"}));var f=zdom("div",{className:"Stask_act"},zdom("div",{className:"SCmb SC_dyn zmTaskAction"},zdom("ul",null,zdom("li",{className:"SC_dyn"},zdom("b",null,zdom("i",{className:"msi-alarm"}))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-attachment"}))," "))));if(e.appendChild(f),zmail.isInternalOrgUser&&!d){var g=zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-attachment"}))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-label"}))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"}))))));if(c){var h=g.querySelector("ul"),i=zdom("li",null,zdom("b",null,zdom("i",{className:"msi-trash"})));h.appendChild(i)}e.appendChild(g);var j=zdom("div",{className:"zmpdtl SC_dyn"},zdom("div",{className:"zmpr"},zdom("div",{className:"zm_lbl"},zdom("div",{className:"zmLblGrp zmViewLblName"}))));e.appendChild(j);var k=zdom("div",{className:"Stask_action zt_SAss"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("div",{className:"SC_cs SC_np SC_assignee"},zdom("span",{className:"SC_thm",placeholder:a.common.assignPlaceHolder}),zdom("i",{className:"msi-close SC_dyn"}))),zdom("li",null,zdom("b",{className:"SC_dyn"},zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"SC_dib"},zdom("i",{className:"msi-calendar"}),zdom("input",{readOnly:"true",className:"ztDate",placeholder:"Due Date"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("span",{className:"SC_lnk SC_vMore"},a.preview.display.viewmorelink)))));e.appendChild(k)}else if(d){var l=zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"SC_dib SC_dyn"},zdom("i",{className:"msi-calendar"}),zdom("input",{className:"ztDate",readOnly:"readonly"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-attachment"}))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"})))))),m=l.querySelector("ul");c&&m.appendChild(zdom("li",null,zdom("b",null,zdom("i",{className:"msi-trash"})))),e.appendChild(l),e.appendChild(zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"}))}else{var n=zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"SC_dib SC_dyn"},zdom("i",{className:"msi-calendar"}),zdom("input",{readOnly:"true",className:"ztDate"}),zdom("span",{className:"SC_cls"},zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-attachment"}))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-label"}))),zdom("li",null,zdom("b",null,zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-priority"})))))),o=n.querySelector("ul");c&&o.appendChild(zdom("li",null,zdom("b",null,zdom("i",{className:"msi-trash"})))),e.appendChild(n);var p=zdom("div",{className:"zmpdtl SC_dyn"},zdom("div",{className:"zmpr"},zdom("div",{className:"zm_lbl"},zdom("div",{className:"zmLblGrp zmViewLblName"}))));e.appendChild(p);var q=zdom("span",{className:"SC_lnk SC_vMore"},a.preview.display.viewmorelink);e.appendChild(q)}return e},b.addSubTaskStreams=function(a){return void 0===a.title&&(a.title=""),zdom("div",{className:"Stask_sub"},zdom("textarea",{className:"SC_w100 SC_nobdr ZT_prvTitle"},a.title),zdom("div",{className:"Stask_action"},zdom("div",{className:"SCmb zmTaskAction"},zdom("ul",null,zdom("li",null," ",zdom("b",null," ",zdom("i",{className:"msi-attachment"}))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-calendar"})),zdom("div",{id:"ztDateOuter",className:"SC_dib SC_dyn"},zdom("input",{readOnly:"true",className:"ztDate"}),zdom("span",{className:"Sc_cls"}," ",zdom("i",{className:"msi-close"})))),zdom("li",null,zdom("b",null,zdom("div",{className:"Sc_hd"}),zdom("i",{className:"msi-priority"}))),zdom("li",null,zdom("b",null,zdom("i",{className:"msi-trash"})))))),zdom("div",{className:"zmPAtt Snolpd zmCAt SC_dyn"}))},b.getTaskListPrintHeader=function(a,b){var c=zdom("div",{id:"taskPrintDiv",className:"taskPrintDiv"}),d=_zm.getDOM(["H1",{attrs:{"class":"zm_prntTit"},child:[["text",a]]}]);if(c.appendChild(d),b){var e=zdom("div",{className:"zm_prntGrp"},b.filterName,zdom("i",{className:"msi-rarrow"}),b.filterValue);c.appendChild(e)}return c.appendChild(zdom("table",{cellPadding:"0",cellSpacing:"0",className:"zm_prntTask"},zdom("tbody",null))),c},b.getTaskListPrintFooter=function(){var b={display:"none"};return zdom("div",{className:"rgtdiv",id:"navBar",style:b},zdom("div",{className:"SC_Pnav"},zdom("div",{className:"SC_ldr",id:"ldrDiv",style:b},zdom("div",{className:"SC_ldsld"},zdom("div",{className:"SC_llne"}),zdom("div",{className:"SC_lbrk SC_ldt1"}),zdom("div",{className:"SC_lbrk SC_ldt2"}),zdom("div",{className:"SC_lbrk SC_ldt3"}))),zdom("span",{className:"SC_PnavCount"},a.common.loadMore)))},b.cheatSheet=function(b){var c=zmText.applyArgs(a.cheatsheet.createtaskmailid,{userid:b.userid,dname:b.dname}),d=zmText.applyArgs(a.cheatsheet.createtaskdmfyid,{userid:b.userid,d:b.d,m:b.m,fy:b.fy,dname:b.dname}),e=zmText.applyArgs(a.cheatsheet.createtaskdmfyinfo,{d:b.d,m:b.m,fy:b.fy}),f=zmText.applyArgs(a.cheatsheet.createtaskdmid,{userid:b.userid,d:b.d,m:b.m,dname:b.dname}),g=zmText.applyArgs(a.cheatsheet.createtaskdminfo,{d:b.d,m:b.m,fy:b.fy,ny:b.ny}),h=zmText.applyArgs(a.cheatsheet.creategrouptaskmailid,{dname:b.dname}),i=zmText.applyArgs(a.cheatsheet.memberingroupmailid,{dname:b.dname}),j=zmText.applyArgs(a.cheatsheet.grouptaskdmid,{d:b.d,m:b.m,dname:b.dname}),k=zmText.applyArgs(a.cheatsheet.grouptaskdminfo,{d:b.d,m:b.m,fy:b.fy});return zdom("div",null,zdom("h2",{className:"cs_main_header SC_thm"},zdom("strong",null,a.cheatsheet.createtext),zdom("span",null,a.cheatsheet.emailtext)),zdom("div",{className:"zt_cheetsheet_tbl zt_main_tbl"},zdom("div",{className:"zt_tbl_row"},zdom("div",{className:"zt_cs_lft_img"},zdom("img",{src:zmResource.get("image","tasks/cheatsheet.png"),title:a.cheatsheet.cheatsheet,alt:a.cheatsheet.cheatsheet})),zdom("div",null,zdom("div",{className:"zt_cheetsheet_tbl zt_cs_tbl"},zdom("div",{className:"zt_tbl_row"},zdom("div",null,a.cheatsheet.emailto),zdom("div",null,a.cheatsheet.createdetails)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{className:"SC_lnk"},c)),zdom("div",null,a.cheatsheet.createtask)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{className:"SC_lnk"},d)),zdom("div",null,e)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{className:"SC_lnk"},f)),zdom("div",null,g)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{id:"groupmail"},zdom("span",{className:"SC_lnk"},h),zdom("br",null),zdom("span",null,"cc "),zdom("span",{className:"SC_lnk"},i))),zdom("div",null,a.cheatsheet.grouptaskinfo)),zdom("div",{className:"zt_tbl_row"},zdom("div",null,zdom("span",{className:"SC_lnk"},j)),zdom("div",null,k)))))))},b.taskAttImgError='<i class="msi-attimg"></i>',b.addHeaderDOM=["DIV",{attrs:{"class":"SC_phd"},child:[["text",a.center.addTask]]}],b.addtaskHeader={text:b.addHeaderDOM,rIcons:[[{tooltip:"Close",iconClass:"msi-close",data:"msi-close"}]]},b.previewHeaderDOM=function(b){var c=[["text",a.center.previewTask]];b&&(c.push(["DIV",{attrs:{"class":"SC_SLine"}}]),c.push(["I",{attrs:{"class":"msi-mailopen"}}]));var d=["DIV",{attrs:{"class":"SC_phd"},child:c}];return d},b.previewHeaderDOMTemp=function(b){var c=[["LI",{child:[["DIV",{attrs:{"class":"SC_cs SC_assignee"},child:[["IMG",{attrs:{src:zmResource.get("image","SC-Photo.png")}}],["SPAN",{attrs:{placeholder:a.common.assignPlaceHolder}}],["I",{attrs:{"class":"msi-close SC_dyn"}}]]}]]}],["LI",{child:[["DIV",{attrs:{id:"ztDateOuter","class":"SC_dib zt_rem"},child:[["I",{attrs:{"class":"msi-calendar"}}],["INPUT",{attrs:{"class":"ztDate",readonly:!0,placeholder:"Due Date"}}],["SPAN",{attrs:{"class":"SC_cls SC_dyn"},child:[["I",{attrs:{"class":"msi-close"}}]]}]]}]]}],["LI",{child:[["B",{child:[["I",{attrs:{"class":"msi-attachment"}}]]}]]}],["LI",{child:[["B",{child:[["DIV",{attrs:{"class":"SC_hd"}}],["I",{attrs:{"class":"msi-label"}}]]}]]}],["LI",{child:[["B",{child:[["DIV",{attrs:{"class":"SC_hd"}}],["I",{attrs:{"class":"msi-priority"}}]]}]]}]];"task"===b.type&&c.push(["LI",{child:[["B",{child:[["DIV",{attrs:{"class":"SC_hd"}}],["I",{attrs:{"class":"msi-watch"}}]]}]]}]),b.eid&&c.push(["LI",{attrs:{"class":"SC_lbr"},child:[["B",{child:[["DIV",{attrs:{"class":"SC_hd"}}],["SPAN",{child:[["I",{attrs:{"class":"msi-mailopen"}}]]}]]}]]}]);var d=["DIV",{attrs:{"class":"SC_phd"},child:[["DIV",{attrs:{"class":"SCmb zmTaskAction"},child:[["UL",{child:c}]]}]]}];return d},b.previewtaskHeader=function(c){var d={text:b.previewHeaderDOM(c.eid),rIcons:[]};if(c.projectsView||c.error||(d={text:b.previewHeaderDOMTemp(c),rIcons:[]}),zmail.isOrg&&zmUtil.isChatletEnabled()&&!c.error&&!c.projectsView){var e=[];c.chatletData&&(e=["SPAN",{attrs:{"class":"zm_mct zmThmBG"},child:[["text",c.chatletData]]}]),d.rIcons.push([{tooltip:zmText.applyArgs(zmText.get("mailsuite").tooltips.chatlet,{entity:zmText.get("mailsuite").entity[3]}),html:[e,["I",{attrs:{"class":"msi-cliqColor"},child:[["I",{attrs:{"class":"path1"}}],["I",{attrs:{"class":"path2"}}]]}]],data:"chatlet"}])}return c.projectsView||c.error||d.rIcons.push([{tooltip:a.center.moreactions,iconClass:"msi-action",data:"msi-action"}]),c.hidePrevNext||c.error||d.rIcons.push([{iconClass:"msi-prev",data:"msi-prev"},{iconClass:"msi-next",data:"msi-next"}]),c.opentype||d.rIcons.push([{tooltip:a.preview.tooltip.close,iconClass:"msi-close",data:"msi-close"}]),d},b.mailDateExtractedTaskNew=function(){var b={color:"transparent",overflow:"hidden"},c={display:"inline-block"},d={"margin-top":"15px"};return zdom("li",null,zdom("div",{className:"zmcDatePost"},zdom("div",null,zdom("div",{className:"SC_floatLabel zmIconLabel",style:b},zdom("input",{type:"text",placeholder:a.center.tasktitowner,className:"ZT_prvTitle"}),zdom("i",{className:"msi-task SC_thm"})),zdom("div",{className:"SC_floatLabelRow fLCol2"},zdom("div",{className:"SC_floatLabel zmIconLabel"},zdom("input",{className:"hasDD",type:"text",required:"",id:"assgnInp",placeholder:"Assignee"}),zdom("i",{className:"msi-user SC_thm"})),zdom("div",{id:"zt_ws",className:"SC_floatLabel zmIconLabel"},zdom("input",{className:"hasDD",type:"text",required:"",readOnly:"readonly",id:"grpInp",placeholder:a.preview.placeholder.group}),zdom("i",{className:"msi-stiNotes SC_thm"}))),zdom("div",{className:"SC_dyn",id:"optMore"},zdom("div",{className:"SC_floatLabelRow fLCol2"},zdom("div",{className:"SC_floatLabel zmIconLabel"},zdom("input",{className:"hasDD",type:"text",required:"",id:"dtInp",readOnly:"readonly",placeholder:a.preview.tooltip.duedate,style:c}),zdom("i",{className:"msi-calendar SC_thm"})),zdom("div",{id:"ZT_prvProj",className:"SC_floatLabel zmIconLabel"},zdom("input",{className:"hasDD",id:"projInp",type:"text",required:"",readOnly:"readonly",placeholder:"Project Name"}),zdom("i",{className:"msi-stiNotes SC_thm"}))),zdom("div",{className:"SC_floatLabel zmIconLabel"},zdom("textarea",{className:"ZT_prvDescrip",placeholder:a.center.desc}),zdom("i",{className:"msi-rsvp SC_thm"})))),zdom("div",{className:"SC_frt zm_moreOpt",id:"moreOpt",style:d},zdom("span",{className:"SC_dyn"},a.common.lessLabel,zdom("i",{className:"msi-prev"})),zdom("span",null,a.common.moreLabel,zdom("i",{className:"msi-next"}))),zdom("div",{className:"SC_PUbtm"},zdom("span",{id:"addTask"},a.common.save),zdom("span",{id:"cancelTask","data-val":"Cancel"},a.common.cancel))))},b.mailDateExtractedTask=function(){var b={color:"transparent",overflow:"hidden"},c={"margin-top":"15px"};return zdom("li",null,zdom("div",{className:"zmcDatePost"},zdom("div",{className:"SC_floatLabel placeholder noBdr",style:b},zdom("textarea",{placeholder:a.center.tasktitowner,value:"",className:"ZT_prvTitle"}),zdom("label",null,"Task Title")),zdom("div",{className:"SC_floatLabelRow fLCol2"},zdom("div",{className:"SC_floatLabel placeholder noBdr"},zdom("input",{className:"hasDD",type:"text",required:"",id:"dtInp",readOnly:"readonly",placeholder:a.preview.tooltip.duedate}),zdom("label",null,a.preview.tooltip.duedate)),zdom("div",{id:"zt_ws",className:"SC_floatLabel placeholder noBdr"},zdom("input",{className:"hasDD",type:"text",required:"",readOnly:"readonly",id:"grpInp",placeholder:a.preview.placeholder.group}),zdom("label",null,a.preview.placeholder.group," "))),zdom("div",{className:"SC_dyn",id:"optMore"},zdom("div",{className:"SC_floatLabelRow fLCol2"}),zdom("div",{className:"SC_floatLabel placeholder noBdr"},zdom("textarea",{className:"ZT_prvDescrip",placeholder:a.center.desc}),zdom("label",null," ",a.center.addDesc," "))),zdom("div",{className:"SC_frt zm_moreOpt",id:"moreOpt",style:c},zdom("span",{className:"SC_gray SC_dyn"}," ",a.common.lessLabel,zdom("i",{className:"msi-prev SC_gray"})),zdom("span",{className:"SC_gray"},a.common.moreLabel,zdom("i",{className:"msi-next SC_gray"}))),zdom("div",{className:"SC_PUbtm"},zdom("span",{id:"addTask"},a.common.save," "),zdom("span",{id:"cancelTask","data-val":"Cancel"},a.common.cancel," "))))},b.quickTask=function(){var b={display:"none",position:"absolute",top:"13px"};return zdom("div",{id:"quickAdd",className:"zmL SC_mlst zt_quickAdd","data-ty":"lt"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmFlt"},zdom("i",{className:"msi-add"})),zdom("div",{className:"zmDtl"},zdom("div",{className:"zmFrm"},zdom("textarea",{placeholder:a.center.quickTaskPlaceholder}))),zdom("div",{className:"zmFrt"},zdom("span",{className:"js-loading loadRound",style:b}))))},b.moveTask=function(){return zdom("div",{id:"moveTask",className:"zm_postNew"},zdom("div",{className:"SC_floatLabel flFLabel flBox"},zdom("input",{type:"text",className:"tTitle",required:""}),zdom("label",null,a.center.taskTitle)),zdom("div",{className:"SC_floatLabelRow fLCol2"},zdom("div",{className:"SC_floatLabel flFLabel flBox"},zdom("input",{className:"groupId",readOnly:"readonly",placeholder:a.common.labelgroup}),zdom("label",null,a.preview.placeholder.group)),zdom("div",{className:"SC_floatLabel flFLabel flBox"},zdom("input",{className:"catId",readOnly:"readonly",placeholder:a.common.labelproject}),zdom("label",null,a.center.project))),zdom("div",{className:"zm_formLne SC_tp10"},zdom("div",{className:"SC_lne"})),zdom("div",{className:"zm_formFld SC_tp10"},zdom("div",{className:"zm_formCell"},zdom("i",{className:"msi-check"}),zdom("span",{className:"cmtId"},a.common.includecomments))))},b.unAssignedTask=function(){return zdom("ul",{className:"SC_P2r zmcDrpDwnMnu"},zdom("li",{className:"SC_lne"}),zdom("li",{className:"zmSingleLine zmUnassOpt",id:"unassigned"},zdom("div",{className:"zmUnassOptTitle"},a.center.unassigned),zdom("div",{className:"SC_avtr"},zdom("i",{className:"msi-user"}))),zdom("li",{className:"SC_lne"}))},window.zmTask=window.zmTask||{},window.zmTask.template=b}(),window.zmTaskRestore=function(){var a={},b="zm_task",c={},d={};return a.saveState=function(a){if(zmsuite.getAppObj(b)){var e=zmsuite.getAppObj(b).obj.stateData.data;"preview"===a?e.preview=d:"listing"===a&&(e.listing=c),zmState.sendRequestToSaveState()}},a.saveTabState=function(a){a.appId&&a.app&&a.appObj&&(zmState.saveTabState(a.appId,a),this.saveState())},a.restoreTab=function(a){a.data.opentype="tab",a.data.restore=!0,zmTask.Preview(a.data)},a.deleteState=function(a){if(zmsuite.getAppObj(b)){var c=zmsuite.getAppObj(b).obj.stateData.data;"preview"===a&&delete c.preview,zmState.sendRequestToSaveState()}},a.store=function(b,e,f){if(f){var g;"preview"===b?(d[e]=f,g=Object.keys(d).length,2===g&&a.saveState("preview")):"listing"===b&&(c[e]=f,g=Object.keys(c).length,4===g&&a.saveState("listing"))}},a.restoreTaskSession=function(a,c){try{var d=$.Deferred();zmApp.selectedApp!==b&&(zmTask.restore(a.data,d),d.done(function(){c.deferred.resolve()}))}catch(e){c.deferred.resolve()}},a}(),define([],function(a){var b,c,d,e,f,g,h,i=a("zmText"),j=a("zmMention"),k=a("zmsDialog"),l=a("zmlab"),m=a("zmTaskRestore"),n=a("zmAutoFill"),o=a("_zm"),p=zmTask.template,q=0,r=i.get("taskUtil"),s={send:function(a){var b=zmail.conPath+(a.writeReq?"/taskAction.do":"/taskView.do"),c={t:"POST",u:b,p:a.param,fn:a.callBack||s.defaultHandler,ep:a.eparam||"",h:!0,onerror:a.fallback||s.defaultError,onnetfailure:a.fallback||s.defaultError};zmail.showFeature&&(c.setSessionId=!0),zmAjq.XHR(c)},taskGet:function(a,b,c,d){var e={t:"POST",u:zmail.conPath+"/taskGet.do",p:a,fn:c||s.defaultHandler,ep:b||"",h:!0,onerror:d||s.defaultError,onnetfailure:d||s.defaultError};zmAjq.XHR(e)},searchReq:function(a,b,c){var d={mode:"searchStreams",grid:!1,range:5,entityType:3,streamsView:!0,actionType:"viewSelfData",start:0,appView:!0};$.extend(d,a);var e={t:"POST",u:zmail.conPath+"/stream.do",p:d,fn:b,ep:"",h:!0,onerror:c,csr:"s"};zmAjq.XHR(e)},changeCategoryReq:function(a){a.taction="changeCategory",a.actionType="changeEntity";var b=a;s.taskReq(a,b,s.callBack,!0)},taskReq:function(a,b,c,d,e){if(""===b&&(b={}),a.title&&a.title.length<=0)return zmUtil.succErrMsg("e",r.errorMsg.enterTitle),!1;var f={streamsView:!0,entityType:3};$.extend(f,a);var g=b||"",h=!1;d&&(h=d),s.send({param:f,eparam:g,callBack:c,fallback:e,writeReq:h})},streamReq:function(a,b,c,d,e){var f={streamsView:!0,entityType:3};$.extend(f,a);var g=zmail.conPath+"/stream.do",h={t:"POST",u:g,p:f,fn:c||s.defaultHandler,ep:b||"",h:!0,onerror:e||s.defaultError};zmAjq.XHR(h)},labReq:function(a,b,c,d,e){var f=zmail.conPath+"/lA.do",g={t:"POST",u:f,p:a,fn:c||s.defaultHandler,ep:b||"",h:!0,onerror:e||s.defaultError};zmAjq.XHR(g)},postReq:function(a,b,c,d,e){var f={streamsView:!0,entityType:3};$.extend(f,a);var g=zmail.conPath+"/post.do",h={t:"POST",u:g,p:f,fn:c||s.defaultHandler,ep:b||"",h:!0,onerror:e||s.defaultError};zmAjq.XHR(h)},changeStatusReq:function(a,b,c){var d={},e={};d.taction=e.taction="changeStatus",d.actionType="changeEntity",d.entityId=e.entityId=a.entityId,d.groupId=e.groupId=a.groupId,e.categoryId=a.categoryId,d.status=e.status=a.status,e.pTaskId=a.pTaskId;var f=s.callBack;b&&(f=function(a,c){s.callBack(a,c),b(a,c)}),s.taskReq(d,e,f,!0,c)},setRecurringReq:function(a,b,c){var d={},e={},f=a.recurring;d.taction=e.taction="setRepeat",d.actionType="changeEntity",d.entityId=e.entityId=a.entityId,d.groupId=e.groupId=a.groupId;for(var g in f)d[g]=e[g]=f[g];var h=s.callBack;"function"==typeof b&&(h=function(a,c){s.callBack(a,c),b(a,c)}),s.taskReq(d,e,h,!0,c)},setReminderReq:function(a){var b={},c={};b.taction=c.taction="setReminder",b.actionType="changeEntity",b.entityId=c.entityId=a.entityId,b.groupId=c.groupId=a.groupId,b.reminderDate=c.reminderDate=a.reminderDate,b.reminderDueDate=c.reminderDueDate=a.reminderDueDate,b.isEmailReminder=c.isEmailReminder=a.isEmailReminder,b.isPopupReminder=c.isPopupReminder=a.isPopupReminder,c.pTaskId=a.pTaskId,s.taskReq(b,c,s.callBack,!0)},changeSummaryReq:function(a,b){var c={},d={};c.taction=d.taction="changeSummary",c.actionType="changeEntity",c.entityId=d.entityId=a.entityId,c.groupId=d.groupId=a.groupId,c.summary=d.summary=a.summary,c.mentions=d.mentions=a.mentions.join(","),c.offsetstarts=d.offsetstarts=a.offsetstarts,c.offsetends=d.offsetends=a.offsetends,c.offsettexts=d.offsettexts=a.mentions,d.pTaskId=a.pTaskId;var e=s.callBack;b&&(e=function(a,c){s.callBack(a,c),b(a,c)}),s.taskReq(c,d,e,!0)},removeAttachmentReq:function(a,b){var c={},d={};c.taction=d.taction="removeAttachment",c.actionType="changeEntity",c.entityId=d.entityId=a.entityId,c.groupId=d.groupId=a.groupId,c.attachId=d.attachId=a.attachId,d.pTaskId=a.pTaskId;var e=s.callBack;b&&(e=function(a,c){s.callBack(a,c),b(a,c)}),s.taskReq(c,d,e,!0)},addDeleteLabelReq:function(a,b){var c={},d={};c.mode=d.mode="tag",c.actionType=d.actionType=a.checked?"addLabel":"deleteLabel",c.entityId=d.entityId=a.entityId,c.groupId=d.groupId=a.groupId,c.labelId=d.labelId=a.labelId,c.unread=!1,c.cdate=a.cdate,d.pTaskId=a.pTaskId,s.postReq(c,d,b,!0)},changeTitleReq:function(a){var b={},c={};b.taction=c.taction="changeTitle",b.actionType="changeEntity",b.entityId=c.entityId=a.entityId,b.groupId=c.groupId=a.groupId,b.title=c.title=a.title.trim(),c.pTaskId=a.pTaskId,s.taskReq(b,c,s.callBack,!0)},changeAssigneeReq:function(a,b){var c={},d={};c.taction=d.taction="changeAssignee",c.actionType="changeEntity",c.entityId=d.entityId=a.entityId,c.groupId=d.groupId=a.groupId,c.assignee=d.assignee=a.assignee,d.pTaskId=a.pTaskId,s.taskReq(c,d,b,!0)},changePriorityReq:function(a){var b={},c={};b.taction=c.taction="changePriority",b.actionType="changeEntity",b.entityId=c.entityId=a.entityId,b.groupId=c.groupId=a.groupId,b.priority=c.priority=a.priority,c.pTaskId=a.pTaskId,s.taskReq(b,c,s.callBack,!0)},deleteTaskReq:function(a,b){var c={},d={};c.taction=d.taction="deleteTask",c.actionType="delEntity",c.entityId=d.entityId=a.entityId,c.groupId=d.groupId=a.groupId,c.forceDelete=!0,a.pTaskId&&(d.pTaskId=a.pTaskId);var e=s.callBack;b&&(e=function(a,c){s.callBack(a,c),b(c)}),s.taskReq(c,d,e,!0)},changeDuedateReq:function(a){var b={},c={};b.taction=c.taction="setDueDate",b.actionType="changeEntity",b.entityId=c.entityId=a.entityId,b.groupId=c.groupId=a.groupId,b.dueDate=c.dueDate=a.dueDate,c.pTaskId=a.pTaskId,s.taskReq(b,c,s.callBack,!0)},createEditLabelReq:function(a,b,c){var d={};$.extend(d,a);var e=b||"",f=s.callBack;c&&(f=function(a,b){s.callBack(a,b),c(a,b)}),s.labReq(a,e,f)},addEditProjReq:function(a,b,c){var d={streamsView:!0,entityType:3};$.extend(d,a);var e=b||"",f=s.callBack;c&&(f=function(a,b){s.callBack(a,b),c(a,b)}),s.send({param:d,eparam:e,callBack:f,writeReq:!0})},getAllProjects:function(a,b,c,d){var e={actionType:"appView",streamsView:!0,entityType:3,groupId:zmail.zuid,
taction:"getAllProjects"};$.extend(e,a);var f=b||"";s.send({param:e,eparam:f,callBack:c,fallback:d,writeReq:!1})},sendAddAttachmentRequest:function(a,b){var c={taction:"addAttachment",entityType:"3",actionType:"addEntity",streamsView:!0};$.extend(c,a),s.send({param:c,eparam:a,callBack:b,writeReq:!0})},sendMoveTaskRequest:function(a,b,c,d){s.send({param:a,eparam:b,callBack:c,fallback:d,writeReq:!0})},sendReorderRequest:function(a,b,c,d){a.taction="reorderSubtasks",s.send({param:a,eparam:b,callBack:c,fallback:d,writeReq:!0})},defaultHandler:function(){zmUtil.succErrMsg("s",r.common.success)},defaultError:function(a,b){b.fallback&&b.fallback(a),a&&zmUtil.succErrMsg("e",a.msg)},reqSetProjectValue:function(a,b){var c=$.Deferred(),d={};d.groupId=b,d.categoryName=a.trim(),d.taction="addCategory",d.actionType="addCommonLabel";var e=d;return this.addEditProjReq(d,e,function(a,b){c.resolve(a,b)}),c.promise()},sendNewLabReq:function(a,b){var c={fn:h.tagResponse},d={name:a,color:b,accId:zmail.accId,mode:"a"},e={name:a,mode:"a"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:c.fn,p:d,ep:e})},migrateTask:function(){var a={};a.onOk=function(){zmAjq.XHR({u:zmail.conPath+"/tasks/TaskMigration.do",t:"POST",fn:s.defaultHandler,p:{dateformat:"dd/MM/yyyy"}})},a.stopPropagation=!0;var b=i.applyArgs(r.common.migrateTask,{companyname:zmail.globalI18N.companyName});k.confirm(b,a)},getTaskList:function(a,b,c){var d={actionType:"appView",isPrev:!1,taction:"getMyTasks",limit:20,streamsView:!0,entityType:3,groupId:zmail.zuid};"delayed"!==a.mode&&"upcoming"!==a.mode&&"week"!==a.mode&&"month"!==a.mode||(d.isPrev=!0),$.extend(d,a),b=b||"",s.send({param:d,eparam:b,callBack:c,writeReq:!1}),m.store("listing","param",d),m.store("listing","eparam",b)},addEditProj:function(a,b,c){var d={streamsView:!0,entityType:3};$.extend(d,a),b=b||"",s.send({param:d,eparam:b,callBack:c,writeReq:!0})},addEditTask:function(a,b,c){var d={streamsView:!0,entityType:3};$.extend(d,a),b=b||"",s.send({param:d,eparam:b,callBack:c,writeReq:!0})},sendSortReq:function(a,b,c){var d={actionType:"appView",limit:20,streamsView:!0,entityType:3};$.extend(d,a),s.send({param:d,eparam:b,callBack:c,writeReq:!1})},sendCategoryReorderReq:function(a,b,c){var d={taction:"reorderCategory"};$.extend(d,a),s.send({param:d,eparam:b,callBack:c,writeReq:!0})},fetchSubtasks:function(a,b){var c={taction:"getSubTasks",actionType:"appView",entityType:"3",streamsView:!0};$.extend(c,a),s.send({param:c,callBack:b,writeReq:!1})},sendAssigneeFilterReq:function(a,b,c){var d={taction:"getGroupTasks",actionType:"appView",entityType:"3",streamsView:!0,limit:20,isPrev:!1};$.extend(d,a),s.send({param:d,eparam:b,callBack:c,writeReq:!1})},sendCreatedByFilterReq:function(a,b,c){s.getTaskList(a,b,c)},sendEditLabReq:function(a,b){var c=$.trim(a.val()),d=l.convertRGBtoHex($("#zm_createlabelpopup").find("div.sel").css("background-color")),e={name:c,color:d,accId:zmail.accId,labId:l.labelId,mode:"e"},f={name:c,color:d,labId:l.labelId,mode:"e"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:b.fn,p:e,ep:f})},sendDeleteLabReq:function(a,b){var c={labId:a,mode:"d",accId:zmail.accId},d={labId:a,mode:"d"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:b.fn,p:c,ep:d})},sendMoveSubtaskReq:function(a){var b={taction:"moveSubtask",streamsView:!0};$.extend(b,a),s.send({param:b,eparam:b,callBack:s.callBack,writeReq:!0})},tagResponse:function(a,b){var c=a.labelId,d={};if(d[c]={color:a.color,id:a.labelId,label:a.displayName,dispName:a.displayName,fav:"true"},!zmsuite.isWorkspaceAvailable("zm_task"))return void("a"===b.mode&&(zmUtil.getTagList("default")[c]=d[c]));var e,f=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("zmllabelH");"a"===b.mode?(f.appendNode(d,f.mapObject),$.publish("/zm/task/label/add",[a])):"e"===b.mode?(e=f.getRowObjfromId(c),e[c].dispName=e[c].label=a.displayName,e[c].color=a.color,f.editNode(e,f.mapObject),$.publish("/zm/task/label/rename",[a])):"d"===b.mode&&(e=f.getRowObjfromId(b.labId),f.deleteNode(e),$.publish("/zm/task/label/delete",[a])),zmail.zohoAccLabInfo=$.extend({},f.getListObject()),zmail.accId===zmail.defAccId&&(zmail.labInfo=f.getListObject())},callBack:function(a,b){var c=b.taction||b.actionType;"addTask"===c||"addTaskSubtask"===c||"addTaskasNew"===c?$.publish("/zm/task/addTask",[a,b]):"editTask"===c?$.publish("/zm/task/editTask",[a,b]):"changeCategory"===c?$.publish("/zm/task/changeCategory",[a,b]):"changeAssignee"===c?$.publish("/zm/task/changeAssignee",[a,b]):"changeTitle"===c?$.publish("/zm/task/changeTitle",[a,b]):"changePriority"===c?$.publish("/zm/task/changePriority",[a,b]):"changeSummary"===c?$.publish("/zm/task/changeSummary",[a,b]):"setDueDate"===c?$.publish("/zm/task/setDueDate",[a,b]):"changeStatus"===c?$.publish("/zm/task/updateState",[a,b]):"addCategory"===c?$.publish("/zm/task/addCategory",[a,b]):"editCategory"===c?$.publish("/zm/task/editCategory",[a,b]):"deleteCategory"===c?$.publish("/zm/task/deleteCategory",[a,b]):"deleteTask"===c?$.publish("/zm/task/deleteTask",[a,b]):"deleteLabel"===c?$.publish("/zm/task/removeLabel",[a,b]):"copyTask"===c?$.publish("/zm/task/copyTask",[a,b]):"moveSubtask"===c&&(b.pTaskId=b.toParentId,$.publish("/zm/task/addTask",[a,b]))}};h={toolTip:function(a,b){var c={elm:a,text:b,arrow:"top"};zmComponent.tooltip(c)},loadGroups:function(){return b=$.Deferred(),c?b.resolve():zmail.ContactBook.groupsFetched.done(function(){zmail.ContactBook.fetchProcess.done(function(){c=$.extend({},zmail.ContactBook.groups.idMap),b.resolve()})}).fail(function(){c=[],b.resolve()}),b.promise()},getDateObject:function(a,b){var c,d;return"dd/MM/yyyy"===b?(c=a.split("/"),d=new Date(c[2],c[1]-1,c[0])):"MM/dd/yyyy"===b&&(c=a.split("/"),d=new Date(c[2],c[0]-1,c[1])),d},formatTwoDigits:function(a){return a<10?"0"+a.toString():a.toString()},currentSubMenus:[],CONSTS:{status:{2:"inprogress",3:"complete"},statusClassMap:{2:"msi-uncheck",3:"msi-check"},priClassMap:{1:"SC_red",2:"SC_red",4:"SC_blue",5:"SC_blue"},titleValidate:{maxLength:500,minLength:1},summaryValidate:{maxLength:65e3,minLength:0},priActivityLogMap:{1:r.center.high,2:r.center.high,3:r.center.medium,4:r.center.low,5:r.center.low},statusActivityLogMap:{2:"reopened",3:"complete"},relativeReminders:[{htm:r.center.samedayReminder,data:{interval:0}},{htm:r.center["1dayBefore"],data:{interval:1}},{htm:i.applyArgs(r.center.ndaysBefore,{n:2}),data:{interval:2}},{htm:i.applyArgs(r.center.ndaysBefore,{n:3}),data:{interval:3}},{htm:i.applyArgs(r.center.ndaysBefore,{n:4}),data:{interval:4}},{htm:i.applyArgs(r.center.ndaysBefore,{n:5}),data:{interval:5}},{htm:i.applyArgs(r.center.ndaysBefore,{n:6}),data:{interval:6}},{htm:i.applyArgs(r.center.ndaysBefore,{n:10}),data:{interval:10}},{htm:i.applyArgs(r.center.ndaysBefore,{n:20}),data:{interval:20}},{htm:i.applyArgs(r.center.ndaysBefore,{n:30}),data:{interval:30}}],repeatType:{1:"Daily",2:"Weekly",3:"Monthly",4:"Yearly"}},extendMention:function(a,b,c,d){var e,f,g;if(d&&d.fromMail?(e=d.pos,f=d.mentionObj.offset,g=f.from[0]):j.getMentions(a)&&j.getMentions(a).length&&(e=j.getCaretPosition(a),f=n.mentionData(a),g=f.from[0]),e&&g&&e>g&&(0===b.which||c||8===b.which||b.ctrlKey||b.metaKey||b.altKey||32===b.which||13===b.which||(b.preventDefault(),zmUtil.succErrMsg("e",r.errorMsg.beforeAssignee)),13===b.which||32===b.which))return b.preventDefault(),!1},tagResponse:function(a,b){var c=a.labelId,d={};if(d[c]={color:a.color,id:a.labelId,label:a.displayName,dispName:a.displayName,fav:"true"},!zmsuite.isWorkspaceAvailable("zm_task"))return void("a"===b.mode&&(zmUtil.getTagList("default")[c]=d[c]));var e,f=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("zmllabelH");"a"===b.mode?(f.appendNode(d,f.mapObject),$.publish("/zm/task/label/add",[a])):"e"===b.mode?(e=f.getRowObjfromId(c),e[c].dispName=e[c].label=a.displayName,e[c].color=a.color,f.editNode(e,f.mapObject),$.publish("/zm/task/label/rename",[a])):"d"===b.mode&&(e=f.getRowObjfromId(b.labId),f.deleteNode(e),$.publish("/zm/task/label/delete",[a])),zmail.zohoAccLabInfo=$.extend({},f.getListObject()),zmail.accId===zmail.defAccId&&(zmail.labInfo=f.getListObject())},popupClick:function(a,b,c){c.parent("b").removeClass("SC_ddn"),c.removeClass("SC_red SC_blue"),$("#zm_dropDown").remove(),"4"===a.val?c.addClass("SC_blue"):"2"===a.val&&c.addClass("SC_red")}};var t={Req:s,isDisabledGroup:function(a){return!!(zmUtil.isNewGroupUser()&&c[a]&&c[a].attrs.disabled)},isHiddenGroup:function(a){return!!(zmUtil.isNewGroupUser()&&c[a]&&c[a].attrs.hidden)},isGroupOwner:function(a){return!!(a===zmail.zuid||c[a]&&c[a].attrs.isOwner)},isGroupModerator:function(a){return!!(a===zmail.zuid||c[a]&&c[a].attrs.moderator.indexOf(zmail.zuid)!==-1)},unescapeSpecialChar:function(a){return a=a?a.replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&#39;/gi,"'").replace(/&quot;/gi,'"').replace(/&apos;/gi,"'"):""},escapeSpecialChar:function(a){return a=a?a.replace(/&/gi,"&amp;").replace(/"/gi,"&quot;").replace(/'/gi,"&#39;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;"):""},CONSTS:h.CONSTS,Categories:function(){return d},Groups:function(a){return a?c[a]:c},getTaskfromStream:function(a,b){var c,d=$.Deferred(),e={};c=b?$.extend({},b):{},e.mode="singlePost",e.actionType="viewGroupEntity",e.groupId=c.groupId=a.groupId,e.entityId=c.entityId=a.entityId,e.allComments=!0;var f=function(a){d.resolve(a)};return s.streamReq(e,c,function(a){d.resolve(a)},!1,f),d.promise()},Init:function(){var a=$.Deferred(),b=function(){if(!q&&"undefined"!=typeof window.ZCL_getWeekStart)try{var a=ZCL_getWeekStart();a.done(function(a){q=a})}catch(b){}};return h.loadGroups().done(function(){d?a.resolve():s.getAllProjects({},{taction:"getAllProjects",curEle:this},function(b){d=$.extend(!0,{},b.categories),b.groupOrder?(e=b.groupOrder,f=b.grptaskcount):(d=f={},e=[]);var c=parseInt(zmail.zuid);e.push(c),f[c]=b.personaltaskcount,d[c]=b.personalCategories,a.resolve()},function(b){d=f={},e=[],a.resolve()})}),b(),a.promise()},getGroupTaskOrder:function(){return{order:e,count:f}},isPrivateTask:function(a){return a!==zmail.zuid&&!c[a]},isGroupMember:function(a,b){var d=c[b],e=d?d.attrs.members:void 0;return!!(a===b||d&&e&&e.indexOf(a)!==-1)},getGroupMembers:function(a){return!!c[a]&&c[a].attrs.members},showPreviewToolTips:function(a){a.find("i.msi-label").length&&h.toolTip(a.find("i.msi-label")[0],r.preview.tooltip.tag),a.find("i.msi-calendar").length&&h.toolTip(a.find("i.msi-calendar")[0],r.preview.tooltip.duedate),a.find("i.msi-priority").length&&h.toolTip(a.find("i.msi-priority")[0],r.preview.tooltip.priority),a.find("i.msi-attachment").length&&h.toolTip(a.find("i.msi-attachment").parent()[0],r.preview.tooltip.attachment),a.find("i.msi-watch").length&&h.toolTip(a.find("i.msi-watch").parent()[0],r.preview.tooltip.recurring),a.find("i.msi-trash").length&&h.toolTip(a.find("i.msi-trash").parent()[0],r.center.deleteTask),a.find("i.msi-alarm").length&&h.toolTip(a.find("i.msi-alarm")[0],r.preview.tooltip.reminder)},showToolTip:function(a){a.find("i.msi-trash").length&&zmComponent.tooltip({elm:a.find("i.msi-trash")[0],text:r.center.deleteTask,arrow:"top"}),a.find("i.msi-archive").length&&zmComponent.tooltip({elm:a.find("i.msi-archive")[0],text:r.center.archiveTask,arrow:"top"}),a.find("i.msi-unarchive").length&&zmComponent.tooltip({elm:a.find("i.msi-unarchive")[0],text:r.center.unarchiveTask,arrow:"top"}),a.find("i.msi-link").length&&zmComponent.tooltip({elm:a.find("i.msi-link")[0],text:r.center.copyPermalink,arrow:"top"}),a.find("i.msi-undo").length&&zmComponent.tooltip({elm:a.find("i.msi-undo")[0],text:r.center.deleteTask,arrow:"top"}),a.find("i.msi-markcomplete").length&&zmComponent.tooltip({elm:a.find("i.msi-markcomplete")[0],text:r.listing.tooltip.changeStatus,arrow:"top"}),a.find("i.msi-subtask").length&&zmComponent.tooltip({elm:a.find("i.msi-subtask")[0],text:r.listing.tooltip.addSubtask,arrow:"top"}),a.find(".zmtCt").length&&zmComponent.tooltip({elm:a.find(".zmtCt")[0],text:r.listing.tooltip.showSubtask,arrow:"top"}),a.find("i.msi-mail").length&&zmComponent.tooltip({elm:a.find("i.msi-mail")[0],text:r.center.previewMail,arrow:"top"}),a.find("i.msi-nmore").length&&zmComponent.tooltip({elm:a.find("i.msi-nmore")[0],text:r.center.moreactions,arrow:"top"}),a.find("i.msi-lcmnt").length&&zmComponent.tooltip({elm:a.find("i.msi-lcmnt")[0],text:r.center.commentsAvailable,arrow:"top"})},extendMention:h.extendMention,setAssignee:function(a,b,c){b=this.unescapeSpecialChar(b).trim();var d="task",e=a.closest("div.zt_pv"),f=e.find("div.SC_ptit div.SC_assignee");a.closest("div.Stask_sub").length&&(d="subtask",e=a.closest("div.Stask_sub"),f=e.find("div.SC_assignee"));var g=a.closest("div.zm_mention"),h=f.find("span");if(c&&h.length>0){var i=c,k=b,l=t.getContact(c);i=l?l.get("fn"):"","subtask"===d?a.val(b):(k+=" "+i+"\ufeff",g.find("div.zm_mentionbg").removeClass("SC_dyn"),a.data("mentions",[{fn:i,zid:c,id:c}]),a.val(k),j.updateElements(a[0])),h.text(i)}else a.val(b),a.removeData("mentions"),g.find("b.zm_groupMember").length&&g.find("b.zm_groupMember").remove()},getDate:function(a,b){var c=a;try{var d=new Date(a);c=isNaN(d)?a:a.getDateBy(b)}catch(e){}return c},getRailTime:function(a){if(zmail.userOptions.isRailTime)return a+":00";var b=Number(a.match(/^(\d+)/)[1]),c=Number(a.match(/:(\d+)/)[1]),d=a.match(/\s(.*)$/)[1];"pm"===d&&b<12&&(b+=12),"am"===d&&12===b&&(b-=12);var e=b.toString(),f=c.toString();return b<10&&(e="0"+e),c<10&&(f="0"+f),e+":"+f+":00"},bindStreamTime:function(a){var b=zmail.userOptions.isRailTime?"hh:mm":"hh:mm a";"undefined"!=typeof ZEVENTS&&ZEVENTS(a).picker("time",{tform:b,refer:a}).bind()},bindStreamCal:function(a,b,c,d){try{var e,f=d?"dd MMM yyyy":zmail.userDateFormat;if(d){var g=h.getDateObject(zmail.userDateVal,zmail.userDateFormat);e=this.getDate(g,"dd MMM yyyy")}else e=zmail.userDateVal;var i=this;"undefined"!=typeof ZEVENTS&&ZEVENTS(a).picker("date",{dform:f,range:[e,""],today:zmail.userDateVal,wkst:q,mode:"popup",refer:b,update:"yes",minhgt:251,fullDtclk:1}).on("dateclick",function(){$(b).parent().removeClass("SC_dyn");var a=i.getDate(this.getDate(),zmail.userDateFormat);c(a)}).bind()}catch(j){}},getComputedTime:function(){var a=new Date,b=a.getHours(),c=a.getMinutes(),d=a.getSeconds(),e=30*Math.round(c/30)%60,f={};e=e>0?"30":"00";var g=23===b?0:++b,i=c>45?g:b;return i+2>=23?(i=0,f.tomorrow=!0):(i+=2,f.tomorrow=!1),f.time=h.formatTwoDigits(i)+":"+e+":"+h.formatTwoDigits(d),f},convertToTwelveHourFormat:function(a){if(a=a.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/)||[a],a=a.slice(0,4),a.length>1){if(a=a.slice(1),zmail.userOptions.isRailTime)return a.join("");a[3]=" ",a[4]=Number(a[0])<12?"am":"pm";var b=Number(a[0])%12||12;b<10?a[0]="0"+b:a[0]=b}return a.join("")},getReminderInterval:function(a){var b=h.CONSTS.relativeReminders[0].htm;return $.each(h.CONSTS.relativeReminders,function(c,d){if(d.data.interval===a)return b=d.htm,!1}),b},validateParams:function(a,b){var c=b.find(".ZT_prvTitle"),d=b.find(".ZT_prvDescrip"),e=this.validateTitle(a.title,c);return e?!(a.summary&&a.summary.length>h.CONSTS.summaryValidate.maxLength)||(d.focus(),zmUtil.succErrMsg("e",r.errorMsg.summaryLen),!1):e},validateTitle:function(a,b){var c=!0;return a.trim().length<h.CONSTS.titleValidate.minLength?(zmUtil.succErrMsg("e",r.errorMsg.enterTitle),c=!1):a.length>h.CONSTS.titleValidate.maxLength&&(zmUtil.succErrMsg("e",r.errorMsg.titleLen),c=!1),b&&b.focus(),c},initAttachComponent:function(a,b,c){var d;if(c&&c.get("attref")&&(d=c.get("attref")),d)d.init();else{var e={componentId:"task",isNewImp:!0,autoLaunch:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],eleId:a.id,renameSupport:!0,onRemoveAttachment:function(){var b=$("#"+a.id).closest("div.zmPAtt");0===b.children().length&&b.addClass("SC_dyn")}};b&&(e.onAllUploadFinish={handler:function(b){return b.tempLocation&&b.tempLocation.error?(11===b.tempLocation.errorCode?o.succErrMsg("e",r.errorMsg.virusFound):12===b.tempLocation.errorCode&&o.succErrMsg("i",r.errorMsg.virusPending),!1):void a.clbkfn(b)},removeAttachDOM:!0,resetData:!0}),zmUtil.initAttachComponent(e,function(a){c&&c.set("attref",a)})}},copyNewProps:function(a,b){for(var c in b)a.hasOwnProperty(c)||(a[c]=b[c]);return a},bindPriority:function(a,b,c){b.stopPropagation();for(var d=[],e=$(a).find("i.msi-priority"),f=$(e).attr("class"),g=[{cls:"SC_red",text:r.center.high,val:"2"},{text:r.center.medium,val:"3"},{cls:"SC_blue",text:r.center.low,val:"4"}],i=0;i<3;i++)f.split(" ")[1]===g[i].cls?d.push({htm:"<i class='msi-none msi-tick'></i>"+g[i].text,data:{action:g[i].text,val:g[i].val}}):d.push({htm:"<i class='msi-none'></i>"+g[i].text,data:{action:g[i].text,val:g[i].val}});var j=$(a).find("b");j.addClass("SC_ddn");var k={par:a,list:d,align:"pright",clk:function(a,b){h.popupClick(a,b,$(e)),c&&c(a,b,$(e))}},l=zmsuite.showMenu(k);this.addRemoveMenu("add",l)},addRemoveMenu:function(a,b){"add"===a&&b?g=b:"remove"===a&&g&&("function"==typeof g.remove?($(g.dropObj.par).find(".SC_ddn").removeClass("SC_ddn"),g.remove()):g.hide())},getProjectAutofillArray:function(a){var b=[],c=d[a];for(var e in c){var f={};f.id=c[e].categoryId,f.name=c[e].categoryName,f.display_text=c[e].categoryName,f.tooltip=c[e].categoryName,b.push(f)}return b},folderlabelComp:function(a,b){var c=zmUtil.createFLComp(a,b);c.show(),t.addRemoveMenu("add",c)},showDropdownListing:function(a){var b={};b.parentDOM=a.parentDOM,b.displayAs="dropdown",b.onSelect=a.selectCallback,b.dataCallback=function(){return a.listing},"function"==typeof a.createCallback&&(b.onCreate=a.createCallback),this.folderlabelComp("task",b)},getGroupName:function(a){return"undefined"==typeof a&&(a=zmail.zuid),String(a)===zmail.zuid?r.left.mytask:c[a]?c[a].attrs.name:r.center.privateTask},getProjectName:function(a,b){if(b&&d&&d[a])for(var c,e=d[a],f=0,g=e.length;f<g;f++)if(b===e[f].categoryId)return c=e[f].categoryName;return""},highlight:function(a){a.addClass("highlightClass"),setTimeout(function(){a.removeClass("highlightClass")},5e3)},openMailPreview:function(b){var c={},d=a("zmList");b.accid!==zmail.accId&&(c={actionType:"viewGroupMailEntity",entityId:b.msgid,entityType:"1",streamsView:"true",groupId:b.groupId,accId:b.accid}),d.getMailData({msgId:b.msgid,opentype:2,type:"lt",src:"external",eprm:c})},bindMention:function(a){var b=function(){this.titleEl=$(a.titleEl),this.titleEl&&(this.groupId=a.groupId===zmail.zuid?"org":a.groupId,this.initEvents())};return b.prototype={setAutofillToTitle:function(){var a={contentArray:"org",compare:["fn","ln","nn","eid"],LType:"3",OType:"3",initialHeight:!1,oneMention:!0,excludeMe:!1};this.groupId&&(a.groupId=this.groupId,a.addtolist=!0,this.titleEl.data("gid",this.groupId)),n.setAutofill(a,this.titleEl)},initEvents:function(){this.setAutofillToTitle(),a.keypress||this.titleEl.off("keypress").on("keypress",function(b){return!($(this).val().length>=h.CONSTS.titleValidate.maxLength)&&void h.extendMention(this,b,a.addEl)})}},new b},getGroupArr:function(){var a=[];return _.each(e,function(b){if(!t.isDisabledGroup(b)){var c={};c.id=b,c.name=t.getGroupName(b),c.display_text=t.getGroupName(b),c.tooltip=t.getGroupName(b),a.push(c)}}),a},bindAssignEvents:function(a,b,c){var d,e,f=a.data(),g=a.data("assignee"),h="",i={zuid:zmail.zuid,promise:!1};i.type=zmail.isOrg?"org":void 0;var j,k=$.extend({attrs:{fn:"Me"}},zmail.ContactBook.get(i)[0]),l=[],m=[];l.push(k);var n=function(){return a.is("SPAN")?a.text().trim():a.is("INPUT")?a.val().trim():void 0},o=function(a){$.each(a,function(a,b){var c=$("<span/>",{title:b.attrs.eid}).text(b.attrs.fn)[0].outerHTML;c+=$("<img/>",{ref:"photo",src:b.attrs.photo})[0].outerHTML,m.push({htm:c,data:b.attrs})})},p=function(b){if(f.assignee!==b.zid){if(f.groupId===zmail.zuid&&"-1"===b.zid)return void a.text(h);s.changeAssigneeReq({entityId:f.id,groupId:f.groupId,assignee:b.zid,pTaskId:f.pTaskId},function(a,b){$.publish("/zm/task/changeAssignee",[a,b])}),e.hide()}},q=function(a){return a.length?(j.empty(),void $.each(a,function(a,b){var c=$("<li/>");c.data(b.attrs);var d=$("<span/>",{title:b.attrs.eid}).text(b.attrs.fn);c.append(d);var e=$("<img/>",{alt:"SL",ref:"photo",src:b.attrs.photo});c.append(e),j.append(c)})):void e.hide()};if(f.groupId&&f.groupId!==zmail.zuid){var r=zmail.ContactBook.getGroups(f.groupId);if(r.length){var t=r[0].attrs.members.slice(0),u=t.indexOf(zmail.zuid);u>=0&&t.splice(u,1);var v=zmail.ContactBook.get({zuid:t,type:["org"],promise:!1});l=l.concat(v)}o(l)}else o(l);var w={list:m,clk:function(a,b,d){g=a.zid,"function"==typeof c?c(a,e):p(a),d.stopPropagation()}},x={"max-height":"200px",overflow:"auto",height:"","min-width":"200px"},y={width:"200px"};f.fromDateExtraction&&(y.width=""),a.off("click").on("click",function(a){var c=void 0,f=void 0;window.getSelection&&document.createRange?(f=window.getSelection(),c=document.createRange(),c.selectNodeContents($(this)[0]),f.removeAllRanges(),f.addRange(c)):document.selection&&document.body.createTextRange&&(c=document.body.createTextRange(),c.moveToElementText($(this)[0]),c.select()),h=$(this).text(),b&&(w.align="pleft",w.parWidth=!0,w.par=b,b.css(y)),e=zmsuite.showMenu(w),e.$el.hide(),d=e.$el,j=d.find("ul"),j.addClass("SC_Pr");var g=$(d.find("div")[0]);g.addClass("content-wrapper"),g.css(x),d.addClass("SC_dd SC_zi900 shw"),e.$el.show()}),a.off("focusout").on("focusout",function(a){window.getSelection().removeAllRanges();var d="INPUT"===this.nodeName?this.value:this.textContent;d.length?$(this).text(h):("function"==typeof c?c({fn:"Unassigned",zid:"-1"},e):p({fn:"",zid:"-1"}),g="-1"),b&&b.removeAttr("style")}),a.off("keyup").on("keyup",function(a){if(8===a.keyCode||46===a.keyCode)return!1;var b=d.find("li.sel");if(b.length>0){if(40===a.keyCode)return b.removeClass("sel"),b.next("li").addClass("sel"),!1;if(38===a.keyCode)return b.removeClass("sel"),b.prev("li").addClass("sel"),!1}else if(38===a.keyCode||40===a.keyCode)return $(d.find("li")[0]).addClass("sel"),!1;if(13===a.keyCode){var f=$(this).text();$(this).text(f.trim());var i=d.find("li.sel").data();return i||(i={fn:"Unassigned",zid:"-1"}),"function"==typeof c?c(i,e):(i.fn="",p(i)),g=i.zid,h=i.fn,!1}e.show(),e.$el.offset({left:e.dropObj.par.offset().left});var k=n();j.closest("div.content-wrapper").css("height",""),k.length>0?zmail.ContactBook.get({str:k,type:"org",exclude:[g]}).done(function(a){q(a)}):q(l)})},deleteTaskAttachment:function(a){var b=a.Id+a.e,c={attachId:a.Id,entityId:a.e,groupId:a.gId,pTaskId:a.pTaskId};s.removeAttachmentReq(c,function(a,c){var d=$("div[data-refid='"+b+"']"),e=d.closest("div.zmPAtt");$("div[data-refid='"+b+"']").remove();var f=e.find("div.zmL.zmAch").length;0===f&&e.remove()})},mousedownHandler:function(a){zmUtil.stopEvents(a,!0),this.addRemoveMenu("remove"),$("#zmCntxtMenu").remove(),$("#zm_dropDown").remove(),$("b.SC_ddn").removeClass("SC_ddn"),$(".zcal_cn").remove(),$(".zcal_tilst").remove()},editProjectValue:function(a,b){if("addCategory"===b.taction){var c=!1;for(var e in d[b.groupId])if(d[b.groupId][e].categoryId===a.categoryId){c=!0;break}c||d[b.groupId].push(a)}else if("editCategory"===b.taction){for(var f in d[b.groupId])if(d[b.groupId][f].categoryId===a.categoryId){d[b.groupId][f]=a;break}}else if("deleteCategory"===b.taction)for(var g in d[b.groupId])if(d[b.groupId][g].categoryId===a.categoryId){d[b.groupId].splice(g,1);break}},moveTask:function(a,b){var c=b?r.common.postnew:r.common.moveTask,d=this,e=!0,f=this.getGroupArr(),g=p.moveTask(),h=g.getElementsByClassName("groupId")[0],i=g.getElementsByClassName("catId")[0],j=g.getElementsByClassName("tTitle")[0],k=g.getElementsByClassName("msi-check")[0],l=g.getElementsByClassName("cmtId")[0];$(j).val(a.TITLE),$(h).data({id:a.NMSPID,name:t.getGroupName(a.NMSPID)}),$(h).on("click",function(){d.showDropdownListing({listing:f,selectCallback:function(a,b){$(h).val(b.name),$(h).data(b),$(i).val(""),$(i).data(),t.addRemoveMenu("remove")},parentDOM:this})}),$(i).off("click").on("click",function(){var a=$(h).data(),b=d.getProjectAutofillArray(a.id);d.showDropdownListing({listing:b,selectCallback:function(a,b){$(i).val(b.name),$(i).data(b),t.addRemoveMenu("remove")},parentDOM:this})});var m=function(b){return a.NMSPID!==b||(zmUtil.succErrMsg("e",r.errorMsg.moveError),!1)},n=function(a){$(k).toggleClass("msi-check msi-uncheck"),e=$(k).hasClass("msi-check")};$(k).on("click",n),$(l).on("click",n);var o={taction:"copyTask",copy:b,groupId:a.NMSPID,entityId:a.TASKID,toGroupId:a.NMSPID},q={title:c,$content:$(g),defaultCloseIcon:!0,buttons:[{name:r.common.save,callback:function(a){var c=String($(h).data().id);if(b||!b&&m(c)){var d=a.$els.$buttonContainer.find(".js-button-selector")[0];d.innerText=r.common.saving,o.toGroupId=c,$(i).data().id&&(o.toCatId=String($(i).data().id)),o.title=$(j).val(),o.includeComments=e,s.sendMoveTaskRequest(o,o,function(b,d){s.callBack(b,d),d.copy||($.publish("task/deleteTask",[{pid:d.entityId,gid:d.groupId}]),$.publish("/zm/task/deleteTask",[b,d])),a.remove();var e=r.common.mveTask;d.copy&&(e=r.common.cpyTask),e+=t.getGroupName(c),zmUtil.succErrMsg("s",e)},function(b,c){d.innerText=r.common.save,zmUtil.succErrMsg("e",b.msg),a.remove()})}}},{isCancel:!0,name:r.common.cancel,callback:function(a){a.remove()}}],dialogDidMount:function(b){$(h).val(t.getGroupName(a.NMSPID)),$(h).data("id",a.NMSPID),b.$els.$contentWrapper.mousedown(function(a){zmUtil.stopEvents(a,!0),zmTask.Util.addRemoveMenu("remove")})}};Dialog["new"](q)},handleURLChange:function(a,b){if(a){a.indexOf("t")!==-1||a.indexOf("s")!==-1?m.store("preview","hashParams",a):m.store("listing","hashParams",a);var c=zmsuite.getAppRouter("zm_task");if(!c)return!1;var d=c._hashParams;if(d.indexOf("t")!==-1&&d.splice(d.indexOf("t"),2),d.indexOf("views")===-1&&d.indexOf("tags")===-1||!b?"mytask"===d[0]&&b?(d.splice(1,d.length),a=[b].concat(a)):b&&(d[0]=b):(d.splice(2,1),a=[b].concat(a)),a.indexOf("t")!==-1)return d.push.apply(d,a),void c.update();c.setParams(a),c.update()}},getPriorityByValue:function(a){return h.CONSTS.priActivityLogMap[a]},getStatusByValue:function(a){return h.CONSTS.statusActivityLogMap[a]},addTaskPopup:function(a,b){var c=$(a).find("#addnewtask");c.on("click",function(){zmUtil.requireTaskModule("taskCreate").done(function(){zmTask.Create({groupId:zmail.zuid,listInfo:b})})})},moveArrayElementPosition:function(a,b,c){var d=a.splice(b,1)[0];a.splice(c,0,d)},bindDropTarget:function(a,b){if(a){var c=new zmail.dndComp.Drop;c.init(a,{onDragOver:function(b){var c=!1;return $(b).hasClass("Stask_sub_add")||$(b).closest("div.Stask_sub_add").length>0?c=!1:$(b).hasClass("Stask_sub")||$(b).is("li")?(c={allowDragOver:!0},$(a).find(".SC_dragHighlight").removeClass("SC_dragHighlight"),$(b).addClass("SC_dragHighlight")):$(b).closest("div.Stask_sub").length>0?(c={allowDragOver:!0},$(a).find(".SC_dragHighlight").removeClass("SC_dragHighlight"),$(b).closest("div.Stask_sub").addClass("SC_dragHighlight")):$(b).hasClass("div.Stask_parent")||$(b).closest("div.Stask_parent").length>0||$(b).hasClass(".SC_Tct")||$(b).closest(".SC_Tct").length>0?(c={allowDragOver:!0},$(a).find(".SC_dragHighlight").removeClass("SC_dragHighlight"),$("div.Stask_parent").addClass("SC_dragHighlight")):$(b).closest("li").length>0&&(c={allowDragOver:!0},$(a).find(".SC_dragHighlight").removeClass("SC_dragHighlight"),$(b).closest("li").addClass("SC_dragHighlight")),c},onDragOverDetails:function(a,b){},onDrop:function(c){var d,e,f=$(a).find("[data-attr]")[0];e=d=$(c.target),d.closest("div.Stask_sub").length>0?e=d.closest("div.Stask_sub"):d.closest("li").length>0&&(e=d.closest("li"));var g,h=$(f).index();if(d.hasClass("div.Stask_parent")||d.closest("div.Stask_parent").length>0||$(d).hasClass(".SC_Tct")||$(d).closest(".SC_Tct").length>0)$(f).insertBefore($(a).find("div.Stask_sub")[0]);else if($(e).hasClass("Stask_sub")||$(e).closest("div.Stask_sub").length>0){if(f.isEqualNode(e[0]))return void $(".SC_dragHighlight").removeClass("SC_dragHighlight");$(f).insertAfter(e)}else $(c.target).hasClass("mytask")?$(f).insertAfter(e):($(c.target).is("li")||$(c.target).closest("li").length>0)&&(g="li.zmDrgbleSubtsk",h=$(f).index(g),$(f).insertAfter(e));var i=$(f).index(g);"function"==typeof b&&b(h,i)}})}},bindDragSource:function(a){var b=$("<div />",{"class":"SC_dragger"});b.append("<i class='msi-drag'></i>"),$(a).append(b);var c=new zmail.dndComp.Drag;c.init(a,{draggedClassName:"",onDragStart:function(a){var b="";$(a).find(".ZT_prvTitle").length>0?b=$(a).find(".ZT_prvTitle").val():$(a).find("strong").length>0&&(b=$(a).find("strong").text());var c={allowDrag:!0,type:"div",id:b,html:$("<div/>",{"class":"zm_dragger SC_dragText"}).text(b)};return $(a).addClass("Stask_highlight"),$(a).attr("data-attr",b),c},onDragEnd:function(a){$(".SC_dragHighlight").removeClass("SC_dragHighlight"),$(a).removeAttr("data-attr"),$(a).removeClass("Stask_highlight")}})},handleCloseTask:function(){var a=zmsuite.getAppRouter("zm_task");if(!a)return!1;var b=a._hashParams;if(b.indexOf("t")!==-1){var c=b.indexOf("t"),d=zmsuite.getLeft().selLayerId;"views"===d&&c--,b.splice(c)}a.setParams(b),a.update(),m.deleteState("preview")},toolTip:h.toolTip,getContact:function(a){var b={zuid:String(a),promise:!1};b.type=zmail.isOrg?"org":void 0;var c=zmail.ContactBook.get(b);return c[0]},getHeaderBandValues:function(a){var b,c,d,e="";return a.categoryId?e=t.getProjectName(a.groupId,a.categoryId):a.groupId&&(e=t.getGroupName(a.groupId)),!a.priority||"getTasksByPriority"!==a.taction&&"getPersonalTasks"!==a.taction?a.status&&"getTasksByStatus"===a.taction||"getTasksByCategoryStatus"===a.taction||"getPersonalTasks"===a.taction?(2===Number(a.status)?d=r.center.inprogress:3===Number(a.status)&&(d=r.center.completed),c=i.applyArgs(r.center.filterBy,{filter:r.center.status})):a.labelName&&"getTasksByLabel"===a.taction||"getPersonalTasks"===a.taction?(c=r.center.labeledTasks,d=a.labelName?a.labelName:void 0):"getArchivedTasks"===a.taction&&(c=void 0,d="Archived Tasks"):(3===Number(a.priority)?d=r.center.medium:2===Number(a.priority)?d=r.center.high:4===Number(a.priority)&&(d=r.center.low),c=i.applyArgs(r.center.filterBy,{filter:r.center.priority})),a.assigneeId&&(c=i.applyArgs(r.center.filterBy,{filter:r.center.assignee}),d=Number(a.assigneeId)===-1?r.center.unassigned:t.getContact(a.assigneeId).attrs.fn),a.userId&&(c=i.applyArgs(r.center.filterBy,{filter:r.center.createdby}),d=t.getContact(a.userId).attrs.fn),(d||c)&&(b=t.getFilterHeader(c,d,a.assigneeId)),{headerValue:e,filterData:b,filterName:c,filterValue:d}},getFilterHeader:function(a,b,c){var d='<span class="sum unreadCount SC_folFil">';return d+=a?$("<b/>").text(a)[0].outerHTML:"",d+='<span id="assigneeFilter" class="zmAssigneeFilter" contenteditable="true" style="width: auto;">'+b+'</span><i id="clrFilter" class="msi-close"></i></span>',d+=c?'<div id="" data-readval="read" data-read="Inprogress" data-write="Completed" class="SC_rwToggle SC_tskToggle" data-zuid="'+c+'"></div>':""},linkify:function(a){if(t.checkURLPattern(a)){var b,c;return c=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi,b=a.replace(c,function(a,b){if(!arguments[2]){var c;return arguments[3]?(c=zdom("a",{href:arguments[0],target:"_blank",rel:"noopener noreferrer"},arguments[0]),c.outerHTML):(c=zdom("a",{href:window.location.protocol+"//"+arguments[0],target:"_blank",rel:"noopener noreferrer"},arguments[0]),c.outerHTML)}return arguments[0]})}return a},checkURLPattern:function(a){if(a){var b=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi;return b.test(a)}return!1},getCategory:function(a){return d[a]},getCategoryName:function(a,b){var c=_.find(d[a],function(a){if(a.categoryId===b)return a.categoryName});return c?c.categoryName:""},getRepeatType:function(a){return h.CONSTS.repeatType[a]}};return window.zmTask=window.zmTask||{},window.zmTask.Util=t,t});
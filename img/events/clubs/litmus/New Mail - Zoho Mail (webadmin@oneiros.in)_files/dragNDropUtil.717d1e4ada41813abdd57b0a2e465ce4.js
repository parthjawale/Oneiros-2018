"use strict";!function(){var a=zmail.Core.Namespaces,b=zmail.Utils.DOM,c=a.create("zmail.dndComp"),d=function(){function a(){babelHelpers.classCallCheck(this,a);var b=this;b.element=null,b.active=!1,b.draggedClassName="",b.onDragStart=null,b.onDragEnd=null,b._handleDragStart=null,b._handleDragEnd=null}return babelHelpers.createClass(a,[{key:"init",value:function(a,b){var c=this;c.element=a,c.draggedClassName=b.draggedClassName||"dragged",c.onDragStart=b.onDragStart,c.onDragEnd=b.onDragEnd,c._handleDragStart=null,c._handleDragEnd=null,c.enable()}},{key:"enable",value:function(){var a=this;return!a.element.hasAttribute("draggable")&&(a.bindEvents(),void(a.active=!0))}},{key:"bindEvents",value:function(){var a=this;a._handleDragStart=a.handleDragStart.bind(a),a._handleDragEnd=a.handleDragEnd.bind(a),a.element.setAttribute("draggable","true");var b=a.element.getElementsByTagName("img")[0];b&&b.setAttribute("draggable","false"),a.element.addEventListener("dragstart",a._handleDragStart,!1),a.element.addEventListener("dragend",a._handleDragEnd,!1)}},{key:"unbindEvents",value:function(){var a=this,b=a.element;b.removeAttribute("draggable"),b.removeEventListener("dragstart",a._handleDragStart,!1),b.removeEventListener("dragend",a._handleDragEnd,!1)}},{key:"handleDragStart",value:function(a){var c=this;if(a.dataTransfer.dropEffect="move",c.onDragStart){var d,e=c.onDragStart(c.element);if(!e.allowDrag)return!1;c.elem=zdom("div",null),e.text?b.setText(c.elem,e.text):e.dom?b.mount(e.dom,c.elem):e.html?b.__dangerouslySetInnerHTML(c.elem,e.html):b.mount(zdom("div",null,"Element Dragging"),c.elem);var f={type:e.type,id:e.id};d=JSON.stringify(f),e.disableGhostImage?(zmail.dndComp._dragAttrs=f,a.dataTransfer.setData("dragAttrs",d),a.dataTransfer.effectAllowed="move"):a.dataTransfer.setDragImage?(c.elem.style.position="absolute",c.elem.style.left="-9999px",document.body.appendChild(c.elem),zmail.dndComp.dragId={dragRef:f},a.dataTransfer.setData("dragAttrs",d),c.elem.id="ghostImage",a.dataTransfer.setDragImage(c.elem,0,0),a.dataTransfer.effectAllowed="move",zmail.dndComp._dragAttrs=f):(zmail.dndComp.dragAttrs=d,zmail.dndComp._dragAttrs=f)}}},{key:"handleDragEnd",value:function(){var a=this;setTimeout(function(){b.removeClass(a.element,a.draggedClassName),b.unmount(b.selector("#ghostImage"),!0),b.unmount(b.selector("#dragedNode"),!0),a.onDragEnd(a.element),zmail.dndComp.dragId&&zmail.dndComp.dragId.dragRef.hasOwnProperty("sibling")&&(a.destroy(),delete zmail.dndComp.dragId),zmail.dndComp.dragAttrs&&delete zmail.dndComp.dragAttrs,zmail.dndComp._dragAttrs&&delete zmail.dndComp._dragAttrs},0)}},{key:"disable",value:function(){var a=this;a.unbindEvents(),a.active=!1}},{key:"isSupport",value:function(){return"draggable"in zdom("span",null)}},{key:"destroy",value:function(){var a=this;a.disable(),a.element=null,a.draggedClassName="",a.onDragStart=null}}]),a}();c.Drag=d}(),function(){var a=zmail.Core.Namespaces,b=a.get("zmail.dndComp"),c=b,d=zmail.Utils.DOM,e=function(){function a(){babelHelpers.classCallCheck(this,a);var b=this;b.active=!1,b.element=null,b.dropAreaAnimation=null,b.onDragOver=null,b.onDrop=null,b.allowDragOver=null,b.onDragOverDetails=null,b.onDragLeave=null}return babelHelpers.createClass(a,[{key:"init",value:function(a,b){var c=this;c.element=a,c.dropAreaAnimation=b.dropAreaAnimation,c.onDragOver=b.onDragOver,c.onDrop=b.onDrop,c.allowDragOver=!1,c.onDragOverDetails=b.onDragOverDetails,c.onDragLeave=b.onDragLeave,c.enable()}},{key:"setPositions",value:function(a,b){var c=a.target,d=c.getBoundingClientRect();b.style.position="absolute",b.style.width=d.width+"px",b.style.height=d.height+"px",b.style.left=d.left+"px",b.style.top=d.top+"px"}},{key:"enable",value:function(){var a=this;a.active=!0,this.bindEvents(this.element)}},{key:"disable",value:function(){var a=this;this.unbindEvents(),a.active=!1}},{key:"destroy",value:function(){var a=this;a.disable(),a.element=null,a.dropAreaAnimation=null,a.onDragOver=null,a.onDrop=null}},{key:"mouseOut",value:function(){var a=d.selector(".dndAnim");a&&(d.element(a).off("mouseleave"),d.unmount(a,!0))}},{key:"bindEvents",value:function(a){var b=this;a.addEventListener("dragenter",b.handleDragEnter.bind(b),!1),a.addEventListener("dragover",b.handleDragOver.bind(b),!1),a.addEventListener("drop",b.handleDrop.bind(b),!1),a.addEventListener("dragleave",b.handleDragLeave.bind(b),!1)}},{key:"unbindEvents",value:function(){var a=this,b=a.element;b.removeEventListener("dragenter",a.handleDragEnter,!1),b.removeEventListener("dragover",a.handleDragOver,!1),b.removeEventListener("drop",a.handleDrop,!1),b.removeEventListener("dragleave",a.handleDragLeave,!1)}},{key:"handleDragLeave",value:function(a){var b=this;return a.preventDefault(),a.stopPropagation(),"function"==typeof b.onDragLeave&&b.onDragLeave(a),!1}},{key:"handleDragOver",value:function(a){var b=this;if(b.allowDragOver){var d=c._dragAttrs,e={};e={clientY:a.clientY,clientX:a.clientX,target:a.target},b.onDragOverDetails&&b.onDragOverDetails(d,e),a.stopPropagation(),a.preventDefault()}}},{key:"handleDragEnter",value:function(a){var b=this,d=b.onDragOver(a.target,c._dragAttrs);d.allowDragOver&&(b.allowDragOver=!0),a.stopPropagation()}},{key:"handleDrop",value:function(a){var b=this,c={target:a.target,ev:a};zmail.dndComp.dragAttrs?(c.dragObj=JSON.parse(zmail.dndComp.dragAttrs),delete zmail.dndComp.dragAttrs):c.dragObj=JSON.parse(a.dataTransfer.getData("dragAttrs")),zmail.dndComp._dragAttrs&&delete zmail.dndComp._dragAttrs,b.onDrop(c)}}]),a}();b.Drop=e}(),function(){var a=zmail.Core.Namespaces,b=a.get("zmail.dndComp"),c=function(){function a(){babelHelpers.classCallCheck(this,a);var b=this;b.element=null,b.active=!1,b.onDragStart=null,b.setDragInstance=null,b.onDragEnd=null,b.dragInstance=null}return babelHelpers.createClass(a,[{key:"init",value:function(a,b){var c=this;c.element=a,c.onDragStart=b.onDragStart,c.onDragEnd=b.onDragEnd,c.setDragInstance=b.setDragInstance,c.dragInstance=null,c.enable()}},{key:"enable",value:function(){var a=this;a.bindEvents(),a.active=!0}},{key:"bindEvents",value:function(){var a=this;a.element.addEventListener("mousedown",a.handleMousedown.bind(a),!1)}},{key:"isSupport",value:function(){var a=zdom("span",null);return"draggable"in a}},{key:"handleDragEnd",value:function(a){var b=this;b.dragInstance.unbindEvents(),b.onDragEnd(a)}},{key:"handleMousedown",value:function(a){var b=this,c=a.target;if("function"==typeof b.onDragStart){var d={};d={node:b.element,target:c};var e=b.setDragInstance(d);if(e.setDrag){if("undefined"==typeof e.element)return!1;b.dragInstance=new zmail.dndComp.Drag,b.dragInstance.init(e.element,{draggedClassName:e.draggedClassName,onDragStart:b.onDragStart,onDragEnd:b.handleDragEnd.bind(b)})}}}}]),a}();b.dragSourceSibling=c}(),function(){var a,b,c,d,e,f,g,h=zmail.Core.Namespaces,i=h.get("zmail.dndComp"),j=!1,k=!1,l={containerDiv:"containerDiv",leftTop:"leftTop",leftBottom:"leftBottom",rightTop:"rightTop",rightBottom:"rightBottom",right:"right",left:"left",top:"top",bottom:"bottom"},m=function(){function h(){babelHelpers.classCallCheck(this,h);var a=this;a.element=null,a.active=!1,a.maxHeight=null,a.minHeight=null,a.minWidth=null,a.maxWidth=null,a.resizePositions={}}return babelHelpers.createClass(h,[{key:"init",value:function(a,b){var c=this;c.element=a,c.resizePositions=b.resizePositions,c.maxHeight=b.maxHeight,c.minHeight=b.minHeight||20,c.maxWidth=b.maxWidth,c.minWidth=b.minWidth||20,c.enable()}},{key:"enable",value:function(){var a=this;a.bindEvents(),a.enable=!0}},{key:"bindEvents",value:function(){var a=this;a.element.addEventListener("mousemove",a.handleMouseMove.bind(a),!1),a.element.addEventListener("mouseleave",a.handleMouseOut.bind(a),!1)}},{key:"handleMouseMove",value:function(a){var b=this;j||b.setResizerPosition(a),j=!0}},{key:"handleMouseOut",value:function(a){var b=this;j=!1,k||(b.removeDoms(),b.removeDropListeners())}},{key:"setResizerPosition",value:function(a){var b=this,c=b.element.getBoundingClientRect();b.containerDiv=zdom("div",null),b.containerDiv.id=l.containerDiv,b.containerDiv.className="zmResizeEle",b.leftTop=zdom("div",null),b.leftTop.id=l.leftTop,b.leftTop.className="zmResizeIcon zmResize-tl",b.leftBottom=zdom("div",null),b.leftBottom.id=l.leftBottom,b.leftBottom.className="zmResizeIcon zmResize-bl",b.rightBottom=zdom("div",null),b.rightBottom.id=l.rightBottom,b.rightBottom.className="zmResizeIcon zmResize-br",b.rightTop=zdom("div",null),b.rightTop.id=l.rightTop,b.rightTop.className="zmResizeIcon zmResize-tr",b.top=zdom("div",null),b.top.id=l.top,b.left=zdom("div",null),b.left.id=l.left,b.right=zdom("div",null),b.right.id=l.right,b.bottom=zdom("div",null),b.bottom.id=l.bottom,b.setCss(b.containerDiv,{top:"0px"}),b.setCss(b.leftTop,{top:"0px"}),b.setCss(b.top,{position:"absolute",top:"0px",width:c.width+"px"}),b.setCss(b.bottom,{left:"0px",position:"absolute",top:c.height-15+"px",width:c.width+"px"}),b.setCss(b.leftBottom,{left:"0px",top:c.height-15+"px"}),b.setCss(b.rightBottom,{top:c.height-15+"px",left:c.width-15+"px"}),b.setCss(b.right,{top:c.height-15+"px",left:c.width-15+"px",position:"absolute",height:b.height+"px"}),b.setCss(b.rightTop,{top:"0px",left:c.width-15+"px"}),b.setCss(b.left,{position:"absolute",top:"0px",left:"0px",height:b.height+"px"}),b.setDropListener()}},{key:"setCss",value:function(a,b,c){var d=this,e=Object.keys(b);e.forEach(function(c){a.style[c]=b[c]}),d.element.appendChild(a),d.setDragListener(a,c)}},{key:"setDragListener",value:function(a,b){var c=this;e=new zmail.dndComp.Drag,e.init(a,{onDragStart:c.dragStart.bind(c),onDragEnd:c.dragEnd.bind(c)})}},{key:"setDropListener",value:function(){var a=this;a.removeDropListeners(),f=new zmail.dndComp.Drop,f.init(document.body,{onDragOver:a.dragOver.bind(a),onDragOverDetails:a.dragOverDetails.bind(a),onDrop:a.onDrop.bind(a)})}},{key:"dragStart",value:function(e,f){var h=this;return a=h.element.offsetHeight,b=h.element.offsetWidth,d=f.clientY,c=f.clientX,g=e,k=!0,h.containerDiv.style.border="1px solid",setTimeout(function(){h.leftTop.style.visibility="hidden",h.leftBottom.style.visibility="hidden",h.rightTop.style.visibility="hidden",h.rightBottom.style.visibility="hidden"},0),{allowDrag:!0,ghostImage:!0,type:"type",id:"resize"}}},{key:"dragEnd",value:function(){var a=this;a.removeDoms()}},{key:"removeDoms",value:function(){var a=this,b=Object.keys(l);b.forEach(function(a){var b=document.getElementById(a);b&&b.parentElement.removeChild(b)}),a.element.style.width=a.containerDiv.style.width,a.element.style.height=a.containerDiv.style.height,j=!1,k=!1,delete a.rightTop,delete a.rightBottom,delete a.right,delete a.left,delete a.leftTop,delete a.leftBottom,delete a.top,delete a.bottom}},{key:"dragOver",value:function(){return{allowDragOver:!0}}},{key:"dragOverDetails",value:function(e,f){var h,i,j=this,k=j.element.getBoundingClientRect();f.clientX<c?g.id===l.rightTop||g.id===l.rightBottom?(i=b-(c-f.clientX),i>=j.minWidth&&(j.containerDiv.style.width=i+"px")):(i=b+(c-f.clientX),i>=j.minWidth&&(j.containerDiv.style.width=i+"px",j.containerDiv.style.left=k.left-f.clientX+"px")):f.clientX>c&&(g.id===l.leftTop||g.id===l.leftBottom?(i=b-(f.clientX-c),i>=j.minWidth&&(j.containerDiv.style.width=i+"px",j.containerDiv.style.left=f.clientX-k.left+"px")):(i=b+(f.clientX-c),i>=j.maxWidth&&(j.containerDiv.style.width=i+"px"))),f.clientY>d?g.id===l.leftTop||g.id===l.rightTop?(h=a-(f.clientY-d),h>=j.maxHeight&&(j.containerDiv.style.height=h+"px",j.containerDiv.style.top=f.clientY-k.top+"px")):(h=a+(f.clientY-d),h>j.maxHeight&&(j.containerDiv.style.height=h+"px")):f.clientY<d&&(g.id===l.leftTop||g.id===l.rightTop?(h=a+(d-f.clientY),h>=j.maxHeight&&(j.containerDiv.style.height=h+"px",j.containerDiv.style.top=k.top-f.clientY+"px")):(h=a-(d-f.clientY),h>=j.maxHeight&&(j.containerDiv.style.height=h+"px")))}},{key:"onDrop",value:function(){var a=this;a.removeDoms(),a.removeDropListeners()}},{key:"removeDropListeners",value:function(){f&&(f.destroy(),f=void 0)}}]),h}();i.Resizeable=m}(),function(){var a=zmail.Core.Namespaces,b=a.get("zmail.dndComp"),c=function(){function a(){babelHelpers.classCallCheck(this,a);var b=this;b.element=null,b.sortableIdentifier=null,b.afterSortable=null,b.onDragStart=null,b.oneDragOverDetails=null,b.onDragEnd=null,b.active=!1,b.onDragOver=null,b.dropComplete=null,b.draggedNode=null,b.sortableDragOverDetails=null,b.placeHolderRefPos=0,b.sortType="vertical",b.sortDragStart=null,b.onSortDragEnd=null,b.isPlaceHolderHide=!1,b.getDragInstance=null,b.placeHolderId="sortablePlaceholder"}return babelHelpers.createClass(a,[{key:"init",value:function(a,b){var c=this;c.element=a,c.sortableIdentifier=b.sortableIdentifier,c.afterSortable=b.afterSortable,c.onDragStart=c.dragStart,c.oneDragOverDetails=c.dragOver,c.onDragEnd=c.dragEnd,c.dropComplete=b.onDrop,c.placeHolderRef=b.placeHolderRef,c.onDropOver=b.onDropOver,c.sortType=b.sortType,c.sortDragStart=b.sortDragStart,c.onSortDragEnd=b.onSortDragEnd,c.isPlaceHolderHide=b.isPlaceHolderHide||!1,c.sortableDragOverDetails=b.sortableDragOverDetails,c.getDragInstance=b.getDragInstance,c.enable()}},{key:"enable",value:function(){var a=this,b=new zmail.dndComp.dragSourceSibling;b.init(a.element,{onDragStart:a.onDragStart.bind(a),setDragInstance:a.setDragInstance.bind(a),onDragEnd:a.dragEnd.bind(a)});var c=new zmail.dndComp.Drop;"vertical"===a.sortType?c.init(a.element,{onDragOver:a.dragover.bind(a),onDragOverDetails:a.dragoverDetailsVertical.bind(a),onDrop:a.onDrop.bind(a)}):c.init(a.element,{onDragOver:a.dragover.bind(a),onDragOverDetails:a.dragoverDetailsHorizontal.bind(a),onDrop:a.onDrop.bind(a)}),a.active=!0}},{key:"dragoverDetailsVertical",value:function(a,b,c){var d,e=this;return"Sortable"===a.id&&("function"==typeof e.sortableDragOverDetails&&e.sortableDragOverDetails(a,b,c),(!$(b.target).closest("."+e.sortableIdentifier)[0]||(d=$(b.target).closest("."+e.sortableIdentifier),e.draggedNode[0]!==d[0]))&&void("undefined"!=typeof d&&d&&d!==e.draggedNode[0]&&(e.draggedNode[0].getBoundingClientRect().top<b.clientY?e.placeHolderRefPos!==$(d).prevAll().length+1&&($(e.placeHolderRef).insertAfter(d),e.placeHolderRefPos=$(e.placeHolderRef).prevAll().length,$(d).insertBefore(e.draggedNode),e.afterSortable&&e.afterSortable(d[0],e.draggedNode[0])):e.placeHolderRefPos!==$(d).prevAll().length-1&&($(e.placeHolderRef).insertBefore(d),$(d).insertAfter(e.draggedNode),e.placeHolderRefPos=$(e.placeHolderRef).prevAll().length,e.afterSortable&&e.afterSortable(e.draggedNode[0],d[0])))))}},{key:"dragoverDetailsHorizontal",value:function(a,b,c){var d,e=this;return"Sortable"===a.id&&(e.sortableDragOverDetails(a,b,c),(!$(b.target).closest("."+e.sortableIdentifier)[0]||(d=$(b.target).closest("."+e.sortableIdentifier),e.draggedNode[0]!==d[0]))&&void("undefined"!=typeof d&&d&&d!==e.draggedNode[0]&&(e.draggedNode[0].getBoundingClientRect().left<b.clientX?e.placeHolderRefPos!==$(d).prevAll().length+1&&($(e.placeHolderRef).insertAfter(d),e.placeHolderRefPos=$(e.placeHolderRef).prevAll().length,$(e.draggedNode).insertBefore(e.placeHolderRef),e.afterSortable&&e.afterSortable(d[0],e.draggedNode[0])):e.placeHolderRefPos!==$(d).prevAll().length-1&&($(e.placeHolderRef).insertBefore(d),$(e.draggedNode).insertAfter(e.placeHolderRef),e.placeHolderRefPos=$(e.placeHolderRef).prevAll().length,e.afterSortable&&e.afterSortable(e.draggedNode[0],d[0])))))}},{key:"setDragInstance",value:function(a){var b=this;if("function"==typeof b.getDragInstance){var c=b.getDragInstance(a);return c.allowDrag?{setDrag:!0,element:$(a.target).closest("."+b.sortableIdentifier)[0]}:{setDrag:!1}}return{setDrag:!0,element:$(a.target).closest("."+b.sortableIdentifier)[0]}}},{key:"dragover",value:function(){return{allowDragOver:!0}}},{key:"dragEnd",value:function(){var a=this;"undefined"!=typeof a.draggedNode[0]&&a.draggedNode[0].style.removeProperty("visibility"),$("#"+a.placeHolderId).remove(),"function"==typeof a.onSortDragEnd&&a.onSortDragEnd()}},{key:"onDrop",value:function(){var a=this;a.draggedNode&&a.draggedNode[0].style.removeProperty("visibility"),a.onDropOver&&a.onDropOver(),$("#"+a.placeHolderId).remove()}},{key:"dragStart",value:function(a){var b=this;"function"==typeof b.sortDragStart&&b.sortDragStart(a);var c=b.sortableIdentifier.split(" ")[0],d=$(a).closest("."+c);if(b.draggedNode=d,!b.placeHolderRef){var e=d[0].nodeName;b.placeHolderRef=document.createElement(e)}return b.placeHolderRef.id=b.placeHolderId,b.isPlaceHolderHide&&(b.placeHolderRef.className="zmHideD"),b.element.querySelector(b.placeHolderId)||$(b.placeHolderRef).insertAfter(b.draggedNode),b.placeHolderRefPos=$(b.placeHolderRef).prevAll().length,setTimeout(function(){b.draggedNode[0].style.visibility="hidden"},0),{disableGhostImage:!0,allowDrag:!0,ghostImage:!0,type:"type",id:"Sortable"}}}]),a}();b.SortableDND=c}();
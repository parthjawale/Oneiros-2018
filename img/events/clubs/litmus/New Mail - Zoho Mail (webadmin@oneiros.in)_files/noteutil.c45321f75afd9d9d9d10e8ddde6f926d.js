"use strict";!function(){window.zNote=window.zNote||{},zNote.CONSTANTS=zNote.CONSTANTS||{},zNote.CONSTANTS.entityType="2",zNote.CONSTANTS.actionType={addEntity:"addEntity"},zNote.CONSTANTS.dimensions={stickywidth:"276",stickyheight:"60"},zNote.CONSTANTS.COLOR={zn_clr1:"0",zn_clr2:"1",zn_clr3:"2",zn_clr4:"3"},zNote.CONSTANTS.MAXCHARACTER={TITLE:100},zNote.CONSTANTS.COLORCODE={0:"zn_clr1",1:"zn_clr2",2:"zn_clr3",3:"zn_clr4"},zNote.CONSTANTS.actionType={self:"viewSelfData",group:"viewGroupEntity"},zNote.CONSTANTS.COLORNAME={0:"Blue",1:"Green",2:"Yellow",3:"Red"},zNote.CONSTANTS.viewType={grid:1,list:2},zNote.CONSTANTS.viewName={1:"grid",2:"list"},zNote.CONSTANTS.NOTECOLOR=[{value:"0",dispname:"Blue"},{value:"1",dispname:"Green"},{value:"2",dispname:"Yellow"},{value:"3",dispname:"Red"}],zNote.CONSTANTS.listTypeClass={1:"msi-thumbview",2:"msi-listview"},zNote.CONSTANTS.hashUrl={},zNote.CONSTANTS.hashUrl.type={c:"group",l:"tags",fav:"views",sharedtome:"views"},zNote.CONSTANTS.hashUrl.typeCode={group:"c",tags:"l",favourites:"views",sharedtome:"views"},zNote.CONSTANTS.hashUrl.folId={fav:"favourites",sharedtome:"sharedtome"},zNote.CONSTANTS.hashUrl.folIdCode={favourites:"fav",sharedtome:"sharedtome"},zNote.CONSTANTS.errorCode={pagination_error:"PAGINATION_ERROR"}}(),window.zNote=window.zNote||{},window.zNote.templates=function(){var a=zNote.templates||{};return zNote.notei18n=zNote.notei18n||zmText.get("noteutil"),a.getDisabledMsg=function(a){return zdom("div",{className:"SC_simg js-spam-trash-band zmWarnMsg",id:"znDisabledGrp"},zdom("span",null,a.disabledMsg))},a.scrollPaginationDiv=function(a){return zdom("div",{id:"pgdiv",style:a.style})},a.copyNote=function(a){var b="readonly";return zdom("div",{className:"zm_formArea zm_postNew"},zdom("div",{className:"zm_formFld"},zdom("div",{className:"zm_formCell"},zdom("label",null,zNote.notei18n.common.notetitle),zdom("input",{placeholder:zNote.notei18n.placeholder.title,id:"zcpTitle",className:"SC_tiput"}))),zdom("div",{className:"zm_formFld zm_formDC"},zdom("div",{className:"zm_formCell"},zdom("label",null,zNote.notei18n.common.group),zdom("input",{placeholder:zNote.notei18n.note.selectGroup,id:"zncpGroup",className:"SC_tiput",readOnly:b})),zdom("div",{className:"zm_formCell"},zdom("label",null,zNote.notei18n.common.book),zdom("input",{placeholder:zNote.notei18n.note.selectBook,id:"zncpBook",className:"SC_tiput",readOnly:b}))),zdom("div",{className:"zm_formLne"},zdom("div",{className:"SC_lne"})),zdom("div",{className:"zm_formFld"},zdom("div",{className:"zm_formCell"},zdom("i",{id:"attIn",className:a.checkBoxClass}),zdom("span",null,zNote.notei18n.includeComments))))},a.linkEl=function(a){return zdom("span",{id:"ngoto",className:"zn_lnkBar",style:a.style},zdom("a",{id:"nlink",rel:"noreferrer noopener",target:"_blank",href:a.href},zNote.notei18n.golink))},a.permaLink=function(a){return zdom("a",{href:a.href,className:"dateTime"},a.linkText," ")},a.noteViewMask=function(){var a={pointerEvents:"auto",opacity:0,transform:"scale(0.3)"};return zdom("div",{id:"nmask",className:"SC_Pop tra SC_cent",style:a},zdom("div",{className:"SCmb puClose nPuClose"},zdom("ul",null,zdom("li",{id:"npopin",title:zNote.notei18n.note.openTab},zdom("b",null,zdom("span",{className:"SC_ttip ttr"},zdom("i",{className:"msi-popTab"})))),zdom("li",{id:"nclose"},zdom("b",null,zdom("span",{className:"SC_ttip ttr"},zdom("i",{className:"msi-close"})))))),zdom("div",{className:"SC_pe"},zdom("div",{className:"SC_peCen",id:"noteBox"})))},a}(),define([],function(){var a=zmail.Core.Namespaces,b=a.get("zmail.DataLayer");zNote.Models=zNote.Models||{};var c=b.Adapter.HTTPAdapter;zNote.Adapter=zNote.Adapter||{};var d=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"getUrl",value:function(){return zmail.conPath+"/NotesAction.do"}},{key:"getAttributesFromModel",value:function(a){return zNote.Models.previewNote&&a instanceof zNote.Models.previewNote?{id:a.get("notes").id,namespaceId:a.get("gnrl").group.id}:zNote.Models.Note&&a instanceof zNote.Models.Note?{id:a.get("id"),namespaceId:a.get("namespaceId")}:zNote.Models.addNote&&a instanceof zNote.Models.addNote?{id:a.get("id"),namespaceId:a.get("namespaceId")}:void 0}},{key:"getDefaultRequestMethods",value:function(){return{create:"POST",update:"POST",patch:"POST","delete":"POST",read:"GET"}}},{key:"serialize",value:function(a,b,c){var d,e=this.getAttributesFromModel(b);if("delete"===a)d={entityId:e.id,mode:"delNote",groupId:e.namespaceId,streamsView:"Notes",actionType:"delEntity",entityType:zNote.CONSTANTS.entityType};else if("update"===a){var f=c.attrs,g=c.param;d={mode:g.mode,entityId:e.id,groupId:e.namespaceId},f.color&&(d.color=f.color,d.streamsView="Notes",d.actionType=g.actionType,d.entityType="2"),f.title&&(d.title=f.title,d.streamsView="Notes",d.actionType=g.actionType,d.entityType="2"),void 0!==f.starred&&(d.starred=f.starred,d.streamsView="Notes",d.actionType=g.actionType,d.entityType="2"),f.catId&&(d.catId=f.catId,d.streamsView="Notes",d.actionType=g.actionType,d.entityType="2"),(f.toNamespace||g.toNamespace)&&(d.toNamespace=f.toNamespace||g.toNamespace,d.streamsView="Notes",d.actionType=g.actionType,d.entityType="2",void 0!==g.deleteOriginal&&(d.deleteOriginal=g.deleteOriginal),void 0!==g.commentsNeeded&&(d.commentsNeeded=g.commentsNeeded),g.catId&&(d.catId=g.catId),g.title&&(d.title=g.title)),g&&g.desc&&(d.desc=g.desc,d.streamsView="Notes",d.actionType=g.actionType,d.entityType="2"),(f.attEntObj||f.attachname&&f.attachname.length)&&(f.attEntObj&&(d.attEntObj=JSON.stringify(f.attEntObj)),f.attachname.length&&(d.attachname=f.attachname,d.attachstore=f.attachstore),d.streamsView="Notes",d.actionType=g.actionType,d.entityType="2"),f.attachId&&(d.attachId=f.attachId,d.streamsView="Notes",d.actionType=g.actionType,d.entityType="2")}else if("fetchNotes"===a){var h=c.param;d=h}else if("fetchNoteDetails"===a){var i=c.param;d=i}else if("updateTag"===a){var j=c.param,k=j.mode;d={mode:k,tagId:j.tagId,entityId:e.id,groupId:e.namespaceId,streamsView:"Notes",actionType:j.actionType,entityType:"2"}}else if("add"===a){var l=c.param;d={mode:l.mode,groupId:l.groupId,entityType:zNote.CONSTANTS.entityType,streamsView:"Notes",actionType:l.actionType,catId:l.catId,title:l.title,color:l.color},l.desc&&(d.desc=l.desc),l.richTextSummary&&(d.richTextSummary=l.richTextSummary),l.senderid&&(d.senderid=l.senderid),l.accid&&(d.accid=l.accid),l.actionSrc&&(d.actionSrc=l.actionSrc),l.msgid&&(d.msgid=l.msgid),l.attachname&&l.attachname.length&&l.attachname&&l.attachname.length&&(d.attachname=l.attachname,d.attachstore=l.attachstore),l.attEntObj&&(d.attEntObj=l.attEntObj)}return d}},{key:"normalize",value:function(a,b,c){if("create"===a){var d={};return b.errorCode?{error:!0}:d=b.note.data}return"update"===a&&"success"!==b[0].response?{error:!0}:{}}}]),b}(c);return zNote.Adapter.HTTPAdapter=d,d}),define([],function(){return zNote.Models=zNote.Models||{},zNote.noteListDL=function(a,b,c,d,e){var f=zNote.Collections.Note,g=zNote.Adapter.HTTPAdapter,h=zNote.Adapter.NoteIndexDBAdapter,i={adapters:[{id:"http-adapter",type:"default",classObj:g},{id:"indexDB",type:"offline",classObj:h}],"default":"http-adapter"},j=c.type||"note",k=ZMStore.getInstance(j);return k?k.reset():k=ZMStore.createInstance(j,f,{adapterConfig:i,offlineEnabled:zmail.isOfflineEnabled}),k.initialize(b,c,d),k.add(a[0].Notes),k},zNote.createEmptyNoteCollection=function(){var a=zNote.Collections.Note,b=zNote.Adapter.HTTPAdapter,c={adapters:[{id:"http-adapter",type:"default",classObj:b},{id:"indexDB",type:"offline",classObj:zNote.Adapter.NoteIndexDBAdapter}],"default":"http-adapter"},d="tempnote",e=ZMStore.getInstance(d);return e?e.reset():e=ZMStore.createInstance(d,a,{adapterConfig:c,offlineEnabled:zmail.isOfflineEnabled}),e},zNote.stickyCollection=function(a,b){var c=zNote.Collections.Note,d=zNote.Adapter.HTTPAdapter,e={adapters:[{id:"http-adapter",type:"default",classObj:d}],"default":"http-adapter"},f=b.type||"stickynote",g=ZMStore.getInstance(f);return g||(g=ZMStore.createInstance(f,c,{adapterConfig:e,offlineEnabled:zmail.isOfflineEnabled})),g.initialize(void 0,{mode:b.mode}),g.add(a),g},zNote.addNoteDS=function(a){var b=zNote.Collections.addNote,c=zNote.Adapter.HTTPAdapter,d={adapters:[{id:"http-adapter",type:"default",classObj:c}],"default":"http-adapter"},e=ZMStore.getInstance("addNote");return e||(e=ZMStore.createInstance("addNote",b,{adapterConfig:d,offlineEnabled:zmail.isOfflineEnabled})),e.add(a),e},zNote.previewNoteDS=function(a){var b=zNote.Collections.previewNote,c=zNote.Adapter.HTTPAdapter,d={adapters:[{id:"http-adapter",type:"default",classObj:c}],"default":"http-adapter"},e=ZMStore.getInstance("previewNote");e||(e=ZMStore.createInstance("previewNote",b,{adapterConfig:d,offlineEnabled:zmail.isOfflineEnabled}));var f;return f=e.get(a.id),f?(f.set(a),0===f.view&&f.initialize()):(f=new zNote.Models.previewNote({attrs:a}),e.add(f)),f},zNote.getCreateCollectionInstance=function(a){var b=zNote.Collections.previewNote,c=zNote.Adapter.HTTPAdapter,d={adapters:[{id:"http-adapter",type:"default",classObj:c},{id:"indexDB",type:"offline",classObj:zNote.Adapter.NoteIndexDBAdapter}],"default":"http-adapter"},e=ZMStore.getInstance(a);return e||(e=ZMStore.createInstance(a,b,{adapterConfig:d,offlineEnabled:zmail.isOfflineEnabled})),e},zNote.getCollectionInstance=function(a){return ZMStore.getInstance(a)},zNote.checkAndRemoveFromDS=function(a,b){var c=ZMStore.getInstance(b);if(c){var d=c.get(a);d&&c.remove(d)}},{}}),function(){window.zNote=window.zNote||{},zNote.Models={},zNote.Views={},zNote.Collections={},zNote.noteCollection={},zNote.eventBus=_.extend({},Backbone.Events),zNote.notei18n=zmText.get("noteutil"),zNote.dialog=void 0,zNote.prev_shortcut_scope=void 0,zNote.unSavedData={},zNote.catIdGen=[],zNote.catCacheObj={},zNote.groupObj={};var a=function(a){var b=_.pluck(a,"entityId"),c=_.pluck(a,"groupId"),d={id:b.join(","),groupId:c.join(",")};(b.length||c.length)&&znBox.getNoteListForGivenIds(d).done(function(b){zNote.loadNoteCategories().done(function(){b[1].forEach(function(b){var c=_.findWhere(a,{entityId:b.id});b.showStickyNote="open"===c.state,b.left=c.left,b.top=c.top,b.height=c.height,b.width=c.width,znBox.isElementOnScreen({top:b.top,left:b.left},{height:b.height,width:b.width})||(b.left=void 0,b.top=void 0),zNote.addAsStickyNote(b,"restore")})})})},b=function(){var b;$.subscribe("stickyNoteMod",function(){var a=zNote.stickyNoteCollection.toJSON().filter(function(a){return"new"!==a.type}),b=a.map(function(a){var b={entityId:a.id,groupId:a.namespaceId};b.state=a.showStickyNote===!0?"open":"minimize";var c={top:a.top,left:a.left},d={width:a.width,height:a.height};return b.top=parseInt(c.top),b.left=parseInt(c.left),b.width=parseInt(d.width),b.height=parseInt(d.height),b}),c=zmAdHocSettings.getNotes().listingType;zmAdHocSettings.setNotes({stickyNotes:b,listingType:c})}),$.subscribe("notes/Notification",function(a,c){zNote.stickyNoteCollection&&zNote.stickyNoteCollection.where({id:c.eid}).length&&(b="string"==typeof c.group||c.group instanceof String?$.parseJSON(c.group).id:c.group.id,znBox.getNoteListForGivenIds({id:c.eid,groupId:b}).done(function(a){a[1].forEach(function(a){$.publish("stickyNotes/EditNotified",[a])})}))}),$.subscribe("zmailReconnect",function(a,b){if(zNote.stickyNoteCollection&&zNote.stickyNoteCollection.length){zmUtil.debugLog("Reconnect called. Updating sticky notes");var c=zNote.stickyNoteCollection.pluck("id"),d=zNote.stickyNoteCollection.pluck("namespaceId");b={id:c.join(","),groupId:d.join(",")},znBox.getNoteListForGivenIds(b).done(function(a){a[1].forEach(function(a){$.publish("stickyNotes/EditNotified",[a])})})}}),$.subscribe("notes/wshandler",function(b,c){if(!zNote.stickyNoteCollection)return void zNote.restoreStickyNotes();for(var d=zmAdHocSettings.getNotes(),e=0;e<d.stickyNotes.length;e++){var f=zNote.stickyNoteCollection.findWhere({id:d.stickyNotes[e].entityId});if(f){var g="open"===d.stickyNotes[e].state;znBox.isElementOnScreen({top:d.stickyNotes[e].top,left:d.stickyNotes[e].left},{height:d.stickyNotes[e].height,width:d.stickyNotes[e].width})||(d.stickyNotes[e]=void 0,d.stickyNotes[e]=void 0),f.set({left:d.stickyNotes[e].left,top:d.stickyNotes[e].top,type:"restore",width:d.stickyNotes[e].width,height:d.stickyNotes[e].height,showStickyNote:g}),f.set("mod","true"),d.stickyNotes[e].added=!0}else d.stickyNotes[e].added=!1}var h=[];zNote.stickyNoteCollection.each(function(a,b,c){"true"===a.get("mod")?a.unset("mod",{silent:!0}):h.push(a)}),h.length&&(zNote.stickyNoteCollection.remove(h,{silent:!0}),zNote.stickyNoteCollection.trigger("remove"));var i=_.filter(d.stickyNotes,function(a){return a.added===!1});a(i)})};zNote.init=function(){$(zmail.win).mousedown(function(){$("#ngoto").remove()}),b(),zmComponent.notifier.addHandler("streams",function(a,b){b.data.etype===zNote.CONSTANTS.entityType&&"37"===b.data.ntype&&(zmUtil.debugLog("Notification for note edit. Updating stickyNotes"),$.publish("notes/Notification",[b.data]))})},zNote.getStickyNoteCollection=function(){return zNote.stickyNoteCollection instanceof zNote.Collections.Note?zNote.stickyNoteCollection:(zNote.stickyNoteCollection=new zNote.Collections.Note([]),zNote.stickyNoteCollection)};var c=function(){zNote.loadNoteCategories().done(function(){if(zNote.stickyNoteCollection&&zNote.stickyNoteCollection.findWhere({type:"new"})){var a=zNote.stickyNoteCollection.findWhere({type:"new"});zNote.eventBus.trigger("openStickyNote",{namespaceId:a.get("namespaceId"),id:a.get("id")})}else zNote.addAsStickyNote({namespaceId:zmail.zuid,showStickyNote:!0,color:_.random(0,3),desc:"",title:"",ownerZUID:zmail.zuid,id:String((new Date).getTime()),height:40,type:"new"},"new")})};zNote.checkForstickyNote=function(){var a=zNote.stickyNoteCollection.length;return $("#sNoteTab").find(".notes-count").find("span").text(a),0===zNote.stickyNoteCollection.length?($("#sNoteTab").find(".notes-count").find("span").html("<i class='msi-add SC_thm'></i>"),void $("#sNoteTab").attr("data-tooltip",zNote.notei18n.common.addStickyNote)):void(0===zNote.stickyNoteCollection.length&&($(".notes-count").remove(),$.publish("BOTTOM_ICONS_LIST_CHANGE"),zNote.dialog&&!zNote.dialog.isRemoved&&zNote.dialog.remove()))},zNote.isStickyNote=function(a){return!!(zNote.stickyNoteCollection&&zNote.stickyNoteCollection instanceof zNote.Collections.Note&&zNote.stickyNoteCollection.findWhere({id:a.id}))};var d=function(){var a;if(!zNote.dialog||zNote.dialog.isRemoved===!0){var b=function(){zNote.dialog.isRemoved||(ReactDOM.unmountComponentAtNode(zNote.dialog.$els.$content[0]),zNote.dialog.isRemoved=!0,zNote.dialog.remove())},d=function(b){a=b,null!==b&&a.handleStickyListSelection("initial")},e=function(b){"downArrow"===b?(zNote.dialog.$els.$content.find(".zmSLst").removeClass("zmSLst"),a.handleStickyListSelection(b)):"upArrow"===b?(zNote.dialog.$els.$content.find(".zmSLst").removeClass("zmSLst"),a.handleStickyListSelection(b)):"enter"===b&&a.handleStickyListSelection(b)},f=new zNote.Collections.Note(zNote.stickyNoteCollection.toJSON(),(void 0),{mode:"stickyNote"}),g={title:zNote.notei18n.allStickyNotes,mask:"none",contentWrapperClass:"SC_PU ztb-notesPopover",maskWrapperClass:"SC_Pop",defaultCloseIcon:!1,icons:{right:[[{"class":"msi-popout",callback:function(a,b){zNote.stickyNoteCollection.forEach(function(a){a.showNote(!0,{silent:!0})}),a.$els.$rightHeader.find(".msi-popout").closest("li").addClass("SC_dyn"),a.$els.$rightHeader.find(".msi-popin").closest("li").removeClass("SC_dyn"),$.publish("stickyNoteMod")}},{"class":"msi-popin",callback:function(a,b){zNote.stickyNoteCollection.forEach(function(a){a.showNote(!1,{silent:!0})}),a.$els.$rightHeader.find(".msi-popin").closest("li").addClass("SC_dyn"),a.$els.$rightHeader.find(".msi-popout").closest("li").removeClass("SC_dyn"),$.publish("stickyNoteMod")}}]]},closeAction:function(a){ReactDOM.unmountComponentAtNode(a.$els.$content[0]),zNote.dropKeyBoardShortcutsForStickyList(),a.isRemoved=!0},dialogDidMount:function(a){zNote.setKeyBoardShortcutsForStickyList(e);var b=$("#sNoteTab").find(".msi-stickyNote").offset().left,c=$("#sNoteTab").find(".msi-stickyNote").offset().top;ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{ref:d,noteList:f}),a.$els.$content[0]),a.$els.$rightHeader.find(".SCmb").addClass("puClose"),zmComponent.tooltip({elm:a.$els.$rightHeader.find(".msi-popout")[0],text:zNote.notei18n.tooltips.openallsticky,arrow:"top"}),zmComponent.tooltip({elm:a.$els.$rightHeader.find(".msi-popin")[0],text:zNote.notei18n.tooltips.minimizeallsticky,arrow:"top"}),a.$els.$rightHeader.find(".msi-add").length&&zmComponent.tooltip({elm:a.$els.$rightHeader.find(".msi-add")[0],text:zNote.notei18n.common.addStickyNote,arrow:"top"}),a.$els.$positionWrapper.css("position","absolute"),a.$els.$positionWrapper.css("right",$("body").width()-b+"px"),a.$els.$positionWrapper.css("bottom",$("body").height()-c+"px"),zNote.stickyNoteCollection&&zNote.stickyNoteCollection.where({showStickyNote:!1}).length?a.$els.$rightHeader.find(".msi-popin").closest("li").addClass("SC_dyn"):a.$els.$rightHeader.find(".msi-popout").closest("li").addClass("SC_dyn")}};$.publish("/mail/menuCreated",{menuHandler:b}),g.icons.right[0].push({"class":"msi-add",callback:function(a,b){a.remove(),c()}}),zNote.dialog=Dialog["new"](g)}},e=function(){zNote.stickyNoteCollection&&zNote.stickyNoteCollection.length?d():c()};zNote.addAsStickyNote=function(a,b){zmUtil.requireNotesModule("notelisting").done(function(){var c=a;c.type=b||"add",c.showStickyNote=void 0===c.showStickyNote||c.showStickyNote;var d=function(a,b){zNote.stickyNoteCollectionView=a};if(zNote.stickyNoteCollection&&zNote.stickyNoteCollection instanceof zNote.Collections.Note&&zNote.stickyNoteCollection.findWhere({id:c.id}))return void zNote.eventBus.trigger("openStickyNote",{namespaceId:c.namespaceId,id:c.id});if(zNote.stickyNoteCollection&&zNote.stickyNoteCollection instanceof zNote.Collections.Note)$.publish("/note/addstickynote",c);else{var f=$('<div id="stickyNote"></div>');$("body").append(f),zNote.stickyNoteCollection=new zNote.Collections.Note(c,(void 0),{mode:"stickyNote"});var g={stickyNote:!0};ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{ref:d,extraOptions:g,noteList:zNote.stickyNoteCollection}),f[0]),zNote.stickyNoteCollection.on("remove",zNote.checkForstickyNote),zNote.stickyNoteCollection.on("reset",zNote.checkForstickyNote)}var h=zNote.stickyNoteCollection.length;if(0===$(".notes-count").length){var i={customHTML:"<div class='notes-count'><span>"+h+"</span><i class='msi-stickyNote zmDoubleIcon'><i class='path'></i></i></div>",id:"stickyNote",callback:function(a,b){e()},title:zNote.notei18n.tooltips.stickyNotes,elementID:"sNoteTab",type:"stickynotes"};zmTopBar.addRHSCustomElements(i),$.publish("BOTTOM_ICONS_LIST_CHANGE")}else $("#sNoteTab").find(".notes-count").find("span").text(h),$("#sNoteTab").attr("data-tooltip",zNote.notei18n.tooltips.stickyNotes)})},zNote.handleNoteErrorCallback=function(a,b){zmUtil.requireStreamsApp().done(function(){a.pid=b.entityId,a.etype=zNote.CONSTANTS.entityType,a.gid=b.groupId;var c=zmStreamsApp.util.errorHandling(a),d={appname:c.title,title:zNote.notei18n.common.appName,appId:b.entityId,faqKey:"notes",data:{CNodes:"3"},appIcon:"msi-post",onDelete:function(){return!0}};zmsuite.setWorkSpace(d),zmsuite.renderCenter(),zmsuite.showWorkSpace(b.entityId),zmsuite.getCenter()[0].centerArr[2].$el.append(c.element)})},zNote.openNoteInTab=function(a,b){var c=[];if(zmsuite.isWorkspaceAvailable(a.id)&&!b)return void zmsuite.showWorkSpace(a.id);var d={},e=a.namespaceId===zmail.zuid?zNote.CONSTANTS.actionType.self:zNote.CONSTANTS.actionType.group;d.onerror=zNote.handleNoteErrorCallback;var f=$('<div class="SC_peCen" id="noteBox"></div>');zNote.getNoteDetails(a,d).done(function(b){if($.publish("zm/closeAllOpenDialog"),0!==b[0]){var d,g,h,i,j,k,l,m,n=b[1],o=function(){var b=zmsuite.createAppRouter();return b._hashKey="stream",b.initialize({hashKey:"stream",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),b.setParams(["tab",a.namespaceId,a.id,zNote.CONSTANTS.entityType,e]),b},p=o(),q=zNote.previewNoteDS(n),r=q.get("cntnt").title||q.get("cntnt").summary;r=znBox.spCharRep(r).slice(0,32);var s={appname:r,title:zNote.notei18n.common.appName,appId:q.get("notes").id,faqKey:"notes",data:{CNodes:"3"},appIcon:"msi-post",router:p,onDelete:function(){return g(),!0}};g=function(b){zmStreamsApp.util.detachAndRemove($(zmsuite.getCenter(a.id)[1].$el).find(".SC_ScrollY")).always(function(){ReactDOM.unmountComponentAtNode(f[0]),$.unsubscribe("/note/delete",h),$.unsubscribe("/note/groupChange",j),$.unsubscribe("/apps/tabSwitched",i)})},h=function(a,b,c){b===q.get("notes").id&&c===q.get("gnrl").group.id&&(ReactDOM.unmountComponentAtNode(f[0]),zmsuite.closeWorkspace(s.appId))},j=function(a,b){e=b.gnrl.group.id===zmail.zuid?zNote.CONSTANTS.actionType.self:zNote.CONSTANTS.actionType.group,p.setParams(["tab",b.gnrl.group.id,b.notes.id,zNote.CONSTANTS.entityType,e]),p.update(),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:d.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:b,hideContent:!0})})},i=function(){if(zmTab.currentTab===a.id&&k){var b=$(zmsuite.getCenter(a.id)[1].$el).innerHeight()-($(ReactDOM.findDOMNode(l.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(l.refs.desc.refs.content)).height());l.refs.desc.updateHeight({height:b})}},$(window).off("resize.notetab").on("resize.notetab",i),$.subscribe("/note/delete",h),$.subscribe("/note/groupChange",j),$.subscribe("/apps/tabSwitched",i),zmsuite.isWorkspaceAvailable(a.id)?zmsuite.resetWorkspace(a.id,s):zmsuite.setWorkSpace(s),zmsuite.renderCenter(),c.push("tab"),c.push(a.namespaceId),c.push(a.id),c.push(zNote.CONSTANTS.entityType),c.push(e),p.setParams(c),p.update(),notesRestore.saveTabState({appId:a.id,app:"n",appObj:{appId:a.id,appname:r,data:{},appIcon:"msi-post"},data:{appId:a.id,namespaceId:a.namespaceId,id:a.id}}),zmsuite.showWorkSpace(q.get("notes").id),$(zmsuite.getCenter(a.id)[1].$el).addClass("SC_pe"),$(zmsuite.getCenter(a.id)[1].$el).append(f),zmsuite.getCenter(a.id)[0].getNodes()[0].$el.hide(),zmsuite.getCenter(a.id)[0].getNodes()[0].$el.css("top",0);var t={previewCard:"true",tab:"true",disableShortcuts:"true"};t.componentUpdated=function(a,b){i()};var u=function(a){l=a};ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:t,ref:u,note:q}),f[0]),d=$('<div class=""><div class=""><div class="SC_ScrollY"></div></div></div>'),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:d.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:n,hideContent:!0,commentId:a.commentId})}),$(zmsuite.getCenter(a.id)[1].$el).addClass("shw SC_w100").removeClass("zmHideV"),m=$(zmsuite.getCenter(a.id)[1].$el).innerHeight(),ReactDOM.findDOMNode(l.refs.notebox).style.left="-4000px";var v=m-($(ReactDOM.findDOMNode(l.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(l.refs.desc.refs.content)).height());l.refs.desc.setContentHeight({height:v}),ReactDOM.findDOMNode(l.refs.notebox).style.left="0px",d.find(".SC_ScrollY").css("max-height",m),$(zmsuite.getCenter(a.id)[1].$el).find("#noteBox").append(d),k=!0}})},zNote.getContactDetails=function(a){var b=$.Deferred();return zmail.ContactBook.get({zuid:a.zuid}).done(function(a){b.resolve(a)}).fail(function(){b.reject()}),b.promise()},zNote.invokeNoteSearch=function(a){var b=[];zNote.getContactDetails({zuid:a.zuid}).done(function(c){b.push({className:"added by",value:c[0]}),b.push({className:"in group",value:zmail.ContactBook.getGroups(a.groupId)[0]}),zmail.Search.setContext(zmail.Search.Models.Contexts.noteSearchContext),zmail.Search.newSearch(b)})},zNote.listNotes=function(a,b,c,d){var e;if(b.isnew){var f=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId},c);e=ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{noteList:f}),c[0])}else d.props.noteList.add(a[0].Notes,{silent:!0}),d.props.noteList.options.page=a[0].page,d.forceUpdate(),e=d;return e},zNote.loadAndCategoryArray=function(a){var b=$.Deferred();return zNote.loadNoteCategories().done(function(){for(var c=[],d=0;d<zNote.catCacheObj[a].length;d++)c.push({id:zNote.catCacheObj[a][d].catId,display_text:zNote.catCacheObj[a][d].category,name:zNote.catCacheObj[a][d].category});b.resolve(c)}),b.promise()},zNote.openNoteInPreview=function(a,b){zNote.loadNoteCategories().done(function(){var c,d=b.appname?zmsuite.getCenter(b.appname):zmsuite.getCenter(),e=d[1].getNodes();e[1].$el.html(""),e[1].$el.empty();var f="",g=[];g.push({tooltip:zNote.notei18n.tooltips.moreOptions,iconClass:"msi-action",data:"action"}),b.hidePrevNextIcons&&(g.push({tooltip:"prev",iconClass:"msi-prev",data:"prev"}),g.push({tooltip:"next",iconClass:"msi-next",data:"next"})),g.push({tooltip:"close",iconClass:"msi-close",data:"close"});var h={text:f,rIcons:[g]};d[1].show(),e[0].push(h),d[1].headerObj.render(),e[0].setListener("click",function(c,f){if("action"===c||"msi-action"===c.action){var g=zmStreamsApp.util.getDropdownMenu(a.data.id,zNote.CONSTANTS.entityType);$(f).closest("b").addClass("SC_ddn");var h={par:$(f).closest("b")[0],list:g,dir:"top",align:"pright",spanClass:"SC_dd",defaultclass:!1,clk:function(a,b){a.fn()}};zmsuite.showMenu(h)}else"close"===c||"clsPrev"===c.action?(e[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(e[0].$el.find(".noteHeader")[0]),$.publish(zmStreamsApp.constants.removeNotificationPreview,d[1].$el),zmStreamsApp.util.closePreview()):"prev"===c||"msi-prev"===c.action?b.prevAvl&&(e[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(e[0].$el.find(".noteHeader")[0]),$.publish(zmStreamsApp.constants.removeNotificationPreview,d[1].$el),b.prev()):"next"!==c&&"msi-next"!==c.action||b.nxtAvl&&(e[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(e[0].$el.find(".noteHeader")[0]),$.publish(zmStreamsApp.constants.removeNotificationPreview,d[1].$el),b.next())});var i=a.data,j=$("<div class='SC_notePreview'></div>"),k=$("<div class='postMsg'></div>"),l=zNote.previewNoteDS(i),m=function(a){c=a};e[0].$el.append("<div class='noteHeader'></div>");var n={previewCard:"true",disableShortcuts:"true"};ReactDOM.render(React.createElement(zNote.Views.NoteHeaderPreview,{options:n,note:l}),e[0].$el.find(".noteHeader")[0]),e[1].$el.off("scroll").on("scroll",function(){znBox.hideMenu()}),b.prevAvl||$(e[0].$el).find(".msi-prev").parent().parent().addClass("SC_opy3"),b.nxtAvl||$(e[0].$el).find(".msi-next").parent().parent().addClass("SC_opy3"),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:j,viewPost:!0,fixedComment:!1,isPreview:!1,response:i,hideContent:!0}),j.find(".SCS_postHead").after(k),e[1].push(j[0]),ReactDOM.render(React.createElement(zNote.Views.NotePreview,{ref:m,options:n,note:l}),k[0]);var a=$(e[1].$el).innerHeight();c.refs.desc.setContentHeight({height:.6*a}),j.find(".SCS_postHead").addClass("SC_dyn"),d[1].$el.addClass("zn_pv")})})},zNote.listRowNotes=function(a,b,c,d){var e;b.isnew?1===b.noteView?(e=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId},c),ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{noteList:e,ref:d}),c[0])):(e=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId,source:"noteApp"},c),ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{noteList:e,ref:d}),c[0])):(b.currentObj.props.noteList.add(a[0].Notes,{silent:!0}),b.currentObj.props.noteList.options.page=a[0].page,b.currentObj.forceUpdate())},zNote.getNoteList=function(a,b,c,d){zmUtil.requireNotesModule("notelisting").done(function(){zNote.loadNoteCategories().done(function(){var e=new zNote.Collections.Note(a[0].Notes,b.options,b.listInfo);ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{noteList:e,ref:d}),c[0])})})},zNote.dropKeyBoardShortcuts=function(){zmComponent.keybindings.dropScope("notepopup"),zmComponent.keybindings.setScope(zNote.prev_shortcut_scope)},zNote.removeNoteFromView=function(a){var b=$.Deferred();ReactDOM.unmountComponentAtNode(a),b.resolve().promise()},zNote.removeNoteFromViewPreviewCard=function(a){a[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(a[0].$el.find(".noteHeader")[0]),a[1].$el.find(".postMsg").length&&ReactDOM.unmountComponentAtNode(a[1].$el.find(".postMsg")[0])},zNote.setKeyBoardShortcuts=function(a){zNote.prev_shortcut_scope=zmComponent.keybindings.getScope();var b={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){znBox.hideMenu(),a.esc()}]}],scope:"notepopup"};zmComponent.keybindings.registerAll(b),zmComponent.keybindings.setScope("notepopup")},zNote.dropKeyBoardShortcutsForStickyList=function(){zmComponent.keybindings.dropScope("stickylistpopup"),zmComponent.keybindings.setScope(zNote.prev_shortcut_scope)},zNote.setKeyBoardShortcutsForStickyList=function(a){zNote.prev_shortcut_scope=zmComponent.keybindings.getScope();var b={allowDefaultScope:!1,shortcuts:[{uid:"moveDown",keyStr:"downArrow",actions:[function(){a("downArrow")}]},{uid:"moveUp",keyStr:"upArrow",actions:[function(){a("upArrow")}]},{uid:"showsticky",keyStr:"enter",actions:[function(){a("enter")}]}],scope:"stickylistpopup"};zmComponent.keybindings.registerAll(b),zmComponent.keybindings.setScope("stickylistpopup")},zNote.loadNoteCategories=function(){var a=$.Deferred();return $.isEmptyObject(zNote.catCacheObj)?(zNote.groupObj=zmCont.getGroup(),zNote.groupObj[zmail.zuid]={name:zmText.get("notes").myNotes},znBox.getCat().done(function(b){zNote.catCacheObj[zmail.zuid]=b[1][0].Category,zNote.myNotesCount=b[1][0].noteCount,znBox.getGroupCat().done(function(b){znBox.setGrpCat(b[1]),a.resolve()}).fail(function(){a.resolve()})}).fail(function(){a.reject()}),a.promise()):a.resolve()},zNote.openNote=function(a,b){var c=a.noteData,d=a.previewCard,e=zNote.previewNoteDS(c);if(d===!0){b&&$(b).find(".postMsg").length&&zNote.removeNoteFromView($(b).find(".postMsg")[0]),b.html("");var f=$("<div class='SC_notePreview'></div>"),g=$("<div class='postMsg'></div>"),h={previewCard:"true",disableShortcuts:"true"};zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:f,viewPost:!0,fixedComment:!1,isPreview:!1,response:c,hideContent:!0}),f.find(".SCS_postHead").after(g),b.append(f),ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:h,note:e}),g[0])})}else ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:e}),b[0])},zNote.getNoteDetails=function(a,b){b=b||{};var c={mode:"singlePost",actionType:"viewGroupEntity",groupId:a.namespaceId,entityId:a.id,entityType:zNote.CONSTANTS.entityType,allComments:!0,streamsView:!0},d={groupId:a.namespaceId,entityId:a.id};return zmAjq.XHR({u:zmail.conPath+"/stream.do",t:"POST",p:c,ep:d,onerror:b.onerror})},zNote.printNote=function(a){zNote.getNoteDetails(a).done(function(a){var b=a[1],c=$("<div id=noteBox></div>"),d=zNote.previewNoteDS(b),e={print:!0};ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:e,note:d}),c[0]);var f=$("<div class=SCS_prnCmnt></div>"),g=b.act.likedby?_.toArray(b.act.likedby.split(", ")):[],h={by:b.gnrl.by,id:b.notes.id,etype:zNote.CONSTANTS.entityType,groupId:b.gnrl.group.id,showinvite:b.myact.showinvite,like:b.myact.like,invitee:parseInt(b.act.invitees),likes:parseInt(b.act.likes),inviteeList:b.myact.inviteeList,lockInvites:b.gnrl.lockInvites,likeList:g,isPrint:!0};b.gnrl.group.isGroup?h.actionType="viewGroupEntity":h.actionType="viewSelfData",zmUtil.requireStreamsApp().done(function(){f.append(zmStreamsApp.PostActions.init(h))});var i=_.size(b.myact.inviteeList)?b.myact.inviteeList:[],j={comments:b.cmnt,id:b.notes.id,isShare:!1,
fixedComment:!1,groupId:b.gnrl.group.id,etype:zNote.CONSTANTS.entityType,owner:b.gnrl.by,inviteeList:i};zmUtil.requireStreamsApp().done(function(){j.mentions=zmStreamsApp.util.getMentionList(b),f.append(zmStreamsApp.CommentModule.init(j))});var k=$("<div id=printnote class=SC_prntNotes></div>");zmUtil.requireStreamsApp().done(function(){var a=zmStreamsApp.PostApp.singlePost({viewPost:!0,fixedComment:!1,isPreview:!1,response:b,hideContent:!0,isPrint:!0});k.append(a),k.append(c),k.append(f);var e=function(){var a=k[0].cloneNode(!0);zmail.Printer.print({title:d.get("cntnt").title,content:a,css:["streams.css",zmail.isProduction?"noteutil.css":"notes.css"]}),setTimeout(function(){ReactDOM.unmountComponentAtNode(c[0]),k.remove()},1e3)};e()})})},zNote.viewNote=function(a){var b,c,d,e,f,g,h,i=this;zNote.getNoteDetails(a).done(function(j){if(0===j[0])return void $.publish("zm/framework/dialogClosed");var k=j[1],l=$(zNote.templates.noteViewMask());$("body").append(l);var m=$(l).innerHeight()-50,n=$(l).innerWidth()-50,o=function r(){l.remove(),zNote.eventBus.off("removeMask",r,i),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts()};g=function(a,b){b===f.get("notes").id&&d()},h=function(){var a=m-($(ReactDOM.findDOMNode(e.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(e.refs.desc.refs.content)).height());e.refs.desc.updateHeight({height:a})},b=function(a,b){zmHash.setHash("notes",["preview",b.gnrl.group.id,b.notes.id]),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:c.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:b,hideContent:!0})})},d=function(){l.find(".SCS_post").hide(),l.find(".zn_popNote").removeClass("zn_popNote"),setTimeout(function(){zmStreamsApp.util.detachAndRemove(l.find(".SC_ScrollY")).always(function(){$.publish("zm/framework/dialogClosed"),ReactDOM.unmountComponentAtNode(l.find("#noteBox")[0]),l.remove(),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",o,i),$.unsubscribe("zm/closeAllOpenDialog",d),$.unsubscribe("/note/delete",g),$.unsubscribe("/note/groupChange",b),zmUtil.hideMenu()})})},f=zNote.previewNoteDS(k);var p={};p.componentUpdated=function(a,b){h()},e=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{removeNotePreview:d,note:f}),l.find("#noteBox")[0]),l.find("#npopin").on("click",function(){d(),$.publish("zm/closeAllOpenDialog"),zNote.openNoteInTab({namespaceId:a.namespaceId,id:a.id})}),l.find("#nclose").on("click",function(){d()}),$.subscribe("zm/closeAllOpenDialog",d),$.subscribe("/note/delete",g),$.subscribe("/note/groupChange",b),zNote.eventBus.on("removeMask",o,i),ReactDOM.findDOMNode(e.refs.notebox).style.left="-4000px",c=$('<div class=""><div class=""><div class="SC_ScrollY"></div></div></div>'),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:c.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:k,hideContent:!0})});var q=m-($(ReactDOM.findDOMNode(e.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(e.refs.desc.refs.content)).height());e.refs.desc.setContentHeight({height:q}),l.find(".SC_pe").css("max-height",m),l.find(".SC_pe").css("min-width",n-200),l.find(".SC_pe").css("max-width",n-200),ReactDOM.findDOMNode(e.refs.notebox).style.left="0px",c.find(".SC_ScrollY").css("max-height",m),l.find("#noteBox").append(c),l.css({"transform-origin":"center",transition:"transform 0.5s ease"}),l.css({transform:"scale(1)",opacity:1}),setTimeout(function(){l.removeClass("tra").addClass("blk")},300),zNote.setKeyBoardShortcuts({esc:d}),zmHash.setHash("notes",["preview",a.namespaceId,a.id])})},zNote.addNoteAutoSave=function(a){var b,c,d,e=this,f=$('<div id="nmask" class="SC_Pop tra SC_cent" style="pointer-events:auto"><div class="SCmb puClose nPuClose" id="nclose"><ul><li><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>'),g=$('<div id="colorMask" style="z-index:101" class="SC_Pop tra">');$("body").append(g),$("body").append(f);var h=$(f).innerHeight()-50,i=$(f).innerWidth()-50,j=_.random(0,3);a.notes.color=j;var k=zNote.previewNoteDS(a),l=function(){c&&(f.find(".SC_pe").animate({"min-width":i-550,"max-width":i-550},{always:function(){c.find(".SC_ScrollY").removeClass("SC_dyn")}}),$(ReactDOM.findDOMNode(d.refs.notebox)).animate({"margin-right":"0%"},{always:function(){f.find(c).remove()}}))},m=function(){var a=h-($(ReactDOM.findDOMNode(d.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(d.refs.desc.refs.content)).height());d.refs.desc.updateHeight({height:a})},n=function(a){c=$('<div><div><div class="SC_ScrollY"></div></div></div>'),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:c.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:a,hideContent:!0}),c.find(".SC_ScrollY").css("max-height",h),f.find("#noteBox").append(c),f.find(".SC_pe").animate({"min-width":i-200,"max-width":i-200},{always:function(){c.find(".SC_ScrollY").removeClass("SC_dyn")}}),$(ReactDOM.findDOMNode(d.refs.notebox)).animate({"margin-right":"35%"}),k.hideStream()})},o=function r(){f.remove(),g.remove(),zNote.eventBus.off("removeMask",r,e),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts(),$.unsubscribe("zm/closeAllOpenDialog",b)},p={};p.componentUpdated=function(a,b){m()},d=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:k,options:p,showStreamsBar:n,removeStreamsBar:l}),f.find("#noteBox")[0]),b=function(){g.removeClass("blk").addClass("tra"),f.find(".SCS_post").hide(),f.find(".zn_popNote").removeClass("zn_popNote"),setTimeout(function(){ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(d.refs.notebox)).parent()[0]),f.remove(),g.remove(),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",o,e),zmUtil.hideMenu(),$.unsubscribe("zm/closeAllOpenDialog",b)})},f.find("#nclose").on("click",function(){b()}),$.subscribe("zm/closeAllOpenDialog",b),zNote.eventBus.on("removeMask",o,e),ReactDOM.findDOMNode(d.refs.notebox).style.left="-4000px";var q=h-($(ReactDOM.findDOMNode(d.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(d.refs.desc.refs.content)).height());d.refs.desc.setContentHeight({height:q}),f.find(".SC_pe").css("max-height",h),f.find(".SC_pe").css("min-width",i-550),f.find(".SC_pe").css("max-width",i-550),ReactDOM.findDOMNode(d.refs.notebox).style.left="0px",ReactDOM.findDOMNode(d.refs.notebox).style.marginRight="0px",g.removeClass("tra").addClass("blk"),zNote.setKeyBoardShortcuts({esc:b})},zNote.loadAndOpenNote=function(a,b){zmUtil.requireNotesModule("notepreview").done(function(){zNote.loadNoteCategories().done(function(){b&&"tab"===b.type?zNote.openNoteInTab(a):b&&"preview"===b.type?zNote.openNoteInPreview(a,a.options):b&&"print"===b.type?zNote.printNote(a.data):zNote.viewNote(a)})})},zNote.getNewNote=function(a,b){var c=void 0!==a.color?a.color:_.random(0,3);zmCont.isGroup(a.namespaceId)||a.namespaceId===zmail.zuid||(a.namespaceId=zmail.zuid,a.catId=znBox.getGeneralCatId(a.namespaceId));var d=new zNote.Models.addNote({attrs:{addparams:a.addparams,desc:a.desc,title:a.title,namespaceId:a.namespaceId,catId:a.catId,attEntObj:a.attEntObj,color:c}});zNote.addNoteDS(d),ReactDOM.render(React.createElement(zNote.Views.addNoteViewReact,{ref:b.ref,options:{commentNote:b.commentNote},addCallback:a.addCallback,cancelCallback:a.cancelCallback,streams:b.streams,noAddCancel:b.noAddCancel,note:d}),b.mountingElem[0])},zNote.addNote=function(a,b){var c,d,e=$.extend(!0,{},a),f=$('<div id="nmask" class="SC_Pop fadeIn SC_cent"><div class="SCmb puClose" id="nclose"><ul><li><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>');$("body").append(f),d=function(a){if(b&&b.add&&b.cancel){f.find(".zn_popNote").removeClass("zn_popNote"),f.find(".SC_PUbtm").addClass("SC_dyn"),f.find(".SC_mkStky").addClass("SC_dyn");var e=$(ReactDOM.findDOMNode(c.refs.notebox)),g=e.offset(),h=e.width();e[0].style.bottom="auto",e[0].style.position="fixed",e[0].style.top=g.top+"px",e[0].style.left=g.left+"px",e[0].style.width=h+"px";var i="add"===a?"add":"cancel",j=b[i].top,k=b[i].left,l=b[i].width,m=b[i].height;$(ReactDOM.findDOMNode(c.refs.notebox)).animate({top:j+"px",left:k+"px",height:m,width:l},{complete:function(){ReactDOM.unmountComponentAtNode(f.find("#noteBox")[0]),$("#nmask").remove()},always:function(){zNote.eventBus.off("removeMask",d),zNote.dropKeyBoardShortcuts()}},{duration:500})}else ReactDOM.unmountComponentAtNode(f.find("#noteBox")[0]),$("#nmask").remove(),zNote.eventBus.off("removeMask",d),zNote.dropKeyBoardShortcuts()},e.addCallback=function(){a.addCallback&&a.addCallback(),d("add")},f.find("#nclose").on("click",function(){c.checkDataAlert(d)});var g=function(a){c=a};window.requestAnimationFrame(function(){f.addClass("blk")},100),zNote.getNewNote(e,{mountingElem:f.find("#noteBox"),ref:g}),zNote.eventBus.on("removeMask",d);var h=$(f).innerHeight(),i=$(f).innerWidth(),j=h-($(ReactDOM.findDOMNode(c.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(c.refs.content)).height());c.setContentHeight({height:.75*j}),$(c.refs.notebox).css("margin-right","0%"),f.find(".SC_pe").css("min-height",.5*h),f.find(".SC_pe").css("max-height",h),f.find(".SC_pe").css("min-width",.5*i),f.find(".SC_pe").css("max-width",.5*i),zNote.setKeyBoardShortcuts({esc:c.checkDataAlert.bind(c,d)})},zNote.getSelectedTextWithin=function(a){var b="";if("undefined"!=typeof window.getSelection){var c,d=window.getSelection();if((c=d.rangeCount)>0)for(var e,f=document.createRange(),g=0;g<c;++g)f.selectNodeContents(a),e=d.getRangeAt(g),1===e.compareBoundaryPoints(f.START_TO_END,f)&&e.compareBoundaryPoints(f.END_TO_START,f)===-1&&(1===e.compareBoundaryPoints(f.START_TO_START,f)&&f.setStart(e.startContainer,e.startOffset),e.compareBoundaryPoints(f.END_TO_END,f)===-1&&f.setEnd(e.endContainer,e.endOffset),b+=f.toString())}else if("undefined"!=typeof document.selection&&"Text"===document.selection.type){var h=document.selection.createRange(),i=h.duplicate();i.moveToElementText(a),1===h.compareEndPoints("EndToStart",i)&&h.compareEndPoints("StartToEnd",i)===-1&&(1===h.compareEndPoints("StartToStart",i)&&i.setEndPoint("StartToStart",h),h.compareEndPoints("EndToEnd",i)===-1&&i.setEndPoint("EndToEnd",h),b=i.text)}return b},zNote.loadAddNote=function(a,b){zmUtil.requireNotesModule("noteadd").done(function(){var c=a?a.addparams:void 0,d=a?a:{},e=d.groupId||zmail.zuid,f=d.attEntObj||[];b&&b.richText?znBox.convertImageToInlineImages(d.descHTML).done(function(a){zNote.loadNoteCategories().done(function(){b&&b.mountingElem?zNote.getNewNote({addparams:c,addCallback:d.addCallback,cancelCallback:d.cancelCallback,desc:a,title:d.title,namespaceId:e,attEntObj:f,catId:znBox.getGeneralCatId(e)},{mountingElem:b.mountingElem,commentNote:b.commentNote,noAddCancel:!0,ref:b.doneCallback}):zNote.addNote({addparams:c,desc:a,addCallback:d.addCallback,title:d.title,namespaceId:e,attEntObj:f,catId:znBox.getGeneralCatId(e)})})}):zNote.loadNoteCategories().done(function(){b&&b.mountingElem?zNote.getNewNote({addparams:c,addCallback:d.addCallback,cancelCallback:d.cancelCallback,desc:d.desc,title:d.title,namespaceId:e,attEntObj:f,catId:znBox.getGeneralCatId(e)},{mountingElem:b.mountingElem,noAddCancel:!0,commentNote:b.commentNote,streams:!0,ref:b.doneCallback}):zNote.addNote({addparams:c,desc:d.desc,addCallback:d.addCallback,title:d.title,namespaceId:e,attEntObj:f,catId:znBox.getGeneralCatId(e)})})})},zNote.addNoteValidations=function(a,b){var c=b||{};return a.title&&a.title.length>100?(_zm.succErrMsg("e",zNote.notei18n.titexceed),!0):a.desc&&a.desc.length>65e3?(_zm.succErrMsg("e",zNote.notei18n.contexceed),!0):c.allowEmpty||void 0===a.desc||0!==a.desc.trim().length?!c.allowEmpty&&void 0!==a.richTextSummary&&0===znBox.domParser(znBox.getContentEditableTextFromHTML(a.richTextSummary)).trim().length&&(_zm.succErrMsg("e",zNote.notei18n.descempty),!0):(_zm.succErrMsg("e",zNote.notei18n.descempty),!0)},zNote.convertStreamsFormatToNotes=function(a,b,c,d){var e=$.isArray(a[1])?a[1]:[a[1]];return zNote.listNotes(e,b,$(c),d)},zNote.getNoteDataInListFormat=function(a){var b={};b.id=a.notes.id,b.title=a.notes.title,b.cat=a.notes.catid,b.desc=a.notes.notecont,b.namespaceId=a.gnrl.group.id,b.starred=a.notes.starred,b.color=a.notes.color,b.summary=a.notes.desc,b.isRichText=a.notes.isRichText,b.ownerZUID=a.gnrl.by,b.email=$.extend(!0,{},a.notes.email),b.commentCount=a.cmnt.total,b.tagId=a.myact.label.slice(0),b.disptime=a.gnrl.cdate,b.starred=a.myact.starred,b.modified=a.gnrl.lastModifiedTime,b.attachments=[];for(var c=0;c<(a.notes.attachments&&a.notes.attachments.length);c++){var d=Object.keys(a.notes.attachments[c])[0],e=a.notes.attachments[c][d],f={};e.inline||(f[e.Id]={Id:e.Id,s:e.s,fn:e.fn,ft:e.ft,p:e.p},b.attachments.push(f))}return b},zNote.streamListNote=function(a,b){zmUtil.requireNotesModule("notepreview").done(function(){try{var c=zNote.previewNoteDS(a);ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:c,streamList:!0}),b[0])}catch(d){window.console.log(d)}})},zNote.getNoteSearchQuery=function(a){var b={};return b.start=0,b.limit=10,b.search=a.data[0].value,b.streamsView="Notes",b.mode="searchNotes",b.isPrev=!1,b.groupId=zmail.zuid,b.actionType="viewSelfData",b.entityType=2,b},zNote.updateLinks=function(a,b){var c=znBox.saveSelectionNew(a);b||$(a).html(zNote.linkify(znBox.domParser(znBox.getContentEditableText($(a)))).replace(/\n/g,"<br />")),znBox.restoreSelectionNew(a,c)},zNote.disable=function(a){var b=!0;if(a.ctrlKey||a.metaKey)switch(a.keyCode){case 66:case 98:b=!1;break;case 73:case 105:b=!1;break;case 85:case 117:b=!1}return b},zNote.linkify1=function(a){for(var b=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi,c=a.childNodes,d=0,e=c.length;d<e;d++){var f=c[d];if("A"===f.nodeName)zNote.linkify1(f.nextSibling);else if(f.nodeType===f.TEXT_NODE)for(var g=f.textContent.match(b);g;){var h=f.textContent.indexOf(g[0]),i=f.textContent.substring(0,h),j=document.createTextNode(i),k=document.createElement("a");k.href=g[0],k.innerText=g[0],f.textContent=f.textContent.substring(h+g[0].length),f.parentElement.insertBefore(j,f),f.parentElement.insertBefore(k,f),g=f.textContent.match(b)}else zNote.linkify1(f)}},zNote.linkify=function(a){if(a){var b,c;return c=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi,b=a.replace(c,function(a,b){return arguments[2]?arguments[0]:arguments[3]?'<a href="'+arguments[0]+'" target="_blank" rel="noopener noreferrer">'+arguments[0]+"</a>":'<a href="http://'+arguments[0]+'" target="_blank" rel="noopener noreferrer">'+arguments[0]+"</a>"})}return""},zNote.checkForPrintableKeys=function(a){return"undefined"==typeof a.which||(!(a.ctrlKey||a.metaKey||a.altKey||8===!a.which||13===!a.which)||void 0)},zNote.restoreStickyNotes=function(){if(!znBox.removeStickyIcon()){zNote.stickyNoteCollection&&zNote.stickyNoteCollection.reset();var a=zmAdHocSettings.getNotes();if(!a||!a.stickyNotes||!a.stickyNotes.length){var b={customHTML:"<div class='notes-count'><span><i class='msi-add SC_thm'></i></span><i class='msi-stickyNote zmDoubleIcon'><i class='path'></i></i></div>",id:"stickyNote",className:"sticky",callback:function(a,b){e()},title:zNote.notei18n.common.addStickyNote,elementID:"sNoteTab",type:"stickynotes"};return void zmTopBar.addRHSCustomElements(b)}var c=_.pluck(a.stickyNotes,"entityId"),d=_.pluck(a.stickyNotes,"groupId"),f={id:c.join(","),groupId:d.join(",")};(c.length||d.length)&&znBox.getNoteListForGivenIds(f).done(function(b){if(b=b||[],0===b[0]){var c=zmAdHocSettings.getNotes(),d=c.listingType||"";return zmAdHocSettings.setNotes({stickyNotes:[],listingType:d}),void zNote.restoreStickyNotes()}b[1]=b[1]||[],zNote.loadNoteCategories().done(function(){b[1].forEach(function(b){var c=_.findWhere(a.stickyNotes,{entityId:b.id});b.showStickyNote="open"===c.state,b.left=c.left,b.top=c.top,b.height=c.height,b.width=c.width,znBox.isElementOnScreen({top:b.top,left:b.left},{height:b.height,width:b.width})||(b.left=void 0,b.top=void 0),zNote.addAsStickyNote(b,"restore")})})})}},zNote.getNamefrmCatObj=function(a,b){if(b){for(var c=zNote.catCacheObj[b],d=c?c.length:0,e=0;e<d;e++)if(c[e].catId===a)return c[e].category;return"General"}},zNote.getNamefrmGrpObj=function(a){var b;return $.each(zNote.groupObj,function(c,d){if(a===c)return b=d.name,!1}),b},zNote.getSmartNote=function(a,b,c){var d=$.Deferred(),e={};return zNote.loadNoteCategories().done(function(){var f=c.cmpId?c.cmpId:c.noteView.model.get("id");if(c.noteView&&c.noteView.model instanceof Backbone.Model)c.noteView.setEditor({editor:b}),c.noteView.render(),d.resolve(c.noteView);else{e.id=f,e.groupId=c.noteView&&c.noteView.groupId?c.noteView.groupId:zmail.zuid,e.color=_.random(0,3),e.catId=znBox.getGeneralCatId(e.groupId);var g=new zNote.Models.addSmartNote(e),h=new zNote.Views.addNote({model:g,editor:b,dom:a});d.resolve(h)}}),d.promise()},zNote.init()}(),window.znBox=function(){var a,b={appid:"zm_notes",appicon:"msi-notes",modulename:"notes"};return a={storeId:"",savedSelection:{},savedSel:[],isPaste:!1,pageDivTop:0,getSummary:function(a){var b=a.slice(0,255),c=b.lastIndexOf("<"),d=b.lastIndexOf(">");return d<c&&(b=a.slice(0,c)),b},spCharRep:function(a){return a?a=a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&amp;/g,"&"):""},revSpCharRep:function(a){return a?a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/'/g,"&#39;"):""},saveSelection:function(a){znBox.storeNode=a;var b=window.getSelection(),c=[];if(b.rangeCount)for(var d=0,e=b.rangeCount;d<e;++d)c.push(b.getRangeAt(d));return c},restoreSelection:function(a){if(znBox.storeNode&&znBox.savedSel.length&&(znBox.storeNode[0]===a[0]||znBox.storeNode[0].isSameNode&&znBox.storeNode[0].isSameNode(a[0]))){var b=window.getSelection();b.removeAllRanges();for(var c=0,d=znBox.savedSel.length;c<d;++c)b.addRange(znBox.savedSel[c]);return!0}return!1},saveSelectionNew:function(a){var b=window.getSelection();if(b.rangeCount){var c=window.getSelection().getRangeAt(0),d=c.cloneRange();d.selectNodeContents(a),d.setEnd(c.startContainer,c.startOffset);var e=d.toString().length;return{start:e,end:e+c.toString().length}}return{start:0,end:0}},saveSelectionNew1:function(){if(window.getSelection){var a=window.getSelection();if(a.getRangeAt&&a.rangeCount)return a.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restoreSelectionNew1:function(a,b){if(b)if(window.getSelection){var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}else document.selection&&b.select&&b.select()},restoreSelectionNew:function(a,b){if(b){var c=0,d=document.createRange();d.setStart(a,0),d.collapse(!0);for(var e,f=[a],g=!1,h=!1;!h&&(e=f.pop());)if(3===e.nodeType){var i=c+e.length;!g&&b.start>=c&&b.start<=i&&(d.setStart(e,b.start-c),g=!0),g&&b.end>=c&&b.end<=i&&(d.setEnd(e,b.end-c),h=!0),c=i}else for(var j=e.childNodes.length;j--;)f.push(e.childNodes[j]);var k=window.getSelection();return k.removeAllRanges(),k.addRange(d),!0}return!1},insertHtmlAtCaret:function(a){var b,c;if(window.getSelection&&(b=window.getSelection(),b.getRangeAt&&b.rangeCount)){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var e,f,g=document.createDocumentFragment();e=d.firstChild;)f=g.appendChild(e);c.insertNode(g),f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}},isIE:function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");return!!(b>0||Boolean(navigator.userAgent.match(/Trident.*rv:11\./)))},getLabelArray:function(a){var b=[],c=zmUtil.getTagList("default");for(var d in c)if(a.indexOf(d)===-1){var e={};e.id=c[d].id,e.name=c[d].dispName,e.hashname="#"+c[d].dispName,b.push(e)}return b},handlePaste:function(a,b,c){znBox.savedSel=znBox.saveSelection(a),$("body").append("<div id='d1' contenteditable=true style=left:-500px;word-wrap:break-word;max-height:300px;max-width:300px;overflow:hidden;position:relative></div>"),$("#d1").focus();var d;setTimeout(function(){d=znBox.getContentEditableText($(document.getElementById("d1"))),$("#d1").remove(),d=d.replace(/\n/g,"<br>");var e=znBox.pasteSanitize(d);c&&(e=e.replace(/<br>/g," ").slice(0,c)),$(a).trigger("focus",!0),znBox.restoreSelection(a),znBox.isIE()?znBox.insertHtmlAtCaret(e):document.execCommand("insertHTML",!1,e),b&&znBox.setTopLeft(znNote.getCurNoteParam(b)),znBox.savedSel=znBox.saveSelection(a)},100)},handleFileInputOnChange:function(a){var b=$.Deferred(),c=[],d={};try{c.push({name:"accId",value:zmail.accId},{name:"zmrcsr",value:zmAjq.getCookie("zmcsr")},{name:"fileName",value:"inline.png"},{name:"type",value:"f"},{name:"tSize",value:0},{name:"attach",value:a}),zmail.fileUploader.flags.isAjaxable||c.push({name:"browser",value:"ie9"}),d.payloads=c,d.url=zmail.conPath+"/attach.do?mode=temp",zmail.fileUploader.upload(d).progress(function(a,b){window.console.info("total: "+a+"  ,loaded: "+b)}).done(function(a){var c=$.parseJSON(a);b.resolve(c)}).fail(function(){})}catch(e){return}return b.promise()},getBlobFromImageUrl:function(a){var b=$.Deferred(),c=new XMLHttpRequest;return c.onreadystatechange=function(){4===this.readyState&&200===this.status&&b.resolve(this.response)},c.open("GET",a),c.responseType="blob",c.send(),b.promise()},convertImageToInlineImages:function(a){var b=znBox.InlineImageSanitize(a),c=[],d=$.Deferred(),e=$("<div>").html(b);return e.find("img").each(function(){var a=this,b=$.Deferred();znBox.getBlobFromImageUrl(this.src).done(function(c){znBox.handleFileInputOnChange(c).done(function(c){a.src=zmail.conPath+"/FileDownload?mode=tmpview&entityType=1&accId="+zmail.accId+"&fpath="+c.fP+"&fstorename="+c.sN,b.resolve()})}),c.push(b)}),$.when.apply($,c).then(function(){var a=znBox.domParser(znBox.getContentEditableText(e));d.resolve(a)}),d.promise()},InlineImageSanitize:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)if(3===c[e].nodeType)c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue;else if(1!==c[e].nodeType||"BR"!==c[e].nodeName&&"TR"!==c[e].nodeName&&"P"!==c[e].nodeName){if(1===c[e].nodeType&&"TD"===c[e].nodeName)d+="&nbsp;";else if(1===c[e].nodeType&&"IMG"===c[e].nodeName){var f=c[e].getAttribute("src");/\/ImageDisplay\?na=[0-9]+&nmsgId=[0-9]+&f=[0-9a-zA-Z]+.[a-z]+&mode=inline&/.test(f)&&(d+="<img src="+f+"></img>")}}else d+="<br>"}),d}catch(e){}},pasteSanitize:function(a,b){try{var c=a,d=$("<div>").html(c),e="";return $.each($(d),function(a,c){for(var d=znBox.walkDomPaste(c),f=0;f<d.length;f++)if(3===d[f].nodeType)d[f].nodeValue=d[f].nodeValue.replace(/&/g,"&amp;"),d[f].nodeValue=d[f].nodeValue.replace(/</g,"&lt;"),d[f].nodeValue=d[f].nodeValue.replace(/>/g,"&gt;"),e+=d[f].nodeValue;else if(1!==d[f].nodeType||"BR"!==d[f].nodeName&&"TR"!==d[f].nodeName&&"P"!==d[f].nodeName){if(1===d[f].nodeType&&"TD"===d[f].nodeName)e+="&nbsp;";else if(1===d[f].nodeType&&"IMG"===d[f].nodeName&&!b){var g=d[f].getAttribute("src");e+="<img src="+g+"></img>"}}else e+="<br>"}),e}catch(f){}},walkDomPaste:function(a){var b=[],c=function d(a){do 3!==a.nodeType&&(1!==a.nodeType||"BR"!==a.nodeName&&"DIV"!==a.nodeName&&"TR"!==a.nodeName&&"TD"!==a.nodeName&&"P"!==a.nodeName)||b.push(a),a.hasChildNodes()&&"STYLE"!==a.nodeName&&d(a.firstChild),a=a.nextSibling;while(a)};return c(a),b},walkDom:function(a){var b=[],c=function d(a){do 3!==a.nodeType&&(1!==a.nodeType||"BR"!==a.nodeName&&"IMG"!==a.nodeName)||b.push(a),a.hasChildNodes()&&d(a.firstChild),a=a.nextSibling;while(a)};return c(a),b},domParserforImgReplace:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)3===c[e].nodeType?(c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue):1===c[e].nodeType&&"BR"===c[e].nodeName&&(d+="<br/>")}),d}catch(e){}},sendNewLabReq:function(a,c,d){var e,f={};f={name:a,color:c||"#FFD700",accId:zmail.defAccId,mode:"a"},e={name:a,mode:"a"};var g=function(a){var c=a.labelId,d={};d[c]={color:a.color,id:a.labelId,label:a.displayName,dispName:a.displayName,fav:"true",se:a.sequence},zmsuite.isWorkspaceAvailable(b.appid)?$.publish("/note/tagResponse",[a,e]):"a"===e.mode&&(zmUtil.getTagList("default")[c]=d[c])};return zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:g,p:f,ep:e})},sendNewCatReq:function(a,c,d){if(!znBox.isValidCategory(a,d))return $.Deferred().reject();var e,f;e={mode:"addCat",catName:a,groupId:d,streamsView:"Notes",actionType:"addCommonLabel"},f={mode:"addCat",groupId:d};var g=function(a){zmsuite.isWorkspaceAvailable(b.appid)?$.publish("/note/catResponse",[a,f]):"addCat"===f.mode&&(a[0].count=0,znBox.updateCatCache(f.mode,f.groupId,a[0]))};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:g,p:e,ep:f})},domParser:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)if(3===c[e].nodeType)c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue;else if(1===c[e].nodeType&&"BR"===c[e].nodeName)d+="\n";else if(1===c[e].nodeType&&"IMG"===c[e].nodeName){var f=c[e].getAttribute("id"),g=c[e].getAttribute("src");d+=f?"<img id='"+f+"' src='"+g+"'></img>":'<img src="'+g+'" ></img>'}}),d}catch(e){}},getContentEditableText:function(a){var b=$("<pre />").html(a.html());return $.browser.webkit&&(b.html(b.html().replace(/<div><br><\/div>/g,"<br>")),b.find("div").replaceWith(function(){return"<br>"+this.innerHTML}),b.html(b.html().replace(/<br>$/,""))),$.browser.msie&&b.find("p").replaceWith(function(){return this.innerHTML+"<br>"}),($.browser.webkit||$.browser.mozilla||$.browser.opera||$.browser.msie)&&b.find("br").replaceWith("\n"),b.html()},getContentEditableTextFromHTML:function(a){var b=$("<pre />").html(a);return $.browser.webkit&&(b.html(b.html().replace(/<div><br><\/div>/g,"<br>")),b.find("div").replaceWith(function(){return"<br>"+this.innerHTML}),b.html(b.html().replace(/<br>$/,""))),$.browser.msie&&b.find("p").replaceWith(function(){return this.innerHTML+"<br>"}),($.browser.webkit||$.browser.mozilla||$.browser.opera||$.browser.msie)&&b.find("br").replaceWith("\n"),b.html()},getConstantsValues:function(a,b){return"color"===b?zNote.CONSTANTS.COLORNAME[a]:""},getTextContentFromHTML:function(a){var b=a?a:"";b=b.replace(/\n/g,"<br>");var c=znBox.pasteSanitize(b).replace(/<br>/g,"\n");return c},getNoteListForGivenIds:function(a){var b={entityIds:a.id,groupIds:a.groupId,mode:"getNotes"};return onerror=function(){},zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:b,onerror:onerror})},invokeChatlet:function(a,b){if(!$(a).hasClass("zm_snd")){var c="";$(a).addClass("zm_snd");var d=zmail.ContactBook.get({zuid:b.ownerZUID,promise:!1}),e=d[0];e&&e.attrs&&e.attrs.fn&&(c=b.ownerZUID===zmail.zuid?e.attrs.fn+" "+zNote.notei18n.preview.personalCreatedNote:e.attrs.fn+" "+zNote.notei18n.preview.createdNote+" "+znBox.getGroupName(b.namespaceId)),zmAjq.XHR({u:zmail.conPath+"/post.do",p:{mode:"participants",entityType:"2",entityId:b.id,groupId:b.namespaceId,data:c},t:"POST"}).done(function(c){c=c[1];var d=[];$.isEmptyObject(c)||(d=c.participants),a=$(a).parents("b");var e={zuids:d,id:b.id,etype:"3",groupId:b.namespaceId,elm:a};zmAppLoader.load("chatlet").done(function(){zmail.Components.Chatlet.core.init(e)})})}},isValidCategory:function(a,b){var c,d=a;if(d=d.trim(),c=d.toLowerCase(),zmUtil.hasSpecialChars(d,"labelName"))return zmUtil.succErrMsg("e",zNote.notei18n.nosp),!1;if(!c)return zmUtil.succErrMsg("e",zNote.notei18n.nonull),!1;var e=zNote.catCacheObj[b];if(e)for(var f=e.length,g=0;g<f;g++)if(e[g].category===d)return zmUtil.succErrMsg("e",zNote.notei18n.bookexist),!1;return!0},isArchiveOpen:function(){return!0},isRichTextOpen:function(){return!0},copyNote:function(a,b,c){zNote.loadNoteCategories().done(function(){znBox.checkForGroupDisabled({groupId:a.namespaceId})&&(a.namespaceId=zmail.zuid,a.catId=znBox.getGeneralCatId(a.namespaceId));var d,e,f=znBox.noteModel(a),g=znBox.getGroupArray(),h={"true":"msi-check","false":"msi-uncheck"},i=$(zNote.templates.copyNote({checkBoxClass:h[f.get("comments")]}));f.onChanged("title",function(a){i.find("#zcpTitle").val(znBox.spCharRep(a.get("title")))}),f.onChanged("namespaceId",function(a){i.find("#zncpGroup").val(znBox.getGroupName(a.get("namespaceId")))}),f.onChanged("catId",function(a){i.find("#zncpBook").val(zNote.getNamefrmCatObj(a.get("catId"),a.get("namespaceId")))}),f.onChanged("comments",function(a){i.find("#attIn").removeClass(h[!f.get("comments")]).addClass(h[f.get("comments")])}),f.set({title:f.get("title"),namespaceId:f.get("namespaceId"),catId:f.get("catId")}),i.find("#zcpTitle").on("blur",function(){f.set({title:this.value})}),i.find("#attIn").on("click",function(){f.set({comments:!f.get("comments")})}),i.find("#zncpGroup").on("click",function(){var a={};a.parentDOM=$(i).find("#zncpGroup")[0],a.displayAs="dropdown",a.onSelect=function(a){f.set({namespaceId:a}),f.set({catId:znBox.getGeneralCatId(a)}),d.hide()},a.onHide=function(){$("#zm_dropDown").remove()},a.dataCallback=function(){return g},d=zmUtil.createFLComp("category",a),d.show()}),i.find("#zncpBook").on("click",function(){var a={},b=znBox.getCategoryArray(f.get("namespaceId"));a.parentDOM=$(i).find("#zncpBook")[0],a.displayAs="dropdown",a.onSelect=function(a){f.set({catId:a}),e.hide()},(f.get("namespaceId")===zmail.zuid||zmCont.getGroup()[f.get("namespaceId")]&&zmCont.getGroup()[f.get("namespaceId")].isOwner)&&(a.onCreate=function(a){znBox.sendNewCatReq(a,{},f.get("namespaceId")).done(function(a){f.set({catId:a[1][0].catId}),e.hide()})}),a.onHide=function(){$("#zm_dropDown").remove()},a.dataCallback=function(){return b},e=zmUtil.createFLComp("category",a),e.show()});var j=function(){d&&d.hide(),e&&e.hide()},k={title:zNote.notei18n.note[c.type],mask:"black",defaultCloseIcon:!0,contentWrapperClass:"SC_PU",maskWrapperClass:"SC_Pop",$content:i,buttons:[{name:zNote.notei18n.ok,callback:function(c){b({catId:f.get("catId"),namespaceId:f.get("namespaceId"),title:f.get("title"),comments:f.get("comments"),prevGroupId:a.namespaceId,entityId:a.entityId}).done(function(){c.remove()})}},{name:zNote.notei18n.cancel,isCancel:!0,callback:function(a){a.remove()}}],dialogDidMount:function(a){a.$els.$maskWrapper.on("mousedown",function(){j()})}};Dialog["new"](k)})},checkForQuickAdd:function(a){return"c"===a.mode&&!znBox.checkForGroupDisabled({groupId:a.groupId})},checkForGroupDisabled:function(a){return!!(zmUtil.isNewGroupUser()&&zNote.groupObj[a.groupId]&&zNote.groupObj[a.groupId].disabled)},checkForGroupHidden:function(a){return!!(zmUtil.isNewGroupUser()&&zNote.groupObj[a.groupId]&&zNote.groupObj[a.groupId].hidden)},noteModel:function(a){function b(a){this.attr=$.extend(!0,{},a),this.emitChange={},this.changed={}}return b.prototype.set=function(a){for(var b=this,c=Object.keys(a),d=0;d<c.length;d++)this.attr[c[d]]=a[c[d]],this.changed[c[d]]=this.attr[c[d]],this.emitChange[c[d]](b)},b.prototype.onChanged=function(a,b){this.emitChange[a]=b},b.prototype.get=function(a){return this.attr[a]},new b(a)},hideMenu:function(){zmUtil.hideMenu(),$(".zn_note.sel").removeClass("sel"),$(".zmL.sel").removeClass("sel"),$("[data-visible='true']").not($("[data-current='true']")).attr("data-visible","false"),$("#znLTMenu").hide(),$("#znCntxtMenu").remove(),$("#zn_foltagpopup").remove(),$("#zm_dropDown").remove(),$("#zmcDrpDwnMnu").remove(),$(".SC_ddnB").removeClass("SC_ddnB")},getCategoryArray:function(a){for(var b=[],c=0;c<zNote.catCacheObj[a].length;c++)b.push({
id:zNote.catCacheObj[a][c].catId,display_text:zNote.catCacheObj[a][c].category,name:zNote.catCacheObj[a][c].category});return b},getAttSlideArray:function(a,b,c){for(var d=[],e=0,f=a.length;e<f;e++)for(var g in a[e]){var h=$.extend(!0,{},a[e][g]);h.gId=c,c!==zmail.zuid&&(h.type="viewGroupData"),d.push(h)}return d},getGroupArray:function(){var a=[],b=zmUtil.getGroupOrder();a.push({id:zmail.zuid,name:zNote.notei18n.myNotes,display_text:zNote.notei18n.myNotes,tooltip:zNote.notei18n.myNotes});for(var c=0,d=b.length;c<d;c++)if(!znBox.checkForGroupDisabled({groupId:b[c]})&&!znBox.checkForGroupHidden({groupId:b[c]})){var e={};e.id=b[c],e.name=znBox.getGroupName(b[c]),e.display_text=znBox.getGroupName(b[c]),e.tooltip=znBox.getGroupName(b[c]),a.push(e)}return a},getGeneralCatId:function(a){for(var b in zNote.catCacheObj)if(b===String(a))return zNote.catCacheObj[b]&&zNote.catCacheObj[b][0]&&zNote.catCacheObj[b][0].catId},getGenCat:function(a){var b={mode:"getGeneralCat",groupId:a.gid,streamsView:"Notes",actionType:"appView"},c={id:a.gid,mode:"getGeneralCat"},d=function(a,b){zNote.catCacheObj[b.id]=a,zNote.catIdGen[b.id]=a[0].catId},e=a.fn?a.fn:d;return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:e,p:b,ep:c})},dragAround:function(a,b){a.onmousedown=function(c){if(!$(c.srcElement).hasClass("ui-resizable-handle")){var d,e=c.clientX-a.getBoundingClientRect().left,f=c.clientY-a.getBoundingClientRect().top,g=function(a){d(a.pageX,a.pageY)};d=function(c,d){var h=c-e-20,i=d-f-20;znBox.isElementOnScreen({top:i,left:h},{height:a.getBoundingClientRect().height,width:a.getBoundingClientRect().width})?(a.style.left=h+"px",a.style.top=i+"px",b.stop({position:{left:h,top:i}})):(document.removeEventListener("mousemove",g),a.onmouseup=null)},d(c.pageX,c.pageY),document.addEventListener("mousemove",g),a.onmouseup=function(){document.removeEventListener("mousemove",g),a.onmouseup=null}}},a.ondragstart=function(){return!1}},isElementOnScreen:function(a,b){return!(a.top<0||a.left<0||window.innerHeight<a.top+b.height||window.innerWidth<a.left+b.width)},getGroupName:function(a){return String(a)===zmail.zuid?zNote.notei18n.myNotes:zNote.groupObj[a]?zNote.groupObj[a].name:""},getCat:function(){var a={mode:"getCategories",groupId:zmail.zuid,streamsView:"Notes",actionType:"appView"};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:a})},getGroupCat:function(){var a,b,c=$.Deferred();return zmail.ContactBook.groupsFetched.done(function(){if(a=zmUtil.getGroupOrder(),!a.length)return c.reject({msg:"no group"});b=a.join();var d={mode:"getGrpCategories",groupId:zmail.zuid,groupIds:b,streamsView:"Notes",actionType:"appView"};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:d}).done(function(a){c.resolve(a)})}).fail(function(){c.reject({msg:"group categories get failed"})}),c.promise()},setGrpCat:function(a){$.each(a[0],function(a,b){zNote.catCacheObj[a]=b}),zNote.noteGroupOrderAndCount=a[1]},updateCatCache:function(a,b,c){var d,e,f=zNote.catCacheObj[b],g=f.length;if("addCat"===a)f.push(c);else if("editCat"===a)for(d=0;d<g;d++)f[d].catId===c.catId&&(f[d].category=c.category);else if("delCat"===a){for(g=f.length,d=0;d<g;d++)if(f[d].catId===c.catId){e=d;break}f.splice(e,1)}},updateNewCatInCache:function(a,b){"addCat"===b.mode&&(a[0].count=0,znBox.updateCatCache(b.mode,b.groupId,a[0]))},getAdhocSettingsStickyNotes:function(){var a=zmAdHocSettings.getNotes(),b=[];return a.stickyNotes&&a.stickyNotes.length?b=a.stickyNotes.map(function(a){var b={entityId:a.entityId,groupId:a.groupId};return b.state=a.state,b.top=parseInt(a.top),b.left=parseInt(a.left),b.width=parseInt(a.width),b.height=parseInt(a.height),b}):b},postAsNew:function(a){var b=!1;a.comments&&(b=a.comments);var c={toNamespace:a.namespaceId,entityId:a.entityId,mode:"changeGroup",groupId:a.prevGroupId,title:a.title,catId:a.catId,deleteOriginal:!1,commentsNeeded:b,entityType:zNote.CONSTANTS.entityType,actionType:"addEntity"},d=function(a){var b=zNote.getNoteDataInListFormat(a[0].data);_zm.succErrMsg("s",zNote.notei18n.msg.noteCopied+" "+znBox.getGroupName(c.toNamespace)),$.publish("/note/add",[b]),$.publish("note/updateCount",[{mode:"addNote",cat:b.cat,namespaceId:b.namespaceId}])};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:d,p:c})},changeGroup:function(a,b){if(a.prevGroupId===a.namespaceId)return _zm.succErrMsg("e",zNote.notei18n.msg.moveNoteMsg),$.Deferred().reject();var c=void 0===a.comments||a.comments,d={toNamespace:a.namespaceId,entityId:a.entityId,mode:"changeGroup",groupId:a.prevGroupId,streamsView:"Notes",actionType:"addEntity",entityType:zNote.CONSTANTS.entityType,deleteOriginal:!0,commentsNeeded:c};a.title&&(d.title=a.title),a.catId&&(d.catId=a.catId);var e=$.extend(!0,{},d);e.cat=a.catId;var f=function(a){var c=zNote.getNoteDataInListFormat(a[0].data);_zm.succErrMsg("s",zNote.notei18n.msg.noteMoved+" "+znBox.getGroupName(e.toNamespace)),$.publish("/note/delete",[d.entityId,d.groupId]),$.publish("note/deleteNote",[{pid:d.entityId,gid:d.groupId}]),$.publish("note/updateCount",e),$.publish("/note/add",[c]),$.publish("note/updateCount",[{mode:"addNote",cat:c.cat,namespaceId:c.namespaceId}]),b&&b.sticky&&zNote.addAsStickyNote(c)};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:f,p:d})},CheckForNoteOrganize:function(){return zmTab.currentTab===b.appid&&1===znNote.noteView||zmTab.currentTab.startsWith("zm_srch")===!0&&"n"!==zmSearch.getSearchAppType()},deleteNotesReq:function(a,b){var c={entityId:a.id,mode:"delNote",groupId:a.groupId,streamsView:"Notes",actionType:"delEntity",entityType:zNote.CONSTANTS.entityType},d={id:a.id,mode:"delNote"},e=function(a,d){b&&b(d),$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("note/deleteNote",[{pid:c.entityId,gid:c.groupId}]),$.publish("note/updateCount",c)};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:e,p:c,ep:d})},setTopLeft:function(a,b,c){function d(){var a=Math.min.apply(Math,i),c=i.indexOf(a),f=j[l];if(i[c]===a){var h=c*(g+n)+"px",m=a+"px";$(f).attr({"data-cno":c,"data-sno":l}).css({top:m,left:h}),i[c]=parseInt($(f).outerHeight())+parseInt(a)+parseInt(19)}l+=1,l<k?setTimeout(d,0):(znBox.pageDivTop=Math.max.apply(Math,i),znBox.pageDivTop-=20,setTimeout(function(){b&&e.removeClass("zn_note_animation")},500))}if(znBox.CheckForNoteOrganize()){var e=c?$(c).children():znNote.listingDiv,f=c?$(c).width()-20:e.width()-20,g=znBox.CONTS.ntWid;if(b&&e.addClass("zn_note_animation"),!(a&&a.sno&&e.children().length<=a.sno)){a&&a.width&&(f=a.width-20);var h,i=[],j=e.children(),k=j.length,l=0,m=Math.floor(f/g);m=Math.max(m,1),h=m;var n=Math.floor((f-m*g)/m),o=g-znBox.CONTS.ntBorPad+n;for(j.each(function(){$(this).css("width")!==o+"px"&&$(this).css({width:o+"px"})});h--;)i.push(0);if(a&&void 0!==a.sno&&void 0!==a.cno&&void 0!==a.top){var p=a.sno,q=a.cno,r=a.top,s=m,t=[];i[q]=parseInt(r),t.push(q);for(var u=1,v=1;v<=p;v++){var w=$(j[p-v]),x=w.attr("data-cno");if(0===i[x]){var y=w.css("top");y=y.replace("px",""),y=parseInt(y),i[x]=y+w.outerHeight()+parseInt(19),++u}if(u===s)break}l=parseInt(p)}setTimeout(d,0)}}},removeStickyIcon:function(){return zmail.fromOtherService},CONTS:{ntWid:300,ntBorPad:57,defaultTitle:"Title",nColClsArr:{zn_clr1:"0",zn_clr2:"1",zn_clr3:"2",zn_clr4:"3"},nColArr:["zn_clr1","zn_clr2","zn_clr3","zn_clr4"]}}}(),function(){zNote.getEditorIcons=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.makeOrRemoveBold=d.makeOrRemoveBold.bind(d),d.makeOrRemoveItalic=d.makeOrRemoveItalic.bind(d),d.makeOrRemoveUnderline=d.makeOrRemoveUnderline.bind(d),d.makeOrRemoveStrikethrough=d.makeOrRemoveStrikethrough.bind(d),d.alignTextDirection=d.alignTextDirection.bind(d),d.removeFormat=d.removeFormat.bind(d),d.makeOrRemoveList=d.makeOrRemoveList.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this;$(this.props.editor.doc).on("mouseup",function(){a.updateToolBar()}),$(this.props.editor.doc).on("keydown",function(){a.updateToolBar()})}},{key:"updateToolBar",value:function(){var a=this.props.editor.doc;this.bold=this.italic=this.underline=this.strikethrough=!1,a.queryCommandState("bold")&&(this.bold=!0),a.queryCommandState("italic")&&(this.italic=!0),a.queryCommandState("underline")&&(this.underline=!0),a.queryCommandState("strikethrough")&&(this.strikethrough=!0),this.forceUpdate()}},{key:"makeOrRemoveBold",value:function(){this.props.editor.doc.queryCommandState("bold")?this.props.editor.squireInstance.removeBold():this.props.editor.squireInstance.bold(),this.updateToolBar()}},{key:"makeOrRemoveItalic",value:function(){this.props.editor.doc.queryCommandState("italic")?this.props.editor.squireInstance.removeItalic():this.props.editor.squireInstance.italic(),this.updateToolBar()}},{key:"makeOrRemoveUnderline",value:function(){this.props.editor.doc.queryCommandState("underline")?this.props.editor.squireInstance.removeUnderline():this.props.editor.squireInstance.underline(),this.updateToolBar()}},{key:"makeOrRemoveStrikethrough",value:function(){this.props.editor.doc.queryCommandState("strikethrough")?this.props.editor.squireInstance.removeStrikethrough():this.props.editor.squireInstance.strikethrough(),this.updateToolBar()}},{key:"alignTextDirection",value:function(a){var b=this;a.stopPropagation();var c=$('<li class="nohr"><div><i class="msi-leftAlign"></i></div></li><li class="nohr"><div><i class="msi-rightAlign"></i></div></li><li class="nohr"><div><i class="msi-centerAlign"></i></div></li>');$(a.target).closest("b").addClass("SC_ddnB"),$(c).find(".msi-leftAlign").on("click",function(a){b.props.editor.squireInstance.setTextAlignment("left"),znBox.hideMenu()}),$(c).find(".msi-rightAlign").on("click",function(a){b.props.editor.squireInstance.setTextAlignment("right"),znBox.hideMenu()}),$(c).find(".msi-centerAlign").on("click",function(a){b.props.editor.squireInstance.setTextAlignment("center"),znBox.hideMenu()});var d={par:$(a.target).closest("b")[0],liDom:c,dir:"bottom",align:"pright",spanClass:"SC_dd zn_ddBt",defaultclass:!1};zmsuite.showMenu(d)}},{key:"removeFormat",value:function(){this.props.editor.squireInstance.removeAllFormatting()}},{key:"makeOrRemoveBullets",value:function(a){var b,c,d=this;c="makeUnorderedList",b="UL",d.props.editor.squireInstance.testPresenceinSelection(c,c,b,/>UL\b/)?d.props.editor.squireInstance.removeList():d.props.editor.squireInstance.makeUnorderedList()}},{key:"makeOrRemoveList",value:function(a){var b,c,d=this;a.stopPropagation();var e=$('<li class="nohr"><div><i class="msi-bullets"></i></div></li><li class="nohr"><div><i class="msi-numbering"></i></div></li>');$(a.target).closest("b").addClass("SC_ddnB"),$(e).find(".msi-bullets").on("click",function(a){d.makeOrRemoveBullets(a),znBox.hideMenu()}),$(e).find(".msi-numbering").on("click",function(a){c="makeOrderedList",b="OL",d.props.editor.squireInstance.testPresenceinSelection(c,c,b,/>OL\b/)?d.props.editor.squireInstance.removeList():d.props.editor.squireInstance.makeOrderedList(),znBox.hideMenu()});var f={par:$(a.target).closest("b")[0],liDom:e,dir:"bottom",align:"pright",spanClass:"SC_dd zn_ddBt",defaultclass:!1};zmsuite.showMenu(f)}},{key:"render",value:function(){var a=this,b={"true":"sel","false":""},c=function(b){b.stopPropagation(),a.props.editor.squireInstance.setTextAlignment("left")},d=function(b){b.stopPropagation(),a.makeOrRemoveBullets(b)};return React.createElement("ul",{className:"zn_editIcons"},React.createElement("li",null,React.createElement("b",{className:"sep"})),React.createElement("li",{onClick:this.makeOrRemoveBold,ref:"bold",title:zNote.notei18n.richText.bold},React.createElement("b",{className:b[this.bold]},React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-bold"})))),React.createElement("li",{onClick:this.makeOrRemoveItalic,ref:"italic",title:zNote.notei18n.richText.italic},React.createElement("b",{className:b[this.italic]},React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-italic"})))),React.createElement("li",{onClick:this.makeOrRemoveUnderline,ref:"underline",title:zNote.notei18n.richText.underline},React.createElement("b",{className:b[this.underline]},React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-underline"})))),React.createElement("li",{onClick:this.makeOrRemoveStrikethrough,ref:"strikethrough",title:zNote.notei18n.richText.strikethrough},React.createElement("b",{className:b[this.strikethrough]},React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-strikeThrough"})))),React.createElement("li",null,React.createElement("b",{className:"sep"})),React.createElement("li",{onClick:c,title:zNote.notei18n.richText.fontstyle},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-leftAlign"}),React.createElement("i",{className:"msi-barrow",onClick:this.alignTextDirection})))),React.createElement("li",{onClick:d,title:zNote.notei18n.richText.list},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-bullets"}),React.createElement("i",{className:"msi-barrow",onClick:this.makeOrRemoveList})))),React.createElement("li",null,React.createElement("b",{className:"sep"})),React.createElement("li",{onClick:this.removeFormat,title:zNote.notei18n.richText.removeFormat},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-rmvFrmt"})))))}}]),b}(React.Component)}(),function(){var a=zmsuite.createAppRouter();window.zNote=window.zNote||{},window.zNote.RouteHelper=a;var b=function(a){var b=!0;if("preview"===a[0])zmUtil.loadNotes("openNote",{gId:a[1],e:a[2]}),b=!1;else if("tab"===a[0])zmUtil.loadNotes("openNoteInTab",{gId:a[1],e:a[2]}),b=!1;else{var c={};c.hashParams=a,c.data={router:!0},zmAppLoader.load("notes").done(function(){zmApp.showApp("n",c)})}return b},c=function(a){var c,d=this;return zmail.postJsDeffered.promise.then(function(){c=b.call(d,a)}),{updateParams:c}},d=function(){a.initialize({hashKey:"notes",handler:c}),a.activate()};d()}(),window.notesRestore=function(){var a={};return a.saveState=function(a){var b=zmsuite.getAppObj("zm_notes").obj.stateData.data;b.listing=a,zmState.sendRequestToSaveState()},a.restore=function(a,b){var c={};c.restoreParams=a.data.listing,c.data={restore:!0},zmAppLoader.load("notes").done(function(){zmApp.showApp("n",c)}),b.deferred.resolve()},a.saveTabState=function(a){zmState.saveTabState(a.appId,a)},a.restoreTab=function(a,b){zNote.openNoteInTab(a.data,!0)},a}();
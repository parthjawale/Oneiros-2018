function ZCL_isEmpty(obj){for(var prop in obj)if(obj.hasOwnProperty(prop))return!1;return!0}function ZCL_dateTimeComparison(dateFldName1,timeFldName1,Label1,dateFldName2,timeFldName2,Label2,type){var dateval1=ZCL_getObj(dateFldName1).value.replace(/^\s+/g,"").replace(/\s+$/g,""),dateval2=ZCL_getObj(dateFldName2).value.replace(/^\s+/g,"").replace(/\s+$/g,""),dateelements1=ZCL_splitDateVal(dateval1),dateelements2=ZCL_splitDateVal(dateval2);dd1=dateelements1[0],mm1=dateelements1[1],yyyy1=dateelements1[2],dd2=dateelements2[0],mm2=dateelements2[1],yyyy2=dateelements2[2];var time1=ZCL_getObj(timeFldName1).value.replace(/^\s+/g,"").replace(/\s+$/g,"");time1=ZCL_TimetoNo(time1);var time2=ZCL_getObj(timeFldName2).value.replace(/^\s+/g,"").replace(/\s+$/g,"");time2=ZCL_TimetoNo(time2);var hh1=parseInt(time1/100,10),hh2=parseInt(time2/100,10),min1=time1%100,min2=time2%100,date1=new Date(yyyy1,mm1-1,dd1,hh1,min1,0,0),date2=new Date(yyyy2,mm2-1,dd2,hh2,min2,0,0);return ZCL_compareDates(date1,Label1,date2,Label2,type)?!0:(ZCL_getObj(dateFldName1).focus(),!1)}function ZCL_dateValidate(fldName,Label){if(0==ZCL_patternValidate(fldName,Label,"DATE"))return!1;dateval=ZCL_getObj(fldName).value.replace(/^\s+/g,"").replace(/\s+$/g,"");var dateelements=ZCL_splitDateVal(dateval);if(dd=dateelements[0],mm=dateelements[1],yyyy=dateelements[2],1>dd||dd>31||1>mm||mm>12||1>yyyy||1e3>yyyy)return zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.plentvd,[Label])),ZCL_getObj(fldName).focus(),!1;if(2==mm&&dd>29)return zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.plentvd,[Label])),ZCL_getObj(fldName).focus(),!1;if(2==mm&&dd>28&&yyyy%4!=0)return zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.plentvd,[Label])),ZCL_getObj(fldName).focus(),!1;switch(parseInt(mm)){case 2:case 4:case 6:case 9:case 11:if(dd>30)return zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.plentvd,[Label])),ZCL_getObj(fldName).focus(),!1}return!0}function ZCL_dateComparison(fldName1,Label1,fldName2,Label2,type){var dateval1=ZCL_getObj(fldName1).value.replace(/^\s+/g,"").replace(/\s+$/g,""),dateval2=ZCL_getObj(fldName2).value.replace(/^\s+/g,"").replace(/\s+$/g,""),dateelements1=ZCL_splitDateVal(dateval1),dateelements2=ZCL_splitDateVal(dateval2);dd1=dateelements1[0],mm1=dateelements1[1],yyyy1=dateelements1[2],dd2=dateelements2[0],mm2=dateelements2[1],yyyy2=dateelements2[2];var date1=new Date(yyyy1,mm1-1,dd1,0,0,0,0),date2=new Date(yyyy2,mm2-1,dd2,0,0,0,0);return ZCL_compareDates(date1,Label1,date2,Label2,type)?!0:(ZCL_getObj(fldName1).focus(),!1)}function ZCL_patternValidate(fldName,Label,type){var currObj=ZCL_getObj(fldName);if("EMAIL"==type.toUpperCase()){currObj.value=currObj.value.trim();var re=/^[a-zA-Z0-9]([\w\-\.\+]*)@([\w\-\.]*)(\.[a-zA-Z]{2,8}(\.[a-zA-Z]{2}){0,2})$/i}else if("DATE"==type.toUpperCase())switch(zcal.DFORMAT[zcal.cdata.opt.DF]){case"yyyy/MM/dd":case"yyyy-MM-dd":var re=/^\d{4}(\-|\/|\.)\d{1,2}\1\d{1,2}$/;break;case"MM/dd/yyyy":case"dd/MM/yyyy":var re=/^\d{1,2}(\-|\/|\.)\d{1,2}\1\d{4}$/}else if("TIME"==type.toUpperCase())var re=/^\d{1,2}\:\d{1,2}$/;return re.test(currObj.value)?!0:(zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.plentvd,[Label])),currObj.focus(),!1)}function ZCL_splitDateVal(dateval){var datesep,dateelements=new Array(3);switch(dateval.indexOf("-")>=0?datesep="-":dateval.indexOf(".")>=0?datesep=".":dateval.indexOf("/")>=0&&(datesep="/"),zcal.DFORMAT[zcal.cdata.opt.DF]){case"yyyy/MM/dd":dateelements[0]=dateval.substr(dateval.lastIndexOf(datesep)+1,dateval.length),dateelements[1]=dateval.substring(dateval.indexOf(datesep)+1,dateval.lastIndexOf(datesep)),dateelements[2]=dateval.substring(0,dateval.indexOf(datesep));break;case"yyyy-MM-dd":dateelements[0]=dateval.substr(dateval.lastIndexOf(datesep)+1,dateval.length),dateelements[1]=dateval.substring(dateval.indexOf(datesep)+1,dateval.lastIndexOf(datesep)),dateelements[2]=dateval.substring(0,dateval.indexOf(datesep));break;case"MM/dd/yyyy":dateelements[0]=dateval.substring(dateval.indexOf(datesep)+1,dateval.lastIndexOf(datesep)),dateelements[1]=dateval.substring(0,dateval.indexOf(datesep)),dateelements[2]=dateval.substr(dateval.lastIndexOf(datesep)+1,dateval.length);break;case"dd/MM/yyyy":dateelements[0]=dateval.substring(0,dateval.indexOf(datesep)),dateelements[1]=dateval.substring(dateval.indexOf(datesep)+1,dateval.lastIndexOf(datesep)),dateelements[2]=dateval.substr(dateval.lastIndexOf(datesep)+1,dateval.length)}return dateelements}function ZCL_compareDates(date1,Label1,date2,Label2,type){var ret=!0;switch(type){case"L":date1>=date2&&(zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.shlethn,[Label1,Label1])),ret=!1);break;case"LE":date1>date2&&(zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.shlethoreq,[Label1,Label2])),ret=!1);break;case"E":date1!=date2&&(zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.sheqto,[Label1,Label2])),ret=!1);break;case"G":date2>=date1&&(zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.shgrthn,[Label1,Label2])),ret=!1);break;case"GE":date2>date1&&(zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.shgrthoreq,[Label1,Label2])),ret=!1)}return 0==ret?!1:!0}function ZCL_intValidate(fldName,Label){var val=ZCL_getObj(fldName).value.replace(/^\s+/g,"").replace(/\s+$/g,"");return isNaN(val)||-1!=val.indexOf(".")?(zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.invd,[Label])),ZCL_getObj(fldName).focus(),!1):1>val||val>999?(zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.outrge,[Label])),!1):!0}function ZCL_dateTimeValidate(dateFldName,timeFldName,fldLabel){ZCL_getObj(dateFldName);if(0==ZCL_patternValidate(dateFldName,fldLabel,"DATE"))return!1;dateval=ZCL_getObj(dateFldName).value.replace(/^\s+/g,"").replace(/\s+$/g,"");var dateelements=ZCL_splitDateVal(dateval);if(dd=dateelements[0],mm=dateelements[1],yyyy=dateelements[2],1>dd||dd>31||1>mm||mm>12||1>yyyy||1e3>yyyy)return _zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(dateFldName).focus(),!1;if(2==mm&&dd>29)return _zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(dateFldName).focus(),!1;if(2==mm&&dd>28&&!ZCL_isLeapYear(yyyy))return _zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(dateFldName).focus(),!1;switch(parseInt(mm,10)){case 2:case 4:case 6:case 9:case 11:if(dd>30)return _zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(dateFldName).focus(),!1}var timeCurrObj=ZCL_getObj("zcl_"+timeFldName+"_time"),x=timeCurrObj.value.toLowerCase();return x=x.replace(/\D/gi,""),isNaN(x)?(_zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),timeCurrObj.focus(),!1):!0}function ZCL_isLeapYear(year){return year%400==0||year%100!=0&&year%4==0?!0:!1}function ZCL_crmIntValidate(fldName,fldLabel){if(null!=ZCL_getObj(fldName)&&0!=ZCL_getObj(fldName).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var val=ZCL_getObj(fldName).value.replace(/^\s+/g,"").replace(/\s+$/g,""),re=/^\d+(,(\d)+)*$/;return isNaN(val)||-1!=val.indexOf(".")||!re.test(val)?(_zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(fldName).focus(),!1):(ZCL_getObj(fldName).value=ZCL_getObj(fldName).value.replace(/^\s+/g,"").replace(/\s+$/g,""),!0)}return!0}function ZCL_XHR(u,f,d,ct){if(u="/mail"+u,ZCL_LOGIN_STATE){rt=ZCL_RQ.length,ZCL_RQ[rt]=ZCL_GetHTTPTransport(),ZCL_URL[rt]=u,"function"==typeof f?(ZCL_RQ[rt].zcal_callback=f,ZCL_RQ[rt].zcal_reqindex=rt,ZCL_RQ[rt].onreadystatechange=function(){var callback=this.zcal_callback,rt=this.zcal_reqindex;if(4==this.readyState){var ret=this.getResponseHeader("Content-Type").toLowerCase().indexOf("text/xml");-1!=ret?callback(this.responseXML,ZCL_URL[rt]):callback(this,ZCL_URL[rt]),ZCL_RQ[rt]=null}}):ZCL_RQ[rt].onreadystatechange=new Function("{ 				if( ZCL_RQ["+rt+"].readyState == 4 ) { 					ZCL_XHRInclude(ZCL_RQ["+rt+"],ZCL_URL["+rt+"]);					var ret = ZCL_RQ["+rt+'].getResponseHeader("Content-Type").toLowerCase().indexOf("text/xml");					'+f+"((ret !=-1 ? ZCL_RQ["+rt+"].responseXML:ZCL_RQ["+rt+"]) ,ZCL_URL["+rt+"]);ZCL_RQ["+rt+"]=null;}}"),m="POST";var tmp1=ZCL_getCookie("aprmjrnpkcrkks");return-1!=u.indexOf("?")?(d=u.substring(u.indexOf("?")+1,u.length),u=u.substring(0,u.indexOf("?"))):d="",d+=(""!=d?"&":"")+"mstpcrdhkur="+tmp1,ZCL_RQ[rt].open(m,u,!0),"POST"==m?(ct||(ct="application/x-www-form-urlencoded;charset=UTF-8"),ZCL_RQ[rt].setRequestHeader("Content-Type",ct),ZCL_RQ[rt].send(d)):ZCL_RQ[rt].send(null),!0}return!1}function ZCL_XHRInclude(){return!0}function ZCL_XHRSync(u,d,ct){var ZCL_RQ=ZCL_GetHTTPTransport();return m=d?"POST":"GET",u+=(u.indexOf("?")+1?"&":"?")+(new Date).getTime(),ZCL_RQ.open(m,u,!1),"POST"==m?(ct||(ct="application/x-www-form-urlencoded;charset=UTF-8"),ZCL_RQ.setRequestHeader("Content-Type",ct),ZCL_RQ.send(d)):ZCL_RQ.send(null),ZCL_RQ}function ZCL_constructData(){var _txt="",tempDiv=$('<div id="zcl_prntTemp"/>');if(4==zcal.view)_txt=ZCL_prntTitle()+'<div align="center" style="font-weight:bold; line-height: 40px;font-size:14px;">'+$(".zcl_tpdtmth")[0].innerHTML+'</div><div class="zcl_prntpdf">'+$("#zcl_workarea").parent().html()+"</div>",tempDiv.html(_txt);else if(3==zcal.view)_txt=ZCL_prntTitle()+'<div align="center" style="font-weight:bold; line-height: 40px;font-size:14px;">'+$(".zcl_tpdtmth")[0].innerHTML+'</div><div class="zcl_prntpdf">'+zcalMonthPrint.printMonth()+"</div>",tempDiv.html(_txt);else{_txt=ZCL_prntTitle()+'<div align="center" style="font-weight:bold; line-height: 40px;font-size:14px;">'+$(".zcl_tpdtmth")[0].innerHTML+'</div><div class="zcl_prntpdf">'+$("#zcl_workarea").parent().html()+"</div>",tempDiv.html(_txt);var $wrk=tempDiv.find("#zcl_workarea"),$enc=tempDiv.find("#zcl_encloser"),$allg=tempDiv.find("#zcl_allgrid"),$evbg=tempDiv.find(".zcl_evbg");$wrk.removeAttr("style"),$enc.removeAttr("style"),$allg.removeAttr("style"),$evbg.removeAttr("style")}return tempDiv[0].innerHTML}var zcal={};zcal.i18n={},zcal.view=0,zcal.mlimit=[],zcal.disabledcal="",zcal.win=window,zcal.isRO=!1,zcal.ZCRM="",zcal.ZMET="",zcal.ZTSK="",zcal.ZNTS="",zcal.ZCAL,zcal.timezones=[],zcal.search={},zcal.calcolor=[["#528800","#8CBF40"],["#B1365F","#E67399"],["#4A716C","#85AAA5"],["#001ca2","#8f9bd6"],["#00a600","#9cdc9c"],["#bd1700","#e8b0a8"],["#7b22aa","#c59eda"],["#787878","#c4c4c4"],["#b30051","#de8fb3"],["#5c8d87","#a6bab7"],["#88880E","#BFBF4D"],["#A32929","#D96666"],["#7A367A","#B373B3"],["#29527A","#668CB3"],["#28754E","#65AD89"],["#BE6D00","#F2A640"],["#865A5A","#BE9494"],["#4E5D6C","#8997A5"],["#8D6F47","#C4A883"],["#AB8B00","#E0C240"]],zcal.eventcolor=["#d581d6","#d6819f","#d68d8d","#e59881","#d6d678","#95d681","#81d6a1","#81d6ce","#81bad6","#92b2d6"],zcal.DFORMAT=["MM/dd/yyyy","dd/MM/yyyy","yyyy/MM/dd","yyyy-MM-dd"],zcal.timeformat=["hh:mm a","HH:mm"],zcal.msec_hour=36e5,zcal.msec_minute=6e4,zcal.hrgrid_lsec_width=81,zcal.ttipformat="MMM dd",zcal.qevent_format="E, NNN dd",zcal.QEDITFMT="MMM dd, yyyy",zcal.CALMODE=0,zcal.isTaskUser=!1,zcal.isCRMUser=!1,zcal.isWindowResized=!1,zcal.reconstructView=!1,zcal.settingsUpdated=!1,zcal.timezoneupdated=!1,zcal.alldayScrollTop=0,zcal.hrgridSrollTop=0,zcal.isSubToCalUpd=!1,zcal.workDays=[],zcal.refreshTimer=null,zcal.refreshMode,zcal.appChild={},zcal.appCount={},zcal.groupChild={},zcal.groupCount={},zcal.localTime=(new Date).getTime();var ZCL_CALNAME="";zcal.time=["12:00 am","12:30 am","1:00 am","1:30 am","2:00 am","2:30 am","3:00 am","3:30 am","4:00 am","4:30 am","5:00 am","5:30 am","6:00 am","6:30 am","7:00 am","7:30 am","8:00 am","8:30 am","9:00 am","9:30 am","10:00 am","10:30 am","11:00 am","11:30 am","12:00 pm","12:30 pm","1:00 pm","1:30 pm","2:00 pm","2:30 pm","3:00 pm","3:30 pm","4:00 pm","4:30 pm","5:00 pm","5:30 pm","6:00 pm","6:30 pm","7:00 pm","7:30 pm","8:00 pm","8:30 pm","9:00 pm","9:30 pm","10:00 pm","10:30 pm","11:00 pm","11:30 pm"],zcal.REM=["300000","600000","900000","1200000","1500000","1800000","2700000","3600000","7200000","14400000","21600000","28800000","43200000","86400000","172800000","259200000","345600000","432000000","518400000","604800000","691200000","777600000","864000000","950400000","1036800000","1123200000","1209600000","1296000000","2592000000","3888000000","5184000000","7776000000"],zcal.ZCL_STREAMGROUPLIST=[];var zcalInit=function(){var headerObj={},actionObj={list:[{groupId:"action",actionArr:[{iconList:["msi-action","msi-barrow"],dropAction:!0,data:"act"}]},{groupId:"view",actionArr:[{iconList:["Day"],text:!0,tooltip:"Day",data:"day"},{iconList:["Week"],text:!0,tooltip:"Week",data:"week"},{iconList:["Work"],text:!0,tooltip:"Work",data:"work"},{iconList:["Month"],text:!0,tooltip:"Month",data:"month"},{iconList:["Agenda"],text:!0,tooltip:"Agenda",data:"agenda"}]},{groupId:"sadd",actionArr:[{iconList:["Smart Add"],text:!0,align:"right",data:"sadd"}]}]},getHeaderDOM=function(){var headerDOM,saddDOM,viewDOM,prntDOM,header=["DIV",{attrs:{id:"zcl_header","class":"zcl zcl_tpnvcn"},child:[["DIV",{attrs:{"class":"zcl_table"},child:[["UL",{child:[["LI",{child:[["DIV",{attrs:{id:"zcl_sadd"},child:[["B",{child:[["I",{attrs:{"class":"msi-add"}}]]}]]}]]}],["LI",{attrs:{id:"zcl_headerlbl"}}],["LI",{attrs:{"class":"zcl_txr zcl_tpnv",id:"zcl_view"}}],["LI",{attrs:{"class":"zcl_tppnt"},child:[["DIV",{attrs:{id:"zcl_print","class":"SCmb"}}]]}]]}]]}]]}];headerDOM=_zm.getDOM(header),saddDOM=headerDOM.querySelector("#zcl_sadd"),saddDOM.addEventListener("click",function(){ZCL_openSAdd(this)}),viewDOM=headerDOM.children[0].children[0].children[2];for(var i in headerObj.view){var _v=headerObj.view[i],vEle=$("<div "+(i==zcal.view?"class='zcl_sl'":"")+">"+_v.text+"</div>");vEle.attr("data-vid",i),zmComponent.tooltip({elm:vEle[0],text:_v.tooltip,arrow:"top"}),vEle.off("click").click(function(){var ele=$(this);ele.parent().find("DIV").removeClass("zcl_sl"),ele.addClass("zcl_sl"),zcalView.change(ele.attr("data-vid"))}),viewDOM.appendChild(vEle[0])}return prntDOM=headerDOM.querySelector("#zcl_print"),prntDOM.innerHTML='<b><div class="SC_hd"></div><i class="msi-print"/></b>',zmComponent.tooltip({elm:prntDOM,text:zcal.i18n.print,arrow:"top"}),prntDOM.addEventListener("click",function(){var $prntEle=$(this);$prntEle.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:$prntEle,list:getPrintDrop(),align:"pright",clk:function(a,b){zcalList.bindAction(a,b)}})}),headerDOM},updateHeaderBand=function(txt,vno){var labelDOM=$("#zcl_headerlbl");if(labelDOM.addClass("SC_lbr"),4==zcal.view)labelDOM.html('<div class="SC_hd"></div><div><div class="zcl_tpdtmth">'+txt+'</div><input id="zcl_mini" type="text" style="display:none"></div>');else{labelDOM.empty();var todayEle,rnvg=$('<div class="zcl_tprr">'),lblEle=$("<div>"),lnvg=$('<div class="zcl_tplr">');todayEle=$("<span/>"),4!=vno&&todayEle.text(zcal.i18n.today),labelDOM.append('<div class="SC_hd"></div>');var inRange=zcalView.isTodayInViewRange(vno);inRange?labelDOM.append($('<div class="zcl_tody zcl_grey"/>').append(todayEle)):(todayEle.off("click").click(function(){zcalView.goToday()}),labelDOM.append($('<div class="zcl_tody zcl_tpdyyr"/>').append(todayEle))),lnvg.html('<i class="msi-larrow"></i>'),lnvg.off("click").click(function(){zcalView.goPrev()}),labelDOM.append(lnvg),rnvg.html('<i class="msi-rarrow"></i>'),rnvg.off("click").click(function(){zcalView.goNext()}),labelDOM.append(rnvg),lblEle.append('<div class="zcl_tpdtmth">'+txt+'</div><input id="zcl_mini" type="text" style="display:none">'),labelDOM.append(lblEle)}labelDOM.find("#zcl_mini").click(function($){var dateInpElem=labelDOM.find("#zcl_mini")[0];dateInpElem.value=zcal.today.getDateBy("MM/dd/yyyy"),$(labelDOM.find(".zcl_tpdtmth")[0].parentNode).picker("date",{dform:"MM/DD/YYYY",wkst:0,mode:"popup",update:"no",fullDtclk:1,customdate:"yes",pickerview:3==zcal.view||4==zcal.view?"month":"",range:["01/01/1970","12/31/2100"]}).on("dateclick",function(){var da=this.getDate().getDate(),mon=this.getDate().getMonth(),yea=this.getDate().getFullYear();4!=zcal.view?zcalView.goDate(da,mon,yea):zcalAgenda.dispEvents(this.getDate())}).bind()}(ZEVENTS))},formatCalData=function(cobj,corder){var calObj={};if(corder)for(var i=0;i<corder.length;i++){var calId=corder[i];"1"==cobj[calId][8]?(calObj[calId]={ID:calId,CN:""==cobj[calId][0]?"UNTITLED":cobj[calId][0],CC:ZCL_getCalColor(cobj[calId][1])[1],STS:cobj[calId][2]},0==cobj[calId][2]?zcal.disabledcal+=calId+",":ZCL_CALNAME+=(""==ZCL_CALNAME?"":",")+cobj[calId][0]):zcal.disabledcal+=calId+","}else for(var i in cobj)"1"==cobj[i][8]?(calObj[i]={ID:i,CN:""==cobj[i][0]?"UNTITLED":cobj[i][0],CC:ZCL_getCalColor(cobj[i][1])[1],STS:cobj[i][2]},"crm"==cobj[i][14]&&(calObj[i].HC=1,calObj[i].E=1),0==cobj[i][2]?zcal.disabledcal+=i+",":ZCL_CALNAME+=(""==ZCL_CALNAME?"":",")+cobj[i][0]):zcal.disabledcal+=i+",";return calObj},ZCL_calSort=function(calgrpArr){return calgrpArr.sort(function(a,b){var nameA=a.value.toUpperCase(),nameB=b.value.toUpperCase();return nameB>nameA?-1:nameA>nameB?1:0}),calgrpArr},ZCL_setGrpCal=function(){var calObj={},temp=[],obj={},tmpObj=zcal.cdata.calByGrp;for(var i in zcal.cdata.grpLst)for(var j in zcal.cdata.grpLst[i])obj={id:j,value:zcal.cdata.grpLst[i][j].GNAME},temp.push(obj);var calG=ZCL_calSort(temp);zcal.cdata.gcalbyOdrArr=[];for(var j in calG)zcal.cdata.gcalbyOdrArr.push(calG[j].id);zcal.groupChild={},zcal.groupCount={};for(var i in zcal.cdata.gcalbyOdrArr){var id=zcal.cdata.gcalbyOdrArr[i],grp=zcal.cdata.grpLst.pgrp[id]||zcal.cdata.grpLst.ogrp[id];if(grp&&tmpObj[id]){var calcnt=Object.keys(tmpObj[id]).length;if(0!=calcnt){if(grp.ISADMIN||calcnt>1){zcal.groupCount[id]={c:"0",p:"-1"},calObj[id]={ID:id,CN:grp.GNAME,CC:zcal.calcolor[0][1],STS:"1",HC:"1",E:"1"};var ch={},temp1=[];seCount=0;for(var i in tmpObj[id])obj={id:i,value:tmpObj[id][i][0]},temp1.push(obj);var grpChildAr=ZCL_calSort(temp1),grpArr=[];for(var j in grpChildAr)grpArr.push(grpChildAr[j].id);for(var i in grpArr){var calId=grpArr[i];zcal.groupCount[calId]={c:"0",p:id};var cobj=zcal.cdata.calGLst[calId];seCount+=1,"1"==cobj[8]?(ch[calId]={CN:cobj[0],CC:ZCL_getCalColor(cobj[1])[1],ID:i,STS:cobj[2],HC:0,SE:seCount},0==cobj[2]?zcal.disabledcal+=calId+",":ZCL_CALNAME+=(""==ZCL_CALNAME?"":",")+cobj[0]):zcal.disabledcal+=calId+","}zcal.groupCount["addCal_"+grp.GID]={c:"0",p:id},ch["addCal_"+grp.GID]={CN:"Add Calendar",addNewType:!0,ID:"addCal_"+grp.GID,STS:"1",CC:"0",HC:0,SE:seCount+1},zcal.groupChild[id]={CH:ch}}else for(var i in tmpObj[id]){zcal.groupCount[i]={c:"0",p:"-1"};var cobj=zcal.cdata.calGLst[i];"1"==cobj[8]?(calObj[i]={ID:i,CN:cobj[0],CC:ZCL_getCalColor(cobj[1])[1],STS:cobj[2]},0==cobj[2]?zcal.disabledcal+=i+",":ZCL_CALNAME+=(""==ZCL_CALNAME?"":",")+cobj[0]):zcal.disabledcal+=i+","}}}}return calObj},getMonthLimit=function(d){var msday,meday,nod,dateSt=new Date,dateEd=new Date,_wks=zcal.cdata.opt.WK;return dateSt.setTime(d),dateEd.setTime(d),dateSt.setMonth(dateSt.getMonth()),dateSt.setDate(1),msday=dateSt.getDay(),dateSt.setDate(1-dateSt.getDay()),dateSt.setDate(_wks>msday?dateSt.getDate()-(7-_wks):dateSt.getDate()+_wks),nod=dateEd.getDaysInMonth(),dateEd.setDate(nod),meday=dateEd.getDay(),dateEd.setDate(dateEd.getDate()+6-dateEd.getDay()),dateEd.setDate(_wks>meday?dateEd.getDate()-(7-_wks):dateEd.getDate()+_wks),[dateSt,dateEd]},checkDate=function(dnew){var dateNw=new Date;return dateNw.setTime(dnew),dateNw.setDate(15),dateNw>=zcal.mlimit[0]&&dateNw<=zcal.mlimit[1]?!0:!1},scrollWidth=function(){var div1=document.createElement("div");div1.style.overflow="scroll",div1.style.width="100%";var div2=document.createElement("div");if(div2.style.overflow="hidden",div2.style.width="100%",div1.appendChild(div2),document.documentElement.clientHeight){document.documentElement.appendChild(div1);var scrl=div1.offsetWidth-div2.offsetWidth;return document.documentElement.removeChild(div1),scrl}document.body.appendChild(div1);var scrl=div1.offsetWidth-div2.offsetWidth;return document.body.removeChild(div1),scrl},getActionDrop=function(){var actArr=[{htm:"Create Calendar",data:{action:"create-cal"}},{htm:"Import",data:{action:"import"}},{htm:"Subscribe",data:{action:"subscribe"}},{htm:"Settings",data:{action:"settings"}}];return actArr},getPrintDrop=function(){var ddArr=[{htm:zcal.i18n.print,data:{action:"print"}},{htm:zcal.i18n.printpreview,data:{action:"printPreview"}},{htm:zcal.i18n.savepdf,data:{action:"savePdf"}}];return ddArr},getSubscribeURL=function(){for(var qs=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<qs.length;i++){var pName=qs[i].split("=");if("url"===pName[0])return pName[1]}},_onCalendarAppHashURLChange=function(params){var router=this;if(params=params||{},params.length){var hash=params[0];if(-1!==hash.indexOf("subscribe?")){var subURL=getSubscribeURL();subURL&&$.when(zcalSettings.Subscribe.confirmAndSubscribe(subURL)).done(function(){router.update([])})}}},initObj={prevHeader:{id:"zcalPrevHeader",text:"Preview Text",rIcons:[[{tooltip:"Close",tooltipDir:"right",iconClass:"msi-close",data:{action:"closePrev"}}]]},init:function(){var appRouter=null;"function"==typeof zmsuite.createAppRouter&&(appRouter=zmsuite.createAppRouter());var calAppObj={appname:zcal.i18n.calendar,appId:"zcal_Container",appIcon:"msi-calendar",customHeader:!0,data:{LNodes:"2",CNodes:"3"},handler:{create:function(){zcalUtil.createEvent()},settings:function(){}},router:appRouter};null!==appRouter&&appRouter.initialize({hashKey:"calendar",handler:_onCalendarAppHashURLChange}),zmsuite.setAppInfo(calAppObj)},initCalData:function(){zcal.mcal=formatCalData(zcal.cdata.calLst,zcal.cdata.calOrdArr),ZCL_updateGroupCalList(),ZCL_updateAppCalList(),zcal.acal=formatCalData(zcal.cdata.calALst),zcal.ocal=formatCalData(zcal.cdata.calOLst)},bindLeftActions:function(data){var layerType,elem,etype,eobj,layerId;if(data=data.zmsData,etype=data.type,eobj=data.eventInfo,elem=eobj.srcElement||eobj.target,layerId=data.rowInfo.layerId,layerType=data.rowInfo.type,"contextmenu"==etype)zcalList.calUtility(eobj,elem,layerId,data.rowObject);else if("click"==etype&&"list"==layerType&&-1==eobj.currentTarget.id.indexOf("addCal"))zcalList.chgeCalStatus(eobj,data.rowObject);else if(-1!=eobj.currentTarget.id.indexOf("addCal")){var grpId=eobj.currentTarget.id.split("_")[1];ZCL_createCal(grpId)}},bindActionHeaderIcons:function(ev,iconName,data){var elem=ev.srcElement||ev.target;switch(data){case"day":zcal.view=0,zcalView.constGridView();break;case"week":case"work":zcal.view="work"==data?2:1,zcalView.constGridView();break;case"month":zcal.view=3,zcalView.constGridView();break;case"agenda":zcal.view=4,zcalView.constGridView();break;case"sadd":ZCL_openSAdd(elem);break;case"act":var parElem=$(elem).closest("li"),list=getActionDrop();list&&(parElem.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:parElem,list:list,align:"pleft",clk:function(a,b){zcalList.bindAction(a,b)}}));break;case"edit":break;case"save":ZCL_svEve();break;case"delete":}},constructLeft:function(){var leftNodes,layArr=[];leftNodes=zcal.calLeft.getNodes();var mLayerObj,folMapObj={id:"ID",name:"CN",color:"CC",check:"STS",count:"c",hasChild:"HC",expChild:"E",seq:"SE"},mCalLayer=new ZMLayer;if(mLayerObj={type:"5",listId:"zcl_mcalL",hasChild:!0,mapObject:folMapObj,id:"zcl_mcal",dataObject:{headerObject:{licon:"msi-folder",id:"zcl_mcalH",name:zcal.i18n.mycal,showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){ZCL_createCal()}},listObject:zcal.mcal}},mCalLayer.push(mLayerObj),layArr.push(mCalLayer),!$.isEmptyObject(zcal.acal)){var aLayerObj,aCalLayer=new ZMLayer;aLayerObj={type:"5",listId:"zcl_acalL",hasChild:!0,mapObject:folMapObj,id:"zcl_acal",dataObject:{headerObject:{licon:"msi-folder",id:"zcl_acalH",name:zcal.i18n.appcal,showList:!0},listObject:zcal.acal}},Object.keys(zcal.appChild).length>0&&(aLayerObj.type="6",aLayerObj.hasCountObject=!0,aLayerObj.dataObject.childObject=zcal.appChild,aLayerObj.dataObject.countObject=zcal.appCount),aCalLayer.push(aLayerObj),layArr.push(aCalLayer)}var gLayerObj,gCalLayer=new ZMLayer;if(gLayerObj={type:"5",listId:"zcl_gcalL",hasChild:!0,mapObject:folMapObj,id:"zcl_gcal",dataObject:{headerObject:{licon:"msi-folder",id:"zcl_gcalH",name:zcal.i18n.grpcal,showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){ZCL_createGrpCal()}},listObject:zcal.gcal}},Object.keys(zcal.groupChild).length>0&&(gLayerObj.type="6",gLayerObj.hasCountObject=!0,gLayerObj.dataObject.childObject=zcal.groupChild,gLayerObj.dataObject.countObject=zcal.groupCount),gCalLayer.push(gLayerObj),layArr.push(gCalLayer),!$.isEmptyObject(zcal.ocal)){var oLayerObj,oCalLayer=new ZMLayer;oLayerObj={type:"5",listId:"zcl_ocalL",hasChild:!0,mapObject:folMapObj,id:"zcl_ocal",dataObject:{headerObject:{licon:"msi-folder",id:"zcl_ocalH",name:zcal.i18n.othcal,showList:!0},listObject:zcal.ocal}},oCalLayer.push(oLayerObj),layArr.push(oCalLayer)}leftNodes[0].push({layerArr:layArr}),zcal.calLeft.render(),zcal.calLeft.setListener("click",function(data){zcalInit.bindLeftActions(data)}),zcal.calLeft.setListener("contextmenu",function(data){zcalInit.bindLeftActions(data)}),$.isEmptyObject(zcal.acal)||leftNodes[0].getLayer("zcl_acal").setChildToggle(function(){window.console.log("ZM_LHS",">>>","Child Toggle Called")}),$.isEmptyObject(zcal.gcal)||leftNodes[0].getLayer("zcl_gcal").setChildToggle(function(){window.console.log("ZM_LHS",">>>","Child Toggle Called")})},constructCenter:function(){var centerWrapper=zmsuite.getCenter(),centerObj=centerWrapper[0].getNodes();centerObj[0].push(actionObj.list),centerObj[0].setListener("click",function(event,iconName,data){zcalInit.bindActionHeaderIcons(event,iconName,data)});var headerDOM=getHeaderDOM();zmsuite.getCenter()[0].$el.prepend(headerDOM),zmsuite.renderCenter(),zmsuite.showApp("zcal_Container");var _togEle=document.getElementsByClassName("zm_togglerpane");_togEle.length>0&&(_togEle[0].onclick=function(){setTimeout(function(){zcalView.constGridView()},300)})},constructView:function(){zcal.calLeft=zmsuite.getLeft(),zcal.calRight=zmsuite.getRight(),zcalInit.constructLeft(),zcalInit.constructCenter(),zcal.calCenter=zmsuite.getCenter(),zcal.calCenter.listElem=zcal.calCenter[0].getNodes()[2].$el[0],zcal.calCenter.headerElem=zcal.calCenter[0].getNodes()[0].$el[0],zcal.calRight=zmsuite.getRight().$el},initCal:function(){zcalInit.initCalData(),zcalInit.init(),zcalInit.constructView(),zcalInit.initCalView()},initCalView:function(){zcalView.constGridView(),zcalEvents.loadMonthData(!0),ZCL_CheckUserInOtherServices(),0==zcal.CALMODE&&ZCL_getSubGrpLst()},initGlobalVar:function(){zcal.zuid=zcal.cdata.opt.ZUID,zcal.zoid=zcal.cdata.opt.ZOID,headerObj={view:[{text:zcal.i18n.vday,tooltip:zcal.i18n.vday,data:0},{text:zcal.i18n.week,tooltip:zcal.i18n.week,data:1},{text:zcal.i18n.work,tooltip:zcal.i18n.work,data:2},{text:zcal.i18n.month,tooltip:zcal.i18n.month,data:3},{text:zcal.i18n.agenda,tooltip:zcal.i18n.agenda,data:4}]},zcal.view=zcal.cdata.opt.DEF,zcal.cdate=ZCL_parseDateTimeStr(zcal.cdata.opt.DATE_STR).getTime(),setInterval(function(){var cTime=(new Date).getTime();zcal.localTime<cTime&&(zcal.cdate+=cTime-zcal.localTime,zcal.localTime=cTime);var date=new Date(zcal.cdate);date.dateBy("yyyyMMdd")!=zcal.chkDate.dateBy("yyyyMMdd")&&(zcal.chkDate=new Date(zcal.cdate),zcalView.constGridView())},1e3),zcal.today=new Date,zcal.today.setTime(zcal.cdate),zcal.chkDate=new Date(zcal.cdate),zcal.mlimit=zcalInit.getMonthLimit(zcal.cdata.opt.DATE),Date.MONTH_NAMES=[[zcal.i18n.january,zcal.i18n.february,zcal.i18n.march,zcal.i18n.april,zcal.i18n.may,zcal.i18n.june,zcal.i18n.july,zcal.i18n.august,zcal.i18n.september,zcal.i18n.october,zcal.i18n.november,zcal.i18n.december],[zcal.i18n.jan,zcal.i18n.feb,zcal.i18n.mar,zcal.i18n.apr,zcal.i18n.may,zcal.i18n.jun,zcal.i18n.jul,zcal.i18n.aug,zcal.i18n.sep,zcal.i18n.oct,zcal.i18n.nov,zcal.i18n.dec]],Date.WEEK_DAYS=[[zcal.i18n.sunday,zcal.i18n.monday,zcal.i18n.tuesday,zcal.i18n.wednesday,zcal.i18n.thursday,zcal.i18n.friday,zcal.i18n.saturday],[zcal.i18n.sun,zcal.i18n.mon,zcal.i18n.tue,zcal.i18n.wed,zcal.i18n.thu,zcal.i18n.fri,zcal.i18n.sat]],zcal.REPEAT_FREQ=[zcal.i18n.daily,zcal.i18n.weekly,zcal.i18n.monthly,zcal.i18n.yearly],zcal.WEEK_TYPE=[zcal.i18n.first,zcal.i18n.second,zcal.i18n.third,zcal.i18n.fourth,zcal.i18n.last],zcal.ALARM_REMTYPE={0:zcal.i18n.before,1:zcal.i18n.after},zcal.ALARM_ACTTYPE={0:zcal.i18n.byemail,1:zcal.i18n.bypopup},zcal.DATEFORMAT=[zcal.i18n.dform1,zcal.i18n.dform2,zcal.i18n.dform3,zcal.i18n.dform4],zcal.TIMEFORMAT=["1:00 "+zcal.i18n.pm,"13:00"],zcal.HOURS=["12:00 "+zcal.i18n.am,"1:00 "+zcal.i18n.am,"2:00 "+zcal.i18n.am,"3:00 "+zcal.i18n.am,"4:00 "+zcal.i18n.am,"5:00 "+zcal.i18n.am,"6:00 "+zcal.i18n.am,"7:00 "+zcal.i18n.am,"8:00 "+zcal.i18n.am,"9:00 "+zcal.i18n.am,"10:00 "+zcal.i18n.am,"11:00 "+zcal.i18n.am,"12:00 "+zcal.i18n.pm,"1:00 "+zcal.i18n.pm,"2:00 "+zcal.i18n.pm,"3:00 "+zcal.i18n.pm,"4:00 "+zcal.i18n.pm,"5:00 "+zcal.i18n.pm,"6:00 "+zcal.i18n.pm,"7:00 "+zcal.i18n.pm,"8:00 "+zcal.i18n.pm,"9:00 "+zcal.i18n.pm,"10:00 "+zcal.i18n.pm,"11:00 "+zcal.i18n.pm],zcal.DEFAULTVIEW=[zcal.i18n.vday,zcal.i18n.week,zcal.i18n.work,zcal.i18n.month,zcal.i18n.agenda],zcal.REMSTR={300000:"5 "+zcal.i18n.mins,600000:"10 "+zcal.i18n.mins,900000:"15 "+zcal.i18n.mins,1200000:"20 "+zcal.i18n.mins,1500000:"25 "+zcal.i18n.mins,1800000:"30 "+zcal.i18n.mins,2700000:"45 "+zcal.i18n.mins,3600000:"1 "+zcal.i18n.hr,7200000:"2 "+zcal.i18n.hrs,14400000:"4 "+zcal.i18n.hrs,21600000:"6 "+zcal.i18n.hrs,28800000:"8 "+zcal.i18n.hrs,43200000:"12 "+zcal.i18n.hrs,86400000:"1 "+zcal.i18n.day,172800000:"2 "+zcal.i18n.days,259200000:"3 "+zcal.i18n.days,345600000:"4 "+zcal.i18n.days,432000000:"5 "+zcal.i18n.days,518400000:"6 "+zcal.i18n.days,604800000:"7 "+zcal.i18n.days,691200000:"8 "+zcal.i18n.days,777600000:"9 "+zcal.i18n.days,864000000:"10 "+zcal.i18n.days,950400000:"11 "+zcal.i18n.days,1036800000:"12 "+zcal.i18n.days,1123200000:"13 "+zcal.i18n.days,1209600000:"14 "+zcal.i18n.days,1296000000:"15 "+zcal.i18n.days,2592000000:"30 "+zcal.i18n.days,3888000000:"45 "+zcal.i18n.days,5184000000:"60 "+zcal.i18n.days,7776000000:"90 "+zcal.i18n.days},zcal.AGENDA_INTERVAL={"-1":zcal.i18n.none,0:zcal.i18n.daily,1:zcal.i18n.weekly},zcal.FREEBUSY_DD=[zcal.i18n.alltimes,zcal.i18n.workinghours],zcal.emlNfy=void 0!=zcal.cdata.orgAdmOpt.MOD_NOTIFY_EMAIL?zcal.cdata.orgAdmOpt.MOD_NOTIFY_EMAIL:"-1",zcal.sendInv=void 0!=zcal.cdata.orgAdmOpt.SEND_INVITATION?zcal.cdata.orgAdmOpt.SEND_INVITATION:"-1",zcal.subCal=void 0!=zcal.cdata.orgAdmOpt.CAL_SUBSCRIBE?zcal.cdata.orgAdmOpt.CAL_SUBSCRIBE:"-1",zcal.shrCal=void 0!=zcal.cdata.orgAdmOpt.CAL_SHARE?zcal.cdata.orgAdmOpt.CAL_SHARE:"-1",zcal.impExp=void 0!=zcal.cdata.orgAdmOpt.IMPORT_EXPORT?zcal.cdata.orgAdmOpt.IMPORT_EXPORT:"-1",zcal.holCal=void 0!=zcal.cdata.orgAdmOpt.CAL_HOLIDAY?zcal.cdata.orgAdmOpt.CAL_HOLIDAY:"-1",zcal.pvtUrl=void 0!=zcal.cdata.orgAdmOpt.PRIVATE_URL?zcal.cdata.orgAdmOpt.PRIVATE_URL:"-1",zcal.workDays=ZCL_setWorkDays(),zcalGroup.loadGroup(),zcalCRM.loadCRMUsers()},updateHeaderBand:updateHeaderBand,formatCalData:formatCalData,ZCL_setGrpCal:ZCL_setGrpCal,getMonthLimit:getMonthLimit,checkDate:checkDate,scrollWidth:scrollWidth};return initObj}();zcal.dataLoaded=zcal.sentReq=!1,loadZCal=function(msMode,eObj){msMode=msMode?msMode:"calapp",zcal.dataLoaded?ZCL_openApp(msMode,eObj):zcal.sentReq||(ZCL_uXHR("/ncal/index.do?mode="+msMode,function(res){zcal.retLoad(res),ZCL_openApp(msMode,eObj)}),zcal.sentReq=!0)},ZCL_openApp=function(msMode,eObj){if(zcal.isSubToCalUpd||ZCL_subscribeToCalUpdate(),"event"===msMode)zcalUtil.createEvent(eObj);else if("settings"===msMode)eObj&&eObj.resolve({settings:zcalSettings.getCalConfig()});else if(zmsuite.isWorkspaceAvailable("zcal_Container")){var curAppObj=zmsuite.getAppObj("zcal_Container");zmTab.setTabForApp(curAppObj.obj),zmsuite.showApp("zcal_Container"),zcal.calLeft.setListener("click",function(data){zcalInit.bindLeftActions(data)}),zcal.calLeft.setListener("contextmenu",function(data){zcalInit.bindLeftActions(data)})}else"c"===zmApp.selectedApp&&zcalInit.initCal()},zcal.retLoad=function(res){var resObj=JSON.parse(res.responseText);resObj&&(zcal.dataLoaded=!0,zcal.cdata=resObj.cdata,zcal.i18n=resObj.i18n,zcal.isAttach=resObj.ISATTACH,zcal.ZCRM_OBJ=zcal.cdata.crmOrgObj,zcal.ZCRM=resObj.ZCRM,zcal.ZMET=resObj.ZMET,zcal.ZTSK=resObj.ZTSK,zcal.ZNTS=resObj.ZNTS,zcal.ZMIL=resObj.ZMIL,zcal.ZCAL=resObj.ZCAL,zcal.ZRECRUIT=resObj.ZRECRUIT,zcal.ZCAL_MULTICAL_4_GRP=resObj.ZCAL_MULTICAL_4_GRP,zcal.cssPath=resObj.CSSPATH,zcal.OUTLOOK32=resObj.OUTLOOK32,zcal.OUTLOOK64=resObj.OUTLOOK64,zcal.GCALSYNC=resObj.GCALSYNC,zcal.ZOHOSTATIC=resObj.ZOHOSTATIC,zcal.jsPath=resObj.JSPATH,zcal.imgPath=resObj.IMGPATH,zcal.TSTAMP=resObj.TSTAMP,zcalInit.initGlobalVar(),ZCL_setGrpOdr())},zcal.win.onresize=function(){zcal.isWindowResized=!0,"c"==zmApp.currentApp&&ZCL_resizeCalendar()},$.subscribe("/calendar/load",function(){loadZCal("calapp")}),$.subscribe("/calendar/event",function(ev,eObj){loadZCal("event",eObj)}),$.subscribe("/calendar/settings",function(event,deferred){loadZCal("settings",deferred)}),ZCL_resizeCalendar=function(){"zcal_Container"==zmTab.currentTab&&4!=zcal.view&&zcalView.constGridView()},$.subscribe("zmsuite/lhsResize",function(){"zcal_Container"==zmTab.currentTab&&4!=zcal.view&&zcalView.constGridView()}),$.subscribe("/integ/rhs",function(){"zcal_Container"==zmTab.currentTab&&4!=zcal.view&&zcalView.constGridView()}),$.subscribe("/apps/tabSwitched",function(e,nextId){"zcal_Container"==nextId&&(zcalView.setCurrentTimeLine(zcal.cdate),(zcal.isWindowResized&&4!=zcal.view||zcal.reconstructView||zcal.settingsUpdated||zcal.timezoneupdated)&&(zcal.isWindowResized=!1,zcal.reconstructView=!1,zcalView.constGridView(),zcal.settingsUpdated&&zcalInit.constructLeft(),zcal.settingsUpdated=!1,zcal.timezoneupdated&&(zcalView.setCurrentTimeLine(zcal.cdate),zcalEvents.loadMonthData()),zcal.timezoneupdated=!1))}),$.subscribe("/user/languageChanged",function(){ZCL_handleLanguageChange()}),Date.LZ=function(x){return(0>x||x>9?"":"0")+x},Date.prototype.getDaysInMonth=function(){var tempDate=new Date(this.getFullYear(),this.getMonth(),1);return new Date(tempDate.getFullYear(),tempDate.getMonth()+1,0).getDate()},Date.prototype.clone=function(){var newd=new Date;return newd.setTime(this.getTime()),newd},Date.prototype.getWeek=function(){var jan1Day,wNo,_jan1=new Date(this.getFullYear(),0,1,0,0,0,0);jan1Day=_jan1.getDay(),_jan1.setDate(_jan1.getDate()-_jan1.getDay());var _tdat=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0,0);return _tdat.setDate(_tdat.getDate()-_tdat.getDay()),wNo=4>=jan1Day?Math.ceil((_tdat-_jan1)/864e5/7)+1:Math.ceil((_tdat-_jan1)/864e5/7),11==_tdat.getMonth()&&(_tdat.setDate(_tdat.getDate()+6),wNo=0==_tdat.getMonth()&&_tdat.getDate()>2?1:wNo),wNo},Date.prototype.dateBy=function(format){format+="";var H,result="",i_format=0,c="",token="",y=this.getYear()+"",M=this.getMonth()+1,d=this.getDate(),E=this.getDay(),H=this.getHours(),m=this.getMinutes(),s=this.getSeconds(),value={};for(y.length<4&&(y=""+(+y+1900)),value.y=""+y,value.yyyy=y,value.yy=y.substring(2,4),value.M=M,value.MM=Date.LZ(M),value.MMM=Date.MONTH_NAMES[0][M-1],value.NNN=Date.MONTH_NAMES[1][M-1],value.d=d,value.dd=Date.LZ(d),value.E=Date.WEEK_DAYS[1][E],value.EE=Date.WEEK_DAYS[0][E],value.H=H,value.HH=Date.LZ(H),value.h=0==H?12:H>12?H-12:H,value.hh=Date.LZ(value.h),value.K=value.h-1,value.k=value.H+1,value.KK=Date.LZ(value.K),value.kk=Date.LZ(value.k),value.a=H>11?"pm":"am",value.m=m,value.mm=Date.LZ(m),value.s=s,value.ss=Date.LZ(s);i_format<format.length;){for(c=format.charAt(i_format),token="";format.charAt(i_format)==c&&i_format<format.length;)token+=format.charAt(i_format++);result+=null!=value[token]?value[token]:token}return result};var zcalList=function(){var listObj={bindAction:function(data){if(data){var mode=data.action;switch(mode){case"edit":zmUtil.hideMenu(),zmAppLoader.load("zm-settings-mailsuite-appcore").then(function(){zmail.Settings.MailSuite.App.openApp().then(function(){setTimeout(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage("calendar-mgaocalendars").then(function(){var mgaocal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;AppFramework.requestPreviewCard({getView:function(){var cobj=zcal.cdata.calLst[data.id]||zcal.cdata.calGLst[data.id]||zcal.cdata.calOLst[data.id]||zcal.cdata.calALst[data.id],ty="my";return"group"==cobj[14]?(ty="groups",mgaocal.groupCalendarView()):("ztask"==cobj[14]||"crm"==cobj[14]||"zprojects"==cobj[14]||"zcontacts"==cobj[14])&&(mgaocal.appCalendarView(),ty="apps"),mgaocal.openDetail(data.id,cobj,ty)}}).then(function(args){args.card.show()})}).fail(function(){})},100)})});break;case"share":zmUtil.hideMenu(),"undefined"==typeof zmail._newSettings?zmAppLoader.load("zm-settings-mailsuite-appcore").then(function(){zmail.Settings.MailSuite.App.openApp().then(function(){setTimeout(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage("calendar-mgaocalendars").then(function(){var mgaocal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;AppFramework.requestPreviewCard({getView:function(){var cobj=zcal.cdata.calLst[data.id]||zcal.cdata.calGLst[data.id]||zcal.cdata.calOLst[data.id],ty="my";return"group"==cobj[14]?(ty="groups",mgaocal.groupCalendarView()):("ztask"==cobj[14]||"crm"==cobj[14]||"zprojects"==cobj[14]||"zcontacts"==cobj[14])&&(mgaocal.appCalendarView(),ty="apps"),mgaocal.openShare(data.id,cobj,ty)}}).then(function(args){args.card.show()})}).fail(function(){})},100)})}):zmAppLoader.load("settings").then(function(){zmailSettings.init("calendar","zcalSettings."+data.type+"CalList",data)});break;case"embed":zmUtil.hideMenu(),"undefined"==typeof zmail._newSettings?zmAppLoader.load("zm-settings-mailsuite-appcore").done(function(){zmail.Settings.MailSuite.App.openApp().done(function(){setTimeout(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage("calendar-mgaocalendars").done(function(){var mgaocal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;AppFramework.requestPreviewCard({getView:function(){var cobj=zcal.cdata.calLst[data.id]||zcal.cdata.calGLst[data.id]||zcal.cdata.calOLst[data.id],ty="my";return"group"==cobj[14]?(ty="groups",mgaocal.groupCalendarView()):("ztask"==cobj[14]||"crm"==cobj[14]||"zprojects"==cobj[14]||"zcontacts"==cobj[14])&&(mgaocal.appCalendarView(),ty="apps"),mgaocal.openEmbed(data.id,cobj,ty)}}).done(function(args){args.card.show()})}).fail(function(){})},100)})}):zmAppLoader.load("settings").then(function(){ZCL_openEmbed(data.id)});break;case"member":zmUtil.hideMenu(),zmAppLoader.load("zm-settings-mailsuite-appcore").done(function(){zmail.Settings.MailSuite.App.openApp().done(function(){setTimeout(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage("calendar-mgaocalendars").done(function(){var mgaocal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;AppFramework.requestPreviewCard({getView:function(){var cobj=zcal.cdata.calLst[data.id]||zcal.cdata.calGLst[data.id]||zcal.cdata.calOLst[data.id],ty="my";return"group"==cobj[14]?(ty="groups",mgaocal.groupCalendarView()):("ztask"==cobj[14]||"crm"==cobj[14]||"zprojects"==cobj[14]||"zcontacts"==cobj[14])&&(mgaocal.appCalendarView(),ty="apps"),mgaocal.openGrpMem(data.id,cobj,ty)}}).done(function(args){args.card.show()})}).fail(function(){})},100)})});break;case"empty":ZCL_empCal(data.id),zmUtil.hideMenu();break;case"delete":case"unsubscribe":var isUnSub="unsubscribe"===mode?!0:!1;ZCL_delCal(data.id,isUnSub),zmUtil.hideMenu();break;case"closePrev":ZCL_eClose();break;case"create-cal":zcal.createCal();break;case"import":break;case"subscribe":break;case"settings":break;case"eventSave":ZCL_svEve();break;case"crmEventSave":zcalCRM.saveEvent();break;case"taskSave":zcalTask.saveTask();break;case"eventDelete":ZCL_delEve();break;case"eventEdit":ZCL_Dedit();break;case"eventClose":zcalCRM.reset(),ZCL_eClose();break;case"eventSend":ZCL_send(zcal.EOBJ);break;case"startChat":ZCL_chatLet(event,zcal.EOBJ);break;case"setEventAlarm":ZCL_setEventAlarm();break;case"print":zmUtil.hideMenu(),ZCL_print();break;case"printPreview":zmUtil.hideMenu(),ZCL_prntPreview(!1);break;case"savePdf":zmUtil.hideMenu(),ZCL_svPdf();break;case"eventStreamView":zcal.constEventViewCard()}}},calUtility:function(e,cur,layerId,calObj){var calId;ZCL_stopEvents(e);for(var i in calObj)calId=i;zcalList.leftUtility(e,cur,layerId,calId)},leftUtility:function(e,cur,layerId,calId){var menuObj,ci=(cur.id,zcal.getCalObj(calId));if(ci){var actArr=[];actArr.push({htm:zcal.i18n.edit,id:"zcalMenu_Edit",cEdit:!1,data:{action:"edit",id:calId}}),0!=ci[13][0]&&(actArr.push({sep:!0}),actArr.push({htm:zcal.i18n.share,id:"zcalMenu_Share",cEdit:!1,data:{action:"share",id:calId}})),0!=ci[13][0]&&(actArr.push({sep:!0}),actArr.push({htm:zcal.i18n.embed,id:"zcalMenu_Embed",cEdit:!1,data:{action:"embed",id:calId}})),"group"==ci[14]&&(actArr.push({sep:!0}),actArr.push({htm:zcal.i18n.members,id:"zcalMenu_Mem",cEdit:!1,data:{action:"member",id:calId}})),1==ci[13][3]&&(actArr.push({sep:!0}),actArr.push({htm:zcal.i18n.empty,id:"zcalMenu_Empty",cEdit:!1,data:{action:"empty",id:calId}})),1==ci[13][4]&&(actArr.push({sep:!0}),actArr.push({htm:zcal.i18n.del,id:"zcalMenu_Del",cEdit:!1,data:{action:"delete",id:calId}})),1==ci[13][5]&&(actArr.push({sep:!0}),actArr.push({htm:zcal.i18n.unsubscribe,id:"zcalMenu_UnSub",cEdit:!1,data:{action:"unsubscribe",id:calId}})),menuObj={clk:function(a,b){zcalList.bindAction(b)},conArr:actArr},zmsuite.showContextMenu(e,menuObj),ZCL_stopEvents(e)}},chgeCalStatus:function(e,calObj){var calId;ZCL_stopEvents(e);for(var i in calObj)calId=i;calId&&ZCL_ChgCalSts(calId)}};return listObj}(),zcalView=function(){var getCenterElement=function(){return zcal.calCenter=zcal.calCenter||zmsuite.getCenter(),zcal.calCenter.listElem=zcal.calCenter[0].getNodes()[2].$el[0],zcal.calCenter.headerElem=zcal.calCenter[0].getNodes()[0].$el[0],zcal.calCenter},getGridHeight=function(){var gridHgt,listElem=$(getCenterElement().listElem);return gridHgt=listElem.height()-33-1},getGridWidth=function(){var listElem=$(getCenterElement().listElem);return listElem.width()-81-zcalInit.scrollWidth()},goToday=function(){zcal.today.setTime(zcal.cdate),zcalInit.checkDate(zcal.today.getTime())?zcalView.constGridView():(zcal.mlimit=zcalInit.getMonthLimit(zcal.today.getTime()),zcalEvents.loadMonthData(!0))},goDate=function(date,month,year){0==zcal.view||1==zcal.view||2==zcal.view?(zcal.today.setDate(date),zcal.today.setMonth(month),zcal.today.setYear(year)):3==zcal.view&&(zcal.today.setDate(1),zcal.today.setMonth(month),zcal.today.setYear(year)),zcalInit.checkDate(zcal.today.getTime())?zcalView.constGridView():(zcal.mlimit=zcalInit.getMonthLimit(zcal.today.getTime()),zcalEvents.loadMonthData(!0))},goNext=function(){0==zcal.view?zcal.today.setDate(zcal.today.getDate()+1):1==zcal.view||2==zcal.view?zcal.today.setDate(zcal.today.getDate()+7):3==zcal.view&&(zcal.today.setDate(1),zcal.today.setMonth(zcal.today.getMonth()+1)),zcalInit.checkDate(zcal.today.getTime())?zcalView.constGridView():(zcal.mlimit=zcalInit.getMonthLimit(zcal.today.getTime()),zcalEvents.loadMonthData(!0))},goPrev=function(){0==zcal.view?zcal.today.setDate(zcal.today.getDate()-1):1==zcal.view||2==zcal.view?zcal.today.setDate(zcal.today.getDate()-7):3==zcal.view&&(zcal.today.setDate(1),zcal.today.setMonth(zcal.today.getMonth()-1)),zcalInit.checkDate(zcal.today.getTime())?zcalView.constGridView():(zcal.mlimit=zcalInit.getMonthLimit(zcal.today.getTime()),zcalEvents.loadMonthData(!0))},setView=function(v,y,m,d){zcal.view=v;var da=new Date(y,m,d);if(zcal.today=da.clone(),$("#zcl_view")){var vlEle=$("#zcl_view");vlEle.find("DIV").removeClass("zcl_sl"),vlEle.find("DIV:first").addClass("zcl_sl")}zcalInit.checkDate(zcal.today.getTime())?zcalView.constGridView():(zcal.mlimit=zcalInit.getMonthLimit(zcal.today.getTime()),zcalEvents.loadMonthData(!0))},bindMouseDown=function(dayEle,cnt,_dat){dayEle.off("mousedown").on("mousedown",{cnt:cnt,date:_dat.getDate(),month:_dat.getMonth(),year:_dat.getFullYear()},function(ev){var tarEle=ev.target||event.srcElement;"SPAN"==tarEle.tagName&&tarEle.parentNode.id=="zcl_lft"+ev.data.cnt?zcalView.setView(0,ev.data.year,ev.data.month,ev.data.date):zcalDrag.mstartDiv(ev,ev.data.cnt)})},bindHeaderMouseDown=function(liDOM,_dat){liDOM.addEventListener("mousedown",function(){zcalView.setView(0,_dat.getFullYear(),_dat.getMonth(),_dat.getDate())})},viewObj={hourSlot:2,slotDuration:30,gridWidth:0,gridHeight:0,timeoutID:null,change:function(vNo){zcal.view=vNo,this.constGridView()},constGridView:function(){return"c"!=zmApp.currentApp?!1:(ZCL_clrStck1(),this.gridWidth=getGridWidth(),this.gridHeight=getGridHeight(),void(this.gridWidth<=0?zcal.reconstructView=!0:0==zcal.view?(zcalView.constDayView(),ZCL_$("zcl_encloser").scrollTop=51*zcal.cdata.opt.HS):1==zcal.view||2==zcal.view?(zcalView.constWeekView(),ZCL_$("zcl_encloser").scrollTop=51*zcal.cdata.opt.HS):3==zcal.view?zcalView.constMonthView():4==zcal.view&&zcalView.agendaView()))},templates:{day:["DIV",{attrs:{"class":"zcl zcl_dayvw",id:"zcl_workarea"},child:[["UL",{child:[["LI",{child:[["DIV",{attrs:{"class":"zcl_table",id:"zcl_vwheader"}}]]}],["LI",{child:[["DIV",{attrs:{"class":"zcl_rel",id:"zcl_aencloser"},child:[["DIV",{attrs:{"class":"zcl_alldycn zcl_table"},child:[["UL",{attrs:{"class":"zcl_alldyev"},child:[["LI",{attrs:{"class":"zcl_lfsec",id:"zcl_lftsec"}}],["LI",{attrs:{"class":"zcl_scrly"},child:[["DIV",{attrs:{id:"zcl_aContainer","class":"zcl_rel",style:"height:36px"},child:[["DIV",{attrs:{"class":"zcl_adyevecn",id:"zcl_allLay"}}],["DIV",{attrs:{"class":"zcl_table",id:"zcl_allgrid"}}]]}]]}]]}]]}]]}],["DIV",{attrs:{"class":"zcl_scrly zcl_rel",id:"zcl_encloser"},child:[["DIV",{attrs:{"class":"zcl_esub",id:"zcl_eveSub"}}],["DIV",{attrs:{"class":"zcl_wgrdsl",id:"zcl_lay",style:"display:none;height:22px"}}],["UL",{attrs:{"class":"zcl_grid"},child:[["LI",{child:[["DIV",{attrs:{"class":"zcl_table",id:"zcl_hContainer"}}]]}]]}]]}]]}]]}]]}],week:["DIV",{attrs:{"class":"zcl zcl_weekvw",id:"zcl_workarea"},child:[["UL",{child:[["LI",{child:[["DIV",{attrs:{"class":"zcl_table",id:"zcl_vwheader"}}]]}],["LI",{child:[["DIV",{attrs:{"class":"zcl_rel",id:"zcl_aencloser"},child:[["DIV",{attrs:{"class":"zcl_alldycn zcl_table"},child:[["UL",{attrs:{"class":"zcl_alldyev"},child:[["LI",{attrs:{"class":"zcl_lfsec",id:"zcl_lftsec"}}],["LI",{attrs:{"class":"zcl_scrly"},child:[["DIV",{attrs:{id:"zcl_aContainer","class":"zcl_rel",style:"height:36px"},child:[["DIV",{attrs:{"class":"zcl_adyevecn",id:"zcl_allLay"}}],["DIV",{attrs:{"class":"zcl_table",id:"zcl_allgrid"}}]]}]]}]]}]]}]]}],["DIV",{attrs:{"class":"zcl_scrly zcl_rel",id:"zcl_encloser"},child:[["DIV",{attrs:{"class":"zcl_esub",id:"zcl_eveSub"}}],["DIV",{attrs:{"class":"zcl_wgrdsl",id:"zcl_lay",style:"display:none;height:22px"}}],["UL",{attrs:{"class":"zcl_grid"},child:[["LI",{child:[["DIV",{attrs:{"class":"zcl_table",id:"zcl_hContainer"}}]]}]]}]]}]]}]]}]]}],month:["DIV",{attrs:{"class":"zcl zcl_monthvw",id:"zcl_workarea"},child:[["UL",{child:[["LI",{child:[["DIV",{attrs:{"class":"zcl_table",id:"zcl_vwheader"},child:[["UL",{attrs:{"class":"zcl_dylst"}}]]}]]}],["LI",{attrs:{"class":"zcl_grid"},child:[["DIV",{attrs:{id:"zcl_encloser","class":"zcl_table"}}]]}]]}]]}],agenda:[]},constDOM:function(viewName){return _zm.getDOM(this.templates[viewName])},getHeaderDOM:function(nod,dat,_dformat){var headerUL,adayGridUL,liDOM,tmpDate=new Date;if(tmpDate.setTime(zcal.cdate),headerUL=_zm.getDOM(["UL",{attrs:{"class":"zcl_dylst"}}]),adayGridUL=document.createElement("UL"),adayGridUL.id="zcl_adaygrid",0!=zcal.view){var leftLi=document.createElement("LI");leftLi.className="zcl_lfsec",headerUL.appendChild(leftLi)}for(var i=0;nod>=i;i++){var curdt=zcalMulti.retdate(dat.dateBy("yyyyMMdd"),i);liDOM=document.createElement("li"),tmpDate.dateBy("yyyyMMdd")==curdt.dateBy("yyyyMMdd")?zcal.today=curdt.clone():0==i&&(zcal.today=curdt.clone()),liDOM.innerHTML=(curdt.getDay()==zcal.cdata.opt.WK?"<b>"+curdt.getWeek()+"</b>":"")+'<span><span class="'+(tmpDate.dateBy("yyyyMMdd")==curdt.dateBy("yyyyMMdd")?"zmThmBG":"")+'">'+curdt.getDate()+"</span>"+curdt.dateBy(_dformat)+"</span>",bindHeaderMouseDown(liDOM,curdt),headerUL.appendChild(liDOM),adayGridUL.appendChild($('<li id="zcl_a'+i+'"></li>')[0])}return[headerUL,adayGridUL]},getHrDOM:function(dayno,hour,css){var hrEle=$("<li><b></b><u></u></li>");return hrEle.addClass(css),hrEle.off("mousedown").on("mousedown",{dayno:dayno,hr:hour},function(ev){zcalDrag.dstartDiv(ev,ev.data.dayno,ev.data.hr)}),hrEle},findTimeLineLeft:function(dayNo){for(var tLeft=5,i=1;dayNo>i;i++)tLeft+=ZCL_getEleWdt("zcl_a"+i);return tLeft},setCurrentTimeLine:function(date){if(zcalView.timeoutID&&window.clearTimeout(zcalView.timeoutID),$(".zcl_crday").length>0&&zcal.view>=0&&zcal.view<=2){var $tline,tlineTop,tlineLeft,_tdat=new Date(date?date:zcal.cdate),hour=_tdat.getHours(),min=_tdat.getMinutes(),sec=_tdat.getSeconds(),hrHgt=$(".zcl_crday")[0].getBoundingClientRect().height,dayWdt=$(".zcl_crday")[0].getBoundingClientRect().width,toolTip=ZCL_timeInUFormat(_tdat.dateBy("HHmm"));tlineLeft=zcalView.findTimeLineLeft($($(".zcl_crday")[0]).index()),ZCL_$("zcl_timeline")||$("#zcl_encloser").append("<div class='zcl_tiln' id='zcl_timeline'/>"),$tline=$("#zcl_timeline"),$tline.html('<span/><div style="width:'+dayWdt+"px;left:"+tlineLeft+'px"></div>'),zmComponent.tooltip({elm:$tline.find("span")[0],text:toolTip,arrow:"top"}),tlineTop=hour*hrHgt+min*(hrHgt/60),tlineTop=tlineTop>0?tlineTop-1:0,$tline.attr("style","top:"+tlineTop+"px"),zcalView.timeoutID=setTimeout(zcalView.setCurrentTimeLine,1e3*(60-sec))}else $("#zcl_timeline").remove()},constHrDOM:function(nod,dat,hour){var hlbl="",stime=parseInt(zcal.cdata.opt.HS),etime=parseInt(zcal.cdata.opt.HE),workDays=zcal.workDays;0==zcal.cdata.opt.TF?(hlbl+=0==hour?12:hour>12?hour-12:hour,hlbl+="&nbsp;"+(hour>11?"pm":"am")):hlbl+=(9>hour?"0"+hour:hour)+":00";for(var hrEle=$('<ul><li class="zcl_lfsec">'+hlbl+"</li></ul>"),i=0;nod>=i;i++){var curdt=zcalMulti.retdate(dat.dateBy("yyyyMMdd"),i),className="";curdt.dateBy("yyyyMMdd")==new Date(zcal.cdate).dateBy("yyyyMMdd")&&hour>=stime&&etime>hour?className="zcl_crday":-1==workDays.indexOf(curdt.getDay())?className="zcl_wend":(stime>hour||hour>=etime)&&(className="zcl_nwhr"),hrEle.append(zcalView.getHrDOM(i,hour,className))}return hrEle[0]},constDayView:function(){var headerEle,alldayEle,hourEle,gridDOM,tzEle,gridEle=zcal.calCenter.listElem;gridEle.innerHTML="",zcalInit.updateHeaderBand(zcal.today.dateBy("NNN dd, yyyy"),zcal.view),gridDOM=this.constDOM("day"),gridDOM.style.height=gridEle.getBoundingClientRect().height+"px",headerEle=gridDOM.querySelector("#zcl_vwheader");var headers=this.getHeaderDOM(0,zcal.today," EE");headerEle.appendChild(headers[0]),alldayEle=gridDOM.querySelector("#zcl_allgrid"),alldayEle.style.width=this.gridWidth+"px",alldayEle.appendChild(headers[1]),hourEle=gridDOM.querySelector("#zcl_hContainer");for(var i=0;24>i;i++){var hrDOM=this.constHrDOM(0,zcal.today,i);hourEle.appendChild(hrDOM)}gridDOM.addEventListener("contextmenu",function(ev){ZCL_stopEvents(ev)}),gridEle.appendChild(gridDOM),tzEle=gridDOM.querySelector("#zcl_lftsec"),tzEle.className="zcl_lfsec zcl_til_tz";var sp=document.createElement("span");sp.className="zcl_grey",sp.style.cursor="pointer",sp.innerHTML=zcal.cdata.opt.TZ_OFFSET,tzEle.appendChild(sp),$("#zcl_lftsec").on({click:function(){zmAppLoader.load("zm-settings-mailsuite-appcore").then(function(){zmail.Settings.MailSuite.App.openApp().then(function(){setTimeout(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage("calendar-generals").then(function(){zmail.Settings.MailSuite.Apps.CalendarGenerals.CalendarGeneralView}).fail(function(){})},100)})})}}),$("#zcl_allLay").on({scroll:function(){var tempScrollTop=$(this).scrollTop();tempScrollTop!=zcal.alldayScrollTop&&(zcal.alldayScrollTop=tempScrollTop,ZCL_clrStck1())},mousedown:function(e){zcal.qkAllday(e,$(this)[0],"all")}}),$("#zcl_encloser").on({scroll:function(){var tempScrollTop=$(this).scrollTop();tempScrollTop!=zcal.hrgridScrollTop&&(zcal.hrgridScrollTop=tempScrollTop,ZCL_clrStck1())}}),$(".zcl_crday").length>0&&zcalView.setCurrentTimeLine(),zcalView.dispEvents()},constWeekView:function(){var ws=1==zcal.view?zcal.cdata.opt.WK:2==zcal.view?zcal.cdata.opt.WS:0;ws=parseInt(ws,10);var we=1==zcal.view?6+zcal.cdata.opt.WK:2==zcal.view?zcal.cdata.opt.WE:0;we=parseInt(we,10);var tdate=new Date;tdate.setTime(zcal.today.getTime());var tt=1==zcal.view&&tdate.getDay()<ws?-7:0,nod=ws>we?7-(ws-we):we-ws;tdate.setDate(tdate.getDate()-tdate.getDay()+ws+tt);var sd=tdate.getTime(),wend=tdate.clone(),str="";wend.setDate(wend.getDate()+nod),str=tdate.getFullYear()===wend.getFullYear()?tdate.getMonth()===wend.getMonth()?tdate.dateBy("NNN dd")+" - "+wend.dateBy("dd, yyyy"):tdate.dateBy("NNN dd")+" - "+wend.dateBy("NNN dd, yyyy"):tdate.dateBy("NNN dd, yyyy")+" - "+wend.dateBy("NNN dd, yyyy");var headerEle,alldayEle,hourEle,gridDOM,tzEle,ss,gridEle=zcal.calCenter.listElem,_dformat=zcal.cdata.opt.DF;gridEle.innerHTML="",zcalInit.updateHeaderBand(str,zcal.view),ss=new Date,ss.setTime(sd),gridDOM=this.constDOM("week"),gridDOM.style.height=gridEle.getBoundingClientRect().height+"px",headerEle=gridDOM.querySelector("#zcl_vwheader"),alldayEle=gridDOM.querySelector("#zcl_allgrid"),_dformat="0"==_dformat||"2"==_dformat?"M/d (E)":"1"==_dformat?"d/M (E)":"M-d (E)";var headers=this.getHeaderDOM(nod,ss," E");headerEle.appendChild(headers[0]),alldayEle.style.width=this.gridWidth+"px",alldayEle.appendChild(headers[1]),hourEle=gridDOM.querySelector("#zcl_hContainer");for(var i=0;24>i;i++){var hrDOM=this.constHrDOM(nod,ss,i);hourEle.appendChild(hrDOM)}gridDOM.addEventListener("contextmenu",function(ev){ZCL_stopEvents(ev)}),gridEle.appendChild(gridDOM),tzEle=gridDOM.querySelector("#zcl_lftsec"),tzEle.className="zcl_lfsec zcl_til_tz";var sp=document.createElement("span");sp.className="zcl_grey",sp.style.cursor="pointer",sp.innerHTML=zcal.cdata.opt.TZ_OFFSET,tzEle.appendChild(sp),$("#zcl_lftsec").on({click:function(){zmAppLoader.load("zm-settings-mailsuite-appcore").then(function(){zmail.Settings.MailSuite.App.openApp().then(function(){setTimeout(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage("calendar-generals").then(function(){zmail.Settings.MailSuite.Apps.CalendarGenerals.CalendarGeneralView}).fail(function(){})},100)})})}}),$("#zcl_allLay").on({scroll:function(){var tempScrollTop=$(this).scrollTop();tempScrollTop!=zcal.alldayScrollTop&&(zcal.alldayScrollTop=tempScrollTop,ZCL_clrStck1())},mousedown:function(e){zcal.qkAllday(e,$(this)[0],"all")}}),$("#zcl_encloser").on({scroll:function(){var tempScrollTop=$(this).scrollTop();tempScrollTop!=zcal.hrgridScrollTop&&(zcal.hrgridScrollTop=tempScrollTop,ZCL_clrStck1())}}),$(".zcl_crday").length>0&&zcalView.setCurrentTimeLine(),zcalView.dispEvents()},monthHeaderDOM:function(_dat){var li=document.createElement("LI");return li.innerHTML="<span>"+_dat.dateBy("E")+"</span>",li.addEventListener("mousedown",function(){zcalView.setView(0,_dat.getFullYear(),_dat.getMonth(),_dat.getDate())}),li},constMonthView:function(){var nod,nor,headerEle,mbdyEle,gridDOM,_wks=zcal.cdata.opt.WK,cnt=0,workDays=zcal.workDays,mstart=zcal.mlimit[0].clone(),gridEle=zcal.calCenter.listElem;gridEle.innerHTML="",nod=(zcal.mlimit[1]-zcal.mlimit[0])/864e5+1,nor=nod/7;var tD=zcal.mlimit[0].clone();tD.setDate(tD.getDate()+15),zcalInit.updateHeaderBand(tD.dateBy("NNN yyyy"),zcal.view),gridDOM=this.constDOM("month"),gridDOM.style.height=gridEle.getBoundingClientRect().height+"px",headerEle=gridDOM.querySelector("#zcl_vwheader");var tmp=new Date;tmp.setDate(tmp.getDate()-tmp.getDay()),tmp.setDate(tmp.getDate()+_wks);for(var dy=0;7>dy;dy++)headerEle.children[0].appendChild(zcalView.monthHeaderDOM(tmp)),tmp.setDate(tmp.getDate()+1);mbdyEle=gridDOM.querySelector("#zcl_encloser"),gridEle.appendChild(gridDOM),1===ZCL_MONTHMODE&&(mbdyEle.style.width=ZCL_getEleWdt(mbdyEle)-zcalInit.scrollWidth()+"px"),mbdyEle.parentNode.style.height=this.gridHeight+"px";for(var i=0;nor>i;i++){var mrowDOM=document.createElement("UL");mrowDOM.id="zcl_row"+i;for(var c=0;7>c;c++){{var dayEle,htmStr,className="";mstart.getDay(),mstart.dateBy("NNN yyyy")}mstart.dateBy("yyyyMMdd")==new Date(zcal.cdate).dateBy("yyyyMMdd")?(className="zcl_crday",headerEle.children[0].children[c].className="zcl_sl"):-1==workDays.indexOf(mstart.getDay())?className="zcl_wend":mstart.dateBy("yyyyMM")!=tD.dateBy("yyyyMM")&&(className="zcl_wend"),dayEle=$('<li id="zcl_mbx'+cnt+'" class="'+className+'"/>'),htmStr='<div id="zcl_lft'+cnt+'">'+(mstart.getDay()==zcal.cdata.opt.WK?"<b>"+mstart.getWeek()+"</b>":"")+'<span class="'+(mstart.dateBy("yyyyMMdd")==new Date(zcal.cdate).dateBy("yyyyMMdd")?"zmThmBG":"")+'">'+mstart.getDate()+'</span></div><div id="zcl_lay'+cnt+'" class="zcl_mgrdsl" style="display:none"></div>',dayEle.html(htmStr),bindMouseDown(dayEle,cnt,mstart),mrowDOM.appendChild(dayEle[0]),cnt++,mstart.setDate(mstart.getDate()+1)}mbdyEle.appendChild(mrowDOM)}gridDOM.addEventListener("contextmenu",function(ev){ZCL_stopEvents(ev)}),ZCL_NOB=cnt,zcal.mcell_width=$("#zcl_mbx0").width();for(var i=0;nor>i;i++)mbdyEle.children[i].style.height=mbdyEle.children[i].offsetHeight+"px";zcalView.dispEvents()},constMonthPrintView:function(){var nod,nor,headerEle,mbdyEle,gridDOM,_wks=zcal.cdata.opt.WK,cnt=0,workDays=zcal.workDays,mstart=zcal.mlimit[0].clone();nod=(zcal.mlimit[1]-zcal.mlimit[0])/864e5+1,nor=nod/7;var tD=zcal.mlimit[0].clone();tD.setDate(tD.getDate()+15),gridDOM=this.constDOM("month"),headerEle=gridDOM.querySelector("#zcl_vwheader");var tmp=new Date;tmp.setDate(tmp.getDate()-tmp.getDay()),tmp.setDate(tmp.getDate()+_wks);for(var dy=0;7>dy;dy++)headerEle.children[0].appendChild(zcalView.monthHeaderDOM(tmp)),tmp.setDate(tmp.getDate()+1);mbdyEle=gridDOM.querySelector("#zcl_encloser"),1===ZCL_MONTHMODE&&(mbdyEle.style.width=ZCL_getEleWdt(mbdyEle)-zcalInit.scrollWidth()+"px");for(var i=0;nor>i;i++){var mrowDOM=document.createElement("UL");mrowDOM.id="zcl_pm_r"+i;for(var c=0;7>c;c++){{var className="";mstart.getDay(),mstart.dateBy("NNN yyyy")}mstart.dateBy("yyyyMMdd")==new Date(zcal.cdate).dateBy("yyyyMMdd")?(className="zcl_crday",headerEle.children[0].children[c].className="zcl_sl"):-1==workDays.indexOf(mstart.getDay())?className="zcl_wend":mstart.dateBy("yyyyMM")!=tD.dateBy("yyyyMM")&&(className="zcl_wend");var dayEle=$('<li id="zcl_pm'+cnt+'" class="'+className+'"/>'),htmStr='<div id="zcl_lft'+cnt+'">'+(mstart.getDay()==zcal.cdata.opt.WK?"<b>"+mstart.getWeek()+"</b>":"")+"<span>"+mstart.getDate()+"</span></div>";dayEle.html(htmStr),mrowDOM.appendChild(dayEle[0]),cnt++,mstart.setDate(mstart.getDate()+1)}mbdyEle.appendChild(mrowDOM)}return gridDOM},agendaView:function(){var txt='<div class="zcl zcl_agendavw" id="zcl_workarea"><ul id="zcl_encloser" class="zcl_frmbg"><li><ul id="zcl_agnlst" class="zcl_agnlst"></ul></li></ul></div>';$(zcal.calCenter.listElem).html(txt),zcalInit.updateHeaderBand(zcal.today.dateBy("NNN dd, yyyy"),zcal.view),zcalView.dispEvents()},weekNoText:function(tdate){var wNo=tdate.getWeek(),lChar=wNo%10;return wNo=1===lChar&&11!=wNo?ZCL_replaceString(zcal.i18n.weekno1,[wNo]):2===lChar&&12!=wNo?ZCL_replaceString(zcal.i18n.weekno2,[wNo]):3===lChar&&13!=wNo?ZCL_replaceString(zcal.i18n.weekno3,[wNo]):ZCL_replaceString(zcal.i18n.weekno4,[wNo])},plotEvents:function(){void 0==zcal.calCenter||zcal.calCenter&&zcal.calCenter.listElem.getBoundingClientRect().height<=0?zcal.reconstructView=!0:0==zcal.view?zcalView.dEvents():1==zcal.view||2==zcal.view?zcalView.dEvents():3==zcal.view&&(ZCL_$("zcl_encloser")&&(ZCL_$("zcl_encloser").innerHTML=""),zcalView.constMonthView())},dispEvents:function(){zcal.gridleft=ZCL_findPosXX(ZCL_$("zcl_encloser")),4==zcal.view?zcalAgenda.dispEvents():3==zcal.view?zcalView.mEvents():zcalView.dEvents()},mEvents:function(){ZCL_clrStck1();var mgridEle,_d=zcal.mlimit[0].clone(),row=0;for(ZCL_PRINTDATA=[];_d<zcal.mlimit[1];){var obj=zcalMulti.split([_d.dateBy("yyyyMMdd"),6]);zcalMonth.render(obj,_d.dateBy("yyyyMMdd"),7,row),ZCL_PRINTDATA[row]=ZCL_Evl(1,zcalMulti.duplicate(obj)),_d.setDate(_d.getDate()+7),row++}mgridEle=$("#zcl_encloser").parent(),1===ZCL_MONTHMODE&&mgridEle.css({"overflow-y":"scroll","overflow-x":"hidden"})},dEvents:function(){ZCL_clrStck1(),ZCL_$("zcl_eveSub").innerHTML="";var ws=1==zcal.view?zcal.cdata.opt.WK:2==zcal.view?zcal.cdata.opt.WS:0;ws=parseInt(ws,10);var we=1==zcal.view?6+zcal.cdata.opt.WK:2==zcal.view?zcal.cdata.opt.WE:0;we=parseInt(we,10);var tdate=new Date;tdate.setTime(zcal.today.getTime());var tt=1==zcal.view&&tdate.getDay()<ws?-7:0,nod=ws>we?7-(ws-we):we-ws;0!=zcal.view&&tdate.setDate(tdate.getDate()-tdate.getDay()+ws+tt);for(var sd=tdate.getTime(),c=ZCL_getEleWdt("zcl_lftsec"),i=0;nod>=i;i++){var dd=new Date;dd.setTime(sd),dd.setDate(dd.getDate()+i);var d=dd.dateBy("yyyyMMdd"),_wdt=ZCL_getEleWdt("zcl_a"+i);0!=i&&(c+=_wdt),zcal.cdata.evelst&&zcalEvents.renderDayView(zcal.cdata.evelst[d],d,c,_wdt,i)}var obj=zcalMulti.split([tdate.dateBy("yyyyMMdd"),nod]);zcalAday.render(obj,tdate.dateBy("yyyyMMdd"),nod)},isTodayInViewRange:function(vno){if(0==vno)return zcal.today.dateBy("yyyyMMdd")===new Date(zcal.cdate).dateBy("yyyyMMdd");if(1==vno||2==vno){var ws=1==zcal.view?zcal.cdata.opt.WK:2==zcal.view?zcal.cdata.opt.WS:0;ws=parseInt(ws,10);var we=1==zcal.view?6+zcal.cdata.opt.WK:2==zcal.view?zcal.cdata.opt.WE:0;we=parseInt(we,10);var wstart=new Date;wstart.setTime(zcal.today.getTime());var tt=1==zcal.view&&wstart.getDay()<ws?-7:0,nod=ws>we?7-(ws-we):we-ws;wstart.setDate(wstart.getDate()-wstart.getDay()+ws+tt);var tmpDate=new Date;tmpDate.setTime(zcal.cdate);for(var i=0;nod>=i;i++){var curdt=zcalMulti.retdate(wstart.dateBy("yyyyMMdd"),i);if(tmpDate.dateBy("yyyyMMdd")==curdt.dateBy("yyyyMMdd"))return!0}}else if(3==vno)return zcal.today.dateBy("yyyyMM")===new Date(zcal.cdate).dateBy("yyyyMM");return!1},setView:setView,goPrev:goPrev,goNext:goNext,goToday:goToday,goDate:goDate};return viewObj}(),zcalAgenda=function(){var aDate,dataRange,rmvLoadingDiv,fetchType=1,data={},displayRange=[],dispEvents=function(date){date?(aDate=date,zcal.today=aDate,dataRange=getLimit(aDate),zcalInit.updateHeaderBand(zcal.today.dateBy("NNN dd, yyyy"),zcal.view)):initAgenda(),zcalAgenda.fetchEvents(aDate,fetchType)},initAgenda=function(){aDate=zcal.today.clone(),dataRange=getLimit(aDate)},getLimit=function(_dat){var dateSt=_dat.clone();return dateSt.setDate(1),dateEd=dateSt.clone(),dateEd.setMonth(dateSt.getMonth()+3),dateEd.setDate(dateEd.getDate()-1),[dateSt,dateEd]},agenfetchevents=function(_dat,fType){rmvLoadingDiv=zmComponent.loadingBand({container:zcal.calCenter.listElem,type:"listing"});var url="/cal/agenda.do?iszmscal=true&dat="+_dat.dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&qno="+fType+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF]+"&calmode="+zcal.CALMODE+(1==zcal.CALMODE?"&gid="+zcal.cdata.opt.GID:"");ZCL_uXHR(url,"zcalAgenda.agendaData")},updateAgendaData=function(res){var txt='<div class="zcl zcl_agendavw" id="zcl_workarea"><ul id="zcl_encloser" class="zcl_frmbg"><li><ul id="zcl_agnlst" class="zcl_agnlst"></ul><div id="zcl_agnmsg"></div></li></ul></div>';$(zcal.calCenter.listElem).html(txt);for(var qStr,aevents=ZCL_Evl(1,res.responseText),_tdate=dataRange[0].clone();_tdate<dataRange[1];)qStr=_tdate.getFullYear()+"_"+Math.floor(_tdate.getMonth()/3),aevents[qStr]&&(data[qStr]=aevents[qStr]),_tdate.setMonth(_tdate.getMonth()+1);listEvents()},listEvents=function(){var aglstEle=ZCL_$("zcl_agnlst");$(aglstEle).empty();for(var qStr,dStr,_tdate=dataRange[0].clone();_tdate<dataRange[1];){if(qStr=_tdate.getFullYear()+"_"+Math.floor(_tdate.getMonth()/3),data[qStr]&&(dStr=_tdate.dateBy("yyyyMMdd"),data[qStr][0][dStr]||data[qStr][1][dStr])){var dayEvents=[];data[qStr][1][dStr]&&(dayEvents=dayEvents.concat(data[qStr][1][dStr])),data[qStr][0][dStr]&&(dayEvents=dayEvents.concat(data[qStr][0][dStr])),dayEvents.length>0&&displayDayEvents(_tdate,dayEvents)}_tdate.setDate(_tdate.getDate()+1)}$("#zcl_agnmsg").text(0==aglstEle.children.length?ZCL_replaceString(zcal.i18n.agenda_noevents,[dataRange[1].dateBy("dd/MM/yyyy")]):ZCL_replaceString(zcal.i18n.agenda_dispevents,[dataRange[1].dateBy("dd/MM/yyyy")]))},displayDayEvents=function(_dat,eList){var aglstEle=ZCL_$("zcl_agnlst");sortEvents(eList);for(var uList=zcalCRM.getCRMColorCode(),i=0;i<eList.length;i++){var tday=!1,rindex=0,repinst=null,tempO={},eobj=eList[i];if(!eobj.EMTY){if(tempO.ET=eobj.ET,tempO.ST=eobj.ST,eobj.DUP){rindex=eobj.RIDX?eobj.RIDX:"0",repinst=eobj.REPINST?eobj.REPINST:null;var st=eobj.ST,et=eobj.ET;if(eobj=data[eobj.DUP[0]][eobj.AIDX][eobj.DUP[1]][eobj.DUP[2]],eobj.EMTY)continue;0==eobj.ADAY?("0000"==st&&"2400"==eobj.et&&(tday=!0),tempO.ET=et,tempO.ST=st):tday=!0}else"1"==eobj.ADAY&&(tday=!0);var ownerId=eobj.ORG,eStart=ZCL_parseDateStr(eobj.SD),hr=parseInt(tempO.ST.substring(0,2),10),min=parseInt(tempO.ST.substring(2,4),10);eStart.setHours(hr,min,0,0);var eEnd=ZCL_parseDateStr(eobj.ED),hr1=parseInt(tempO.ET.substring(0,2),10),min1=parseInt(tempO.ET.substring(2,4),10);eEnd.setHours(hr1,min1,0,0);var calObj=zcal.getCalObj(eobj.CNAME),calColor=calObj[1].split(":"),colarr=ZCL_getCalColor(calColor[0]),calId=eobj.CNAME;if("crm"==calObj[14]&&uList?uList[ownerId]?sts=0==uList[ownerId][2]?!1:!0:uList.OTHERS&&(sts=0==uList.OTHERS[2]?!1:!0):sts=-1==zcal.disabledcal.indexOf(calId)?!0:!1,sts&&calObj&&1==calObj[2]&&1==calObj[8]){var $ele=$('<li><div class="zcl_table"><ul><li class="zcl_w70"><ul class="zcl_agdate"><li>'+_dat.dateBy("E")+"</li><li>"+_dat.dateBy("dd")+"</li><li>"+_dat.dateBy("NNN yyyy")+'</li></ul></li><li class="zcl_agncclr"><span style="background-color:'+(-1!=eobj.EC?zcal.eventcolor[eobj.EC]:colarr[1])+'"></span></li><li class="zcl_grevlst"><ul><li><b>'+ZCL_getHTML(eobj.SUM)+"</b></li><li><em>"+(tday?zcal.i18n.allday:ZCL_timeInUFormat(tempO.ST)+" - "+ZCL_timeInUFormat(tempO.ET))+"</em>"+(eobj.LOC?"<span>"+zcal.i18n.loc+"</span><em>"+ZCL_getHTML(eobj.LOC)+"</em>":"")+"</li></ul></li></ul></div></li>");0!=eobj.EPERM&&bindClickOnEvent($ele,eobj,_dat,rindex,repinst),aglstEle.appendChild($ele[0])}}}},bindClickOnEvent=function($ele,eobj,_dat,rindex,repinst){$ele.on("click",{obj:eobj,dat:_dat,rindex:rindex,repinst:repinst},function(ev){var tobj=ev.data.obj,tdat=ev.data.dat,eid=tobj.EID+(tobj.REP?"_"+tdat.dateBy("yyyyMMdd"):"");ZCL_AgenEveDetail(eid,ev,tobj.CNAME,tobj.EUID,ev.data.rindex,ev.data.repinst)})},sortEvents=function(eArr){if(eArr.length>1)for(var i=0;i<eArr.length-1;i++)for(var j=i+1;j<eArr.length;j++){var tO1=eArr[i],tO2=eArr[j];if(tO1&&tO2){var st1=parseInt(tO1.ST),et1=parseInt(tO1.ET),st2=parseInt(tO2.ST),et2=parseInt(tO2.ET);st1>st2?(eArr[i]=tO2,eArr[j]=tO1):st1==st2?("2400"==et2||et1>et2)&&(eArr[i]=tO2,eArr[j]=tO1):(eArr[i]=tO1,eArr[j]=tO2)}}},deleteEvent=function(obj,evid){if(4==zcal.view){var aday=obj[evid].ADAY;if(obj[evid].REP)return zcalAgenda.fetchEvents(aDate,fetchType),!1;obj[evid].SD!=obj[evid].ED&&(aday=1);for(var tdat=ZCL_parseDateStr(obj[evid].SD),qtr=Math.floor(tdat.getMonth()/3),yy=tdat.dateBy("yyyy"),len=data[yy+"_"+qtr][aday][obj[evid].SD].length,i=0;len>i;i++)if(!data[yy+"_"+qtr][aday][obj[evid].SD][i].EMTY)if(data[yy+"_"+qtr][aday][obj[evid].SD][i].DUP){var dup=data[yy+"_"+qtr][aday][obj[evid].SD][i].DUP;data[dup[0]][aday][dup[1]][dup[2]].EID==evid&&(data[dup[0]][aday][dup[1]][dup[2]]={EMTY:"$$$"})}else data[yy+"_"+qtr][aday][obj[evid].SD][i].EID==evid&&(data[yy+"_"+qtr][aday][obj[evid].SD][i]={EMTY:"$$$"});listEvents()}},editEvent=function(eObj){if(4==zcal.view){var obj=ZCL_Evl(1,eObj);if(obj.REP||obj.SD!=obj.ED)return zcalAgenda.fetchEvents(aDate,fetchType),!1;var aday=obj.ADAY;obj.SD!=obj.ED&&(aday=1);var evid=obj.EID,tdat=ZCL_parseDateStr(obj.SD),qtr=Math.floor(tdat.getMonth()/3),yy=tdat.dateBy("yyyy");if(data[yy+"_"+qtr]){for(var len=data[yy+"_"+qtr][aday][obj.SD].length,i=0;len>i;i++)data[yy+"_"+qtr][aday][obj.SD][i].EMTY||data[yy+"_"+qtr][aday][obj.SD][i].EID==evid&&(data[yy+"_"+qtr][aday][obj.SD][i]={EMTY:"$$$"},data[yy+"_"+qtr][obj.ADAY][obj.SD][data[yy+"_"+qtr][obj.ADAY][obj.SD].length]=obj);listEvents()}}},addEvent=function(eObj){if(4==zcal.view){var obj=ZCL_Evl(1,eObj);if(obj.REP||obj.SD!=obj.ED)return zcalAgenda.fetchEvents(aDate,fetchType),!1;var dat=ZCL_parseDateStr(obj.SD),qtr=Math.floor(dat.getMonth()/3),dt=dat.dateBy("yyyyMMdd"),yy=dat.getFullYear();if(data[yy+"_"+qtr]){if(0==obj.ADAY)if(data[yy+"_"+qtr][0][dt]){var len=data[yy+"_"+qtr][0][dt].length;data[yy+"_"+qtr][0][dt][len]=obj}else data[yy+"_"+qtr][0][dt]=[],data[yy+"_"+qtr][0][dt][0]=obj;else if(data[yy+"_"+qtr][1][dt]){var len=data[yy+"_"+qtr][1][dt].length;data[yy+"_"+qtr][1][dt][len]=obj}else data[yy+"_"+qtr][1][dt]=[],data[yy+"_"+qtr][1][dt][0]=obj;listEvents()}}},lessDate=function(){aDate.setDate(1),aDate.setMonth(aDate.getMonth()-1),displayRange[0]=new Date(aDate.getFullYear(),aDate.getMonth(),1)},addDate=function(){aDate.setDate(1),aDate.setMonth(aDate.getMonth()+1),displayRange[1]=new Date(aDate.getFullYear(),aDate.getMonth()+1,1)},agendaObj={dispEvents:dispEvents,fetchEvents:agenfetchevents,agendaData:updateAgendaData,goPrev:lessDate,goNext:addDate,del:deleteEvent,edit:editEvent,add:addEvent};return agendaObj}(),zcalEvents=function(){var rmvLoadingDiv,hrHgt,loadMonthData=function(isLoad){if(zmsuite.isWorkspaceAvailable("zcal_Container")){rmvLoadingDiv=isLoad?zmComponent.loadingBand({container:zcal.calCenter.listElem,type:"listing"}):null;var url="/cal/nxtMon.do?mstart="+zcal.mlimit[0].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&mend="+zcal.mlimit[1].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF]+"&calmode="+zcal.CALMODE;ZCL_uXHR(url,retFetchEvents)}},retFetchEvents=function(res){rmvLoadingDiv&&rmvLoadingDiv();var eList=ZCL_Evl(1,res.responseText);zcal.cdata.evelst=eList[0],zcal.cdata.eveAll=eList[1],zcalView.constGridView()},callDragEvent=function(d,dt){d.onmousedown=function(ev){zcalEDrag.dragStart(this,ev,dt,this.eobj)}},callEventDetail=function(d,dt){d.onclick=function(ev){zcal.eveDetail(this.id,ev,dt,[this.eobj.SD,this.eobj.ST,this.eobj.ED,this.eobj.ET,this.eobj.EUID,this.eobj.CNAME,this.eobj.EPERM,this.eobj.RIDX,this.eobj.DPERM,this.eobj.REPINST])}},eventObj={c:{},findTop:function(s){s=parseInt(s,10),s=s>2330?2330:s,hrHgt=hrHgt||50;var temp=parseInt(s/100,0);return temp=temp*hrHgt+Math.round(s%100*(hrHgt/60))},findHgt:function(s,e){s=parseInt(s,10),e=parseInt(e,10),hrHgt=hrHgt||50;var diff,st=parseInt(s/100,10),et=parseInt(e/100,10);return st=60*st+s%100,et=60*et+e%100,diff=Math.round((et-st)*(hrHgt/60)),diff=diff>hrHgt/2?diff:hrHgt/2},findDur:function(s,e){s=parseInt(s,10),e=parseInt(e,10);var st=parseInt(s/100,10),et=parseInt(e/100,10),diff=et-st;return e%100>0&&++diff,diff},incCount:function(s,e){s=parseInt(s,10),e=parseInt(e,10);var st=parseInt(s/100,10),et=parseInt(e/100,10);e%100>0&&++et;for(var i=st;et>i;i++)++zcalEvents.c[i].act},setDur:function(s,d){s=parseInt(s,10);var st=parseInt(s/100,10);zcalEvents.c[st].dur<d&&(zcalEvents.c[st].dur=d)},DGView:function(dobj,dt){var finalObj={},dayObj={};finalObj.eorder=[];var uList=zcalCRM.getCRMColorCode();for(var j in dobj){d=dobj[j];for(var i in d){var calObj=zcal.getCalObj(d[i].CNAME),sts=!0,ownerId=d[i].ORG;if("crm"==calObj[14]&&uList&&(uList[ownerId]?sts=0==uList[ownerId][2]?!1:!0:uList.OTHERS&&(sts=0==uList.OTHERS[2]?!1:!0)),sts&&calObj&&-1==zcal.disabledcal.indexOf(d[i].CNAME)&&(1==zcal.cdata.opt.DDE||0==zcal.cdata.opt.DDE&&"2"!=d[i].USTAT)){var stO=d[i].ST.substring(0,2)+"00",st=d[i].ST,et=d[i].ET;d[i].SD!=d[i].ED&&(stO=dt!=d[i].SD?"0000":stO,st=dt!=d[i].SD?"0000":st,et=dt!=d[i].SD?et:"2400");var obj=stO,len=0;"undefined"==typeof dayObj[obj]?(finalObj.eorder.push(obj),dayObj[obj]=new Array(1)):len=dayObj[obj].length,dayObj[obj][len]={},dayObj[obj][len].id=i,dayObj[obj][len].no=j;var dur=zcalEvents.findDur(st,et);dayObj[obj][len].span=zcalEvents.findHgt(st,et),dayObj[obj][len].dur=dur,dayObj[obj][len].pos=zcalEvents.findTop(st),zcalEvents.setDur(st,dur),zcalEvents.incCount(st,et)}}}return finalObj.elist=zcalEvents.sortObj(dayObj),finalObj},sortObj:function(dayObj){for(var i in dayObj)for(var tObj=dayObj[i],j=0;j<tObj.length-1;j++)if(tObj[j].pos==tObj[j+1].pos&&tObj[j].span<tObj[j+1].span){var ob=tObj[j+1];tObj.splice(j+1,1),tObj.splice(j,0,ob)}return dayObj},cArrSlot:function(obj,s){for(var i=0;s>i;i++)obj[i]=0},renderDayView:function(cd,dt,l,s,gNo){zcalEvents.sortEve(cd,dt);for(var i=(zcalCRM.getCRMColorCode(),0);24>i;i++)zcalEvents.c[i]={act:0,dur:0,fs:[]};var dayObj=zcalEvents.DGView(cd,dt);hrHgt=$("#zcl_hContainer").find("ul:first")[0].getBoundingClientRect().height;for(var i=0;24>i;i++){for(var daySub=zcalEvents.c[i],x=1,mslot=zcalEvents.c[i].act,j=i+1;23>j&&zcalEvents.c[i].dur>x;j++)zcalEvents.c[j].dur-x>zcalEvents.c[i].dur&&(zcalEvents.c[i].dur=zcalEvents.c[j].dur+x),zcalEvents.c[j].act>mslot&&(mslot=zcalEvents.c[j].act),++x;for(k=i;k<i+zcalEvents.c[i].dur;k++)zcalEvents.c[k].act=mslot,i=k}for(var i=0;24>i;i++)zcalEvents.cArrSlot(zcalEvents.c[i].fs,zcalEvents.c[i].act);for(var i=0;i<dayObj.eorder.length;i++){var time=dayObj.eorder[i],daySub=dayObj.elist[time],curTime=parseInt(parseInt(time,10)/100,10);for(var j in daySub){var d=document.createElement("div");d.style.position="absolute";var t=daySub[j].pos+"px";d.style.top=t;var split=s/zcalEvents.c[curTime].act;d.style.width=split+split/3+"px";for(var slotno=0,z=0;z<zcalEvents.c[curTime].act;z++)if(0==zcalEvents.c[curTime].fs[z]){slotno=z;break}d.style.left=split*slotno+l+"px";var temp=split*slotno+(split+split/3);temp>=s&&(d.style.width=split-3+"px");for(var h=daySub[j].span-2-6,m=curTime;m<=curTime+daySub[j].dur-1;m++)zcalEvents.c[m].fs[slotno]=1;var evObj=cd[daySub[j].no][daySub[j].id],sum=ZCL_getHTML(evObj.SUM);""==sum&&(sum="NO SUBJECT"),d.title=zcalEvents.tooltip(evObj),d.alt=zcalEvents.tooltip(evObj),d.setAttribute("gridNo",gNo);var eventId=daySub[j].id+(evObj.REP?"_"+evObj.SD:"");d.id=eventId,d.eobj={RIDX:evObj.RIDX,EUID:evObj.EUID,CNAME:evObj.CNAME,SD:evObj.SD,ED:evObj.ED,ST:evObj.ST,ET:evObj.ET,ORG:evObj.ORG,EPERM:evObj.EPERM,DPERM:evObj.DPERM,ADAY:evObj.ADAY,ETZ:evObj.ETZ,IN_ETZ:evObj.IN_ETZ,EC:evObj.EC},2==evObj.EPERM?callDragEvent(d,dt):callEventDetail(d,dt);var calObj=zcal.getCalObj(evObj.CNAME),calColor=calObj[1].split(":"),colarr=ZCL_getCalColor(calColor[0]),caltxtCol=0==calColor[1]?"zcl_event zcl_evwh":"zcl_event zcl_evbl";d.style.borderColor=colarr[0],d.className=caltxtCol;var ustClass=1==evObj.REF[2]?"msi-mail":"",ust=evObj.USTAT;1==ust?ustClass="msi-inacc":2==ust?ustClass="msi-inden":3==ust&&(ustClass="msi-intac");var time=""!=ustClass?"<i class='"+ustClass+"'></i>":"";time+=1==evObj.REF[4]?"<i class='msi-alarm'></i>":"",time+=evObj.HASATTACH?"<i class='msi-attachicon'></i>":"",time+=evObj.REP?"<i class='msi-repeat'></i>":1==evObj.REF[3]?"<i class='msi-break'></i>":"",time+=evObj.IN_ETZ&&1==evObj.IN_ETZ&&evObj.ETZ&&""!=evObj.ETZ?"<i class='msi-timezone'/></i>":"",time+="<em>"+ZCL_timeInUFormat(evObj.ST)+"</em>";var txt="<div style='background-color:"+(-1!=evObj.EC?zcal.eventcolor[evObj.EC]:colarr[1])+"' class='zcl_evbg'></div><div class='zcl_eventbody' style='height:"+h+"px'>";txt+="<ul><li class='zcl_sp'></li>";var sumtxt="";hrHgt/2>=h?(time+="<span>&nbsp;"+sum+(evObj.LOC?"&nbsp;@&nbsp;"+ZCL_getHTML(evObj.LOC):"")+"</span>",sum=""):sumtxt+="<ul><li class='zcl_sp'></li><li class='zcl_eventml zcl_evttl'>"+sum+"</li></ul>"+(evObj.LOC?"<ul><li class='zcl_sp'></li><li class='zcl_eventml zcl_evttl'>@&nbsp;"+ZCL_getHTML(evObj.LOC)+"</li></ul>":""),txt+="<li>"+time+"</li></ul>",txt+=sumtxt,txt+="</div>",txt+="<div class='zcl_resize'><div class='zcl_scale' id='zcl_scrollme'>&nbsp;</div>",txt+="</div>",d.innerHTML=txt,zcal.$("zcl_eveSub").style.fontSize="",zcal.$("zcl_eveSub").style.lineHeight="",zcal.$("zcl_eveSub").appendChild(d)}}zcalEvents.c={}},appEvent:function(o1,sd){var tmpO1=ZCL_Evl(1,zcalMulti.toString(o1)),calO=zcal.cdata.evelst;if(calO||(calO={}),!calO[sd]||calO[sd].length<1)calO[sd]=new Array,calO[sd][0]=tmpO1;else{var temp=calO[sd];temp[temp.length]=tmpO1}},sortEve:function(eArr,sd){var len=eArr?eArr.length:0;if(len>1)for(var i=0;len-1>i;i++)for(var j=i+1;len>j;j++){var tO1,eO1=ZCL_Evl(1,zcalMulti.toString(eArr[i]));for(var o1 in eO1)tO1=eO1[o1];var tO2,eO2=ZCL_Evl(1,zcalMulti.toString(eArr[j]));for(var o2 in eO2)tO2=eO2[o2];if(tO1&&tO2){var st1=parseInt(tO1.ST,10),dur1=parseInt(tO1.DUR,10);tO1.SD!=sd&&(dur1=parseInt(st1/100,10)*zcal.msec_hour+st1%100*zcal.msec_minute,st1=0);var st2=parseInt(tO2.ST,10),dur2=parseInt(tO2.DUR,10);tO2.SD!=sd&&(dur2=parseInt(st2/100,10)*zcal.msec_hour+st2%100*zcal.msec_minute,st2=0),st1>st2?(eArr[i]=eO2,eArr[j]=eO1):st1==st2&&dur2>dur1?(eArr[i]=eO2,eArr[j]=eO1):(eArr[i]=eO1,eArr[j]=eO2)}}},remEve:function(evid,isall,st){var calO=isall?zcal.cdata.eveAll:zcal.cdata.evelst,bck=null;try{var bDate=null;for(var h in calO)for(var i=0;i<calO[h].length;i++){var temp=calO[h][i];for(var j in temp)if(j==evid){bck=temp,bDate=h,st&&calO[h].splice(i--,1);break}}calO[bDate]&&0==calO[bDate].length&&delete calO[bDate]}catch(e){}return bck},getEve:function(evid,isall,sd){var calO=isall?zcal.cdata.eveAll:zcal.cdata.evelst,bck=null;try{if(calO[sd])for(var i=0;i<calO[sd].length;i++){var temp=calO[sd][i];if(temp[evid]){bck=temp;break}}}catch(e){}return bck},tooltip:function(eObj){var txt="",sd=ZCL_parseDateStr(eObj.SD),ed=ZCL_parseDateStr(eObj.ED);return txt+=sd.dateBy(zcal.ttipformat),eObj.SD!=eObj.ED?(txt+=1==eObj.ADAY?"":" "+ZCL_timeInUFormat(eObj.ST),txt+=" - "+ed.dateBy(zcal.ttipformat),txt+=1==eObj.ADAY?"":" "+ZCL_timeInUFormat(eObj.ET)):txt+=1==eObj.ADAY?"":" "+ZCL_timeInUFormat(eObj.ST)+" - "+ZCL_timeInUFormat(eObj.ET),txt+" "+eObj.SUM},alltime:function(eObj){var ust=eObj.USTAT,ustClass="";0==ust?ustClass="msi-mail":1==ust?ustClass="msi-inacc":2==ust?ustClass="msi-inden":3==ust&&(ustClass="msi-intac");var txt="";return(eObj.APL_REQ&&1==eObj.APL_REQ||eObj.CRM_STATUS&&2==eObj.CRM_STATUS)&&(txt+='<i class="msi-spam"/>'),txt+=1==eObj.ETYPE?"<i class='msi-bdy' alt="+zcal.i18n.birthday+" title="+zcal.i18n.birthday+"></i>":"",txt+=4==eObj.ETYPE?"<i class='msi-hdy' alt="+zcal.i18n.holiday+" title="+zcal.i18n.holiday+"></i>":"",txt+=3==eObj.ETYPE?"<i class='msi-task'></i>":"",txt+=""!=ustClass?"<i class='"+ustClass+"'></i>":"",txt+=1==eObj.REF[4]?"<i class='msi-alarm'></i>":"",txt+=eObj.HASATTACH?"<i class='msi-attachicon'></i>":"",txt+=eObj.REP?"<i class='msi-repeat'></i>":1==eObj.REF[3]?"<i class='msi-break'></i>":"",txt+=1==eObj.ADAY?"":"<em>"+ZCL_timeInUFormat(eObj.ST)+"</em>"},loadMonthData:loadMonthData,retFetchEvents:retFetchEvents};return eventObj}(),zcalMulti=function(){var multiObj={dtArr:new Array,eve:{},retdate:function(d,s){return null==s&&(s=0),new Date(d.substring(0,4),parseInt(d.substring(4,6),10)-1,parseInt(d.substring(6,8),10)+s)},split:function(dd){zcalMulti.dtArr=dd;var eve=zcalMulti.eve;eve.all={};for(var i in zcal.cdata.eveAll)for(var eObjs=zcal.cdata.eveAll[i],j=0;j<eObjs.length;j++)for(var k in eObjs[j]){var eO=eObjs[j][k],cO=zcal.getCalObj(eO.CNAME);cO&&-1==zcal.disabledcal.indexOf(eO.CNAME)&&(1==zcal.cdata.opt.DDE||0==zcal.cdata.opt.DDE&&"2"!=eO.USTAT)&&(eO.SD!=eO.ED?zcalMulti.splitMulti(eObjs[j],k):zcalMulti.splitNorm(eObjs[j],k))}return eve},splitMulti:function(obj,id){for(var rep1=zcalMulti.eve.all,d1=zcalMulti.retdate(obj[id].SD),d2=zcalMulti.retdate(obj[id].ED),i=0;i<=zcalMulti.dtArr[1];i++){var curDt=zcalMulti.retdate(zcalMulti.dtArr[0],i);if(curDt>=d1&&d2>=curDt){curDt=curDt.dateBy("yyyyMMdd"),rep1[curDt]||(rep1[curDt]=new Array),rep1[curDt][rep1[curDt].length]=obj;break}}},splitNorm:function(obj,id){var rep1=zcalMulti.eve.all,d1=zcalMulti.retdate(obj[id].SD);zcalMulti.retdate(zcalMulti.dtArr[0])<=d1&&zcalMulti.retdate(zcalMulti.dtArr[0],zcalMulti.dtArr[1])>=d1&&(d1=d1.dateBy("yyyyMMdd"),rep1[d1]||(rep1[d1]=new Array),rep1[d1][rep1[d1].length]=obj)},appEvent:function(o1,sd){var tmpO1=ZCL_Evl(1,zcalMulti.toString(o1)),calO=zcal.cdata.eveAll;if(calO||(calO={}),!calO[sd]||calO[sd].length<1)calO[sd]=new Array,calO[sd][0]=tmpO1;else{var temp=calO[sd];temp[temp.length]=tmpO1}},sortAll:function(eArr,sd){var len=eArr?eArr.length:0;if(len>1)for(var i=0;len-1>i;i++)for(var j=i+1;len>j;j++){var tO1,eO1=ZCL_Evl(1,zcalMulti.toString(eArr[i]));for(var o1 in eO1)tO1=eO1[o1];var tO2,eO2=ZCL_Evl(1,zcalMulti.toString(eArr[j]));for(var o2 in eO2)tO2=eO2[o2];if(tO1&&tO2){var dur1=ZCL_daysBetween(sd,tO1.ED),dur2=ZCL_daysBetween(sd,tO2.ED);dur2>=dur1?(eArr[i]=eO2,eArr[j]=eO1):(eArr[i]=eO1,eArr[j]=eO2)}}},toString:function(obj){return JSON.stringify(obj)},duplicate:function(obj){var temp="{",cnt=0;for(var i in obj.all){var dObj=obj.all[i];temp+=0!=cnt?",":"",temp+='"'+i+'" : [';var c=0;for(var j in dObj)temp+=0!=c?","+zcalMulti.toString(dObj[j]):zcalMulti.toString(dObj[j]),c++;temp+="]",cnt++}return temp+="}"}};return multiObj}(),zcalAday=function(){var adayObj={c:new Array,s:1,dtArr:new Array,render:function(obj,dt,no){zcalAday.s=no+1;var txt="";zcalAday.creArray();var sd=ZCL_parseDateStr(dt);zcalAday.dtArr[0]=sd,zcalAday.dtArr[1]=zcalMulti.retdate(dt,no);for(var i=0;no>=i;i++){var dd=new Date;dd.setTime(sd),dd.setDate(dd.getDate()+i);var d=dd.dateBy("yyyyMMdd");obj.all[d]&&(zcalMulti.sortAll(obj.all[d],d),txt+=zcalAday.create(obj.all[d],i,d))}var alen=zcalAday.c.length,alayH=18*alen+14;txt+='<div style="height:14px;position:absolute;width:100%;top:'+(alayH-14)+'px"></div>',zcal.$("zcl_allLay").innerHTML=txt,zcal.$("zcl_aContainer").style.height=(alayH>90?90:alayH)+"px",zcal.$("zcl_encloser").style.height=$(zcal.calCenter.listElem).height()-33-zcal.$("zcl_allLay").offsetHeight-1-1+"px",zcal.alldayScrollTop=$("#zcl_allLay").scrollTop(),zcal.hrgridScrollTop=$("#zcl_encloser").scrollTop(),zcalAday.c=new Array},create:function(obj,pos,d){var txt="";for(var i in obj){var slot=zcalAday.freeS(pos),wid=zcalAday.eveWid(slot,pos,obj[i],d),left=zcalAday.eveLeft(pos);txt+=zcalAday.divCont(18*slot,left,obj[i],wid)}return txt},divCont:function(t,l,obj,wid){var txt="";for(var i in obj){var uList=zcalCRM.getCRMColorCode(),calObj=zcal.getCalObj(obj[i].CNAME),sts=!0,ownerId=obj[i].ORG;if("crm"==calObj[14]&&uList&&(uList[ownerId]?sts=0==uList[ownerId][2]?!1:!0:uList.OTHERS&&(sts=0==uList.OTHERS[2]?!1:!0)),sts&&"undefined"!=typeof calObj){var tmpDt=obj[i].REP?i+"_"+obj[i].SD:i,calColor=calObj[1].split(":"),colarr=ZCL_getCalColor(calColor[0]),ecolarr=zcal.eventcolor[obj[i].EC],sd=ZCL_parseDateStr(obj[i].SD),ed=ZCL_parseDateStr(obj[i].ED),tTip=(ZCL_timeInUFormat(obj[i].ST),ZCL_timeInUFormat(obj[i].ET),sd.dateBy("MMM dd"),ed.dateBy("MMM dd"),ZCL_getHTML(zcalEvents.tooltip(obj[i]))),aTime=zcalEvents.alltime(obj[i]),caltxtCol=0==calColor[1]?"zcl_alldy zcl_evwh":"zcl_alldy zcl_evbl";txt+='<div class="'+caltxtCol+'" style="top:'+t+"px;left:"+l+"px;width:"+wid+"px;border-color:"+colarr[0]+'" alt="'+tTip+'" title="'+tTip+'" onmousedown="zcal.eveDetail(\''+tmpDt+"', event, '"+obj[i].SD+"', ['"+obj[i].SD+"', '"+obj[i].ST+"', '"+obj[i].ED+"', '"+obj[i].ET+"', '"+obj[i].EUID+"', '"+obj[i].CNAME+"', '"+obj[i].EPERM+"', '"+obj[i].RIDX+"', '"+obj[i].DPERM+"', '"+obj[i].REPINST+"'])\">",txt+='<div class="zcl_evbg" style="background-color:'+(-1!=obj[i].EC?ecolarr:colarr[1])+'"></div>',txt+='<ul class="zcl_eventbody"><li>'+aTime+"<span>"+ZCL_getHTML(obj[i].SUM)+(obj[i].LOC?"&nbsp;@&nbsp;"+ZCL_getHTML(obj[i].LOC):"")+"</span></li></ul>",txt+="</div>"}}return txt},creArray:function(){for(var temp=zcalAday.c[zcalAday.c.length]=new Array,i=0;i<zcalAday.s;i++)temp[i]=0;return zcalAday.c.length-1},freeS:function(pos){for(var i=0;i<zcalAday.c.length;i++)if(0==zcalAday.c[i][pos])return i;return zcalAday.creArray()},fillspace:function(slot,pos,wid){for(var arr=zcalAday.c[slot],i=pos;wid+pos>i;i++)arr[i]=1},eveWid:function(slot,pos,obj,d){var wid="";for(var i in obj)ed=obj[i].ED;ed=ZCL_parseDateStr(ed),ed>=zcalAday.dtArr[1]?wid=ZCL_daysBetween(d,zcalAday.dtArr[1].dateBy("yyyyMMdd"))+1:ed<zcalAday.dtArr[1]&&(wid=ZCL_daysBetween(d,ed.dateBy("yyyyMMdd"))+1),zcalAday.fillspace(slot,pos,wid);for(var _wdt=0,j=0;wid>j;j++)_wdt+=ZCL_getEleWdt("zcl_a"+(pos+j));return _wdt-5},eveLeft:function(pos){for(var left=0,i=0;pos>i;i++)left+=ZCL_getEleWdt("zcl_a"+i);return left+1}};return adayObj}();zcal.REG=/<|>|&lt;|&gt;|&lt|&gt/gi,zcal.$=function(id){return document.getElementById(id)},String.prototype.trim=function(){var x=this;return x=x.replace(/^\s*(.*)/,"$1"),x=x.replace(/(.*?)\s*$/,"$1")},String.prototype.zcalescape=function(){var val=this;return val=encodeURIComponent(this)},String.prototype.zcalunescape=function(){var val=this;return val=unescape(decodeURIComponent(this))},String.prototype.zcalreplace=function(){var val=this;return val.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"')},zcal.validate=function(str){var lt=str.lastIndexOf("<"),gt=str.lastIndexOf(">");return gt>lt&&"-1"!=lt&&"-1"!=gt?!1:!0},zcal._2digit=function(no){return 10>+no?"0"+no:""+no},ZCL_timeInUFormat=function(t){t=parseInt(t,10);var h=Math.floor(t/100),min=zcal._2digit(t%100);if(0==zcal.cdata.opt.TF){var hr=0==h?12:h>12?h-12:h;return hr+":"+min+" "+(h>11?zcal.i18n.pm:zcal.i18n.am)}return zcal._2digit(h)+":"+min};var ZCL_ClearCacheTimer=null;ZCL_handleLanguageChange=function(){null==ZCL_ClearCacheTimer&&(ZCL_ClearCacheTimer=setTimeout(function(){var date=new Date,time=date.getTime();ZCL_uXHR("/cal/clearusercache.do?nocache="+time,"ZCL_clearUserCache")},3e3))},ZCL_clearUserCache=function(res){ZCL_ClearCacheTimer=null;var resObj=ZCL_Evl(1,res.responseText),opt=zcal.cdata.opt;if(resObj.TIM!=opt.TIM)if("c"==zmApp.currentApp){var _rele=document.createElement("div");_rele.id="zcl_redit_confirm",_rele.className="zcl_rpt",_rele.innerHTML="<div>Your timezone has been updated to <span style='color:#000000;font-weight:bold'>"+resObj.TIM+"</span>. Reload the page for the changes to take effect.</div>",document.body.appendChild(_rele);var options={title:"Hi  "+resObj.username+",",style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright",buttons:[{txt:"OK",callback:function(){ZCL_Continue(resObj)}}]};zmsDialog.create("zcl_redit_confirm",options)}else ZCL_Continue(resObj)},ZCL_Continue=function(resObj){zmsDialog.remove(!0);var opt=zcal.cdata.opt;resObj&&(opt.CTIM=resObj.CTIM,opt.TIM=resObj.TIM,opt.TZLBL=resObj.TZLBL,zcal.cdate=ZCL_parseDateTimeStr(resObj.DATE_STR).getTime()),zcalEvents.loadMonthData()},ZCL_pxToTime=function(pix){var hr,min,hrHgt=$("#zcl_hContainer").find("ul:first")[0].getBoundingClientRect().height;min=Math.round(pix%hrHgt/(hrHgt/60)),min=5*Math.round(min/5),hr=Math.floor(pix/hrHgt),hr=60==min?hr+1:hr,min=60==min?0:min;var t=zcal._2digit(hr)+""+zcal._2digit(min);return t},ZCL_LinkParser=function(desc){var str=desc;str=str.replace(/\n/g," <br/>"),str=str.replace(/\\n/g," <br/>"),str=str.replace(/\\N/g," <br/>");for(var re=/((?=http\:|https\:)[\S]*\/\/[^\s\"]+)/gi,se=/[\w]([\w\-\.\+\'\/]*)@([\w\-\.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})/gi,de=/\<br\/?>/gi,matcharr=[],matcharr2=[],matcharr3=[],resultarr=[],elarr=[];null!=(match=re.exec(str));){var matchobj={};match[0].match(/(\<|\>)/gi)||(matchobj.sindex=match.index,matchobj.eindex=match.index+match[0].length,matcharr.push(matchobj))}for(;null!=(match=se.exec(str));){var matchobj={};matchobj.sindex=match.index,matchobj.eindex=match.index+match[0].length,matcharr2.push(matchobj)}for(;null!=(match=de.exec(str));){var matchobj={};matchobj.sindex=match.index,matchobj.eindex=match.index+match[0].length,matcharr3.push(matchobj)}resultarr=matcharr.concat(matcharr2).concat(matcharr3),resultarr.sort(function(a,b){return a.sindex-b.sindex});for(var i in resultarr){var subs;if(0!=i){subs=str.substring(resultarr[i-1].eindex,resultarr[i].sindex);var textel=document.createTextNode(subs);elarr.push(textel),subs=str.substring(resultarr[i].sindex,resultarr[i].eindex)}else if(0==resultarr[i].sindex)subs=str.substring(0,resultarr[i].eindex);else{subs=str.substring(0,resultarr[i].sindex);var textel=document.createTextNode(subs);elarr.push(textel),subs=str.substring(resultarr[i].sindex,resultarr[i].eindex)}if(subs.match(/\<br\/?>/))var anchorel=document.createElement("BR");else{var anchorel=document.createElement("A");subs.match(se)?anchorel.setAttribute("href","mailto:"+subs):anchorel.setAttribute("href",subs),subs.match(se)?"":anchorel.setAttribute("target","_blank"),anchorel.innerText=subs}if(elarr.push(anchorel),i==resultarr.length-1){var subs=str.substring(resultarr[i].eindex,str.length),textel=document.createTextNode(subs);elarr.push(textel)}}if(0==resultarr.length){var textel=document.createTextNode(""!=str?str:"---");elarr.push(textel)}return elarr},String.prototype.getTimeBy=function(format){format+="";var result="",i_format=0,token="",value=ZCL_parseTime(this);if(value){for(;i_format<format.length;){for(c=format.charAt(i_format),token="";format.charAt(i_format)==c&&i_format<format.length;)token+=format.charAt(i_format++);result+=null!=value[token]?value[token]:token}return result}return this},ZCL_parseTime=function(val){var x=val.trim().toLowerCase();if(/^(20|21|22|23|[01]\d|\d)(([:][0-5]\d){1,2})$/.test(x))return ZCL_ParseByRT(x);if(/^(0[1-9]|1[0-2]|[1-9]):[0-5][0-9]\s*([ap]m|[AP]M)$/.test(x))return ZCL_ParseByAm(x);if(/^(20|21|22|23|[01]\d|\d)[0-5][0-9]$/.test(x))return ZCL_ParseByDB(x);if(x=x.replace(/\D/gi,""),isNaN(x))return{HH:"08",hh:"08",mm:"00",a:"am"};var len=x.length;return x=1==len?x+"000":2==len?x+"00":3==len?x+"0":len>4?x.substring(0,4):x,/^(20|21|22|23|[01]\d|\d)[0-5][0-9]$/.test(x)?ZCL_ParseByDB(x):{HH:"08",hh:"08",mm:"00",a:"am"}},ZCL_ParseByRT=function(x){var y=x.split(":");y[0]=parseInt(y[0],10);var tmp=(0==y[0]?"12|am":12==y[0]?"12|pm":y[0]<12?y[0]+"|am":y[0]-12+"|pm").split("|"),value={};return value.HH=y[0]<10?"0"+y[0]:y[0],value.hh=tmp[0]<10?"0"+tmp[0]:tmp[0],value.mm=y[1],value.a=tmp[1],value},ZCL_ParseByDB=function(x){var y1=x.substring(0,2),y2=x.substring(2,4);y1=parseInt(y1,10);var tmp=(0==y1?"12|am":12==y1?"12|pm":12>y1?y1+"|am":y1-12+"|pm").split("|"),value={};return value.HH=10>y1?"0"+y1:y1,value.hh=tmp[0]<10?"0"+tmp[0]:tmp[0],value.mm=y2.length<2?"0"+y2:y2,value.a=tmp[1],value},ZCL_ParseByAm=function(x){var y=x.split(/:|\s+/);y.length<3&&(y[2]=y[1].substring(2,4),y[1]=y[1].substring(0,2)),y[0]=parseInt(y[0],10);var value={};return value.hh=y[0]<10?"0"+y[0]:y[0],value.mm=y[1],value.a=y[2],value.HH=12==y[0]&&"am"==value.a?"00":"pm"==value.a&&12!=y[0]?y[0]+12:y[0]<10?"0"+y[0]:y[0],value},ZCL_CRTim=function(cur){cur.value;cur.value=cur.value.getTimeBy(zcal.timeformat[zcal.cdata.opt.TF])},ZCL_TimetoNo=function(tim){var val=ZCL_parseTime(tim);return val.HH+""+val.mm},ZCL_replaceString=function(str,params){return str.replace(/\{[0-9]\}/g,function(_1){return _1=_1.replace(/[\{\}]/g,""),params[parseInt(_1)]})},ZCL_getPos=function(el){var r={offsetLeft:el.offsetLeft,offsetTop:el.offsetTop,offsetWidth:el.offsetWidth,offsetHeight:el.offsetHeight};if(el.offsetParent){var tmp=ZCL_getPos(el.offsetParent);r.offsetLeft+=tmp.offsetLeft,r.offsetTop+=tmp.offsetTop,r.offsetRight+=tmp.offsetRight}return r},ZCL_MouseXY=function(ev){var ev=ev||window.event;ev.pageX||ev.pageY?(zcalMX=ev.pageX,zcalMY=ev.pageY):(ev.clientX||ev.clientY)&&(zcalMX=ev.clientX+document.body.scrollLeft,zcalMY=ev.clientY+document.body.scrollTop)},zcal.getCalObj=function(id){return zcal.cdata.calLst[id]||zcal.cdata.calOLst[id]||zcal.cdata.calGLst[id]||zcal.cdata.calALst[id]};var ZCL_ISTIMER=!1,ZCL_SHCAL_EVEUPD;ZCL_chkfeed=function(){var Ffrm=ZCL_$("zcl_frmfeed"),sub="zcl_feedsub";""==ZCL_$(sub).value.trim()?alert(ZCL_ALERTS.entersubject):(Ffrm.zcl_feedcsrf.value=ZCL_CSRFCOO,Ffrm.submit(),Ffrm.reset(),ZCL_clrStck(),ZCL_slideObj.status(ZCL_ALERTS.thfeedback))},ZCL_openRO=function(){var roDiv=ZCL_$("zcl_ro_msg");ZCL_CAStck(new Array("zcl_ro_msg","zcl_mask","zcl_mask1")),roDiv.style.display="",roDiv.style.left=(document.body.offsetWidth-roDiv.offsetWidth)/2+"px",roDiv.style.top=(document.body.offsetHeight-roDiv.offsetHeight)/2+"px",ZCL_openMask()},ZCL_clsRO=function(){ZCL_$("zcl_ro_msg").style.display="none",ZCL_clrStck()},ZCL_getJSONObjCnt=function(jsonObj){var objCnt=0;for(var i in jsonObj)jsonObj.hasOwnProperty(i)&&objCnt++;return objCnt},ZCL_Evl=function(){if(!(arguments.length<2)){if(1==arguments[0])return JSON.parse(arguments[1]);if(2==arguments.length)return window[arguments[1]].apply(this);var args=Array.prototype.slice.call(arguments,2);return window[arguments[1]].apply(this,args)}},ZCL_getEleWdt=function(id){var _ele="string"==typeof id?zcal.$(id):id;return _ele.getBoundingClientRect().width},ZCL_$=function(id){return document.getElementById(id)},ZCL_setOpacity=function(fobj,n){fobj.style.filter="alpha(opacity="+n+"0)",fobj.style.opacity="0."+n,fobj.style.mozOpacity="0."+n},ZCL_findPosYY=function(obj,st){var curtop=0;if(obj.offsetParent)for(;obj.offsetParent&&("absolute"!=obj.style.position||st);)curtop+=obj.offsetTop,obj=obj.offsetParent;else obj.y&&(curtop+=obj.y);return curtop},ZCL_findPosXX=function(obj,st){var curleft=0;if(obj.offsetParent)for(;obj.offsetParent&&("absolute"!=obj.style.position||st);)curleft+=obj.offsetLeft,obj=obj.offsetParent;else obj.x&&(curleft+=obj.x);return curleft},ZCL_daysBetween=function(date1,date2){var temp1=ZCL_parseDateStr(date1),temp2=ZCL_parseDateStr(date2),DSTAdjust=0,oneMinute=6e4,oneDay=60*oneMinute*24;temp2>temp1&&(DSTAdjust=(temp2.getTimezoneOffset()-temp1.getTimezoneOffset())*oneMinute);var diff=Math.abs(temp2.getTime()-temp1.getTime())-DSTAdjust;return Math.ceil(diff/oneDay)},String.prototype.ZCL_calescape=function(){var val=this;return val=encodeURIComponent(this)},ZCL_getHTML=function(value){return value=value.replace(/"/g,"&quot;"),value=value.replace(/'/g,"&#39;"),value=value.replace(/</g,"&lt;"),value=value.replace(/>/g,"&gt;")},ZCL_encodeHTML=function(value){return value=value.replace(/\\/g,""),value=value.replace(/"/g,""),value=value.replace(/'/g,""),value=value.replace(/</g,""),value=value.replace(/>/g,"")},ZCL_getHTML1=function(value){return value=value.replace(/\\/g,"\\\\"),value=value.replace(/"/g,'\\"'),value=value.replace(/'/g,"\\&#39;"),value=value.replace(/</g,"&lt;"),value=value.replace(/>/g,"&gt;")},ZCL_getDescHTML=function(value){return value=value.replace(/"/g,"&quot;"),value=value.replace(/'/g,"&#39;"),value=value.replace(/</g,"&lt;"),value=value.replace(/>/g,"&gt;"),value=value.replace(/\n/g,"<br/>"),value=value.replace(/\\n/g,"<br/>"),value=value.replace(/\\N/g,"<br/>")},ZCL_stopEvents=function(ev){ev=ev||event,ev.stopPropagation?(ev.preventDefault(),ev.stopPropagation()):(ev.cancelBubble=!0,ev.returnValue=!1)},ZCL_rdaysInJSRep=function(repdays){for(var temp=new Array,al=repdays.length,i=0;0!=al&&al>i;i++){var dno=parseInt(repdays[i],10);dno-=1,temp[i]=dno}return temp},ZCL_parseDateStr=function(s){var yyyy=s.substring(0,4),MM=parseInt(s.substring(4,6),10)-1,dd=s.substring(6,8),d=new Date(yyyy,MM,dd);return d.setHours(0,0,0,0),d},ZCL_parseDateTimeStr=function(s){var yyyy=s.substring(0,4),MM=parseInt(s.substring(4,6),10)-1,dd=s.substring(6,8),hr=s.substring(8,10),min=s.substring(10,12),d=new Date(yyyy,MM,dd,hr,min,0,0);return d},ZCL_array_search=function(str,arr){for(var key in arr)if(arr[key]==str)return key;return!1};var ZCL_replaceComName=function(str){return str.replace("{{companyName}}",zcal.i18n.campanyName)},ZCL_replaceProName=function(str){return str.replace("{{productName}}",ZCL_replaceComName(zcal.i18n.productName,zcal.i18n.campanyName))};ZCL_handleCrossProductMessage=function(prd,eList){if("CL"==prd)if("ADD EVENTS"==eList.operation)ZCL_showEvent(eList.data);else if("DELETE EVENTS"==eList.operation){var deletedIds=eList.data;ZCL_updateDeletedEvents(deletedIds)}else if("MAIL INVITE"==eList.operation||"UPDATE INVITED EVENT"==eList.operation){var eventId=eList.data;setTimeout(function(){ZCL_fetchRepeatWithChild(eventId)},3e3)}else if("UPDATE CALENDAR WITH EVENTS"==eList.operation)zcal.refreshMode=eList.operation,zcal.refreshTimer||(zcal.refreshTimer=setTimeout(function(){ZCL_shCalAdd()},6e4));else if("UPDATE EVENTS ONLY"==eList.operation)if(zcal.refreshMode="UPDATE CALENDAR WITH EVENTS"==zcal.refreshMode?zcal.refreshMode:eList.operation,"GSync Events"==eList.data){var syn=zmail.Settings.MailSuite.Apps.CalendarSync.SyncView;syn.setGCalSyncStatus(0),ZCL_shCalAdd();var gsyncPopup=$("#zcl_gcallst");gsyncPopup.length>0&&(_zm.succErrMsg("s",zcal.i18n.synccompmsg),syn.listGCal())}else if("CRM Events"==eList.data){ZCL_shCalAdd();var appPopup=$("#zcl_appcallst");appPopup.length>0&&"crm"==appPopup.data("app")&&zcalSettings.appList.listCrmCal()}else"CalDAV Events"==eList.data?ZCL_shCalAdd():"ZTask Events"==eList.data?(ZCL_shCalAdd(),zcalSettings.appList.setTaskSyncStatus("success"),appPopup=$("#zcl_appcallst"),appPopup.length>0&&"task-sync"==appPopup.data("app")&&(_zm.succErrMsg("s",zcal.i18n.synccompmsg),zcalSettings.appList.listTaskCal())):zcal.refreshTimer||(zcal.refreshTimer=setTimeout(function(){ZCL_shCalAdd()},6e4));else if("IMPORT STATUS"==eList.operation){var importCal=zmail.Settings.MailSuite.Apps.CalendarImport.ImportView;importCal.showImportStatus(eList.data)}else if("CRM SYNC"==eList.operation)if("success"==eList.data.sync_status){zcalSettings.appList.setCrmSyncStatus(eList.data.sync_status),zcal.cdata.calOUids+=","+eList.data.Uid,zcal.refreshMode="UPDATE CALENDAR WITH EVENTS",ZCL_shCalAdd();var appPopup=$("#zcl_appcallst");appPopup.length>0&&"crm"==appPopup.data("app")&&(_zm.succErrMsg("s",zcal.i18n.synccompmsg),zcalSettings.appList.listCrmCal())}else setTimeout(function(){zcalSettings.appList.setCrmSyncFailedStatus()},3e3);else"UPDATE_SHARECAL_EVENT"==eList.operation?setTimeout(function(){ZCL_updateEventsForSharedCal(eList.data.eventIdL,eList.data.ckey)},3e3):"DELETE_SHARECAL_EVENT"==eList.operation&&ZCL_updateDeletedEventsForSharedCal(eList.data)};var zcalUtil=function(){var utilObj={createEvent:function(data){var callback;(callback=data?function(){var eObj=ZCL_nlp(data.SUM,1);eObj.SUM=eObj.SUM?eObj.SUM:"",eObj.DESC=data.DESC?data.DESC:"",eObj.msgId=data.msgId?data.msgId:"",eObj.accId=data.accId?data.accId:"",eObj.ST=eObj.ST?eObj.ST:"",eObj.ET=eObj.ET?eObj.ET:"",eObj.SD=eObj.SD?eObj.SD:"",eObj.ED=eObj.ED?eObj.ED:"",eObj.failureCallbk=data.failureCallbk?data.failureCallbk:"",eObj.successCallbk=data.successCallbk?data.successCallbk:"",eObj.mode=data.msgId?"associate":"",ZCL_constEventView(eObj)}:function(){ZCL_constEventView()})()}};return utilObj}();zcal.NN6=document.getElementById&&!document.all,ZCL_getCalArr=function(sel,skipTask){for(var tmpArr=[],calArr=zcal.cdata.calOrdArr,x=0;x<calArr.length;x++){var calId=calArr[x],calProp=zcal.cdata.calLst[calId];if("1"==zcal.cdata.calLst[calId][8]){var obj={};obj.id=calId,obj.name=calProp[0],obj.display_text=calProp[0],tmpArr.push(obj)}}for(var y in zcal.cdata.calGLst){var ci=zcal.cdata.calGLst[y];if("1"==ci[8]&&(2==ci[12]||3==ci[12])){var obj={};obj.id=y,obj.name=ci[0]+"("+ci[14]+")",obj.display_text=ci[0]+"("+ci[14]+")",tmpArr.push(obj)}}for(var y in zcal.cdata.calALst){var ci=zcal.cdata.calALst[y];if("1"==ci[8]&&(2==ci[12]||3==ci[12])){if("ztask"==ci[14]&&skipTask)continue;var obj={};obj.id=y,obj.name=ci[0]+"("+ci[14]+")",obj.display_text=ci[0]+"("+ci[14]+")",tmpArr.push(obj)}}for(var y in zcal.cdata.calOLst){var ci=zcal.cdata.calOLst[y];if("1"==ci[8]&&(2==ci[12]||3==ci[12])){var obj={};obj.id=y,obj.name=ci[0]+"(others)",obj.display_text=ci[0]+"(others)",tmpArr.push(obj)}}return tmpArr},ZCL_calSelLst=function(sel,skipTask){for(var txt="",calArr=zcal.cdata.calOrdArr,x=0;x<calArr.length;x++){var calId=calArr[x],calProp=zcal.cdata.calLst[calId];"1"==zcal.cdata.calLst[calId][8]&&(txt+='<option value="'+calId+'" '+(sel&&calId==sel?"selected='true'":"")+">"+ZCL_getHTML(calProp[0])+"</option>")}for(var y in zcal.cdata.calGLst){var ci=zcal.cdata.calGLst[y];"1"!=ci[8]||2!=ci[12]&&3!=ci[12]||(txt+='<option value="'+y+'" '+(sel&&y==sel?"selected='true'":"")+">"+ZCL_getHTML(ci[0])+"("+ci[14]+")</option>")}for(var y in zcal.cdata.calALst){var ci=zcal.cdata.calALst[y];if("1"==ci[8]&&(2==ci[12]||3==ci[12])){if("ztask"==ci[14]&&skipTask)continue;txt+='<option value="'+y+'" '+(sel&&y==sel?"selected='true'":"")+">"+ZCL_getHTML(ci[0])+"("+ci[14]+")</option>"}}for(var y in zcal.cdata.calOLst){var ci=zcal.cdata.calOLst[y];"1"!=ci[8]||2!=ci[12]&&3!=ci[12]||(txt+='<option value="'+y+'" '+(sel&&y==sel?"selected='true'":"")+">"+ZCL_getHTML(ci[0])+"(others)</option>")}return txt},zcal.putDate=function(s){var df=zcal.DFORMAT[zcal.cdata.opt.DF],dd=s.substring(6,8),MM=s.substring(4,6),yyyy=s.substring(0,4);return df.replace("dd",dd).replace("MM",MM).replace("yyyy",yyyy)},ZCL_getWeekGridNo=function(eLeft){for(var dayWidth,gridNo=0,hrsecWdt=ZCL_getEleWdt("zcl_lftsec"),tmpLeft=hrsecWdt,eLeft=eLeft-hrsecWdt,adayGrid=ZCL_$("zcl_adaygrid").children,i=0;i<adayGrid.length;i++){if(dayWidth=adayGrid[i].getBoundingClientRect().width,eLeft-=dayWidth,0>eLeft){gridNo=i;break}tmpLeft+=dayWidth}return[gridNo,tmpLeft]},ZCL_dragreturn=function(ele,dty,dtObj){var st=Math.round(ele.offsetTop),et=Math.round(ele.offsetTop+ele.offsetHeight);st=ZCL_pxToTime(st),et=ZCL_pxToTime(et);var eId=ele.id,esd=dtObj.SD,est=dtObj.ST,eLeft=ele.offsetLeft,eed=dtObj.ED,eet=dtObj.ET,ws=zcal.getWeekStart(),tdate=zcal.today.clone();if(0!=zcal.view&&tdate.setDate(tdate.getDate()-tdate.getDay()+ws),0!=eLeft){var sno,sd,ed,tet,dur,addObj;if(sno=parseInt(ele.getAttribute("gridNo"),10),tdate.setDate(tdate.getDate()+sno),sd=tdate.dateBy("yyyyMMdd"),ed=tdate.dateBy("yyyyMMdd"),tet="2400"==et?"0000":et,esd==sd&&est==st&&eet==tet)return zcalView.plotEvents(),!1;if(dur=zcal.findDuration(dtObj),"bot"==dty){if(esd!=eed&&sd==esd&&"0000"!=eet&&"2400"!=eet)return zcalView.plotEvents(),!1;sd=esd,st=est}else if("top"==dty){var hr=parseInt(st/100,10),min=st%100;tdate.setHours(hr,min,0,0),tdate.setTime(tdate.getTime()+dur),ed=tdate.dateBy("yyyyMMdd"),et=tdate.dateBy("HHmm")}addObj={SD:sd,ED:ed,ST:st,ET:et,EID:eId,CNAME:dtObj.CNAME,EUID:dtObj.EUID,RIDX:dtObj.RIDX,ORG:dtObj.ORG,ADAY:dtObj.ADAY,ETZ:dtObj.ETZ,IN_ETZ:dtObj.IN_ETZ},zcalQAdd.edit(addObj)}},zcal.getWeekStart=function(){if(0==zcal.view)return 0;if(2==zcal.view)return zcal.cdata.opt.WS;if(1==zcal.view){var tdate=zcal.today.clone(),ws=zcal.cdata.opt.WK;return tdate.getDay()<ws&&(ws-=7),ws}},zcal.qkAllday=function(e){ZCL_clrStck();var ws,tdate,alayEle,alayWidth,alayLeft,clk,scrollbarWidth;if(ws=zcal.getWeekStart(),tdate=zcal.today.clone(),alayEle=ZCL_$("zcl_allLay"),alayWidth=alayEle.offsetWidth,alayLeft=ZCL_findPosXX(alayEle),clk=(e.clientX-alayLeft)%alayWidth,scrollbarWidth=zcalInit.scrollWidth(),clk>=alayWidth-scrollbarWidth)return!1;clk=e.clientX-ZCL_findPosXX(ZCL_$("zcl_aencloser"));var dnoAndLeft=ZCL_getWeekGridNo(clk);if(0!=zcal.view){tdate.setDate(tdate.getDate()-tdate.getDay()+ws);var sno=dnoAndLeft[0];tdate.setDate(tdate.getDate()+sno)}var sd=tdate.dateBy("yyyyMMdd");zcal.openAQBook({SD:sd,ST:0,ED:sd,ET:0,ADAY:1,ORG:zcal.userid},tdate,e)},ZCL_editEve=function(id,e,calid,euid){zcal.EOBJ=null;var calObj=zcal.getCalObj(calid),flnam="/cal/eInfo.do?ckey="+calObj[9]+"&ekey="+euid+"&calmode="+zcal.CALMODE+(1==zcal.CALMODE?"&grpid="+zcal.ZGID:"");flnam+="&eveId="+(-1!=id.indexOf("_")?id.substring(0,id.indexOf("_"))+"&date="+id.substring(id.indexOf("_")+1,id.length):id),ZCL_TRIDX&&"undefined"!=ZCL_TRIDX&&(flnam+="&ridx="+ZCL_TRIDX),ZCL_REPINST&&void 0!=ZCL_REPINST&&"undefined"!=ZCL_REPINST&&null!=ZCL_REPINST&&(flnam+="&rbrkdate="+ZCL_REPINST),ZCL_XHR(flnam,function(res){ZCL_processEventData(res,calid,calObj[14])}),ZCL_stopEvents(e)},ZCL_openEventView=function(uid,event,caluid){ZCL_uXHR("/cal/veInfo.do?uid="+uid+"&caluid="+caluid,function(res){var obj=ZCL_Evl(1,res.responseText);zcal.GOBJ=obj,zcal.EMODE=0,ZCL_constEventView(obj),ZCL_stopEvents(event)})},zcal.GOBJ=null,ZCL_processEventData=function(res,calid,mode){var obj=ZCL_Evl(1,res.responseText);obj.NO_DATA?ZCL_slideObj.status(ZCL_ALERTS.eventnotfound):"crm"==obj.mode||"recruit"==obj.mode?"success"==obj.status&&(zcal.EOBJ=obj.eobj,zcal.EOBJ.CNAME=calid,zcalCRM.updateCRMData(obj)):"ztask"==mode?(zcal.EOBJ=obj,zcalTask.updateTaskData()):(ZCL_TEMP_ADAY=obj.ADAY,zcal.GOBJ=obj,ZCL_constEventView(obj))},ZCL_reqEveDesc=function(id,e,calid,euid){var calObj=zcal.getCalObj(calid);ZCL_uXHR("/cal/getDesc.do?ckey="+calObj[9]+"&euid="+euid+"&mode=desc","ZCL_retEveDesc"),ZCL_stopEvents(e)},ZCL_retEveDesc=function(res){var obj=ZCL_Evl(1,res.responseText);if(ZCL_$("zcl_qview")){var parDiv=ZCL_$("zcl_qview"),descDiv=ZCL_$("zcl_qdesc"),mlinkDiv=ZCL_$("zcl_mlink");if(obj.DESC&&""!=obj.DESC.trim()){if(descDiv.style.display="",descDiv.innerHTML="<li><div class='zcl_frmtcp'>"+zcal.i18n.description+"</div><p class='zcl_desc' id='zcl_deschtml'></p>",ZCL_$("zcl_deschtml")){var descElement=ZCL_LinkParser(obj.DESC);for(var i in descElement)3==descElement[i].nodeType&&descElement[i].nodeValue.match(/\s/)&&(descElement[i].nodeValue=descElement[i].nodeValue.replace(/\s/g,"")),ZCL_$("zcl_deschtml").appendChild(descElement[i])}var winHgt=document.body.offsetHeight-26,y=winHgt>zcalMY+parDiv.offsetHeight?zcalMY:zcalMY-parDiv.offsetHeight;parDiv.style.top=y+"px",descDiv.style.display=""}else descDiv.style.display="none";obj.MLINK?(mlinkDiv.style.display="",mlinkDiv.innerHTML="<li><div class='zcl_frmtcp';>"+zcal.i18n.met_scheduled+"</div><div ><a style='padding: 0 10px;word-wrap: break-word;display: block;overflow: hidden;text-decoration:none;white-space: normal;' class='zcl_lk' href='"+obj.MLINK+"' target='_blank'>"+(-1!=obj.MLINK.indexOf("start")?zcal.i18n.met_start:zcal.i18n.met_join)+"</a></div></li>"):mlinkDiv.style.display="none"}};var ZCL_TRIDX=null,ZCL_REPINST=null;ZCL_AgenEveDetail=function(id,e,calid,euid,rIndex,rInst){-1!=id.indexOf("_")?id.substring(0,id.indexOf("_")):id;-1!=id.indexOf("_")&&(ZCL_TRIDX=rIndex,ZCL_REPINST="null"!=rInst?rInst:null),zcal.EMODE=0,ZCL_editEve(id,e,calid,euid)};var ZCL_TEMP_EOBJ,ZCL_TEMP_ADAY,ZCL_MYTIT;ZCL_StdDate=function(s){if(1!=[zcl_cdata.opt.DF]){var df=zcal.DFORMAT[zcl_cdata.opt.DF],sdd=df.indexOf("dd"),smm=df.indexOf("MM"),syy=df.indexOf("yyyy"),dd=s.substring(sdd,sdd+2),MM=s.substring(smm,smm+2),yyyy=s.substring(syy,syy+4);return df=dd+"/"+MM+"/"+yyyy}return s},ZCL_detailObj=function(obj){var desc="";ZCL_DELRTO=1,zcal.GOBJ=null,ZCL_TEMP_EOBJ=obj,ZCL_MYTIT=obj.SUM,""==ZCL_MYTIT&&(ZCL_MYTIT="NO SUBJECT"),ZCL_MYTIT.length>255&&(desc+="TITLE : "+ZCL_MYTIT+" \n\n",ZCL_MYTIT=ZCL_MYTIT.slice(0,255)),ZCL_MYTIT=ZCL_MYTIT.zcalescape();var loct=obj.LOC.replace(zcal.REG,"").zcalescape();desc+=obj.DESC.zcalescape();var lnk=obj.LINK&&obj.LINK.replace(zcal.REG,"").zcalescape(),calObj=zcal.getCalObj(obj.CNAME);obj.EPERM=""!=obj.EPERM?obj.EPERM:calObj[12]>=2?2:1==calObj[12]?1:0,obj.DPERM=""!=obj.DPERM?obj.DPERM:calObj[12]>=2?2:0;var ckey=calObj[9],flname="/cal/ae.do?title="+ZCL_MYTIT+"&ckey="+ckey+"&desc="+desc+"&all="+obj.ADAY+"&busy="+obj.TRANS+"&loc="+loct+"&imp="+obj.IMP+"&class="+obj.CLASS+"&ctype="+calObj[5];flname+="&ecolor="+(obj.EC?obj.EC:"-1"),flname+="&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF]+"&sd="+obj.SD+"&st="+obj.ST+"&ed="+obj.ED+"&et="+obj.ET+"&etsk="+obj.ETSK+"&ents="+obj.ENTS+"&emet="+obj.EMET+"&ecrm="+obj.ECRM,flname+=obj.ISDMY?"&isdmy="+obj.ISDMY:"",obj.MSGID&&obj.ACCID&&(flname+="&msgId="+obj.MSGID+"&accId="+obj.ACCID),obj.Attachment&&""!=obj.Attachment&&(flname+="&fileId="+obj.Attachment),obj.RMAttachment&&""!=obj.RMAttachment&&(flname+="&rmAttachId="+obj.RMAttachment),flname+=obj.LINK?"&eurl="+lnk:"",flname+=""!=obj.ETZ?"&etz="+obj.ETZ.zcalescape()+"&inetz="+obj.IN_ETZ:"",flname+=obj.ATT?"&att="+obj.ATT.zcalescape():"",flname+=obj.RMVATT?"&rmatt="+obj.RMVATT.zcalescape():"",flname+="&mty="+zcal.cdata.opt.MT,flname+=obj.GATT&&obj.GATT.length>0?"&gatt="+obj.GATT.join(","):"",flname+=obj.RMVGATT?"&rmgatt="+obj.RMVGATT:"",flname+=obj.USTAT?"&custat="+obj.USTAT:"",flname+=obj.UCMNT?"&cucmt="+obj.UCMNT:"",flname+=obj.SKEY?"&skey="+obj.SKEY:"",flname+="&mstart="+zcal.mlimit[0].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&mend=",flname+=zcal.mlimit[1].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF]),obj.NTFY>-1&&(flname+="&ntfy="+obj.NTFY),""!=obj.EID?(-1!=obj.EID.indexOf("_")?(flname+="&eid="+obj.EID.substring(0,obj.EID.indexOf("_")),0==obj.TYPE?flname+="&type="+obj.TYPE+"&mode=recurE&ridx="+obj.RIDX+"&ekey="+obj.EUID:1==obj.TYPE?flname+="&type="+obj.TYPE+"&mode=recurE&ridx="+obj.RIDX+"&ekey="+obj.EUID:2==obj.TYPE&&0==obj.RIDX?(ZCL_TEMP_EOBJ.TYPE=1,flname+="&mode=edit&ekey="+obj.EUID):(obj.HASATTACH&&(obj.HASATTACH=!1),flname+="&type="+obj.TYPE+"&mode=recurE&ridx="+obj.RIDX+"&ekey="+obj.EUID)):flname+="&mode=edit&eid="+obj.EID+"&ekey="+obj.EUID+"&emil="+obj.EMIL,flname+="&oldCkey="+zcal.$("zcl_oldCkey").value+"&isOthDel="+obj.DELRTO,obj.HASATTACH&&(flname+="&hasAttach="+obj.HASATTACH)):(flname+="&mode=add",ZCL_TEMP_EOBJ.USTAT=1);var temp=obj.ALARM;temp&&(flname+="&isrem=true&remt="+temp[0].REMTIME+"&remty="+temp[0].REMTYPE+"&actty="+temp[0].ACTYPE+"&wrksh="+zcal.cdata.opt.HS);var temp1=obj.REP;temp1&&(flname+="&isrep=true&repf="+temp1.RFRQ+"&rivl="+temp1.RIVL+"&rbyon="+temp1.ROPT+"&rday="+temp1.RDAY.join(",")+"&towk="+temp1.RTOWK+"&rdate="+temp1.RDATE+"&rmon="+temp1.RMON+"&repc="+temp1.RCNT+"&until="+(""!=temp1.RUTL.trim()?ZCL_putDate(temp1.RUTL):"")),flname+="&calmode="+zcal.CALMODE,ZCL_XHR(flname,"ZCL_retDET")},ZCL_retDET=function(xml){zcal.adStck(new Array("zcl_loading","zcl_mask","zcl_mask1"));var res=ZCL_Evl(1,xml.responseText);if("success"==res.status){if(res.hasOwnProperty("SUBTASKS"))for(var subTasks=res.SUBTASKS,i=0;i<subTasks.length;i++){var obj=subTasks[i];obj.ETYPE=3,ZCL_retEve(obj)}ZCL_retEve(res),ZCL_eClose()}else"error"==res.status?(zmUtil.succErrMsg("e",zcal.i18n[res.error]),ZCL_clrStck(),ZCL_eClose()):(zmUtil.succErrMsg("e",res.status),ZCL_clrStck(),ZCL_eClose())},ZCL_retEve=function(res){var smsg=zcal.i18n.evtadded;if(zmsuite.isWorkspaceAvailable("zcal_Container")){var evid=res.id,rdats=res.rdats?res.rdats:"",ordats=(res.oid?res.oid:"",res.ordats?res.ordats:""),skey=res.SKEY,ustat=res.USTAT,isInv=ustat&&""!=ustat?1:0,attEmail=res.ATTEMAIL,etype=res.ETYPE?res.ETYPE:0,tObj={CNAME:ZCL_TEMP_EOBJ.CNAME,ORG:res.ORG,SD:res.SD?res.SD:ZCL_DFDate(ZCL_TEMP_EOBJ.SD),ED:res.ED?res.ED:ZCL_DFDate(ZCL_TEMP_EOBJ.ED),ST:res.ST?res.ST:ZCL_TEMP_EOBJ.ST,ET:res.ET?res.ET:ZCL_TEMP_EOBJ.ET,SUM:res.SUM,LOC:ZCL_TEMP_EOBJ.LOC,REF:[0,1,isInv,0==ZCL_TEMP_EOBJ.TYPE?1:0,ZCL_TEMP_EOBJ.ALARM?1:0],RTO:[0,0,ZCL_TEMP_EOBJ.EMET,ZCL_TEMP_EOBJ.ETSK,ZCL_TEMP_EOBJ.ENTS,ZCL_TEMP_EOBJ.ECRM,ZCL_TEMP_EOBJ.EMIL,""==ZCL_TEMP_EOBJ.LINK?0:1],ADAY:ZCL_TEMP_EOBJ.ADAY,EPERM:ZCL_TEMP_EOBJ.EPERM,DPERM:ZCL_TEMP_EOBJ.DPERM,EC:ZCL_TEMP_EOBJ.EC,EUID:res.euid,ISEXP:res.ISEXP?res.ISEXP:0,ETYPE:etype,HASATTACH:res.HASATTACH?res.HASATTACH:!1};if(smsg=3==tObj.ETYPE?zcal.i18n.taskadded:zcal.i18n.evtadded,ZCL_TEMP_EOBJ.ETZ&&(tObj.ETZ=ZCL_TEMP_EOBJ.ETZ,tObj.IN_ETZ=ZCL_TEMP_EOBJ.IN_ETZ?1:0),attEmail&&""!=attEmail&&(tObj.ATTEMAIL=attEmail),skey&&""!=skey&&(tObj.USTAT=ustat,tObj.SKEY=skey),ZCL_TEMP_EOBJ.REP){var repObj={};repObj.RPDT=ZCL_DFDate(ZCL_TEMP_EOBJ.SD),tObj.REP=repObj}res.APL_REQ&&1==res.APL_REQ&&(tObj.APL_REQ=res.APL_REQ);var t=ZCL_Evl(1,'{"'+evid+'":'+JSON.stringify(tObj)+"}");tObj.EID=evid;var agtxt=JSON.stringify(tObj);if(""!=ZCL_TEMP_EOBJ.EID){smsg=3==tObj.ETYPE?zcal.i18n.taskedited:zcal.i18n.evtedited;var id=-1!=ZCL_TEMP_EOBJ.EID.indexOf("_")?ZCL_TEMP_EOBJ.EID.substring(0,ZCL_TEMP_EOBJ.EID.indexOf("_")):ZCL_TEMP_EOBJ.EID,obj=zcalEvents.remEve(id,!1,!0);if(obj||(obj=zcalEvents.remEve(id,!0,!0)),t[evid].REF[3]=1==obj[id].REF[3]?1:t[evid].REF[3],""!=ordats&&ZCL_insertRepEvents(obj,ordats,id),attEmail&&""!=attEmail&&(tObj.ATTEMAIL=attEmail),skey&&""!=skey&&(tObj.USTAT=ustat,tObj.SKEY=skey),ZCL_TEMP_EOBJ.REP){var repObj={};repObj.RPDT=ZCL_DFDate(ZCL_TEMP_EOBJ.SD),tObj.REP=repObj}res.APL_REQ&&1==res.APL_REQ&&(tObj.APL_REQ=res.APL_REQ);var t=ZCL_Evl(1,'{"'+evid+'":'+JSON.stringify(tObj)+"}");tObj.EID=evid;var agtxt=JSON.stringify(tObj)}if(""!=rdats?ZCL_insertRepEvents(t,rdats,evid):(ZCL_TEMP_EOBJ&&0==ZCL_TEMP_EOBJ.TYPE&&delete t[evid].REP,ZCL_insertEvent(t,evid)),4==zcal.view&&(""!=rdats||""!=ordats?zcalAgenda.dispEvents():""!=ZCL_TEMP_EOBJ.EID?zcalAgenda.edit(agtxt):zcalAgenda.add(agtxt)),void 0!=ZCL_TEMP_EOBJ.ACCID&&void 0!=ZCL_TEMP_EOBJ.MSGID&&""!=ZCL_TEMP_EOBJ.ACCID&&""!=ZCL_TEMP_EOBJ.MSGID){var calid=ZCL_TEMP_EOBJ.CNAME;ZCL_TEMP_EOBJ.successCallbk(res.msgId,res.id,calid)}zcalView.plotEvents()}else if(void 0!=ZCL_TEMP_EOBJ.ACCID&&void 0!=ZCL_TEMP_EOBJ.MSGID&&""!=ZCL_TEMP_EOBJ.ACCID&&""!=ZCL_TEMP_EOBJ.MSGID){var calid=ZCL_TEMP_EOBJ.CNAME;ZCL_TEMP_EOBJ.successCallbk(res.msgId,res.id,calid)}ZCL_enableCal(ZCL_TEMP_EOBJ.CNAME),zmUtil.succErrMsg("s",smsg)},ZCL_insertEvent=function(eObj,id){var sd=eObj[id].SD,ed=eObj[id].ED,et=eObj[id].ET,dur=zcal.findDuration(eObj[id]);if(eObj[id].DUR=dur,sd!=ed&&dur>=864e5||1==eObj[id].ADAY)zcalMulti.appEvent(eObj,sd);else if(zcalEvents.appEvent(eObj,sd),sd!=ed&&"0000"!=et){var tdat=ZCL_parseDateStr(ed),hr=(tdat.getTime(),parseInt(et.substring(0,2),10)),min=parseInt(et.substring(2,4),10);tdat.setHours(hr,min,0,0);{tdat.getTime()}zcalEvents.appEvent(eObj,ed)}},ZCL_insertRepEvents=function(eObj,rdats,id){var dur=zcal.findDuration(eObj[id]);for(var x in rdats){var sd=rdats[x].SD,ed=rdats[x].ED,st=rdats[x].ST,et=rdats[x].ET;if(eObj[id].SD=sd,eObj[id].ED=ed,eObj[id].ST=st,eObj[id].ET=et,eObj[id].RIDX=rdats[x].RIDX,void 0!=rdats[x].REPINST&&(eObj[id].REPINST=rdats[x].REPINST),sd!=ed&&dur>=864e5||1==eObj[id].ADAY)zcalMulti.appEvent(eObj,sd);else if(zcalEvents.appEvent(eObj,sd),sd!=ed&&"0000"!=eObj[id].ET){var tdat1=ZCL_parseDateStr(ed),hr=(tdat1.getTime(),parseInt(eObj[id].ET.substring(0,2),10)),min=parseInt(eObj[id].ET.substring(2,4),10);tdat1.setHours(hr,min,0,0);{tdat1.getTime()}zcalEvents.appEvent(eObj,ed)}}},zcal.findDuration=function(eObj){var esd=ZCL_parseDateStr(eObj.SD),hr=parseInt(eObj.ST.substring(0,2),10),min=parseInt(eObj.ST.substring(2,4),10);esd.setHours(hr,min,0,0);var eed=ZCL_parseDateStr(eObj.ED);return hr=parseInt(eObj.ET.substring(0,2),10),min=parseInt(eObj.ET.substring(2,4),10),eed.setHours(hr,min,0,0),eed.getTime()-esd.getTime()},zcal.eveDetail=function(id,e,cur,teObj){var e=window.event?window.event:e;zcal.setQuickViewDiv(),document.addEventListener("mousedown",ZCL_mdownClr,!1),document.addEventListener("keydown",zcal.keyCtrl,!1),zcal.CAStck(["zcl_qview"]);var temp=-1!=id.indexOf("_")?id.substring(0,id.indexOf("_")):id,SD=teObj[0],ED=teObj[2],ST=teObj[1],ET=teObj[3],obj=zcalEvents.getEve(temp,!1,SD);obj||(obj=zcalEvents.getEve(temp,!0,SD));var ref=$("#zcl_qview"),eperm=teObj[6],dperm=teObj[8],etxt="",cemailTxt="",sum=ZCL_getHTML(obj[temp].SUM),eObj={calId:obj[temp].CNAME,ekey:obj[temp].EUID,rel:id,ridx:teObj[7]&&"undefined"!=teObj[7]?teObj[7]:void 0,rbrkdate:teObj[9]&&"undefined"!=teObj[9]?teObj[9]:void 0};obj[temp].APL_REQ&&1==obj[temp].APL_REQ?etxt+='<ul><li><div style="margin-top: 10px;color: red;margin-left:8px"><i class="msi-spam" style="color: red;"></i> '+zcal.i18n.waitingforapproval+"</div></li></ul>":obj[temp].CRM_STATUS&&2==obj[temp].CRM_STATUS&&(etxt+='<ul><li><div style="margin-top: 10px;color: red;margin-left:8px"><i class="msi-spam" style="color: red;"></i> '+zcal.i18n.cancelled+"</div></li></ul>"),sum=""==sum?"NO SUBJECT":sum,etxt+='<li class="zcl_table">',1==obj[temp].ETYPE?(etxt+='<ul class="zcl_bday">',etxt+=obj[temp].CPHOTO&&""!=obj[temp].CPHOTO?'<li><img src="'+obj[temp].CPHOTO+'" class="zcl_cphoto" id="zcl_cphoto" alt="Contact Photo"/></li>':"",cemailTxt+=obj[temp].CEMAIL&&""!=obj[temp].CEMAIL?'<span class="zcl_greymr">'+obj[temp].CEMAIL+"</span>":""):etxt+="<ul>",cur=-1!=id.indexOf("_")?id.substring(id.indexOf("_")+1,id.length):cur;var sd=ZCL_parseDateStr(cur),ed=SD?zcalMulti.retdate(cur,ZCL_daysBetween(SD,ED)):sd,tStr=sd.dateBy(zcal.QEDITFMT);if(1==obj[temp].ADAY?tStr+=SD!=ED?" - "+ed.dateBy(zcal.QEDITFMT):"":(tStr+=" "+ZCL_timeInUFormat(ST),tStr+=SD!=ED?" - "+ed.dateBy(zcal.QEDITFMT)+" ":" - ",tStr+=ZCL_timeInUFormat(ET)+(obj[temp].IN_ETZ&&1==obj[temp].IN_ETZ&&obj[temp].ETZ&&""!=obj[temp].ETZ?" ("+obj[temp].ETZ+")":"")),etxt+='<li><div class="zcl_frmttcp">'+sum+cemailTxt+"</div><p>"+(obj[temp].LOC&&""!=obj[temp].LOC?ZCL_replaceString(zcal.i18n.timeAndloc,[tStr,ZCL_getHTML(obj[temp].LOC)]):tStr)+"</p></li>",etxt+="</ul>",null!=obj[temp].USTAT){var ust=obj[temp].USTAT,stsarr=[zcal.i18n.pending,zcal.i18n.yes,zcal.i18n.no,zcal.i18n.maybe];etxt+='<ul><li><div class="zcl_frmtcp">'+zcal.i18n.areyoucoming;for(var stastr="",i=1;4>i;i++)stastr+="<li "+(ust==i?'class="zcl_sl"':"")+" data-ustatus="+i+">"+stsarr[i]+"</li>";etxt+='</div><ul class="zcl_qvsup" data-marker="statusUpdate" data-skey="'+obj[temp].SKEY+'">'+stastr+"</ul>",etxt+="</li></ul>"}if(obj[temp].RTO&&zcal.cdata.calLst[obj[temp].CNAME]&&2==obj[temp].EPERM){var tarr,varr,othSrvTxt="",othSrv=ZCL_getOthSrv();tarr=othSrv[0].split(","),varr=othSrv[1].split(","),tarr.push("lnk:links"),varr.push("7");var rto=obj[temp].RTO;eObj.rto=obj[temp].RTO.toString();for(var x=0;x<tarr.length;x++){var srv=tarr[x].split(":")[0],cls=tarr[x].split(":")[1];if(1==rto[varr[x]]){if("met"==srv)continue;var t="lnk"==srv?zcal.i18n["vass_"+srv]:ZCL_replaceComName(zcal.i18n["vass_"+srv]);othSrvTxt+='<li data-service="e'+srv+'" data-marker="eventRTO"><i class="msi-'+cls+'" title="'+t+'" alt="'+t+'"></i></li>'}}""!=othSrvTxt&&(etxt+='<ul><li><ul class="zcl_qvassc">'+othSrvTxt+"</ul></li></ul>")}etxt+='<ul id="zcl_mlink" style="display:none"></ul>',etxt+='<ul id="zcl_qdesc" style="display:none"></ul></li>',etxt+='<li><div class="zcl_table"><ul><li><ul class="zcl_qvnv">';var btnTxt="";("0"!=eperm||"0"!=dperm)&&(btnTxt+='<li data-marker="eventView">'+zcal.i18n.view+"</li>",btnTxt+="2"==eperm?'<li><div class="zcl_SDot"></div></li><li data-marker="eventEdit">'+zcal.i18n.edit+"</li>":"",btnTxt+="0"!=dperm?'<li><div class="zcl_SDot"></div></li><li data-marker="eventDelete">'+("2"==dperm?zcal.i18n.del:zcal.i18n.removeme)+"</li>":""),btnTxt+=""!=btnTxt?'<li><div class="zcl_SDot"></div></li>':"",etxt+=btnTxt+'<li onmousedown="ZCL_clrStck()">'+zcal.i18n.cancel+"</li>",etxt+='</ul></li><li style="width: 50px;text-align: right;">',("0"!=eperm||"0"!=dperm)&&null!=obj[temp].USTAT&&(etxt+='<span style="margin-right:16px" data-marker="eventSend" class="SC_ttip" data-tooltip="Send"><i class="msi-send"></i></span>'),zmail.IntegrationStatus&&zmail.IntegrationStatus.CHAT&&(etxt+='<span data-marker="startChat" class="SC_ttip" data-tooltip="StartChat"><i class="msi-cliq"></i></span>'),etxt+="</ul></li></ul></div></li>",ref.css({left:"-1000px"}),ref.html(etxt);var viewEle=ref.find("[data-marker=eventView]"),editEle=ref.find("[data-marker=eventEdit]"),delEle=ref.find("[data-marker=eventDelete]"),statusEle=ref.find("[data-marker=statusUpdate]"),rtoEle=ref.find("[data-marker=eventRTO]"),sendEle=ref.find("[data-marker=eventSend]"),chatEle=ref.find("[data-marker=startChat]");viewEle.length&&(viewEle.removeAttr("data-marker"),viewEle.off("mousedown").on("mousedown",{eobj:eObj},function(ev){ZCL_REPINST=ev.data.eobj.rbrkdate,ZCL_TRIDX=ev.data.eobj.ridx,ZCL_Dview(ev.data.eobj.rel,ev,ev.data.eobj.calId,ev.data.eobj.ekey)})),editEle.length&&(editEle.removeAttr("data-marker"),editEle.off("mousedown").on("mousedown",{eobj:eObj},function(ev){ZCL_REPINST=ev.data.eobj.rbrkdate,ZCL_TRIDX=ev.data.eobj.ridx,ZCL_Dedit(ev.data.eobj.rel,ev,ev.data.eobj.calId,ev.data.eobj.ekey)})),delEle.length&&(delEle.removeAttr("data-marker"),delEle.off("mousedown").on("mousedown",{eobj:eObj},function(ev){ZCL_Qdel(ev.data.eobj)})),statusEle.length&&(statusEle.removeAttr("data-marker"),statusEle.off("mousedown").on("mousedown",{eobj:eObj,eventId:temp},function(ev){var ele=$(this),targetEle=zcal.NN6?ev.target:event.srcElement,skey=ele.data("skey"),ustatus=$(targetEle).data("ustatus"),eventId=ev.data.eventId;eKey=ev.data.eobj.ekey,calId=ev.data.eobj.calId,ZCL_Estatup(ustatus,skey,eventId,eKey,calId)})),rtoEle.length&&(rtoEle.removeAttr("data-marker"),rtoEle.off("mousedown").on("mousedown",function(ev){var ele=$(this);ZCL_callService(ele.data("service"),temp,ev)})),sendEle.length&&(sendEle.removeAttr("data-marker"),sendEle.off("mousedown").on("mousedown",{eobj:eObj},function(ev){ZCL_eveInfo(ev.data.eobj.rel,ev,ev.data.eobj.calId,ev.data.eobj.ekey,"send")})),chatEle.length&&(chatEle.removeAttr("data-marker"),chatEle.off("mousedown").on("mousedown",{eobj:eObj},function(ev){ZCL_eveInfo(ev.data.eobj.rel,ev,ev.data.eobj.calId,ev.data.eobj.ekey,"chat")})),ref.show(),ZCL_MouseXY(e);var x=document.body.offsetWidth>zcalMX+ref[0].offsetWidth+20?zcalMX:zcalMX-ref[0].offsetWidth,y=document.body.offsetHeight>zcalMY+ref[0].offsetHeight+97?zcalMY:zcalMY-ref[0].offsetHeight;ref.css({top:y+"px",left:x+"px"}),ZCL_reqEveDesc(id,e,obj[temp].CNAME,obj[temp].EUID),ZCL_stopEvents(e)},ZCL_getOthSrv=function(){var othSrvIdx="",othSrv="";return""!=zcal.ZCRM&&zcal.isCRMUser&&(othSrv+=""!=othSrv?",crm:crm":"crm:crm",othSrvIdx+=""!=othSrvIdx?",5":"5"),""!=zcal.ZMET&&(othSrv+=""!=othSrv?",met:meeting":"met:meeting",othSrvIdx+=""!=othSrvIdx?",2":"2"),""!=zcal.ZTSK&&zcal.IsTaskUser&&(othSrv+=""!=othSrv?",tsk:task":"tsk:task",othSrvIdx+=""!=othSrvIdx?",3":"3"),""!=zcal.ZNTS&&zcal.IsTaskUser&&(othSrv+=""!=othSrv?",nts:notes":"nts:notes",othSrvIdx+=""!=othSrvIdx?",4":"4"),""!=zcal.ZMIL&&(othSrv+=""!=othSrv?",mil:mail":"mil:mail",othSrvIdx+=""!=othSrvIdx?",6":"6"),[othSrv,othSrvIdx]},ZCL_array_unique=function(arr){var temp=new Array;for(var key in arr)ZCL_in_array(arr[key],temp)||temp.push(arr[key]);return temp},ZCL_in_array=function(str,arr){for(var key in arr)if(arr[key]==str)return!0;return!1},ZCL_Estatup=function(uStatus,sKey,eventId,eKey,calId){if(!zcal.ISRO){var calObj=zcal.getCalObj(calId),ckey=calObj[9];ZCL_XHR("/cal/cuStat.do?eid="+eventId+"&custat="+uStatus+"&skey="+sKey+"&ckey="+ckey+"&ekey="+eKey+"&calmode="+zcal.CALMODE,function(res){var _robj=ZCL_Evl(1,res.responseText);ZCL_updateSts(eventId,_robj.STS),zcalView.plotEvents()})}},ZCL_updateSts=function(eid,sts){if(sts&&("1"==sts||"2"==sts||"3"==sts)){var obj=zcalEvents.remEve(eid,!1,!1),calA=obj?zcal.cdata.evelst:zcal.cdata.eveAll;for(var h in calA)for(var i=0;i<calA[h].length;i++){var temp=calA[h][i];for(var j in temp)j==eid&&(temp[j].USTAT=sts)}zmUtil.succErrMsg("s",zcal.i18n.statusupdated)}},ZCL_callService=function(othSrv,eid,e){ZCL_clrStck(),ZCL_SERVICE=othSrv,"ecrm"==othSrv||"emet"==othSrv||"elnk"==othSrv||"emil"==othSrv?(window.open(location.protocol+"//"+zcal.ZCAL+"/cal/nxtPag.do?sname="+othSrv+"&evid="+eid,"_blank"),ZCL_stopEvents(e)):(ZCL_SERVICE=othSrv,ZCL_XHR("/cal/viewOth.do?sname="+othSrv+"&evid="+eid,"ZCL_serviceRes"))},ZCL_CheckUserInOtherServices=function(){ZCL_isTaskUser(),ZCL_isCRMUser()},ZCL_isTaskUser=function(){""!=zcal.ZTSK&&ZCL_uXHR("/cal/getPortal.do?mode=task-sync",function(res){var obj=ZCL_Evl(1,res.getElementsByTagName("obj")[0].firstChild.nodeValue);"success"===obj.status&&(zcal.IsTaskUser=obj.isMailSuiteUser||!1)})},ZCL_isCRMUser=function(){""!=zcal.ZCRM&&ZCL_uXHR("/cal/getPortal.do?mode=crm-sync",function(xml){if(void 0!=xml){var obj=ZCL_Evl(1,xml.getElementsByTagName("obj")[0].firstChild.nodeValue);"success"===obj.status&&(zcal.isCRMUser=!0)}})},ZCL_setWorkDays=function(){var workStart=zcal.cdata.opt.WS,workEnd=zcal.cdata.opt.WE,workDays=[];if(workStart>workEnd){for(;6>=workStart;)workDays.push(workStart),workStart++;workStart=0}for(var i=workStart;workEnd>=i;i++)workDays.push(i);return workDays},ZCL_getTZ=function(obj){ZCL_uXHR("/cal/timez.do",function(res){zcal.timezones=ZCL_Evl(1,res.responseText),obj.callback&&obj.callback()})},ZCL_shCalAdd=function(){zcal.refreshTimer&&window.clearTimeout(zcal.refreshTimer),"UPDATE CALENDAR WITH EVENTS"==zcal.refreshMode?ZCL_XHR("/cal/getOtherCal.do",function(res){var obj=ZCL_Evl(1,res.responseText);zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,zcal.cdata.calByGrp=obj.gclstbygrp,ZCL_setGrpCal(obj.gclst),ZCL_updateAppCalList(obj.aclst),ZCL_setCalendars(),zcalEvents.loadMonthData(),4==zcal.view&&zcalAgenda.dispEvents()}):"UPDATE EVENTS ONLY"==zcal.refreshMode&&(zcalEvents.loadMonthData(),4==zcal.view&&zcalAgenda.dispEvents()),zcal.refreshTimer=null,zcal.refreshMode=""},ZCL_updateDeletedEvents=function(deletedIds){deletedIds.length>0&&(ZCL_removeDeletedEvents(deletedIds),ZCL_updateEvents())},ZCL_removeDeletedEvents=function(deletedIds){if(deletedIds.length>0){var alldayObj=zcal.cdata.eveAll,normalObj=zcal.cdata.evelst,delDateStr="";for(var i in alldayObj)for(var j=0;j<alldayObj[i].length;j++){var eObj=alldayObj[i][j];for(var k in eObj){var idx=deletedIds.indexOf(k);-1!=idx&&(alldayObj[i].splice(j--,1),delDateStr+=""!=delDateStr?","+i:i)}}if(""!=delDateStr)for(var bDate,datArr=delDateStr.split(","),i=0;i<datArr.length;i++)bDate=datArr[i],alldayObj[bDate]&&0==alldayObj[bDate].length&&delete alldayObj[bDate];delDateStr="";for(var i in normalObj)for(var j=0;j<normalObj[i].length;j++){var eObj=normalObj[i][j];for(var k in eObj){var idx=deletedIds.indexOf(k);-1!=idx&&(normalObj[i].splice(j--,1),delDateStr+=""!=delDateStr?","+i:i)}}if(""!=delDateStr)for(var bDate,datArr=delDateStr.split(","),i=0;i<datArr.length;i++)bDate=datArr[i],normalObj[bDate]&&0==normalObj[bDate].length&&delete normalObj[bDate]}},ZCL_fetchRepeatWithChild=function(eId){ZCL_XHR("/cal/getRepWithChild.do?eid="+eId+"&mstart="+zcal.mlimit[0].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&mend="+zcal.mlimit[1].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF],function(res){var _robj=ZCL_Evl(1,res.responseText);ZCL_updateRepeatEvent(_robj)})},ZCL_updateRepeatEvent=function(_robj){if(_robj.obj.eobj){var obj=_robj.obj.eobj,eids=_robj.obj.eids;ZCL_removeDeletedEvents(eids);for(var d in obj)for(var i=0;i<obj[d].length;i++){var eObj=obj[d][i];for(var id in eObj)ZCL_insertEvent(eObj,id)}ZCL_updateEvents()}},ZCL_updateEventsForSharedCal=function(eventId,cKey){var _calobj,_calid=ZCL_getCalIdFromCalKey(cKey);void 0!=_calid&&(_calobj=zcal.getCalObj(_calid),1==_calobj[8]&&ZCL_XHR("/cal/updShareCalEve.do?eid="+eventId+"&cKey="+cKey+"&mstart="+zcal.mlimit[0].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&mend="+zcal.mlimit[1].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF],function(res){var _robj=ZCL_Evl(1,res.responseText);if(_robj.obj.eobj){var obj=_robj.obj.eobj,euids=_robj.obj.euids,_remobj=_robj.remtype;ZCL_removeDeletedEventsUsingUids(euids,_calid);for(var d in obj)for(var i=0;i<obj[d].length;i++){var eobj=obj[d][i];for(var id in eobj)eobj[id].CNAME=_calid,eobj[id].REF[4]=_remobj[eobj[id].EUID]?_remobj[eobj[id].EUID]:_calobj[6].ACTYPE?1:0,ZCL_insertEvent(eobj,id)}ZCL_updateEvents()}}))},ZCL_updateDeletedEventsForSharedCal=function(ekeys){var _calid,deletedEUIDs=ekeys.ekey.split(","),cKey=ekeys.ckey;_calid=ZCL_getCalIdFromCalKey(cKey),ZCL_removeDeletedEventsUsingUids(deletedEUIDs,_calid),ZCL_updateEvents()},ZCL_removeDeletedEventsUsingUids=function(deletedEUIDs,_calid){if(deletedEUIDs.length>0){var alldayObj=zcal.cdata.eveAll,normalObj=zcal.cdata.evelst,delDateStr="";for(var i in alldayObj)for(var j=0;j<alldayObj[i].length;j++){var temp=alldayObj[i][j];for(var k in temp){var ekey=temp[k].EUID,ecalid=temp[k].CNAME,idx=deletedEUIDs.indexOf(ekey);-1!=idx&&ecalid==calid&&(alldayObj[i].splice(j--,1),delDateStr+=""!=delDateStr?","+i:i)}}if(""!=delDateStr)for(var datArr=delDateStr.split(","),i=0;i<datArr.length;i++){var bDate=datArr[i];alldayObj[bDate]&&0==alldayObj[bDate].length&&delete alldayObj[bDate]}delDateStr="";for(var i in normalObj)for(var j=0;j<normalObj[i].length;j++){var temp=normalObj[i][j];for(var k in temp){var ekey=temp[k].EUID,ecalid=temp[k].CNAME,idx=deletedEUIDs.indexOf(ekey);-1!=idx&&ecalid==_calid&&(normalObj[i].splice(j--,1),delDateStr+=""!=delDateStr?","+i:i)}}if(""!=delDateStr)for(var datArr=delDateStr.split(","),i=0;i<datArr.length;i++){var bDate=datArr[i];normalObj[bDate]&&0==normalObj[bDate].length&&delete normalObj[bDate]}}},ZCL_getCalIdFromCalKey=function(cKey){var _cobj;for(var i in zcal.cdata.calLst)if(_cobj=zcal.cdata.calLst[i],_cobj[9]==cKey)return i;for(var i in zcal.cdata.calALst)if(_cobj=zcal.cdata.calALst[i],_cobj[9]==cKey)return i;for(var i in zcal.cdata.calGLst)if(_cobj=zcal.cdata.calGLst[k],_cobj[9]==cKey)return i;for(var l in zcal.cdata.calOLst)if(_cobj=zcal.cdata.calOLst[l],_cobj[9]==ckey)return i},ZCL_updateAppCalList=function(){var _cobj,appCalList=zcal.cdata.calALst;zcal.appChild={},zcal.appCount={};for(var i in appCalList)_cobj=appCalList[i],zcal.appCount[i]={c:"0",p:"-1"},"crm"==_cobj[14]&&(zcal.appChild[i]={CH:zcalCRM.getCRMCalChild(_cobj[1],i)})},ZCL_updateGroupCalList=function(){zcal.gcal=zcal.ZCAL_MULTICAL_4_GRP&&0==zcal.CALMODE?zcalInit.ZCL_setGrpCal():zcalInit.formatCalData(zcal.cdata.calGLst,zcal.cdata.gcalOdrArr)},ZCL_getSubGrpLst=function(){ZCL_XHR("/cal/subCal.do?mode=sub-strmgrp","ZCL_retDefSubCAL")},ZCL_retDefSubCAL=function(xml){if(ZCL_clrStck(),200==xml.status){var resObj=ZCL_Evl(1,xml.responseText),sta=(resObj.mode,resObj.id?resObj.id:null,resObj.status),obj=resObj;resObj.streamGrpLst&&(ZCL_STREAMGROUPLIST=resObj.streamGrpLst),zcal.cdata.calGLst="success"==sta&&void 0!=obj.gclst?obj.gclst:zcal.cdata.calGLst,"success"==sta&&void 0!=obj.gclst&&(zcalEvents.loadMonthData(),ZCL_setCalendars())}else ZCL_slideObj.status(ZCL_ALERTS.errmsg)},ZCL_closeDownCal=function(){zmsDialog.remove();var acalPP=$("#zcl_secureDow");acalPP.length>0&&acalPP.remove(),zmUtil.hideMenu()},ZCL_secureDow=function(type,ckey){var secDow=$(zcalTemplate.popupCreateSecdown()),option={title:"Secure Your files",mask:!0,style:{width:"500px"},buttons:[{txt:"Submit",callback:function(){if("export"==type){var mgaocal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;mgaocal.ZCL_icsDown(ckey)}else ZCL_pdfDown()}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){ZCL_closeDownCal()}}],closeaction:function(){ZCL_closeDownCal()}};ZCL_$("zcl_secureDow")||$("body").append('<div id="zcl_secureDow" class="zcl_addcalcn"></div>'),$("#zcl_secureDow").html(secDow),secDow.find("#zcl_pwd").on("focusout",function(){var pwd=secDow.find("#zcl_pwd")[0].value;if(""==pwd)$("#zcl_pwd_er")[0].style.display="",$("#zcl_pwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwdcon")[0].style.display="none";else if(pwd.length<8)$("#zcl_pwd_er")[0].style.display="",$("#zcl_pwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwdcon")[0].style.display="none";else{var pwdRegex=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})");pwdRegex.test(pwd)?($("#zcl_pwd_er")[0].style.display="none",$("#zcl_pwd")[0].className="SC_tiput"):($("#zcl_pwd_er")[0].style.display="",$("#zcl_pwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwdcon")[0].style.display="none")}}),secDow.find("#zcl_repwd").on("focusout",function(){var repwd=secDow.find("#zcl_repwd")[0].value;""==repwd&&($("#zcl_repwd_er")[0].style.display="",$("#zcl_repwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwdcon")[0].style.display="none")}),zmsDialog.create("zcl_secureDow",option)},zcal.qObj={},zcal.setQuickViewDiv=function(obj){zcal.CAStck(["zcl_qview"]);var $qview=$("#zcl_qview");$qview.length||($qview=$('<ul id="zcl_qview" class="zcl_qview" style="display:none"></div>'),$("body").append($qview)),$qview.removeAttr("class").addClass(obj&&obj.class||"zcl_qview")},zcal.setQuickCreateDiv=function(skipTask){var qbk,st,tim1,tim2,d=new Date(zcal.cdate),ttemp=zcal.timeformat[zcal.cdata.opt.TF],hrs=d.getHours(),min=d.getMinutes();st=2*hrs+(min>30?2:1),st=st>46?46:st,tim1=zcal.TTT[st].getTimeBy(ttemp),tim2=zcal.TTT[st+1].getTimeBy(ttemp),ZCL_$("zcl_qbk")||document.body.appendChild($("<ul id='zcl_qbk' class='zcl_qbook'>")[0]),qbk=$("#zcl_qbk"),qbk.empty();var txt='<li class="zcl_qbtitl" id="zcl_qbkTop">'+(3==zcal.view?zcal.qObj.SD==zcal.qObj.ED?'<input type="text" placeholder="'+zcal.i18n.eventplaceholder+'" class="SC_tiput zcl_Qbk" id="zcl_qbkttl"/>':'<input type="text" placeholder="'+zcal.i18n.alldayeventplaceholder+'" class="SC_tiput zcl_Qbk" id="zcl_qbkttl"/>':'<input type="text" placeholder="'+zcal.i18n.eventtitle+'" class="SC_tiput zcl_Qbk" id="zcl_qbkttl"/>')+'<input type="text" placeholder="'+zcal.i18n.loc+'" class="SC_tiput zcl_Qloc" id="zcl_qbkloc"/></li><li class="zcl_qbcnt" id="zcl_qbkBot"><ul class="zcl_frmrw"><li class="zcl_frmtt">'+zcal.i18n.calendar+'</li><li><div class="SC_select"><input rel="'+zcal.cdata.defcal+'" id="zcl_qbkcal" value="'+ZCL_getHTML(zcal.cdata.calLst[zcal.cdata.defcal][0])+'"></div></li></ul><ul><li class=""><div class="SC_PUbtm"><span class=" js-button-selector" data-id="0" id="zcl_cr_btn">'+zcal.i18n.create+'</span><b id="zcl_mr_lk" class="zcl_lk">'+zcal.i18n.moredet+' </b></div></li></ul></li><input type="hidden" value="'+ZCL_putDate(zcal.qObj.SD)+'" id="zcl_qbksd"/><input type="hidden" value="'+ZCL_putDate(zcal.qObj.ED)+'" id="zcl_qbked"/><a class="zcl_qbl" id="zcl_qbkA"></a>';qbk.html(txt);var $title=qbk.find("#zcl_qbkttl"),$create=qbk.find("#zcl_cr_btn"),$more=qbk.find("#zcl_mr_lk");$title.off("keydown").on("keydown",function(ev){var x=ev.which||ev.keyCode;13==x&&zcal.quickCreate()}),$create.off("click").on("click",function(){zcal.quickCreate()}),$more.off("click").on("click",function(){ZCL_QDetail()}),qbk.find("#zcl_qbkcal").off("click").on("click",function(){var component,calArr=ZCL_getCalArr(null,skipTask),config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.parWidth=!0,config.onSelect=function(id,selectObj){zcal.setCalVal(that,id,selectObj),component.hide()},config.dataCallback=function(){return calArr},component=zmUtil.createFLComp("generic",config),component.elem.css("z-index","999"),component.show()})},zcal.setCalVal=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("rel",id)},ZCL_updateEndTime=function(){},zcal.dquickBook=function(topE,botE,dno,e){var skipTask=!0,_sh=zcal._2digit((topE-topE%zcalView.hourSlot)/zcalView.hourSlot),_st=zcal._2digit(topE%zcalView.hourSlot*zcalView.slotDuration),_eh=zcal._2digit((botE-botE%zcalView.hourSlot)/zcalView.hourSlot),_et=zcal._2digit(botE%zcalView.hourSlot*zcalView.slotDuration),stime=_sh+_st,etime=_eh+_et,ws=zcal.getWeekStart(),_td=zcal.today.clone();0!=zcal.view&&_td.setDate(_td.getDate()-_td.getDay()+ws),_td.setDate(_td.getDate()+dno);var sdate=_td.dateBy("yyyyMMdd"),edate=sdate;if("2400"==etime){var _td1=_td.clone();_td1.setDate(_td1.getDate()+1),edate=_td1.dateBy("yyyyMMdd"),etime="0000"}zcal.openQBook({SD:sdate,ST:stime,ED:edate,ET:etime,ADAY:0,ORG:zcal.userid},_td,_td,skipTask,e)},zcal.openQBook=function(eobj,sd,ed,skipTask,e){zcal.qObj=eobj,zcal.OBJTEMP=eobj,zcal.setQuickCreateDiv(skipTask);var _qbkhgt,_qbk=ZCL_$("zcl_qbk");if(_qbk.style.display="",_qbkhgt=_qbk.offsetHeight,zcal.CAStck(["zcl_qbk"]),document.addEventListener("mousedown",ZCL_mdownClr,!1),document.addEventListener("keydown",zcal.keyCtrl,!1),3==zcal.view){for(var x=0;ZCL_NOB>x;x++)zcal.stck.push("zcl_lay"+x);var ebox=ZCL_daysBetween(zcal.mlimit[0].dateBy("yyyyMMdd"),ed.dateBy("yyyyMMdd")),_lay=zcal.$("zcl_lay"+ebox),_llft=ZCL_findPosXX(_lay),_ltop=ZCL_findPosYY(_lay),_lhgt=_lay.offsetHeight,_lwdt=_lay.offsetWidth;_llft>_qbk.offsetWidth?(_qbk.style.left=_llft+_lwdt/2-310+"px",document.body.offsetHeight-_ltop<_qbkhgt+_lhgt/2?(_qbk.style.top=_ltop+_lhgt/2-_qbkhgt+"px",zcal.$("zcl_qbkA").className="zcl_qbr"):(_qbk.style.top=_ltop+_lhgt/2+"px",zcal.$("zcl_qbkA").className="zcl_qtr")):(_qbk.style.left=_llft+_lwdt/2+"px",document.body.offsetHeight-_ltop<_qbkhgt+_lhgt/2?(_qbk.style.top=_ltop+_lhgt/2-_qbkhgt+"px",zcal.$("zcl_qbkA").className="zcl_qbl"):(_qbk.style.top=_ltop+_lhgt/2+"px",zcal.$("zcl_qbkA").className="zcl_qtl"))}else{{$(zcal.calCenter.listElem)}zcal.stck.push("zcl_lay");var _lay=zcal.$("zcl_lay"),_ltop=ZCL_findPosYY(zcal.$("zcl_encloser"))+_lay.offsetTop-zcal.$("zcl_encloser").scrollTop,_llft=_lay.offsetLeft,_lhgt=_lay.offsetHeight,_lwdt=_lay.offsetWidth,_qbktop=_ltop+_lhgt-_qbkhgt+13;_qbk.style.top=_qbktop+"px",_llft>_qbk.offsetWidth?(zcal.$("zcl_qbkA").className=_qbktop>_ltop?"zcl_qtr":"zcl_qbr",_qbk.style.left=zcal.gridleft+_llft-_qbk.offsetWidth+15+"px"):(zcal.$("zcl_qbkA").className=_qbktop>_ltop?"zcl_qtl":"zcl_qbl",_qbk.style.left=zcal.gridleft+_llft+_lwdt/2+"px")}zcal.$("zcl_qbkttl").focus(),ZCL_stopEvents(e)},zcal.openAQBook=function(eobj,sd,e){var skipTask=!1;zcal.qObj=eobj,zcal.OBJTEMP=eobj,zcal.setQuickCreateDiv(skipTask);var _qbkhgt,_qbk=ZCL_$("zcl_qbk");_qbk.style.display="",_qbkhgt=_qbk.offsetHeight,zcal.CAStck(["zcl_qbk"]),document.addEventListener("mousedown",ZCL_mdownClr,!1),document.addEventListener("keydown",zcal.keyCtrl,!1);var tempY=zcal.NN6?e.clientY:event.clientY,tempX=zcal.NN6?e.clientX:event.clientX;tempX>_qbk.offsetWidth?(zcal.$("zcl_qbkA").className="zcl_qtr",_qbk.style.left=tempX-_qbk.offsetWidth-15+"px"):(zcal.$("zcl_qbkA").className="zcl_qtl",_qbk.style.left=tempX+15+"px"),_qbk.style.top=tempY-30+"px",zcal.$("zcl_qbkttl").focus(),ZCL_stopEvents(e)},zcal.mquickBook=function(sbox,ebox,e){var skipTask=!1,_sdate=zcal.mlimit[0].clone(),_edate=_sdate.clone();_sdate.setDate(_sdate.getDate()+(sbox>ebox?ebox:sbox)),_edate.setDate(_edate.getDate()+(sbox>ebox?sbox:ebox)),zcal.openQBook({SD:_sdate.dateBy("yyyyMMdd"),ST:0,ED:_edate.dateBy("yyyyMMdd"),ET:0,ADAY:1,ORG:zcal.userid},_sdate,_edate,skipTask,e)},zcal.quickCreate=function(){var $tit=$("#zcl_qbk").find("#zcl_qbkttl"),$loc=$("#zcl_qbk").find("#zcl_qbkloc"),$cal=$("#zcl_qbk").find("#zcl_qbkcal");if(""==$tit.val().trim())return zmUtil.succErrMsg("e",zcal.i18n.plenttle),ZCL_$("zcl_qbkttl").focus(),!1;var timobj;if(3==zcal.view){timobj=ZCL_nlp($tit.val().trim(),0);var st=timobj.ST,et=timobj.ET;if(zcal.qObj.SD==zcal.qObj.ED)if(st||et){if(et.match(/(24)(\d\d)?/)){var temp=et.match(/(24)(\d\d)?/);et=temp[1]?"00"+(temp[2]?temp[2]:"00"):et}if(zcal.qObj.ST=st?ZCL_TimetoNo(st):"0000",zcal.qObj.ET=et?ZCL_TimetoNo(et):"0000",zcal.qObj.ST>zcal.qObj.ET&&zcal.qObj.SD==zcal.qObj.ED){var ZCL_DATCHNG=parseInt(zcal.qObj.ED%100)+parseInt(1),ZCL_MONYEAR=parseInt(zcal.qObj.ED/100);zcal.qObj.ED=ZCL_MONYEAR+""+ZCL_DATCHNG}zcal.qObj.ADAY=0}else zcal.qObj.ADAY=1}zcal.qObj.SUM=3==zcal.view?timobj.SUM:$tit.val().trim(),zcal.qObj.CNAME=$cal[0].getAttribute("rel"),zcal.qObj.LOC=$loc.val().trim(),zcalQAdd.add(zcal.qObj),ZCL_clrStck()},zcal.shwLst=function(ele){var _dd=ele.parentNode.getElementsByTagName("ul")[0];_dd.style.display="block"},zcal.selVal=function(val,ele){var _dd=ele.parentNode,_ddp=_dd.parentNode,_inp=_ddp.getElementsByTagName("input");_inp[0].value=ele.innerHTML,_inp[1].value=val,_dd.style.display="none"};var zcalQAdd=function(){var quickObj={adObj:null,add:function(obj){this.adObj=obj;var cObj=zcal.getCalObj(obj.CNAME),flnam="/cal/quick.do?mode=a&sd="+zcal.putDate(obj.SD)+"&ed="+zcal.putDate(obj.ED)+"&st="+obj.ST+"&et="+obj.ET+"&all="+obj.ADAY+"&sum="+(""==obj.SUM?"NO SUBJECT":obj.SUM).zcalescape()+"&loc="+(""!=obj.LOC?obj.LOC.zcalescape():"")+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF]+"&ckey="+cObj[9]+"&ctype="+cObj[5]+"&wrksh="+zcal.cdata.opt.HS+"&calmode="+zcal.CALMODE;if("crm"==cObj[14]||"recruit"==cObj[14]&&(-1!=zcal.cdata.calOUids.indexOf("zohoRecruit4_")||1==zcal.cdata.opt.GTYPE&&"new"==zcal.cdata.opt.VERSION)){var userObj="recruit"==cObj[14]?zcalCRM.getRecruitCurrentUser():zcalCRM.getCRMCurrentUser();flnam+="&ownerId="+userObj.USERID+"&Event Owner="+userObj.Name}ZCL_XHR(flnam,"zcalQAdd.retAdd")},retAdd:function(res){var res=ZCL_Evl(1,res.responseText);if("success"==res.status){var evid=res.id,calObj=zcal.getCalObj(zcalQAdd.adObj.CNAME),tObj={CNAME:zcalQAdd.adObj.CNAME,ORG:res.ORG?res.ORG:zcalQAdd.adObj.ORG,RTO:[0,0,0,0,0,0,0,0],SD:res.SD?res.SD:zcalQAdd.adObj.SD,ST:res.ST?res.ST:zcalQAdd.adObj.ST,ED:res.ED?res.ED:zcalQAdd.adObj.ED,ET:res.ET?res.ET:zcalQAdd.adObj.ET,REF:[0,1,0,0,calObj[6].ACTYPE?1:0],SUM:zcalQAdd.adObj.SUM,LOC:zcalQAdd.adObj.LOC,ADAY:zcalQAdd.adObj.ADAY,EPERM:calObj[12]>=2?2:1==calObj[12]?1:0,DPERM:calObj[12]>=2?2:0,EUID:res.euid?res.euid:"",EC:"-1",APL_REQ:res.APL_REQ&&1==res.APL_REQ?res.APL_REQ:"",ETYPE:res.ETYPE?res.ETYPE:0},t=ZCL_Evl(1,'{"'+evid+'":'+JSON.stringify(tObj)+"}");tObj.EID=evid;var t1=JSON.stringify(tObj);ZCL_insertEvent(t,evid),4==zcal.view&&zcalAgenda.add(t1),ZCL_enableCal(zcalQAdd.adObj.CNAME),zmUtil.succErrMsg("s",3==tObj.ETYPE?zcal.i18n.taskadded:zcal.i18n.evtadded),zcalView.plotEvents(),zcalQAdd.adObj=null}else res.error&&""!=res.error.trim()?zmUtil.succErrMsg("e",zcal.i18n[res.error]):zmUtil.succErrMsg("e",res.status)},edit:function(obj){this.adObj=obj;var cObj=zcal.getCalObj(obj.CNAME),flnam="/cal/quick.do?eid="+obj.EID+"&sd="+zcal.putDate(obj.SD)+"&ed="+zcal.putDate(obj.ED)+"&st="+obj.ST+"&et="+obj.ET+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF]+"&ckey="+cObj[9]+"&ekey="+obj.EUID+"&ctype="+cObj[5]+"&wrksh="+zcal.cdata.opt.HS+"&all="+obj.ADAY+"&calmode="+zcal.CALMODE;flnam+=obj.SUM?"&sum="+obj.SUM:"",flnam+=obj.ETZ?"&etz="+obj.ETZ.zcalescape()+(obj.IN_ETZ&&1==obj.IN_ETZ?"&inetz=true":"&inetz=false"):"",flnam+="&mstart="+zcal.mlimit[0].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&mend="+zcal.mlimit[1].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF]),flnam+="&mode="+(null!=obj.TY?"recurE&ridx="+obj.RIDX+"&type="+obj.TY:"e"),ZCL_XHR(flnam,"zcalQAdd.retEdit")},retEdit:function(xml){var res=ZCL_Evl(1,xml.responseText);if("success"==res.status){var evid=res.id,rdats=(res.euid?res.euid:"",res.rdats?res.rdats:""),oid=res.oid?res.oid:"",ordats=res.ordats?res.ordats:"";if(""!=zcalQAdd.adObj.EID){id=zcalQAdd.adObj.EID;var o1=zcalEvents.remEve(id,!1,!0);o1||(o1=zcalEvents.remEve(id,!0,!0));var dur=zcal.findDuration(zcalQAdd.adObj);""!=ordats&&ZCL_insertRepEvents(o1,ordats,oid);var nO=zcalQAdd.adObj,tObj={CNAME:o1[id].CNAME,ORG:nO.ORG,RTO:o1[id].RTO,SD:res.SD?res.SD:nO.SD,ST:res.ST?res.ST:nO.ST,ED:res.ED?res.ED:nO.ED,ET:res.ET?res.ET:nO.ET,REF:[0,1,o1[id].REF[2],o1[id].REF[3],o1[id].REF[4]],SUM:o1[id].SUM.zcalreplace(),LOC:o1[id].LOC?o1[id].LOC.zcalreplace():"",DUR:dur,ADAY:o1[id].ADAY?o1[id].ADAY:0,EPERM:o1[id].EPERM,DPERM:o1[id].DPERM,EUID:res.euid?res.euid:o1[id].EUID,EC:res.EC?res.EC:-1,ETYPE:res.ETYPE?res.ETYPE:0,HASATTACH:res.HASATTACH?res.HASATTACH:!1};if(res.ETZ&&(tObj.ETZ=res.ETZ,tObj.IN_ETZ=res.IN_ETZ?res.IN_ETZ:0),o1[id].SKEY&&(tObj.SKEY=o1[id].SKEY,tObj.USTAT=o1[id].USTAT),o1[id].ATTEMAIL&&(tObj.ATTEMAIL=o1[id].ATTEMAIL),o1[id].REP){var repObj={};repObj.RPDT=nO.SD,tObj.REP=repObj}res.APL_REQ&&1==res.APL_REQ&&(tObj.APL_REQ=res.APL_REQ);var t=ZCL_Evl(1,'{"'+evid+'":'+JSON.stringify(tObj)+"}");if(tObj.EID=evid,""!=rdats?ZCL_insertRepEvents(t,rdats,evid):("0"==nO.TY&&(t[evid].REF[3]=1,delete t[evid].REP),ZCL_insertEvent(t,evid)),4==zcal.view){var t1=JSON.stringify(tObj);""!=ordats||""!=rdats?zcalAgenda.dispEvents():zcalAgenda.edit(t1)}}zmUtil.succErrMsg("s",3==tObj.ETYPE?zcal.i18n.taskedited:zcal.i18n.evtedited),zcalView.plotEvents(),zcalQAdd.adObj=null}else{var err=res.error?"err_general"!=res.error?res.error:zcal.i18n[res.error]:zcal.i18n.err_general;zmUtil.succErrMsg("e",err)}},del:function(id,euid,cid){var isdel=1==ZCL_DELRTO?!0:!1,cObj=zcal.getCalObj(cid),flnam="/cal/delEve.do?mode=d&eid="+id+"&ekey="+euid+"&ckey="+cObj[9]+"&ctype="+cObj[5]+"&isOthDel="+isdel+"&calmode="+zcal.CALMODE+"&ntfy="+ZCL_NTFY_ATT;ZCL_NTFY_ATT=-1,ZCL_XHR(flnam,"zcalQAdd.retDel")},chkAttAndDel:function(id,euid,cid,ustat,isDtlDel){var isAtt=!1;ustat&&1==ustat&&(isAtt=!0),isDtlDel&&(isAtt=ZCL_isAtt()),isAtt?ZCL_shAttPopForQkDel(id,euid,cid,isDtlDel):(zcalQAdd.del(id,euid,cid),isDtlDel&&ZCL_EClrStck())},retDel:function(xml){var res=ZCL_Evl(1,xml.responseText);if("success"==res.status){var evid=res.id,etype=0,obj=zcalEvents.remEve(evid,!1,!0);obj||(obj=zcalEvents.remEve(evid,!0,!0)),obj&&(etype=obj[evid].ETYPE,4==zcal.view&&zcalAgenda.del(obj,evid)),zmUtil.succErrMsg("s",3==etype?zcal.i18n.taskdeleted:zcal.i18n.evtdeleted),zcalView.plotEvents()}else"error"==res.status?zmUtil.succErrMsg("e",zcal.i18n[res.error]):zmUtil.succErrMsg("e",res.status)},retRepDel:function(xml){var res=ZCL_Evl(1,xml.responseText);if("success"==res.status){var evid=res.id,rdats=res.rdats?res.rdats:"",obj=zcalEvents.remEve(evid,!1,!0);obj||(obj=zcalEvents.remEve(evid,!0,!0));for(var i in obj)""!=rdats&&ZCL_insertRepEvents(obj,rdats,i);4==zcal.view&&zcalAgenda.del(obj,evid),zcalView.plotEvents(),zmUtil.succErrMsg("s",zcal.i18n.evtdeleted)}}};return quickObj}(),ZCL_MONTHMODE=0,ZCL_MROWHGT=[],zcalMonth=function(){var mc=[],ms=1,mdtArr=[],meventObj={},rowMaxCount=0,creArray=function(){for(var temp=mc[mc.length]=[],i=0;ms>i;i++)temp[i]=0;return mc.length-1},render=function(obj,dt,no,row){ms=no,creArray();var sd=ZCL_parseDateStr(dt);mdtArr[0]=sd,mdtArr[1]=zcalMulti.retdate(dt,no-1);for(var uList=zcalCRM.getCRMColorCode(),i=0;no>i;i++){var d,norObj=zcal.cdata.evelst,dd=new Date;if(dd.setTime(sd),dd.setDate(dd.getDate()+i),d=dd.dateBy("yyyyMMdd"),obj.all[d]&&obj.all[d].length>1&&obj.all[d].length<=50&&adEsort(obj.all[d]),norObj&&norObj[d]){obj.all[d]||(obj.all[d]=[]),norObj[d].length>1&&norObj[d].length<=50&&nmlEsort(norObj[d],d);for(var z in norObj[d])for(var k in norObj[d][z]){var calId,sts,dObj=norObj[d][z];calId=dObj[k].CNAME,cObj=zcal.getCalObj(calId),sts=cObj&&-1==zcal.disabledcal.indexOf(calId)?!0:!1;var ownerId=dObj[k].ORG;cObj&&"crm"==cObj[14]&&uList&&(uList[ownerId]?sts=0==uList[ownerId][2]?!1:!0:uList.OTHERS&&(sts=0==uList.OTHERS[2]?!1:!0)),sts&&(d==dObj[k].SD||d!=dObj[k].SD&&0==i)&&(1==zcal.cdata.opt.DDE||0==zcal.cdata.opt.DDE&&"2"!=dObj[k].USTAT)&&obj.all[d].push(dObj)}}obj.all[d]&&obj.all[d].length>0&&mcreate(obj.all[d],i,d,row);var npos=7*row+i,mboxEle=ZCL_$("zcl_mbx"+npos),adayEventEle=ZCL_$("zcl_encloser"),mboxHgt=mboxEle.offsetHeight-18,dispCount=0,eCount=0;eCount=meventObj[npos]?meventObj[npos].elements.length:0,rowMaxCount=eCount>=rowMaxCount?eCount:rowMaxCount,dispCount=Math.floor(mboxHgt/17),1===ZCL_MONTHMODE||dispCount>eCount?dispCount=eCount:0!=eCount&&(dispCount=mboxHgt>=17*dispCount+13?dispCount:dispCount-1,dispCount=0>dispCount?0:dispCount);for(var j=0;dispCount>j;j++)"zcl_mallev"===meventObj[npos].elements[j].className?(adayEventEle.appendChild(meventObj[npos].elements[j]),mboxEle.appendChild($('<div class="zcl_edmy"/>')[0])):mboxEle.appendChild(meventObj[npos].elements[j]);if(0===ZCL_MONTHMODE&&eCount&&eCount>dispCount){var bdiv=document.createElement("DIV"),_mboxEventStr=zcalMulti.toString(meventObj[npos].events);bdiv.cday=dd.dateBy("MMM dd, yyyy"),bdiv.className="zcl_mmore zcl_lk",bdiv.innerHTML="+"+ZCL_replaceString(zcal.i18n.more,[eCount-dispCount]),bdiv.earr=ZCL_Evl(1,_mboxEventStr),bindClickOnMoreLink($(bdiv)),mboxEle.appendChild(bdiv)}}var newHgt,rowEle=ZCL_$("zcl_encloser").children[row],orgHgt=rowEle.offsetHeight;newHgt=1===ZCL_MONTHMODE?17*rowMaxCount+18+17:orgHgt,newHgt=newHgt>=orgHgt?newHgt:orgHgt,rowEle.style.height=newHgt+"px",ZCL_MROWHGT[row]=newHgt,mc=[],meventObj={},rowMaxCount=0},bindClickOnMoreLink=function($mlnk){$mlnk.off("click").on("click",function(ev){ZCL_mthmore(this,ev)})},adEsort=function(obj){for(var temp,td1,td2,l=0;l<obj.length-1;l++)for(var m=l+1;m<obj.length;m++){for(var x in obj[l])td1=ZCL_parseDateStr(obj[l][x].ED);for(var y in obj[m])td2=ZCL_parseDateStr(obj[m][y].ED);td2>td1&&(temp=obj[m],obj[m]=obj[l],obj[l]=temp)}},nmlEsort=function(obj,sd){for(var td1,td2,l=0;l<obj.length-1;l++)for(var m=l+1;m<obj.length;m++){var eO1,tO1,eO2,tO2;eO1=ZCL_Evl(1,zcalMulti.toString(obj[l]));for(var x in eO1)tO1=eO1[x];eO2=ZCL_Evl(1,zcalMulti.toString(obj[m]));for(var y in eO2)tO2=eO2[y];if(tO1&&tO2){td1=ZCL_parseDateStr(tO1.ED),td2=ZCL_parseDateStr(tO2.ED);var st1=parseInt(tO1.ST,10),dur1=parseInt(tO1.DUR,10);tO1.SD!=sd&&(dur1=parseInt(st1/100,10)*zcal.msec_hour+st1%100*zcal.msec_minute,st1=0);var st2=parseInt(tO2.ST,10),dur2=parseInt(tO2.DUR,10);tO2.SD!=sd&&(dur2=parseInt(st2/100,10)*zcal.msec_hour+st2%100*zcal.msec_minute,st2=0),td2>td1?(obj[l]=eO2,obj[m]=eO1):st1>st2?(obj[l]=eO2,obj[m]=eO1):st1==st2&&dur2>dur1?(obj[l]=eO2,obj[m]=eO1):(obj[l]=eO1,obj[m]=eO2)}}},mcreate=function(obj,pos,d,r){for(var slot,wid,npos=7*r+pos,i=(ZCL_$("zcl_mbx"+npos),0);i<obj.length;i++)slot=freeS(pos),wid=eveWid(slot,pos,obj[i],d),divCont(slot,npos,obj[i],wid,d,r)},divCont=function(t,l,obj,wid,d,r){meventObj[l]=meventObj[l]||{};var _mbObj=meventObj[l],_col=l%7;_mbObj.elements=_mbObj.elements||[],_mbObj.events=_mbObj.events||[];var uList=zcalCRM.getCRMColorCode();for(var i in obj){var calObj=zcal.getCalObj(obj[i].CNAME),ownerId=obj[i].ORG,sts=!0;"crm"==calObj[14]&&uList&&(uList[ownerId]?sts=0==uList[ownerId][2]?!1:!0:uList.OTHERS&&(sts=0==uList.OTHERS[2]?!1:!0));var sub=obj[i].SUM;if(""==sub&&(sub="NO SUBJECT"),sts){var startD=ZCL_parseDateStr(obj[i].SD),endD=ZCL_parseDateStr(obj[i].ED),tmpDt=obj[i].REP?i+"_"+obj[i].SD:i,tStr=ZCL_timeInUFormat(obj[i].ST),ttip=ZCL_getHTML(zcalEvents.tooltip(obj[i])),mTime=zcalEvents.alltime(obj[i]),calObj=zcal.getCalObj(obj[i].CNAME),calColor=calObj[1].split(":"),colarr=ZCL_getCalColor(calColor[0]),caltxtCol=0==calColor[1]?"zcl_event zcl_evwh":"zcl_event zcl_evbl";if("1"==obj[i].ADAY||endD>startD){var adayEle=document.createElement("DIV");adayEle.style.width=wid+"px",adayEle.className="zcl_mallev",adayEle.style.top=eveTop(r,t)+"px",adayEle.style.left=eveLeft(_col)+"px",2==obj[i].EPERM?(adayEle.eobj={EID:tmpDt,SUM:sub,SD:obj[i].SD,ST:obj[i].ST,ED:obj[i].ED,ET:obj[i].ET,CCOLOR:colarr[1],ADAY:obj[i].ADAY,SDAY:!0,CNAME:obj[i].CNAME,EPERM:obj[i].EPERM,RIDX:obj[i].RIDX,EUID:obj[i].EUID,ORG:obj[i].ORG,DPERM:obj[i].DPERM,ETZ:obj[i].ETZ,IN_ETZ:obj[i].IN_ETZ,EC:obj[i].EC,REPINST:obj[i].REPINST,USTAT:obj[i].USTAT},adayEle.onmousedown=function(ev){zcalMDrag.dragStart(this,ev)}):adayEle.onclick=function(ev){zcal.eveDetail(tmpDt,ev,obj[i].SD,[obj[i].SD,obj[i].ST,obj[i].ED,obj[i].ET,obj[i].EUID,obj[i].CNAME,obj[i].EPERM,obj[i].RIDX,obj[i].DPERM,obj[i].REPINST])};var txt='<div class="zcl_mthev" title="'+ttip+'" alt="'+ttip+'"><div class="'+caltxtCol+'" style="background-color:'+(-1!=obj[i].EC?zcal.eventcolor[obj[i].EC]:colarr[1])+";border-color:"+colarr[0]+'"><ul><li class="zcl_sp"></li><li>'+mTime+"<span>"+ZCL_getHTML(sub)+(obj[i].LOC?"&nbsp;@&nbsp;"+ZCL_getHTML(obj[i].LOC):"")+"</span></li></ul></div></div>";adayEle.innerHTML=txt,_mbObj.elements.splice(t,0,adayEle),_mbObj.events.splice(t,0,obj);var end=obj[i].ED,dlen=0;end=ZCL_parseDateStr(end),end>=mdtArr[1]?dlen=ZCL_daysBetween(d,mdtArr[1].dateBy("yyyyMMdd"))+1:end<mdtArr[1]&&(dlen=ZCL_daysBetween(d,end.dateBy("yyyyMMdd"))+1);for(var x=l+1;l+dlen>x;x++){meventObj[x]=meventObj[x]||{};var dmyEle,_tempmbObj=meventObj[x];_tempmbObj.elements=_tempmbObj.elements||[],_tempmbObj.events=_tempmbObj.events||[],dmyEle=document.createElement("DIV"),dmyEle.className="zcl_edmy",_tempmbObj.elements.splice(t,0,dmyEle),_tempmbObj.events.splice(t,0,obj)}}else{var normEle=document.createElement("DIV");normEle.className="zcl_mevent",2==obj[i].EPERM?(normEle.eobj={EID:tmpDt,SUM:sub,SD:obj[i].SD,ST:obj[i].ST,ED:obj[i].ED,ET:obj[i].ET,CCOLOR:colarr[0],ADAY:obj[i].ADAY,SDAY:!1,CNAME:obj[i].CNAME,RIDX:obj[i].RIDX,EUID:obj[i].EUID,ORG:obj[i].ORG,EPERM:obj[i].EPERM,DPERM:obj[i].DPERM,ETZ:obj[i].ETZ,IN_ETZ:obj[i].IN_ETZ,REPINST:obj[i].REPINST,USTAT:obj[i].USTAT},normEle.onmousedown=function(ev){zcalMDrag.dragStart(this,ev)}):normEle.onclick=function(ev){zcal.eveDetail(tmpDt,ev,obj[i].SD,[obj[i].SD,obj[i].ST,obj[i].ED,obj[i].ET,obj[i].EUID,obj[i].CNAME,obj[i].EPERM,obj[i].RIDX,obj[i].DPERM,obj[i].REPINST])},normEle.innerHTML='<div title="'+ttip+'" alt="'+ttip+'"><em class="zcl_st" style="color:'+colarr[0]+';">'+tStr+'</em><span style="color:'+colarr[0]+';">'+ZCL_getHTML(sub)+(obj[i].LOC?"&nbsp;@&nbsp;"+ZCL_getHTML(obj[i].LOC):"")+"</span>",_mbObj.elements.splice(t,0,normEle),_mbObj.events.splice(t,0,obj)}}}},freeS=function(pos){for(var i=0;i<mc.length;i++)if(0==mc[i][pos])return i;return creArray()},fillspace=function(slot,pos,wid){for(var arr=mc[slot],i=pos;wid+pos>i;i++)arr[i]=1},eveWid=function(slot,pos,obj,d){var wid="",ed="",_wdt=0;for(var i in obj)ed=obj[i].ED;ed=ZCL_parseDateStr(ed),ed>=mdtArr[1]?wid=ZCL_daysBetween(d,mdtArr[1].dateBy("yyyyMMdd"))+1:ed<mdtArr[1]&&(wid=ZCL_daysBetween(d,ed.dateBy("yyyyMMdd"))+1),fillspace(slot,pos,wid);for(var j=0;wid>j;j++)_wdt+=ZCL_getEleWdt("zcl_mbx"+(pos+j));return _wdt-5},eveLeft=function(pos){for(var left=0,i=0;pos>i;i++)left+=ZCL_getEleWdt("zcl_mbx"+i);return left+1},eveTop=function(rowNo,pos){for(var eTop=18,i=0;rowNo>i;i++)eTop+=ZCL_MROWHGT[i];return eTop+=17*pos},monthObj={render:render};return monthObj}();zcal.tempObj={},ZCL_mthmore=function(cur,e){zcal.setQuickViewDiv({"class":"zclevlst"}),document.addEventListener("mousedown",ZCL_mdownClr,!1),document.addEventListener("keydown",zcal.keyCtrl,!1);var $top,$content,eList=cur.earr,ref=$("#zcl_qview");ref.empty(),$top=$("<li>"+cur.cday+'<i class="msi-close SC_frt"></i></li>'),$top.find(".msi-close").off("click").on("click",function(){ZCL_clrStck()}),ref.append($top),$content=$('<li class="zcl_mrevlst"/>');for(var x=0;x<eList.length;x++)for(var y in eList[x]){var colarr=ZCL_getCalColor(zcal.getCalObj(eList[x][y].CNAME)[1]),tmpDt=(ZCL_parseDateStr(eList[x][y].SD),ZCL_parseDateStr(eList[x][y].ED),eList[x][y].REP?y+"_"+eList[x][y].SD:y),timeStr="",sub=eList[x][y].SUM;""==sub&&(sub="NO SUBJECT"),timeStr+=eList[x][y].ADAY&&"1"==eList[x][y].ADAY?zcal.i18n.allday:ZCL_timeInUFormat(eList[x][y].ST)+" - "+ZCL_timeInUFormat(eList[x][y].ET);var $calevent=$('<ul><li><i style="background-color:#95d681;border-color:'+colarr[0]+'"></i></li><li>'+ZCL_getHTML(sub)+"<span>"+timeStr+"</span></li></ul>");0!=eList[x][y].EPERM&&3!=eList[x][y].ETYPE?bindClickOnEvent($calevent,{RIDX:eList[x][y].RIDX,ID:tmpDt,CNAME:eList[x][y].CNAME,EUID:eList[x][y].EUID}):$calevent.addClass("zcl_dis"),$content.append($calevent)}ref.append($content),ref.attr({style:"left:-1000px;display:"}),ZCL_MouseXY(e);var x=document.body.offsetWidth>zcalMX+ref[0].offsetWidth+20?zcalMX:zcalMX-ref[0].offsetWidth,y=document.body.offsetHeight>zcalMY+ref[0].offsetHeight+97?zcalMY:zcalMY-ref[0].offsetHeight;ref.attr({style:"top:"+y+"px;left:"+x+"px"}),ZCL_stopEvents(e)},bindClickOnEvent=function($ele,obj){$ele.off("click").on("click",{RIDX:obj.RIDX,ID:obj.ID,CNAME:obj.CNAME,EUID:obj.EUID},function(ev){ZCL_clrStck(),ZCL_TRIDX=ev.data.RIDX,ZCL_editEve(ev.data.ID,ev,ev.data.CNAME,ev.data.EUID)})},zcal.clsMEvlst=function(){var _evlst=zcal.$("zcl_mevlst");_evlst.parentNode.removeChild(_evlst)};var zcalDrag=function(){var sBox,eBox,tBox,mlayWdt,mlayHgt,hrHgt,halfHgt,dayno,encloserEle,encloserOffset,layEle,isdrag=!1,tele=0,bele=0,iele=0,lborder=0,rborder=0,dstartDiv=function(e,c,slot){layEle=ZCL_$("zcl_lay"),encloserEle=ZCL_$("zcl_encloser"),encloserOffset=encloserEle.getBoundingClientRect(),lborder=encloserOffset.left,rborder=lborder+encloserOffset.width-zcalInit.scrollWidth(),ZCL_clrStck();var _target=e.target||e.srcElement;hrHgt=$("#zcl_hContainer").find("ul:first")[0].getBoundingClientRect().height,halfHgt=hrHgt/2||25,isdrag=!0,slot=2*slot+("B"==_target.tagName?0:1),tele=iele=slot,bele=slot+1,dayno=c,layEle.style.top=slot*halfHgt+"px",layEle.style.left=getPosLeft(c)+"px",layEle.style.width=ZCL_getEleWdt(_target)+"px",layEle.style.height=halfHgt+"px",layEle.style.display="",document.onmousemove=dmoveDown,document.onmouseup=dmoveStop},dmoveDown=function(e){if(isdrag){{var tempX,tempY;layEle.offsetTop}if(tempY=(zcal.NN6?e.clientY:event.clientY)-encloserOffset.top+encloserEle.scrollTop,tempX=zcal.NN6?e.clientX:event.clientX,!(tempX>lborder&&rborder>tempX))return!1;var curEle=Math.floor(tempY/halfHgt);curEle>=0&&47>=curEle&&(curEle==iele?(layEle.style.height=halfHgt+"px",layEle.style.top=curEle*halfHgt+"px",tele=curEle,bele=curEle+1):curEle>iele?(layEle.style.height=(curEle-iele+1)*halfHgt+"px",bele=curEle+1,tele=iele):(layEle.style.top=curEle*halfHgt+"px",layEle.style.height=(iele-curEle+1)*halfHgt+"px",bele=iele+1,tele=curEle))}},dmoveStop=function(e){isdrag=!1,document.onmousemove="",document.onmouseup="",zcal.dquickBook(tele,bele,dayno,e),tele=bele=iele=null,ZCL_stopEvents(e)},getPosLeft=function(pos){for(var left=ZCL_$("zcl_lftsec").getBoundingClientRect().width,i=0;pos>i;i++)left+=ZCL_$("zcl_a"+i).getBoundingClientRect().width;return left},mstartDiv=function(e,slot){var _lay,_target=e.target||e.srcElement;ZCL_clrStck(),isdrag=!0,!_target.id||_target.id!="zcl_mbx"+slot&&_target.id!="zcl_lft"+slot||(sBox=eBox=tBox=slot,_lay=zcal.$("zcl_lay"+slot),_lay.style.display="",mlayHgt=_lay.offsetHeight,mlayWdt=_lay.offsetWidth,document.onmousemove=mmoveDown,document.onmouseup=mmoveStop)},mmoveDown=function(e){if(isdrag){var DivTag=zcal.NN6?e.target:event.srcElement;if(DivTag.id&&(-1!=DivTag.id.indexOf("zcl_mbx")||-1!=DivTag.id.indexOf("zcl_lay")||-1!=DivTag.id.indexOf("zcl_lft"))){var boxn=DivTag.id.replace(/\D/g,"");if(eBox=parseInt(boxn,10),eBox>sBox){for(var i=tBox;sBox>=i;i++)ZCL_$("zcl_lay"+i).style.display="none",tBox=i;for(;tBox>eBox;)ZCL_$("zcl_lay"+tBox--).style.display="none";for(var k=tBox;eBox>=k;k++)ZCL_$("zcl_lay"+k).style.display="",tBox=k}else if(sBox>eBox){for(var i=tBox;i>=sBox;i--)ZCL_$("zcl_lay"+i).style.display="none",tBox=i;for(;eBox>tBox;)ZCL_$("zcl_lay"+tBox++).style.display="none";for(var k=tBox;k>=eBox;k--)ZCL_$("zcl_lay"+k).style.display="",tBox=k}else{for(;eBox>tBox;)ZCL_$("zcl_lay"+tBox++).style.display="none";for(;tBox>eBox;)ZCL_$("zcl_lay"+tBox--).style.display="none"}}}},mmoveStop=function(e){isdrag=!1,document.onmousemove="",document.onmouseup="",zcal.mquickBook(sBox,eBox,e),tBox=sBox=eBox=null},dragObj={dstartDiv:dstartDiv,mstartDiv:mstartDiv};return dragObj}(),zcalEDrag=function(){var eObj,eEle,dtStr,intTop,intY,eContainer,encloserEle,isdrag=!1,dtype="top",dragStart=function(ele,e,dt,eobj){ZCL_clrStck(),eContainer=ZCL_$("zcl_eveSub"),encloserEle=ZCL_$("zcl_encloser");var _target=zcal.NN6?e.target:event.srcElement;intTop=ele.offsetTop,ZCL_MouseXY(e),intY=zcalMY,eEle=ele,dtStr=dt,eObj=eobj,"DIV"==_target.tagName&&"zcl_scrollme"==_target.id?(dtype="bot",document.onmousemove=rszEvent,document.onmouseup=dragStop):(dtype="top",document.onmousemove=dragEvent,document.onmouseup=dragStop),ZCL_stopEvents(e)},rszEvent=function(e){var tmpY=zcal.NN6?e.clientY:event.clientY;if(tmpY!=intY&&(isdrag||ZCL_setOpacity(eEle,5),isdrag=!0)){var dlObj=eEle.getElementsByTagName("div")[1],tp=(dlObj.offsetHeight,eEle.offsetTop);if(tmpY=(zcal.NN6?e.clientY:event.clientY)-ZCL_findPosYY(eContainer),sHgt=tmpY+eContainer.parentNode.scrollTop-tp,!(sHgt>12&&tmpY+ZCL_findPosYY(eContainer)<document.body.offsetHeight-50))return!1;dlObj.style.height=sHgt+"px"}},dragEvent=function(e){var tmpY=zcal.NN6?e.clientY:event.clientY,tmpX=zcal.NN6?e.clientX:event.clientX;if(tmpY!=intY&&(isdrag||ZCL_setOpacity(eEle,5),isdrag=!0)){if(dHgt=tmpY-intY,dLft=tmpX-ZCL_findPosXX(eContainer),0!=zcal.view&&eContainer.offsetWidth>dLft+10&&dLft>=zcal.hrgrid_lsec_width){var dnoAndLeft=ZCL_getWeekGridNo(dLft);eEle.style.left=dnoAndLeft[1]+"px",eEle.setAttribute("gridNo",dnoAndLeft[0])}intTop+dHgt+eEle.offsetHeight<=eContainer.parentNode.scrollHeight&&intTop+dHgt>0&&(eEle.style.top=intTop+dHgt+"px")}},dragStop=function(e){document.onmousemove="",document.onmouseup="",intTop=null,isdrag?1==eObj.EPERM&&1==eObj.DPERM?ZCL_showConfirm("zcl_attStat"):-1!=eEle.id.indexOf("_")?preEditRep():(ZCL_dragreturn(eEle,dtype,{SD:eObj.SD,ST:eObj.ST,ED:eObj.ED,ET:eObj.ET,CNAME:eObj.CNAME,EUID:eObj.EUID,RIDX:eObj.RIDX,ORG:eObj.ORG,ADAY:eObj.ADAY,ETZ:eObj.ETZ,IN_ETZ:eObj.IN_ETZ}),eEle=null):zcal.eveDetail(eEle.id,e,dtStr,[eObj.SD,eObj.ST,eObj.ED,eObj.ET,eObj.EUID,eObj.CNAME,eObj.EPERM,eObj.RIDX,eObj.DPERM,eObj.REPINST]),isdrag=!1,dtype="top",ZCL_stopEvents(e)},preEditRep=function(){var esd=eObj.SD,eed=(eObj.ST,eObj.ED),eet=eObj.ET,ws=zcal.getWeekStart(),tdate=zcal.today.clone(),eLeft=eEle.offsetLeft;if(0!=zcal.view&&tdate.setDate(tdate.getDate()-tdate.getDay()+ws),0!=eLeft){var sno=parseInt(eEle.getAttribute("gridNo"),10);tdate.setDate(tdate.getDate()+sno);var sd=tdate.dateBy("yyyyMMdd"),eId=eEle.id;if("bot"==dtype&&esd!=eed&&sd==esd&&"0000"!=eet&&"2400"!=eet)return zcalView.constGridView(),!1;sd==eId.substring(eId.indexOf("_")+1,eId.length)||sd==eEle.getAttribute("ed")?ZCL_showConfirm("qedit",{dtype:dtype}):editRep(0)}};editRep=function(re,obj){var st,et,sno,sd,ed,evId,dur,editObj,eventId=eEle.id,esd=eObj.SD,eed=eObj.ED,est=eObj.ST,eet=eObj.ET,ws=zcal.getWeekStart(),tdate=zcal.today.clone(),eTop=(eEle.offsetLeft,eEle.offsetTop),eHgt=eEle.offsetHeight,RIDX=eObj.RIDX;if(st=Math.round(eTop),st=ZCL_pxToTime(st),et=Math.round(eTop+eHgt),et=ZCL_pxToTime(et),0!=zcal.view&&tdate.setDate(tdate.getDate()-tdate.getDay()+ws),dtype=obj&&obj.dtype?obj.dtype:dtype,sno=parseInt(eEle.getAttribute("gridNo")),tdate.setDate(tdate.getDate()+sno),sd=tdate.dateBy("yyyyMMdd"),ed=tdate.dateBy("yyyyMMdd"),evId=eventId.substring(0,eventId.indexOf("_")),dur=zcal.findDuration({SD:esd,ST:est,ED:eed,ET:eet}),"bot"==dtype)sd=esd,st=est;else if("top"==dtype){var hr=parseInt(st/100,10),min=st%100;tdate.setHours(hr,min,0,0),tdate.setTime(tdate.getTime()+dur),ed=tdate.dateBy("yyyyMMdd"),et=tdate.dateBy("HHmm")}1==re&&(re=null),2==re&&0==RIDX&&(re=null),editObj={SD:sd,ED:ed,ST:st,ET:et,EID:evId,TY:re,RIDX:eObj.RIDX,CNAME:eObj.CNAME,EUID:eObj.EUID,ORG:eObj.ORG,ADAY:eObj.ADAY,ETZ:eObj.ETZ,IN_ETZ:eObj.IN_ETZ,REPINST:eObj.REPINST},zcalQAdd.edit(editObj),eEle=null,eObj=null,ZCL_closeREditConfirm()};var dragObj={dragStart:dragStart,editRep:editRep};return dragObj}(),zcalMDrag=function(){var moveEle,sBox,eBox,tBox,eObj,intX,intY,tdiv,encloserEle,encloserProp,ismdown=!1,isdrag=!1,dragStart=function(ele,e){var colNo,rowNo,colarr;if(encloserEle=ZCL_$("zcl_encloser"),encloserProp=ZCL_getPos(encloserEle),ZCL_clrStck(),ismdown=!0,moveEle=ele,eObj=ele.eobj,intX=zcal.NN6?e.clientX:event.clientX,intY=zcal.NN6?e.clientY:event.clientY,colNo=Math.floor((intX-encloserProp.offsetLeft)/zcal.mcell_width),rowNo=getRowNoByHgt(intY),tBox=sBox=eBox=7*rowNo+colNo,colarr=ZCL_getCalColor(zcal.getCalObj(eObj.CNAME)[1]),tdiv=document.createElement("DIV"),eObj.SDAY||(tdiv.className="zcl_medrg"),tdiv.style.width=zcal.mcell_width-2+"px",eObj.SDAY&&eObj.SD!=eObj.ED){var nod=(ZCL_parseDateStr(eObj.ED)-ZCL_parseDateStr(eObj.SD))/864e5,txt='<div class="zcl_mthev" style="z-index:101;"><div class="zcl_event" style="background-color:'+(-1!=eObj.EC?zcal.eventcolor[eObj.EC]:colarr[1])+";border-color:"+colarr[0]+'"><ul><li class="zcl_sp"></li><li><span>&nbsp;('+(nod+1)+"&nbsp;"+zcal.i18n.days+")&nbsp;&nbsp;"+eObj.SUM+"</span></li></ul></div></div>";tdiv.innerHTML=txt}else tdiv.style.zIndex="101",tdiv.innerHTML=ele.innerHTML;document.body.appendChild(tdiv),tdiv.style.left=intX+"px",tdiv.style.top=intY+"px",tdiv.style.position="absolute",tdiv.style.display="none",document.onmousemove=dragEvent,document.onmouseup=dragStop,ZCL_stopEvents(e)},dragEvent=function(e){var tmpX,tmpY,rowNo,colNo,boxNo,eleLeft,eleTop;if(tmpY=zcal.NN6?e.clientY:event.clientY,tmpX=zcal.NN6?e.clientX:event.clientX,(tmpX!=intX||tmpY!=intY)&&(tdiv.style.display="",isdrag=!0,ZCL_setOpacity(moveEle,5),ismdown)){var l=encloserProp.offsetLeft,t=encloserProp.offsetTop,w=encloserProp.offsetWidth,h=encloserProp.offsetHeight;tmpX>l&&l+w>tmpX&&tmpY>t&&t+h>tmpY&&(eleLeft=tmpX>l+w-zcal.mcell_width?l+w-zcal.mcell_width:tmpX,eleTop=tmpY>t+h-tdiv.offsetHeight?t+h-tdiv.offsetHeight:tmpY,colNo=Math.floor((eleLeft-l)/zcal.mcell_width),rowNo=getRowNoByHgt(eleTop,rowNo),boxNo=eBox=7*rowNo+colNo,tBox!=boxNo&&(ZCL_$("zcl_lay"+tBox).style.display="none",tBox=boxNo),ZCL_$("zcl_lay"+boxNo).style.display="",tdiv.style.left=eleLeft+"px",tdiv.style.top=eleTop+"px",tdiv.style.position="absolute")}},dragStop=function(e){ismdown=!1;var event=window.event?window.event:e;document.onmousemove="",document.onmouseup="",tdiv&&tdiv.parentNode.removeChild(tdiv),tdiv=null,isdrag?sBox!=eBox?1==eObj.EPERM&&1==eObj.DPERM?ZCL_showConfirm("zcl_attStat"):-1!=eObj.EID.indexOf("_")?meditRep():meventReturn():(ZCL_clrStck(),zcalView.plotEvents()):zcal.eveDetail(eObj.EID,event,eObj.SD,[eObj.SD,eObj.ST,eObj.ED,eObj.ET,eObj.EUID,eObj.CNAME,eObj.EPERM,eObj.RIDX,eObj.DPERM,eObj.REPINST]),isdrag=!1,ZCL_stopEvents(event)},meventReturn=function(){var tS,tE,nod,sd,ed,addObj;tS=zcal.mlimit[0].clone(),tS.setDate(tS.getDate()+eBox),tE=tS.clone(),nod=(ZCL_parseDateStr(eObj.ED)-ZCL_parseDateStr(eObj.SD))/864e5,tE.setDate(tE.getDate()+nod),sd=tS.dateBy("yyyyMMdd"),ed=tE.dateBy("yyyyMMdd"),addObj={SD:sd,ED:ed,ST:eObj.ST,ET:eObj.ET,EID:eObj.EID,EUID:eObj.EUID,CNAME:eObj.CNAME,OR:eObj.ORG,ADAY:eObj.ADAY,ETZ:eObj.ETZ,IN_ETZ:eObj.IN_ETZ,SUM:eObj.SUM},zcalQAdd.edit(addObj)},meditRep=function(){var tS,tE,eventId,evId,RBRK,sd,ed,addObj;tS=zcal.mlimit[0].clone(),tS.setDate(tS.getDate()+eBox),eventId=eObj.EID,evId=eventId.substring(0,eventId.indexOf("_")),RBRK=eventId.substring(eventId.indexOf("_")+1,eventId.length),tE=tS.clone(),tE.setDate(tE.getDate()+(ZCL_parseDateStr(eObj.ED)-ZCL_parseDateStr(eObj.SD))/864e5),sd=tS.dateBy("yyyyMMdd"),ed=tE.dateBy("yyyyMMdd"),addObj={SD:sd,ED:ed,ST:eObj.ST,ET:eObj.ET,EID:evId,TY:0,RIDX:eObj.RIDX,CNAME:eObj.CNAME,EUID:eObj.EUID,ORG:eObj.ORG,ADAY:eObj.ADAY,ETZ:eObj.ETZ,IN_ETZ:eObj.IN_ETZ},zcalQAdd.edit(addObj)},getRowNoByHgt=function(eleTop,rowNo){var scrTop=encloserEle.scrollTop,encloserTop=encloserProp.offsetTop;eleTop=eleTop+scrTop-encloserTop;for(var j=0;j<ZCL_MROWHGT.length;j++)if(eleTop-=ZCL_MROWHGT[j],0>=eleTop){rowNo=j;break}return rowNo},mdragObj={dragStart:dragStart};return mdragObj}();ZEVENTS=function(t){return new ZCALPicker(t)},ZEVENTS.count=0,ZEVENTS.obj={},ZEVENTS.template=function(ty){switch(ty){case"type1":return{_HTML:'<li class="zcal_table zcal_mCaltt"><ul><li class="zcal_arr"><i class="#py#" rel="PY"></i></li><li class="zcal_arr"><i class="#pm#" rel="PM"></i></li><li>#HEAD#</li><li class="zcal_arr"><i class="#nm#" rel="NM"></i></li><li class="zcal_arr"><i class="#ny#" rel="NY"></i></li></ul></li><li class="zcal_mCalcn"><ul><li class="zcal_mCaldy zcal_table"><ul>#wk<li>#item#</li>wk#</ul></li><li class="zcal_table" rel="DT">#dr<div>#dc<#tag#>#item#</#tag#>dc#</div>dr#</li><li class="zcal_tmz"><span>#tz#</span></li></ul></li>',_cont:{tag:"UL",_class:"zcal_mCal"},_class:{sel:"i",hglt:"s",dis:"u",selhgt:"p",nor:"b"}};case"type2":return{_HTML:'<ul class="zcal_mCal #shadow# #hover#"><li class="zcal_table zcal_mCaltt"><ul><li class="zcal_arr"><svg rel="PY"><polygon points="10.8,4.7 7.8,7.7 10.8,10.7 10.8,12 7.2,8.3 6.5,7.7 7.2,7 10.8,3.4"></polygon><polygon points="4.8,7.7 8.7,11.5 8.6,13.1 3.2,7.7 4,6.9 8.6,2.3 8.7,3.9"></polygon></svg></li><li class="zcal_arr"><svg  rel="PM"><polygon points="10.7,2.3 10.7,4 6.9,7.8 10.7,11.6 10.7,13.2 5.2,7.8"></polygon></svg></li><li><span >#HEADM#</span><span>#HEADY#</span></li><li class="zcal_arr"><svg rel="NM" ><polygon points="5.2,13.2 5.2,11.5 9,7.7 5.2,3.9 5.2,2.3 10.7,7.7"></polygon></svg></li><li class="zcal_arr"><svg rel="NY" ><polygon points="4.7,10.7 7.7,7.7 4.7,4.7 4.7,3.4 8.3,7 9,7.7 8.3,8.3 4.7,12"></polygon><polygon points="10.7,7.7 6.8,3.9 6.9,2.3 12.3,7.7 11.5,8.5 6.9,13.1 6.8,11.5"></polygon></svg></li></ul></li><li class="zcal_mCalcn"><ul><li class="zcal_mCaldy zcal_table"><ul>#wk<li>#item#</li>wk#</ul></li><li class="zcal_table" rel="DT">#dr<div>#dc<#tag# rel=#month#Y#year#>#item#</#tag#>dc#</div>dr#</li></ul></li></ul>',_class:{sel:"i",hglt:"s",dis:"u",selhgt:"p",nor:"b",shdwn:"zcal_mCalppu",shup:"zcal_mCalppd"},_cont:{tag:"DIV",_class:"zcal_cn"}};case"type3":return{_HTML:'<li class="zcal_table zcal_mCaltt"><ul><li class="zcal_arr" ><i class="#py#" rel="PY"></i></li><li class="zcal_arr" ><i class="#pm#" rel="PM"></i></li><li>#HEAD#</li><li class="zcal_arr"><i class="#nm#" rel="NM"></i></li><li class="zcal_arr" ><i class="#ny#" rel="NY"></i></li></ul></li><li class="zcal_mCalcn"><ul><li class="zcal_mCaldy zcal_table"><ul>#wk<li>#item#</li>wk#</ul></li><li rel="DT" class="zcal_table">#dr<div>#dc<#tag#>#item#</#tag#>dc#</div>dr#</li></ul></li>',_class:{sel:"em",dis:"u",nor:"b"},_cont:{tag:"UL",_class:"zcal_mCal"},_bsecont:{tag:"DIV",_class:"zcal_mpcal"},_patch:{tag:"DIV",_cont:"<b></b>"}};case"type4":return{_HTML:'<li class="zcl_mCaltt zcl_table"><ul><li><span>#HEADM#</span><span>#HEADY#</span></li><li class="zcl_W20"><i class="#pm#" rel="PM"></i><i class="#nm#" rel="NM"></i></li></ul></li><li class="zcl_mCaldy zcl_table"><ul>#wk<li#hgt#>#item#</li>wk#</ul></li><li class="zcl_table zcl_mCaldt" rel="DT">#dr<div>#dc<#tag#>#item#</#tag#>dc#</div>dr#</li></ul></li>',_cont:{tag:"UL",_class:"zcl_mCal"},_class:{sel:"i",hglt:"s",dis:"u",selhgt:"p",nor:"b"},_cust:{dysel:"zcl_sl",pm:"zcli-larrow",nm:"zcli-rarrow"}};case"type5":return{_HTML:'<div class="zcal_mCal #shadow# #hover# zcl_mCalwti"><div class="zcal_table"><ul><li class="zcal_mCalti"><div class="zcal_table zcal_mCaltt"><ul><li class="zcal_arr"><i class="zci-fst" rel="PY"></i></li><li class="zcal_arr"><i class="zci-pre" rel="PM"></i></li><li>#HEAD#</li><li class="zcal_arr"><i class="zci-nxt" rel="NM"></i></li><li class="zcal_arr"><i class="zci-lst" rel="NY"></i></li></ul></div><div class="zcal_mCalcn"><ul><li class="zcal_mCaldy zcal_table"><ul>#wk<li>#item#</li>wk#</ul></li><li class="zcal_table" rel="DT">#dr<div>#dc<#tag# rel=#month#Y#year#>#item#</#tag#>dc#</div>dr#</li></ul></div></li><li class="zcal_mTil"><i class="zci-tiupar" rel="UT"></i><div ><ul id="zcl_t" style="overflow-y:auto;height:205px">#tr<li#ti# rel="TP">#item#</li>tr#</ul></div><i class="zci-tidnar" rel="TD"></i></li></ul></div><div class="zcal_mCalbtm"><div class="SC_PUbtm"><span rel="OK">Ok</span></div></div></div>',_class:{sel:"i",hglt:"s",dis:"u",selhgt:"p",nor:"b",shdwn:"zcal_mCalppu",shup:"zcal_mCalppd"},_cont:{tag:"DIV",_class:"zcal_cn"}};case"type6":return{_HTML:'<div class="zcal_mCal #shadow# #hover#"><div class="zcal_table"><ul><li><div class="zcal_table zcal_mCaltt"><ul><li class="zcal_arr"><svg rel="PY"><polygon points="10.8,4.7 7.8,7.7 10.8,10.7 10.8,12 7.2,8.3 6.5,7.7 7.2,7 10.8,3.4"></polygon><polygon points="4.8,7.7 8.7,11.5 8.6,13.1 3.2,7.7 4,6.9 8.6,2.3 8.7,3.9"></polygon></svg></li><li class="zcal_arr"><svg  rel="PM"><polygon points="10.7,2.3 10.7,4 6.9,7.8 10.7,11.6 10.7,13.2 5.2,7.8"></polygon></svg></li><li><span>#HEADM#</span><span>#HEADY#</span></li><li class="zcal_arr"><svg rel="NM" ><polygon points="5.2,13.2 5.2,11.5 9,7.7 5.2,3.9 5.2,2.3 10.7,7.7"></polygon></svg></li><li class="zcal_arr"><svg rel="NY" ><polygon points="4.7,10.7 7.7,7.7 4.7,4.7 4.7,3.4 8.3,7 9,7.7 8.3,8.3 4.7,12"></polygon><polygon points="10.7,7.7 6.8,3.9 6.9,2.3 12.3,7.7 11.5,8.5 6.9,13.1 6.8,11.5"></polygon></svg></li></ul></div><div class="zcal_mCalcn"><ul><li class="zcal_mCaldy zcal_table"><ul>#wk<li>#item#</li>wk#</ul></li><li class="zcal_table" rel="DT">#dr<div>#dc<#tag# rel=#month#Y#year#>#item#</#tag#>dc#</div>dr#</li></ul></div></li></ul></div><div class="zcal_mCalbtm zcal_mC_sz_cn zcal_table"><ul><li class="zcal_txl" rel="TL"><span class="zcal_mC_sz_ti">#br<input type="text" id="zcal_hr" rel="HI" value="#cuHr#" data-item="">:<input type="text" id="zcal_min" rel="MI" value="#cuMin#">:<input type="text" readonly id="zcal_ap" rel="AP" value="#apm#">br#</span></li><li><div class="SC_PUbtm"><span rel="OK">Ok</span></div></li></ul></div></div>',_class:{sel:"i",hglt:"s",dis:"u",selhgt:"p",nor:"b",shdwn:"zcal_mCalppu",shup:"zcal_mCalppd"},_cont:{tag:"DIV",_class:"zcal_cn"}};case"type7":return{_HTML:'<div class="zcal_mCal #shadow# #hover# #timediv#"><div class="zcal_table"><ul><li class="#timediv#"><div class="zcal_table zcal_mCaltt"><ul><li class="zcal_arr"><svg rel="PY" class="#py#"><polygon points="10.8,4.7 7.8,7.7 10.8,10.7 10.8,12 7.2,8.3 6.5,7.7 7.2,7 10.8,3.4"></polygon><polygon points="4.8,7.7 8.7,11.5 8.6,13.1 3.2,7.7 4,6.9 8.6,2.3 8.7,3.9"></polygon></svg></li><li class="zcal_arr"><svg class="#pm#" rel="PM"><polygon points="10.7,2.3 10.7,4 6.9,7.8 10.7,11.6 10.7,13.2 5.2,7.8"></polygon></svg></li><li><span rel="month_idx">#HEADM#</span><span rel="year_idx">#HEADY#</span></li><li class="zcal_arr"><svg class="#nm#" rel="NM" ><polygon points="5.2,13.2 5.2,11.5 9,7.7 5.2,3.9 5.2,2.3 10.7,7.7"></polygon></svg></li><li class="zcal_arr"><svg class="#ny#" rel="NY" ><polygon points="4.7,10.7 7.7,7.7 4.7,4.7 4.7,3.4 8.3,7 9,7.7 8.3,8.3 4.7,12"></polygon><polygon points="10.7,7.7 6.8,3.9 6.9,2.3 12.3,7.7 11.5,8.5 6.9,13.1 6.8,11.5"></polygon></svg></li></ul></div><div class="#viewclass#" id="mcvw"><div class="zcal_mCal_yr zcal_table">#ycr<ul>#yt<li rel="year_sel" class="#selclass#">#item#</li>yt#</ul>ycr#</div><div class="zcal_mCal_mth zcal_table">#mcr<ul>#mt<li rel="month_sel" class="#selclass#">#item#</li>mt#</ul>mcr#</div><div class="zcal_mCalcn"><ul><li class="zcal_mCaldy zcal_table"><ul>#wk<li>#item#</li>wk#</ul></li><li class="zcal_table" rel="DT">#dr<div>#dc<#tag# rel=#month#Y#year#>#item#</#tag#>dc#</div>dr#</li></ul></div></div></li>#timerow<li class="zcal_mTil"><i class="zci-tiupar" rel="UT"></i><div ><ul id="zcl_t" style="overflow-y:auto;height:205px">#tr<li#ti# rel="TP">#item#</li>tr#</ul></div><i class="zci-tidnar" rel="TD"></i></li>timerow#</ul></div>#okrow<div class="zcal_mCalbtm"><div class="SC_PUbtm"><span rel="OK">Ok</span></div></div>okrow#</div>',_class:{sel:"i",hglt:"s",dis:"u",selhgt:"p",nor:"b",shdwn:"zcal_mCalppu",shup:"zcal_mCalppd"},_cont:{tag:"DIV",_class:"zcal_cn"}};default:return}},ZEVENTS.selector=function(p){var _ele={},_p=p.trim().split(" ");if(_ele.target=(_p[0]||_p).substring(1),2==_p.length){_p[1]=_p[1].trim();var _index0=_p[1].indexOf("[");if(-1!=_index0){var _index1=_p[1].indexOf("]"),_index3=(_p[1].indexOf("."),_p[1].indexOf("="));_ele.ele=_p[1].substring(0,_index0),_ele.atr=_p[1].substring(_index0+1,_index1),_ele.atr_val=_p[1].substring(_index3+1)}else _ele.atr="#"===_p[1][0]?"id":"."==_p[1][0]?"class":"",""!=_ele.atr?(_ele.atr_val=_p[1].substring(_p[1].search(/(#|\.)/g)+1),_ele.ele=""):(_ele.ele=_p[1],_ele.atr_val="")}else _ele.ele="",_ele.atr="",_ele.atr_val="";return _ele},ZEVENTS.removeall=function(o){if(o=o?o:"picker","string"==typeof o&&"picker"==o&&ZEVENTS.obj.picker){var obj=ZEVENTS.obj.picker;for(var i in obj)ZEVENTS.remove(obj[i],o)}},ZEVENTS.remove=function(o,ty){if("object"==typeof o&&o._name){var cont=o._cont;o.clearobj(),o.clearvar(),o=null,ty=ty||"picker",delete ZEVENTS.obj[ty][cont]}},ZEVENTS.clear=function(o){"object"==typeof o&&o._name&&(o.clearobj(),ZEVENTS.obj.state=null)},ZCALPicker=function(t){return this.tar=t,this},ZCALPicker.prototype.picker=function(m,o){var tmpO,tmp=ZEVENTS.obj.picker||(ZEVENTS.obj.picker={});return o.target=this.tar,"date"==m?tmpO=new ZCALdatepickr(o):"range"==m?tmpO=new ZCALrangepickr(o):"time"==m&&(tmpO=new ZCALtimepickr(o)),tmpO?tmp[tmpO._cont]=tmpO:"",tmpO};var ZCALtimepickr=function(o){return o?(this._name="timepicker",this._type=o.type&&/^[123]$/.test(o.type)?o.type:1,this._tar="object"==typeof o.target?o.target:document.getElementById(o.target),this._tform=o.tform,o.refer?this._refer="object"==typeof o.refer?o.refer:document.getElementById(o.refer):this._tar&&(this._refer="input"==this._tar.tagName.toLowerCase()?this._tar:this._tar.getElementsByTagName("input")[0]),this.os=0,this.n="",this.tmpO="no",this._cont=(new Date).getTime()+"_"+ZEVENTS.count++,this._prevalue="",this._menu=!1,this._sel=-1,this._errfn=[],this._chgefn=[],this):null};ZCALtimepickr.prototype.on=function(mode,fn){return"change"==mode&&"function"==typeof fn?this._chgefn.push(fn):"error"==mode&&"function"==typeof fn&&this._errfn.push(fn),this},ZCALtimepickr.prototype.bind=function(){var self=this,removeElem=function(){if(self._inEl){ZCALremoveListener(self._inEl,"input",inpAction),ZCALremoveListener(self._inEl,"keydown",kdAction),ZCALremoveListener(self._inEl,"blur",blrAction),ZCALremoveListener(self._inEl,"keypress",kpAction);{self._inEl.parentNode.removeChild(self._inEl)}e1=null}if(self._ulEl){ZCALremoveListener(self._ulEl,"mousedown",timclick);{self._ulEl.parentNode.removeChild(self._ulEl)}e1=null}self._menu=!1,self._sel=-1,self._prevalue="",self._ulEl=self._inEl=null};self.clearobj=function(){ZEVENTS.obj.state=null;var ele=document.getElementById(self._cont);ele&&(ZCALremoveListener(ele,"mousedown",ulEvent),ZCALremoveListener(document,"scroll",docevehandle),ZCALremoveListener(document,"mousedown",docevehandle),ZCALremoveListener(document,"mousewheel",docevehandle),ZCALremoveListener(self._tar,"keydown",keydwnfn),ele=ele.parentNode.removeChild(ele),ele=null,self._sel=-1),self._inEl&&(self._refer.value=""!=self._refer.placeholder?self._refer.placeholder:self._inEl.value,self._refer.placeholder=self._tform,removeElem())},self.clearvar=function(){1==self._type?(ZCALremoveListener(self._tar,"focus",showTime),ZCALremoveListener(self._tar,"click",showTime),ZCALremoveListener(self._tar,"keydown",keydwnfn)):3==self._type?(ZCALremoveListener(self._refer,"keydown",trackKey),ZCALremoveListener(self._refer,"keyup",trackKey),ZCALremoveListener(self._refer,"mouseup",trackKey)):2==self._type&&ZCALremoveListener(self._refer,"focus",focusEle)};var ulEvent=function(e){var _el=e.target||event.srcElement;"li"==_el.tagName.toLowerCase()&&(self._refer.value=_el.innerHTML,checkError(),self.clearobj()),ZCALprevDef(e)},checkError=function(){var err=self._errfn,chge=self._chgefn,o="hh:mm a"==self._tform?self.get12hrTime(self._refer.value):self.get24hrTime(self._refer.value);if(o)for(var fn in chge)chge[fn].call(self._refer);else for(var fn in err)err[fn].call(self._refer)},showTime=function(e){ZEVENTS.obj.state&&ZEVENTS.clear(ZEVENTS.obj.state),ZEVENTS.obj.state=self;var inEl=(e.target||e.srcElement,"input"==this.tagName.toLowerCase()?this:this.getElementsByTagName("input")[0]),val=inEl.value,tf=self._tform||inEl.getAttribute("tform"),tme=val.changeTimetoNumber(tf);self._sel=tme;var _ul=document.body.appendChild(document.createElement("ul"));_ul.style.width=(this.clientWidth<110?110:this.clientWidth)+"px",_ul.style.left=this.positionX()+"px",_ul.id=self._cont,ZCALaddListener(_ul,"mousedown",ulEvent);var _rge=(document.documentElement.clientHeight||window.innerHeight)+Math.max(document.body.scrollTop,document.documentElement.scrollTop);_ul.className="zcal_tilst "+(this.positionY()+250>_rge?"zcal_tilsbt":"zcal_tilstp");for(var txt="",j=0;48>j;j++)txt+='<li rel="'+j+'"'+(j==tme?'class="zcal_sl"':"")+">"+(j+"").changeNumbertoTime(tf)+"</li>";_ul.innerHTML=txt,_ul.scrollTop=24*tme,_ul.style.top=this.positionY()+250<_rge?this.positionY()+this.offsetHeight+"px":this.positionY()-_ul.offsetHeight+"px",ZCALprevDef(e),ZCALaddListener(document,"scroll",docevehandle=function(){self.clearobj()}),ZCALaddListener(document,"mousedown",docevehandle=function(){self.clearobj()}),ZCALaddListener(self._tar,"keydown",keydwnfn),ZCALaddListener(self._refer,"blur",docevehandle=function(){self.clearobj()})},keydwnfn=function(eve){var k=eve.which||eve.keyCode||eve.charCode,liobj=document.getElementById(self._cont).getElementsByTagName("li");38==k&&0!=self._sel?(liobj[self._sel--].className="",liobj[self._sel].className="zcal_sl",document.getElementById(self._cont).scrollTop=24*self._sel,checkError()):40==k&&self._sel!=liobj.length-1?(liobj[self._sel++].className="",liobj[self._sel].className="zcal_sl",document.getElementById(self._cont).scrollTop=24*self._sel,checkError()):13==k&&(this.value=liobj[self._sel].innerHTML,self.clearobj())},trackKey=function(eve){ZEVENTS.obj.state&&ZEVENTS.clear(ZEVENTS.obj.state),ZEVENTS.obj.state=self;var o=this;eve=eve||event;var k=eve.which||eve.keyCode||eve.charCode,t="HH:mm"==(self._tform||o.getAttribute("tform"))?!0:!1;if("mouseup"==eve.type.toLowerCase()){var s=ZCALselstart(o);return self.os=2>=s?ZCALcrtesel(o,0,2):s>=3&&5>=s?ZCALcrtesel(o,3,5):s>=6&&8>=s?ZCALcrtesel(o,6,8):0,!0}if("keyup"!=eve.type.toLowerCase()||9==k){switch(!0){case 37==k:self.os=0!=self.os||t?0==self.os&&t?ZCALcrtesel(o,3,5):3==self.os?ZCALcrtesel(o,0,2):6==self.os?ZCALcrtesel(o,3,5):0:ZCALcrtesel(o,6,8);break;case 38==k:self.shiftnos(o,self.os,-1),checkError();break;case 39==k:self.os=0==self.os?ZCALcrtesel(o,3,5):3!=self.os||t?3==self.os&&t?ZCALcrtesel(o,0,2):6==self.os?ZCALcrtesel(o,0,2):0:ZCALcrtesel(o,6,8);break;case 40==k:self.shiftnos(o,self.os,1),checkError();break;case k>=48&&57>=k:self.typenos(o,k,self.os),checkError();break;case 65==k||80==k:self.typenos(o,k,self.os),checkError();break;case 9==k:if("keydown"==eve.type.toLowerCase()){if(ZCALselend(o)==o.value.length)return;self.tmpO="yes",self.os=ZCALselend(o)-ZCALselstart(o)!=2?ZCALcrtesel(o,0,2):0==self.os?ZCALcrtesel(o,3,5):3!=self.os||t?3==self.os&&t?ZCALcrtesel(o,0,2):6==self.os?ZCALcrtesel(o,0,2):0:ZCALcrtesel(o,6,8)}else"keyup"==eve.type.toLowerCase()&&"no"==self.tmpO?self.os=ZCALselend(o)-ZCALselstart(o)!=2?ZCALcrtesel(o,0,2):0==self.os?ZCALcrtesel(o,3,5):3!=self.os||t?3==self.os&&t?ZCALcrtesel(o,0,2):6==self.os?ZCALcrtesel(o,0,2):0:ZCALcrtesel(o,6,8):"keyup"==eve.type.toLowerCase()&&"yes"==self.tmpO&&(self.tmpO="no",ZCALprevDef(eve))}ZCALprevDef(eve)}},inpAction=function(){if(self._prevalue!=this.value){this.value=this.value.replace("'","").replace("&","").replace("%","").replace(".",""),self._prevalue=this.value;var o="hh:mm a"==self._tform?self.timeObj12hr(this.value):self.timeObj24hr(this.value);if(o){if(""==o[0]){var liobj=self._ulEl.getElementsByTagName("li");liobj[self._sel].className="",liobj[o[1]].className="zcal_sl"}else{self._ulEl.innerHTML=o[0];var _len=self._ulEl.getElementsByTagName("li").length;self._ulEl.style.height=24*(2>=_len?_len:4)+"px"}self._sel=o[1],self._ulEl.style.display="",self._ulEl.scrollTop=24*o[1],self._prevalue=this.value="hh:mm a"==self._tform?this.value.toUpperCase().replace(/^0/,""):this.value,self._refer.placeholder=o[2],self._refer.value=""}else self._ulEl.style.display="none",self._refer.placeholder="",self._refer.value=""}},kdAction=function(eve){var k=eve.which||eve.keyCode||eve.charCode,liobj=self._ulEl.getElementsByTagName("li");if(38==k)self._sel>0&&(liobj[self._sel--].className="",liobj[self._sel].className="zcal_sl",this.value=liobj[self._sel].innerHTML,self._refer.placeholder=liobj[self._sel].innerHTML,self._ulEl.scrollTop=24*self._sel);else{if(39==k)return""!=self._refer.placeholder&&(this.value=self._refer.placeholder.substring(0,this.value.length+1)),inpAction.call(this,eve);40==k?liobj.length-1>self._sel&&(liobj[self._sel++].className="",liobj[self._sel].className="zcal_sl",this.value=liobj[self._sel].innerHTML,self._refer.placeholder=liobj[self._sel].innerHTML,self._ulEl.scrollTop=24*self._sel):13==k&&(self._refer.value=""!=self._refer.placeholder?self._refer.placeholder:this.value,self._refer.placeholder=self._tform,checkError(),removeElem())}},kpAction=function(eve){var k=eve.which||eve.keyCode||eve.charCode;if(!/^(8|4[0689]|5[0-8]|3[7-9])$/.test(k)&&"HH:mm"==self._tform)return eve.preventDefault(),eve.stopPropagation(),!1;var startPos=this.selectionStart,endPos=this.selectionEnd;if(startPos==endPos&&endPos==this.value.length&&!/^(37|8|46)$/.test(k)){var ky=String.fromCharCode(k),obj="hh:mm a"==self._tform?self.get12hrTime(this.value+ky):self.get24hrTime(this.value+ky);obj||(eve.preventDefault(),eve.stopPropagation())}},blrAction=function(){self._refer.value=""!=self._refer.placeholder?self._refer.placeholder:this.value,self._refer.placeholder=self._tform,checkError(),removeElem()},timclick=function(eve){var elem=eve.target||eve.srcElement;"li"==elem.tagName.toLowerCase()&&(self._refer.value=elem.innerHTML,self._refer.placeHolder="",removeElem(),checkError())},focusEle=function(){ZEVENTS.obj.state&&ZEVENTS.clear(ZEVENTS.obj.state),ZEVENTS.obj.state=self;var parEl=this.parentNode;self._inEl=parEl.getElementsByTagName("input")[1],self._ulEl=parEl.getElementsByTagName("ul")[0],self._inEl||(self._inEl=parEl.appendChild(document.createElement("input")),self._inEl.type="text",self._inEl.className="zcal_tiabs",ZCALaddListener(self._inEl,"input",inpAction),ZCALaddListener(self._inEl,"keydown",kdAction),ZCALaddListener(self._inEl,"blur",blrAction),ZCALaddListener(self._inEl,"keypress",kpAction)),self._ulEl||(self._ulEl=parEl.appendChild(document.createElement("ul")),ZCALaddListener(self._ulEl,"mousedown",timclick));var o="hh:mm a"==self._tform?self.timeObj12hr(this.value):self.timeObj24hr(this.value);if(o){self._ulEl.innerHTML=o[0],self._ulEl.style.display="";var _len=self._ulEl.getElementsByTagName("li").length;self._ulEl.style.height=24*(2>=_len?_len:4)+"px",self._ulEl.scrollTop=24*o[1],self._inEl.value="hh:mm a"==self._tform?this.value.toUpperCase().replace(/^0/,""):this.value,this.placeholder=o[2],this.value="",self._sel=o[1],self._prevalue=this.value}else self._inEl.value=this.value,this.value="",this.placeholder="",self._ulEl.style.display="none";self._inEl.focus()};return 1==self._type?(ZCALaddListener(self._tar,"focus",showTime),ZCALaddListener(self._tar,"click",showTime)):2==self._type?ZCALaddListener(self._refer,"focus",focusEle):3==self._type&&(ZCALaddListener(self._refer,"keydown",trackKey),ZCALaddListener(self._refer,"keyup",trackKey),ZCALaddListener(self._refer,"mouseup",trackKey)),this},ZCALtimepickr.prototype.typenos=function(o,k,s){if(6==s&&/(A|P)/gi.test(String.fromCharCode(k))){var x=String.fromCharCode(k);return _ch="A"==x?" "+ZCALtform[0]:" "+ZCALtform[1],o.value=o.value.substring(0,5)+_ch,ZCALcrtesel(o,s,s+2),!0}var _k=String.fromCharCode(k),t="HH:mm"==(this._tform||o.getAttribute("tform"))?!0:!1;""==this.n?(this.n=_k,_k="0"+_k):(_k=this.n+""+_k,this.n=""),0==s&&(!t&&parseInt(_k,10)<=12||t&&parseInt(_k,10)<=23)?o.value=_k+o.value.substring(2):3==s&&parseInt(_k,10)<=59&&(o.value=o.value.substring(0,3)+_k+o.value.substring(5));var self=this;setTimeout(function(){self.n=""},1e4),ZCALcrtesel(o,s,s+2)},ZCALtimepickr.prototype.shiftnos=function(o,s,inc){var _val=o.value.substring(s,s+2);if(0==s){var t="HH:mm"==(this._tform||o.getAttribute("tform"))?!0:!1,_int=parseInt(_val,10);t&&0==_int&&-1==inc?_int=23:t||1!=_int||-1!=inc?t&&23==_int&&1==inc?_int=0:t||12!=_int||1!=inc?_int+=inc:_int=1:_int=12,o.value=(9>=_int?"0":"")+_int+o.value.substring(2,8)}else if(3==s){var _int=parseInt(_val,10);0==_int&&-1==inc?_int=59:59==_int&&1==inc?_int=1:_int+=inc,o.value=o.value.substring(0,3)+(9>=_int?"0":"")+_int+o.value.substring(5,8)}else 6==s&&(o.value=_val==ZCALtform[0]?o.value.substring(0,5)+" "+ZCALtform[1]:o.value.substring(0,5)+" "+ZCALtform[0]);return ZCALcrtesel(o,s,s+2),"true"},ZCALtimepickr.prototype.timeObj12hr=function(s){var obj=this.get12hrTime(s),txt="";if(obj&&obj.arr){for(var i=0;i<obj.arr.length;i++)txt+="<li"+(i==obj.sel?" class='zcal_sl'":"")+">"+obj.arr[i]+"</li>";return this._menu=!1,[txt,obj.sel,obj.arr[obj.sel]]}if(obj&&obj.sel>-1){var sel="";if(this._menu)sel=0==obj.sel?"12:00 AM":obj.sel+":00 AM";else for(var i=0;24>i;i++){var val=0==i?"12:00 AM":12==i?"12:00 PM":i>12?i-12+":00 PM":i+":00 AM";i==obj.sel&&(sel=val),txt+="<li"+(i==obj.sel?" class='zcal_sl'":"")+">"+val+"</li>",txt+="<li>"+val.replace("00","30")+"</li>"}return this._menu=!0,[txt,2*obj.sel,sel]}return!1},ZCALtimepickr.prototype.get12hrTime=function(val){var mobj,r1=["^([0-9])$","^(0?[1-9]|1[012])$","^(0?[1-9]|1[012])(:)$","^(0?[1-9]|1[012])(:)([0-5])$","^(0?[1-9]|1[012])(:)([0-5][0-9])$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)([APap])$","^(0?[1-9]|1[012])(:)([0-5][0-9])(\\s)([APap][mM])$"],len=val.length;if(len>1&&":"==val[1]&&len++,!(len>0&&8>=len&&(mobj=val.match(new RegExp(r1[len-1])))))return 0==len?!1:!1;if(mobj=Array.prototype.slice.call(mobj,1),4>len){var s=parseInt(mobj[0],10);return{sel:s>11?0:0==s?12:s}}if(4==len)return val=0==val[0]?val.slice(1):val,{arr:[val+"0 AM",val+"5 PM",val+"0 AM",val+"5 PM"],sel:0};if(len>4){var s=val.substring(0,5).trim();s=0==s[0]?s.slice(1):s;var s1=mobj[4]?/a/i.test(mobj[4][0])?0:1:0;return{arr:[s+" AM",s+" PM"],sel:s1}}},ZCALtimepickr.prototype.timeObj24hr=function(val){var obj=this.get24hrTime(val),txt=tmp="";if(obj&&obj.arr){for(var i=0;i<obj.arr.length;i++)txt+="<li "+(i==obj.sel?"class='zcal_sl'":"")+">"+obj.arr[i]+"</li>";return this._menu=!1,[txt,obj.sel,obj.arr[obj.sel]]}if(obj&&obj.sel>-1){if(!this._menu)for(var i=0;24>i;i++)tmp=10>i?"0"+i:i,txt+="<li "+(i==obj.sel?"class='zcal_sl'":"")+" >"+tmp+":00</li>",txt+="<li>"+tmp+":30</li>";return this._menu=!0,[txt,2*obj.sel,(obj.sel<10?"0"+obj.sel:obj.sel)+":00"]}},ZCALtimepickr.prototype.get24hrTime=function(val){var mobj,r1=["^([0-2])$","^([0-1][0-9]|2[0-3])$","^([0-1][0-9]|2[0-3])(:)$","^([0-1][0-9]|2[0-3])(:)([0-5])$","^([0-1][0-9]|2[0-3])(:)([0-5][0-9])$"],len=val.length;if(!(len>0&&6>len&&(mobj=val.match(new RegExp(r1[len-1])))))return 0==len?!1:!1;if(mobj=Array.prototype.slice.call(mobj,1),2==len){var s=parseInt(mobj[0],10);return{sel:s}}if(4>len){var s=parseInt(mobj[0],10);return{sel:1==mobj[0].length&&2>=s?10*s:s}}return 4==len?{arr:[val+"0",val+"5"],sel:0}:5==len?{arr:[val],sel:0}:void 0};var ZCALrangepickr=function(o){if(o){this._name="rangepicker",o.range=o.range||["",""],o.range[0]=""!=o.range[0].trim()?new Date(o.range[0].parseDate(o.dform)):new Date(1947,8,15),o.range[1]=""!=o.range[1].trim()?new Date(o.range[1].parseDate(o.dform)):new Date(2147,8,15),o.range[1]=o.range[0].diffTo("month",o.range[1])>=0?o.range[1]:new Date(2147,8,15);var cur=new Date,diff1=o.range[0].diffTo("month",new Date),diff2=cur.diffTo("month",o.range[1]),d1=diff1>=0&&diff2>0?new Date((new Date).setDate(1)):0>=diff1?o.range[0]:0>=diff2?new Date(o.range[1].getFullYear(),o.range[1].getMonth()-1,1):"",d2=new Date(d1.getFullYear(),d1.getMonth()+1);return this._r1=new ZCALdatepickr({dform:o.dform||"MM/DD/YYYY",curdate:d1,wkst:o.wkst||0,template:"type3",_cont:(new Date).getTime()+"_"+ZEVENTS.count++,range:o.range}),this._r2=new ZCALdatepickr({dform:o.dform||"MM/DD/YYYY",curdate:d2,wkst:o.wkst||0,template:"type3",_cont:(new Date).getTime()+"_"+ZEVENTS.count++,range:o.range}),this._clkdates=[],this._selfn=[],this._tar="object"==typeof o.target?o.target:document.getElementById(o.target),this._bsecont=ZEVENTS.template("type3")._bsecont,this._patch=ZEVENTS.template("type3")._patch,this._cont=(new Date).getTime()+"_"+ZEVENTS.count++,this}};ZCALrangepickr.prototype.on=function(mode,fn){return"select"==mode&&"function"==typeof fn&&this._selfn.push(fn),this},ZCALrangepickr.prototype.bind=function(){var self=this,_el=document.createElement(self._bsecont.tag);_el.id=self._cont,_el.className=self._bsecont._class,self._tar.appendChild(_el);var mdiff=self._r1._curDate.diffTo("month",self._r2._curDate);self.clearobj=function(){ZCALremoveListener(document.getElementById(self._r1._cont),"mousedown",eventhandle),ZCALremoveListener(document.getElementById(self._r2._cont),"mousedown",eventhandle),ZCALremoveListener(_el,"selectstart",ZCALprevDef),ZCALremoveListener(_el,"dragstart",ZCALprevDef);var _tmp=_el.parentNode.removeChild(_el);_tmp=null},self.clearvar=function(){self=_el=mdiff=null};var clearEl=function(_ele){for(;_ele.firstChild;)_ele.removeChild(_ele.firstChild);return _ele},eventhandle=function(e){var ele=e.target||event.srcElement,rel=ele.getAttribute("rel"),prel=ele.parentNode.getAttribute("rel"),cur="r1"==this.rel?self._r1:self._r2,dobj=new Date(cur._curDate),_sel=!1;if("u"==ele.tagName.toLowerCase()||-1!=ele.className.indexOf("zcal_dis"))return ZCALprevDef(e),!1;if("PM"==rel||"PM"==prel)dobj=ZCALchangeMonth(dobj,-1),cur._curDate=dobj;else if("NM"==rel||"NM"==prel)dobj=ZCALchangeMonth(dobj,1),cur._curDate=dobj;else if("PY"==rel||"PY"==prel)dobj.setYear(dobj.getFullYear()-1),cur._curDate=dobj;else if("NY"==rel||"NY"==prel)dobj.setYear(dobj.getFullYear()+1),cur._curDate=dobj;else if("DT"==ele.parentNode.parentNode.getAttribute("rel")){if(ele.className&&ele.className==ZEVENTS.template(cur._template)._class.dis)return;dobj.setDate(parseInt(ele.innerHTML,10));var _len=self._clkdates.length;if(0==_len||_len>=2)self._clkdates=new Array(dobj);else if(1==_len&&self._clkdates[0].getTime()!=dobj.getTime()){var pos=dobj<self._clkdates[0]?0:1;self._clkdates.splice(pos,0,dobj),_sel=!0}}var _len=self._clkdates.length;if(self._r1._select=self._r2._select=[],2==_len){var c1=self._clkdates[0].diffTo("month",self._r1._curDate),c2=self._r1._curDate.diffTo("month",self._clkdates[1]),c3=self._clkdates[0].diffTo("month",self._r2._curDate),c4=self._r2._curDate.diffTo("month",self._clkdates[1]);c1>=0&&c2>=0&&(self._r1._select={start:c1>0?1:self._clkdates[0].getDate(),end:c2>0?new Date(self._r1._curDate.getFullYear(),self._r1._curDate.getMonth()+1,0).getDate():self._clkdates[1].getDate()}),c3>=0&&c4>=0&&(self._r2._select={start:c3>0?1:self._clkdates[0].getDate(),end:c4>0?new Date(self._r2._curDate.getFullYear(),self._r2._curDate.getMonth()+1,0).getDate():self._clkdates[1].getDate()})}else 1==_len&&0==self._clkdates[0].diffTo("month",dobj)&&(cur._select=[dobj.getDate()]);var mndiff=self._r1._curDate.diffTo("month",self._r2._curDate);if(self.resetDRange("r1"==this.rel?"r1":"r2"),clearEl(getContainer.call(self._r1)).innerHTML=self._r1.calendar(),clearEl(getPatch.call(self)).innerHTML=mndiff>1?self._patch._cont:"",clearEl(getContainer.call(self._r2)).innerHTML=self._r2.calendar(),_sel)for(var fn in self._selfn)self._selfn[fn].call({getDateRange:{from:self._clkdates[0],to:self._clkdates[1]}})};0>=mdiff&&(self._r2._curDate=new Date(new Date(self._r1._curDate.getTime()).setMonth(self._r1._curDate.getMonth()+1)));var getContainer=function(r){var _ele=document.getElementById(this._cont);if(!_ele){var _cont=ZEVENTS.template(this._template)._cont;_ele=document.createElement(_cont.tag),_ele.className=_cont._class,_ele.rel=r,_ele.id=this._cont,document.getElementById(self._cont).appendChild(_ele),ZCALaddListener(_ele,"mousedown",eventhandle)}return _ele},getPatch=function(){var _ele=document.getElementById(this._cont+"_patch");if(!_ele){var _ele=document.createElement(this._patch.tag);_ele.id=this._cont+"_patch",document.getElementById(this._cont).appendChild(_ele)}return _ele};return self.resetDRange(),getContainer.call(self._r1,"r1").innerHTML=self._r1.calendar(),getPatch.call(self).innerHTML=mdiff>1?self._patch._cont:"",getContainer.call(self._r2,"r2").innerHTML=self._r2.calendar(),ZCALaddListener(_el,"selectstart",ZCALprevDef),ZCALaddListener(_el,"dragstart",ZCALprevDef),this},ZCALrangepickr.prototype.resetDRange=function(){this._r1._edate=new Date(this._r2._curDate.getFullYear(),this._r2._curDate.getMonth(),0),this._r2._sdate=new Date(this._r1._curDate.getFullYear(),this._r1._curDate.getMonth()+1,1)};var ZCALdatepickr=function(o){return o=o?o:{},this.fullDtclk=void 0!=o.fullDtclk?o.fullDtclk:0,this._name="datepicker",this._dform=o.dform||"mm/dd/yyyy",this._wkst=o.wkst&&/^[0-7]$/g.test(o.wkst)?o.wkst:0,this._tar="object"==typeof o.target?o.target:document.getElementById(o.target),this._type=o.mode||"inline",this._titype=o.time||"",this._select=o.select||[],this._monchge=[],this._yrchge=[],this._dtclk=[],this._okclk=[],this._customdate=o.customdate||"no",this._template=o.template||("yes"==this._customdate?"type7":"inline"==this._type?"type1":"popup"==this._type&&"right"==this._titype?"type5":"popup"==this._type&&"bottom"==this._titype?"type6":"type2"),this._curDate=o.curdate||(o.today?o.today.parseDate(this._dform):new Date),this._cont=o._cont||(new Date).getTime()+"_"+ZEVENTS.count++,this._change=o.update||"yes",this._minhgt=o.minhgt||251,this._tz=o.timezone||"",this._selDate=new Date,this._curTime,this._pickerview=o.pickerview||"",o.fn&&(this.fn=o.fn),o.timerange&&(this._stime=o.timerange[0],this._etime=o.timerange[1]),o.range&&"[object String]"==Object.prototype.toString.call(o.range[0])?(this._sdate=o.range[0].parseDate(this._dform)||new Date(1947,8,15),this._edate=o.range[1].parseDate(this._dform)||new Date(2147,8,15)):o.range&&"[object Date]"==Object.prototype.toString.call(o.range[0])?(this._sdate=o.range[0],this._edate=o.range[1]):(this._sdate=null,this._edate=null),o.refer?this._refer="object"==typeof o.refer?o.refer:document.getElementById(o.refer):this._tar&&(this._refer="input"==this._tar.tagName.toLowerCase()?this._tar:this._tar.getElementsByTagName("input")[0]),this};ZCALdatepickr.prototype.on=function(mode,fn){return"monthchge"==mode&&"function"==typeof fn?this._monchge.push(fn):"yearchge"==mode&&"function"==typeof fn?this._yrchge.push(fn):"dateclick"==mode&&"function"==typeof fn?this._dtclk.push(fn):"ok"==mode&&"function"==typeof fn&&this._okclk.push(fn),this},ZCALdatepickr.prototype.updateselect=function(arr){return this._r1||(this._select=arr||this._select,document.getElementById(this._cont).innerHTML=this.calendar()),this},ZCALdatepickr.prototype.bind=function(){var self=this,_cont=ZEVENTS.template(self._template)._cont,_dn="",_ele=document.createElement(_cont.tag);_ele.id=self._cont,_ele.className=_cont._class,self.clearobj=function(){if(ZEVENTS.obj.state=null,document.getElementById(self._cont)){ZCALremoveListener(_ele,"mousedown",eventhandle),ZCALremoveListener(_ele,"selectstart",ZCALprevDef),ZCALremoveListener(_ele,"dragstart",ZCALprevDef);var _tmp=_ele.parentNode.removeChild(_ele);"popup"==self._type&&(ZCALremoveListener(document,"mousedown",docevehandle),ZCALremoveListener(document,"scroll",docevehandle),ZCALremoveListener(document,"mousewheel",docevehandle),"bottom"==self._titype&&(ZCALremoveListener(_ele,"keydown",docevekeyhandle1),ZCALremoveListener(_ele,"keyup",docevekeyhandle2))),_tmp=null}},self.hide=function(e){var hi=!0;_ele.contains(e.target)&&(hi=!1),hi&&self.clearobj()},self.clearvar=function(){self=_ele=_cont=null};var reDom=function(){ZEVENTS.obj.state&&ZEVENTS.clear(ZEVENTS.obj.state),ZEVENTS.obj.state=self;var _cur=self._refer;_dn="yes",self._curDate=_cur.value.parseDate(self._dform)||new Date,_ele.innerHTML=self.calendar(_dn),ZCALaddListener(_ele,"mousedown",eventhandle),ZCALaddListener(document,"mousedown",docevehandle=function(e){self.hide(e)}),ZCALaddListener(document,"scroll",docevehandle=function(e){self.hide(e)}),ZCALaddListener(document,"mousewheel",docevehandle=function(e){self.hide(e)}),self.fn(_ele)},initpopup=function(e){ZEVENTS.obj.state&&ZEVENTS.clear(ZEVENTS.obj.state),ZEVENTS.obj.state=self;var _cur=self._refer,_rge=(document.documentElement.clientHeight||window.innerHeight)+Math.max(document.body.scrollTop,document.documentElement.scrollTop),_wrge=(document.documentElement.clientWidth||window.innerWidth)+Math.max(document.body.scrollLeft,document.documentElement.scrollLeft);document.body.appendChild(_ele),ZCALaddListener(_ele,"mousedown",eventhandle),ZCALaddListener(_ele,"selectstart",ZCALprevDef),ZCALaddListener(_ele,"dragstart",ZCALprevDef),ZCALaddListener(document,"mousedown",docevehandle=function(e){self.hide(e)}),ZCALaddListener(document,"scroll",docevehandle=function(e){self.hide(e)}),ZCALaddListener(document,"mousewheel",docevehandle=function(e){self.hide(e)}),"bottom"==self._titype?(_dn=this.parentNode.positionY()+this.parentNode.offsetHeight+self._minhgt>_rge?"no":"yes",_ele.style.top=("yes"==_dn?this.parentNode.positionY()+this.parentNode.offsetHeight-self._minhgt:this.parentNode.positionY()+this.parentNode.offsetHeight-self._minhgt)+"px"):(_dn=this.positionY()+this.offsetHeight+self._minhgt>_rge?"no":"yes",_ele.style.left=this.positionX()+(this.positionX()+260>_wrge?-260+this.offsetWidth:0)+"px",_ele.style.top=("yes"==_dn?this.positionY()+this.offsetHeight:this.positionY()-_ele.offsetHeight)+"px"),self._curDate=_cur.value.parseDate(self._dform)||new Date,_ele.innerHTML=self.calendar(_dn),_ele.style.left="bottom"==self._titype?this.parentNode.positionX()-_ele.offsetWidth+"px":_ele.style.left,_ele.style.top="bottom"==self._titype?this.parentNode.positionY()+this.parentNode.offsetHeight-_ele.offsetHeight+"px":_ele.style.top,_ele.style.top="bottom"==self._titype&&parseInt(_ele.style.top)<0?this.parentNode.positionY()+this.parentNode.offsetHeight+"px":_ele.style.top,self._refer.focus(),ZCALprevDef(e)},getpointers=function(n,o,ti,t){return 0==t?{getDates:function(){return[o,n]}}:2==t?{getDateObj:function(){return{selectDate:n,selectTime:ti}}}:{getDate:function(){return n}}},myKeyUpHandler=function(eve,id){var k=eve.which||eve.keyCode||eve.charCode;if("zcal_hr"==id){if(38!=k&&40!=k){var dateVal=document.getElementById(id).value,patt1=/^[0-9]{1,10}$/,result=(document.getElementById(id).value,patt1.test(dateVal));result?document.getElementById(id).value=dateVal>12&&24>dateVal?dateVal-12:12>dateVal?document.getElementById(id).value:(new Date).getHours()>12?"0"+(new Date).getHours()-12:"0"+(new Date).getHours():""!=dateVal&&(document.getElementById(id).value=(new Date).getHours())}}else if("zcal_min"==id&&38!=k&&40!=k){var dateVal=document.getElementById(id).value,patt1=/^[0-9]{1,10}$/,result=(document.getElementById(id).value,patt1.test(dateVal));result?(dateVal>60||dateVal.length>2)&&(document.getElementById(id).value=(new Date).getMinutes()):""!=dateVal&&(document.getElementById(id).value="00")}},myKeyPressHandler=function(eve,id){var k=eve.which||eve.keyCode||eve.charCode;if("zcal_hr"==id){var inpVal=document.getElementById(id).value;38==k?11>=inpVal?(document.getElementById(id).value=++inpVal,document.getElementById(id).value=inpVal>9?inpVal:"0"+inpVal):document.getElementById(id).value="01":40==k&&(inpVal>1&&1!=inpVal?(document.getElementById(id).value=--inpVal,document.getElementById(id).value=inpVal>9?inpVal:"0"+inpVal):document.getElementById(id).value=12)}else if("zcal_min"==id){var inpVal=document.getElementById(id).value;if(38==k)if(58>=inpVal){var inc=++inpVal;document.getElementById(id).value=10>inc?"0"+inc:inc}else document.getElementById(id).value="00";else if(40==k)if(inpVal>0&&0!=inpVal){var inc=--inpVal;document.getElementById(id).value=10>inc?"0"+inc:inc}else document.getElementById(id).value=59}else if("zcal_ap"==id){var inpVal=document.getElementById(id).value;38==k?document.getElementById(id).value="AM"==inpVal?"PM":"AM":40==k&&(document.getElementById(id).value="AM"==inpVal?"PM":"AM")}},eventhandle=function(e){e=e||event;var ele=e.target||e.srcElement,rel=ele.getAttribute("rel"),prel=ele.parentNode.getAttribute("rel"),_clk=[],t=0,dobj=new Date(self._curDate);if("u"==ele.tagName.toLowerCase()||"object"!=typeof ele.className&&-1!=ele.className.indexOf("zcal_dis")){if(1!=self.fullDtclk||"u"!=ele.tagName.toLowerCase())return ZCALprevDef(e),!1;_clk=self._dtclk,t=1;var mon=parseInt(ele.getAttribute("rel").split("Y")[0]),yr=parseInt(ele.getAttribute("rel").split("Y")[1]);dobj.setDate(parseInt(ele.innerHTML,10)),dobj.setMonth(mon),dobj.setYear(yr)}if("PY"==rel||"PY"==prel){var _clkel="PY"==rel?ele:ele.parentNode;if("object"==typeof _clkel&&"zcal_dis"==_clkel.getAttribute("class"))return;_clk=self._yrchge,dobj.setYear(dobj.getFullYear()-1)}else if("NY"==rel||"NY"==prel){var _clkel="NY"==rel?ele:ele.parentNode;if("object"==typeof _clkel&&"zcal_dis"==_clkel.getAttribute("class"))return;_clk=self._yrchge,dobj.setYear(dobj.getFullYear()+1)}else if("PM"==rel||"PM"==prel){var _clkel="PM"==rel?ele:ele.parentNode;if("object"==typeof _clkel){if("zcal_dis"==_clkel.getAttribute("class"))return;if(document.querySelector("div.zcal_vw_yr")){var yroptArr=document.querySelectorAll("li[rel=year_sel]"),styr=parseInt(yroptArr[0].querySelector("span").innerHTML)-12,etyr=parseInt(styr)+11;document.querySelector("span[rel=year_idx]").innerHTML=styr+" - "+etyr,dobj.setFullYear(styr),self._tempview="year"==self._pickerview?!1:!0,self._pickerview="year"}else document.querySelector("div.zcal_vw_mth")?(dobj.setFullYear(self._curDate.getFullYear()-1),document.querySelector("span[rel=year_idx]").innerHTML=self._curDate.getFullYear(),self._tempview="month"==self._pickerview?!1:!0,self._pickerview="month"):(_clk=self._monchge,dobj=ZCALchangeMonth(dobj,-1))}else _clk=self._monchge,dobj=ZCALchangeMonth(dobj,-1)}else if("NM"==rel||"NM"==prel){var _clkel="NM"==rel?ele:ele.parentNode;if("object"==typeof _clkel){if("zcal_dis"==_clkel.getAttribute("class"))return;if(_ele.querySelector("div.zcal_vw_yr")){var yroptArr=_ele.querySelectorAll("li[rel=year_sel]"),styr=parseInt(yroptArr[yroptArr.length-1].querySelector("span").innerHTML)+1,etyr=parseInt(styr)+11;_ele.querySelector("span[rel=year_idx]").innerHTML=styr+" - "+etyr,dobj.setFullYear(styr),self._tempview="year"==self._pickerview?!1:!0,self._pickerview="year"}else _ele.querySelector("div.zcal_vw_mth")?(dobj.setFullYear(dobj.getFullYear()+1),_ele.querySelector("span[rel=year_idx]").innerHTML=self._curDate.getFullYear(),self._tempview="month"==self._pickerview?!1:!0,self._pickerview="month"):(dobj=ZCALchangeMonth(dobj,1),_clk=self._monchge)}else dobj=ZCALchangeMonth(dobj,1),_clk=self._monchge}else if("TL"==rel||"HI"==rel||"MI"==rel||"AP"==rel)t=3;else if("DT"==ele.parentNode.parentNode.getAttribute("rel")&&"bottom"==self._titype){t=2;var d=ele.parentNode.parentNode;d.querySelector(".zcal_sl")?d.querySelector(".zcal_sl").innerHTML!=ele.innerHTML&&(d.querySelector(".zcal_sl").className="",ele.className="zcal_sl"):ele.className="zcal_sl",_clk=self._dtclk,dobj.setDate(parseInt(ele.innerHTML,10)),self._selDate=dobj}else if("month_idx"==rel&&"no"!=self._customdate)t=2,self.updateHead(_ele,ele,"month_idx");else if("year_idx"==rel&&"no"!=self._customdate)t=2,self.updateHead(_ele,ele,"year_idx");else if("month_sel"==prel||"month_sel"==rel){t="month"==self._pickerview?1:0;var clkel="month_sel"==rel?ele.childNodes[0]:ele,d=clkel.getAttribute("rel");if("zcal_dis"==clkel.parentNode.className)return;"month"==self._pickerview?(dobj.setMonth(d),_clk=self._dtclk,self.clearobj()):(_clk=self._monchge,dobj.setMonth(d),_ele.querySelector("div.zcal_mCalvw").className="zcal_mCalvw zcal_vw_dy")}else if("year_sel"==prel||"year_sel"==rel){t=2;var clkel="year_sel"==rel?ele.childNodes[0]:ele,d=parseInt(clkel.innerHTML,10);if("zcal_dis"==clkel.parentNode.className)return;"year"==self._pickerview?(dobj.setFullYear(d),_clk=self._dtclk,self.clearobj()):(_clk=self._yrchge,dobj.setFullYear(d),document.querySelector("span[rel=year_idx]").innerHTML=self._curDate.getFullYear(),self._tempview="month"==self._pickerview?!1:!0,self._pickerview="month",t=0)}else if("DT"==ele.parentNode.parentNode.getAttribute("rel"))_clk=self._dtclk,t=1,dobj.setDate(parseInt(ele.innerHTML,10));else if("OK"==rel){t=2;var hr=document.getElementById("zcal_hr").value,min=document.getElementById("zcal_min").value,ap=document.getElementById("zcal_ap").value,time=hr+":"+min+":"+ap;if(self._curTime=time,ele.parentNode.parentNode.parentNode.parentNode.parentNode.querySelectorAll(".zcal_sl").length){var date=ele.parentNode.parentNode.parentNode.parentNode.parentNode.querySelectorAll(".zcal_sl")[0].innerHTML;dobj.setDate(parseInt(date,10))}else{var date=ele.parentNode.parentNode.parentNode.parentNode.parentNode.querySelectorAll("s")[0].innerHTML;dobj.setDate(parseInt(date,10))}_clk=self._okclk,self.clearobj()}if(0==t){for(self._curDate=dobj;_ele.firstChild;)_ele.removeChild(_ele.firstChild);_ele.innerHTML=self.calendar(_dn)}1==t&&self&&"popup"==self._type&&("bottom"==self._titype?"yes"==self._change&&(self._refer.value=dobj.getDateBy(self._dform)):("yes"==self._change&&(self._refer.value=dobj.getDateBy(self._dform)),self.clearobj()));for(var fn in _clk)_clk[fn].call(getpointers(dobj,self._curDate,self._curTime,t));3!=t&&ZCALprevDef(e)};return"inline"==self._type?(self._tar.appendChild(_ele),ZCALaddListener(_ele,"mousedown",eventhandle),ZCALaddListener(_ele,"selectstart",ZCALprevDef),ZCALaddListener(_ele,"dragstart",ZCALprevDef),_ele.innerHTML=self.calendar()):"popup"==self._type&&"bottom"==self._titype?(ZCALaddListener(self._refer,"click",reDom),ZCALaddListener(_ele,"keydown",docevekeyhandle1=function(eve){myKeyPressHandler(eve,eve.target.id)}),ZCALaddListener(_ele,"keyup",docevekeyhandle2=function(eve){myKeyUpHandler(eve,eve.target.id)})):"popup"==self._type&&(ZCALaddListener(self._refer,"focus",initpopup),ZCALaddListener(self._refer,"blur",docevehandle=function(){self.clearobj()}),ZCALaddListener(self._refer,"keypress",ZCALprevDef),ZCALaddListener(self._tar,"mousedown",initpopup)),this},ZCALdatepickr.prototype.updateHead=function(_ele,elem,rel){if("month_idx"==rel){var strmth=this._sdate?this._sdate.getMonth():"",etrmth=this._edate?this._edate.getMonth():"";if(strmth&&etrmth&&strmth==etrmth)return;elem.style.display="none";var mnoptArr=_ele.querySelectorAll("li[rel=month_sel]");"zcal_dis"==mnoptArr[mnoptArr.length-1].className&&_ele.querySelector("svg[rel=nm]").setAttribute("class","zcal_dis"),"zcal_dis"==mnoptArr[0].className&&_ele.querySelector("svg[rel=pm]").setAttribute("class","zcal_dis"),_ele.querySelector("div.zcal_mCalvw")&&(_ele.querySelector("div.zcal_mCalvw").className="zcal_mCalvw zcal_vw_mth")}else if("year_idx"==rel){var yroptArr=_ele.querySelectorAll("li[rel=year_sel]"),styr=yroptArr[0].querySelector("span").innerHTML,etyr=yroptArr[yroptArr.length-1].querySelector("span").innerHTML,stryr=this._sdate?this._sdate.getFullYear():"",etryr=this._edate?this._edate.getFullYear():"";if(stryr&&etryr&&stryr==etryr)return;elem.innerHTML=styr+" - "+etyr,elem.previousSibling.style.display="none",stryr&&etryr&&(stryr>styr?_ele.querySelector("svg[rel=pm]").setAttribute("class","zcal_dis"):etyr>etryr&&_ele.querySelector("svg[rel=nm]").setAttribute("class","zcal_dis")),_ele.querySelector("div.zcal_mCalvw")&&(_ele.querySelector("div.zcal_mCalvw").className="zcal_mCalvw zcal_vw_yr")}_ele.querySelector("svg[rel=NY]").setAttribute("class","zcal_dis"),_ele.querySelector("svg[rel=PY]").setAttribute("class","zcal_dis")},ZCALdatepickr.prototype.changeDate=function(dt){var _ele=document.getElementById(this._cont);for(this._curDate=dt?dt.parseDate(this._dform):this._curDate;_ele.firstChild;)_ele.removeChild(_ele.firstChild);return _ele.innerHTML=this.calendar(""),!0},ZCALdatepickr.prototype.calendar=function(_dn){var _tpO=ZEVENTS.template(this._template),_HTML=_tpO._HTML,_class=_tpO._class,_cust=_tpO._cust;if("right"==this._titype)_HTML=_HTML.replace("#timerow",""),_HTML=_HTML.replace("timerow#",""),_HTML=_HTML.replace("#okrow",""),_HTML=_HTML.replace("okrow#","");else if("type7"==this._template){var in7=_HTML.indexOf("#timerow"),in8=_HTML.indexOf("timerow#");_HTML=_HTML.replace(_HTML.substring(in7,in8+"timerow#".length),"");var in9=_HTML.indexOf("#okrow"),in10=_HTML.indexOf("okrow#");_HTML=_HTML.replace(_HTML.substring(in9,in10+"okrow#".length),"")}var in1=_HTML.indexOf("#wk"),in2=_HTML.indexOf("wk#"),in3=_HTML.indexOf("#dr"),in4=_HTML.indexOf("dr#"),in5=_HTML.indexOf("#tr"),in6=_HTML.indexOf("tr#"),in8=_HTML.indexOf("#br"),in9=_HTML.indexOf("br#"),in_1=_HTML.indexOf("#ycr"),in_2=_HTML.indexOf("ycr#"),in_3=_HTML.indexOf("#mcr"),in_4=_HTML.indexOf("mcr#"),cont="type7"==this._template?_HTML.substring(0,in_1):_HTML.substring(0,in1);if(cont+="type7"==this._template?this.yearrow(_HTML.substring(in_1+4,in_2)):"",cont+="type7"==this._template?_HTML.substring(in_2+4,in_3):"",cont+="type7"==this._template?this.monthrow(_HTML.substring(in_3+4,in_4)):"",cont+="type7"==this._template?_HTML.substring(in_4+4,in1):"",cont="type7"==this._template?cont.replace("#viewclass#","month"==this._pickerview?"zcal_mCalvw zcal_vw_mth":"year"==this._pickerview?"zcal_mCalvw zcal_vw_yr":"zcal_mCalvw zcal_vw_dy"):cont,cont=cont.replace("#HEAD#",this._curDate.getDateBy("MMMM YYYY")).replace("#HEADM#","year"==this._pickerview||"month"==this._pickerview?"":this._curDate.getDateBy("MMMM")).replace("#HEADY#","year"==this._pickerview?this._curDate.getDateBy("YYYY")+"-"+(parseInt(this._curDate.getDateBy("YYYY"))+11):this._curDate.getDateBy("YYYY")),this._sdate&&this._edate){var syr=this._sdate.getFullYear(),smn=this._sdate.getMonth(),eyr=this._edate.getFullYear(),emn=this._edate.getMonth(),cyr=this._curDate.getFullYear(),cmn=this._curDate.getMonth(),cdt=this._curDate.getDate();cont=cont.replace("#py#",("type7"==this._template?"":"zci-fst ")+(new Date(cyr-1,cmn,cdt)>=this._sdate&&"year"!=this._pickerview&&"month"!=this._pickerview?"":"zcal_dis")).replace("#ny#",("type7"==this._template?"":"zci-lst ")+(new Date(cyr+1,cmn,cdt)<=this._edate&&"year"!=this._pickerview&&"month"!=this._pickerview?"":"zcal_dis")).replace("#pm#",("type7"==this._template?"":"zci-pre ")+("type7"==this._template&&"month"==this._pickerview&&syr>=cyr?"zcal_dis":new Date(cyr,cmn,1)>new Date(syr,smn,1)?"":"zcal_dis")).replace("#nm#",("type7"==this._template?"":"zci-nxt ")+("type7"==this._template&&"month"==this._pickerview&&cyr>=eyr?"zcal_dis":new Date("type7"==this._template&&"year"==this._pickerview?cyr+11:cyr,cmn,1)<new Date(eyr,emn,1)?"":"zcal_dis"))}else cont=cont.replace("#py#","type7"==this._template?"month"==this._pickerview||"year"==this._pickerview?"zcal_dis":"":_cust?_cust.py:"zci-fst").replace("#ny#","type7"==this._template?"month"==this._pickerview||"year"==this._pickerview?"zcal_dis":"":_cust?_cust.ny:"zci-lst").replace("#pm#","type7"==this._template?"":_cust?_cust.pm:"zci-pre").replace("#nm#","type7"==this._template?"":_cust?_cust.nm:"zci-nxt");return cont=1==this.fullDtclk?cont.replace("#hover#","zcal_mCalce"):cont.replace("#hover#",""),cont=cont.replace("#shadow#",_dn&&"yes"!=_dn?_class.shup:_class.shdwn),"type7"==this._template&&(cont=cont.replace("#timediv#","right"==this._titype?"zcl_mCalwti":"")),cont+=this.weekrow(_HTML.substring(in1+3,in2)),cont+=_HTML.substring(in2+3,in3),cont+=this.daterow(_HTML.substring(in3+3,in4)),"right"==this._titype?(cont+=_HTML.substring(in4+3,in5).replace("#tz#",this._tz),cont+=this.timerow(_HTML.substring(in5+3,in6)),cont+=_HTML.substring(in6+3,_HTML.length)):"bottom"==this._titype?(cont+=_HTML.substring(in4+3,in8).replace("#tz#",this._tz),cont+=this.setTimeValue(_HTML.substring(in8+3,in9)),cont+=_HTML.substring(in9+3,_HTML.length)):cont+=_HTML.substring(in4+3,_HTML.length).replace("#tz#",this._tz),this._tempview&&(this._pickerview=""!=this._pickerview?"":this._pickerview),cont},ZCALdatepickr.prototype.setTimeValue=function(cont){var date=new Date,txt="",hr=date.getHours()>12?date.getHours()-12:date.getHours(),curHr=10>hr?hr:hr,min=date.getMinutes()<10?"0"+date.getMinutes():date.getMinutes(),ap=date.getHours()>=12?"PM":"AM",h=curHr>9?curHr:"0"+curHr;return txt=cont.replace("#cuHr#",h).replace("#cuMin#",min).replace("#apm#",ap)},ZCALdatepickr.prototype.yearrow=function(cont){for(var txt="",_syear=this._sdate?this._sdate.getFullYear():"",_eyear=this._edate?this._edate.getFullYear():"",in5=cont.indexOf("#yt"),in6=cont.indexOf("yt#"),yr=this._curDate.getFullYear(),x=((new Date).getFullYear(),new Date,cont.substring(in5+3,in6)),cnt=0,i=0;4>i;i++){txt+=cont.substring(0,in5);for(var j=0;3>j;j++){var tag="";tag=x.replace("#item#","<span>"+(yr+cnt)+"</span>"),this._curDate.getFullYear()==yr+cnt?tag=_syear&&_eyear&&(_syear>yr+cnt||yr+cnt>_eyear)?tag.replace("#selclass#","zcal_dis"):tag.replace("#selclass#","zcal_sl_cr"):_syear&&_eyear&&(_syear>yr+cnt||yr+cnt>_eyear)&&(tag=tag.replace("#selclass#","zcal_dis")),txt+=tag,cnt++}txt+=cont.substring(in6+3,cont.length)}return txt},ZCALdatepickr.prototype.monthrow=function(cont){for(var txt="",in5=cont.indexOf("#mt"),in6=cont.indexOf("mt#"),x=cont.substring(in5+3,in6),mn=cnt=0,_yrsel=this._curDate.getFullYear(),_smonth=this._sdate?this._sdate.getMonth():"",_emonth=this._edate?this._edate.getMonth():"",_syear=this._sdate?this._sdate.getFullYear():"",_eyear=this._edate?this._edate.getFullYear():"",i=0;4>i;i++){txt+=cont.substring(0,in5);for(var j=0;3>j;j++){var tag="";tag=x.replace("#item#","<span rel="+(mn+cnt)+">"+Date.MONTH_NAMES[1][mn+cnt]+"</span>"),_syear&&_eyear&&(_yrsel==_syear||_yrsel==_eyear)&&(_smonth&&_emonth&&_yrsel==_eyear&&mn+cnt>_emonth?tag=tag.replace("#selclass#","zcal_dis"):_smonth&&_emonth&&_yrsel==_syear&&_smonth>mn+cnt&&(tag=tag.replace("#selclass#","zcal_dis"))),this._curDate.getMonth()==mn+cnt&&(tag=tag.replace("#selclass#","zcal_sl_cr")),txt+=tag,cnt++}txt+=cont.substring(in6+3,cont.length)}return txt},ZCALdatepickr.prototype.timerow=function(cont){var d1=new Date;d1.setTime((new Date).getTime());var sd,hrs,min,st,d=d1.getDate(),m=d1.getMonth(),y=d1.getFullYear();m=10>m+1?"0"+(m+1):m+1,d=10>d?"0"+d:d,sd=y+""+m+d,d1.setTime((new Date).getTime()),hrs=d1.getHours(),min=d1.getMinutes(),st=2*hrs+(min>30?2:1),st=st>46?46:st;for(var txt="",j=0;48>j;j++){var ch=!1;this._stime&&da.getFullYear()==this._selDate.getFullYear()&&da.getMonth()==this._selDate.getMonth()&&da.getDate()==this._selDate.getDate()&&(ch=!0),txt+=cont.replace("#item#",(j+"").changeNumbertoTime("hh:mm a")).replace("#ti#",j==st?' class="zcal_mCcrti"':1==ch&&st>j?' class="zcal_dis"':"")}return txt},ZCALdatepickr.prototype.weekrow=function(cont){for(var dy=new Date(this._curDate).getDay(),st=this._wkst,_tpO=ZEVENTS.template(this._template),cnt=0,txt="";7>cnt;)txt+=cont.replace("#item#",Date.WEEKS_DAYS[2][st]).replace("#hgt#",st==dy&&_tpO._cust?" class="+_tpO._cust.dysel:""),st=6>st?st+1:0,cnt++;return txt},ZCALdatepickr.prototype.daterow=function(cont){var in5=cont.indexOf("#dc"),in6=cont.indexOf("dc#"),x=cont.substring(in5+3,in6),dobj=new Date(this._curDate),today=dobj.getDate(),thisMon=dobj.getMonth(),cdte="",cmon="",txt="",hd=",",isObj=(this._type,"[object Object]"==Object.prototype.toString.call(this._select)?!0:!1);if(!isObj)for(var k=0;k<this._select.length;k++)hd+=this._select[k]+",";dobj.setDate(1);var MST=dobj.getDay(),fDay=new Date(dobj.getFullYear(),dobj.getMonth(),1),lDay=new Date(dobj.getFullYear(),dobj.getMonth()+1,0),diff=(Math.ceil((fDay.getDay()+lDay.getDate())/7),MST-this._wkst+(MST-this._wkst<0?7:0));dobj.setDate(dobj.getDate()-diff);for(var _class=ZEVENTS.template(this._template)._class,i=0;6>i;i++){txt+=cont.substring(0,in5);for(var j=0;7>j;j++){var cl="";cdte=dobj.getDate(),cmon=dobj.getMonth();var tag=_class.nor;if(cmon==thisMon&&!this._sdate&&!this._edate||cmon==thisMon&&this._sdate&&this._edate&&this._sdate<=dobj&&this._edate>=dobj){(""!=hd&&hd.indexOf(","+cdte+",")>-1||isObj&&this._select.start<=cdte&&this._select.end>=cdte)&&(tag=_class.sel);var curD=(new Date).getDate();curD==cdte&&(tag=_class.hglt),today==cdte&&today!=curD&&_class.hglt&&(cl="zcal_sl")}else tag=_class.dis;txt+=x.replace(/#tag#/g,tag).replace("#cl#","class="+cl).replace("#item#",cdte).replace("#month#",dobj.getMonth()).replace("#year#",dobj.getFullYear()),dobj.setDate(cdte+1)}txt+=cont.substring(in6+3,cont.length)}return txt},Element.prototype.positionX=function(){var curleft=0,obj=this;if("function"==typeof obj.getBoundingClientRect){var box=obj.getBoundingClientRect();curleft=box.left+(window.pageXOffset||document.documentElement.scrollLeft)-(document.documentElement.clientLeft||0)}else if(obj.offsetParent)for(;obj.offsetParent;)curleft+=obj.offsetLeft,obj=obj.offsetParent;else obj.x&&(urleft+=obj.x);return curleft},Element.prototype.positionY=function(){var curtop=0,obj=this;if("function"==typeof obj.getBoundingClientRect){var box=obj.getBoundingClientRect();curtop=box.top+(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0)}else if(obj.offsetParent)for(;obj.offsetParent;)curtop+=obj.offsetTop,obj=obj.offsetParent;else obj.y&&(curtop+=obj.y);return curtop},String.prototype.trim=function(){var x=this;return x=x.replace(/^\s*(.*)/,"$1"),x=x.replace(/(.*?)\s*$/,"$1")},String.prototype.changeNumbertoTime=function(f){var a,i,j=parseInt(this,10);return"hh:mm a"==f?(i=j>24?j-24:j,i=0==i||1==i?12:parseInt(i/2,10),a=j>23?" "+ZCALtform[1]:" "+ZCALtform[0]):(i=parseInt(j/2,10),a=""),(10>i?"0":"")+i+":"+(j%2==1?"30":"00")+a},String.prototype.changeTimetoNumber=function(f){if(this.indexOf(":")<0)return 0;var o=this.split(":");if(o[0]=parseInt(o[0],10),"hh:mm a"==f){var sp=o[1].split(" ");sp[1]==ZCALtform[1]&&12!=o[0]?o[0]+=12:sp[1]==ZCALtform[0]&&12==o[0]&&(o[0]=0),o[1]=sp[0]}return o[1]=parseInt(o[1],10),2*o[0]+(30==o[1]?1:0)},String.prototype.parseDate=function(format){var findMKey=function(str,obj){for(var i in obj)if(str.toLowerCase().trim()==obj[i].toLowerCase())return parseInt(i,10)+1;return!1};if(!format||""==format.trim())return!1;if(this&&""==this.trim())return!1;var input=this,parts=input.match(/(\d+)|([a-zA-Z]+)/g),i=0,fmt={},fparts=format.toLowerCase().match(/([a-z]+)/g);if(3!=fparts.length||3!=parts.length)return!1;for(var i in fparts)"d"==fparts[i]||"m"==fparts[i]?fparts[i]+=fparts[i]:"mmm"==fparts[i]?(parts[i]=findMKey(parts[i],Date.MONTH_NAMES[1]),fparts[i]="mm"):"mmmm"==fparts[i]?(parts[i]=findMKey(parts[i],Date.MONTH_NAMES[0]),fparts[i]="mm"):"yy"==fparts[i]&&(parts[i]=parts[i]>=70?1900+parseInt(parts[i],10):2e3+parseInt(parts[i],10),fparts[i]="yyyy"),fmt[fparts[i]]=parts[i];return new Date(fmt.yyyy,fmt.mm-1,fmt.dd)},Date.MONTH_NAMES=new Array(["January","February","March","April","May","June","July","August","September","October","November","December"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),Date.WEEKS_DAYS=new Array(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["S","M","T","W","T","F","S"]),ZCALtform=["am","pm"],Date.prototype.getDaysOfMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()},Date.prototype.getDateBy=function(format){var LZ=function(x){return(0>x||x>9?"":"0")+x};if(""!=format.trim()){format+="";var result="",i_format=0,c="",token="",y=this.getYear()+"",M=this.getMonth()+1,d=this.getDate(),E=this.getDay();y.length<4&&(y=""+(+y+1900));var value={};for(value.YYYY=y,value.YY=y.substring(2,4),value.M=M,value.MM=LZ(M),value.MMMM=Date.MONTH_NAMES[0][M-1],value.MMM=Date.MONTH_NAMES[1][M-1],value.D=d,value.DD=LZ(d),value.E=Date.WEEKS_DAYS[1][E],value.EE=Date.WEEKS_DAYS[0][E];i_format<format.length;){for(c=format.charAt(i_format),token="";format.charAt(i_format)==c&&i_format<format.length;)token+=format.charAt(i_format++);result+=null!=value[token.toUpperCase()]?value[token.toUpperCase()]:token}return result}},Date.prototype.getTimeBy=function(f){function ii(i,len){var s=i+"";for(len=len||2;s.length<len;)s="0"+s;return s}var H=this.getHours();f=f.replace(/(^|[^\\])HH+/g,"$1"+ii(H)),f=f.replace(/(^|[^\\])H/g,"$1"+H);var h=H>12?H-12:0==H?12:H;f=f.replace(/(^|[^\\])hh+/g,"$1"+ii(h)),f=f.replace(/(^|[^\\])h/g,"$1"+h);var m=this.getMinutes();f=f.replace(/(^|[^\\])mm+/g,"$1"+ii(m)),f=f.replace(/(^|[^\\])m/g,"$1"+m);var s=this.getSeconds();f=f.replace(/(^|[^\\])ss+/g,"$1"+ii(s)),f=f.replace(/(^|[^\\])s/g,"$1"+s);var T=12>H?"AM":"PM";f=f.replace(/(^|[^\\])TT+/g,"$1"+T),f=f.replace(/(^|[^\\])T/g,"$1"+T.charAt(0));var t=T.toLowerCase();f=f.replace(/(^|[^\\])tt+/g,"$1"+t),f=f.replace(/(^|[^\\])t/g,"$1"+t.charAt(0));var tz=-this.getTimezoneOffset(),K=tz?tz>0?"+":"-":"Z";tz=Math.abs(tz);var tzHrs=Math.floor(tz/60),tzMin=tz%60;return K+=ii(tzHrs)+":"+ii(tzMin),f=f.replace(/(^|[^\\])K/g,"$1"+K)},Date.prototype.diffTo=function(t,d2){var d1=this;return d2=d2||new Date,"days"==t?parseInt((d2.getTime()-d1.getTime())/864e5,10):"month"==t?d2.getMonth()-d1.getMonth()+12*(d2.getFullYear()-d1.getFullYear()):"year"==t?d2.getFullYear()-d1.getFullYear():void 0};var ZCALaddListener=document.addEventListener?function(_ele,event,_handle,bble){"mousewheel"==event&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(event="DOMMouseScroll"),_ele.addEventListener(event,_handle,Boolean(bble))}:function(_ele,event,_handle){_ele.attachEvent("on"+event,_handle)},ZCALremoveListener=document.removeEventListener?function(_ele,event,_handle,bble){"mousewheel"==event&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(event="DOMMouseScroll"),_ele.removeEventListener(event,_handle,Boolean(bble))}:function(_ele,event,_handle){_ele.removeEventListener("on"+event,_handle)},ZCALprevDef=function(ev){ev=ev||event,ev.stopPropagation?(ev.preventDefault(),ev.stopPropagation()):(ev.cancelBubble=!0,ev.returnValue=!1)};ZCALcrtesel=function(field,start,end){if(field.createTextRange){field.focus();var selRange=field.createTextRange();selRange.collapse(!0),selRange.moveStart("character",start),selRange.moveEnd("character",end-start),selRange.select()}else field.setSelectionRange?(field.focus(),field.setSelectionRange(start,end)):"undefined"!=typeof field.selectionStart&&(field.focus(),field.selectionStart=start,field.selectionEnd=end);return start},ZCALselstart=function(o){if(document.selection){var r=document.selection.createRange().duplicate();return r.moveEnd("character",o.value.length),""==r.text?o.value.length:o.value.lastIndexOf(r.text)}return o.selectionStart},ZCALselend=function(o){if(document.selection){var r=document.selection.createRange().duplicate();return r.moveStart("character",-o.value.length),r.text.length}return o.selectionEnd},ZCALchangeMonth=function(dte,i){var tmp=new Date(dte.getFullYear(),dte.getMonth()+i,1),d1=dte.getDate(),d2=new Date(tmp.getFullYear(),tmp.getMonth()+1,0).getDate();return tmp.setDate(d2>=d1?d1:d2),tmp},zcal.stck=[],zcal.keyCtrl=function(ev){var obj=zcal.NN6?ev.target:ev.srcElement,keyCode=ev.which||ev.keyCode;return 27==keyCode?void zcal.preclr(ev):void("INPUT"!=obj.tagName&&"TEXTAREA"!=obj.tagName&&document.removeEventListener("keydown",zcal.keyCtrl))},zcal.movView=function(n,e){ZCL_clrStck(e),ZCL_TY=n,ZCL_gridView()},zcal.preclr=function(e){"c"==zmApp.currentApp&&(-1!=zcal.stck.toString().indexOf("zcl_repstat")||-1!=zcal.stck.toString().indexOf("zcl_attStat")?zcalView.constGridView():ZCL_clrStck(),null!=e&&ZCL_stopEvents(e))},ZCL_clrStck1=function(e){if(-1==zcal.stck.toString().indexOf("newEve")){for(var i=0;i<zcal.stck.length;i++)zcal.$(zcal.stck[i])&&(zcal.$(zcal.stck[i]).style.display="none");zcal.stck=new Array,null!=e&&ZCL_stopEvents(e)}},ZCL_EClrStck=function(){zcal.EOBJ=null,zcal.EMODE=0,zmsuite.isWorkspaceAvailable("zcal_eContainer")&&zmsuite.closeWorkspace("zcal_eContainer"),ZCL_clrStck()},ZCL_clrStck=function(e){for(var i=0;i<zcal.stck.length;i++)ZCL_$(zcal.stck[i])&&(ZCL_$(zcal.stck[i]).style.display="none");if(zcal.stck=[],zcal.$("zcl_action")){var _actbtn=zcal.$("zcl_action").getElementsByTagName("b")[0];_actbtn.className=""}null!=e&&ZCL_stopEvents(e)},zcal.adStck=function(arr){zcal.stck=zcal.stck.concat(arr)},zcal.CAStck=function(arr){ZCL_clrStck(),zcal.adStck(arr)},ZCL_mdownClr=function(ev){if("c"==zmApp.currentApp){var qBk,qVw,smAdd,timeEle,_tarEle=ev.target||ev.srcElement;if(qBk=ZCL_$("zcl_qbk"),qVw=ZCL_$("zcl_qview"),smAdd=ZCL_$("zcl_smAdd"),timeEle=$(".zcal_cn"),qBk&&qBk.contains(_tarEle)||qVw&&qVw.contains(_tarEle)||smAdd&&smAdd.contains(_tarEle)||timeEle.length>0)return!1;ZCL_clrStck(),document.removeEventListener("mousedown",ZCL_mdownClr)}};var zcalTemplate=function(){var template={};return template.popupCreateEvent=function(obj){var tStr='<div class="SC_PUcen">';return tStr+='<div><div class="zcl_adev">',tStr+='<div class="zcl_adevtt"><textarea id="zcl_ppce_tit" placeholder="'+zcal.i18n.popup_eventtitle+'">'+obj.sum+"</textarea></div>",tStr+='<ul class="zcl_frmrw zcl_adetim"><li id="zcl_ce_timdv"><input type="text" readonly="" id="zcl_ce_sd" class="zcl_w137 SC_tiput" value="'+obj.sd+'"></li><li id="zcl_ce_stpar"><input type="text" id="zcl_ce_st" class="zcl_w136 SC_tiput" value="'+obj.st+'"></li><li class="zcl_tmto">to</li><li id="zcl_ce_edpar"><input type="text" readonly="" id="zcl_ce_ed" class="zcl_w137 SC_tiput" value="'+obj.ed+'"></li><li id="zcl_ce_etpar"><input type="text" id="zcl_ce_et" class="zcl_w136 SC_tiput" value="'+obj.et+'"></li></ul>',tStr+='<ul class="zcl_frmrw zcl_adall"><li class="zcl_curpt"><i id="zcl_ce_aday" class="msi-uncheck"></i>'+zcal.i18n.allday+"</li></ul>",tStr+='<ul class="zcl_frmrw zcl_rem">'+obj.reminder+"</ul>",tStr+='<ul class="zcl_frmrw"><li><u>'+zcal.i18n.loc+'</u><input type="text" value="" id="zcl_ce_loc" class="zcl_adelk SC_tiput"></li><li><u>'+zcal.i18n.calendar+'</u><div class="SC_select zcl_adecl"><input rel="'+zcal.cdata.defcal+'" value="'+zcal.cdata.calLst[zcal.cdata.defcal][0]+'" readonly type="text" id="zcl_ce_cal"></div></li></ul>',tStr+='<textarea id="zcl_ce_desc" class="SC_tiput" placeholder="'+zcal.i18n.description+'">'+obj.desc+"</textarea>",tStr+="</div></div>",tStr+="</div>"},template.popupCreateCal=function(cObj){var cStr='<div class="zcl_addcalcn" style="width: 500px;" id="zcl_ad">';return cStr+="<ul>",cStr+='<li class="zcl_CMS"><ul class="zcl_addcal" style="padding-left: 40px;"><li><input type="hidden" id="zcl_calid" value="'+(cObj.id?cObj.id:"")+'"/><input type="hidden" id="zcl_calgid" value="'+(cObj.gId?cObj.gId:"")+'"><input type="text" class="SC_tiput" placeholder="'+zcal.i18n.calname+'" value="'+(cObj.name?ZCL_getHTML(cObj.name):"")+'" id="zcl_calname"></li>',cStr+='<li><textarea style="" placeholder="Description" id="zcl_caldesc" class="SC_tiput">'+(cObj.desc?cObj.desc:"")+"</textarea></li>",cStr+='<li class="zcl_calcol" id="zcl_calcol"><div class="zcl_addcaltx"><b>Calendar color</b></div>'+zcal.calColorSel(cObj.color)+"</li>",cStr+='<li id="zcl_txtcol"><div class="zcl_addcaltx"><b>Text color</b><div><u  data-marker ="textColor"><i class="'+(0==cObj.txtcolor?"msi-option":"msi-unoption")+'"></i><u class="">White</u></u><u data-marker ="textColor"><i class="'+(1==cObj.txtcolor?"msi-option":"msi-unoption")+'"></i><u class="">Black</u></u></div></div></li>',cStr+='<li><div class="SC_PUbtm"><span rel="enable" onclick="ZCL_addCal(event)">Save</span><span  data-val="Cancel" onclick="ZCL_adcClose()">Cancel</span></div></li>',cStr+="</ul>",cStr+="</div>"},template.popupCreateSecdown=function(){var secStr="<ul>";return secStr+='<li class="zcl_CMS">',secStr+='<ul class="zcl_addcal">',secStr+="<li>",secStr+='<div class="zcl_addcaltx"><b>Password</b></div>',secStr+='<input type="password" class="SC_tiput" value="" id="zcl_pwd">',secStr+="</li>",secStr+="<li>",secStr+='<div class="zcl_addcaltx"><b>Retype Password</b></div>',secStr+='<input type="password" class="SC_tiput" value="" id="zcl_repwd">',secStr+="</li>",secStr+='<ul class="tempFormList zmErrClr" id="zcl_pwd_er" style="display:none">',secStr+='<li><i class="msi-fail zmDoubleIcon"></i>Length greater than 8 characters</li>',secStr+='<li><i class="msi-fail zmDoubleIcon"></i>Upper case character</li>',secStr+='<li><i class="msi-fail zmDoubleIcon"></i>Lower case character</li>',secStr+='<li><i class="msi-fail zmDoubleIcon"></i>Numeric character</li>',secStr+='<li><i class="msi-fail zmDoubleIcon"></i>Special character ( #, ?, !, @, $, %, ^, &amp;, *, -)</li>',secStr+="</ul>",secStr+='<ul class="tempFormList zmErrClr" id="zcl_repwd_er" style="display:none">',secStr+='<li><i class="msi-fail zmDoubleIcon"></i>Retype your password</li>',secStr+="</ul>",secStr+='<ul class="tempFormList zmErrClr" id="zcl_repeqwd_er" style="display:none">',secStr+='<li><i class="msi-fail zmDoubleIcon"></i>Password mismatch</li>',secStr+="</ul>",secStr+='<div class="zcl_addcaltx" id="zcl_pwdcon"><b>Use 8 characters or more with a mix of upper,lower case letters, number and symbols </b></div>',secStr+='<div class="zmInfoBox">',secStr+="<b>Note: </b>The password is not saved and hence the file cannot be recovered if the password is forgotten. Password is case-sensitive.</div>",secStr+="</ul>",secStr+="</li>",secStr+="</ul>"},template.popupCreateGrpCal=function(cObj){var type="Edit Group Calendar"==cObj.title?"edit":"add",gcalStr='<div class="zcl_table zcl_H100">';return gcalStr+="<ul>",gcalStr+='<li class="zcl_CMS">',gcalStr+='<div class="zcl_addcalcn" style="width:500px">',gcalStr+='<ul class="zcl_addcal" style="padding-left: 40px;">',gcalStr+="<li>",gcalStr+='<input type="hidden" id="zcl_calid" value="'+(cObj.id?cObj.id:"")+'">',gcalStr+='<input type="hidden" id="zcl_calgid" value="'+(cObj.gId?cObj.gId:"")+'">',gcalStr+='<div class="zcl_addcaltx"><span id="zcl_ad_ti_er" style="display:none;" class="zcl_ad_cl_er_ms">Provide a name for the group</span></div>',gcalStr+='<input type="text" class="SC_tiput" placeholder="'+zcal.i18n.grpplaceholder+'" value="'+(cObj.name?ZCL_getHTML(cObj.name):"")+'" id="zcl_grpcalname"  onfocusout='+("edit"==type?"ZCL_addGrpCal(event,'"+type+"')":"")+" >",gcalStr+="</li>",gcalStr+='<li class="zcl_calcol" id="zcl_calcol"><div class="zcl_addcaltx"><b>Calendar color</b></div>'+zcal.calColorSel(cObj.color,type)+"</li>",gcalStr+='<li id="zcl_txtcol">',gcalStr+='<div class="zcl_addcaltx"><b>Text color</b><div><u data-marker ="textColor"><i class="'+(0==cObj.txtcolor?"msi-option":"msi-unoption")+'"></i><u class="">White</u></u><u data-marker ="textColor"><i class="'+(1==cObj.txtcolor?"msi-option":"msi-unoption")+'"></i><u class="">Black</u></u></div></div>',gcalStr+="</li>",cObj.members||(gcalStr+="<li>",gcalStr+='<div class="zcl_addcaltx"><span id="zcl_ad_att_er" style="display:none;" class="zcl_ad_cl_er_ms">Add at least one member to create the group calendar</span></div>',gcalStr+='<div class="zcl_ad_gr_m" id="zcl_addGrpdiv"><input type="text" id="zcl_addGrpMem" placeholder="'+zcal.i18n.grpaddplaceholder+'"><ul id="zcl_grpMemlist" style="white-space:normal"></ul></div>',gcalStr+="</li>"),gcalStr+="<li>",gcalStr+='<div class="zcl_addcaltx"><span id="zcl_ad_desc_er" style="display:none;" class="zcl_ad_cl_er_ms">Group Description cannot be more than 200 characters</span></div>',gcalStr+='<textarea style="margin-top: 0;" placeholder="'+zcal.i18n.grpdesplaceholder+'" id="zcl_calgrpdesc"  class="SC_tiput">'+(cObj.desc?cObj.desc:"")+"</textarea>",gcalStr+="</li>","add"==type&&(gcalStr+='<li><div class="SC_PUbtm"><span rel="enable" onclick="ZCL_addGrpCal(event,\''+type+'\')">Save</span><span  data-val="Cancel" onclick="ZCL_grpClose()">Cancel</span></div></li>'),gcalStr+="</ul>",gcalStr+="</div>",gcalStr+="</li>",gcalStr+="</ul>",gcalStr+="<div>"},template.popupChatlet=function(eObj){var dt=new Date,hr=0==dt.getHours()?12:dt.getHours(),ap=hr>12?"pm":"am",hr=hr>12?hr-12:hr,chDate=hr+":"+dt.getMinutes()+" "+ap,ctStr='<div class="SC_PUcen zmChatlet" style="">';if(ctStr+='<div style="width:400px">',ctStr+='<div class="SC_floatLabel flBox flFLabel zm_title">',ctStr+='<input value="'+eObj.SUM+",Chat&nbsp@"+chDate+'" id="zcl_chTit" type="text"  maxlength="50">',ctStr+="<label>Title</label>",ctStr+="</div>",ctStr+='<div class="addInvList">',eObj.ATT){ctStr+='<div  id="attDiv" class="addInv SC_floatLabel flFLabel clearfix flBox addUsers autoFilldata">';for(var i in eObj.ATT.USR)for(var j in eObj.ATT.USR[i])eObj.ATT.USR[i][j].ZUID!=zmail.zuid&&(ctStr+='<div id="att" class="SC_cs myInv dFill" data-zid='+eObj.ATT.USR[i][j].ZUID+' title="'+eObj.ATT.USR[i][j].AID+'">',ctStr+='<div class="SC_avtr">',ctStr+='<img src="'+eObj.ATT.USR[i][j].PHOTO+'">',ctStr+="</div>",ctStr+="<span>"+eObj.ATT.USR[i][j].AID+"</span>",ctStr+='<i class="msi-close closePopup prevB"></i>',ctStr+="</div>");ctStr+='<input id="atInp" type="text" class="zm_sgst"><label>Participants</label><i class="msi-plus SC_thm borderPlus " id="attAdd"></i></div>'}else ctStr+='<div id="attDiv" class="addInv SC_floatLabel flFLabel clearfix flBox addUsers autoFilldata edit_parti">',ctStr+='<input  id="atInp" type="text" class="zm_sgst"><label>Participants</label></div>';return ctStr+="</div>",ctStr+="</div>",ctStr+="</div>",ctStr+="</div>"},template.popupSmartAdd=function(){var saStr='<li class="zcl_qttl"></li><li class="zcl_table"><ul><li><input type="text" id="zcl_smaddtxt" placeholder="e.g. Client Breakfast at 10 am"></li><li><b onclick="ZCL_openSAddHelp()"><i class="msi-faq"></i></b></li></ul></li>';return saStr+='<li style="display:none" id="zcl_saddhelp">',saStr+='<p>To schedule an event for having breakfast with a client at 9 am, simply type "Client Breakfast at 9 am".</p>',saStr+="<h1>Dates,</h1><span>Team treat on Friday</span><span>Suganthi birthday Aug 15</span><span>Mehna BirthDay 8/15</span>",saStr+="<h1>Dates and Times,</h1><span>Leads meet 07/01/2008 10am-12pm</span><span>Meeting 08/01/2008 11:30 am</span>",saStr+="<h1>Multiple Days,</h1><span>Vacation Aug 3 - Aug 15</span><span>Conference in London 8/10 - 8/25</span>",saStr+="</li>"},template.OutlookPopup=function(){var olStr='<div class="SC_PUcen zcl_ovr" style="max-height: 551px;">';return olStr+='<ul class="SC_cal_groups">',olStr+='<li><div id="zcl_olbtn" class="zm_comp"><a title="'+ZCL_replaceComName(zcal.i18n.outlooktitle64)+'" href="'+zcal.OUTLOOK64+'" class="SC_lnk"><span>Download</span><span><i class="msi-download"></i></span></a></div><span>'+ZCL_replaceComName(zcal.i18n.outlooktitle64)+"<s>Beta</s></span><em>("+ZCL_replaceComName(zcal.i18n.outlooksubtitle64)+")</em></li>",olStr+='<li><div class="zm_comp" id="zcl_olbtn"><a class="SC_lnk" href="'+zcal.OUTLOOK32+'" title="'+ZCL_replaceComName(zcal.i18n.outlooktitle32)+'"><span>Download</span><span><i class="msi-download"></i></span></a></div><span>'+ZCL_replaceComName(zcal.i18n.outlooktitle32)+"<s>Beta</s></span><em>("+ZCL_replaceComName(zcal.i18n.outlooksubtitle32)+")</em></li>",olStr+="</ul>",olStr+="<p>"+zcal.i18n.mshelp+"</p>",olStr+="</div>"},template.calDetials=function(calId,cObj){var calName=ZCL_getHTML(cObj[0]),calKey=cObj[9],tZone=zcal.cdata.opt.TIM,reqScheme=location.protocol,embedURL='<iframe src="'+reqScheme+"//"+zcal.ZCAL+(""==cObj[14]||"gcal"==cObj[14]?"":"/"+cObj[14])+"/embed/"+calKey+"?title="+calName+"&type=1&l=en&tz="+tZone+'&sh=[1,1]&v=0" width="600" height="500" frameborder="0" scroll="auto"></iframe>',dtStr='<div class="conditionDiv">';return dtStr+='<div class="zmL">',dtStr+='<div class="SC_srch shw">',dtStr+='<table class="condition">',dtStr+='<tr><td class="gbld">'+zcal.i18n.calname+"</td></tr>",dtStr+='<tr><td><table><tr><td width="29%"><span>'+calName+"</span></td></tr></table></td></tr>",dtStr+="</table>",dtStr+="</div>",dtStr+="</div>",dtStr+='<div class="zmL">',dtStr+='<div class="SC_srch shw">',dtStr+='<table class="condition">',dtStr+='<tr><td class="gbld">'+zcal.i18n.calendarid+"</td></tr>",dtStr+='<tr><td><table><tr><td width="29%"><span>'+calKey+"</span></td></tr></table></td></tr>",dtStr+="</table>",dtStr+="</div>",dtStr+="</div>",dtStr+='<div class="zmL">',dtStr+='<div class="SC_srch shw">',dtStr+='<table class="condition">',dtStr+='<tr><td class="gbld">'+zcal.i18n.embedurl+"</td></tr>",dtStr+='<tr><td><table><tr><td width="29%"><textarea type="text" class="zcl_Stxt">'+embedURL+'</textarea><span class="zcl_lk" data-marker="embedMore">'+zcal.i18n.moretemplates+"</span></td></tr></table></td></tr>",dtStr+="</table>",dtStr+="</div>",dtStr+="</div>",dtStr+='<div class="zmL">',dtStr+='<h2 class="recom_conditionHeading">'+zcal.i18n.reminder+"</h2>",dtStr+='<ul class="zcl_rem">',dtStr+='<li data-marker="calReminder"></li>',dtStr+="</ul>",dtStr+="</div>",dtStr+='<span class="mLnone" data-marker="markAsBusy"><i class="msi-check"></i><span class="pl5">'+zcal.i18n.markasbusy_cal+"</span></span>",dtStr+='<span class="mLnone" data-marker="dlgInvNtfy"><i class="msi-check"></i><span class="pl5">'+zcal.i18n.dlg_Inv_Notify+"</span></span>",dtStr+="</div>",dtStr+='<div class="SC_PUbtm"><span class="sel" data-marker="detailSave">'+zcal.i18n.save+'</span><span data-val="Cancel">'+zcal.i18n.cancel+"</span></div>"},template.calShare=function(){var shStr='<div class="conditionDiv">';return shStr+='<div data-marker="loadingAnimation"></div>',shStr+='<div data-marker="publicShare"></div>',shStr+='<div data-marker="privateAddress"></div>',shStr+='<div data-marker="indShare"></div>',shStr+='<div class="zcl_Sshlst" data-marker="sharedList"></div>',shStr+="</div>",shStr+='<div class="SC_PUbtm"><span data-val="Cancel">'+zcal.i18n.close+"</span></div>"},template.calEmbed=function(){var emStr="";return emStr+='<div class="SC_set SC_filt_bottom">',emStr+='<div class="zcl_Semdtmp" data-marker="embedTpl"/>',emStr+='<div class="conditionDiv">',emStr+='<table class="zcl_Semdsp"><tr>',emStr+='<td data-marker="embedTplImg"></td>',emStr+="<td>",emStr+='<div data-marker="embedTitleSec"></div>',emStr+="</td>",emStr+="<td>",emStr+='<div data-marker="embedTZSec"></div>',emStr+="</td>",emStr+="</tr></table>",emStr+="</div>",emStr+='<div class="zmL"><div class="SC_srch shw">',emStr+='<table class="condition">',emStr+='<tr><td class="gbld">'+zcal.i18n.embed_instruction+"</td></tr>",emStr+="<tr><td><table>",emStr+='<tr><td data-marker="embedCode"></td></tr>',emStr+="</table></td></tr>",emStr+="</table>",emStr+="</div></div>",emStr+="</div>"},template.invitationview=function(conObj){var ht="";ht='<table cellspacing="0px" cellpadding="0px"  width="100%" style="_width:97%;border:1px solid #e7e7e7;display:table;table-layout:fixed">',ht+="<tr>",ht+='<td colspan="2">',ht+='<table cellspacing="0px" cellpadding="0px" width="100%" style="font:normal 11px Verdana,arial,Helvetica,sans-serif;color:#333333;border:1px solid #ffffff;display:table;table-layout:fixed">',ht+='<tr bgcolor="#fafafa">',ht+="<td>",ht+='<table cellspacing="0px" cellpadding="0px" style="font:normal 11px Verdana,arial,Helvetica,sans-serif;color:#333333;float:left">',ht+="<tr>",ht+='<td background="$IMG_INV$" width="46px" height="52"></td>',ht+='<td style="padding-left:10px;color:#000000;height:52px"><a href="mailto:'+zcal.cdata.opt.MID+'">'+zcal.cdata.opt.MID+"</a> <br/><b>Invites you</b></td>",ht+="</tr>",ht+="</table>",ht+="</td>",ht+="</tr>",ht+="<tr>",ht+='<td width="100%">',ht+='<table cellspacing="0px" cellpadding="0px" width="100%" style="background-color:#ffffff;padding:1px">',ht+="<tr>",ht+="<td>",ht+='<table cellspacing="0px" cellpadding="5px" width="100%" style="font:normal 11px Verdana,arial,Helvetica,sans-serif;line-height:18px;color:#333333;border-collapse:collapse;word-wrap:break-word;table-layout:fixed">',ht+="<tr>",ht+='<td width="100px" style="font-weight:bold;border-bottom:1px solid #f4f4f4;vertical-align:top">'+zcal.i18n.title+"</td>",ht+='<td style="border-bottom:1px solid #f4f4f4;vertical-align:top">'+conObj.title+"</td>",ht+="</tr>",ht+="<tr>",ht+='<td style="font-weight:bold;border-bottom:1px solid #f4f4f4;vertical-align:top">Date</td>',ht+='<td style="border-bottom:1px solid #f4f4f4;vertical-align:top">On '+conObj.date+"</td>",ht+="</tr>",ht+="<tr>",ht+='<td style="font-weight:bold;border-bottom:1px solid #f4f4f4;vertical-align:top">Attendees</td>',ht+='<td style="border-bottom:1px solid #f4f4f4;vertical-align:top"><span style="pointer:cursor;color:#878787;">';for(var i in conObj.att)ht+='<a href="mailto:'+conObj.att[i]+'">'+conObj.att[i]+"</a>,";return ht+="</span></td>",ht+="</tr>",ht+="</table>",ht+="</td>",ht+="</tr>",ht+="</table>",ht+="</td>",ht+="</tr>",ht+="</table>",ht+="</td>",ht+="</tr>",ht+="</table>"},template}();zcal.TTT=["12:00 am","12:30 am","1:00 am","1:30 am","2:00 am","2:30 am","3:00 am","3:30 am","4:00 am","4:30 am","5:00 am","5:30 am","6:00 am","6:30 am","7:00 am","7:30 am","8:00 am","8:30 am","9:00 am","9:30 am","10:00 am","10:30 am","11:00 am","11:30 am","12:00 pm","12:30 pm","1:00 pm","1:30 pm","2:00 pm","2:30 pm","3:00 pm","3:30 pm","4:00 pm","4:30 pm","5:00 pm","5:30 pm","6:00 pm","6:30 pm","7:00 pm","7:30 pm","8:00 pm","8:30 pm","9:00 pm","9:30 pm","10:00 pm","10:30 pm","11:00 pm","11:30 pm"],zcal.TT=["12 am","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am","9 am","10 am","11 am","12 pm","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm"];var ZCL_REMSTR=[],ZCL_REM=["300000","600000","900000","1200000","1500000","1800000","2700000","3600000","7200000","14400000","21600000","28800000","43200000","86400000","172800000","259200000","345600000","432000000","518400000","604800000","691200000","777600000","864000000","950400000","1036800000","1123200000","1209600000","1296000000","2592000000","3888000000","5184000000","7776000000"];zcal.OBJTEMP;var ZCL_SERVICE="";zcal.MSPERMINUTE=6e4,zcal.MSPERHOUR=36e5,zcal.TF=["hh:mm a","HH:mm"],zcal.EOBJ=null,zcal.EMODE=0,zcal.CAL_IND=0;var ZCL_NTFY_ATT=-1,ZCL_OLD_COBJ,ZCL_AttachSize,ZCL_AttachCount,ZCL_AttachElement=[];ZCL_hdnFld=function(id,val){return'<input type="hidden" id="'+id+'" value="'+val+'"/>'},ZCL_SetEventHiddenFlds=function(calObj){var ekey,eid,ridx,repinst,calId,eperm,dperm,rto;return ekey=zcal.EOBJ.EUID?zcal.EOBJ.EUID:"",eid=zcal.EOBJ.EID?zcal.EOBJ.EID:"",ridx=zcal.EOBJ.RIDX?zcal.EOBJ.RIDX:"",repinst=zcal.EOBJ.REPINST?zcal.EOBJ.REPINST:"",calId=zcal.EOBJ.CNAME?zcal.EOBJ.CNAME:"",eperm=zcal.EOBJ.EPERM?zcal.EOBJ.EPERM:"",dperm=zcal.EOBJ.DPERM?zcal.EOBJ.DPERM:"",rto=zcal.EOBJ.RTO?zcal.EOBJ.RTO:"",txt=ZCL_hdnFld("zcl_ce_mode",zcal.EMODE)+ZCL_hdnFld("zcl_eid",eid)+ZCL_hdnFld("zcl_rmvatt","")+ZCL_hdnFld("zcl_ekey",ekey)+ZCL_hdnFld("zcl_ridx",ridx)+ZCL_hdnFld("zcl_repinst",repinst)+ZCL_hdnFld("zcl_crel",calId)+ZCL_hdnFld("zcl_eperm",eperm)+ZCL_hdnFld("zcl_dperm",dperm)+ZCL_hdnFld("zcl_oldCkey",calObj[9])+ZCL_hdnFld("zcl_rtoval",rto)+ZCL_hdnFld("zcl_rmvgatt","")+ZCL_hdnFld("zcl_ce_isrep","false")+ZCL_hdnFld("zcl_skey",zcal.EOBJ.SKEY?zcal.EOBJ.SKEY:"")},ZCL_SetAplReq=function(){var txt='<ul class="zcl_frmrw">';return 0==zcal.EMODE?zcal.EOBJ.APL_REQ&&"1"==zcal.EOBJ.APL_REQ&&(txt+='<div style="display: inline-block;color:red;"><i class="msi-spam" style="color:red"></i> '+zcal.i18n.waitingforapproval+"</div>"):zcal.EOBJ.APL_REQ&&"1"==zcal.EOBJ.APL_REQ&&(txt+='<div style="display: inline-block;color:red;"><i class="msi-spam" style="color:red"></i> '+zcal.i18n.waitingforapproval+"</div>"),txt+="</ul>"},ZCL_SetEventTtl=function(){var val,txt='<ul class="zcl_frmrw">';return 0==zcal.EMODE?(val=zcal.EOBJ.SUM?ZCL_getHTML(zcal.EOBJ.SUM):"",txt+='<li class="zcl_evttvw">'+val+"</li>"):(val=zcal.EOBJ.SUM?ZCL_getHTML(zcal.EOBJ.SUM):"",txt+='<li class="zcl_W70pc">',txt+='<input type="text" placeholder="Untitled event" class="zcl_crevntt SC_tiput" value="'+val+'" id="zcl_ce_tit">',txt+="</li>",txt+='<li class="zcl_curpt" onclick="ZCL_ChgChk(this)"><i class="'+(zcal.EOBJ.CLASS&&1==zcal.EOBJ.CLASS?"msi-check":"msi-uncheck")+'" id="zcl_ce_pvt"></i>'+zcal.i18n.eprivate+"</li>"),txt+="</ul>"},ZCL_SetEventCal=function(){var txt="";if(0==zcal.EMODE)txt+='<ul class="zcl_frmrw"><li><u>'+zcal.i18n.calendar+"</u><span>"+ZCL_GetCalName(zcal.EOBJ.CNAME)+"</span></li></ul>";else{var defCal=zcal.cdata.calLst[zcal.EOBJ.CNAME]||zcal.cdata.calGLst[zcal.EOBJ.CNAME]||zcal.cdata.calALst[zcal.EOBJ.CNAME]||zcal.cdata.calOLst[zcal.EOBJ.CNAME];txt+="<li><u>"+zcal.i18n.calendar+'</u><div class="SC_select" ><input rel="'+zcal.EOBJ.CNAME+'" value="'+ZCL_getHTML(defCal[0])+'" id="zcl_ce_cal" type="text" style="width:212px" readonly></div></li>'}return txt},ZCL_SetEventSchTime=function(){var ttemp=zcal.timeformat[zcal.cdata.opt.TF],aday=zcal.EOBJ.ADAY&&1==zcal.EOBJ.ADAY?!0:!1,sd=zcal.EOBJ.SD,ed=zcal.EOBJ.ED,st=aday?"8:00 am":zcal.EOBJ.ST,et=aday?"8:30 am":zcal.EOBJ.ET,tim1=st.getTimeBy(ttemp),tim2=et.getTimeBy(ttemp),de1=ZCL_splitDateVal(ZCL_putDate(sd)),de2=ZCL_splitDateVal(ZCL_putDate(ed)),ParST=ZCL_parseTime(tim1),ParET=ZCL_parseTime(tim2);if(ZCL_ESDATE=new Date(de1[2],de1[1]-1,de1[0],ParST.HH,ParST.mm,0,0),ZCL_EEDATE=new Date(de2[2],de2[1]-1,de2[0],ParET.HH,ParET.mm,0,0),zcal.EOBJ.rObj=new zcalRepeat,zcal.EOBJ.rObj.init(ZCL_ESDATE),0==zcal.EMODE){var txt='<ul class="zcl_frmrw"><li>',dat1=ZCL_parseDateStr(sd),dat2=ZCL_parseDateStr(ed);return txt+=dat1.dateBy("MMM dd, yyyy"),aday?txt+=sd!=ed?" - "+dat2.dateBy("MMM dd, yyyy"):"":(txt+=sd!=ed?", "+tim1+" - "+dat2.dateBy("MMM dd, yyyy")+", "+tim2:", "+tim1+" - "+tim2,txt+=zcal.EOBJ.ETZ?'&nbsp;<span class="zcl_greymr">'+zcal.EOBJ.ETZ+"</span>":""),txt+="</li></ul>"}var ad_css=aday?'style="display:none"':"",eTz=zcal.EOBJ.ETZ?zcal.EOBJ.ETZ:zcal.cdata.opt.TIM,dispInETZ=zcal.EOBJ.IN_ETZ&&1==zcal.EOBJ.IN_ETZ?!0:!1,txt='<ul class="zcl_frmrw zcl_when"><li class="zcl_select" id="zcl_ce_timdv"><input class="zcl_w100 SC_tiput" type="text" value="'+ZCL_putDate(sd)+'" id="zcl_ce_sd" readonly /></li>&nbsp;&nbsp;<li class="zcl_select" '+ad_css+' id="zcl_ce_stpar"><input class="zcl_w70 SC_tiput" type="text" id="zcl_ce_st" value="'+tim1+'"/></li><li class="zcl_tmto">to</li><li class="zcl_select" id="zcl_ce_edpar"><input class="zcl_w100 SC_tiput" type="text" value="'+ZCL_putDate(ed)+'" id="zcl_ce_ed" readonly /></li>&nbsp;&nbsp;<li class="zcl_select" '+ad_css+' id="zcl_ce_etpar"><input class="zcl_w70 SC_tiput" type="text" id="zcl_ce_et" value="'+tim2+'"/></li><li '+ad_css+'><span class="zcl_lk zcl_cetmz" id="zcl_ce_tza">'+eTz+"</span></li></ul>";return!aday&&zcal.EOBJ.ETZ&&(txt+='<ul class="zcl_frmrw zcl_when"><li class="zcl_curpt"><i class="'+(dispInETZ?"msi-check":"msi-uncheck")+'" id="zcl_ce_inetz"></i>'+ZCL_replaceString(zcal.i18n.display_in_etz,[eTz])+"</li></ul>"),txt},ZCL_SetAllDayRepeatSec=function(){var _reptxt="";zcal.EOBJ.REP&&(zcal.EOBJ.rObj.update(zcal.EOBJ.REP),_reptxt=zcal.EOBJ.rObj.getStr());var txt='<ul class="zcl_frmrw"><li class="zcl_curpt"><i class="'+(zcal.EOBJ.ADAY&&1==zcal.EOBJ.ADAY?"msi-check":"msi-uncheck")+'" id="zcl_ce_aday"></i>'+zcal.i18n.allday+"</li>";return txt+=zcal.EOBJ.RBRK&&1==zcal.EOBJ.RBRK?"":'<li id="zcl_rep" class="zcl_curpt" onclick="ZCL_chgeRepOpt(this, event)"><i class="'+(zcal.EOBJ.REP?"msi-check":"msi-uncheck")+'"></i>'+zcal.i18n.repeat+(""!=_reptxt?'<span class="zcl_lk" id="zcl_rep_span" onclick="ZCL_chgeRepOpt(this, event)">'+_reptxt+"</span>":"")+"</li>",txt+="</ul>"},ZCL_SetEventLoc=function(){var txt="",loc=zcal.EOBJ.LOC?ZCL_getHTML(zcal.EOBJ.LOC):"";return 0==zcal.EMODE?""!=loc&&(txt+='<ul class="zcl_frmrw"><li><u>'+zcal.i18n.loc+"</u><span>"+loc+"</span></li></ul>"):txt+="<li><u>"+zcal.i18n.loc+'</u><input type="text" class="zcl_crlk SC_tiput" id="zcl_ce_loc" value="'+loc+'"></li>',txt},ZCL_SetEventColor=function(){var txt="";return 0==zcal.EMODE?zcal.EOBJ.EC>-1&&(txt+='<ul class="zcl_frmrw"><li><u class="zcl_frmtt">'+zcal.i18n.eventcolor+"</u>",txt+='<ul class="zcl_cecolr"><li style="background-color:'+zcal.eventcolor[zcal.EOBJ.EC]+'"></li></ul>',txt+="</li></ul>"):txt+='<ul class="zcl_frmrw">'+ZCL_EventColorSel()+"</ul>",txt},ZCL_EventColorSel=function(){for(var txt='<li class="zcl_frmtt">'+zcal.i18n.eventcolor+'</li><li><ul class="zcl_cecolr" id=zcl_ce_color rel="'+(zcal.EOBJ.EC?zcal.EOBJ.EC:-1)+'">',i=0;i<zcal.eventcolor.length;i++){var defcol=zcal.EOBJ.EC==i?'class="zcl_sl"':"";txt+='<li id="zcl_ecolor'+i+'" rel='+i+' onclick="ZCL_EventColor(this)" style="background-color:'+zcal.eventcolor[i]+'" '+defcol+'><i class="msi-tick"></i></li>'}return txt+="</ul></li>"},ZCL_EventColor=function(ele){for(var divArr=zcal.$("zcl_ce_color").getElementsByTagName("li"),i=0;i<divArr.length;i++){var tmpEle=divArr[i];ele.id!="zcl_ecolor"+i&&(tmpEle.className="")}""==ele.className?(ele.className="zcl_sl",zcal.$("zcl_ce_color").setAttribute("rel",ele.getAttribute("rel"))):(ele.className="",zcal.$("zcl_ce_color").setAttribute("rel","-1"))},ZCL_SetEventAlrm=function(calObj){var remTxt="";if(0==zcal.EMODE||1==zcal.EMODE&&""!=calObj[14]){if(zcal.EOBJ.REMTY&&1==zcal.EOBJ.REMTY)remTxt+=ZCL_putAlarmForView(zcal.EOBJ.ALARM);else if(zcal.EOBJ.REMTY&&2==zcal.EOBJ.REMTY)remTxt+=ZCL_putCalAlarmForView(calObj[6]);else if(""!=calObj[14]){var calremTxt=ZCL_putCalAlarmForView(calObj[6]);remTxt+=""!=calremTxt?calremTxt:""}return 0==zcal.CALMODE&&0==zcal.EMODE&&1==zcal.EOBJ.EPERM&&(remTxt+=""==calObj[14]&&2!=calObj[5]?"<div "+(""!=remTxt?'style="padding-top:5px"':"")+'><a id="zcl_setrem" class="SC_lnk">'+zcal.i18n.setreminder+"</a></div>":""),""!=remTxt?'<ul class="zcl_frmrw zcl_rem"><li id="zcl_ce_rem"><u>'+zcal.i18n.reminder+"</u>"+remTxt+"</li></ul>":""}return remTxt+=1==zcal.EOBJ.REMTY&&zcal.EOBJ.ALARM?ZCL_putAlarm(zcal.EOBJ.ALARM):2==zcal.EOBJ.REMTY?ZCL_putCalAlarm(calObj[6]):ZCL_RemAddLnk(),'<ul class="zcl_frmrw zcl_rem"><li id="zcl_ce_rem">'+remTxt+"</li></ul>"},ZCL_getGrpInvPolicy=function(calObj){"group"===calObj[14]&&ZCL_uXHR("/cal/grpDtl.do?mode=grp-inv-policy&comid="+calObj[9],"ZCL_retGroupInvPolicy")},ZCL_retGroupInvPolicy=function(xml){var obj=ZCL_Evl(1,xml.responseText),invPolicy=obj.invPolicy,attEle=document.getElementById("zcl_evhelp"),dv=document.createElement("span");dv.style="white-space:normal",1==invPolicy?dv.innerHTML="0"==zcal.sendInv?zcal.i18n.orgPolicyNoAttNote:zcal.i18n.nonGrpMem:2==invPolicy&&(dv.innerHTML="0"==zcal.sendInv?zcal.i18n.orgPolicyNoAttNote:zcal.i18n.NonOrgMemCal),attEle.childNodes[1].remove(),attEle.append(dv)},ZCL_setGrpCalAlarm=function(calObj,isSet){var remTxt="";if(0==zcal.EMODE||1==zcal.EMODE&&""!=calObj[14]){if(zcal.EOBJ.REMTY&&1==zcal.EOBJ.REMTY)remTxt+=ZCL_putAlarmForView(zcal.EOBJ.ALARM);else if(zcal.EOBJ.REMTY&&2==zcal.EOBJ.REMTY)remTxt+=ZCL_putCalAlarmForView(calObj[6]);else if(""!=calObj[14]){var calremTxt=ZCL_putCalAlarmForView(calObj[6]);remTxt+=""!=calremTxt?calremTxt:""}0==zcal.CALMODE&&0==zcal.EMODE&&1==zcal.EOBJ.EPERM&&(remTxt+=""==calObj[14]&&2!=calObj[5]?"<div "+(""!=remTxt?'style="padding-top:5px"':"")+'><a id="zcl_setrem" class="SC_lnk">'+zcal.i18n.setreminder+"</a></div>":"")}else remTxt+=1==zcal.EOBJ.REMTY&&zcal.EOBJ.ALARM?ZCL_putAlarm(zcal.EOBJ.ALARM):2==zcal.EOBJ.REMTY?ZCL_putCalAlarm(calObj[6]):ZCL_RemAddLnk();if(!isSet)return remTxt;if(""==remTxt)ZCL_$("zcl_ce_rem")&&ZCL_$("zcl_ce_rem").parentNode.parentNode.removeChild(ZCL_$("zcl_ce_rem").parentNode);else if(ZCL_$("zcl_ce_rem"))ZCL_$("zcl_ce_rem").innerHTML=remTxt;else{var erep=document.createElement("div");erep.className="zcl_frm",erep.innerHTML='<ul class="zcl_frmrw zcl_rem"><li id="zcl_ce_rem"><u>'+zcal.i18n.reminder+'</u><div class="zcl_frmaln" id="zcl_ce_rem">'+remTxt+"</div></div>",ZCL_$("zcl_ce_ele").insertBefore(erep,ZCL_$("zcl_ce_ele").childNodes[6])}},ZCL_SetEventAttach=function(ty,cObj){ZCL_AttachSize=0,ZCL_AttachCount=0;var AttachTxt='<ul class="zcl_frmrw zcl_rem" style="display:'+(""==cObj[14]||"gcal"!=cObj[14]?"":"none")+'"><li id="zcl_ce_attach"><div class="'+(0==zcal.EMODE?"zmPAtt":"zmCAt")+'">';if(zcal.EOBJ.HAS_ATTACH&&zcal.EOBJ.ATTACH)for(var i=0;i<zcal.EOBJ.ATTACH.length;i++)AttachTxt+=ZCL_Getattachhtml(zcal.EOBJ.ATTACH[i],ty);return AttachTxt+="</div>",0!=zcal.EMODE&&0==ty&&(AttachTxt+='<input type="file" style="display:none" multiple id="AttachInput" onchange="ZCL_addAttach(event)"><ul id="zcl_addAttach"><li><span onclick=zcal.$("AttachInput").click()><i class="msi-add"></i>'+zcal.i18n.addattachment+"</span></li></ul>"),AttachTxt+="</li></ul>"},ZCL_addAttach=function(ev){for(var fileArr=ev.path?ev.path[0].files:ev.target.files,i=0;i<fileArr.length;i++){var fileName,formData=new FormData;fileName=fileArr[i].name;var restrictedFormat=/\b(ade|adp|bat|chm|cmd|com|cpl|exe|hta|ins|isp|jar|jse|lib|lnk|mde|msc|msp|mst|pif|scr|sct|shb|sys|vb|vbe|vbs|vxd|wsc|wsf|wsh)\b/gi,lastDotIndex=fileName.lastIndexOf("."),fileExtension="";lastDotIndex>0&&(fileExtension=fileName.substr(lastDotIndex+1,fileName.length)),fileExtension.match(restrictedFormat)?zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.attachpolicy,[fileName])):(formData.append("zcl_attachFile",fileArr[i]),fileSize=fileArr[i].size,ZCL_AttachSize+=fileArr[i].size,ZCL_AttachCount++,ZCL_SendFiletoProcess(formData,fileName,fileSize))}ZCL_$("AttachInput").value=""},ZCL_SendFiletoProcess=function(formData,fileName,fileSize){if(10485760>=ZCL_AttachSize){var id="loadfile"+ZCL_AttachCount,attachHtml=ZCL_Getattachhtml({name:fileName,size:fileSize,id:id},0);ZCL_$("zcl_ce_attach").childNodes[0].appendChild(attachHtml);var csr=ZCL_getCookie("aprmjrnpkcrkks");formData.append("mstpcrdhkur",csr);var xhttp=new XMLHttpRequest;xhttp.upload.addEventListener("progress",function(eve){ZCL_$(id)&&(ZCL_$(id).querySelector("div[id=progressbar]").style.width=eve.loaded/eve.total*100+"%")},!1),xhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var respJSON=this.responseText?JSON.parse(this.responseText):"";if(respJSON&&"success"==respJSON.status){if(ZCL_$(id)){var progressbarEl=ZCL_$(id).querySelector("div[id=progressbar]");progressbarEl.parentNode.removeChild(progressbarEl),ZCL_$(id).querySelector("div[id=attachMenu]").style.display="",ZCL_$(id).querySelector("div[id=attachSize]").style.display="",ZCL_$(id).setAttribute("rel",respJSON.fileId),ZCL_$(id).setAttribute("size",respJSON.size),ZCL_$(id).setAttribute("type",respJSON.contentType),ZCL_$(id).setAttribute("akey",respJSON.attachKey),ZCL_$(id).setAttribute("name",ZCL_encodeHTML(respJSON.fileName)),ZCL_$(id).setAttribute("preview",respJSON.preview),ZCL_$(id).id="fileAttachment"}}else ZCL_$(id)&&(ZCL_$(id).parentNode.removeChild(ZCL_$(id)),ZCL_AttachSize-=fileSize,ZCL_AttachCount--,zmUtil.succErrMsg("e",zcal.i18n.uploaderror))}else(400==this.status||500==this.status)&&ZCL_$(id)&&(ZCL_$(id).parentNode.removeChild(ZCL_$(id)),zmUtil.succErrMsg("e",zcal.i18n.uploaderror))},xhttp.open("POST","/mail/cal/addAttachment.do",!0),xhttp.send(formData)}else zmUtil.succErrMsg("e",zcal.i18n.maxlimit),ZCL_AttachSize-=fileSize,ZCL_AttachCount--},ZCL_PreviwAttach=function(el){ZCL_AttachElement=[];var fileArr=document.querySelectorAll("[id=fileAttachment]");window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));for(var i=0;i<fileArr.length;i++){var fObj={fn:fileArr[i].getAttribute("name"),ft:fileArr[i].getAttribute("type").match(/(image\/)/)?101:103,src:"true"==fileArr[i].getAttribute("preview")?"/mail/cal/attachment/preview/"+fileArr[i].getAttribute("akey")+"?frameorigin="+window.location.origin:"",fileId:fileArr[i].getAttribute("rel"),akey:fileArr[i].getAttribute("akey")};ZCL_AttachElement.push(fObj)}var element;element=el.className&&"zmImg"==el.className?el.parentNode.parentNode.parentNode:0==zcal.EMODE?el.parentNode.parentNode.parentNode.parentNode.parentNode:el.parentNode.parentNode.parentNode.parentNode;var idx=ZCL_getCurelIndex(element.getAttribute("rel"),1),ispreview=element.getAttribute("preview");if("true"==ispreview)if(idx>=0){var config={startIndex:idx,attObjList:ZCL_AttachElement,hideAllOptions:!0,ignoreThumb:!0};config.addIcons={download:{"class":"msi-download",title:zmText.get("attachmentUtility").prevMenu.downLoad,events:[{name:"click",listener:function(a,attachObj){var flname="/mail/cal/attachment/download/"+attachObj.akey;window.open(flname)}}]}},zmUtil.initAttSlideShow(config)}else zmUtil.succErrMsg("e",zcal.i18n.uploadprogress);else ZCL_getDownloadLink(el)},ZCL_GetFileSize=function(size){var OSName="";-1!=navigator.appVersion.indexOf("Win")&&(OSName="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(OSName="MacOS"),-1!=navigator.appVersion.indexOf("X11")&&(OSName="UNIX"),-1!=navigator.appVersion.indexOf("Linux")&&(OSName="Linux");var appty=parseInt("MacOS"==OSName?1e3:1024),sizes=["Bytes","KB","MB","GB","TB"];if(size>0)var i=parseInt(Math.floor(Math.log(size)/Math.log(appty))),fileSize=(size/Math.pow(appty,i)).toFixed(1)+" "+sizes[i];return fileSize},ZCL_rmvAttach=function(el){var attachdiv=el.parentNode.parentNode.parentNode.parentNode;ZCL_AttachSize-=attachdiv.getAttribute("size"),attachdiv.parentNode.removeChild(attachdiv),ZCL_AttachCount--},ZCL_Getattachhtml=function(obj,ty){var newattdiv,el="";if(0==ty){var fileClass=zmUtil.fileTyp(obj.name)[1];fileClass+=" zm-attIcn";var file_Name=ZCL_getHTML(obj.name);return obj.fileId?(ZCL_AttachSize+=parseInt(obj.size),ZCL_AttachCount++,el+='<div class="'+(0==zcal.EMODE?"zmL zmAch":"zmL SC_Pbar")+'" id="fileAttachment" data="'+obj.attachId+'" rel='+obj.fileId+' size="'+obj.size+'" type="'+obj.contentType+'" akey="'+obj.attachKey+'" name="'+file_Name+'" preview="'+obj.preview+'">'):(newattdiv=document.createElement("DIV"),newattdiv.className=0==zcal.EMODE?"zmL zmAch":"zmL SC_Pbar",newattdiv.id=obj.id),el+='<div class="zmLst">',el+='<div class="zmDtl">',el+='<div class="zmImg" onclick="ZCL_PreviwAttach(this)">',el+='<i class="'+(""!=fileClass?fileClass:"msi-attothers")+'"></i>',el+="</div>",el+='<div class="zmFrm">',el+='<span title="'+file_Name+'" data-msg="view">'+file_Name+"</span>",el+="</div>",el+='<div class="zmSub" id="attachMenu" style="display:'+(obj.fileId?"":"none")+'">',0==zcal.EMODE?(el+="<font>",el+='<i class="msi-download" title="'+zcal.i18n.download+'" onclick="ZCL_getDownloadLink(this)" data-msg="download"></i>',el+="</font>",obj.preview&&(el+="<font>",el+='<i class="msi-zoomin" title="'+zcal.i18n.view+'" onclick="ZCL_PreviwAttach(this)" data-msg="view"></i>',el+="</font>")):(el+='<span  onclick="ZCL_PreviwAttach(this)">'+zcal.i18n.preview+"</span>",el+='<span  onclick="ZCL_getDownloadLink(this)">'+zcal.i18n.download+"</span>"),el+="</div>",el+='<div class="zmSze" id="attachSize" style="display:'+(obj.fileId?"":"none")+'">',el+='<span class="sum">'+ZCL_GetFileSize(obj.size)+"</span>",el+="</div>",0!=zcal.EMODE&&(el+='<div class="SC_icn">',el+='<i class="msi-close" onclick="ZCL_rmvAttach(this)"></i>',el+="</div>",obj.fileId||(el+='<div class="zm_lbl zmProgBar">',el+='<div id="progressbar">',el+="</div>",el+="</div>")),el+="</div>",el+="</div>",obj.fileId&&(el+="</div>"),obj.fileId?el:(newattdiv.innerHTML=el,newattdiv)}return el="<p>"+ZCL_getHTML(obj.name)+"</p>"},ZCL_getCurelIndex=function(id,ty){for(var i=0;i<ZCL_AttachElement.length;i++){if(!id)return-1;if(ZCL_AttachElement[i].fileId==id){if(0==ty){ZCL_AttachElement.splice(i,1);break}return i}}},ZCL_getFileAttach=function(ty){var fileId="",fileArr=[],calId=$("#zcl_ce_cal")[0].getAttribute("rel"),cObj=zcal.getCalObj(calId);if(""==cObj[14]||"gcal"!=cObj[14]){if(zcal.$("fileAttachment")){var fileArr=document.querySelectorAll("[id=fileAttachment]");if("get"==ty)for(var i=0;i<fileArr.length;i++)fileArr[i].getAttribute("data")||(fileId+=""==fileId?fileArr[i].getAttribute("rel"):","+fileArr[i].getAttribute("rel"))}ZCL_AttachCount=0,ZCL_AttachSize=0}return"get"==ty?fileId:fileArr.length>0?!0:!1},ZCL_getFileRemoved=function(){var fileId="";if(zcal.EOBJ.ATTACH){for(var prevId=[],fileArr=document.querySelectorAll("[id=fileAttachment]"),i=0;i<fileArr.length;i++)fileArr[i].getAttribute("data")&&prevId.push(fileArr[i].getAttribute("rel"));for(var i=0;i<zcal.EOBJ.ATTACH.length;i++)fileId+=prevId.indexOf(zcal.EOBJ.ATTACH[i].fileId)<0?""==fileId?zcal.EOBJ.ATTACH[i].attachId:","+zcal.EOBJ.ATTACH[i].attachId:""}return fileId},ZCL_getDownloadLink=function(ev){var downEl;downEl=ev.className&&"zmImg"==ev.className?ev.parentNode.parentNode.parentNode:0==zcal.EMODE?ev.parentNode.parentNode.parentNode.parentNode.parentNode:ev.parentNode.parentNode.parentNode.parentNode;var attachkey=downEl.getAttribute("akey"),flname=(downEl.getAttribute("name"),"/mail/cal/attachment/download/"+attachkey);window.open(flname)},ZCL_SetEventLnk=function(){var txt="",lnk=zcal.EOBJ.URL?ZCL_getHTML(zcal.EOBJ.URL):"";return 0==zcal.EMODE?""!=lnk&&(txt+='<ul class="zcl_frmrw"><li><u>'+zcal.i18n.link+'</u><span class="zcl_lk" id="zcl_ve_lnk">'+lnk+"</span></li></ul>"):txt+='<ul class="zcl_frmrw"><li class="zcl_W70pc"><u>'+zcal.i18n.link+'</u><input type="text" class="zcl_crlk SC_tiput" id="zcl_ce_lnk" value="'+lnk+'"></li></ul>',txt},ZCL_SetEventMlink=function(){var txt="",mlink=zcal.EOBJ.MLINK?zcal.EOBJ.MLINK:"";return txt+='<ul class="zcl_frmrw"><li><u>'+zcal.i18n.met_scheduled+'</u><span style="word-wrap:break-word"  id="zcl_m_lnk"><a class="zcl_lk" href="'+mlink+'" target="_blank">'+(-1!=mlink.indexOf("start")?zcal.i18n.met_start:zcal.i18n.met_join)+"</a></span></li></ul>"},ZCL_SetEventDesc=function(){{var txt="";zcal.EOBJ.DESC?zcal.EOBJ.DESC:""}return txt+=0==zcal.EMODE?'<ul class="zcl_frmrw"><li><u>'+zcal.i18n.description+'</u><div class="zcl_vwdes" id="zcl_cedesc" style="max-width: 400px;"></div></li></ul>':'<ul class="zcl_frmrw"><li class="zcl_W70pc"><u>'+zcal.i18n.description+'</u><textarea style="height:44px;" class="zcl_Cedes SC_tiput" id="zcl_ce_desc"></textarea></li></ul>'},ZCL_dispDesc=function(ele){ele.className="zcl_curpt zcl_hide",zcal.$("zcl_ce_desc").parentNode.className=""},ZCL_SetAlrm=function(){var remTxt="";if(1==zcal.EOBJ.REMTY&&zcal.EOBJ.ALARM)remTxt+=ZCL_putAlarm(zcal.EOBJ.ALARM);else if(2==zcal.EOBJ.REMTY){var calObj=zcal.getCalObj(zcal.EOBJ.CNAME);remTxt+=ZCL_putCalAlarm(calObj[6])}else remTxt+=ZCL_putAlarm([{ACTYPE:"0",REMTYPE:"0",REMTIME:"300000"}]);ZCL_$("zcl_ce_rem").innerHTML=remTxt,ZCL_$("zcl_ce_rem")&&$("#zcl_ce_rem .msi-close").off("click").on("click",function(){var addremEle,reminderEle=this.parentNode.parentNode.parentNode;reminderEle.removeChild(this.parentNode.parentNode),addremEle=reminderEle.querySelector("#zcl_addrem"),addremEle||ZCL_AppendRemAddLnk(reminderEle)});var actionObj=zmsuite.getCenter()[1].getNodes()[0],headerDOM=actionObj.headerArr.text,prevHeader={id:"zcalPrevHeader",rIcons:[{groupId:"Save",actionArr:[{iconClass:"msi-save",tooltip:zcal.i18n.save,data:{action:"setEventAlarm"}}]},{groupId:"Delete",actionArr:[{iconClass:"msi-trash",data:{action:"eventDelete"},tooltip:"eventDelete"}]},{groupId:"Close",actionArr:[{iconClass:"msi-close",tooltip:zcal.i18n.save,data:{action:"eventClose"}}]}]};actionObj.push(prevHeader),prevHeader.text=headerDOM,actionObj.render()},ZCL_SetEventAttStsUpd=function(){var txt="";if(!zcal.EOBJ.ISEXP&&zcal.EOBJ.USTAT){var atteml=zcal.EOBJ.ATTEMAIL,attsts=zcal.EOBJ.USTAT,attcmt="",css="zcl_evtxa zcl_greymr";zcal.EOBJ.UCMNT&&(attcmt=zcal.EOBJ.UCMNT,css="zcl_evtxa"),txt+='<ul class="zcl_frmrw zcl_vwsts"><li><u>'+ZCL_UStatusText(attsts,atteml)+"</u>"+ZCL_hdnFld("zcl_skey",zcal.EOBJ.SKEY),txt+='<ul class="zcl_qvsup" id="zcl_ce_asts">'+ZCL_AttStsDv(attsts)+"</ul>",txt+='<textarea style="height: 30px;" class="SC_tiput" id="zcl_cu_cmt" placeholder="Comments">'+attcmt+"</textarea>",txt+='<div class="SC_PUbtm"><span onclick="ZCL_sndStat()">'+zcal.i18n.update+"</span></div>",txt+="</li></ul>"}return txt},ZCL_SetEventAss=function(){for(var txt="",rto=zcal.EOBJ.RTO,othSrv=ZCL_getOthSrv(),tarr=othSrv[0].split(","),varr=othSrv[1].split(","),rtoTxt="",x=0;x<tarr.length;x++){var srv=tarr[x].split(":")[0],cls=tarr[x].split(":")[1];if(0==zcal.EMODE){var eid=-1!=zcal.EOBJ.EID.indexOf("_")?zcal.EOBJ.EID.split("_")[0]:zcal.EOBJ.EID;if(1==rto[varr[x]]){if("met"==srv)continue;var t=ZCL_replaceComName(zcal.i18n["vass_"+srv]);rtoTxt+="<li onmousedown=\"ZCL_callService('e"+srv+"','"+eid+'\', event)"><i class="msi-'+cls+'" rel="'+t+'"></i></li>'}}else{var t="tsk"==srv||"nts"==srv?ZCL_replaceComName(zcal.i18n["eass_"+srv]):zcal.i18n["eass_"+srv];rtoTxt+="mil"!=srv?'<li onclick="ZCL_ChgChk(this)"><i id="zcl_ce_'+srv+'" class="'+(1==rto[varr[x]]?"msi-check":"msi-uncheck")+'"></i><i class="msi-'+cls+'" rel="'+t+'"></i></li>':'<input type="hidden" id="zcl_ce_'+srv+'" value="'+rto[varr[x]]+'"/>'}}return txt+=""!=rtoTxt?"<li><u>"+zcal.i18n.associate+(1==zcal.EMODE?'<span class="zcl_ce_hlp"><i id="zcl_help" class="msi-faq"><a href="'+(-1!=zcal.ZCAL.indexOf(".stage.skydesk.jp")?"https://www.stage.skydesk.jp/apps/calendar/help/associate-events-with-skydesk-apps.html":"https://www.zoho.com/calendar/help/associate-events-with-zoho-apps.html")+'" ></a></i></span>':"")+"</u><ul>"+rtoTxt+"</ul></li>":""},ZCL_SetEventAtt=function(){var txt="";if(1==zcal.EMODE&&(zcal.EOBJ.EID&&zcal.EOBJ.ATT||"0"!=zcal.sendInv)||0==zcal.EMODE&&zcal.EOBJ.ATT)txt+=ZCL_SetIndAttLst("all");else if("0"==zcal.sendInv||"1"==zcal.sendInv){var msg="0"==zcal.sendInv?zcal.i18n.orgPolicyNoAttNote:zcal.i18n.orgPolicyOrgAttNote;txt+='<div class="section-content startup" style=""><span id="zcl_evhelp" class="startup help" style="margin: 20px 41px;width: auto"><em><img src="//img.zohostatic.com/zmail/zm/103.1/images/settings/lightbulb-info.png" class="info-message"></em><span style="white-space: normal;">'+msg+"</span></span></div>"}return txt},ZCL_attStsLnk=function(sty,lnkty){return lnkty==sty?'<li class="zcl_sl">'+zcal.i18n[sty]+"</li>":"<li onclick=\"ZCL_swtchAtt('"+sty+"', this)\">"+zcal.i18n[sty]+"</li>"},ZCL_swtchAtt=function(sty){ZCL_$("zcl_ce_aslst").innerHTML=ZCL_attStsLnk("all",sty)+ZCL_attStsLnk("yes",sty)+ZCL_attStsLnk("no",sty)+ZCL_attStsLnk("maybe",sty)+ZCL_attStsLnk("pending",sty),ZCL_$("zcl_ce_attlst").innerHTML=ZCL_ListAtt(sty);var eventForm=$("#zcl_ce"),$groupAtt=eventForm.find("[data-marker=groupAtt]");$groupAtt.length>0&&($groupAtt.removeAttr("data-marker"),$groupAtt.off("click").on("click",function(){var $ele=$(this),gid=$ele.data("gid"),mode=$ele.data("sts");ZCL_listGroupUserAtt(gid,mode)}))},ZCL_SetSvCnlBtn=function(){return'<ul class="zcl_frmrw"><li><div class="SC_PUbtm"><span id="zcl_svspan" rel="enable" onclick="ZCL_svEve()">'+zcal.i18n.save+'</span><span data-val="Cancel" onclick="ZCL_eClose()">'+zcal.i18n.cancel+"</span></div></li></ul>"},ZCL_ConstEventPage=function(){var cObj,attTxt,calId=zcal.EOBJ.CNAME,txt="",assTxt="";cObj=zcal.getCalObj(calId),"crm"==cObj[14]||"recruit"==cObj[14]&&-1!=zcal.cdata.calOUids.indexOf("zohoRecruit4_")?(crmCalId=calId,zcalCRM.showCRMForm()):"ztask"==cObj[14]?zcalTask.showTaskForm():(txt+='<div class="zcl zcl_CMS zcl_H100" id="zcl_ce">',txt+=ZCL_SetEventHiddenFlds(cObj),txt+='<div class="zcl_table zcl_H100">',attTxt=ZCL_SetEventAtt(),assTxt=""==cObj[14]?ZCL_SetEventAss():"",0==zcal.EMODE?txt+='<ul><li><ul class="zcl_crevnt" id="zcl_ce_ele"><li><ul class="zcl_vwev"><li>'+ZCL_SetAplReq()+ZCL_SetEventTtl(cObj[14])+ZCL_SetEventSchTime()+ZCL_SetEventAlrm(cObj)+(zcal.isAttach&&(0==zcal.EMODE&&zcal.EOBJ.ATTACH||0!=zcal.EMODE)?ZCL_SetEventAttach(0,cObj):"")+(""!=cObj[14]?"":ZCL_SetEventColor())+ZCL_SetEventLoc()+ZCL_SetEventCal()+ZCL_SetEventLnk()+ZCL_SetEventDesc()+(zcal.EOBJ.MLINK?ZCL_SetEventMlink():"")+'</li></ul></li></ul></li><li class="zcl_Cer zcl_vwCer" id="zcl_ce_ext">'+ZCL_SetMetaInfo(attTxt,cObj[14])+ZCL_SetEventAttStsUpd()+(""!=assTxt?'<ul class="zcl_frmrw" id="zcl_ce_ass">'+assTxt+"</ul>":"")+attTxt+"</li></ul>":(txt+='<ul><li><ul class="zcl_crevnt" id="zcl_ce_ele"><li>'+ZCL_SetAplReq()+ZCL_SetEventTtl(cObj[14])+ZCL_SetEventSchTime()+ZCL_SetAllDayRepeatSec()+"</li><li>"+ZCL_SetEventAlrm(cObj)+(zcal.isAttach&&(0==zcal.EMODE&&zcal.EOBJ.ATTACH||0!=zcal.EMODE)?ZCL_SetEventAttach(0,cObj):"")+(""!=cObj[14]?"":ZCL_SetEventColor())+'<ul class="zcl_frmrw" id="zcl_ce_loccal">'+ZCL_SetEventLoc()+ZCL_SetEventCal()+"</ul>"+ZCL_SetEventLnk()+ZCL_SetEventDesc()+ZCL_SetSvCnlBtn()+'</li></ul></li><li class="zcl_Cer" id="zcl_ce_ext">',zcal.EOBJ.EID&&(txt+=ZCL_SetMetaInfo(attTxt,cObj[14]),txt+=ZCL_SetEventAttStsUpd()),txt+=(""!=assTxt?'<ul class="zcl_frmrw" id="zcl_ce_ass">'+assTxt+"</ul>":"")+attTxt+"</li></ul>","group"==cObj[14]&&ZCL_getGrpInvPolicy(cObj)),txt+="</div></div>",ZCL_$("zcl_ce")?(ZCL_updEventPrevHeader(),$("#zcl_ce").parent().html(txt)):ZCL_setEventWorkSpace(txt),zcal.bindCreateEventAction()),1==zcal.EMODE&&null!=ZCL_$("zcl_ce_cal")&&(zcal.CAL_IND=ZCL_$("zcl_ce_cal").selectedIndex,ZCL_OLD_COBJ=zcal.getCalObj(zcal.EOBJ.CNAME))},ZCL_openTZPopup=function(tzval,tzrel){var tzEle,$loadAnimationDOM,tzLink=$("#zcl_ce_tza");ZCL_$("zcl_tz_pp")||$("body").append("<div id='zcl_tz_pp' class='zcl_ovr'/>"),tzEle=$("#zcl_tz_pp"),tzEle.html('<div>			<div data-marker="loadingAnimation"></div>			<div class="SC_select" id="zcl_tzlst"><input type="text" readonly  value="'+unescape(tzval)+'" class="SC_tiput zcl_nrbr" rel="'+tzrel+'" /></div>		   </div>'),$loadAnimationDOM=tzEle.find("[data-marker=loadingAnimation]").removeAttr("data-marker");var options={title:zcal.i18n.event_timezone,mask:!0,drag:!1,ptr:"tright",pos:"center",style:{"min-width":"600px","max-width":"750px"},customClass:"SC_SetPop",closeaction:function(){zmsDialog.remove(),$("#zcl_tz_pp").remove()},buttons:[{txt:zcal.i18n.done,callback:function(){var $tzDOM=$("#zcl_tz_pp").find("input");if($tzDOM.length){var newTZ=$tzDOM[0].getAttribute("rel"),oldTZ=tzLink.html();newTZ!=oldTZ&&ZCL_setEvenTimezone(newTZ)}zmsDialog.remove(!0),$("#zcl_tz_pp").remove()}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){zmsDialog.remove(!0),$("#zcl_tz_pp").remove()}}]};zmsDialog.create("zcl_tz_pp",options),zcal.timezones.length>0?ZCL_showTimezoneSelection():($loadAnimationDOM.show(),ZCL_getTZ({mode:"event",callback:function(){$loadAnimationDOM.hide(),ZCL_showTimezoneSelection()}}))},ZCL_showTimezoneSelection=function(){$("#zcl_tz_pp").find("#zcl_tzlst").on("click",function(){var tzArr=zcal.timezones,tArr=[];for(var i in tzArr)for(var j in tzArr[i]){var obj={};obj.id=j,obj.name=tzArr[i][j]+" ("+j+")",obj.display_text=tzArr[i][j]+" ("+j+")",tArr.push(obj)}var component,config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.parWidth=!0,config.onSelect=function(id,selectObj){setGroupValueTZ(that,id,selectObj),component.hide()},config.dataCallback=function(){return tArr},component=zmUtil.createFLComp("generic",config),component.show()})};var setGroupValueTZ=function($ele,id,selectObj){$ele.find("input").val(selectObj.display_text),$ele.find("input").attr("rel",id)};ZCL_setEvenTimezone=function(eventTZ){var inetzEle,tzLink=$("#zcl_ce_tza"),userTZ=zcal.cdata.opt.TIM;tzLink.html(eventTZ),ZCL_$("zcl_ce_inetz")&&$("#zcl_ce_inetz").parents("ul.zcl_frmrw").remove(),eventTZ!=userTZ&&(inetzEle=$('<ul class="zcl_frmrw zcl_when"><li class="zcl_curpt"><i class="msi-uncheck" id="zcl_ce_inetz"></i>'+ZCL_replaceString(zcal.i18n.display_in_etz,[eventTZ])+"</li></ul>"),inetzEle.find("li").off("click").on("click",function(){ZCL_ChgChk(this)}),$("#zcl_ce_aday").parents("ul.zcl_frmrw").before(inetzEle))},ZCL_ListAtt=function(sty){var attTxt="";if(zcal.EOBJ.ATT&&zcal.EOBJ.ATT.GRP){var gAtt=zcal.EOBJ.ATT.GRP;attTxt=ZCL_getGroupAttHtml(gAtt,sty)}if(zcal.EOBJ.ATT&&zcal.EOBJ.ATT.USR){for(var indTxt="",usrAtt="yes"==sty?zcal.EOBJ.ATT.USR[0]:"no"==sty?zcal.EOBJ.ATT.USR[1]:"maybe"==sty?zcal.EOBJ.ATT.USR[2]:"pending"==sty?zcal.EOBJ.ATT.USR[3]:zcal.EOBJ.ATT.USR[0].concat(zcal.EOBJ.ATT.USR[1],zcal.EOBJ.ATT.USR[2],zcal.EOBJ.ATT.USR[3]),i=0;i<usrAtt.length;i++){var uObj=usrAtt[i],obj={promise:!1,eid:uObj.AID},defObj=zmail.ContactBook.get(obj);indTxt+=defObj.length>0?"<ul id="+ZCL_getHTML(uObj.AID)+">"+(defObj[0].attrs.photo?'<li><img src="'+defObj[0].attrs.photo+'"/></li>':uObj.PHOTO?'<li><img src="'+uObj.PHOTO+'"></li>':'<li><img src="'+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+'"></li>')+'<li onclick="ZCL_attDetail(event)"><b>'+ZCL_getHTML(uObj.AID)+"</b>"+ZCL_AttCmntDiv(uObj.CMNT)+'</li><li class="zcl_txr">'+ZCL_AttCmntIcn(uObj.CMNT)+ZCL_AttStsIcn(uObj.STS)+ZCL_AttRmvIcn(uObj.AID,uObj.UID)+"</li></ul>":"<ul id="+ZCL_getHTML(uObj.AID)+">"+(uObj.PHOTO?'<li><img src="'+uObj.PHOTO+'"/></li>':'<li><img src="'+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+'"></li>')+'<li onclick="ZCL_attDetail(event)"><b>'+ZCL_getHTML(uObj.AID)+"</b>"+ZCL_AttCmntDiv(uObj.CMNT)+'</li><li class="zcl_txr">'+ZCL_AttCmntIcn(uObj.CMNT)+ZCL_AttStsIcn(uObj.STS)+ZCL_AttRmvIcn(uObj.AID,uObj.UID)+"</li></ul>"}attTxt+=""!=indTxt?'<div class="zcl_viwatlst zcl_table" id="ex_attlist">'+indTxt+"</div>":""}return attTxt=""!=attTxt?attTxt:'<div class="zcl_viwatlst zcl_table"><ul><li><div class="zcl_grey">No attendee</div></li></ul></div>'},ZCL_attDetail=function(e){zmConUtil.showContactCard({email:e.target.innerHTML,dom:e.target})},ZCL_AttCmntIcn=function(cmnt){return""!=cmnt?'<i class="msi-comment" title='+zcal.i18n.comment+' onclick="ZCL_DispAttCmt(this)"></i>':""},ZCL_AttStsIcn=function(sts){return"<i "+(1==sts?"class='msi-like' title='"+zcal.i18n.statusyes+"'":2==sts?"class='msi-unlike' title='"+zcal.i18n.statusno+"'":3==sts?"class='msi-maybe' title='"+zcal.i18n.statusmaybe+"'":"class='msi-pending' title='"+zcal.i18n.statuspending+"'")+"></i>"},ZCL_AttRmvIcn=function(atteId,attId){var rStr="";return 1==zcal.EMODE&&(rStr+=attId!=zcal.EOBJ.ORG?'<i class="msi-close" title='+zcal.i18n.remove+" onclick=\"ZCL_rmvAtt(this,'"+atteId+"')\"></i>":""),rStr},ZCL_AttCmntDiv=function(cmnt){return""!=cmnt?'<span id="cmtSpan" style="display:none">'+cmnt+"</span>":""},ZCL_DispAttCmt=function(ele){var cmntdv=ele.parentNode.parentNode,cmtDiv=cmntdv.querySelector("#cmtSpan");cmtDiv.style.display="none"==cmtDiv.style.display?"":"none"},ZCL_StsDv=function(sts,cnt,stsStr){return"<li "+(sts==cnt?"class='zcl_sl'":"")+' onclick="ZCL_ChgSts(this)">'+stsStr+"</li>"},ZCL_AttStsDv=function(sts){return ZCL_StsDv(sts,1,zcal.i18n.yes)+""+ZCL_StsDv(sts,2,zcal.i18n.no)+ZCL_StsDv(sts,3,zcal.i18n.maybe)},ZCL_ChgSts=function(ele){for(var astsdv=ele.parentNode.childNodes,i=0;i<astsdv.length;i++)astsdv[i].className="";ele.className="zcl_sl",ZCL_sndStat()},ZCL_txtAreaFcs=function(cur){if("zcl_cu_cmt"==cur.id){var val=cur.value.trim();cur.value=val==zcal.i18n.comments?"":val,cur.className="zcl_evtxa"}},ZCL_txtAreaBlur=function(cur){if("zcl_cu_cmt"==cur.id){var val=cur.value.trim();cur.value=""==val?zcal.i18n.comments:val,cur.className=""==val?"zcl_evtxa zcl_greymr":"zcl_evtxa"}},ZCL_listGroupUserAtt=function(gId,sts){var group=zcalGroup.getGroup(gId),grpMemObj=group.getMembers();ZCL_isEmpty(grpMemObj)?zcalGroup.fetchMembers(gId,function(){grpMemObj=zcalGroup.getGroup(gId).getMembers(),ZCL_listGroupMemWithStatus(gId,grpMemObj,sts)}):ZCL_listGroupMemWithStatus(gId,grpMemObj,sts)},ZCL_listGroupMemWithStatus=function(gId,grpMemObj,sty){var grpMemEle=ZCL_$("zcl_gattThd_"+gId);if("none"==grpMemEle.style.display){"all"==sty&&(sty="");var grpAttHtml="",grpAttArr=[],usrAttArr=[],orgMail=zcal.EOBJ.ORGM;zcal.EOBJ.ATT.GRP_USR&&(grpAttArr=ZCL_getGroupUserAttArr("")),zcal.EOBJ.ATT.USR&&(usrAttArr=ZCL_getUserAttArr(""));var withSts=!1;sty&&(zcal.EOBJ.ATT.GRP_USR&&("pending"==sty&&(grpAttArr=ZCL_getGroupUserAttArr("")),grpAttArr=ZCL_getGroupUserAttArr(sty)),zcal.EOBJ.ATT.USR&&(usrAttArr=ZCL_getUserAttArr("pending"==sty?"":sty)),withSts=!0);var stsUpdMemCnt=0,orgInGrp=!1;for(var i in grpMemObj){var attEmail=grpMemObj[i].eid,isAttMat=!1;if(attEmail!=orgMail){for(var j in grpAttArr){var grpUserMail=grpAttArr[j].AID,sts=grpAttArr[j].STS,attCmnt=grpAttArr[j].CMNT;if(attEmail==grpUserMail){"pending"!=sty&&(grpAttHtml+="<ul><li><span><b></b></span></li><li><b onclick=ZCL_attDetail(event)>"+attEmail+"</b>"+ZCL_AttCmntDiv(attCmnt)+"</li><li>"+ZCL_AttCmntIcn(attCmnt)+ZCL_AttStsIcn(sts)+"</li></ul>",stsUpdMemCnt++),isAttMat=!0;break}}if(!isAttMat)for(var j in usrAttArr){var userMail=usrAttArr[j].AID,sts=usrAttArr[j].STS,attCmnt=usrAttArr[j].CMNT;if(attEmail==userMail){"pending"!=sty&&(grpAttHtml+="<ul><li><span><b></b></span></li><li><b onclick=ZCL_attDetail(event)>"+attEmail+"</b>"+ZCL_AttCmntDiv(attCmnt)+"</li><li>"+ZCL_AttCmntIcn(attCmnt)+ZCL_AttStsIcn(sts)+"</li></ul>",stsUpdMemCnt++),isAttMat=!0;break}}withSts||isAttMat?"pending"!=sty||isAttMat||(grpAttHtml+="<ul><li><span><b></b></span></li><li><b onclick=ZCL_attDetail(event)>"+attEmail+"</b></li><li>"+ZCL_AttStsIcn(0)+"</li></ul>",stsUpdMemCnt++):grpAttHtml+="<ul><li><span><b></b></span></li><li><b onclick=ZCL_attDetail(event)>"+attEmail+"</b></li><li>"+ZCL_AttStsIcn(0)+"</li></ul>"}else attEmail==orgMail&&(orgInGrp=!0)}""!=grpAttHtml&&(grpMemEle.innerHTML=grpAttHtml,grpMemEle.style.display="",$("#zcl_gatt_"+gId).addClass("zcl_vwatgrp"))}else grpMemEle.style.display="none",$("#zcl_gatt_"+gId).removeClass("zcl_vwatgrp")},ZCL_getGroupAttHtml=function(gAtt,sts){var _attTxt="",photoObj=zcal.EOBJ.ATT.GRP_PHOTO||{};if("all"==sts&&-1==zmail.zoid)for(var i=0;i<gAtt.length;i++)for(var j in gAtt[i]){var gname=gAtt[i][j];gname=gname.length>15?ZCL_getHTML(gname.substr(0,12))+"...":ZCL_getHTML(gname),_attTxt+='<div class="zcl_viwatlst zcl_table" id="zcl_gatt_'+j+'"><ul><li>'+(photoObj[j]?'<img src="'+photoObj[j]+'">':"")+"</li><li><b>"+gname+"</b></li>"+(1!=zcal.EMODE||zcal.EOBJ.ATT.IS_STREAM?"":'<li><i class="msi-close" title='+zcal.i18n.remove+" onclick=\"ZCL_rmvGAtt(this, '"+j+"')\"></i></li>")+"</ul></div>"}else for(var i=0;i<gAtt.length;i++)for(var j in gAtt[i]){var gname=gAtt[i][j],isGrpHasMem="all"!=sts?ZCL_isGroupMemWithStsPres(j,sts):!0;gname=gname.length>15?ZCL_getHTML(gname.substr(0,12))+"...":ZCL_getHTML(gname),isGrpHasMem&&(_attTxt+='<div class="zcl_viwatlst zcl_table zcl_curpt" id="zcl_gatt_'+j+'"><ul data-marker="groupAtt" data-gid="'+j+'" data-sts="'+sts+'"><li>'+(photoObj[j]?'<img src="'+photoObj[j]+'">':"")+"</li><li><b>"+gname+"</b></li>"+(1!=zcal.EMODE||zcal.EOBJ.ATT.IS_STREAM?"":'<li><i class="msi-close" title='+zcal.i18n.remove+" onclick=\"ZCL_rmvGAtt(this, '"+j+"')\"></i></li>")+'</ul></div><div class="zcl_viwatlst zcl_vwatgrpls zcl_table" id="zcl_gattThd_'+j+'" style="display:none"></div>')}return _attTxt},ZCL_isGroupMemWithStsPres=function(grpId,sts){if("pending"!=sts&&!zcal.EOBJ.ATT.GRP_USR)return!1;var accObj={},decObj={},tentObj={},isPresent=!1;if(zcal.EOBJ.ATT.GRP_USR){var grpAttInfoArr=zcal.EOBJ.ATT.GRP_USR[5];accObj=grpAttInfoArr[0],decObj=grpAttInfoArr[1],tentObj=grpAttInfoArr[2]}if("yes"==sts)accObj[grpId]&&(isPresent=!0);else if("no"==sts)decObj[grpId]&&(isPresent=!0);else if("maybe"==sts)tentObj[grpId]&&(isPresent=!0);else if("pending"==sts){var allMemCnt=0,allGrpCntObj=zcal.EOBJ.ATT.GRP_MEM_CNT,stsUpdMemCnt=0;allGrpCntObj[grpId]&&(allMemCnt=allGrpCntObj[grpId]),accObj[grpId]&&(stsUpdMemCnt=parseInt(stsUpdMemCnt+ZCL_getJSONObjCnt(accObj))),decObj[grpId]&&(stsUpdMemCnt=parseInt(stsUpdMemCnt+ZCL_getJSONObjCnt(decObj))),tentObj[grpId]&&(stsUpdMemCnt=parseInt(stsUpdMemCnt+ZCL_getJSONObjCnt(tentxObj))),allMemCnt>stsUpdMemCnt&&(isPresent=!0)}return isPresent},ZCL_getGroupUserAttArr=function(sty){switch(sty){case"yes":return zcal.EOBJ.ATT.GRP_USR[0];case"no":return zcal.EOBJ.ATT.GRP_USR[1];case"maybe":return zcal.EOBJ.ATT.GRP_USR[2];case"pending":return zcal.EOBJ.ATT.GRP_USR[0].concat(zcal.EOBJ.ATT.GRP_USR[1],zcal.EOBJ.ATT.GRP_USR[2]);case"all":default:return zcal.EOBJ.ATT.GRP_USR[0].concat(zcal.EOBJ.ATT.GRP_USR[1],zcal.EOBJ.ATT.GRP_USR[2],zcal.EOBJ.ATT.GRP_USR[3])}},ZCL_getUserAttArr=function(sty){switch(sty){case"yes":return zcal.EOBJ.ATT.USR[0];case"no":return zcal.EOBJ.ATT.USR[1];case"maybe":return zcal.EOBJ.ATT.USR[2];case"pending":return zcal.EOBJ.ATT.USR[3];case"all":default:return zcal.EOBJ.ATT.USR[0].concat(zcal.EOBJ.ATT.USR[1],zcal.EOBJ.ATT.USR[2],zcal.EOBJ.ATT.USR[3])}},ZCL_addRem=function(remaddlnk){var remdiv=remaddlnk.parentNode;remdiv.removeChild(remaddlnk);var len=remdiv.childNodes.length;4>len&&(ZCL_appendRem(remdiv),3>len&&ZCL_AppendRemAddLnk(remdiv))},ZCL_appendRem=function(remdiv){remdiv.appendChild((new zcalAlarm).getDOM("dom"))},ZCL_ChgeRemType=function(rtyele){var rtype=rtyele.nextSibling.value;rtyele.innerHTML="1"==rtype?zcal.i18n.before:zcal.i18n.after,rtyele.nextSibling.value="1"==rtype?"0":"1"},ZCL_ChgeActType=function(atyele){var atype=atyele.nextSibling.value;atyele.innerHTML="1"==atype?zcal.i18n.byemail:zcal.i18n.bypopup,atyele.nextSibling.value="1"==atype?"0":"1"},ZCL_rmvRem=function(remdeldv){var remdiv=remdeldv.parentNode.parentNode;remdiv.removeChild(remdeldv.parentNode),zcal.$("zcl_addrem")||ZCL_AppendRemAddLnk(remdiv)},ZCL_QDetail=function(){var $tit=$("#zcl_qbk").find("#zcl_qbkttl"),$loc=$("#zcl_qbk").find("#zcl_qbkloc"),$cal=$("#zcl_qbk").find("#zcl_qbkcal");if(zcal.OBJTEMP.SUM=$tit.val(),zcal.OBJTEMP.CNAME=$cal[0].getAttribute("rel"),3==zcal.view)if(zcal.OBJTEMP.SUM){var timobj;if(timobj=ZCL_nlp($tit.val().trim(),0),zcal.OBJTEMP.SD==zcal.OBJTEMP.ED){var st=timobj.ST,et=timobj.ET;if(st||et){if(zcal.OBJTEMP.ST=st?ZCL_TimetoNo(st):"8:00",zcal.OBJTEMP.ET=et?ZCL_TimetoNo(et):"8:30",zcal.OBJTEMP.ST>zcal.OBJTEMP.ET&&zcal.OBJTEMP.SD==zcal.OBJTEMP.ED){var ZCL_DATCHNG=parseInt(zcal.OBJTEMP.ED%100)+parseInt(1),ZCL_MONYEAR=parseInt(zcal.OBJTEMP.ED/100);zcal.OBJTEMP.ED=ZCL_MONYEAR+""+ZCL_DATCHNG}zcal.OBJTEMP.ADAY=0}else zcal.OBJTEMP.ST="8:00",zcal.OBJTEMP.ET="8:30"}zcal.OBJTEMP.SUM=timobj.SUM}else zcal.OBJTEMP.SD==zcal.OBJTEMP.ED&&(zcal.OBJTEMP.ADAY=0,zcal.OBJTEMP.ST="8:00",zcal.OBJTEMP.ET="8:30");zcal.OBJTEMP.LOC=$loc.val(),zcal.OBJTEMP.Eurl="",zcal.OBJTEMP.DESC="",zcal.OBJTEMP.RTO=[0,0,0,0,0,0,0,0],zcal.OBJTEMP.REMTY=2,zcal.EMODE=1,ZCL_constEventView(zcal.OBJTEMP),zcal.OBJTEMP=null},ZCL_Qdel=function(eobj){var id=eobj.rel,euid=eobj.ekey,cid=eobj.calId,rto=eobj.rto,ridx=eobj.ridx,rbrkdate=eobj.rbrkdate;if(ZCL_clrStck(),-1==id.indexOf("_"))if(rto&&-1!=rto.indexOf("1")&&0!=rto.indexOf("1"))if(zcal.cdata.calLst[cid])ZCL_getPromtval("eve",id,euid,cid);else{var obj=zcalEvents.remEve(id,!1,!1);obj||(obj=zcalEvents.remEve(id,!1,!1)),obj&&obj[id].USTAT&&obj[id].ORG==zcal.cdata.opt.ZUID?zcalQAdd.chkAttAndDel(id,euid,cid,obj[id].USTAT):zcalQAdd.chkAttAndDel(id,euid,cid)}else{var obj=zcalEvents.remEve(id,!1,!1);obj||(obj=zcalEvents.remEve(id,!1,!1)),obj&&obj[id].USTAT&&obj[id].ORG==zcal.cdata.opt.ZUID?zcalQAdd.chkAttAndDel(id,euid,cid,obj[id].USTAT):zcalQAdd.chkAttAndDel(id,euid,cid)}else ZCL_showConfirm("delete",{rel:id,ekey:euid,crel:cid,rto:rto,ridx:ridx,rbrkdate:rbrkdate})},ZCL_delRep=function(re,robj){ZCL_EClrStck(),ZCL_closeREditConfirm();var temp=robj.rel,cid=robj.crel,euid=robj.ekey,ridx=robj.ridx,rto=robj.rto,rbrkdate=robj.rbrkdate,id=temp.substring(0,temp.indexOf("_")),obj=zcalEvents.remEve(id,!1,!1);obj||(obj=zcalEvents.remEve(id,!0,!1));obj[id].REP.RPDT;if(1==re||2==re&&0==ridx)rto&&-1!=rto.indexOf("1")&&0!=rto.indexOf("1")&&zcal.cdata.calLst[cid]?ZCL_getPromtval("eve",id,euid,cid):zcalQAdd.del(temp.substring(0,temp.indexOf("_")),euid,cid,rto);else{var cObj=zcal.getCalObj(cid),flnam="/cal/delEve.do?mode=recurD&eid="+id+"&type="+re+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF]+"&ckey="+cObj[9]+"&ekey="+euid+"&ctype="+cObj[5]+"&calmode="+zcal.CALMODE;flnam+="&mstart="+zcal.mlimit[0].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&mend="+zcal.mlimit[1].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF]),flnam+=ridx&&"undefined"!=ridx?"&ridx="+ridx:"",flnam+=rbrkdate&&"undefined"!=rbrkdate?"&rbrkdate="+rbrkdate:"",ZCL_XHR(flnam,"zcalQAdd.retRepDel")}},ZCL_Dedit=function(eId,e,calId,ekey){zcal.EMODE=1,null==zcal.EOBJ||eId&&eId!=zcal.EOBJ.EID?ZCL_editEve(eId,e,calId,ekey):ZCL_constEventView(zcal.EOBJ)},ZCL_eveInfo=function(eId,e,calId,eKey,ty){if(zcal.EMODE=1,null==zcal.EOBJ||eId&&eId!=zcal.EOBJ.EID){zcal.EOBJ=null;var calObj=zcal.getCalObj(calId),flnam="/cal/eInfo.do?ckey="+calObj[9]+"&ekey="+eKey+"&calmode="+zcal.CALMODE+(1==zcal.CALMODE?"&grpid="+zcal.ZGID:"");flnam+="&eveId="+(-1!=eId.indexOf("_")?eId.substring(0,eId.indexOf("_"))+"&date="+eId.substring(eId.indexOf("_")+1,eId.length):eId),ZCL_TRIDX&&"undefined"!=ZCL_TRIDX&&(flnam+="&ridx="+ZCL_TRIDX),ZCL_REPINST&&void 0!=ZCL_REPINST&&"undefined"!=ZCL_REPINST&&null!=ZCL_REPINST&&(flnam+="&rbrkdate="+ZCL_REPINST),ZCL_XHR(flnam,function(res){var obj=ZCL_Evl(1,res.responseText);"send"==ty?ZCL_send(obj):ZCL_chatLet(e,obj)})}else"send"==ty?ZCL_send(zcal.EOBJ):ZCL_chatLet(e,zcal.EOBJ)},ZCL_send=function(eObj){ZCL_clrStck();var att="",attArr=[];if(eObj.ATT){for(var i in eObj.ATT.USR)for(var j in eObj.ATT.USR[i])att+=""!=att?", "+eObj.ATT.USR[i][j].AID:eObj.ATT.USR[i][j].AID+"",attArr.push(eObj.ATT.USR[i][j].AID);var dat1=ZCL_parseDateStr(eObj.SD),day=String(dat1).slice(0,3),d=dat1.dateBy("MMM dd, yyyy"),ttemp=zcal.timeformat[zcal.cdata.opt.TF],aday=eObj.ADAY&&1==eObj.ADAY?!0:!1,st=(eObj.SD,eObj.ED,aday?"8:00 am":eObj.ST),et=aday?"8:30 am":eObj.ET,tim1=st.getTimeBy(ttemp),tim2=et.getTimeBy(ttemp),ti1=tim1.split(" ")[0],m1="am"==tim1.split(" ")[1]?"AM":"PM",ti2=tim2.split(" ")[0],m2="am"==tim2.split(" ")[1]?"AM":"PM",date=day+" "+d+" "+(aday?"":ti1+" "+m1+" - "+ti2+" "+m2)+" ("+zcal.cdata.opt.TIM+")",conObj={title:eObj.SUM,date:date,att:attArr},html=zcalTemplate.invitationview(conObj)}zmUtil.compose({TO:att,CONTENT:html,SUBJECT:zcal.i18n.eventinvitation+" - "+eObj.SUM})},ZCL_Dview=function(eId,e,calId,ekey){zcal.EMODE=0,ZCL_editEve(eId,e,calId,ekey)},ZCL_GetCalName=function(calId){return ZCL_getHTML(zcal.getCalObj(calId)[0])},ZCL_tgleNxtEle=function(cur){var ele=cur.parentNode;"none"==ele.nextSibling.style.display?(ele.nextSibling.style.display="",cur.children[0].className="msi-barrow"):(ele.nextSibling.style.display="none",cur.children[0].className="msi-rarrow")},ZCL_tgleAttEle=function(cur){var ele=cur.parentNode.parentNode;"none"==ele.nextSibling.style.display?(ele.nextSibling.style.display="",ele.className="zcl_ratgpsl"):(ele.nextSibling.style.display="none",ele.className="zcl_ratgp")},ZCL_setTblHgt=function(){zcal.$("zcl_ce_tbl").style.height=zcal.$("zcl_ce_cont").offsetHeight-2+"px"},ZCL_tgleGrpAtt=function(cur){var ele=cur.childNodes[0];ele.className="zcl_sl"==ele.className?"":"zcl_sl"},ZCL_UStatusText=function(s,attemail){return attemail?"Status of "+attemail:"Status"},ZCL_putAttendee=function(){if(zcal.EOBJ.ATT&&zcal.EOBJ.ATT.USR&&ZCL_$("zcl_ce_aslst")){var sts_alst=ZCL_$("zcl_ce_aslst").childNodes,sty="all";"sl"==sts_alst[1].className?sty="yes":"sl"==sts_alst[2].className?sty="no":"sl"==sts_alst[3].className?sty="maybe":"sl"==sts_alst[4].className&&(sty="pending"),ZCL_$("zcl_ce_attlst").innerHTML=ZCL_ListAtt("all");var eventForm=$("#zcl_ce"),$groupAtt=eventForm.find("[data-marker=groupAtt]");$groupAtt.length>0&&($groupAtt.removeAttr("data-marker"),$groupAtt.off("click").on("click",function(){var $ele=$(this),gid=$ele.data("gid"),mode=$ele.data("sts");ZCL_listGroupUserAtt(gid,mode)}))}},ZCL_rmvAtt=function(ele,attid){var attEle=ZCL_$("zcl_rmvatt"),rmvalist=attEle.value,attArr=""!=rmvalist?rmvalist.split(","):[];ZCL_in_array(attid,attArr)||attArr.push(attid),attEle.value=attArr.join(","),ele.parentNode.parentNode.parentNode.removeChild(ele.parentNode.parentNode)},ZCL_rmvGAtt=function(ele,id){var rmgattEle=ZCL_$("zcl_rmvgatt"),rmvalist=rmgattEle.value,attArr=""!=rmvalist?rmvalist.split(","):[];ZCL_in_array(id,attArr)||attArr.push(id),rmgattEle.value=attArr.join(","),$("#zcl_gatt_"+id).remove(),$("#zcl_gattThd_"+id).remove()},ZCL_putCalAlarmForView=function(almObj){var txt="";if(almObj.ACTYPE)for(var ACTYPE=almObj.ACTYPE.split(","),REMTIME=almObj.REMTIME.split(","),REMTYPE=almObj.REMTYPE.split(","),alen=ACTYPE.length,i=0;alen>i&&4>=alen;i++){{ZCL_array_search(REMTIME[i],ZCL_REM)}1==ACTYPE[i]&&1==REMTYPE[i]?txt+="<span>"+zcal.REMSTR[REMTIME[i]]+' after <span class="zcl_grey">by popup</span></span>':1==ACTYPE[i]&&0==REMTYPE[i]?txt+="<span>"+zcal.REMSTR[REMTIME[i]]+' before <span class="zcl_grey">by popup</span></span>':0==ACTYPE[i]&&1==REMTYPE[i]?txt+="<span>"+zcal.REMSTR[REMTIME[i]]+' after <span class="zcl_grey">by email</span></span>':0==ACTYPE[i]&&0==REMTYPE[i]&&(txt+="<span>"+zcal.REMSTR[REMTIME[i]]+' before <span class="zcl_grey">by email</span></span>')}return txt},ZCL_putCalAlarm=function(almObj){var txt="";if(almObj.ACTYPE){for(var ACTYPE=almObj.ACTYPE.split(","),REMTIME=almObj.REMTIME.split(","),REMTYPE=almObj.REMTYPE.split(","),alen=ACTYPE.length,i=0;alen>i&&4>=alen;i++){var alarmObj=new zcalAlarm;alarmObj.set({ACTYPE:ACTYPE[i],REMTYPE:REMTYPE[i],REMTIME:REMTIME[i]}),txt+=alarmObj.getDOM("string")}txt+=4==alen?"":ZCL_RemAddLnk()}else txt+=ZCL_RemAddLnk();return txt},ZCL_AppendRemAddLnk=function(remdiv){var alnk=$('<ul id="zcl_addrem"><li><span><i class="msi-add"></i>'+zcal.i18n.addreminder+"</span></li></ul>");alnk.find("span").off("click").on("click",function(){ZCL_addRem(this.parentNode.parentNode)}),remdiv.appendChild(alnk[0])},ZCL_RemAddLnk=function(){return'<ul id="zcl_addrem"><li><span onclick="ZCL_addRem(this.parentNode.parentNode)"><i class="msi-add"></i>'+zcal.i18n.addreminder+"</span></li></ul>"},ZCL_RemDelDiv=function(){return'<li onclick="ZCL_rmvRem(this)"><i class="msi-close" title='+zcal.i18n.remove+"></i></li>"},ZCL_putAlarmForView=function(alarmArr){var txt="";if(alarmArr)for(var alen=alarmArr.length,i=0;alen>i&&4>=alen;i++){var alarmObj=alarmArr[i],act=parseInt(alarmObj.ACTYPE),remt=parseInt(alarmObj.REMTYPE),txtIdx=ZCL_array_search(alarmObj.REMTIME,ZCL_REM),remTxt="";remTxt=txtIdx?zcal.REMSTR[alarmObj.REMTIME]:ZCL_getCustomAlarmInfo(alarmObj.REMTIME),1==act&&1==remt?txt+="<div>"+remTxt+' after <span class="zcl_grey">by popup</span></div>':1==act&&0==remt?txt+="<div>"+remTxt+' before <span class="zcl_grey">by popup</span></div>':0==act&&1==remt?txt+="<div>"+remTxt+' after <span class="zcl_grey">by email</span></div>':0==act&&0==remt&&(txt+="<div>"+remTxt+' before <span class="zcl_grey">by email</span></div>')}return txt},ZCL_putAlarm=function(alarmArr){for(var txt="",alen=alarmArr.length,i=0;alen>i&&4>=alen;i++){var alarmObj=new zcalAlarm;alarmObj.set(alarmArr[i]),txt+=alarmObj.getDOM("string")}return txt+=4==alen?"":ZCL_RemAddLnk()},ZCL_putDate=function(s){var df=zcal.DFORMAT[zcal.cdata.opt.DF],dd=s.substring(6,8),MM=s.substring(4,6),yyyy=s.substring(0,4);return df.replace("dd",dd).replace("MM",MM).replace("yyyy",yyyy)},ZCL_DFDate=function(d){for(var df=zcal.DFORMAT[zcal.cdata.opt.DF].split(3==zcal.cdata.opt.DF?"-":"/"),sdate=d.split(3==zcal.cdata.opt.DF?"-":"/"),dateObj={},y=0;y<sdate.length;y++)dateObj[df[y]]=sdate[y];return dateObj.yyyy+""+dateObj.MM+dateObj.dd},ZCL_putValues=function(obj,sel,ref){var z=0;for(var x in ref)obj.options[z]=new Option(ref[x],x),sel&&x==sel&&(obj.options[z].selected=!0),z++};var ZCL_DELRTO=1;ZCL_svEve=function(){""!=zcal.$("zcl_eid").value?1==zcal.GOBJ.RTO[2]&&zcal.$("zcl_ce_met")&&"msi-uncheck"==zcal.$("zcl_ce_met").className?ZCL_getPromtval("zcl_ce_met"):1==zcal.GOBJ.RTO[5]&&zcal.$("zcl_ce_crm")&&"msi-uncheck"==zcal.$("zcl_ce_crm").className?ZCL_getPromtval("zcl_ce_crm"):1==zcal.GOBJ.RTO[3]&&zcal.$("zcl_ce_tsk")&&"msi-uncheck"==zcal.$("zcl_ce_tsk").className?ZCL_getPromtval("zcl_ce_tsk"):1==zcal.GOBJ.RTO[4]&&zcal.$("zcl_ce_nts")&&"msi-uncheck"==zcal.$("zcl_ce_nts").className?ZCL_getPromtval("zcl_ce_nts"):ZCL_getEntry():ZCL_getEntry()},ZCL_getEntry=function(){var usd=(new Date,new Date),de1=ZCL_splitDateVal(zcal.$("zcl_ce_sd").value),ParST=ZCL_parseTime(zcal.$("zcl_ce_st").value);if(usd.setYear(de1[2]),usd.setMonth(de1[1]-1),usd.setDate(de1[0]),usd.setHours(ParST.HH,ParST.mm,0,0),""==ZCL_$("zcl_ce_tit").value.trim())return zmUtil.succErrMsg("e",zcal.i18n.plenttle),ZCL_$("zcl_ce_tit").focus(),!1;if(zcal.isAttach){var AttachfileArr=document.querySelectorAll("[id=fileAttachment]");if(ZCL_AttachCount&&ZCL_AttachCount!=AttachfileArr.length)return zmUtil.succErrMsg("e",zcal.i18n.uploadprogress),!1}if(ZCL_UrlCheck(ZCL_$("zcl_ce_lnk").value),!ZCL_dateValidate("zcl_ce_sd",zcal.i18n.evest)||!ZCL_dateValidate("zcl_ce_ed",zcal.i18n.eveed))return!1;if(!ZCL_dateTimeComparison("zcl_ce_ed","zcl_ce_et",zcal.i18n.eveed,"zcl_ce_sd","zcl_ce_st",zcal.i18n.evest,"G"))return!1;if(""!=zcal.$("zcl_eid").value){{var id=zcal.$("zcl_eid").value;-1!=id.indexOf("_")?id.substring(0,id.indexOf("_")):id}if(zcal.GOBJ&&zcal.GOBJ.REP&&zcal.GOBJ.CNAME==zcal.$("zcl_ce_cal").getAttribute("rel")){var nETZ=zcal.$("zcl_ce_tza").innerHTML?zcal.$("zcl_ce_tza").innerHTML:zcal.cdata.opt.TIM,oETZ=zcal.GOBJ.ETZ?zcal.GOBJ.ETZ:zcal.cdata.opt.TIM;if(nETZ==oETZ){var ro=zcal.GOBJ.REP,rArr=ZCL_getRep("arr");rArr&&rArr[0]==ro.RFRQ&&rArr[1]==ro.RIVL&&rArr[2]==ro.ROPT&&rArr[3].join("")==ro.RDAY.join("")&&rArr[4]==ro.RTOWK&&rArr[5]==ro.RDATE&&rArr[6]==ro.RMON&&rArr[7]==ro.RCNT&&rArr[8].trim()==ro.RUTL?ZCL_showConfirm("edit"):ZCL_subEvent(1)}else ZCL_subEvent(1)}else ZCL_subEvent(1)}else ZCL_subEvent()},ZCL_retEntry=function(ty){var isDum=!1,userTZ=zcal.cdata.opt.TIM,eventTZ=$("#zcl_ce_tza").html(),isAllday=$("#zcl_ce_aday").hasClass("msi-check"),stDate=$("#zcl_ce_sd").val(),endDate=$("#zcl_ce_ed").val(),st=isAllday?"00:00":$("#zcl_ce_st").val(),et=isAllday?"00:00":$("#zcl_ce_et").val(),summary=$("#zcl_ce_tit").val(),desc=$("#zcl_ce_desc").val(),dispInETZ=$("#zcl_ce_inetz").hasClass("msi-check"),calId=$("#zcl_ce_cal")[0].getAttribute("rel");null!=zcal.GOBJ&&zcal.GOBJ.SUM==summary&&zcal.GOBJ.SD==ZCL_DFDate(stDate)&&zcal.GOBJ.ED==ZCL_DFDate(endDate)&&zcal.GOBJ.ST==ZCL_TimetoNo(st)&&zcal.GOBJ.ET==ZCL_TimetoNo(et)&&zcal.GOBJ.DESC==desc&&(isDum=!0);{var cObj=zcal.getCalObj(calId),Eveobj={EID:ZCL_$("zcl_eid").value,EUID:ZCL_$("zcl_ekey").value,RIDX:ZCL_$("zcl_ridx").value,EPERM:ZCL_$("zcl_eperm").value,DPERM:ZCL_$("zcl_dperm").value,SD:ZCL_$("zcl_ce_sd").value,ST:ZCL_TimetoNo(st),ED:ZCL_$("zcl_ce_ed").value,ET:ZCL_TimetoNo(et),ATT:ZCL_getAttendee(),RMVATT:ZCL_$("zcl_rmvatt").value,GATT:ZCL_getGrpAttendee(),RMVGATT:ZCL_$("zcl_rmvgatt").value,CLASS:ZCL_$("zcl_ce_pvt")&&"msi-check"==ZCL_$("zcl_ce_pvt").className?1:0,ADAY:"msi-check"==ZCL_$("zcl_ce_aday").className?1:0,IMP:0,Attachment:ZCL_getFileAttach("get"),HASATTACH:ZCL_getFileAttach("sts"),RMAttachment:ZCL_getFileRemoved(),USTAT:ZCL_usrStat(),UCMNT:ZCL_$("zcl_cu_cmt")?ZCL_$("zcl_cu_cmt").value:"",SKEY:ZCL_$("zcl_skey")?ZCL_$("zcl_skey").value:"",CNAME:calId,LOC:ZCL_$("zcl_ce_loc").value,TRANS:1,DESC:ZCL_$("zcl_ce_desc").value,LINK:ZCL_$("zcl_ce_lnk").value,ETSK:ZCL_$("zcl_ce_tsk")&&"msi-check"==ZCL_$("zcl_ce_tsk").className?1:0,ECRM:ZCL_$("zcl_ce_crm")&&"msi-check"==ZCL_$("zcl_ce_crm").className?1:0,ENTS:ZCL_$("zcl_ce_nts")&&"msi-check"==ZCL_$("zcl_ce_nts").className?1:0,EMET:ZCL_$("zcl_ce_met")&&"msi-check"==ZCL_$("zcl_ce_met").className?1:0,EMIL:ZCL_$("zcl_ce_mil")&&"msi-check"==ZCL_$("zcl_ce_mil").className?1:0,SUM:ZCL_$("zcl_ce_tit").value,ALARM:""==cObj[14]?ZCL_getAlarm("zcl_ce_rem"):"",REP:ZCL_getRep(),TYPE:ty,ISDMY:isDum,ETZ:eventTZ!=userTZ?eventTZ:"",IN_ETZ:dispInETZ,DELRTO:1==ZCL_DELRTO?!0:!1,EC:ZCL_$("zcl_ce_color")?ZCL_$("zcl_ce_color").getAttribute("rel"):-1,ADD_MODE:"DET",NTFY:ZCL_NTFY_ATT};Eveobj.ATT}ZCL_detailObj(Eveobj)},ZCL_subEvent=function(type){var isMtg=ZCL_$("zcl_ce_met")&&"msi-check"==ZCL_$("zcl_ce_met").className?!0:!1;ZCL_isAtt()&&isMtg&&(ZCL_NTFY_ATT=2),ZCL_isAtt()&&!isMtg?type?ZCL_shNtfyAttPop(type):ZCL_shNtfyAttPop():type?ZCL_retEntry(type):ZCL_retEntry()},ZCL_isAtt=function(){var isAtt=!1;if(zcal.EOBJ.ATT&&(zcal.EOBJ.ATT.USR||zcal.EOBJ.ATT.GRP)&&(isAtt=!0),!isAtt&&ZCL_$("attlist")){var attEle=ZCL_$("attlist").childNodes;attEle.length>0&&(isAtt=!0)}return isAtt},ZCL_shNtfyAttPop=function(type){var timeEle;ZCL_$("zcl_att_confirm")||$("body").append("<div id='zcl_att_confirm' class='zcl_rpt'/>"),timeEle=$("#zcl_att_confirm"),timeEle.html($("<div>"+zcal.i18n.invnotifymsg+" ?</div>")[0]);var options={title:zcal.i18n.eventinvitation,style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright",buttons:[{txt:zcal.i18n.send,callback:function(){ZCL_confNotAtt(type,"1")}},{txt:zcal.i18n.sendme,callback:function(){ZCL_confNotAtt(type,"2")}},{txt:zcal.i18n.dontsend,callback:function(){ZCL_confNotAtt(type,"0")}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){zmsDialog.remove(!0)}}]};setTimeout(function(){zmsDialog.create("zcl_att_confirm",options)},600)},ZCL_shAttPopForQkDel=function(eid,euid,cid,isDtlDel){var timeEle;ZCL_$("zcl_att_confirm")||$("body").append("<div id='zcl_att_confirm' class='zcl_rpt'/>"),timeEle=$("#zcl_att_confirm"),timeEle.html($("<div>"+zcal.i18n.invnotifymsg+" ?</div>")[0]);var options={title:zcal.i18n.eventinvitation,buttons:[{txt:zcal.i18n.send,callback:function(){ZCL_confAttQkDel(eid,euid,cid,isDtlDel,"1")}},{txt:zcal.i18n.sendme,callback:function(){ZCL_confAttQkDel(eid,euid,cid,isDtlDel,"2")}},{txt:zcal.i18n.dontsend,callback:function(){ZCL_confAttQkDel(eid,euid,cid,isDtlDel,"0")}},{txt:zcal.i18n.cancel,callback:function(){zmsDialog.remove(!0)}}]};zmsDialog.create("zcl_att_confirm",options)},ZCL_confNotAtt=function(type,notAtt){ZCL_NTFY_ATT=notAtt,ZCL_clrStck(),zmsDialog.remove(!0),type?ZCL_retEntry(type):ZCL_retEntry()},ZCL_confAttQkDel=function(eid,euid,cid,isDtlDel,notifyAtt){ZCL_NTFY_ATT=notifyAtt,zcalQAdd.del(eid,euid,cid),zmsDialog.remove(!0),isDtlDel&&1==isDtlDel&&(ZCL_EClrStck(),zmsDialog.remove(!0))},ZCL_retValAtt=function(res,eveObj){var obj=ZCL_Evl(1,res.responseText);if("true"==obj.ISVALID)ZCL_detailObj(eveObj);else if("onlygrpmem"==obj.MSG){var confirmMsg=zcal.i18n.nonGrpMem;setTimeout(function(){zmsDialog.confirm(confirmMsg,{onOk:function(){ZCL_detailObj(eveObj)}})},500)}else if("onlyorgmem"==obj.MSG){var confirmMsg=zcal.i18n.NonOrgMemCal;setTimeout(function(){zmsDialog.confirm(confirmMsg,{onOk:function(){ZCL_detailObj(eveObj)}})},500)}else if("dontallowinvitee"==obj.MSG){var confirmMsg="Organization policy doesn't allow to add attendees.";setTimeout(function(){zmsDialog.confirm(confirmMsg,{onOk:function(){ZCL_detailObj(eveObj)}})},500)}},ZCL_getAddress=function(ele){var attObj=[];for(var i in ele[0].childNodes)if(ele[0].childNodes[i].id){var obj={};ele[0].childNodes[i].getAttribute("gid")?(obj.egid=ele[0].childNodes[i].id,obj.gid=ele[0].childNodes[i].getAttribute("gid")):(obj.eid=ele[0].childNodes[i].id,obj.zid=ele[0].childNodes[i].getAttribute("data-zid")),attObj.push(obj)}return attObj},ZCL_getAttendee=function($ele){var aStr="",$ele=$ele||$("#attlist");if($ele.length>0){var attObj=ZCL_getAddress($ele);if(attObj)for(var i=0;i<attObj.length;i++)if(!attObj[i].gid){var eid=attObj[i].eid.trim();aStr+=""!=aStr?","+eid:eid}var attArr=aStr.split(",");attArr=ZCL_array_unique(attArr),aStr=attArr.join(",")}return aStr},ZCL_getFullAttendee=function(){var att=ZCL_getAttendee(),aStr="",$ele=$ele||$("#ex_attlist"),attObj=[];if($ele.length>0){for(var i in $ele[0].childNodes){var obj={};$ele[0].childNodes[i].id&&(obj.egid=$ele[0].childNodes[i].id,attObj.push(obj))}if(attObj)for(var i=0;i<attObj.length;i++){var eid=attObj[i].egid;aStr+=""!=aStr.trim()?","+eid:eid}var attArr=aStr.split(",");attArr=ZCL_array_unique(attArr),aStr=attArr.join(",")}return aStr+=""!=att.trim()?""!=aStr.trim()?","+att:att:""},ZCL_getGrpAttendee=function(){var selGrp=new Array;if(zcal.$("attlist")){var attObj=ZCL_getAddress($("#attlist"));if(attObj)for(var i=0;i<attObj.length;i++)attObj[i].egid&&selGrp.push(attObj[i].egid)}return selGrp},ZCL_getAlarm=function(remid){var temp="zcl_cal_rem"==remid?[{}]:"";if(ZCL_$(remid)){var remDiv=ZCL_$(remid).childNodes,len=remDiv.length;len>1&&5>=len&&(temp=ZCL_getAlarmObj(remDiv))}return temp},ZCL_getAlarmObj=function(remDiv){var len=remDiv.length,actArr=[],timeArr=[],remType=[];len=len>5?5:len;for(var i=0;len>i;i++)if("UL"==remDiv[i].tagName&&"zcl_addrem"!=remDiv[i].id){var remEle=remDiv[i].childNodes;timeArr.push(remEle[0].children[0].children[0].value),remType.push(remEle[1].children[0].children[0].value),actArr.push(remEle[2].children[0].children[0].value)}var temp=[{ACTYPE:actArr.join(","),REMTIME:timeArr.join(","),REMTYPE:remType.join(",")}];return temp},ZCL_getRep=function(ty){var _rep=ZCL_$("zcl_rep"),recurobj=zcal.EOBJ.rObj;if(_rep){if("msi-check"!=_rep.getElementsByTagName("I")[0].className)return recurobj.reset(),null;var temp=recurobj.getReqObj();return null!=ty&&"arr"==ty&&(temp=[temp.RFRQ,temp.RIVL,temp.ROPT,temp.RDAY,temp.RTOWK,temp.RDATE,temp.RMON,temp.RCNT,temp.RUTL]),temp}return null},ZCL_ChgChk=function(cur){if("zcl_rep_span"!=cur.id){var chBx=cur.childNodes[0];chBx.className="msi-check"==chBx.className?"msi-uncheck":"msi-check"}},ZCL_checkAll=function(){$("#zcl_ce_aday").hasClass("msi-uncheck")?($("#zcl_ce_st").parent().show(),$("#zcl_ce_et").parent().show(),$("#zcl_ce_tza").parent().show(),$("#zcl_ce_inetz").parents("ul.zcl_frmrw").show()):($("#zcl_ce_st").parent().hide(),$("#zcl_ce_et").parent().hide(),$("#zcl_ce_tza").parent().hide(),$("#zcl_ce_inetz").parents("ul.zcl_frmrw").hide())},ZCL_delEve=function(){var eid=ZCL_$("zcl_eid").value,ekey=ZCL_$("zcl_ekey").value,cid=ZCL_$("zcl_crel").value,rto=ZCL_$("zcl_rtoval")?ZCL_$("zcl_rtoval").value:"";if(zcal.isRO)ZCL_openRO();else if(eid&&""!=eid)if(-1==eid.indexOf("_"))-1!=rto.indexOf("1")&&0!=rto.indexOf("1")&&zcal.cdata.calLst[cid]?ZCL_getPromtval("eve",eid,ekey,cid):zcalQAdd.chkAttAndDel(eid,ekey,cid,-1,!0);else{var obj={rel:eid,crel:cid,ekey:ekey,ridx:ZCL_$("zcl_ridx").value,rbrkdate:ZCL_$("zcl_repinst").value,rto:rto};ZCL_showConfirm("delete",obj)}},ZCL_usrStat=function(){var a_sts=0;if(ZCL_$("zcl_ce_asts")){var stsArr=ZCL_$("zcl_ce_asts").childNodes;a_sts="zcl_sl"==stsArr[0].className?1:"zcl_sl"==stsArr[1].className?2:"zcl_sl"==stsArr[2].className?3:a_sts}return a_sts},ZCL_sndStat=function(){var a_sts=ZCL_usrStat();if(0!=a_sts)if(zcal.isRO)ZCL_openRO();else{var cmt=ZCL_$("zcl_cu_cmt").value,eid=ZCL_$("zcl_eid").value,skey=ZCL_$("zcl_skey").value,calid=ZCL_$("zcl_crel").value,calObj=zcal.getCalObj(calid),ckey=calObj[9],ekey=ZCL_$("zcl_ekey").value;eid=-1==eid.indexOf("_")?eid:eid.substring(0,eid.indexOf("_")),ZCL_XHR("/cal/cuStat.do?custat="+a_sts+"&cucmt="+cmt+"&eid="+eid+"&skey="+skey+"&ckey="+ckey+"&ekey="+ekey+"&calmode="+zcal.CALMODE,"ZCL_retStat")}},ZCL_retStat=function(xml,opr){var upd="UPDATE ATTENDEE STATUS"==opr?ZCL_Evl(1,xml):ZCL_Evl(1,xml.responseText);return upd.ERR?(ZCL_slideObj.status(zcal.i18n[upd.ERR]),!1):(upd.ATTENDEE&&(zcal.EOBJ.ATT.USR=upd.ATTENDEE,ZCL_putAttendee()),void(!upd.EID||"1"!=upd.STS&&"2"!=upd.STS&&"3"!=upd.STS||ZCL_updateSts(upd.EID,upd.STS)))},ZCL_showEvent=function(eParam){for(var i in eParam)for(var j in eParam[i])if(eParam[i][j].EC=eParam[i][j].EC?eParam[i][j].EC:"-1","edit"==eParam[i][j].MODE){var obj=zcalEvents.remEve(j,!1,!0);obj||(obj=zcalEvents.remEve(j,!0,!0)),ZCL_insertEvent(eParam[i],j)}else{var tempObj=(parseInt(eParam[i][j].SD),parseInt(eParam[i][j].ED),parseInt(eParam[i][j].ADAY),parseInt(eParam[i][j].ST),eParam[i][j]);tempObj.REP?ZCL_XHR("/cal/repRange.do?eid="+j+"&mstart="+zcal.mlimit[0].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&mend="+zcal.mlimit[1].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF],function(res){var _robj=ZCL_Evl(1,res.responseText);ZCL_updateRepeatWithRange(_robj,tempObj)}):ZCL_insertEvent(eParam[i],j)}ZCL_enableCal(eParam[i][j].CNAME),ZCL_updateCalAndEvents()},ZCL_updateRepeatWithRange=function(_robj,_eobj){var eventId=_robj.id,_rdates=_robj.rdats?_robj.rdats:"";if(_eobj){var txt="{'"+eventId+"':{'CNAME': '"+_eobj.CNAME+"', 'SD' : '"+_eobj.SD+"', 'ED' : '"+_eobj.ED+"', 'ST': '"+_eobj.ST+"', 'ET':'"+_eobj.ET+"', 'SUM' :'"+_eobj.SUM+"', 'ADAY':'"+_eobj.ADAY+"', 'EUID':'"+_eobj.EUID+"', 'DUR':'"+_eobj.DUR+"', 'EPERM':'"+_eobj.EPERM+"', 'DPERM':'"+_eobj.DPERM+"'";txt+=", 'REF' : ["+_eobj.REF[0]+", "+_eobj.REF[1]+", "+_eobj.REF[2]+", "+_eobj.REF[3]+", "+_eobj.REF[4]+"]",txt+=_eobj.REP?", 'REP' : {'RPDT' : '"+_eobj.RPDT+"'}}":"}",txt+="}";var eObj=ZCL_Evl(1,txt);""!=_rdates&&_rdates.length>0&&ZCL_insertRepEvents(eObj,_rdates,eventId)}},ZCL_eClose=function(){ZCL_EClrStck()},ZCL_serviceRes=function(xml){var obj=ZCL_Evl(1,xml.responseText),sts=obj.status;if("success"==sts){var sName=obj.service;if("ents"==sName){var _rele=ZCL_$("zcl_eassociate_qv")?ZCL_$("zcl_eassociate_qv"):document.createElement("div");_rele.id="zcl_eassociate_qv",_rele.className="zcl_asso";var nObj=obj.nobj,title=nObj.title;_rele.innerHTML="";var pTxt=document.createElement("p");pTxt.append(zcal.i18n.title+" : "+title);var p=document.createElement("p"),descElement=ZCL_LinkParser(nObj.desc?nObj.desc:"");for(var i in descElement)3==descElement[i].nodeType&&descElement[i].nodeValue.match(/\s/)&&(descElement[i].nodeValue=descElement[i].nodeValue.replace(/\s/g,"")),p.appendChild(descElement[i]);_rele.append(pTxt),_rele.append(p),document.body.appendChild(_rele);var options={title:ZCL_replaceComName(zcal.i18n.znotes),style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright"};zmsDialog.create("zcl_eassociate_qv",options)}else if("etsk"==sName)try{var ztaskPrioriy=[zcal.i18n.ztask_priority_high,zcal.i18n.ztask_priority_medium,zcal.i18n.ztask_priority_low],val=obj.tobj,priority=ztaskPrioriy[val.PRIORITY],_rele=ZCL_$("zcl_eassociate_qv")?ZCL_$("zcl_eassociate_qv"):document.createElement("div");_rele.id="zcl_eassociate_qv",_rele.className="zcl_asso";var _txt='<ul class="zcl_frmrw"><li class="zcl_frmtt">'+zcal.i18n.task_label_title+"</li><li>"+val.TITLE+"</li></ul>";_txt+='<ul class="zcl_frmrw"><li class="zcl_frmtt">'+zcal.i18n.task_label_duedate+"</li><li>"+val.DUEDATE+"</li></ul>",_txt+='<ul class="zcl_frmrw"><li class="zcl_frmtt">'+zcal.i18n.task_label_priority+"</li><li>"+priority+"</li></ul>",_txt+='<ul class="zcl_frmrw"><li class="zcl_frmtt">'+zcal.i18n.task_label_description+"</li><li></li></ul>",_txt+="<p>"+val.DESC+"</p>",_rele.innerHTML=_txt,document.body.appendChild(_rele);var options={title:ZCL_replaceComName(zcal.i18n.ztask),style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright"};zmsDialog.create("zcl_eassociate_qv",options)}catch(err){return zmUtil.succErrMsg("e",zcal.i18n.errorpopup_desc),!1}else"emet"==ZCL_SERVICE?window.open(xml.responseText):"elnk"==ZCL_SERVICE?""!=xml.responseText&&window.open(xml.responseText):"ecrm"==ZCL_SERVICE?window.open(xml.responseText):"emil"==ZCL_SERVICE&&window.open(xml.responseText)}},ZCL_getPromtval=function(val,id,euid,cid){var _rele=document.createElement("div");_rele.id="zcl_rmvass_confirm",_rele.className="zcl_rpt",_rele.innerHTML="eve"==val?zcal.i18n.delOthSer:zcal.i18n.disOther,ZCL_$("zcl_rmvass_confirm")||document.body.appendChild(_rele);var options={title:zcal.i18n.confirm+" ?",style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright",closeaction:function(){ZCL_closeAssConfirm()},buttons:[{txt:zcal.i18n.yes,callback:function(){ZCL_DELRTO=1,ZCL_closeAssConfirm(),"eve"==val?zcalQAdd.del(id,euid,cid):ZCL_getEntry()}},{txt:zcal.i18n.no,callback:function(){ZCL_DELRTO=0,"eve"==val?zcalQAdd.del(id,euid,cid):ZCL_getEntry(),ZCL_closeAssConfirm()}},{txt:zcal.i18n.cancel,callback:function(){zmsDialog.remove(!0)}}]};zmsDialog.create("zcl_rmvass_confirm",options)},ZCL_closeAssConfirm=function(){zmsDialog.remove(!0),$("#zcl_rmvass_confirm").remove()},ZCL_UrlCheck=function(){var link=zcal.$("zcl_ce_lnk").value.trim();if(""!=link){var re=/^http(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\:\'\/\\\+=&amp;%\$#_]*)?$/i;re.test(link)?ZCL_$("zcl_ce_lnk").value=link:(link=link.match(/\b^(http|https)\:\/\/\b/)?link:location.protocol+"//"+link,zcal.$("zcl_ce_lnk").value=link)}},ZCL_setEventAlarm=function(){var calid=ZCL_$("zcl_crel").value,calObj=zcal.cdata.calLst[calid]||zcal.cdata.calOLst[calid];if(calObj){var ckey=calObj[9],ekey=ZCL_$("zcl_ekey").value,alarmArr=ZCL_getAlarm("zcl_ce_rem"),flnam="/cal/setEveRem.do?ekey="+ekey+"&ckey="+ckey;flnam+=alarmArr?"&isrem=true&remt="+alarmArr[0].REMTIME+"&remty="+alarmArr[0].REMTYPE+"&actty="+alarmArr[0].ACTYPE:"&isrem=false",ZCL_XHR(flnam,function(res){ZCL_retRemStat(res)})}},ZCL_retRemStat=function(res){var upd=ZCL_Evl(1,res.responseText);_zm.succErrMsg("reminderupdated"==upd.STS||"reminderremoved"==upd.STS?"s":"e",zcal.i18n[upd.STS])},ZCL_getAddEventObj=function(subStr){var d1=new Date,sub="";subStr&&(sub=subStr),d1.setTime(zcal.today.getTime());var sd,hrs,min,st,calId,d=d1.getDate(),m=d1.getMonth(),y=d1.getFullYear();m=10>m+1?"0"+(m+1):m+1,d=10>d?"0"+d:d,sd=y+""+m+d,d1.setTime(zcal.cdate),hrs=d1.getHours(),min=d1.getMinutes(),st=2*hrs+(min>30?2:1),st=st>46?46:st,zcal.EMODE=1;for(var y in zcal.cdata.calOrdArr)if("1"==zcal.cdata.calLst[zcal.cdata.calOrdArr[y]][8]){calId=zcal.cdata.calOrdArr[y];break}return calId?{SD:sd,ST:zcal.TTT[st],ED:sd,ET:zcal.TTT[st+1],SUM:sub,LOC:"",DESC:"",ADAY:0,ORG:zcal.uid,RTO:[0,0,0,0,0,0,0,0],CNAME:calId,REMTY:2}:(alert("You don't have permission to add event on any of these calendars."),!1)},ZCL_updEventPrevHeader=function(mode){var prevHeader,actionObj=zmsuite.getCenter()[1].getNodes()[0],saveHandler="eventSave",headerDOM=actionObj.headerArr.text;"task"===mode?saveHandler="taskSave":"crm"===mode&&(saveHandler="crmEventSave"),0==zcal.EMODE&&(prevHeader={id:"zcalPrevHeader",rIcons:[{groupId:"Close",actionArr:[{iconClass:"msi-close",tooltip:zcal.i18n.close,data:{action:"eventClose"}}]}]},"2"==zcal.EOBJ.DPERM&&prevHeader.rIcons.unshift({groupId:"Delete",actionArr:[{iconClass:"msi-trash",tooltip:"Delete",data:{action:"eventDelete"}}]}),2==zcal.EOBJ.EPERM&&prevHeader.rIcons.unshift({groupId:"Edit",actionArr:[{iconClass:"msi-edit",tooltip:"Edit",data:{action:"eventEdit"}}]}),null!=zcal.EOBJ.ATT&&prevHeader.rIcons.unshift({groupId:"Send",actionArr:[{iconClass:"msi-send",tooltip:"Send as mail",data:{action:"eventSend"}}]}),zmail.IntegrationStatus&&zmail.IntegrationStatus.CHAT?prevHeader.rIcons.unshift({groupId:"Chatlet",actionArr:[{iconClass:"msi-cliq",tooltip:"Start chat",data:{action:"startChat"}}]}):(prevHeader={id:"zcalPrevHeader",rIcons:[{groupId:"Save",actionArr:[{iconClass:"msi-save",tooltip:zcal.i18n.save,data:{action:saveHandler}}]}]},null!=zcal.EOBJ.ATT&&prevHeader.rIcons.push({groupId:"Send",actionArr:[{iconClass:"msi-send",tooltip:"Send as mail",data:{action:"eventSend"}}]}),zcal.EOBJ.EID&&("2"==zcal.EOBJ.DPERM&&prevHeader.rIcons.push({groupId:"Delete",actionArr:[{iconClass:"msi-trash",data:{action:"eventDelete"},tooltip:"Delete"}]}),zmail.IntegrationStatus&&zmail.IntegrationStatus.CHAT&&prevHeader.rIcons.push({groupId:"Chatlet",actionArr:[{iconClass:"msi-cliq",tooltip:"Start chat",data:{action:"startChat"}}]})),prevHeader.rIcons.push({groupId:"Close",actionArr:[{iconClass:"msi-close",tooltip:zcal.i18n.close,data:{action:"eventClose"}}]})),actionObj.push(prevHeader),prevHeader.text=headerDOM,actionObj.render())},ZCL_setEventWorkSpace=function(txt,mode){var prevHeader,tabId="zcal_eContainer",saveHandler="eventSave",appName=0==zcal.EMODE?zcal.i18n.viewevent:zcal.EOBJ.EID?zcal.i18n.editevt:zcal.i18n.createevt;"task"===mode?(saveHandler="taskSave",appName=0==zcal.EMODE?zcal.EOBJ.IS_SUB_TASK?"View Subtask":zcal.i18n.viewtask:zcal.EOBJ.EID?zcal.EOBJ.IS_SUB_TASK?"Edit Subtask":zcal.i18n.edittask:zcal.i18n.createtask):"crm"===mode&&(saveHandler="crmEventSave");var tabObj={appname:appName,appId:tabId,data:{CNodes:"2"},appIcon:0==zcal.EMODE?"msi-Vevnt":"msi-caledit"};zmsuite.setWorkSpace(tabObj);var headerDOM=["DIV",{attrs:{"class":"SC_phd"},child:[["text",appName]]}];0==zcal.EMODE?(prevHeader={id:"zcalPrevHeader",rIcons:[{groupId:"Close",actionArr:[{iconClass:"msi-close",tooltip:zcal.i18n.close,data:{action:"eventClose"}}]}]},"2"==zcal.EOBJ.DPERM&&prevHeader.rIcons.unshift({groupId:"Delete",actionArr:[{iconClass:"msi-trash",tooltip:"Delete",data:{action:"eventDelete"}}]}),2==zcal.EOBJ.EPERM&&prevHeader.rIcons.unshift({groupId:"Edit",actionArr:[{iconClass:"msi-edit",tooltip:"Edit",data:{action:"eventEdit"}}]}),null!=zcal.EOBJ.ATT&&prevHeader.rIcons.unshift({groupId:"Send",actionArr:[{iconClass:"msi-send",tooltip:"Send as mail",data:{action:"eventSend"}}]}),zmail.IntegrationStatus&&zmail.IntegrationStatus.CHAT&&prevHeader.rIcons.unshift({groupId:"Chatlet",actionArr:[{iconClass:"msi-cliq",tooltip:"Start chat",data:{action:"startChat"}}]})):(prevHeader={id:"zcalPrevHeader",rIcons:[]},"task"!=mode&&prevHeader.rIcons.push({groupId:"Save",actionArr:[{iconClass:"msi-save",tooltip:zcal.i18n.save,data:{action:saveHandler}}]}),null!=zcal.EOBJ.ATT&&prevHeader.rIcons.push({groupId:"Send",actionArr:[{iconClass:"msi-send",tooltip:"Send as mail",data:{action:"eventSend"}}]}),zcal.EOBJ.EID&&("2"==zcal.EOBJ.DPERM&&prevHeader.rIcons.push({groupId:"Delete",actionArr:[{iconClass:"msi-trash",data:{action:"eventDelete"},tooltip:"Delete"}]}),zmail.IntegrationStatus&&zmail.IntegrationStatus.CHAT&&prevHeader.rIcons.push({groupId:"Chatlet",actionArr:[{iconClass:"msi-cliq",tooltip:"Start chat",data:{action:"startChat"}}]})),prevHeader.rIcons.push({groupId:"Close",actionArr:[{iconClass:"msi-close",tooltip:zcal.i18n.close,data:{action:"eventClose"}}]})),prevHeader.text=headerDOM;var centerWrapper=zmsuite.getCenter(),tabNodes=centerWrapper[1].getNodes();zmsuite.renderCenter(),tabNodes[0].push(prevHeader),tabNodes[0].setListener("click",function(a,b){zcalList.bindAction(a,b)}),tabNodes[1].push($(txt)),centerWrapper[1].show();var descParEl=ZCL_$("task"==mode?"zcl_tskdes":"zcl_cedesc");if(descParEl){var descElement=ZCL_LinkParser(zcal.EOBJ.DESC?zcal.EOBJ.DESC:"");for(var i in descElement)3==descElement[i].nodeType&&descElement[i].nodeValue.match(/\s/)&&(descElement[i].nodeValue=descElement[i].nodeValue.replace(/\s/g,"")),descParEl.appendChild(descElement[i])}ZCL_$("zcl_ce_desc")&&(ZCL_$("zcl_ce_desc").value=zcal.EOBJ.DESC?zcal.EOBJ.DESC:""),zmsuite.showWorkSpace(tabId),centerWrapper[0].$el.addClass("SC_sw"),centerWrapper[1].$el.addClass("SC_w100")},ZCL_constEventView=function(data){ZCL_clrStck(),zcal.EOBJ=data?data:ZCL_getAddEventObj(),"c"!=zmApp.currentApp?zcal.EOBJ.EID?(zmsuite.isWorkspaceAvailable("zcal_eContainer")&&zmsuite.closeWorkspace("zcal_eContainer"),zcal.EMODE=1==zcal.EMODE?1:0,ZCL_ConstEventPage()):ZCL_openPopupCreateEvent(zcal.EOBJ):(zmsuite.isWorkspaceAvailable("zcal_eContainer")&&zmsuite.closeWorkspace("zcal_eContainer"),zcal.EMODE=null==zcal.EOBJ.EID||1==zcal.EMODE&&zcal.EOBJ.EPERM&&2==zcal.EOBJ.EPERM?1:0,ZCL_ConstEventPage())},zcal.constEventViewCard=function(){var grpId=zcal.EOBJ.GROUP_ID,entityId=zcal.EOBJ.ENTITY_ID;ZCL_clrStck(),ZCL_eClose();var status=zmsuite.isWorkspaceAvailable("zcal_Container");if(status){var postObj={gid:grpId,pid:entityId,type:4,actionType:"viewGroupEntity"};zmStream.singlePost.init(postObj,function(postDOM){var previewCard=zmsuite.getCenter("zcal_Container")[1],cardHeaderDOM=["DIV",{attrs:{"class":"SC_phd"},child:[["text","Stream view"]]}],cardHeaderConfig={text:[cardHeaderDOM],rIcons:[[{tooltip:"Close",iconClass:"msi-close",data:"close"}]]},cardHeader=previewCard.getNodes()[0];cardHeader.push(cardHeaderConfig);var clsCallBack=function(){zcal.closePrvwCard(previewCard)};cardHeader.setListener("click",clsCallBack);var cardContent=previewCard.getNodes()[1];cardContent.push(postDOM),previewCard.show()})}},zcal.closePrvwCard=function(previewCard){previewCard.close()};var isFreeBusyClicked=!1;zcal.bindCreateEventAction=function(){var _sdEle=ZCL_$("zcl_ce_sd"),_edEle=ZCL_$("zcl_ce_ed");_sdEle&&ZEVENTS(_sdEle.parentNode).picker("date",{dform:zcal.DFORMAT[zcal.cdata.opt.DF],refer:"zcl_ce_sd",wkst:zcal.cdata.opt.WK,mode:"popup",fullDtclk:1,higDate:["14/11/2017","16/11/2017"],update:"yes",minhgt:251}).on("dateclick",function(){ZCL_calcEed(_sdEle)}).bind(),_edEle&&ZEVENTS(_edEle.parentNode).picker("date",{dform:zcal.DFORMAT[zcal.cdata.opt.DF],refer:"zcl_ce_ed",wkst:zcal.cdata.opt.WK,mode:"popup",fullDtclk:1,update:"yes",minhgt:251}).on("dateclick",function(){ZCL_setEed(_edEle)}).bind();var _stEle=ZCL_$("zcl_ce_st"),_etEle=ZCL_$("zcl_ce_et");_stEle&&ZEVENTS(_stEle).picker("time",{tform:zcal.timeformat[zcal.cdata.opt.TF],refer:"zcl_ce_st"}).on("change",function(){ZCL_calcEed(_stEle,!0)}).bind(),_etEle&&ZEVENTS(_etEle).picker("time",{tform:zcal.timeformat[zcal.cdata.opt.TF],refer:"zcl_ce_et"}).on("change",function(){ZCL_setEed(_etEle,!0)}).bind(),ZCL_$("zcl_ce_cal")&&$("#zcl_ce_cal").on("change",function(){ZCL_DoGrpChg()}),ZCL_$("zcl_ce_cal")&&$("#zcl_ce_cal").off("click").on("click",function(){var component,calArr=ZCL_getCalArr(),config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.parWidth=!0,config.onSelect=function(id,selectObj){setGroupValue(that,id,selectObj),component.hide()},config.dataCallback=function(){return calArr},$("#zm_flpopup").remove(),component=zmUtil.createFLComp("generic",config),component.show()}),$("#zcl_addevent").on("click",function(ev){"zcl_ce_cal"!=ev.target.id&&$("#zm_flpopup").remove()}),$("#zcl_help").on("click",function(){var url;url=-1!=zcal.ZCAL.indexOf(".stage.skydesk.jp")?"https://www.stage.skydesk.jp/apps/calendar/help/associate-events-with-skydesk-apps.html":-1!=zcal.ZCAL.indexOf(".skydesk.jp")?"https://www.skydesk.jp/apps/calendar/help/associate-events-with-skydesk-apps.html":"https://www.zoho.com/calendar/help/associate-events-with-zoho-apps.html",window.open(url)}),ZCL_$("zcl_ce_ass")&&($(".msi-crm")[0]&&zmComponent.tooltip({elm:$(".msi-crm")[0],text:$(".msi-crm")[0].getAttribute("rel"),arrow:"top"}),$(".msi-meeting")[0]&&zmComponent.tooltip({elm:$(".msi-meeting")[0],text:$(".msi-meeting")[0].getAttribute("rel"),arrow:"top"}),$(".msi-task")[0]&&zmComponent.tooltip({elm:$(".msi-task")[0],text:$(".msi-task")[0].getAttribute("rel"),arrow:"top"}),$(".msi-notes")[0]&&zmComponent.tooltip({elm:$(".msi-notes")[0],text:$(".msi-notes")[0].getAttribute("rel"),arrow:"top"})),document.onmouseup=function(ev){if("zcl_iatt_lst"!=ev.target.id&&ZCL_$("zcl_ce_att_tbox")&&""!=$("#zcl_ce_att_tbox")[0].value){var emlid=$("#zcl_ce_att_tbox")[0].value;if(ZCL_isEmail(emlid)){var data={};data.id=emlid,ZCL_attCont(data),$("#zcl_ce_att_tbox").val("")}}},ZCL_$("zcl_ce_att")&&($("#zcl_ce_att_tbox").on("keydown",function(event){if(13==event.keyCode&&"zcl_ce_att_tbox"==this.id){for(var attArr=this.value.split(","),z=0;z<attArr.length;z++){var _emlid=attArr[z].trim(),idx1=_emlid.indexOf("<"),idx2=_emlid.indexOf(">");idx1>-1&&idx2>-1&&(_emlid=_emlid.substring(idx1+1,idx2)),_emlid=_emlid.replace(/,/g,"")}if(ZCL_isEmail(_emlid)){var data={};data.id=_emlid,setTimeout(function(){""!=$("#zcl_ce_att_tbox").val()&&(ZCL_attCont(data),$("#zcl_ce_att_tbox").val(""))},10)}}}),zmAppLoader.load("zmContactsAutoComplete").done(function(){zmContactsAutoComplete.autoComplete({input:$("#zcl_ce_att_tbox")[0],excludeMe:!0,contactType:["org","crm","personal"],exclude:function(){var email=[];if($("#zcl_ce_attlst")[0])for(var attl=$("#zcl_ce_attlst")[0].childNodes[0].childNodes,i=0;i<attl.length;i++)email.push(attl[i].getElementsByTagName("B")[0].innerHTML);else if($("#attlist")[0].childNodes){var attl=$("#attlist")[0].childNodes;for(var i in attl)email.push(attl[i].id)}return email},onSelect:function(event,data){var data=data.item.attributes;ZCL_attCont(data),$("#zcl_ce_att_tbox").val("")}})})),ZCL_$("zcl_ce_aday")&&$("#zcl_ce_aday").parent().off("click").on("click",function(){ZCL_ChgChk(this),ZCL_checkAll()}),ZCL_$("zcl_ce_tza")&&$("#zcl_ce_tza").parent().off("click").on("click",function(){if(zcal.EOBJ.ETZ){if(zcal.timezones.length>0)for(var i in zcal.timezones)zcal.timezones[i][zcal.EOBJ.ETZ]&&ZCL_openTZPopup(zcal.timezones[i][zcal.EOBJ.ETZ],zcal.EOBJ.ETZ);else ZCL_uXHR("/cal/timez.do",function(res){zcal.timezones=ZCL_Evl(1,res.responseText);for(var i in zcal.timezones)zcal.timezones[i][zcal.EOBJ.ETZ]&&ZCL_openTZPopup(zcal.timezones[i][zcal.EOBJ.ETZ],zcal.EOBJ.ETZ)})}else ZCL_openTZPopup(zcal.cdata.opt.CTIM,zcal.cdata.opt.TIM)}),ZCL_$("zcl_ce_inetz")&&$("#zcl_ce_inetz").parent().off("click").on("click",function(){ZCL_ChgChk(this)}),ZCL_$("zcl_fblnk")&&$("#zcl_fblnk").off("click").on("click",function(){isFreeBusyClicked||zcalFreebusy.loadFB()}),ZCL_$("zcl_gatt_add")&&$("#zcl_gatt_add").off("click").on("click",function(){zcalGroup.listGroupForAttSel()}),ZCL_$("zcl_ce_rem")&&$("#zcl_ce_rem .msi-close").off("click").on("click",function(){var addremEle,reminderEle=this.parentNode.parentNode.parentNode;reminderEle.removeChild(this.parentNode.parentNode),addremEle=reminderEle.querySelector("#zcl_addrem"),addremEle||ZCL_AppendRemAddLnk(reminderEle)}),ZCL_$("zcl_ve_lnk")&&$("#zcl_ve_lnk").on("click",function(e){var eid=ZCL_$("zcl_eid").value;window.open(location.protocol+"//"+zcal.ZCAL+"/cal/nxtPag.do?sname=elnk&evid="+eid,"_blank"),ZCL_stopEvents(e)}),ZCL_$("zcl_setrem")&&$("#zcl_setrem").on("click",function(){ZCL_SetAlrm()});var eventForm=$("#zcl_ce");$groupAtt=eventForm.find("[data-marker=groupAtt]"),$groupAtt.length>0&&($groupAtt.removeAttr("data-marker"),$groupAtt.off("click").on("click",function(){var $ele=$(this),gid=$ele.data("gid"),mode=$ele.data("sts");ZCL_listGroupUserAtt(gid,mode)}))},ZCL_attCont=function(data){var div=$("#attlist"),nDiv=document.createElement("ul");data.zid&&nDiv.setAttribute("data-zid",data.zid),nDiv.setAttribute("id",data.id),nDiv.setAttribute("class","zcl_sl"),$("#zcl_ce_attlst")[0]?(nDiv.innerHTML="<li>"+(data.profileImage?"<img src="+data.profileImage+">":"<img src="+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+">")+"</li><li><b>"+data.id+'</b></li><li class="zcl_txr"><i class="msi-pending" title="Status &quot;Pending&quot;"></i><i class="msi-close" onclick="ZCL_rmvAtt(this,\''+data.id+'\')" title="Remove" ></i></li>',$("#zcl_ce_attlst").prepend(div.append($(nDiv)))):(nDiv.innerHTML="<li>"+(data.profileImage?"<img src="+data.profileImage+">":"<img src="+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+">")+"</li><li><b>"+data.id+'</b></li><li class="zcl_txr" style="width:20px"><i class="msi-close" onclick="ZCL_rmvAtt(this,\''+data.id+'\')" title="Remove" ></i></li>',div.append($(nDiv)))};var setGroupValue=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("rel",id),ZCL_DoGrpChg()};ZCL_selBox=function(id,selVal,valArr){for(var _dd='<div class="SC_select"><select class="select" id="'+id+'">',i=0;i<valArr.length;i++)_dd+="<option "+(i==selVal?"selected":"")+' value="'+i+'">'+valArr[i]+"</option>";return _dd+="</select></div>"},ZCL_selBox1=function(id,selVal,valArr){var _dd='<div class="SC_select"><select class="select" id="'+id+'">';for(var i in valArr)_dd+="<option "+(i==selVal?"selected":"")+' value="'+i+'">'+valArr[i]+"</option>";return _dd+="</select></div>"},ZCL_SetMetaInfo=function(attTxt){var ctime=zcal.EOBJ.CRETIME.split(","),mtime=zcal.EOBJ.LSTMODTIME.split(","),txt='<ul class="zcl_vwmeta"><li><span onclick="ZCL_tgleNxtEle(this)"><i class="'+(""!=attTxt?"msi-rarrow":"msi-barrow")+'"></i>'+(3==zcal.EOBJ.ETYPE?zcal.i18n.taskinfo:zcal.i18n.eventinfo)+"</span></li>";return txt+="<li "+(""!=attTxt?'style="display:none"':"")+'><div class="zcl_table">',zcal.EOBJ.ORGM&&""!=zcal.EOBJ.ORGM&&(txt+="<ul><li>"+(zcal.EOBJ.ORG_PH?'<img src="'+zcal.EOBJ.ORG_PH+'"/>':"")+"</li><li><b>"+zcal.i18n.organizer+'</b><span class="zcl_lk">'+zcal.EOBJ.ORGM+"</span></li></ul>"),txt+=zcal.EOBJ.CREBY?"<ul><li>"+(zcal.EOBJ.CREBY_PH?'<img src="'+zcal.EOBJ.CREBY_PH+'">':"")+"</li><li><b>"+zcal.i18n.createdby+'</b><span class="zcl_lk">'+zcal.EOBJ.CREBY+"</span><u>"+ZCL_parseDateStr(ctime[1]).dateBy("NNN dd, yyyy")+" @ "+ZCL_parseTime(ctime[2]).HH+":"+ZCL_parseTime(ctime[2]).mm+"</u></li></ul>":"<ul><li>"+(zcal.EOBJ.CREBY_PH?'<img src="'+zcal.EOBJ.CREBY_PH+'">':"")+"</li><li><b>"+zcal.i18n.createdon+"</b><u>"+ZCL_parseDateStr(ctime[1]).dateBy("NNN dd, yyyy")+" @ "+ZCL_parseTime(ctime[2]).HH+":"+ZCL_parseTime(ctime[2]).mm+"</u></li></ul>",txt+=zcal.EOBJ.MODBY?"<ul><li>"+(zcal.EOBJ.MODBY_PH?'<img src="'+zcal.EOBJ.MODBY_PH+'"/>':"")+"</li><li><b>"+zcal.i18n.modifiedby+'</b><span class="zcl_lk">'+zcal.EOBJ.MODBY+"</span><u>"+ZCL_parseDateStr(mtime[1]).dateBy("NNN dd, yyyy")+" @ "+ZCL_parseTime(mtime[2]).HH+":"+ZCL_parseTime(mtime[2]).mm+"</u></li></ul>":"<ul><li>"+(zcal.EOBJ.MODBY_PH?'<img src="'+zcal.EOBJ.MODBY_PH+'"/>':"")+"</li><li><b>"+zcal.i18n.modifiedon+"</b><u>"+ZCL_parseDateStr(mtime[1]).dateBy("NNN dd, yyyy")+" @ "+ZCL_parseTime(mtime[2]).HH+":"+ZCL_parseTime(mtime[2]).mm+"</u></li></ul>",txt+="</div></li></ul>"},ZCL_SetIndAttLst=function(sty){var attTxt="",txt="";if(zcal.EOBJ.ATT&&(zcal.EOBJ.ATT.USR||zcal.EOBJ.ATT.GRP)&&(attTxt+='<ul class="zcl_viwatt" id="zcl_ce_aslst">'+ZCL_attStsLnk("all",sty)+ZCL_attStsLnk("yes",sty)+ZCL_attStsLnk("no",sty)+ZCL_attStsLnk("maybe",sty)+ZCL_attStsLnk("pending",sty)+"</ul>",attTxt+='<div id="zcl_ce_attlst">'+ZCL_ListAtt(sty)+"</div>"),1==zcal.EMODE){txt+='<ul class="zcl_frmrw" id="zcl_ce_attdv"><li class="zcl_att"><u>'+zcal.i18n.attendees+"</u>",txt+='<ul class="zcl_frmrw zcl_pddbz"><li id="zcl_iatt_lst" class="zcl_atte"><div id="zcl_ce_att"><input type="text" class="zm_sgst" placeholder="'+zcal.i18n.typeaemailid+'" id="zcl_ce_att_tbox"></div>';var calId,calObj,hasGrp=ZCL_hasGrp();calId=ZCL_$("zcl_ce_cal")?ZCL_$("zcl_ce_cal").getAttribute("rel"):zcal.EOBJ.CNAME,calObj=zcal.getCalObj(calId),hasGrp&&""==calObj[14]&&(txt+='<i class="msi-addgroup" id="zcl_gatt_add"></i>'),txt+='</li></ul><div class="zcl_txr"><span id="zcl_fblnk" class="zcl_lk">'+zcal.i18n.freebusy+"</span></div>",txt+='<div class="section-content startup" style=""><span id="zcl_evhelp" class="startup help" style="margin: 20px 0px;width: auto"><em><img src="//img.zohostatic.com/zmail/zm/103.1/images/settings/lightbulb-info.png" class="info-message"></em><span style="white-space: normal;">'+zcal.i18n.eventmsg+"</span></span></div>"}return txt+='<div><div class="zcl_viwatlst zcl_table" id="attlist"></div>',txt+="</div>",""!=attTxt&&(txt+='<ul class="zcl_frmrw zcl_vwatte"><li><div>'+attTxt+"</div></li></ul>"),txt},ZCL_hasGrp=function(){var perGrpCnt,orgGrpCnt,hasGrp=!1;return perGrpCnt=zcal.cdata.grpLst&&zcal.cdata.grpLst.pgrp?Object.keys(zcal.cdata.grpLst.pgrp).length:0,perGrpCnt>0?!0:(orgGrpCnt=zcal.cdata.grpLst&&zcal.cdata.grpLst.ogrp?Object.keys(zcal.cdata.grpLst.ogrp):0,orgGrpCnt>0&&(hasGrp=!0),hasGrp)},ZCL_DoGrpChg=function(){var calId,calObj;if(calId=ZCL_$("zcl_ce_cal").getAttribute("rel"),calObj=zcal.getCalObj(calId),""!=calObj[14])if("crm"!=calObj[14]&&null!=ZCL_$("zcl_ce_cal")&&(zcal.CAL_IND=ZCL_$("zcl_ce_cal").selectedIndex),"crm"==calObj[14]||"recruit"==calObj[14]&&(-1!=zcal.cdata.calOUids.indexOf("zohoRecruit4_")||1==zcal.cdata.opt.GTYPE&&"new"==zcal.cdata.opt.VERSION)){if("crm"==calObj[14]&&null!=zcal.EOBJ.EID&&null!=ZCL_OLD_COBJ){var oldCtype=ZCL_OLD_COBJ[5];if(0!=oldCtype)return zmUtil.succErrMsg("e",zcal.i18n.crmothercal),void(ZCL_$("zcl_ce_cal").selectedIndex=zcal.CAL_IND);if(null!=zcal.EOBJ.REP)return zmUtil.succErrMsg("e",zcal.i18n.crmrepadd),void(ZCL_$("zcl_ce_cal").selectedIndex=zcal.CAL_IND)}zcal.EOBJ.CNAME=calId,crmCalId=calId,zcalCRM.showCRMForm()}else"ztask"==calObj[14]?(zcal.EOBJ.CNAME=calId,zcalTask.showTaskForm()):("gcal"==calObj[14]?ZCL_$("zcl_ce_attach")&&(ZCL_$("zcl_ce_attach").parentNode.style.display="none"):ZCL_$("zcl_ce_attach")&&(ZCL_$("zcl_ce_attach").parentNode.style.display=""),ZCL_$("zcl_ce_ass")&&ZCL_$("zcl_ce_ass").parentNode.removeChild(ZCL_$("zcl_ce_ass")),ZCL_$("zcl_ce_pvt")&&ZCL_$("zcl_ce_pvt").parentNode.parentNode.removeChild(ZCL_$("zcl_ce_pvt").parentNode),ZCL_$("zcl_ce_attdv")&&(ZCL_$("zcl_ce_attdv").innerHTML=ZCL_SetEventAtt()),ZCL_$("zcl_ce_color")&&ZCL_$("zcl_ce_color").parentNode.parentNode.parentNode.removeChild(ZCL_$("zcl_ce_color").parentNode.parentNode),ZCL_setGrpCalAlarm(calObj,!0),ZCL_getGrpInvPolicy(calObj));else{if(null!=ZCL_$("zcl_ce_cal")&&(zcal.CAL_IND=ZCL_$("zcl_ce_cal").selectedIndex),!ZCL_$("zcl_ce_ass")){var assTxt=ZCL_SetEventAss();if(""!=assTxt){var assdv=document.createElement("ul");if(assdv.className="zcl_frmrw",assdv.id="zcl_ce_ass",assdv.innerHTML=assTxt,ZCL_$("zcl_ce_ext")){{ZCL_$("zcl_ce_ext").childNodes}ZCL_$("zcl_ce_ext").insertBefore(assdv,ZCL_$("zcl_ce_attdv"))}}}if(!ZCL_$("zcl_ce_pvt")){var pvtlnk=document.createElement("li");pvtlnk.className="zcl_curpt",pvtlnk.onclick=function(){ZCL_ChgChk(this)},pvtlnk.innerHTML='<i class="'+(zcal.EOBJ.CLASS&&1==zcal.EOBJ.CLASS?"msi-check":"msi-uncheck")+'" id="zcl_ce_pvt"></i>'+zcal.i18n.eprivate,ZCL_$("zcl_ce_tit")&&ZCL_$("zcl_ce_tit").parentNode.parentNode.appendChild(pvtlnk)}if(!ZCL_$("zcl_ce_rem")){var erep=document.createElement("ul");erep.className="zcl_frmrw zcl_rem";var remTxt=ZCL_setGrpCalAlarm(calObj,!1);erep.innerHTML='<li id="zcl_ce_rem"><div class="zcl_frmaln" id="zcl_ce_rem">'+remTxt+"</div></div>",ZCL_$("zcl_ce_ele")?ZCL_$("zcl_ce_ele").insertBefore(erep,ZCL_$("zcl_ce_ele").childNodes[1]):ZCL_$("zcl_ce_desc").parentNode.childNodes[3].append(erep)}if(!ZCL_$("zcl_ce_color")){var ecol=document.createElement("ul");ecol.className="zcl_frmrw",ecol.innerHTML=ZCL_EventColorSel(),ZCL_$("zcl_ce_ele")&&ZCL_$("zcl_ce_ele").insertBefore(ecol,ZCL_$("zcl_ce_ele").childNodes[2])}ZCL_$("zcl_ce_attach")&&(ZCL_$("zcl_ce_attach").parentNode.style.display=""),ZCL_$("zcl_ce_attdv")&&(ZCL_$("zcl_ce_attdv").innerHTML=ZCL_SetEventAtt())}zcal.bindCreateEventAction()},ZCL_openPopupCreateEvent=function(eObj){var sd,ed,st,et,aday,title,desc,tempObj=ZCL_getAddEventObj(),ttemp=zcal.timeformat[zcal.cdata.opt.TF];aday=eObj.ADAY&&1==eObj.ADAY?!0:!1,sd=eObj.SD?eObj.SD:tempObj.SD,ed=eObj.ED?eObj.ED:tempObj.ED,st=eObj.ST?eObj.ST:tempObj.ST,et=eObj.ET?eObj.ET:tempObj.ET;var cObj,calId=eObj.CNAME?eObj.CNAME:tempObj.CNAME;cObj=zcal.getCalObj(calId),title=eObj.SUM?ZCL_getHTML(eObj.SUM):"",desc=eObj.DESC?eObj.DESC:"";var tim1=st.getTimeBy(ttemp),tim2=et.getTimeBy(ttemp),de1=ZCL_splitDateVal(ZCL_putDate(sd)),de2=ZCL_splitDateVal(ZCL_putDate(ed)),ParST=ZCL_parseTime(tim1),ParET=ZCL_parseTime(tim2);ZCL_ESDATE=new Date(de1[2],de1[1]-1,de1[0],ParST.HH,ParST.mm,0,0),ZCL_EEDATE=new Date(de2[2],de2[1]-1,de2[0],ParET.HH,ParET.mm,0,0);var compOffset,compTop,compLeft,quickEvent,rem=ZCL_SetEventAlrm(cObj),compEle=$(".zm_compose");quickEvent=$(zcalTemplate.popupCreateEvent({sum:title,desc:desc,sd:ZCL_putDate(sd),st:tim1,ed:ZCL_putDate(ed),et:tim2,reminder:rem})),compOffset=compEle.offset(),compTop=compOffset.top+"px",compLeft=compOffset.left+compEle.width()+"px";var option={title:zcal.i18n.createevt,mask:!0,posParent:{top:compTop,left:compLeft},buttons:[{txt:zcal.i18n.save,callback:function(){ZCL_savePopupEvent(eObj)}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){zmMention.clearMention($("#zcl_ppce_tit")),zmUtil.hideMenu()}}],closeaction:function(){zmMention.clearMention($("#zcl_ppce_tit")),zmUtil.hideMenu()}};if(ZCL_$("zcl_addevent")||$("body").append('<div id="zcl_addevent"></div>'),$("#zcl_addevent").html(quickEvent),zmsDialog.create("zcl_addevent",option),ZCL_$("zcl_ppce_tit")){var fillObj={contentArray:"org",compare:["fn","ln","nn","eid"],LType:"3",OType:"3",drag:!1};zmAutoFill.setAutofill(fillObj,$("#zcl_ppce_tit"))}$("#zmsdialog_zcl_addevent").mousedown(function(ev){zmUtil.stopEvents(ev,!0),$(".zcal_cn").remove(),$(".zcal_tilst").remove()}),zcal.bindCreateEventAction()},ZCL_savePopupEvent=function(eObj){var title,loc,mentionObj,attEmails;if(title=ZCL_$("zcl_ppce_tit").parentNode.firstChild.innerHTML.split("<b")[0],""==title&&(title=ZCL_$("zcl_ppce_tit").value),loc=ZCL_$("zcl_ce_loc").value,mentionObj=zmMention.getMentions($("#zcl_ppce_tit")),attEmails=ZCL_streamEve.getMentionEmails(mentionObj),""==title)return zmUtil.succErrMsg("e",zcal.i18n.plenttle),ZCL_$("zcl_ppce_tit").focus(),!1;if(!ZCL_dateValidate("zcl_ce_sd",zcal.i18n.evest)||!ZCL_dateValidate("zcl_ce_ed",zcal.i18n.eveed))return!1;if(!ZCL_dateTimeComparison("zcl_ce_ed","zcl_ce_et",zcal.i18n.eveed,"zcl_ce_sd","zcl_ce_st",zcal.i18n.evest,"G"))return!1;if(!zcal.validate(ZCL_$("zcl_ce_desc").value))return zmUtil.succErrMsg("e",zcal.i18n.spchevenot),ZCL_$("zcl_ce_desc").focus(),!1;var st=""==zcal.$("zcl_ce_st").style.display?zcal.$("zcl_ce_st").value:"00:00",et=""==zcal.$("zcl_ce_et").style.display?zcal.$("zcl_ce_et").value:"00:00",calId=zcal.$("zcl_ce_cal").getAttribute("rel"),cObj=zcal.getCalObj(calId),eventObj={EID:"",EUID:"",EPERM:cObj[12]>=2?2:1==cObj[12]?1:0,DPERM:cObj[12]>=2?2:0,SD:ZCL_$("zcl_ce_sd").value,ST:ZCL_TimetoNo(st),ED:ZCL_$("zcl_ce_ed").value,ET:ZCL_TimetoNo(et),ADAY:"msi-check"==ZCL_$("zcl_ce_aday").className?1:0,LOC:loc,DESC:ZCL_$("zcl_ce_desc").value,ALARM:""==cObj[14]?ZCL_getAlarm("zcl_ce_rem"):"",ETZ:"",IN_ETZ:!1,CLASS:0,IMP:0,CNAME:calId,TRANS:1,ETSK:0,ECRM:0,ENTS:0,EMET:0,LINK:"",SUM:title,EC:-1,ATT:attEmails,ADD_MODE:"PP",MSGID:eObj.msgId,ACCID:eObj.accId,failureCallbk:eObj.failureCallbk,successCallbk:eObj.successCallbk};ZCL_detailObj(eventObj),zmMention.clearMention($("#zcl_ppce_tit")),zmUtil.hideMenu()};var zcalTask=function(){var taskCalId,subTaskCount,oldSubTaskCount,isOld,isAddSub,subTasksArr,openTaskForm=function(){if(taskCalId=zcal.EOBJ.CNAME,oldSubTaskCount=zcal.EOBJ.SUBTASKSCOUNT||0,subTaskCount=oldSubTaskCount,subTasksArr=zcal.EOBJ.SUBTASKS||[],null==zcal.EOBJ.EID){getFormData();var dd=ZCL_putDate(zcal.EOBJ.SD);dd=formatDate(dd),isOld=new Date(dd).setHours(23,59,59)>(new Date).getTime()?!1:!0,isAddSub=!isOld}else{var dd=new Date(zcal.EOBJ.DUEDATE).setHours(23,59,59);isOld=dd>(new Date).getTime()?!1:!0,isAddSub=zcal.EOBJ.APERM&&"2"==zcal.EOBJ.APERM?!0:!1}constTaskForm()},updateTaskInfo=function(){if(taskCalId=zcal.EOBJ.CNAME,oldSubTaskCount=zcal.EOBJ.SUBTASKSCOUNT||0,subTaskCount=oldSubTaskCount,subTasksArr=zcal.EOBJ.SUBTASKS||[],zcal.EOBJ.EID){var dd=new Date(zcal.EOBJ.DUEDATE).setHours(23,59,59);isOld=dd>(new Date).getTime()?!1:!0,isAddSub=zcal.EOBJ.APERM&&"2"==zcal.EOBJ.APERM?!0:!1}else{var dd=ZCL_putDate(zcal.EOBJ.SD);dd=formatDate(dd),isOld=new Date(dd).setHours(23,59,59)>(new Date).getTime()?!1:!0,isAddSub=!isOld}constTaskForm()},getFormData=function(){zcal.EOBJ.SUM=ZCL_$("zcl_ce_tit")?ZCL_$("zcl_ce_tit").value:zcal.EOBJ.SUM,zcal.EOBJ.Description=ZCL_$("zcl_ce_desc")?ZCL_$("zcl_ce_desc").value:"",zcal.EOBJ.SD=ZCL_$("zcl_ce_sd")?ZCL_DFDate(ZCL_$("zcl_ce_sd").value):zcal.EOBJ.SD,zcal.EOBJ.ST=ZCL_$("zcl_ce_st")?ZCL_TimetoNo(""==ZCL_$("zcl_ce_st").style.display?ZCL_$("zcl_ce_st").value:"00:00"):zcal.EOBJ.ST,zcal.EOBJ.ED=ZCL_$("zcl_ce_ed")?ZCL_DFDate(ZCL_$("zcl_ce_ed").value):zcal.EOBJ.ED,zcal.EOBJ.ET=ZCL_$("zcl_ce_et")?ZCL_TimetoNo(""==ZCL_$("zcl_ce_et").style.display?ZCL_$("zcl_ce_et").value:"00:00"):zcal.EOBJ.ET},constTaskForm=function(){ZCL_clrStck();var txt='<div class="zcl zcl_CMS zcl_H100" id="zcl_ce">';if(txt+=setHiddenFlds(),txt+='<div class="zcl_table zcl_H100">',txt+=0==zcal.EMODE?'<ul><li><ul class="zcl_crevnt" id="zcl_ce_ele"><li>'+(zcal.EOBJ.IS_SUB_TASK?'<span class="SC_lnk">'+zcal.EOBJ.PARENT_TITLE+"</span>":"")+'<ul class="zcl_vwev"><li>'+setTaskTitle(0)+setTaskDueDate(0)+setTaskPriority(0)+setTaskStatus(0)+setTaskReminder(0)+setCalName()+setTaskCategory()+setTaskDesc(0)+"</li>"+(oldSubTaskCount>0?constSubTaskView():"")+'</ul></li></ul></li><li class="zcl_Cer zcl_vwCer" id="zcl_ce_ext">'+setMetaInfo()+"</li></ul>":'<ul><li><ul class="zcl_crevnt" id="zcl_ce_ele"><li>'+(zcal.EOBJ.IS_SUB_TASK?'<span class="SC_lnk" style="padding-bottom: 10px;display:inline-block;">'+zcal.EOBJ.PARENT_TITLE+"</span>":"")+setTaskTitle(1)+setTaskDueDate(1)+setTaskPriority(1)+setTaskStatus(1)+setTaskReminder(1)+setTaskDesc(1)+setCalName()+setTaskCategory()+"</li>"+(oldSubTaskCount>0?constSubTaskView():"")+(zcal.EOBJ.IS_SUB_TASK||isOld||!isAddSub?"<li>"+constButton()+"</li>":'<li class="zcl_ce_ad_sbtk"><ul class="zcl_frmrw"><li><ul id="zcl_addsubtask"><li><span><i class="msi-add"></i>Add Subtask</span></li></ul></li></ul><ul class="zcl_frmrw"><li><span class="startup  help"><em><img src="//img.zohostatic.com/zmail/zm/101.2/images/settings/lightbulb-info.png" class="info-message"></em><span>Task will be created in Calendar "Zoho Tasks" and Task Views(My Tasks).</span></span></li></ul></li><li>'+constButton()+"</li>")+'</ul></li><li class="zcl_Cer zcl_vwCer" id="zcl_ce_ext" style="'+(zcal.EOBJ.EID?"":"visibility:hidden")+'">'+(zcal.EOBJ.EID?setMetaInfo():"")+"</li></ul>",txt+="</div></div>",ZCL_$("zcl_ce")?(ZCL_updEventPrevHeader("task"),$("#zcl_ce").parent().html(txt)):ZCL_setEventWorkSpace(txt,"task"),zcal.EOBJ.EID&&1==zcal.EMODE){bindChangeActions();for(var subTaskDivArr=ZCL_$("zcl_ce_ele").querySelectorAll("div[id^='zcl_task_']"),i=0;i<subTaskDivArr.length;i++){var subDiv=subTaskDivArr[i],editDv=subDiv.querySelector("span[id^='zcl_task_edit_']");ZCALaddListener(editDv,"mousedown",editClick);var delDv=subDiv.querySelector("span[id^='zcl_task_del_']");ZCALaddListener(delDv,"mousedown",delClick)}}1==zcal.EMODE&&bindAction()},editClick=function(e){var nde=e.target||e.srcElement,id=nde.id,idx=parseInt(id.match(/\d+$/)[0]),$subTitle=$("#zcl_task_"+idx).find("input[id='zcl_ce_tit_"+idx+"']");if($subTitle.length>0){var obj=subTasksArr[idx];editTask(obj.EUID,obj,idx)}else constEditDiv(nde)},delClick=function(e){var nde=e.target||e.srcElement;delSubTask(nde)},delSubTask=function(nde){var id=nde.id,idx=parseInt(id.match(/\d+$/)[0]),mode=nde.innerText;if(subTaskCount>idx){var obj=subTasksArr[idx];if(!$.isEmptyObject(obj)&&obj.hasOwnProperty("EID")&&mode==zcal.i18n.del){zcalQAdd.del(obj.EID,obj.EUID,zcal.EOBJ.CNAME),subTasksArr.splice(idx,1),subTaskCount=subTasksArr.length;var delDv=ZCL_$("zcl_task_"+idx);if(subTaskCount>0)delDv.parentElement.children[0].innerHTML=1==subTaskCount?subTaskCount+"Subtasks":subTaskCount+"Subtask",delDv.parentElement.removeChild(delDv);else{var rmNde=delDv.parentElement;rmNde.parentElement.removeChild(rmNde)}reIndex()}else{if(obj.hasOwnProperty("EID")&&mode==zcal.i18n.cancel)return void constViewDiv(obj,idx);if(mode==zcal.i18n.cancel){subTasksArr.splice(idx,1),subTaskCount--;var delNode=ZCL_$("zcl_task_"+idx);delNode.parentElement.removeChild(delNode),reIndex(),ZCL_$("zcl_ce_ele").querySelector(".zcl_ce_ad_sbtk")?ZCL_$("zcl_ce_ele").querySelector(".zcl_ce_ad_sbtk").children[0].style.display="":""}}}},constEditDiv=function(nde){var id=nde.id,idx=parseInt(id.match(/\d+$/)[0]),dv=ZCL_$("zcl_task_"+idx),ulArr=dv.querySelectorAll("ul.zcl_frmrw"),ztaskPrioriy=[zcal.i18n.ztask_priority_high,zcal.i18n.ztask_priority_medium,zcal.i18n.ztask_priority_low],ztaskStatus=[zcal.i18n.inprogress,zcal.i18n.completed],obj=subTasksArr[idx],dd=formatDate(obj.DUEDATE),duedate=new Date(dd).dateBy(zcal.DATEFORMAT[zcal.cdata.opt.DF]);if(ulArr[0].innerHTML='<li style="width: 400px;"><u>Subtask Title</u><input type="text" placeholder="Subtask title" class="zcl_crevntt SC_tiput" id="zcl_ce_tit_'+idx+'" value="'+obj.TITLE+'"></li>',ulArr[1].innerHTML='<li class="zcl_select"><u>'+zcal.i18n.duedate+'</u><input type="text" class="zcl_w100 SC_tiput" id="zcl_ce_dd_'+idx+'" value="'+duedate+'" readonly></li><li><u>'+zcal.i18n.priority+"</u>"+ZCL_selBox("zcl_task_pri_"+idx,obj.PRIORITY||1,ztaskPrioriy)+"</li><li><u>"+zcal.i18n.status+"</u>"+ZCL_selBox("zcl_task_sts_"+idx,obj.STATUS||0,ztaskStatus)+"</li>",3==ulArr.length)ulArr[2].innerHTML='<li class="zcl_W70pc"><u>'+zcal.i18n.description+'</u><textarea style="height:44px;" id="zcl_ce_desc_'+idx+'" class="zcl_Cedes SC_tiput">'+(obj.DESC||"")+"</textarea></li>";else{var ul=document.createElement("UL");ul.className="zcl_frmrw",ul.innerHTML='<li class="zcl_W70pc"><u>'+zcal.i18n.description+'</u><textarea style="height:44px;" id="zcl_ce_desc_'+idx+'" class="zcl_Cedes SC_tiput"></textarea></li>',dv.insertBefore(ul,dv.children[2])}var ulHide=ZCL_$("zcl_ce_ele").querySelector(".zcl_ce_ad_sbtk");ulHide&&(ulHide.children[0].style.display="none"),$("#zcl_task_edit_"+idx).text(zcal.i18n.save),$("#zcl_task_del_"+idx).text(zcal.i18n.cancel),bindValidation(idx)},constViewDiv=function(obj,pos){var id=pos,dv=ZCL_$("zcl_task_"+id);dv.setAttribute("rel",obj.EID);var ulArr=dv.querySelectorAll("ul.zcl_frmrw"),ztaskPrioriy=[zcal.i18n.ztask_priority_high,zcal.i18n.ztask_priority_medium,zcal.i18n.ztask_priority_low],ztaskStatus=[zcal.i18n.inprogress,zcal.i18n.completed],_due=formatDate(obj.DUEDATE),_tit=obj.TITLE,_pri=obj.PRIORITY,_sts=obj.STATUS,df=zcal.DATEFORMAT[zcal.cdata.opt.DF];if(ulArr[0].innerHTML="<li><b>"+_tit+"</b></li>",ulArr[1].innerHTML='<li><div class="zcl_table"><ul><li><u>'+zcal.i18n.duedate+"</u>"+new Date(_due).dateBy(df)+"</li><li><u>"+zcal.i18n.priority+"</u><span>"+ztaskPrioriy[_pri]+"</span></li><li><u>"+zcal.i18n.status+"</u><span>"+ztaskStatus[_sts]+"</span></li></ul></div></li>",3==ulArr.length)""==obj.DESC?ulArr[2].parentElement.removeChild(ulArr[2]):ulArr[2].innerHTML="<li><u>"+zcal.i18n.description+"</u>"+obj.DESC+"</li>";else if(""!=obj.DESC){var ul=document.createElement("UL");ul.className="zcl_frmrw",ul.innerHTML="<li><u>"+zcal.i18n.description+"</u>"+obj.DESC+"</li>"}var ulHide=ZCL_$("zcl_ce_ele").querySelector(".zcl_ce_ad_sbtk");ulHide&&(ulHide.children[0].style.display=""),$("#zcl_task_edit_"+pos).text(zcal.i18n.edit),$("#zcl_task_del_"+pos).text(zcal.i18n.del)},constSubTaskView=function(){var li=document.createElement("LI");li.className="zcl_vw_su_cn",li.style.paddingLeft="20px";for(var txt="<b>"+(subTaskCount>0?1==subTaskCount?subTaskCount+" Subtask":subTaskCount+" Subtasks":"No Subtasks")+"</b>",ztaskPrioriy=[zcal.i18n.ztask_priority_high,zcal.i18n.ztask_priority_medium,zcal.i18n.ztask_priority_low],ztaskStatus=[zcal.i18n.inprogress,zcal.i18n.completed],df=zcal.DATEFORMAT[zcal.cdata.opt.DF],i=0;i<subTasksArr.length;i++){var _due,obj=subTasksArr[i],_tit=obj.TITLE,_dd=obj.DUEDATE;_dd.indexOf("/")>0?(_dd=formatDate(_dd),_due=new Date(_dd).getDateBy(df)):(_due=new Date(_dd).getDateBy(df),subTasksArr[i].DUEDATE=_due);{var _pri=obj.PRIORITY||1,_des=obj.DESC||"",_sts=obj.STATUS||0;obj.REMINDER||!1}txt+='<div id="zcl_task_'+i+'" rel="'+obj.EID+'"><ul class="zcl_frmrw"><li><b>'+_tit+'</b></li></ul><ul class="zcl_frmrw"><li><div class="zcl_table"><ul><li><u>'+zcal.i18n.duedate+"</u>"+_due+"</li><li><u>"+zcal.i18n.priority+"</u><span>"+ztaskPrioriy[_pri]+"</span></li><li><u>"+zcal.i18n.status+"</u><span>"+ztaskStatus[_sts]+"</span></li></ul></div></li></ul>"+(""!=_des?'<ul class="zcl_frmrw"><li><u>'+zcal.i18n.description+"</u>"+_des+"</li></ul>":"")+(zcal.EOBJ.EID&&1==zcal.EMODE?'<span class="zcl_lk" id="zcl_task_edit_'+i+'">'+zcal.i18n.edit+'</span><span class="zcl_sep"></span><span class="zcl_lk" id="zcl_task_del_'+i+'">'+zcal.i18n.del+"</span>":"")+"</div>"}return li.innerHTML=txt,li.outerHTML},constSubTaskLst=function(){var ztaskPrioriy=[zcal.i18n.ztask_priority_high,zcal.i18n.ztask_priority_medium,zcal.i18n.ztask_priority_low],ztaskStatus=[zcal.i18n.inprogress,zcal.i18n.completed],_title="",_desc="",_due=zcal.EOBJ.SD;id=subTaskCount;var newDv=document.createElement("DIV");newDv.id="zcl_task_"+id,newDv.setAttribute("rel","new"),newDv.innerHTML='<ul class="zcl_frmrw"><li class="" style="width: 400px;"><u>Subtask Title</u><input type="text" placeholder="Subtask title" class="zcl_crevntt SC_tiput" id="zcl_ce_tit_'+id+'" value="'+_title+'"></li></ul><ul class="zcl_frmrw"><li class="zcl_select"><u>'+zcal.i18n.duedate+'</u><input type="text" class="zcl_w100 SC_tiput" id="zcl_ce_dd_'+id+'" value="'+ZCL_putDate(_due)+'" readonly></li><li><u>'+zcal.i18n.status+"</u>"+ZCL_selBox("zcl_task_sts_"+id,0,ztaskStatus)+"</li><li><u>"+zcal.i18n.priority+"</u>"+ZCL_selBox("zcl_task_pri_"+id,1,ztaskPrioriy)+'</li></ul><ul class="zcl_frmrw"><li class="zcl_W70pc"><u>'+zcal.i18n.description+'</u><textarea style="height:44px;" id="zcl_ce_desc_'+id+'" class="zcl_Cedes SC_tiput">'+_desc+"</textarea></li></ul>"+(zcal.EOBJ.EID?'<span class="zcl_lk" id="zcl_task_edit_'+id+'">'+zcal.i18n.add+"</span>":"")+(zcal.EOBJ.EID?'<span class="zcl_sep" style="display: inline-block;margin:0 10px;border-left:1px solid #bfbfbf;height:10px;width:0;font-size:0;line-height:0;vertical-align:middle;"></span>':"")+'<span class="zcl_lk" id="zcl_task_del_'+id+'">'+zcal.i18n.cancel+"</span>";var x=ZCL_$("zcl_ce_ele").querySelector(".zcl_vw_su_cn")?!0:!1;if(x){var li=ZCL_$("zcl_ce_ele").querySelector(".zcl_vw_su_cn");li.appendChild(newDv)}else{var li=document.createElement("LI");li.className="zcl_vw_su_cn",li.appendChild(newDv);var create=ZCL_$("zcl_ce_ele");create.insertBefore(li,create.childNodes[1])}bindValidation(id);var $delSubTask=$("#zcl_task_"+id).find("span[id='zcl_task_del_"+id+"']");$delSubTask.length>0&&$delSubTask.off("click").on("click",function(e){var nde=e.target||e.srcElement;delSubTask(nde)});var $subSave=$("#zcl_task_"+id).find("span[id='zcl_task_edit_"+id+"']");$subSave.length>0&&$subSave.off("mousedown").on("mousedown",function(){var id=$subSave.attr("id"),idx=parseInt(id.match(/\d+$/)[0]),mode=$subSave.text();if(mode==zcal.i18n.edit)constEditDiv($subSave[0]);else if(mode==zcal.i18n.add){var obj={};obj.title=ZCL_$("zcl_ce_tit_"+idx).value,obj.duedate=ZCL_$("zcl_ce_dd_"+idx).value,obj.priority=ZCL_$("zcl_task_pri_"+idx).value,obj.status=ZCL_$("zcl_task_sts_"+idx).value,obj.desc=ZCL_$("zcl_ce_desc_"+idx).value,createNewSubTask(obj,idx)}else if(mode==zcal.i18n.save){var euid=subTasksArr[idx].EUID,obj=subTasksArr[idx];editTask(euid,obj,idx)}})},bindValidation=function(id){var $subTitle=$("#zcl_task_"+id).find("input[id='zcl_ce_tit_"+id+"']");$subTitle.length>0&&$subTitle.off("change").on("change",function(){var _titl=$subTitle.val();""==_titl.trim()&&(zmUtil.succErrMsg("e",zcal.i18n.plenttle),$subTitle.focus())});var $dateField=$("#zcl_task_"+id).find("input[id='zcl_ce_dd_"+id+"']");if($dateField.length>0){var dateVal,dField=$dateField[0],today=new Date(zcal.cdate),dateFormat=zcal.DFORMAT[zcal.cdata.opt.DF];dateVal=today.dateBy(dateFormat),ZEVENTS(dField).picker("date",{dform:dateFormat,range:[dateVal,""],refer:dField.id,wkst:0,mode:"popup",update:"yes",minhgt:251}).on("dateclick",function(){dateValidate(dField)}).bind()}var $subSummary=$("#zcl_task_"+id).find("textarea[id='zcl_ce_desc_'"+id+"']");$subSummary.length>0&&$subSummary.off("change").on("change",function(){var _sum=$subSummary.val();""==_sum.trim()&&(zmUtil.succErrMsg("e",zcal.i18n.plenttle),$subSummary.focus())})},reIndex=function(){for(var titID="zcl_ce_tit_",ddID="zcl_ce_dd_",stsID="zcl_task_sts_",prioID="zcl_task_pri_",descID="zcl_ce_desc_",editID="zcl_task_edit_",delID="zcl_task_del_",subTaskNodes=ZCL_$("zcl_ce_ele").querySelectorAll("div[id^='zcl_task_']"),i=0;i<subTaskNodes.length;i++){var nde=subTaskNodes[i];nde.querySelector('input[id^="'+titID+'"]')&&(nde.querySelector('input[id^="'+titID+'"]').id=titID+i,nde.querySelector('input[id^="'+ddID+'"]').id=ddID+i,nde.querySelector('select[id^="'+stsID+'"]').id=stsID+i,nde.querySelector('select[id^="'+prioID+'"]').id=prioID+i,nde.querySelector('textarea[id^="'+descID+'"]').id=descID+i),nde.id="zcl_task_"+i,nde.querySelector('span[id^="'+delID+'"]').id=delID+i,zcal.EOBJ.EID&&(nde.querySelector('span[id^="'+editID+'"]').id=editID+i)}},bindChangeActions=function(){var $task_title=$("#zcl_ce_tit");$task_title.length>0&&$task_title.off("change").on("change",function(){var title=$task_title.val();""==title.trim()&&(zmUtil.succErrMsg("e",zcal.i18n.plenttle),ZCL_$("zcl_ce_tit").focus())});var $task_desc=$("#zcl_ce_desc");$task_desc.length>0&&$task_desc.off("change").on("change",function(){var desc=$task_desc.val();""==desc.trim()&&(zmUtil.succErrMsg("e",zcal.i18n.plenttle),ZCL_$("zcl_ce_desc").focus())})},bindAction=function(){var taskForm=$("#zcl_ce"),dateFormat=zcal.DFORMAT[zcal.cdata.opt.DF],$dateField=(zcal.timeformat[zcal.cdata.opt.TF],taskForm.find("[data-marker=dateField]")),$timeField=taskForm.find("[data-marker=timeField]"),$chkboxField=taskForm.find("[data-marker=chkboxField]"),$remField=taskForm.find("[data-marker=remField]"),$saveBtn=taskForm.find("[data-marker=taskSave]"),$closeBtn=taskForm.find("[data-marker=taskFormClose]"),$addSubTask=$("#zcl_addsubtask"),$closeRem=taskForm.find("[data-marker=remClose]");if($dateField.length>0){var dateVal,today=new Date(zcal.cdate);dateVal=today.dateBy(dateFormat),$dateField.removeAttr("data-marker");var dField=$dateField[0];ZEVENTS(dField).picker("date",{dform:dateFormat,range:[dateVal,""],refer:dField.id,wkst:0,mode:"popup",update:"yes",minhgt:251}).on("dateclick",function(){dateValidate(dField)}).bind()}if($timeField.length>0){$timeField.removeAttr("data-marker");var tField=$timeField[0];ZEVENTS(tField).picker("time",{tform:zcal.timeformat[zcal.cdata.opt.TF],refer:tField.id}).bind()}$remField.length>0&&($remField.removeAttr("data-marker"),$remField.off("click").on("click",function(){showReminderOption(this)})),$chkboxField.length>0&&($chkboxField.removeAttr("data-marker"),$chkboxField.parent().off("click").on("click",function(){ZCL_ChgChk(this)})),$saveBtn.length>0&&($saveBtn.removeAttr("data-marker"),$saveBtn.off("click").on("click",function(){saveTask()})),$closeBtn.length>0&&($closeBtn.removeAttr("data-marker"),$closeBtn.off("click").on("click",function(){taskCalId=void 0,subTasksArr=void 0,subTaskCount=void 0,oldSubTaskCount=void 0,ZCL_eClose(),zcalView.plotEvents()})),$addSubTask.length>0&&$addSubTask.off("click").on("click",function(){var ulHide=ZCL_$("zcl_ce_ele").querySelector(".zcl_ce_ad_sbtk").children[0];if(0==subTaskCount){if(taskFormValidate()){constSubTaskLst(),zcal.EOBJ.EID&&(ulHide.style.display="none"),subTaskCount++;var obj={};subTasksArr.push(obj)}}else if(subTaskCount>0){var ndeID=subTaskCount-1,nde=ZCL_$("zcl_task_"+ndeID),isValid=taskFormValidateNew(nde);if(0!=isValid){constSubTaskLst(),zcal.EOBJ.EID&&(ulHide.style.display="none"),subTaskCount++;var obj={};subTasksArr.push(obj)}}}),$closeRem.length>0&&$closeRem.off("mousedown").on("mousedown",function(){var remUl=ZCL_$("zcl_ce_ele").children[0].children[4];remUl.outerHTML='<ul class="zcl_frmrw zcl_rem"><li data-marker="remField"><ul id="zcl_addrem"><li><span><i class="msi-add"></i>'+zcal.i18n.addreminder+"</span></li></ul></li></ul>",bindAction()})},dateValidate=function(dField){var id=dField.id,df=zcal.DFORMAT[zcal.cdata.opt.DF];if(id.startsWith("zcl_ce_dd_")){var dd=dField.value;dd=formatDate(dd);var duedate=new Date(dd),pdd=ZCL_$("zcl_ce_dd").value;pdd=formatDate(pdd);var parentDD=new Date(pdd);if(duedate.getTime()>parentDD.getTime())return dField.value=parentDD.getDateBy(df),zmUtil.succErrMsg("e","Subtask due date must be less than parent task due date"),!1}else if("zcl_ce_rd"==id){var rd=dField.value;rd=formatDate(rd);var remDate=new Date(rd),rt=$("#zcl_ce_rt").val();rt=ZCL_TimetoNo(rt);var hr=parseInt(rt.substring(0,2)),mn=parseInt(rt.substring(2));if(remDate.setHours(hr,mn),remDate.getTime()<(new Date).getTime())return zmUtil.succErrMsg("e","Reminder date cannot be less than current date"),!1}return!0},formatDate=function(dateStr){var df=zcal.cdata.opt.DF;if(1==df){var d=dateStr.split("/");dateStr=d[1]+"/"+d[0]+"/"+d[2]}else 3==df&&(dateStr=dateStr.replace(/-/g,"/"));return dateStr},showReminderOption=function(ele){var remEle,$ele=$(ele),id=ele.children[0].id;remEle=getReminderOption("dom",id),$ele.parent().replaceWith(remEle);var $dateField=remEle.find("[data-marker=dateField]"),$timeField=remEle.find("[data-marker=timeField]"),$mail=remEle.find("[id=zcl_remMail]"),$popup=remEle.find("[id=zcl_remPop]"),$close=remEle.find("i.msi-close");if($dateField.length>0){var dateVal,today=new Date(zcal.cdate),dateFormat=zcal.DFORMAT[zcal.cdata.opt.DF];dateVal=today.dateBy(dateFormat),$dateField.removeAttr("data-marker");var dField=$dateField[0];ZEVENTS(dField).picker("date",{dform:dateFormat,range:[dateVal,""],refer:dField.id,wkst:0,mode:"popup",update:"yes",minhgt:251}).on("dateclick",function(){dateValidate(dField)}).bind()}if($timeField.length>0){$timeField.removeAttr("data-marker");var tField=$timeField[0];ZEVENTS(tField).picker("time",{tform:zcal.timeformat[zcal.cdata.opt.TF],refer:tField.id}).bind()}$mail.length>0&&$mail.off("mousedown").on("mousedown",function(){var cls=$mail.attr("class");$mail[0].className="msi-check"==cls?"msi-uncheck":"msi-check"}),$popup.length>0&&$popup.off("mousedown").on("mousedown",function(){var cls=$popup.attr("class");$popup[0].className="msi-check"==cls?"msi-uncheck":"msi-check"}),$close.length>0&&$close.off("mousedown").on("mousedown",function(){var remUl=ZCL_$("zcl_ce_ele").children[0].children[4];remUl.outerHTML='<ul class="zcl_frmrw zcl_rem"><li data-marker="remField"><ul id="zcl_addrem"><li><span><i class="msi-add"></i>'+zcal.i18n.addreminder+"</span></li></ul></li></ul>",bindAction()})},setTaskTitle=function(mde){var txt='<ul class="zcl_frmrw">',val=ZCL_getHTML(zcal.EOBJ.TITLE?zcal.EOBJ.TITLE:zcal.EOBJ.SUM);return 0==mde?txt+='<li class="zcl_evttvw">'+val+"</li>":1==mde&&(txt+='<li class="zcl_W70pc"><u>'+zcal.i18n.title+'</u><input type="text" placeholder="Task Title" class="zcl_crevntt SC_tiput" id="zcl_ce_tit" value="'+val+'"></li>'),txt+="</ul>"},setTaskDueDate=function(mde){var txt="",dd=zcal.EOBJ.SD;if(0==mde){var dat1=ZCL_parseDateStr(dd);txt+='<ul class="zcl_frmrw"><li>'+dat1.dateBy("MMM dd, yyyy")+"</li></ul>"}else 1==mde&&(txt+='<ul class="zcl_frmrw"><li class="zcl_select"><u>'+zcal.i18n.duedate+'</u><input type="text" class="zcl_w100 SC_tiput" data-marker="dateField" value="'+ZCL_putDate(dd)+'" id="zcl_ce_dd" readonly></li></ul>');return txt},setTaskPriority=function(mde){var txt="",val=zcal.EOBJ.PRIORITY?zcal.EOBJ.PRIORITY:1,ztaskPrioriy=[zcal.i18n.ztask_priority_high,zcal.i18n.ztask_priority_medium,zcal.i18n.ztask_priority_low];return txt+='<ul class="zcl_frmrw"><li><u>'+zcal.i18n.priority+"</u>",0==mde?txt+="<span>"+ztaskPrioriy[val]+"</span>":1==mde&&(txt+=ZCL_selBox("zcl_task_pri",val,ztaskPrioriy)),txt+="</li></ul>"},setTaskStatus=function(mde){var txt="",val=zcal.EOBJ.STATUS?zcal.EOBJ.STATUS:0,ztaskStatus=[zcal.i18n.inprogress,zcal.i18n.completed];return txt+='<ul class="zcl_frmrw"><li><u>'+zcal.i18n.status+"</u>",0==mde?txt+="<span>"+ztaskStatus[val]+"</span>":1==mde&&(txt+=ZCL_selBox("zcl_task_sts",val,ztaskStatus)),txt+="</li></ul>"},setTaskReminder=function(mde){var txt="";return 0==mde||zcal.EOBJ.REMDATE?txt+=getReminderOption("string",""):1==mde&&(txt+='<ul class="zcl_frmrw zcl_rem"><li data-marker="remField"><ul id="zcl_addrem"><li><span><i class="msi-add"></i>'+zcal.i18n.addreminder+"</span></li></ul></li></ul>"),txt},getTimeByTF=function(date){var tf=zcal.cdata.opt.TF,hr=date.getHours(),mn=date.getMinutes(),tstr="";if(mn>30?(mn=0,hr+=1):mn>0&&(mn=30),0==tf){var ampm=12>hr?"am":"pm";hr=hr>12?hr-12:0==hr?12:hr,tstr=ii(hr)+":"+ii(mn)+" "+ampm}else tstr=ii(hr)+":"+ii(mn);return tstr},ii=function(i,len){var s=i+"";for(len=len||2;s.length<len;)s="0"+s;return s},getReminderOption=function(type){var dateFormat=zcal.DFORMAT[zcal.cdata.opt.DF],rd=(zcal.timeformat[zcal.cdata.opt.TF],zcal.EOBJ.REMDATE||""),rt=""!=rd&&new Date(rd).getTime()>(new Date).getTime()?new Date(rd):new Date,rtime=getTimeByTF(rt),remEle=$('<ul class="zcl_frmrw"/>'),txt="";if(0==zcal.EMODE){var reminderStr=""!=rd?new Date(rd).dateBy(dateFormat)+", "+rtime:"";txt+="<li><u>"+zcal.i18n.reminder+"</u><span>"+reminderStr+"</span></li>"}else{var mailCls,popCls;zcal.EOBJ.EID?(mailCls=zcal.EOBJ.EMLR&&1==zcal.EOBJ.EMLR?"msi-check":"msi-uncheck",popCls=zcal.EOBJ.PPR&&1==zcal.EOBJ.PPR?"msi-check":"msi-uncheck"):(mailCls="msi-check",popCls="msi-check");var di="zcl_ce_rd",ti="zcl_ce_rt",mi="zcl_remMail",pi="zcl_remPop";rdate=rt.getDateBy(dateFormat),txt+="<li><u>"+zcal.i18n.reminder+'</u><ul class="zcl_frmrw zcl_when"><li class="zcl_select"><input type="text" class="zcl_w100 SC_tiput" data-marker="dateField" value="'+rdate+'" id="'+di+'" readonly></li><li class="zcl_select"><input type="text" class="zcl_w70 SC_tiput" data-marker="timeField" value="'+rtime+'" id="'+ti+'"></li><li><i class="msi-close" data-marker="remClose" title="Remove"></i></li></ul><ul><li class="zcl_curpt"><i class="'+mailCls+'" data-marker="chkboxField" id="'+mi+'"></i>'+zcal.i18n.mail+'</li><li class="zcl_curpt"><i class="'+popCls+'" data-marker="chkboxField" id="'+pi+'"></i>'+zcal.i18n.notification+"</li></ul></li>"}return remEle.html(txt),"dom"===type?remEle:"string"===type?remEle[0].outerHTML:void 0},setCalName=function(){return'<ul class="zcl_frmrw"><li><u class="zcl_grey">'+zcal.i18n.calendar+"</u><span>"+ZCL_GetCalName(taskCalId)+"</span></li></ul>"},setTaskCategory=function(){return'<ul class="zcl_frmrw"><li><u class="zcl_grey">'+zcal.i18n.task+"</u><span>"+zcal.i18n.mytask+"</span></li></ul>"},setTaskDesc=function(mde){var txt='<ul class="zcl_frmrw">',desc=zcal.EOBJ.DESC||zcal.EOBJ.Description;return 0==mde?txt+="<li><u>"+zcal.i18n.description+'</u><div class="zcl_vwdes" id="zcl_tskdes"></div></li>':1==mde&&(txt+='<li class="zcl_W70pc"><u>'+zcal.i18n.description+'</u><textarea style="height:44px;" class="zcl_Cedes SC_tiput" id="zcl_ce_desc">'+desc+"</textarea></li>"),txt+="</ul>"},setHiddenFlds=function(){var txt=ZCL_hdnFld("zcl_eid",zcal.EOBJ.EID?zcal.EOBJ.EID:"")+ZCL_hdnFld("zcl_ekey",zcal.EOBJ.EUID?zcal.EOBJ.EUID:"")+ZCL_hdnFld("zcl_crel",taskCalId)+ZCL_hdnFld("zcl_rmvatt","");return txt},constButton=function(){var label=zcal.EOBJ.EID?zcal.i18n.save:zcal.i18n.add,txt='<ul class="zcl_frmrw"><li><div class="SC_PUbtm"><span data-marker="taskSave">'+label+'</span><span data-marker="taskFormClose" data-val="Cancel">'+zcal.i18n.cancel+"</span></div></li></ul>";return txt},setMetaInfo=function(){return ZCL_SetMetaInfo("")},taskFormValidate=function(){if(""==ZCL_$("zcl_ce_tit").value.trim())return zmUtil.succErrMsg("e",zcal.i18n.plenttle),ZCL_$("zcl_ce_tit").focus(),!1;if(!zcal.EOBJ.EID){var cut=new Date,dd=formatDate(ZCL_$("zcl_ce_dd").value),usd=new Date(dd).setHours(23,59,59);if(usd<cut.getTime())return zmUtil.succErrMsg("e","Due date cannot be lesser than the current date"),!1}if(!zcal.validate(ZCL_$("zcl_ce_desc").value))return zmUtil.succErrMsg("e",zcal.i18n.spchevenot),ZCL_$("zcl_ce_desc").focus(),!1;var rdEle=ZCL_$("zcl_ce_rd");return rdEle&&!dateValidate(rdEle)?!1:!0},taskFormValidateNew=function(nde){var title=nde.querySelector("input[id^='zcl_ce_tit_']");if(!title)return 2;if(""==title.value.trim())return zmUtil.succErrMsg("e",zcal.i18n.plenttle),title.focus(),0;var dd=formatDate(nde.querySelector("input[id^='zcl_ce_dd_']").value),pdd=formatDate(ZCL_$("zcl_ce_dd").value),d1=new Date(dd),d2=new Date(pdd);if(d1.getTime()>d2.getTime())return zmUtil.succErrMsg("e","Subtask due date must be less than parent task's due date"),0;var desc=nde.querySelector("textarea[id^='zcl_ce_desc_']");if(!zcal.validate(desc.value))return desc.value="",zmUtil.succErrMsg("e","Special characters are not allowed in description"),desc.focus(),0;var idx=(nde.id,nde.getAttribute("rel"));return"new"!=idx?2:1},subTaskFormValidate=function(){for(var sbTsks=ZCL_$("zcl_ce_ele").querySelectorAll("div[id^='zcl_task_']"),i=0;i<sbTsks.length;i++){var sbTsk=sbTsks[i],isValid=taskFormValidateNew(sbTsk);if(1!=isValid){if(2==isValid)continue;return!1}var isEdit=zcal.EOBJ.EID?!0:!1,sub={};sub.title=sbTsk.querySelector("input#zcl_ce_tit_"+i).value;var due=sbTsk.querySelector("input#zcl_ce_dd_"+i).value;isEdit?sub.duedate=due:sub.dueDate=due,sub.priority=sbTsk.querySelector("select#zcl_task_pri_"+i).value;var sum=sbTsk.querySelector("textarea#zcl_ce_desc_"+i).value;isEdit?sub.desc=sum:sub.summary=sum,isEdit&&(sub.status=sbTsk.querySelector("select#zcl_task_sts_"+i).value),subTasksArr[i]=sub}return!0},createNewSubTask=function(obj,idx){var df=zcal.DFORMAT[zcal.cdata.opt.DF],cname=zcal.EOBJ.CNAME;obj.dateformat=df,obj.ckey=zcal.getCalObj(cname)[9],obj.ownerId=zcal.EOBJ.OWNERID;var tsk="/cal/tasks/"+zcal.EOBJ.EUID+"?";tsk+="mode=addSubTask",tsk+="&taskData="+JSON.stringify(obj),ZCL_XHR(tsk,function(res){var resp=JSON.parse(res.responseText);if(resp.hasOwnProperty("EID")){if(resp.ISNEW=!0,addTaskToView(resp,cname),!ZCL_$("zcl_ce_ele"))return;zmUtil.succErrMsg("s","Subtask added successfully!"),subTasksArr[idx]=resp;var subLi=ZCL_$("zcl_ce_ele").querySelector(".zcl_vw_su_cn");if(subLi){var bNde=subLi.getElementsByTagName("B");if(bNde.length>0){var b=bNde[0];b.innerHTML=1==subTaskCount?subTaskCount+" Subtasks":subTaskCount+"Subtask"}else{var b=document.createElement("B");b.innerHTML=subTaskCount+" Subtasks",subLi.insertBefore(b,subLi.children[0])}var obj=subTasksArr[idx];constViewDiv(obj,idx)}}else if("failure"==resp.sts){var err=resp.msg||"Error while adding subtask!";zmUtil.succErrMsg("e",err)}})},editTask=function(euid,obj,pos){var oldDate=formatDate(obj.DUEDATE);if(oldDate=new Date(oldDate).getDateBy("yyyyMMdd"),obj=getChangedFields(obj,pos),$.isEmptyObject(obj))return zmUtil.succErrMsg("e","Nothing is changed!"),void constViewDiv(subTasksArr[pos],pos);obj.hasOwnProperty("isDue")||(obj.isDue=!1,obj.duedate=ZCL_$("zcl_ce_dd_"+pos).value);var dateformat=zcal.DFORMAT[zcal.cdata.opt.DF],cname=zcal.EOBJ.CNAME;obj.ckey=zcal.getCalObj(cname)[9],obj.dateformat=dateformat,obj.ownerId=zcal.EOBJ.OWNERID;var tsk="/cal/tasks/"+euid+"?";tsk+="mode=updateTask",tsk+="&taskData="+JSON.stringify(obj),ZCL_XHR(tsk,function(res){var resp=JSON.parse(res.responseText);if("success"==resp.status){var data=resp.data,newObj=subTasksArr[pos];for(var key in data)newObj[key]=data[key];subTasksArr[pos]=newObj;var isNew=!1;if(data.hasOwnProperty("DUEDATE")){isNew=!0;for(var evArr=zcal.cdata.eveAll[oldDate],eid=obj.EID,i=0;i<evArr.length;i++){var eve=evArr[i];eve.hasOwnProperty(eid)&&evArr.splice(i,1)}}if(newObj.ISNEW=isNew,addTaskToView(newObj,cname),!ZCL_$("zcl_ce_ele"))return;zmUtil.succErrMsg("s","Subtask edited successfully!"),constViewDiv(newObj,pos)}else if("failure"==resp.status){var err=resp.error||"Error while updating!";zmUtil.succErrMsg("e",err)}})},getChangedFields=function(obj,pos){if(!ZCL_$("zcl_ce_tit_"+pos))return{};if(!obj.EID)return obj;var finalObj={},_tit=ZCL_$("zcl_ce_tit_"+pos).value;obj.TITLE!=_tit&&(finalObj.title=_tit);var _dd=ZCL_$("zcl_ce_dd_"+pos).value;obj.DUEDATE!=_dd&&(finalObj.duedate=_dd,finalObj.isDue=!0);var _sts=ZCL_$("zcl_task_sts_"+pos).value;obj.STATUS!=_sts&&(finalObj.status=_sts);var _pri=ZCL_$("zcl_task_pri_"+pos).value;obj.PRIORITY!=_pri&&(finalObj.priority=_pri);var _desc=ZCL_$("zcl_ce_desc_"+pos).value;return obj.DESC!=_desc&&(finalObj.desc=_desc),finalObj},processSubTasks=function(){for(var i=0;i<subTasksArr.length;i++){var subObj=subTasksArr[i],chObj=getChangedFields(subObj,i);$.isEmptyObject(chObj)||(subObj.EID?editTask(subObj.EUID,chObj,i):createNewSubTask(subObj,i))}},processParent=function(obj){var finalObj={};obj.SUM!=zcal.EOBJ.TITLE&&(finalObj.title=obj.SUM);var _dd=obj.DD;_dd=formatDate(_dd),_dd=new Date(_dd).getDateBy("yyyyMMdd"),_dd!=zcal.EOBJ.SD&&(finalObj.duedate=obj.DD,finalObj.isDue=!0),obj.PRIORITY!=zcal.EOBJ.PRIORITY&&(finalObj.priority=obj.PRIORITY),obj.STATUS!=zcal.EOBJ.STATUS&&(finalObj.status=obj.STATUS),obj.DESC!=zcal.EOBJ.DESC&&(finalObj.desc=obj.DESC);var _obj={};if(zcal.EOBJ.REMDATE){if(""!=zcal.EOBJ.REMDATE){""==obj.REMDATE&&(finalObj.reminder=_obj);var oldRd=new Date(zcal.EOBJ.REMDATE).getTime(),rd=formatDate(obj.REMDATE);rd=new Date(rd);var rm=obj.REMTIME,hr=parseInt(rm.substring(0,2)),mn=parseInt(rm.substring(2));rd.setHours(hr,mn);var newRd=rd.getTime();oldRd!=newRd&&(obj.MAIL||obj.POPUP)&&(finalObj.reminder=_obj)}}else""!=obj.REMDATE&&(obj.MAIL||obj.POPUP)&&(finalObj.reminder=_obj);return finalObj},addTaskToView=function(data,cname){var eid=data.EID,euid=data.EUID,duedate=data.DUEDATE||data.DD;duedate=formatDate(duedate);var dd=new Date(duedate),dd1=dd.getDateBy("yyyyMMdd"),title=data.TITLE||data.SUM,tsts=Number.parseInt(data.STATUS),isNew=data.ISNEW,evAll=zcal.cdata.eveAll;evAll.hasOwnProperty(dd1)||(evAll[dd1]=[]);var eveAr=evAll[dd1];if(isNew){var obj={ADAY:"1",CNAME:cname||data.CNAME,DPERM:"2",DTSTART:dd.getTime(),DUR:"86400000",EC:"-1",ED:dd1,EPERM:"2",ET:"0000",ETYPE:"3",EUID:euid,HASATTACH:!1,LOC:"",ORG:zcal.cdata.opt.ZUID,ORGEMAIL:zcal.cdata.opt.MID,PRIVILEGE:"organizer",REF:[0,1,0,0,0,0],RTO:[0,0,0,0,0,0,0,0],SD:dd1,ST:"0000",SUM:title,TSTS:tsts},eve={};eve[eid]=obj,eveAr.push(eve)}else for(var i=0;i<eveAr.length;i++){var eveObj=eveAr[i];if(eveObj.hasOwnProperty(eid)){var eve=eveObj[eid];eve.SUM=title,eve.TSTS=tsts}}},saveTask=function(){if(taskFormValidate()&&subTaskFormValidate()){var rtime=ZCL_$("zcl_ce_rt")?ZCL_$("zcl_ce_rt").value:"00:00",obj={EID:ZCL_$("zcl_eid").value,EUID:ZCL_$("zcl_ekey").value,DD:ZCL_$("zcl_ce_dd").value,CNAME:ZCL_$("zcl_crel").value,SUM:ZCL_$("zcl_ce_tit").value,PRIORITY:ZCL_$("zcl_task_pri").value,STATUS:ZCL_$("zcl_task_sts").value,DESC:ZCL_$("zcl_ce_desc")?ZCL_$("zcl_ce_desc").value:"",REMDATE:ZCL_$("zcl_ce_rd")?ZCL_$("zcl_ce_rd").value:"",REMTIME:ZCL_TimetoNo(rtime),MAIL:ZCL_$("zcl_remMail")&&"msi-check"==ZCL_$("zcl_remMail").className?1:0,POPUP:ZCL_$("zcl_remPop")&&"msi-check"==ZCL_$("zcl_remPop").className?1:0,ADAY:1,EPERM:2,DPERM:2,EC:-1,SUBTASK:JSON.stringify(subTasksArr)};if(zcal.EOBJ.EID){processSubTasks();var finalObj=processParent(obj);if($.isEmptyObject(finalObj))ZCL_eClose();else{if(finalObj.hasOwnProperty("reminder")){var remObj={};remObj.reminderDate=obj.REMDATE,remObj.reminderTime=obj.REMTIME,remObj.isEmail=obj.MAIL,remObj.isPopup=obj.POPUP,finalObj.reminder=remObj}var dateformat=zcal.DFORMAT[zcal.cdata.opt.DF],oldDate=zcal.EOBJ.SD;finalObj.ckey=zcal.getCalObj(zcal.EOBJ.CNAME)[9],finalObj.hasOwnProperty("duedate")||(finalObj.duedate=obj.DD,finalObj.isDue=!1),finalObj.dateformat=dateformat,finalObj.ownerId=zcal.EOBJ.OWNERID;var tsk="/cal/tasks/"+obj.EUID+"?";tsk+="mode=updateTask",tsk+="&taskData="+JSON.stringify(finalObj),ZCL_XHR(tsk,function(res){var resp=JSON.parse(res.responseText);if("success"==resp.status){zmUtil.succErrMsg("s",zcal.i18n.taskedited);var data=resp.data,isNew=!1;if(data.hasOwnProperty("DUEDATE")){isNew=!0;for(var evArr=zcal.cdata.eveAll[oldDate],eid=obj.EID,i=0;i<evArr.length;i++){var eve=evArr[i];eve.hasOwnProperty(eid)&&evArr.splice(i,1)}}obj.ISNEW=isNew,addTaskToView(obj)}else if("failure"==resp.status){var err=resp.error||"Error while updating!";zmUtil.succErrMsg("e",err)}ZCL_eClose()})}zcalView.plotEvents()}else saveParent(obj)}},saveParent=function(obj){var tsk="/cal/addTask.do?title="+obj.SUM.zcalescape()+"&dateFormat="+zcal.DFORMAT[zcal.cdata.opt.DF];tsk+="&dueDate="+obj.DD,tsk+="&priority="+obj.PRIORITY.zcalescape(),tsk+="&status="+obj.STATUS.zcalescape(),tsk+="&desc="+obj.DESC.zcalescape(),tsk+="&subTask="+obj.SUBTASK,""!=obj.REMDATE&&(obj.MAIL||obj.POPUP)&&(tsk+="&remDate="+obj.REMDATE+"&remTime="+obj.REMTIME+"&remMail="+obj.MAIL+"&remPopup="+obj.POPUP);var cObj=zcal.getCalObj(ZCL_$("zcl_crel").value);tsk+="&ckey="+cObj[9],ZCL_TEMP_EOBJ=obj,ZCL_XHR(tsk,function(res){ZCL_retDET(res)})},taskObj={showTaskForm:openTaskForm,updateTaskData:updateTaskInfo,saveTask:saveTask};return taskObj}();ZCL_getCustomAlarmInfo=function(remtime){var remTxt="";if(36e5>remtime)remTxt=parseInt(remtime/6e4),remTxt+=1==remTxt?" min":" mins";else if(864e5>remtime){remTxt=parseInt(remtime/36e5),remTxt+=1==remTxt?" hr":" hrs";var mins=remtime%36e5;mins=parseInt(mins/6e4),0!=mins&&(remTxt+=1==mins?" "+mins+" min":" "+mins+" mins")}else{remTxt=parseInt(remtime/864e5);var hrs=remtime%864e5,mins=hrs%36e5;remTxt+=1==remTxt?" day":" days",hrs=parseInt(hrs/36e5),0!=hrs&&(remTxt+=1==hrs?" "+hrs+" hr":" "+hrs+" hrs"),mins=parseInt(mins/6e4),0!=mins&&(0==hrs&&(remTxt+=" 0 hrs"),remTxt+=1==mins?" "+mins+" min":" "+mins+" mins")}return remTxt},ZCL_chatDropdown=function(chObj,e){if("zcal_eContainer"==zmTab.currentTab){var dataList=[{txt:"Start New Chat",data:"newChat"}];for(var chat in chObj)dataList.push({txt:chObj[chat].title,data:chObj[chat].chatId});var cls,newChat,liArr=[];for(var i in dataList)newChat="newChat"===dataList[i].data,cls=newChat?"SC_thm":"",liArr.push(_zm.getDOM(["LI",{attrs:{"data-item":dataList[i].data,"class":cls},child:[["text",dataList[i].txt]]}])),newChat&&liArr.push(_zm.getDOM(["LI",{attrs:{"class":"SC_lne"}}]));var dropObj;dropObj=new zmDropDownMenu;var param={par:e.target,showArrow:!1,liDom:liArr,spanClass:"SC_Sopt",clk:chatAction=function(data){if("newChat"==data.item)ZCL_openChatletPopup(),zmUtil.hideMenu();else{var eveId=zcal.EOBJ.EID,chO="/cal/chatlet.do?mode=add&chId="+data.item;""!=eveId&&(chO+=-1!=eveId.indexOf("_")?"&eveId="+eveId.substring(0,eveId.indexOf("_")):"&eveId="+eveId),ZCL_XHR(chO,function(xml){var obj=JSON.parse(xml.responseText);"success"==obj.status&&zmUtil.hideMenu()})}},align:"pright"};dropObj.setDropObj(param),dropObj.paint()}else{ZCL_clrStck();var option={buttons:[{txt:"Start New Chat",callback:function(){ZCL_openChatletPopup()}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){ZCL_closeChatlet()}}],closeaction:function(){ZCL_closeChatlet()}};ZCL_$("zcl_chatlet")||$("body").append('<ul id="zcl_alchatlet" class="zcl_chatlgr zmListReset"></ul>');var txt="";for(var i in chObj)txt+="<li rel="+chObj[i].chatId+">"+chObj[i].title+"</li>";$("#zcl_alchatlet").html(txt),$("#zcl_alchatlet").find("LI").on("click",function(ev){var eveId=zcal.EOBJ.EID,chid=ev.target.getAttribute("rel"),obj="/cal/chatlet.do?mode=add&chId="+chid;""!=eveId&&(obj+=-1!=eveId.indexOf("_")?"&eveId="+eveId.substring(0,eveId.indexOf("_")):"&eveId="+eveId),ZCL_XHR(obj,function(xml){var obj=JSON.parse(xml.responseText);"success"==obj.status&&zmsDialog.remove(!0)})}),zmsDialog.create("zcl_alchatlet",option)}},ZCL_chatLet=function(e,obj){zcal.EOBJ=obj;var eveId=zcal.EOBJ.EID;""!=eveId&&(-1!=eveId.indexOf("_")?ZCL_XHR("/cal/chatlet.do?mode=getChats&eveId="+eveId.substring(0,eveId.indexOf("_")),function(res){var obj=ZCL_Evl(1,res.responseText);obj.ChatObj.length>0?ZCL_chatDropdown(obj.ChatObj,e):ZCL_openChatletPopup()}):ZCL_XHR("/cal/chatlet.do?mode=getChats&eveId="+eveId,function(res){var obj=ZCL_Evl(1,res.responseText);obj.ChatObj.length>0&&Object.keys(obj.ChatObj[0]).length>0?ZCL_chatDropdown(obj.ChatObj,e):ZCL_openChatletPopup()}))},ZCL_chatInfo=function(res,e){var obj=ZCL_Evl(1,res.responseText);obj.ChatObj.length>0?ZCL_chatDropdown(obj.ChatObj,e):ZCL_openChatletPopup()},ZCL_openChatletPopup=function(){var eObj=zcal.EOBJ,chatletCont=$(zcalTemplate.popupChatlet(eObj)),option={title:"Start new chat",mask:!0,buttons:[{txt:"Start Chat",callback:function(){ZCL_creatChatlet()}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){ZCL_closeChatlet()}}],closeaction:function(){ZCL_closeChatlet()}};ZCL_$("zcl_chatlet")||$("body").append('<div id="zcl_chatlet"></div>'),$("#zcl_chatlet").html(chatletCont),$("#zmsdialog_zcl_alchatlet").remove(),zmsDialog.create("zcl_chatlet",option),$("#zmsdialog_zcl_chatlet").on("click",function(ev){"attDiv"==$(ev.target).parent()[0].id&&("attAdd"==ev.target.id||"att"==$(ev.target).parent()[0].id)&&(chatletCont.find("#attDiv")[0].className="addInv SC_floatLabel flFLabel clearfix flBox addUsers autoFilldata edit_parti",chatletCont.find("input").focus())}),chatletCont.find(".msi-close").on("click",function(){$(this).parent("#att").remove()}),ZCL_autoCom(chatletCont)},ZCL_creatChatlet=function(){var ttemp=zcal.timeformat[zcal.cdata.opt.TF],aday=zcal.EOBJ.ADAY&&1==zcal.EOBJ.ADAY?!0:!1,sd=zcal.EOBJ.SD,ed=zcal.EOBJ.ED,st=aday?"8:00 am":zcal.EOBJ.ST,et=aday?"8:30 am":zcal.EOBJ.ET,tim1=st.getTimeBy(ttemp),tim2=et.getTimeBy(ttemp),de1=ZCL_splitDateVal(ZCL_putDate(sd)),de2=ZCL_splitDateVal(ZCL_putDate(ed)),ParST=ZCL_parseTime(tim1),ParET=ZCL_parseTime(tim2);ZCL_ESDATE=new Date(de1[2],de1[1]-1,de1[0],ParST.HH,ParST.mm,0,0),ZCL_EEDATE=new Date(de2[2],de2[1]-1,de2[0],ParET.HH,ParET.mm,0,0),zcal.EOBJ.rObj=new zcalRepeat,zcal.EOBJ.rObj.init(ZCL_ESDATE);var loc=zcal.EOBJ.LOC,date="",dat1=ZCL_parseDateStr(sd),dat2=ZCL_parseDateStr(ed);date+=dat1.dateBy("NNN dd, yyyy"),date+=aday?sd!=ed?" - "+dat2.dateBy("NNN dd, yyyy"):"":sd!=ed?", "+tim1+" - "+dat2.dateBy("NNN dd, yyyy")+", "+tim2:", "+tim1+" - "+tim2;var title=$("#zcl_chTit")[0].value,emails="";for(var i in $("#attDiv")[0].childNodes)$("#attDiv")[0].childNodes.length>=3?"att"==$("#attDiv")[0].childNodes[i].id&&(emails+=""==emails?$("#attDiv")[0].childNodes[i].getAttribute("data-zid"):","+$("#attDiv")[0].childNodes[i].getAttribute("data-zid")):zmUtil.succErrMsg("e","Please Enter attendee");var eveId=zcal.EOBJ.EID,cobj="/cal/chatlet.do?mode=create&title="+title+"&att="+emails+"&edate="+date+"&loc="+loc;""!=eveId&&(cobj+=-1!=eveId.indexOf("_")?"&eveId="+eveId.substring(0,eveId.indexOf("_")):"&eveId="+eveId),ZCL_XHR(cobj,function(res){var obj=ZCL_Evl(1,res.responseText);"success"==obj.status&&ZCL_closeChatlet()})},ZCL_autoCom=function(chatelem){var elem=$(chatelem).find("#atInp");zmAppLoader.load("zmContactsAutoComplete").done(function(){zmContactsAutoComplete.autoComplete({input:elem[0],contactType:"org",exclude:function(){var email=[];if($("#attDiv")[0])for(var attl=$("#attDiv")[0].childNodes,i=0;i<attl.length;i++)attl[i].getElementsByTagName("SPAN")[0]&&email.push(attl[i].getElementsByTagName("SPAN")[0].innerHTML);return email},excludeMe:!0,onSelect:function(event,data){var data=data.item.attributes,div=$(chatelem).find("#attDiv"),nDiv=document.createElement("div");nDiv.className="SC_cs myInv dFill",nDiv.setAttribute("data-zid",data.zid),nDiv.setAttribute("id","att"),nDiv.setAttribute("title",data.email),nDiv.innerHTML='<div class="SC_avtr"><img src='+data.profileImage+"></div><span>"+data.email+'</span><i class="msi-close closePopup"></i></div>',div.prepend($(nDiv)),$(elem).val(""),$(nDiv).find(".closePopup").on("click",function(){$(this).parent("#att").remove()})}})})},ZCL_closeChatlet=function(){zmsDialog.remove(!0);var acalPP=$("#zcl_chatlet");acalPP.length>0&&acalPP.remove(),zmUtil.hideMenu()};var zcalRepeat=function(){var zcalRepeat=function(){this.frequency=-1,this.interval=1,this.option=0,this.date,this.month,this.day,this.week,this.until,this.count=0};return zcalRepeat.prototype={init:function(_date){this.date=_date&&_date.getDate(),this.month=_date&&_date.getMonth(),this.day=_date&&[_date.getDay()],this.week=_date&&Math.floor(this.date/7)},update:function(obj){this.frequency=obj&&obj.RFRQ?obj.RFRQ:this.frequency,this.interval=obj&&obj.RIVL?obj.RIVL:this.interval,this.option=obj&&obj.ROPT?obj.ROPT:this.option,this.date=obj&&obj.RDATE?obj.RDATE:this.date,this.month=obj&&obj.RMON?obj.RMON:this.month,this.week=obj&&obj.RTOWK?obj.RTOWK:this.week,this.day=obj&&obj.RDAY?ZCL_rdaysInJSRep(obj.RDAY):this.day,this.count=obj&&obj.RCNT>0?obj.RCNT:this.count,this.until=obj&&0==this.count&&0!=obj.RUTL?obj.RUTL:this.until},setFrequency:function(frequency){this.frequency=parseInt(frequency)},setInterval:function(interval){this.interval=parseInt(interval)},setOption:function(option){this.option=option},setDate:function(date){this.date=parseInt(date)},setMonth:function(month){this.month=parseInt(month)},setWeek:function(week){this.week=parseInt(week)},setDay:function(day){this.day=day},setCount:function(count){this.count=count},setUntil:function(until){this.until=until},getStr:function(){var _txt="",l=this.day.length;if(0==this.frequency)_txt+=1==this.option?"Every weekday":1==this.interval?"Daily":"Every "+this.interval+" days";else if(1==this.frequency){_txt+=1==this.interval?"Weekly":"Every "+this.interval+" weeks",_txt+=" on ";for(var i=0;i<this.day.length;i++){var wday=parseInt(this.day[i]);_txt+=0!=i&&i!=l-1?", ":0!=i&&i==l-1?" & ":"",_txt+=Date.WEEK_DAYS[1][wday]}}else 2==this.frequency?(_txt+=1==this.interval?"Monthly":"Every "+this.interval+" months",_txt+=1==this.option?" on the "+zcal.WEEK_TYPE[this.week]+" "+Date.WEEK_DAYS[0][this.day[l-1]]:" on day "+this.date):3==this.frequency&&(_txt+=1==this.interval?"Yearly":"Every "+this.interval+" years",_txt+=1==this.option?" on "+Date.MONTH_NAMES[0][this.month]+" "+zcal.WEEK_TYPE[this.week]+" "+Date.WEEK_DAYS[0][this.day[l-1]]:" on "+Date.MONTH_NAMES[0][this.month]+" "+this.date);return this.count&&0!=this.count?_txt+=", "+this.count+" times":this.until&&0!=this.ZCL_REPUTL&&(_txt+=", until "+ZCL_putDate(this.until)),""!=_txt?" ("+_txt+")":""},getReqObj:function(){if(-1!=this.frequency){var rObj={RFRQ:this.frequency,RIVL:this.interval,ROPT:this.option,RCNT:this.count&&0!=this.count?this.count:"",RUTL:this.until&&0!=this.until?this.until:"",RST:ZCL_DFDate(ZCL_$("zcl_ce_sd").value)},rmon=rtowk=rdate="",rday=[];if(2!=this.frequency&&3!=this.frequency||1!=this.option)if(2!=this.frequency&&3!=this.frequency||0!=this.option){if(1==this.frequency)for(var i=0;i<this.day.length;i++)rday[i]=parseInt(this.day[i])+1}else rmon=2==this.frequency?"":this.month,rdate=this.date;else rmon=2==this.frequency?"":this.month,rtowk=this.week,rday[0]=parseInt(this.day[0])+1;return rObj.RTOWK=rtowk,rObj.RMON=rmon,rObj.RDATE=rdate,rObj.RDAY=rday,rObj}return null},reset:function(){this.frequency=-1,this.interval=1,this.option=0,this.date=null,this.month=null,this.day=null,this.week=null,this.until=null,this.count=0}},zcalRepeat}();ZCL_chgeRepOpt=function(ele,ev){ZCL_stopEvents(ev),"zcl_rep_span"==ele.id?ZCL_openRepeatPP():(ZCL_ChgChk(ele),"msi-check"==ele.childNodes[0].className?ZCL_openRepeatPP():zcal.$("zcl_rep_span")&&(zcal.$("zcl_rep_span").innerHTML=""))},ZCL_openRepeatPP=function(){var repEle;ZCL_$("zcl_ce_rsec")||$("body").append("<div id='zcl_ce_rsec' class='zcl_rpt'/>"),repEle=$("#zcl_ce_rsec");var repDOM=_zm.getDOM(["UL",{child:[["LI",{attrs:{id:"zcl_rep_optpar"},child:[["text",zcal.i18n.repeats]]}],["LI",{child:[["UL",{attrs:{"class":"zcl_CMS"},child:[["LI",{attrs:{"class":"zcl_repsec",id:"zcl_repsec"}}]]}]]}]]}]);repEle.html(repDOM),ZCL_constRepeatOpt();var options={title:zcal.i18n.repeat,style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright",closeaction:function(){ZCL_closeRepeat()},buttons:[{txt:zcal.i18n.done,callback:function(){ZCL_getRepeatData()}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){ZCL_closeRepeat()}}]};zmsDialog.create("zcl_ce_rsec",options),ZCL_$("zcl_ce_rutl")&&ZEVENTS(ZCL_$("zcl_ce_rutl").parentNode).picker("date",{dform:zcal.DFORMAT[zcal.cdata.opt.DF],refer:"zcl_ce_rutl",wkst:0,mode:"popup",update:"yes",minhgt:251}).bind()},ZCL_constRepeatOpt=function(){var _sel=document.createElement("select");_sel.id="zcl_ce_rfreq",_sel.className="select",ZCL_putValues(_sel,zcal.EOBJ.rObj.frequency,zcal.REPEAT_FREQ),_sel.addEventListener("change",function(){this.selectedIndex;ZCL_setRepeatCriteria(this.selectedIndex)});var _div=document.createElement("div");_div.className="SC_select",_div.appendChild(_sel),$("#zcl_rep_optpar").append(_div);var _rele=$("<ul><li id='zcl_rep_cri'></li><li></li><li></li><li id='zcl_rep_ends'></li></ul>");$(_rele.children()[1]).append($("<ul class='zcl_sp'><li></li></ul>")),$(_rele.children()[2]).append($("<ul class='zcl_adrept'><li>"+zcal.i18n.ends+"</li></ul>")),$("#zcl_repsec").append(_rele),zcal.EOBJ.rObj&&-1!=zcal.EOBJ.rObj.frequency&&ZCL_$("zcl_rep_span")&&(ZCL_$("zcl_rep_span").innerHTML=zcal.EOBJ.rObj.getStr()),ZCL_setRepeatCriteria(-1!=zcal.EOBJ.rObj.frequency?zcal.EOBJ.rObj.frequency:0),ZCL_setRepeatEnds()},ZCL_setRepeatEnds=function(){var recurobj=zcal.EOBJ.rObj,rendEle=ZCL_$("zcl_rep_ends"),rcount=recurobj.count>0?recurobj.count:0,runtil=recurobj.until?ZCL_putDate(recurobj.until):0,noendEle=document.createElement("UL");noendEle.className="zcl_adrept",noendEle.addEventListener("click",function(){ZCL_ChgRdo(this),ZCL_addTbox(this)}),noendEle.appendChild($('<li class="zcl_curpt"><i class="'+(0==rcount&&0==runtil?"msi-option":"msi-unoption")+'"></i>'+zcal.i18n.noenddate+"</li>")[0]),rendEle.appendChild(noendEle);var untilEle=document.createElement("UL");untilEle.className="zcl_adrept",untilEle.addEventListener("click",function(){ZCL_ChgRdo(this),ZCL_addTbox(this,0!=runtil?runtil:null)}),untilEle.appendChild($('<li class="zcl_curpt"><i class="'+(0==rcount&&0!=runtil?"msi-option":"msi-unoption")+'"></i>'+zcal.i18n.until+"</li>")[0]),untilEle.appendChild($('<li class="zcl_select" '+(0==rcount&&0!=runtil?"":'style="display:none"')+'><input type="text" class="SC_tiput" id="zcl_ce_rutl" value="'+runtil+'"></li>')[0]),rendEle.appendChild(untilEle);var countEle=document.createElement("UL");countEle.className="zcl_adrept",countEle.addEventListener("click",function(){ZCL_ChgRdo(this),ZCL_addTbox(this)}),countEle.appendChild($('<li class="zcl_curpt"><i class="'+(0!=rcount?"msi-option":"msi-unoption")+'"></i>'+ZCL_replaceString(zcal.i18n.fortimes,['<input type="text" id="zcl_ce_rcnt" maxlength="3" value="'+(0!=rcount?rcount:"")+'" class="zcl_rpdy SC_tiput">'])+"</li>")[0]),rendEle.appendChild(countEle)},ZCL_setRepeatCriteria=function(rfreq){var rObj=zcal.EOBJ.rObj;0==rfreq?ZCL_dailyRepeatOption(rObj):1==rfreq?ZCL_weeklyRepeatOption(rObj):2==rfreq?ZCL_monthlyRepOption(rObj):3==rfreq&&ZCL_yearlyRepeatOption(rObj)},ZCL_getRepeatData=function(){var recurobj=zcal.EOBJ.rObj,rfreq=ZCL_$("zcl_ce_rfreq").value,_criEle=ZCL_$("zcl_rep_cri");if(recurobj.setFrequency(rfreq),0==rfreq){var _ele1=_criEle.children[0].children[0],_ele2=_criEle.children[1].children[0];if("msi-option"==_ele1.children[0].className){recurobj.setOption(0);var interval=_ele1.children[1].value;if(isNaN(interval)||""==interval||0>=interval)return zmUtil.succErrMsg("e",zcal.i18n.invalidrecurpattern),_ele1.children[1].focus(),!1;recurobj.setInterval(interval)}else"msi-option"==_ele2.children[0].className&&(recurobj.setOption(1),recurobj.setInterval(1))}else if(1==rfreq){var _ele1=_criEle.children[0].children[0],interval=_ele1.children[0].value;if(isNaN(interval)||""==interval||0>=interval)return zmUtil.succErrMsg("e",zcal.i18n.invalidrecurpattern),_ele1.children[0].focus(),!1;recurobj.setInterval(interval);var _ele2Childs=_criEle.children[1].children;recurobj.day=[];for(var i=0;i<_ele2Childs.length;i++)"msi-check"==_ele2Childs[i].children[0].className&&recurobj.day.push(i)}else if(2==rfreq){var _ele1=_criEle.children[0].children[0],_ele2=_criEle.children[1].children[0];if("msi-option"==_ele1.children[0].className){recurobj.setOption(0);var mdate=_ele1.children[1].value;if(isNaN(mdate)||""==mdate||1>mdate||mdate>ZCL_ESDATE.getDaysInMonth())return zmUtil.succErrMsg("e",zcal.i18n.invalidrecurpattern),_ele1.children[1].focus(),!1;recurobj.setDate(mdate);var interval=_ele1.children[2].value;if(isNaN(interval)||""==interval||0>=interval)return zmUtil.succErrMsg("e",zcal.i18n.invalidrecurpattern),_ele1.children[2].focus(),!1;recurobj.setInterval(interval)}else if("msi-option"==_ele2.children[0].className){recurobj.setOption(1),recurobj.setWeek(_ele2.children[1].children[0].value),recurobj.setDay([_ele2.children[2].children[0].value]);var interval=_ele2.children[3].value;if(isNaN(interval)||""==interval||0>=interval)return zmUtil.succErrMsg("e",zcal.i18n.invalidrecurpattern),_ele2.children[3].focus(),!1;recurobj.setInterval(interval)}}else if(3==rfreq){var _ele1=_criEle.children[0].children[0],_ele2=_criEle.children[1].children[0];if(recurobj.setInterval(1),"msi-option"==_ele1.children[0].className){recurobj.setOption(0);var rmonth=_ele1.children[1].children[0].value,rdate=_ele1.children[2].value,tempDate=ZCL_ESDATE.clone();if(tempDate.setDate(1),tempDate.setMonth(rmonth),isNaN(rdate)||""==rdate||1>rdate||rdate>tempDate.getDaysInMonth())return zmUtil.succErrMsg("e",zcal.i18n.invalidrecurpattern),_ele1.children[2].focus(),!1;recurobj.setMonth(rmonth),recurobj.setDate(rdate)}else"msi-option"==_ele2.children[0].className&&(recurobj.setOption(1),recurobj.setWeek(_ele2.children[1].children[0].value),recurobj.setDay([_ele2.children[2].children[0].value]),recurobj.setMonth(_ele2.children[3].children[0].value))}var endEle=ZCL_$("zcl_rep_ends");if("msi-option"==endEle.children[1].children[0].children[0].className){if(!ZCL_dateValidate("zcl_ce_rutl",zcal.i18n.repun))return!1;if(!ZCL_dateComparison("zcl_ce_rutl",zcal.i18n.repun,"zcl_ce_ed",zcal.i18n.eveed,"GE"))return!1;recurobj.setUntil(ZCL_DFDate(ZCL_$("zcl_ce_rutl").value)),recurobj.setCount(0)}else if("msi-option"==endEle.children[2].children[0].children[0].className){var rcount=ZCL_$("zcl_ce_rcnt").value.trim();if(""==rcount)return zmUtil.succErrMsg("e",zcal.i18n.repeatcount),ZCL_$("zcl_ce_rcnt").focus(),!1;if(!ZCL_intValidate("zcl_ce_rcnt",zcal.i18n.repcount))return!1;recurobj.setCount(parseInt(rcount)),recurobj.setUntil(0)}else recurobj.setUntil(0),recurobj.setCount(0);var _sp=ZCL_$("zcl_rep_span")||document.createElement("span");_sp.id="zcl_rep_span",_sp.className="zcl_lk",_sp.onclick=function(event){ZCL_chgeRepOpt(this,event)},_sp.innerHTML=recurobj.getStr(),ZCL_$("zcl_rep").appendChild(_sp),ZCL_closeRepeat()},ZCL_closeRepeat=function(){var recurobj=zcal.EOBJ.rObj;zmsDialog.remove(!0);var _rele=ZCL_$("zcl_ce_rsec");_rele&&_rele.parentNode.removeChild(_rele),-1==recurobj.frequency&&(ZCL_$("zcl_rep").children[0].className="msi-uncheck")},ZCL_ChgRdo=function(cur,str){for(var rdoDivs=cur.parentNode.childNodes,i=0;i<rdoDivs.length;i++)"I"==rdoDivs[i].childNodes[0].childNodes[0].tagName&&(rdoDivs[i].childNodes[0].childNodes[0].className="msi-unoption");cur.childNodes[0].childNodes[0].className="msi-option",str&&""!=str&&ZCL_Evl(0,str)},ZCL_addTbox=function(ele,d){var rends=ele.parentNode,runtilEle=rends.children[1];"msi-unoption"==runtilEle.children[0].children[0].className?runtilEle.children[1].style.display="none":(runtilEle.children[1].style.display="",runtilEle.children[1].children[0].value=d?d:zcal.$("zcl_ce_ed").value)},ZCL_dailyRepeatOption=function(recurobj){var _criEle=$("#zcl_rep_cri"),_ele1=$("<ul class='zcl_adrept'/>"),_ele2=$("<ul class='zcl_adrept'/>");_criEle.empty(),_ele1.on("click",function(){ZCL_ChgRdo(this)}),_ele1.append('<li class="zcl_curpt"><i class="'+(0==recurobj.option?"msi-option":"msi-unoption")+'"></i>'+ZCL_replaceString(zcal.i18n.ce_daily0,['<input type="text" id="zcl_rivl0" value="'+recurobj.interval+'" class="zcl_rpdy SC_tiput">'])+"</li>"),_criEle.append(_ele1),_ele2.on("click",function(){ZCL_ChgRdo(this)}),_ele2.append($('<li class="zcl_curpt"><i class="'+(1==recurobj.option?"msi-option":"msi-unoption")+'"></i>'+zcal.i18n.ce_daily1+"</li>")),_criEle.append(_ele2)},ZCL_weeklyRepeatOption=function(recurobj){var _criEle=$("#zcl_rep_cri"),_ele1=$("<ul class='zcl_adrept'/>"),_ele2=$("<ul class='zcl_adrept zcl_adreptwk'/>");_criEle.empty(),_ele1.append($('<li class="zcl_curpt">'+ZCL_replaceString(zcal.i18n.ce_weekly0,['<input type="text" id="zcl_rivl0" value="'+recurobj.interval+'" class="zcl_rpdy SC_tiput">'])+"</li>")),_criEle.append(_ele1);for(var i in Date.WEEK_DAYS[1]){var wkdEle=$('<li class="zcl_curpt"/>');wkdEle.html('<i class="'+(-1!=recurobj.day.indexOf(parseInt(i))?"msi-check":"msi-uncheck")+'"></i>'+Date.WEEK_DAYS[1][i]),wkdEle.on("click",function(){ZCL_ChgChk(this)}),_ele2.append(wkdEle)}_criEle.append(_ele2)},ZCL_monthlyRepOption=function(recurobj){var _criEle=$("#zcl_rep_cri"),_ele1=$("<ul class='zcl_adrept'/>");_ele2=$("<ul class='zcl_adrept'/>"),l=recurobj.day.length,_criEle.empty(),_ele1.on("click",function(){ZCL_ChgRdo(this)}),_ele1.append($('<li class="zcl_curpt"><i class="'+(0==recurobj.option?"msi-option":"msi-unoption")+'"></i>'+ZCL_replaceString(zcal.i18n.ce_monthly0,['<input type="text" id="zcl_rmd" value="'+recurobj.date+'" class="zcl_rpdy SC_tiput">','<input type="text" id="zcl_rivl0" value="'+recurobj.interval+'" class="zcl_rpdy SC_tiput">'])+"</li>")),_criEle.append(_ele1),_ele2.on("click",function(){ZCL_ChgRdo(this)}),_ele2.append($('<li class="zcl_curpt"><i class="'+(1==recurobj.option?"msi-option":"msi-unoption")+'"></i>'+ZCL_replaceString(zcal.i18n.ce_monthly1,[ZCL_selBox("zcl_reps0",recurobj.week,zcal.WEEK_TYPE,"wktype","zcl_stime"),ZCL_selBox("zcl_reps1",recurobj.day[l-1],Date.WEEK_DAYS[0],"weekdays","zcl_sday"),'<input type="text" id="zcl_rivl0" value="'+recurobj.interval+'" class="zcl_rpdy SC_tiput">'])+"</li>")),_criEle.append(_ele2)},ZCL_yearlyRepeatOption=function(recurobj){var _criEle=$("#zcl_rep_cri"),_ele1=$("<ul class='zcl_adrept'/>");_ele2=$("<ul class='zcl_adrept'/>"),l=recurobj.day.length,_criEle.empty(),_ele1.on("click",function(){ZCL_ChgRdo(this)}),_ele1.append($('<li class="zcl_curpt"><i class="'+(0==recurobj.option?"msi-option":"msi-unoption")+'"></i>'+ZCL_replaceString(zcal.i18n.ce_yearly0,[ZCL_selBox("zcl_mons0",recurobj.month,Date.MONTH_NAMES[0],"months","zcl_sdate"),'<input type="text" id="zcl_rivl0" value="'+recurobj.date+'" class="zcl_rpdy SC_tiput">'])+"</li>")),_criEle.append(_ele1),_ele2.on("click",function(){ZCL_ChgRdo(this)}),_ele2.append($('<li class="zcl_curpt"><i class="'+(1==recurobj.option?"msi-option":"msi-unoption")+'"></i>'+ZCL_replaceString(zcal.i18n.ce_yearly1,[ZCL_selBox("zcl_reps0",recurobj.week,zcal.WEEK_TYPE,"wktype","zcl_stime"),ZCL_selBox("zcl_reps1",recurobj.day[l-1],Date.WEEK_DAYS[0],"weekdays","zcl_sday"),ZCL_selBox("zcl_mons0",recurobj.month,Date.MONTH_NAMES[0],"months","zcl_sdate")])+"</li>")),_criEle.append(_ele2)},ZCL_showConfirm=function(mode,obj){var _rele=document.createElement("div");_rele.id="zcl_redit_confirm",_rele.className="zcl_rpt",_rele.innerHTML="delete"==mode?zcal.i18n.rdelete_msg:zcal.i18n.redit_msg,document.body.appendChild(_rele);var options={title:"delete"==mode?zcal.i18n.confirm_delete:zcal.i18n.confirm_edit,style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright",closeaction:function(){ZCL_closeREditConfirm()},buttons:[{txt:zcal.i18n.only,callback:function(){"delete"==mode?ZCL_delRep(0,obj):"qedit"==mode?zcalEDrag.editRep(0,obj):(ZCL_retEntry(0),ZCL_closeREditConfirm())}},{txt:zcal.i18n.redit0,callback:function(){"delete"==mode?ZCL_delRep(1,obj):"qedit"==mode?zcalEDrag.editRep(1,obj):(ZCL_retEntry(1),ZCL_closeREditConfirm())}},{txt:zcal.i18n.redit1,callback:function(){"delete"==mode?ZCL_delRep(2,obj):"qedit"==mode?zcalEDrag.editRep(2,obj):(ZCL_retEntry(2),ZCL_closeREditConfirm())}},{txt:zcal.i18n.cancel,callback:function(){ZCL_closeREditConfirm()}}]};zmsDialog.create("zcl_redit_confirm",options)},ZCL_closeREditConfirm=function(){zmsDialog.remove(!0);var _reditEle=ZCL_$("zcl_redit_confirm");_reditEle&&_reditEle.parentNode.removeChild(_reditEle),ZCL_clrStck(),zcalView.plotEvents()};var zcalAlarm=function(){"use strict";function zcalAlarm(){this.actionType="0",this.reminderType="0",this.reminderTime=supportedAlarm[0]}var supportedAlarm=["300000","600000","900000","1200000","1500000","1800000","2700000","3600000","7200000","14400000","21600000","28800000","43200000","86400000","172800000","259200000","345600000","432000000","518400000","604800000","691200000","777600000","864000000","950400000","1036800000","1123200000","1209600000","1296000000","2592000000","3888000000","5184000000","7776000000"],selectOption=function(ele,sel,refArr){var optStr="";for(var x in refArr)optStr+='<option value="'+x+'" '+(x==sel?"selected='true'":"")+">"+refArr[x]+"</option>";ele.innerHTML=optStr};return zcalAlarm.prototype.set=function(obj){this.actionType=obj&&obj.ACTYPE,this.reminderType=obj&&obj.REMTYPE,this.reminderTime=obj&&obj.REMTIME},zcalAlarm.prototype.getDOM=function(type){var atypeDOM,rtypeDOM,rtimeDOM,delDOM,alarmObj=this,alarmDOM=$('<ul><li><div class="SC_select"><select class="select"></select></div></li><li><div class="SC_select"><select class="select"></select></div></li><li><div class="SC_select"><select class="select"></select></div></li><li><i class="msi-close" title='+zcal.i18n.remove+"></i></li></ul>")[0];return rtimeDOM=alarmDOM.children[0].children[0].children[0],selectOption(rtimeDOM,alarmObj.reminderTime,zcal.REMSTR),rtypeDOM=alarmDOM.children[1].children[0].children[0],selectOption(rtypeDOM,alarmObj.reminderType,zcal.ALARM_REMTYPE),atypeDOM=alarmDOM.children[2].children[0].children[0],selectOption(atypeDOM,alarmObj.actionType,zcal.ALARM_ACTTYPE),delDOM=alarmDOM.children[3],delDOM.addEventListener("click",function(){var addremEle,reminderEle=this.parentNode.parentNode;reminderEle.removeChild(this.parentNode),addremEle=reminderEle.querySelector("#zcl_addrem"),addremEle||ZCL_AppendRemAddLnk(reminderEle)}),"dom"===type?alarmDOM:"string"===type?alarmDOM.outerHTML:void 0},zcalAlarm}();ZCL_getObj=function(name,doc){var p,i,x;for(doc||(doc=document),void 0!=name&&(p=name.indexOf("?"))>0&&parent.frames.length&&(doc=parent.frames[name.substring(p+1)].document,name=name.substring(0,p)),!(x=doc[name])&&doc.all&&(x=doc.all[name]),i=0;!x&&i<doc.forms.length;i++)x=doc.forms[i][name];for(i=0;!x&&doc.layers&&i<doc.layers.length;i++)x=ZCL_getObj(name,doc.layers[i].document);return!x&&doc.getElementById&&(x=doc.getElementById(name)),x};var ZCL_ESDATE=new Date,ZCL_EEDATE=new Date;ZCL_calcEed=function(cur,s){var sval=ZCL_$("zcl_ce_sd").value.trim();if(""!=sval){s&&ZCL_CRTim(cur);var del=ZCL_parseTime(ZCL_$("zcl_ce_st").value),de11=ZCL_splitDateVal(sval),tDate=new Date(de11[2],de11[1]-1,de11[0],del.HH,del.mm,0,0),diffinMillis=tDate.getTime()-ZCL_ESDATE.getTime();ZCL_EEDATE.setTime(ZCL_EEDATE.getTime()+diffinMillis),ZCL_$("zcl_ce_ed").value=ZCL_EEDATE.dateBy(zcal.DFORMAT[zcal.cdata.opt.DF]),ZCL_$("zcl_ce_et").value=ZCL_EEDATE.dateBy(zcal.timeformat[zcal.cdata.opt.TF]),ZCL_ESDATE=tDate.clone(),zcal.EOBJ.rObj&&!zcal.EOBJ.EID&&(zcal.EOBJ.rObj.init(ZCL_ESDATE),ZCL_$("zcl_rep_span").innerHTML=zcal.EOBJ.rObj.getStr())}},ZCL_setEed=function(cur,s){var sval=ZCL_$("zcl_ce_ed").value.trim();if(""!=sval){s&&ZCL_CRTim(cur);var de1=ZCL_splitDateVal(sval),del=ZCL_parseTime(ZCL_$("zcl_ce_et").value);ZCL_EEDATE=new Date(de1[2],de1[1]-1,de1[0],del.HH,del.mm,0,0),ZCL_ESDATE>=ZCL_EEDATE&&(ZCL_EEDATE.setDate(ZCL_ESDATE.getTime()-ZCL_EEDATE.getTime()>=zcal.MSPERHOUR?ZCL_ESDATE.getDate():ZCL_ESDATE.getDate()+1),zcal.$("zcl_ce_ed").value=ZCL_EEDATE.dateBy(zcal.DFORMAT[zcal.cdata.opt.DF]))}},ZCL_isEmail=function(email){email=email.trim();var re=/^[\w]([\w\-\.\+\'\/]*)@([\w\-\.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/i;return re.test(email)},ZCL_crmFormValidate=function(){if(""==ZCL_$("zcl_ce_tit").value.trim())return _zm.succErrMsg("e",zcal.i18n.plenttle),ZCL_$("zcl_ce_tit").focus(),!1;if(!ZCL_dateValidate("zcl_ce_sd",zcal.i18n.evest)||!ZCL_dateValidate("zcl_ce_ed",zcal.i18n.eveed))return!1;if(!ZCL_dateTimeComparison("zcl_ce_ed","zcl_ce_et",zcal.i18n.eveed,"zcl_ce_sd","zcl_ce_st",zcal.i18n.evest,"G"))return!1;for(var fieldname=ZCL_$("zcl_crmfldname").value.split(";"),fielddatatype=ZCL_$("zcl_crmfldtype").value.split(";"),fieldlabel=ZCL_$("zcl_crmfldlabel").value.split(";"),i=0;i<fieldname.length;i++){var type=fielddatatype[i].split("~"),fldname="zcl_"+fieldname[i];if("M"==type[1]&&null!=ZCL_$(fldname)&&!ZCL_emptyCheck(fldname,fieldlabel[i]))return!1;switch(type[0]){case"O":break;case"V":break;case"C":break;case"E":if(null!=ZCL_getObj(fldname)&&0!=ZCL_getObj(fldname).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!ZCL_emailValidate(fldname,fieldlabel[i]))return!1;break;case"DT":if(null!=ZCL_getObj(fldname)&&0!=ZCL_getObj(fldname).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var currdatechk="undefined"==typeof type[3]?"OTH":type[3];if(!ZCL_dateTimeValidate(fldname,type[2],fieldlabel[i],currdatechk))return!1}break;case"D":if(null!=ZCL_getObj(fldname)&&0!=ZCL_getObj(fldname).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var currdatechk="undefined"==typeof type[2]?"OTH":type[2];if(!ZCL_crmDateValidate(fldname,fieldlabel[i],currdatechk))return!1}break;case"I":if(null!=ZCL_getObj(fldname)&&0!=ZCL_getObj(fldname).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!ZCL_crmIntValidate(fldname,fieldlabel[i]))return!1;break;case"DE":if(null!=ZCL_getObj(fldname)&&0!=ZCL_getObj(fldname).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var numformat="undefined"==typeof type[2]?"any":type[2];if(!ZCL_decimalValidate(fldname,fieldlabel[i],numformat))return!1}break;case"N":if(null!=ZCL_getObj(fldname)&&0!=ZCL_getObj(fldname).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var numformat="undefined"==typeof type[2]?"any":type[2];if(!ZCL_numValidate(fldname,fieldlabel[i],numformat))return!1}break;case"P":if(null!=ZCL_getObj(fldname)&&0!=ZCL_getObj(fldname).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!ZCL_phoneValidate(fldname,fieldlabel[i]))return!1;break;case"W":if(null!=ZCL_getObj(fldname)&&0!=ZCL_getObj(fldname).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!ZCL_isValidWebURL(fldname,fieldlabel[i]))return!1}}return!0},ZCL_emptyCheck=function(fldName,fldLabel){var currObj=ZCL_getObj(fldName);if(null==currObj||0!=currObj.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length||currObj.disabled)return!0;_zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_emptychk,[fldLabel]));try{currObj.focus()}catch(e){}return!1},ZCL_isValidWebURL=function(fldName,fldLabel){var currObj=ZCL_getObj(fldName),httpProtocol="http",httpsProtocol="https",value=currObj.value,urlregex=new RegExp("^("+httpProtocol+":\\/\\/www.|"+httpsProtocol+":\\/\\/www.|ftp:\\/\\/www.|www.|"+httpProtocol+":\\/\\/|"+httpsProtocol+":\\/\\/|ftp:\\/\\/|){1}[a-zA-Z0-9--]+(\\.[a-zA-Z0-9-\\_\\#\\:\\;\\?]+)+(/[\\w-\\;\\-\\*\\._\\?\\,\\:\\'/\\\\\\+&amp;%\\$#\\=~@-]*)*$");return urlregex.test(value)?!0:(_zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),currObj.focus(),!1)},ZCL_phoneValidate=function(fldName,fldLabel){var currObj=ZCL_getObj(fldName),re=/^[0-9a-zA-Z!#%\*\^\(\)=\{\}\[\]\?`~_\-\.\$@\?\,\:\'\/\!\P{InBasicLatin}\s\+\|\\]+$/;return re.test(currObj.value.trim())?!0:(_zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),currObj.focus(),!1)},ZCL_crmDateValidate=function(fldName,fldLabel){ZCL_getObj(fldName);if(0==ZCL_patternValidate(fldName,fldLabel,"DATE"))return!1;dateval=ZCL_getObj(fldName).value.replace(/^\s+/g,"").replace(/\s+$/g,"");var dateelements=ZCL_splitDateVal(dateval);if(dd=dateelements[0],mm=dateelements[1],yyyy=dateelements[2],1>dd||dd>31||1>mm||mm>12||1>yyyy||1e3>yyyy)return _zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(fldName).focus(),!1;if(2==mm&&dd>29)return _zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(fldName).focus(),!1;if(2==mm&&dd>28&&!isLeapYear(yyyy))return _zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(fldName).focus(),!1;switch(parseInt(mm,10)){case 2:case 4:case 6:case 9:case 11:if(dd>30)return _zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),ZCL_getObj(fldName).focus(),!1}return!0},ZCL_emailValidate=function(fldName,fldLabel){return 0==ZCL_patternValidate(fldName,fldLabel,"EMAIL")?!1:!0},ZCL_numValidate=function(fldName,fldLabel,format){var numField=ZCL_getObj(fldName),val=ZCL_getObj(fldName).value.replace(/^\s+/g,"").replace(/\s+$/g,"");if(null!=numField&&0!=numField.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var re=/^-?\d+((\d)+)*(\.\d{1,2})?$/;if("any"!=format&&0!=parseInt(format)){var format=format.split(","),restr="^-?\\d+((\\d)+)*(\\.\\d{1,"+format[0]+"})?$";re=new RegExp(restr)}return re.test(val)?(numField.value=val,!0):(_zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),numField.focus(),!1)}return!0},ZCL_decimalValidate=function(fldName,fldLabel,format){var fldObj=ZCL_getObj(fldName);if(null!=fldObj&&0!=fldObj.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var val=fldObj.value.replace(/^\s+/g,"").replace(/\s+$/g,""),re=/^-?\d+(\.\d\d*)*$/;if("any"!=format&&0!=parseInt(format)){var restr="^-?\\d+((\\d)+)*(\\.\\d{1,"+format+"})?$";re=new RegExp(restr)}return re.test(val)?!0:(_zm.succErrMsg("e",ZCL_replaceString(zcal.i18n.validation_datachk,[fldLabel])),fldObj.focus(),!1)}return!0},ZCL_clearId=function(fldId){var currObj=ZCL_$(fldId);currObj.value=""};var zcalFreebusy=function(){var $fb,eSDate,eEDate,eSTime,eETime,fbSDate,fbEDate,currDate,fbReqDate,defEmail,isAllday=!1,workShr=0,workEhr=23,displayMode=1,fbDataObj={},fbRange=[],attendeeFBStatus={},attendeeArr=[],oldAttendees=[],freeSlotFinder={},fbTimer=null,focusHr=0,fbGridLeft=0,gridMaxLeft=0,eSlot=1,onedayWorkHrWidth=onedayAllTimeWidth=0,scrollWidth=600,getFB=function(){isFreeBusyClicked=!0,initFB(),constFBLayout();for(var i=0;i<attendeeArr.length;i++){var _attEmail=attendeeArr[i];attendeeFBStatus[_attEmail]||(attendeeFBStatus[_attEmail]=!1,constEmptyGrid(_attEmail),sendFBReq({email:_attEmail,date:fbReqDate.getDate(),month:fbReqDate.getMonth()+1,year:fbReqDate.getFullYear()}))}},processFBRes=function(res){var resObj=ZCL_Evl(1,res.responseText);for(var eid in resObj){var _fbdata=resObj[eid];if(attendeeFBStatus[eid]=!0,"object"==typeof _fbdata)for(var _dat in _fbdata)$.publish("/calendar/fillfb",{date:_dat,fbdata:_fbdata[_dat]}),fillBusySlot({email:eid,date:_dat,fbdata:_fbdata[_dat]})}},fillBusySlot=function(fbData){var _email=fbData.email,_datStr=fbData.date,_fbData=fbData.fbdata,_attObj=fbDataObj[_datStr][_email]||new attendeeObj;_attObj.setFBSlot({fbslot:_fbData}),fbDataObj[_datStr][_email]=_attObj;var _attPos=attendeeArr.indexOf(_email);if(ZCL_$("zcl_fb"+_datStr)&&-1!=_attPos){var _dateDiv=ZCL_$("zcl_fb"+_datStr);_dateDiv.replaceChild(_attObj.$el[0],_dateDiv.childNodes[_attPos])}},getLimit=function(){var tdate=new Date;tdate.setTime(fbReqDate.getTime());var tdat1=tdate.clone();tdat1.setDate(1),tdat1.setHours(0,0,0,0);var tdat2=tdate.clone();return tdat2.setMonth(tdat2.getMonth()+2),tdat2.setDate(tdat2.getDaysInMonth()),tdat2.setHours(0,0,0,0),[tdat1,tdat2]},setFreeSlotFinder=function(){for(var _tdat=fbRange[0].clone();_tdat<=fbRange[1];){var _datStr=_tdat.dateBy("yyyyMMdd");freeSlotFinder[_datStr]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_tdat.setDate(_tdat.getDate()+1)}},updateFreeSlotFinder=function(data){var _datStr=data.date,_fbData=data.fbdata;if(_fbData[0])freeSlotFinder[_datStr]=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];else if(_fbData[1])for(var i=0;i<_fbData[1].length;i++)for(var _btime=_fbData[1][i].split("-"),j=_btime[0];j<_btime[1];j++)freeSlotFinder[_datStr][j]=1},removeAttedee=function(emailId){var _idx=attendeeArr.indexOf(emailId);if(-1!=_idx){attendeeArr.splice(_idx,1);for(var _dStr in fbDataObj)fbDataObj[_dStr][emailId]&&delete fbDataObj[_dStr][emailId],ZCL_$("zcl_fb"+_dStr)&&ZCL_$("zcl_fb"+_dStr).removeChild(ZCL_$("zcl_fb"+_dStr).childNodes[_idx])}},initFB=function(){defEmail=zcal.cdata.opt.MID;var att=ZCL_getFullAttendee();""!==att&&(attendeeArr=att.split(",")),ZCL_in_array(zcal.cdata.opt.MID,attendeeArr)||attendeeArr.splice(0,0,zcal.cdata.opt.MID),oldAttendees=attendeeArr.slice();var de1=ZCL_splitDateVal(ZCL_$("zcl_ce_sd").value);isAllday="msi-check"==ZCL_$("zcl_ce_aday").className?!0:!1;var d1=new Date;if(d1.setYear(de1[2]),d1.setMonth(de1[1]-1),d1.setDate(de1[0]),d1.setHours(0,0,0,0),!isAllday){var ParST=ZCL_parseTime(ZCL_$("zcl_ce_st").value);d1.setHours(ParST.HH,ParST.mm,0,0)}eSDate=d1.clone(),eSTime=eSDate.dateBy("HHmm");var de2=ZCL_splitDateVal(ZCL_$("zcl_ce_ed").value),d2=new Date;if(d2.setYear(de2[2]),d2.setMonth(de2[1]-1),d2.setDate(de2[0]),d2.setHours(0,0,0,0),!isAllday){var ParET=ZCL_parseTime(ZCL_$("zcl_ce_et").value);d2.setHours(ParET.HH,ParET.mm,0,0)}eEDate=d2.clone(),eETime=eEDate.dateBy("HHmm"),eSlot=Math.ceil((eEDate-eSDate)/18e5),eSlot+=isAllday?48:0,currDate=new Date,currDate.setTime(zcal.cdate),fbReqDate=d1.clone(),fbRange=getLimit(),subscribeToEvents(),setFreeSlotFinder(),fbSDate=fbReqDate.clone(),fbSDate.setDate(fbSDate.getDate()-4),fbSDate.setHours(0,0,0,0),fbSDate<fbRange[0]&&(fbSDate=fbRange[0].clone()),fbEDate=fbReqDate.clone(),fbEDate.setDate(fbEDate.getDate()+6),fbEDate.setHours(0,0,0,0),fbEDate>fbRange[1]&&(fbEDate=fbRange[1].clone()),workShr=parseInt(zcal.cdata.opt.HS),workEhr=parseInt(zcal.cdata.opt.HE);var shr=eSDate.getHours(),ehr=eEDate.getHours();(workShr>shr||shr>workEhr||workShr>ehr||ehr>workEhr+1)&&(displayMode=0),onedayAllTimeWidth=1450,onedayWorkHrWidth=60*(workEhr-workShr+1)+10;var _nodays=ZCL_daysBetween(fbSDate.dateBy("yyyyMMdd"),eSDate.dateBy("yyyyMMdd"));focusHr=eSDate.getHours(),fbGridLeft=0==displayMode?-(_nodays*onedayAllTimeWidth+60*focusHr):-(_nodays*onedayWorkHrWidth+60*(focusHr-workShr))},getSelectedEmail=function(obj,sel){var eid=sel.data.eid;try{zmAutoFill.removeContact(sel.elm)}catch(e){}obj&&(obj[0].value="",obj[0].style.width="100%"),""!=eid&&ZCL_isEmail(eid)&&-1==attendeeArr.indexOf(eid)&&(attendeeArr.push(eid),attendeeFBStatus[eid]=!1,constEmptyGrid(eid),sendFBReq({email:eid,date:fbReqDate.getDate(),month:fbReqDate.getMonth()+1,year:fbReqDate.getFullYear()}))},fbTop=function(){var _fbtop=$("<li class='zcl_table'></li>"),_ul=$("<ul class='zcl_fbnv'></ul>"),_nxtFreeTime=$("<li></li>"),_cls=eSlot>=48?"zcl_lk zcl_dis":"zcl_lk";_nxtFreeTime.html('<span class="'+_cls+'">'+zcal.i18n.find_next_freetime+"</span>"),48>eSlot&&_nxtFreeTime.bind("click",function(){findNextFreeSlot()}),_ul.append(_nxtFreeTime);var _sel=document.createElement("select");_sel.className="select",ZCL_putValues(_sel,displayMode,{0:zcal.i18n.alltimes,1:zcal.i18n.workinghours}),_sel.addEventListener("change",function(){displayMode=_sel.selectedIndex;var _left=Math.abs(fbGridLeft);if(0==displayMode){var _rem=_left%onedayWorkHrWidth,_nod=(_left-_rem)/onedayWorkHrWidth;$(".zcl_fbhdn").removeClass("zcl_fbhdn").addClass("zcl_tmp"),fbGridLeft=-(_nod*onedayAllTimeWidth+60*focusHr)}else{var _rem=_left%onedayAllTimeWidth,_nod=(_left-_rem)/onedayAllTimeWidth,_hr=focusHr>=workShr&&workEhr>=focusHr?focusHr-workShr:0;$(".zcl_tmp").removeClass("zcl_tmp").addClass("zcl_fbhdn"),fbGridLeft=-(_nod*onedayWorkHrWidth+60*_hr)}ZCL_$("zcl_fbdtgrid").style.left=fbGridLeft+"px",ZCL_$("zcl_fbgrid").style.left=fbGridLeft+"px",setSelectedSlot()});var _div=document.createElement("div");_div.className="SC_select",_div.appendChild(_sel);var _fbmodeDD=$("<li></li>").append(_div);return _ul.append(_fbmodeDD),_fbtop.append(_ul),_fbtop},fbCenter=function(){var _fbcenter=$("<li class='zcl_table'></li>"),_ul=$("<ul class='zcl_fbtime'></ul>"),_addatt=$("<li></li>");_addatt.append($("<span>"+zcal.i18n.attendee+"</span>"));var _add=$("<u/>");_add.html("<i class='msi-add'></i>"),_add.bind("click",function(){var _inEle=$("<input type='text' id='zcl_fbadd'/>"),fillObj={contentArray:"",compare:["fn","ln","nn","eid"],LType:"1",OType:"1",drag:!1,actionCallback:zcalFreebusy.getSelectedEmail};zmAutoFill.setAutofill(fillObj,_inEle),$par=$(this).parent(),$par.empty(),$par.append($("<div/>").append(_inEle)),_inEle.focus()}),_addatt.append(_add),_ul.append(_addatt);var _nv=$("<li></li>"),_lftNv=$("<u id='zcl_fblftnv'></u>"),_rgtNv=$("<u id='zcl_fbrgtnv'></u>");_lftNv.html("<i class='msi-larrow'></i>"),_lftNv.bind("click",function(){navLeft(this)}),_rgtNv.html("<i class='msi-rarrow'></i>"),_rgtNv.bind("click",function(){navRight(this)}),_nv.append(_lftNv),_nv.append(_rgtNv);for(var _timeGrid=$("<div id='zcl_fbdtgrid'/>"),_tdate=fbRange[0].clone();_tdate<=fbRange[1];){if(_tdate>=fbSDate&&fbEDate>=_tdate){var _datTop=dateTop(_tdate);_timeGrid.append(_datTop)}fbDataObj[_tdate.dateBy("yyyyMMdd")]={},_tdate.setDate(_tdate.getDate()+1)}return _nv.append(_timeGrid),_ul.append(_nv),_fbcenter.append(_ul),_fbcenter},findNextFreeSlot=function(){for(var _nxtDate,_nxtSlot,_slotStr="",_isSlotAvl=!1,i=0;eSlot>i;i++)_slotStr+="0";var _tdate=eEDate.clone(),_start=1===displayMode?2*(eEDate.getHours()-workShr):2*eEDate.getHours();for(_start+=eEDate.getMinutes()>0?1:0;_tdate<=fbRange[1];){addFBGrid(1);var _dStr=_tdate.dateBy("yyyyMMdd");if(freeSlotFinder[_dStr]){var _slotArr=0===displayMode?freeSlotFinder[_dStr]:freeSlotFinder[_dStr].slice(2*workShr,2*(workEhr+1)),_slot=_slotArr.join(""),_sidx=_dStr===eEDate.dateBy("yyyyMMdd")?_start:0,_idx=_slot.indexOf(_slotStr,_sidx);if(-1!=_idx){_nxtDate=_tdate.clone(),_nxtDate.setHours(0,0,0,0),1===displayMode&&(_idx=2*workShr+_idx),_nxtSlot=_idx,_isSlotAvl=!0;break}}_tdate.setDate(_tdate.getDate()+1)}if(_isSlotAvl){eSDate=_nxtDate.clone();var _hr=(_nxtSlot-_nxtSlot%2)/2,_mins=_nxtSlot%2?30:0;eSDate.setHours(_hr,_mins,0,0),eEDate.setTime(eSDate.getTime()+30*eSlot*60*1e3),focusHr=eSDate.getHours(),setSelectedSlot()}},setSelectedSlot=function(){var _slot=Math.ceil((eEDate-eSDate)/18e5)+(isAllday?48:0);if(48>_slot){var _nod=ZCL_daysBetween(fbSDate.dateBy("yyyyMMdd"),eSDate.dateBy("yyyyMMdd")),_left=_nod*(0===displayMode?onedayAllTimeWidth:onedayWorkHrWidth),_hr=0===displayMode?focusHr:focusHr>=workShr&&workEhr>=focusHr?focusHr-workShr:0;_left+=60*_hr+(eSDate.getMinutes()>0?30:0);var _sele=ZCL_$("zcl_fbsslot")||document.createElement("SPAN"),iLeft=Math.abs(fbGridLeft);if(_sele.id="zcl_fbsslot",_sele.style.left=_left+"px",_sele.style.width=30*_slot+"px",ZCL_$("zcl_fbgrid").appendChild(_sele),0!=iLeft&&_left-iLeft>=600){var dleft=_left-iLeft-(_left-iLeft)%20;scrollRight(dleft,ZCL_$("zcl_fbrgtnv"))}}},scrollRight=function(z,_ele){fbTimer&&window.clearTimeout(fbTimer),z>0&&(fbGridLeft>-gridMaxLeft?(fbGridLeft-=20,ZCL_$("zcl_fbdtgrid").style.left=fbGridLeft+"px",ZCL_$("zcl_fbgrid").style.left=fbGridLeft+"px",z-=20,fbTimer=setTimeout(function(){zcalFreebusy.scrollRight(z,_ele)},1),_ele.className=""):(fbGridLeft=-gridMaxLeft,ZCL_$("zcl_fbdtgrid").style.left=fbGridLeft+"px",ZCL_$("zcl_fbgrid").style.left=fbGridLeft+"px",_ele.className="zcl_dis"),0==z&&(ZCL_$("zcl_fblftnv").className="",setFocusHour("right")))},scrollLeft=function(z,_ele){fbTimer&&window.clearTimeout(fbTimer),z>0&&(0>fbGridLeft?(fbGridLeft+=20,ZCL_$("zcl_fbdtgrid").style.left=fbGridLeft+"px",ZCL_$("zcl_fbgrid").style.left=fbGridLeft+"px",z-=20,fbTimer=setTimeout(function(){zcalFreebusy.scrollLeft(z,_ele)},1),_ele.className=""):(fbGridLeft=0,ZCL_$("zcl_fbdtgrid").style.left=fbGridLeft+"px",ZCL_$("zcl_fbgrid").style.left=fbGridLeft+"px",_ele.className="zcl_dis"),0==z&&(ZCL_$("zcl_fbrgtnv").className="",setFocusHour("left")))},navRight=function(_ele){scrollRight(scrollWidth,_ele)},navLeft=function(_ele){scrollLeft(scrollWidth,_ele)},setFocusHour=function(navType){var _left=Math.abs(fbGridLeft),_nodMoved=1;if(0==displayMode){var _rem=_left%onedayAllTimeWidth,_hr=(_rem-_rem%60)/60;_hr=_rem%60>0?_hr+1:0,focusHr=_hr}else{_nodMoved=onedayWorkHrWidth>scrollWidth?1:Math.round(scrollWidth/onedayWorkHrWidth);var _rem=_left%onedayWorkHrWidth,_hr=(_rem-_rem%60)/60;_hr=_hr+workShr+(_rem%60>0?1:0),_hr=_hr>=workShr&&workEhr>=_hr?_hr:0,focusHr=_hr}"right"===navType&&addFBGrid(_nodMoved)},addFBGrid=function(_nod){for(var _tdate=fbEDate.clone(),_cnt=0,_timeGrid=$("#zcl_fbdtgrid");_nod>_cnt;){_tdate.setDate(_tdate.getDate()+1);var _datStr=_tdate.dateBy("yyyyMMdd");if(!ZCL_$("zcl_fb"+_datStr)&&_tdate<=fbRange[1]){var _datTop=dateTop(_tdate);_timeGrid.append(_datTop);for(var i=0;i<attendeeArr.length;i++){var attEmailId=attendeeArr[i],_attObj=fbDataObj[_datStr][attEmailId]||new attendeeObj,_dateDiv=ZCL_$("zcl_fb"+_datStr)||document.createElement("DIV");_dateDiv.id="zcl_fb"+_datStr,_dateDiv.appendChild(_attObj.$el[0]),ZCL_$("zcl_fbgrid").appendChild(_dateDiv),fbDataObj[_datStr][attEmailId]=_attObj}fbEDate=_tdate.clone()}_cnt++}setGridMaxLeft()},dateTop=function(_dat){var _datE=$("<div/>");_datE.append("<s>"+_dat.dateBy("MMM dd, yyyy")+"</s>");for(var _timeList=$("<ul/>"),i=0;24>i;i++){var _cls=workShr>i||i>workEhr?"class='"+(0==displayMode?"zcl_tmp":"zcl_fbhdn")+"'":"";_timeList.append("<li "+_cls+">"+zcal.TT[i]+"</li>")}return _datE.append(_timeList),_datE},fbGridLayout=function(){return $('<li class="zcl_fbhgt"><div class="zcl_table"><ul class="zcl_fbgrid"><li><div id="zcl_fbatt" class="zcl_table"></div></li><li><div id="zcl_fbgrid"></div></li></ul></div></li>')},constFBLayout=function(){ZCL_$("zcl_freebusy")||$("body").append("<ul id='zcl_freebusy' class='zcl_fb'/>"),$fb=$("#zcl_freebusy"),$fb.html("");var topDOM=fbTop();$fb.append(topDOM);var centerDOM=fbCenter();$fb.append(centerDOM);var fbDOM=fbGridLayout();$fb.append(fbDOM);var options={title:zcal.i18n.freebusytime,style:{left:"500px",top:"100px","max-width":"900px"},drag:!1,mask:!0,ptr:"tright",closeaction:function(){zcalFreebusy.cleanUp()},buttons:[{txt:zcal.i18n.ok,callback:function(){zcalFreebusy.getSelAttendee()}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){zcalFreebusy.cleanUp()}}]};zmsDialog.create("zcl_freebusy",options)},constEmptyGrid=function(attEmailId){var _attEle=document.createElement("UL");if(_attEle.appendChild($("<li>"+attEmailId+"</li>")[0]),attEmailId!==defEmail){var _eleIcon=$("<li><i class='msi-delete'></i></li>");_eleIcon.bind("click",function(){this.parentNode.parentNode.removeChild(this.parentNode),zcalFreebusy.removeAttedee(attEmailId)}),_attEle.appendChild(_eleIcon[0])}else _attEle.appendChild($("<li/>")[0]);ZCL_$("zcl_fbatt").appendChild(_attEle);for(var _tdate=fbSDate.clone();fbEDate>=_tdate;){var _datStr=_tdate.dateBy("yyyyMMdd"),_attObj=fbDataObj[_datStr][attEmailId]||new attendeeObj,_dateDiv=ZCL_$("zcl_fb"+_datStr)||document.createElement("DIV");_dateDiv.id="zcl_fb"+_datStr,_dateDiv.appendChild(_attObj.$el[0]),ZCL_$("zcl_fbgrid").appendChild(_dateDiv),fbDataObj[_tdate.dateBy("yyyyMMdd")][attEmailId]=_attObj,_tdate.setDate(_tdate.getDate()+1)}ZCL_$("zcl_fbdtgrid").style.left=fbGridLeft+"px",ZCL_$("zcl_fbgrid").style.left=fbGridLeft+"px",setSelectedSlot(),setGridMaxLeft()},setGridMaxLeft=function(){var _nod=ZCL_daysBetween(fbSDate.dateBy("yyyyMMdd"),fbEDate.dateBy("yyyyMMdd"))+1;gridMaxLeft=0==displayMode?_nod*onedayAllTimeWidth-ZCL_$("zcl_fbgrid").offsetWidth:_nod*onedayWorkHrWidth-ZCL_$("zcl_fbgrid").offsetWidth},cleanUp=function(){isFreeBusyClicked=!1,zmsDialog.remove(!0),fbDataObj={},attendeeFBStatus={},attendeeArr=[],freeSlotFinder={},fbRange=[],$.unsubscribe("/calendar/fillfb"),$fb&&$fb.remove(),$fb=null},getSelAttendee=function(){if(ZCL_$("zcl_ce_sd").value=ZCL_putDate(eSDate.dateBy("yyyyMMdd")),ZCL_$("zcl_ce_ed").value=ZCL_putDate(eEDate.dateBy("yyyyMMdd")),!isAllday){var ttemp=zcal.timeformat[zcal.cdata.opt.TF];ZCL_$("zcl_ce_st").value=eSDate.dateBy("HHmm").getTimeBy(ttemp),ZCL_$("zcl_ce_et").value=eEDate.dateBy("HHmm").getTimeBy(ttemp)}for(var i=0;i<attendeeArr.length;i++)if(!ZCL_in_array(attendeeArr[i],oldAttendees)){var data={},obj={promise:!1,eid:attendeeArr[i]},defObj=zmail.ContactBook.get(obj);defObj.length>0?(data.profileImage=defObj[0].attrs.photo,data.id=defObj[0].attrs.eid,data.zid=defObj[0].attrs.zid):(data.profileImage=zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"),data.id=attendeeArr[i],data.zid=attendeeArr[i]),ZCL_attCont(data)}cleanUp()},sendFBReq=function(obj){var url="/cal/userFB.do?uemail="+obj.email.zcalescape()+"&date="+obj.date+"&month="+obj.month+"&year="+obj.year;ZCL_XHR(url,"zcalFreebusy.getFBRes")},subscribeToEvents=function(){$.subscribe("/calendar/fillfb",function(ev,data){updateFreeSlotFinder(data)})},attendeeObj=function(obj){this.fbslot=[],this.$el=$("<ul/>"),this.setFBSlot(obj)};attendeeObj.prototype={setFBSlot:function(obj){this.$el.empty();var _slot=obj&&obj.fbslot?obj.fbslot:[];if(_slot.length>0){if(_slot[0])for(var i=0;24>i;i++){this.fbslot.push([1,1]);var _cls=workShr>i||i>workEhr?"class='"+(0==displayMode?"zcl_tmp":"zcl_fbhdn")+"'":"";this.$el.append($("<li "+_cls+"><b></b><b></b></li>"))}else if(_slot[1]){for(var i=0;i<_slot[1].length;i++)for(var _btime=_slot[1][i].split("-"),j=_btime[0];j<_btime[1];j++){var _hr=(j-j%2)/2,_pos=j%2!=0?1:0;this.fbslot[_hr][_pos]=1}for(var i=0;24>i;i++){for(var _cls=workShr>i||i>workEhr?"class='"+(0==displayMode?"zcl_tmp":"zcl_fbhdn")+"'":"",_txt="",j=0;j<this.fbslot[i].length;j++)_txt+=1==this.fbslot[i][j]?"<b></b>":"<u></u>";this.$el.append($("<li "+_cls+">"+_txt+"</li>"))}}}else for(var i=0;24>i;i++){this.fbslot.push([0,0]);var _cls=workShr>i||i>workEhr?"class='"+(0==displayMode?"zcl_tmp":"zcl_fbhdn")+"'":"";this.$el.append($("<li "+_cls+"><u></u><u></u></li>"))}}};var fbObj={loadFB:getFB,getFBRes:processFBRes,cleanUp:cleanUp,getSelAttendee:getSelAttendee,scrollRight:scrollRight,scrollLeft:scrollLeft,removeAttedee:removeAttedee,getSelectedEmail:getSelectedEmail};return fbObj}(),zcalGroup=function(){var grpEle,groupList={},personalGroup=[],orgGroup=[],groupType="personal",selectedGroup=[],selectedEmail=[],fillObj=[],groupPPTop=function(){for(var iconList=[{type:"personal",icon:"msi-group"},{type:"org",icon:"msi-Ogrp"}],_topEle=$("<div/>"),i=0;i<iconList.length;i++){var iconObj=iconList[i],_iconEle=document.createElement("i");_iconEle.className=iconObj.icon+(iconObj.type===groupType?" zcl_sl":""),bindClickOnGroupType(_iconEle,iconObj.type),_topEle.append(_iconEle)}return _topEle},bindClickOnGroupType=function(giconEle,type){var $ele=$(giconEle);$ele.off("click").click(function(){groupType=type,$ele.parent().find("i").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),constGroupList()})},groupListContainer=function(){var _glistEle=$("<div class='zcl_table'/>"),_list=["UL",{child:[["LI",{attrs:{"class":"zcl_adgrpls"},child:[["DIV",{child:[["DIV",{attrs:{id:"zcl_glist","class":"zcl_table"}}]]}]]}],["LI",{attrs:{"class":"zcl_adgrpils",id:"zcl_gmemlist"}}]]}],_glist=_zm.getDOM(_list);return _glistEle.append(_glist),_glistEle},constGroupList=function(){var gObj="org"===groupType?orgGroup:personalGroup;$("#zcl_glist").empty();for(var i in gObj)if(groupList[gObj[i]]){var _obj=groupList[gObj[i]],_ul=$("<ul>"),_li1=$("<li><span><img src='"+_obj.photo+"'/></span><span>"+ZCL_getHTML(_obj.name)+"</span></li>");_li1.on("click",{group:_obj,encrytid:gObj[i]},function(ev){addGroupAsAttendee(ev.data.group,ev.data.encrytid)}),_ul.append(_li1);var _li2=$("<li><i class='msi-addgroup'></i></li>");_li2.on("click",{gid:gObj[i]},function(ev){checkAndFetchMembers(ev.data.gid)}),_ul.append(_li2),$("#zcl_glist").append(_ul)}},addGroupAsAttendee=function(_obj,encrytid){if(-1==selectedGroup.indexOf(encrytid)){var data={attr:{"data-ty":"group","data-gid":_obj.id},name:_obj.name,img:_obj.photo?!0:!1,ph:_obj.photo,iclass:"msi-close",cls:"SC_cs",eid:_obj.name,ret:"dom"},bubble=zmConUtil.bubbleUtil(data),rmvEle=bubble.querySelector(".msi-close");rmvEle.addEventListener("click",function(e){var idx=(rmvEle.parentNode.getAttribute("data-gid"),selectedGroup.indexOf(encrytid));rmvEle.parentNode.parentNode.removeChild(rmvEle.parentNode),-1!=idx&&selectedGroup.splice(idx,1),ZCL_stopEvents(e)}),grpEle.children()[2].appendChild(bubble),selectedGroup.push(encrytid)}},addGroupMemberAsAttendee=function(uobj){if(-1==selectedEmail.indexOf(uobj.eid)){var data={attr:{"data-eid":uobj.eid,"data-uid":uobj.zid},name:uobj.eid,img:uobj.photo?!0:!1,ph:uobj.photo,iclass:"msi-close",cls:"SC_cs",eid:uobj.eid,ret:"dom"},bubble=zmConUtil.bubbleUtil(data),rmvEle=bubble.querySelector(".msi-close");rmvEle.addEventListener("click",function(e){var eid=rmvEle.parentNode.getAttribute("data-eid"),idx=selectedEmail.indexOf(eid);rmvEle.parentNode.parentNode.removeChild(rmvEle.parentNode),-1!=idx&&selectedEmail.splice(idx,1),ZCL_stopEvents(e)}),grpEle.children()[2].appendChild(bubble),selectedEmail.push(uobj.eid)}},fetchMembers=function(groupId,callback){ZCL_uXHR("/cal/grpDtl.do?mode=grp-membs&comid="+groupId,function(res){var _memberObj=JSON.parse(res.responseText);_memberObj.GRP_ID&&groupList[_memberObj.GRP_ID]&&(groupList[_memberObj.GRP_ID].setMembers(_memberObj),"undefined"!=typeof callback&&callback.apply(arguments))})},checkAndFetchMembers=function(groupId){ZCL_isEmpty(groupList[groupId].getMembers())?fetchMembers(groupId,function(){listMembers(groupId)}):listMembers(groupId)},listMembers=function(groupId){var _inEle,_listEle=$("#zcl_gmemlist");_listEle.empty(),_inEle=$("<input type='text' class='zm_sgst' placeholder='Search individuals' id='zcl_gmemsrch'>"),_inEle.attr("gid",groupId),_inEle.off("keyup").keyup(function(e){fillGroupMembers(e,this)}),_listEle.append($("<div/>").append(_inEle)),_listEle.append($("<div/>")),displayMembers(groupId)},displayMembers=function(groupId){var _members=groupList[groupId].getMembers(),_listEle=$("#zcl_gmemlist"),_2ele=$(_listEle.children()[1]),_mlistEle=$("<div class='zcl_table'/>");_2ele.empty();for(var i in _members){var ph=_members[i].photo||zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"),_u=$("<ul><li><span><img src='"+ph+"'/></span><span>"+_members[i].eid+"</span></li></ul>");_u.on("click",{zid:i,eid:_members[i].eid,photo:ph},function(ev){addGroupMemberAsAttendee(ev.data)}),_mlistEle.append(_u)}_2ele.append(_mlistEle)},displayMatchedMembers=function(_members){var _listEle=$("#zcl_gmemlist"),_2ele=$(_listEle.children()[1]),_mlistEle=$("<div class='zcl_table'/>");_2ele.empty();for(var i in _members){var ph=_members[i].photo||zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"),_u=$("<ul><li><span><img src='"+ph+"'/></span><span>"+_members[i].eid+"</span></li></ul>");_u.on("click",{zid:_members[i].zid,eid:_members[i].eid,photo:ph},function(ev){addGroupMemberAsAttendee(ev.data)}),_mlistEle.append(_u)}_2ele.append(_mlistEle)},matchMembers=function(searchObj,str,limit){str=str.replace(/&#39;/gi,"'");var temp=[],subarr=[],ssub=str.substring(0,1).toLowerCase();'"'==ssub&&(ssub=str.charAt(1).toLowerCase());var regEx=/[^a-zA-Z]$/,ind_oth=ssub.match(regEx);for(ind_oth&&(ssub="others"),searchObj[ssub]&&(subarr=searchObj[ssub]),0!=str.indexOf("+")&&(str=str.replace(/\+/,"\\+")),str=str.replace(/\s/,"\\s"),str=str.replace(/\(/,"\\("),str=str.replace(/\)/,"\\)"),str=str.replace(/\*/,"\\*"),str=str.replace(/\&/,"\\&"),str=str.replace(/\$/,"\\$"),z=0;z<subarr.length&&(!limit||temp.length!=limit);z++){var otmp=subarr[z].dtxt;otmp=otmp.replace(/"/gi,""),otmp=otmp.replace(/</gi,""),otmp=otmp.replace(/>/gi,""),otmp=otmp.replace(/\(/gi," ");var tmp=otmp.split(" ");for(tmp[tmp.length]=subarr[z],i=0;i<tmp.length;i++){t=tmp[i];var re=new RegExp("^(\"|')?"+str+".*?","gi"),m=re.exec(t);if(m&&0==m.index){temp[temp.length]=subarr[z];break}}}return temp},fillGroupMembers=function(e,ele){var fval=ele.value,groupId=ele.getAttribute("gid"),searchObj=groupList[groupId].getMembersSearchRec(),lIndex=fval.lastIndexOf(",");return lIndex>-1&&(fval=fval.substring(lIndex+1,fldval.length)),fval=fval.trim(),"\n"==fval?0:(fillObj=matchMembers(searchObj,fval,10),void(fillObj&&fillObj.length>0?displayMatchedMembers(fillObj):displayMembers(groupId)))},getSelGroupAndMembers=function(){if(selectedEmail.length>0&&zmAutoFill.contactFill(selectedEmail.join(","),$("#zcl_ce_att .zm_sgst")),selectedGroup.length>0){for(var sGroup={},i=0;i<selectedGroup.length;i++){var gid=selectedGroup[i];sGroup[groupList[gid].id]={gid:groupList[gid].id,name:groupList[gid].name,photo:groupList[gid].photo,egid:gid}}try{var div=$("#attlist");for(var i in sGroup){var nDiv=document.createElement("ul");nDiv.setAttribute("id",sGroup[i].egid),nDiv.setAttribute("gid",sGroup[i].gid),nDiv.innerHTML="<li><img src="+sGroup[i].photo+"></li><li><b>"+sGroup[i].name+'</b></li><li class="zcl_txr"><i class="msi-close" title="Remove" ></i></li>';var rmvEle=nDiv.querySelector(".msi-close");rmvEle.addEventListener("click",function(){rmvEle.parentNode.parentNode.remove()}),$("#zcl_ce_attlst")[0]?$("#zcl_ce_attlst").append(div.append($(nDiv))):div.append($(nDiv))}}catch(e){}}close()},close=function(){if(zmsDialog.remove(!0),groupType="personal",selectedGroup=[],selectedEmail=[],ZCL_$("zcl_addgroup")){var _grpEle=ZCL_$("zcl_addgroup");_grpEle.parentNode.removeChild(_grpEle)}},listGroupForAttendeeSelection=function(){0==$("#zcl_addgroup").length&&document.body.appendChild($("<div class='zcl_adgrp' id='zcl_addgroup'/>")[0]),grpEle=$("#zcl_addgroup"),grpEle.empty(),grpEle.append(groupPPTop()),grpEle.append(groupListContainer()),grpEle.append($("<div class='zcl_grpatt'/>")),constGroupList();var options={title:zcal.i18n.add_group_attendees,style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright",closeaction:function(){zcalGroup.close()},buttons:[{txt:zcal.i18n.ok,callback:function(){zcalGroup.getSelectedGroup()}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){zcalGroup.close()}}]};zmsDialog.create("zcl_addgroup",options)},loadGroup=function(){if(zcal.cdata.grpLst){var _groups=zcal.cdata.grpLst;for(var i in _groups.pgrp)groupList[i]=new group({id:_groups.pgrp[i].GID,name:_groups.pgrp[i].GNAME,type:"personal",photo:_groups.pgrp[i].PHOTO,desc:_groups.pgrp[i].GDESC?_groups.pgrp[i].GDESC:zcal.i18n.nodescription}),personalGroup.push(i);for(var i in _groups.ogrp)groupList[i]=new group({id:_groups.ogrp[i].GID,name:_groups.ogrp[i].GNAME,type:"org",photo:_groups.ogrp[i].PHOTO,desc:_groups.ogrp[i].GDESC?_groups.ogrp[i].GDESC:zcal.i18n.nodescription}),orgGroup.push(i)}},getGroupList=function(type){return"personal"==type?personalGroup:"org"==type?orgGroup:void 0},getGroup=function(encrytid){return groupList[encrytid]?groupList[encrytid]:void 0},group=function(obj){this.id,this.name,this.photo,this.desc,this.members={},this.srchIndArr={},this.type,this.init(obj)};group.prototype={init:function(obj){this.id=obj&&obj.id,this.name=obj&&obj.name,this.photo=obj&&obj.photo,this.desc=obj&&obj.desc},setMembers:function(obj){this.members=obj&&obj.GRP_MEM_OBJ,this.srchIndArr=obj&&obj.GRP_MEM_ARR&&obj.GRP_MEM_ARR[0]},getMembers:function(){return this.members},getMembersSearchRec:function(){return this.srchIndArr}};var groupObj={loadGroup:loadGroup,listGroupForAttSel:listGroupForAttendeeSelection,getSelectedGroup:getSelGroupAndMembers,close:close,getGroupList:getGroupList,getGroup:getGroup,fetchMembers:fetchMembers};return groupObj}();ZCL_createCal=function(grpId){ZCL_openCalPopup({id:"",gId:grpId?grpId:"",name:"",desc:"",color:0,txtcolor:0,addmode:"cal"})},ZCL_openCalPopup=function(cObj){zmsuite.isWorkspaceAvailable("zcal_addcalContainer")&&zmsuite.closeWorkspace("zcal_addcalContainer");var quickCal=zcalTemplate.popupCreateCal(cObj);ZCL_setAddCalWorkSpace(quickCal,cObj)},ZCL_addCal=function(eve){if("enable"==eve.target.getAttribute("rel")){if(""==ZCL_$("zcl_calname").value.trim())return zmUtil.succErrMsg("e",zcal.i18n.entercalname),ZCL_$("zcl_calname").focus(),!1;eve.target.setAttribute("rel","disabled");var divArr=ZCL_$("zcl_calcol").getElementsByTagName("li"),_ccol=0;for(var i in divArr){var _tck=divArr[i].getElementsByTagName("i");if(_tck.length>0&&"msi-tick"==_tck[0].className){_ccol=divArr[i].getAttribute("rel");break}}var _cname=zcal.$("zcl_calname").value.trim(),_cdesc=zcal.$("zcl_caldesc").value.trim().replace(zcal.REG,"").zcalescape(),_cid=zcal.$("zcl_calid").value,_gid=zcal.$("zcl_calgid").value,col=ZCL_$("zcl_txtcol").getElementsByTagName("i"),txtcol=1;"msi-option"==col[0].className&&(txtcol=0);var fname="/cal/calAct.do?calname="+_cname;fname+=""!=_cid?"&mode=edit-info&calid="+_cid+"&caldesc="+_cdesc+"&calcol="+_ccol+"&txtcol="+txtcol:"&mode=add&caldesc="+_cdesc+"&calcol="+_ccol+"&txtcol="+txtcol+(_gid?"&gid="+_gid:""),ZCL_XHR(fname,"zcal.retCAL")}},ZCL_adcClose=function(){zmsuite.isWorkspaceAvailable("zcal_addcalContainer")&&zmsuite.closeWorkspace("zcal_addcalContainer")},ZCL_editCal=function(calId){var cobj=zcal.getCalObj(calId),calCol=cobj[1].split(":")[0],txtCol=cobj[1].split(":")[1];if("group"==cobj[14]){var grp_id;for(var i in zcal.cdata.calByGrp)for(var j in zcal.cdata.calByGrp[i])j==calId&&(grp_id=i);var owner_arr=[],mode_arr=[],mem_arr=[],owner=!1;ZCL_uXHR("/cal/groups/"+grp_id+"/getMembers",function(res){var res_obj=ZCL_Evl(1,res.responseText);if("success"==res_obj.status){var mem=res_obj.members;for(var i in mem)(mem[i].isOwner||mem[i].isModerator)&&zmail.zuid==mem[i].zid&&(owner=!0);for(var j in mem)mem[j].isOwner?owner_arr.push(mem[j]):mem[j].isModerator?mode_arr.push(mem[j]):mem_arr.push(mem[j]);ZCL_openGrpCalPopup({id:calId,gId:grp_id,name:cobj[0],desc:cobj[4],color:calCol,txtcolor:txtCol,addmode:"grp",title:"Edit Group Calendar",members:mem_arr,owner:owner_arr,moderator:mode_arr,is_owner:owner})}})}else ZCL_openCalPopup({id:calId,name:cobj[0],desc:cobj[4],color:calCol,txtcolor:txtCol,addmode:"cal",title:"Edit Calendar"})},zcal.calColorSel=function(sel,ty){sel=sel?sel:"0";for(var _ccol="<ul>",matched=!1,i=0;i<zcal.calcolor.length;i++)matched=sel==i||zcal.calcolor[i][1].toLowerCase()==sel.toLowerCase()?!0:matched,_ccol+="<li onclick=\"zcal.selColor(this,'"+ty+'\')" style="background-color:'+zcal.calcolor[i][1]+';" rel="'+i+'">',_ccol+=sel==i||zcal.calcolor[i][1].toLowerCase()==sel.toLowerCase()?'<i class="msi-tick"></i>':"",_ccol+=9==i?"</ul><ul>":"";return _ccol+="</ul>",matched||(_ccol+="<ul><li onclick=\"zcal.selColor(this,'"+ty+'\')" style="background-color:'+sel+'" rel="'+sel+'"><i class="msi-tick"></i></li>',_ccol+="<li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>"),_ccol},zcal.selColor=function(ele,ty){var divArr=zcal.$("zcl_calcol").getElementsByTagName("li");for(var i in divArr)divArr[i].innerHTML="";ele.innerHTML='<i class="msi-tick"></i>',"edit"==ty&&ZCL_addGrpCal(ele,ty)},zcal.openCalDesc=function(ele){zcal.$("zcl_caldesc").style.display="",ele.style.display="none"},ZCL_delCal=function(calId,unSub){ZCL_clrStck();var cObj,confirmMsg=unSub?zcal.i18n.areyousureunsub:zcal.i18n.deletecalendar;zmsDialog.confirm(confirmMsg,{onOk:function(){cObj=zcal.getCalObj(calId),ZCL_XHR("/cal/calAct.do?mode=del&calid="+calId+"&calencpt="+cObj[9],function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&$.publish("/calendar/deleted",{calid:calId,caluid:_robj.uid,mode:"delete"})})}})},ZCL_enableCal=function(calid){var cObj=zcal.getCalObj(calid);cObj&&0==cObj[2]&&ZCL_sendChgCalStsReq(calid,!0,cObj)},ZCL_ChgCalSts=function(calId){var cObj,isEnabled;-1!=calId.indexOf("zcrm_")?(calId=calId.replace("zcrm_",""),zcalCRM.chgUserSts(calId)):(cObj=zcal.getCalObj(calId),void 0!=cObj&&(isEnabled=1==cObj[2]?!1:!0,ZCL_sendChgCalStsReq(calId,isEnabled,cObj)))},ZCL_sendChgCalStsReq=function(calId,isEnabled,cObj){var fname="/cal/calAct.do?mode=en-dis&calid="+calId+"&isen="+isEnabled;ZCL_XHR(fname,function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[2]=isEnabled?"1":"0",$.publish("/calendar/statusChanged",{calid:calId,sts:cObj[2]}))})},ZCL_openEmbed=function(id){var calObj=zcal.getCalObj(id);calObj&&zcalEmbed.render(id,calObj)},ZCL_empCal=function(id){ZCL_clrStck(),zmsDialog.confirm(zcal.i18n.emptycal,{onOk:function(){cObj=zcal.getCalObj(id),ZCL_XHR("/cal/calAct.do?mode=empty&calid="+id,ZCL_retEmptyCal)}})},ZCL_retEmptyCal=function(res){var resObj=ZCL_Evl(1,res.responseText);"success"==resObj.status&&(zcalEvents.loadMonthData(),zmUtil.succErrMsg("s",ZCL_replaceString(zcal.i18n.emptingsucc,[zcal.cdata.calLst[resObj.id][0]])))},ZCL_grpClose=function(){zmsuite.isWorkspaceAvailable("zcal_addgrpContainer")&&zmsuite.closeWorkspace("zcal_addgrpContainer")},ZCL_memper=function(eve,zuid){var dropObj,cls,li_ele="I"==eve.target.tagName?eve.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode:eve.target.parentNode.parentNode.parentNode.parentNode.parentNode,role=li_ele.querySelector(".SC_Otxt").innerHTML,liArr=[],txt="Moderator"==role?"Make member":"Make moderator";dropObj=new zmDropDownMenu,liArr.push(_zm.getDOM(["LI",{attrs:{"data-item":"Moderator"==role?"member":"moderator","class":cls},child:[["text",txt]]}])),liArr.push(_zm.getDOM(["LI",{attrs:{"data-item":"remove","class":cls},child:[["text","Remove from Group"]]}]));var param={par:"I"==eve.target.tagName?eve.target.parentNode:eve.target,showArrow:!1,liDom:liArr,spanClass:"SC_Sopt",align:"pright",clk:role_remAction=function(data){var grp_id=$("#zcl_calgid")[0].value;"remove"==data.item?ZCL_XHR("/cal/groups/"+grp_id+"/removeMember/"+zuid,function(res){var res_obj=ZCL_Evl(1,res.responseText);if("success"==res_obj.status){var li_ele="I"==eve.target.tagName?eve.target.parentNode.parentNode.parentNode.parentNode.parentNode:eve.target.parentNode.parentNode.parentNode.parentNode,name=li_ele.parentNode.querySelector("strong").innerHTML,memC=li_ele.parentNode.parentNode.parentNode.parentNode.querySelector("#isMem"),memV=li_ele.parentNode.parentNode.parentNode.parentNode.querySelector("#zcl_memView");memC.innerHTML=2==memV.childNodes.length?memV.childNodes.length-1+" Person":memV.childNodes.length-1+" Members",li_ele.parentNode.remove(),zmUtil.succErrMsg("s",name+" "+zcal.i18n.removemem_msg),zmUtil.hideMenu()}}):"member"==data.item?ZCL_XHR("/cal/groups/"+grp_id+"/makeMember/"+zuid,function(res){var res_obj=ZCL_Evl(1,res.responseText);if("success"==res_obj.status){var li_ele="I"==eve.target.tagName?eve.target.parentNode.parentNode.parentNode.parentNode.parentNode:eve.target.parentNode.parentNode.parentNode.parentNode,name=li_ele.parentNode.querySelector("strong").innerHTML;"Moderator"==li_ele.parentNode.querySelector(".SC_Otxt").innerHTML&&(li_ele.parentNode.querySelector(".SC_Otxt").innerHTML=""),zmUtil.hideMenu(),zmUtil.succErrMsg("s",name+" "+zcal.i18n.makemem_msg)}}):"moderator"==data.item&&ZCL_XHR("/cal/groups/"+grp_id+"/makeModerator/"+zuid,function(res){var res_obj=ZCL_Evl(1,res.responseText);if("success"==res_obj.status){var li_ele="I"==eve.target.tagName?eve.target.parentNode.parentNode.parentNode.parentNode.parentNode:eve.target.parentNode.parentNode.parentNode.parentNode,name=li_ele.parentNode.querySelector("strong").innerHTML;""==li_ele.parentNode.querySelector(".SC_Otxt").innerHTML&&(li_ele.parentNode.querySelector(".SC_Otxt").innerHTML="Moderator"),zmUtil.hideMenu(),zmUtil.succErrMsg("s",name+" "+zcal.i18n.makemode_msg)}})}};"I"==eve.target.tagName?eve.target.parentNode.className="zmcDrpDwnOpn SC_ddn":eve.target.className="zmcDrpDwnOpn SC_ddn",dropObj.setDropObj(param),dropObj.paint(),"bottom"===dropObj.dropObj.mountPosition?"I"==eve.target.tagName?eve.target.parentNode.className="zmcDrpDwnOpn SC_ddnB":eve.target.className="zmcDrpDwnOpn SC_ddnB":"top"===dropObj.dropObj.mountPosition&&("I"==eve.target.tagName?eve.target.parentNode.className="zmcDrpDwnOpn SC_ddn":eve.target.className="zmcDrpDwnOpn SC_ddn")},addGroup=function(xml){if(200==xml.status){var resObj=ZCL_Evl(1,xml.responseText),mode=resObj.mode,id=resObj.calid?resObj.calid:null;if("add"==mode)"success"==resObj.status?(ZCL_grpClose(),zmUtil.succErrMsg("s","Group Calendar added successfully"),resObj.gid?(zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,0==zcal.CALMODE&&(zcal.cdata.calGLst=obj.gclst,zcal.cdata.calALst=obj.aclst,zcal.cdata.calByGrp=obj.gclstbygrp)):(zcal.cdata.calGLst[id]=resObj.obj,zcal.cdata.gcalOdrArr[zcal.cdata.gcalOdrArr.length]=id,resObj.groupId&&(zcal.cdata.calByGrp[resObj.groupId]={},zcal.cdata.calByGrp[resObj.groupId][id]=resObj.obj)),$.publish("/calendar/added",{calid:id,mode:"add"})):(zmUtil.succErrMsg("e",resObj.error),zmUtil.hideMenu());else if(mode="edit")if("success"==resObj.status){zmUtil.succErrMsg("s",zcal.i18n.caledited);var obj=resObj.obj,cobj=zcal.getCalObj(id);cobj[0]=obj[0],cobj[1]=obj[1],cobj[4]=obj[4],$.publish("/calendar/updated")}else zmUtil.succErrMsg("e",resObj.error)}else{var resObj=ZCL_Evl(1,xml.responseText),mode=resObj.mode;"add"==mode&&"failure"==resObj.status&&("Group Name already exists"==resObj.error?zmUtil.succErrMsg("e",resObj.error):(zmUtil.succErrMsg("e",resObj.error),zmUtil.hideMenu()))}},zcal.retCAL=function(xml){if(ZCL_adcClose(),200==xml.status){var resObj=ZCL_Evl(1,xml.responseText),mode=resObj.mode,id=resObj.id?resObj.id:null;if("add"==mode)if("success"==resObj.status){zmUtil.succErrMsg("s",zcal.i18n.caladd);var obj=resObj.obj;resObj.gid?(zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,0==zcal.CALMODE&&(zcal.cdata.calGLst=obj.gclst,zcal.cdata.calALst=obj.aclst,zcal.cdata.calByGrp=obj.gclstbygrp)):(zcal.cdata.calLst[id]=resObj.obj,zcal.cdata.calOrdArr[zcal.cdata.calOrdArr.length]=id),$.publish("/calendar/added",{calid:id,mode:"add"})}else zmUtil.succErrMsg("e",resObj.error);else if("edit-info"==mode)if("success"==resObj.status){zmUtil.succErrMsg("s",zcal.i18n.caledited);var obj=resObj.obj,cobj=zcal.getCalObj(id);cobj[0]=obj[0],cobj[1]=obj[1],cobj[4]=obj[4],$.publish("/calendar/updated")}else zmUtil.succErrMsg("e",resObj.error);else if("del"==mode||"delByUid"==mode)ZCL_cleanDeletedCal(id);else if("gcal_del"==mode)resObj.service&&"gcal"==resObj.service&&(ZCL_removeGCal(resObj),"success"==resObj.status&&zmUtil.succErrMsg("s",zcal.i18n.unsubscribesuc));else if("en-dis"==mode&&"success"==resObj.status){var isen=resObj.isenable,_cO=zcal.getCalObj(resObj.id);_cO[2]=isen?"1":"0",zmUtil.succErrMsg("s",zcal.i18n.statuschange)}}else zmUtil.succErrMsg("e",zcal.i18n.errmsg)},ZCL_cleanDeletedCal=function(obj){var id=obj.calid,uid=obj.caluid,grpid=obj.grpid?obj.grpid:"";zcal.cdata.calLst[id]?(delete zcal.cdata.calLst[id],ZCL_remCalid(id),zmUtil.succErrMsg("s",zcal.i18n.caldeleted)):(zcal.cdata.calOLst[id]||zcal.cdata.calGLst[id]||zcal.cdata.calALst[id]||zcal.cdata.calByGrp[grpid])&&(zcal.cdata.calGLst[id]||zcal.cdata.calByGrp[grpid]?(delete zcal.cdata.calGLst[id],delete zcal.cdata.calByGrp[grpid]):zcal.cdata.calALst[id]?delete zcal.cdata.calALst[id]:delete zcal.cdata.calOLst[id]&&delete zcal.cdata.calOLst[id],ZCL_remOCalid(uid),"grpdelete"==obj.mode?zmUtil.succErrMsg("s","Group deleted successfully"):zmUtil.succErrMsg("s",zcal.i18n.unsubscribesuc)),ZCL_setCalendars(),zcalEvents.loadMonthData()},ZCL_remCalid=function(id){for(var i in zcal.cdata.calOrdArr)if(zcal.cdata.calOrdArr[i]==id){zcal.cdata.calOrdArr.splice(i,1);break}},ZCL_remOCalid=function(id){var obj=zcal.cdata.calOUids;zcal.cdata.calOUids=obj.substring(0,obj.indexOf(id))+obj.substring(obj.indexOf(id)+id.length+1,obj.length)},ZCL_gothro=function(id){for(var i in zcal.cdata.evelst){var temp=zcal.cdata.evelst[i];for(var j in temp)for(var k in temp[j])id==temp[j][k].CNAME&&(1==temp.length?delete zcal.cdata.evelst[i]:zcal.cdata.evelst[i].splice(j,1))}for(var i in zcal.cdata.eveAll){var temp=zcal.cdata.eveAll[i];for(var j in temp)for(var k in temp[j])id==temp[j][k].CNAME&&(1==temp.length?delete zcal.cdata.eveAll[i]:zcal.cdata.eveAll[i].splice(j,1))}},ZCL_subscribeToCalUpdate=function(){zcal.isSubToCalUpd=!0,$.subscribe("/calendar/added",ZCL_updateCalAndEvents),$.subscribe("/calendar/subscribed",function(){ZCL_setCalendars(),zcal.settingsUpdated=!0,zcalEvents.loadMonthData()}),$.subscribe("/calendar/updated",ZCL_updateCalAndEvents),$.subscribe("/calendar/deleted",function(ev,obj){zcal.settingsUpdated=!0,ZCL_cleanDeletedCal(obj)}),$.subscribe("/calendar/statusChanged",function(ev,obj){ZCL_setCalendars(),zcal.settingsUpdated=!0,ZCL_updateEvents(),"1"==obj.sts&&zcalEvents.loadMonthData()}),$.subscribe("/calendar/visibilityChanged",function(ev,obj){ZCL_setCalendars(),obj.visibility?zcalEvents.loadMonthData():(zcal.settingsUpdated=!0,ZCL_gothro(obj.calid),ZCL_updateEvents())})},ZCL_updateCalAndEvents=function(){ZCL_setCalendars(),ZCL_updateEvents()},ZCL_updateEvents=function(){4==zcal.view?zcalAgenda.dispEvents():zcalView.plotEvents()},ZCL_setCalendars=function(){zcal.disabledcal="",ZCL_CALNAME="",zcal.mcal=zcalInit.formatCalData(zcal.cdata.calLst,zcal.cdata.calOrdArr),ZCL_setGrpOdr(),ZCL_updateGroupCalList(),ZCL_updateAppCalList(),zcal.acal=zcalInit.formatCalData(zcal.cdata.calALst),zcal.ocal=zcalInit.formatCalData(zcal.cdata.calOLst),"c"==zmApp.currentApp&&zcalInit.constructLeft()},ZCL_setGrpOdr=function(){if(zcal.cdata.calGLst){var data=zcal.cdata.calGLst,temp=[],obj={};for(var i in data)obj={id:i,value:data[i][0]},temp.push(obj);temp.sort(function(a,b){var nameA=a.value.toUpperCase(),nameB=b.value.toUpperCase();return nameB>nameA?-1:nameA>nameB?1:0}),zcal.cdata.gcalOdrArr=[];for(var j in temp)zcal.cdata.gcalOdrArr.push(temp[j].id)}},ZCL_getCalColor=function(calColor){return calColor+="",calColor=-1!=calColor.indexOf(":")?calColor.substring(0,calColor.indexOf(":")):calColor,/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/.test(calColor)?[calColor,calColor]:/0?[0-9]|1[0-9]/.test(calColor)?zcal.calcolor[parseInt(calColor,10)]:zcal.calcolor[0]},ZCL_getColorNo=function(color){for(var i=0;i<zcal.calcolor.length;i++){var colarr=zcal.calcolor[i];if(colarr[0].toLowerCase()==color.toLowerCase()||colarr[1].toLowerCase()==color.toLowerCase())return i}return-1},ZCL_createGrpCal=function(grpId){ZCL_openGrpCalPopup({id:"",gId:grpId?grpId:"",name:"",grpMem:"",desc:"",color:0,txtcolor:0,addmode:"grp"})},ZCL_openGrpCalPopup=function(cObj){zmsuite.isWorkspaceAvailable("zcal_addgrpContainer")&&zmsuite.closeWorkspace("zcal_addgrpContainer"),quickCal=zcalTemplate.popupCreateGrpCal(cObj),ZCL_setAddCalWorkSpace(quickCal,cObj)},ZCL_addGrpCal=function(e,type){"disabled"!=e.target.getAttribute("rel")&&e.target.setAttribute("rel","enabled");var title=ZCL_$("zcl_grpcalname").value,attList=$("#zcl_grpMemlist");if(""==title.trim())attList[0].childNodes.length<=0&&(ZCL_$("zcl_ad_att_er").style.display="",ZCL_$("zcl_addGrpMem").parentNode.className="zcl_ad_gr_m zcl_cl_ad_er"),ZCL_$("zcl_ad_ti_er").style.display="",ZCL_$("zcl_grpcalname").className="SC_tiput zcl_cl_ad_er";else{if(""!=zcal.$("zcl_calgrpdesc").value&&zcal.$("zcl_calgrpdesc").value.length>200)return ZCL_$("zcl_ad_desc_er").style.display="",ZCL_$("zcl_calgrpdesc").className="SC_tiput zcl_cl_ad_er",!1;if(ZCL_$("zcl_addGrpMem")&&attList[0].childNodes.length<=0)ZCL_$("zcl_ad_att_er").style.display="",ZCL_$("zcl_addGrpMem").parentNode.className="zcl_ad_gr_m zcl_cl_ad_er";else{var divArr=ZCL_$("zcl_calcol").getElementsByTagName("li"),_ccol=0;for(var i in divArr){var _tck=divArr[i].getElementsByTagName("i");if(_tck.length>0&&"msi-tick"==_tck[0].className){_ccol=divArr[i].getAttribute("rel");break}}var _cname=zcal.$("zcl_grpcalname").value.trim(),_cdesc=zcal.$("zcl_calgrpdesc").value.trim().replace(zcal.REG,"").zcalescape(),col=ZCL_$("zcl_txtcol").getElementsByTagName("i"),txtcol=1;if("msi-option"==col[0].className&&(txtcol=0),"edit"==type){var grp_id=$("#zcl_calgid")[0].value,cal_id=$("#zcl_calid")[0].value,calO=zcal.cdata.calGLst[cal_id];if(_cname!=calO[0]||_cdesc!=calO[4]||calO[1].split(":")[0]!=zcal.calcolor[_ccol][1].toLowerCase()||calO[1].split(":")[1]!=txtcol){var grpObj={calname:_cname,caldesc:_cdesc,calcol:_ccol,txtcol:txtcol};ZCL_XHR("/cal/groups/"+grp_id+"?groupData="+JSON.stringify(grpObj),"addGroup")}}else{var att=attList[0].childNodes,memArr=[];for(var i in att)if("object"==typeof att[i]){var attzuid=att[i].getAttribute("data-zid");memArr.push(parseInt(attzuid))}var grpObj={calname:_cname,caldesc:_cdesc,calcol:_ccol,txtcol:txtcol,members:memArr};"enabled"==e.target.getAttribute("rel")&&(e.target.setAttribute("rel","disabled"),ZCL_XHR("/cal/groups?groupData="+JSON.stringify(grpObj),"addGroup"))}}}},ZCL_setAddCalWorkSpace=function(txt,cobj){var prevHeader,tabId="cal"==cobj.addmode?"zcal_addcalContainer":"zcal_addgrpContainer",appName="cal"==cobj.addmode?cobj.title?cobj.title:zcal.i18n.addcalendar:cobj.title?cobj.title:zcal.i18n.addgrpcalendar,tabObj={appname:appName,appId:tabId,data:{CNodes:"2"},appIcon:0==zcal.EMODE?"msi-Vevnt":"msi-caledit"};zmsuite.setWorkSpace(tabObj);var headerDOM=["DIV",{attrs:{"class":"SC_phd"},child:[["text",appName]]}];prevHeader={id:"zcalPrevHeader"},prevHeader.text=headerDOM;var centerWrapper=zmsuite.getCenter(),tabNodes=centerWrapper[1].getNodes();zmsuite.renderCenter(),tabNodes[0].push(prevHeader),tabNodes[0].setListener("click",function(a,b){zcalList.bindAction(a,b)}),tabNodes[1].push($(txt)),centerWrapper[1].show();var textColorDOM=tabNodes[1].$el.find("[data-marker=textColor]").removeAttr("data-marker");textColorDOM.on("click",function(ev){var $ele=$(this);$ele.parent().find("i").removeClass("msi-option").addClass("msi-unoption"),$ele.find("i").removeClass("msi-unoption").addClass("msi-option"),"Edit Group Calendar"==cobj.title&&ZCL_addGrpCal(ev,"edit")}),ZCL_$("zcl_grpcalname")&&$("#zcl_grpcalname").on("keydown",function(event){13==event.keyCode&&"Edit Group Calendar"==cobj.title&&ZCL_addGrpCal(event,"edit")}),ZCL_$("zcl_addGrpMem")&&($("#zcl_addGrpMem").on("keydown",function(event){if(13==event.keyCode&&"zcl_addGrpMem"==this.id){for(var attArr=this.value.split(","),z=0;z<attArr.length;z++){var _emlid=attArr[z].trim(),idx1=_emlid.indexOf("<"),idx2=_emlid.indexOf(">");idx1>-1&&idx2>-1&&(_emlid=_emlid.substring(idx1+1,idx2)),_emlid=_emlid.replace(/,/g,"")}if(ZCL_isEmail(_emlid)){var data={};data.id=_emlid,ZCL_$("zcl_addGrpMem").parentNode.className="zcl_ad_gr_m",ZCL_$("zcl_ad_att_er").style.display="",ZCL_$("zcl_ad_att_er").innerHTML="Add only org members"}$("#zcl_addGrpMem").val("")}}),zmAppLoader.load("zmContactsAutoComplete").then(function(){zmContactsAutoComplete.autoComplete({input:$("#zcl_addGrpMem")[0],excludeMe:!0,contactType:["org"],exclude:function(){var email=[];if($("#zcl_grpMemlist")[0].childNodes.length>0){var chi=$("#zcl_grpMemlist")[0].childNodes;for(var i in chi)email.push(chi[i].id)}return email},onSelect:function(event,data){var data=data.item.attributes,grpDiv=$("#zcl_grpMemlist"),li=document.createElement("li");data.zid&&li.setAttribute("data-zid",data.zid),li.setAttribute("id",data.id),li.innerHTML="<img src="+data.profileImage+"><span>"+data.firstName+'</span><i class="msi-close"></i></li>',grpDiv.append($(li)),grpDiv.find(".msi-close").on("click",function(ev){ev.target.parentNode.remove(),$("#zcl_addGrpMem").focus()}),$("#zcl_addGrpMem").val("")}})})),ZCL_$("zcl_addsrhdiv")&&($("#zcl_addsrhmem").on("keydown",function(event){if(ZCL_$("zcl_ad_att_er").style.display="none",13==event.keyCode&&"zcl_addsrhmem"==this.id){for(var attArr=this.value.split(","),z=0;z<attArr.length;z++){var _emlid=attArr[z].trim(),idx1=_emlid.indexOf("<"),idx2=_emlid.indexOf(">");idx1>-1&&idx2>-1&&(_emlid=_emlid.substring(idx1+1,idx2)),_emlid=_emlid.replace(/,/g,"")}if(ZCL_isEmail(_emlid)){var data={};data.id=_emlid,ZCL_$("zcl_ad_att_er").style.display=""}$("#zcl_addsrhmem").val("")}}),zmAppLoader.load("zmContactsAutoComplete").done(function(){zmContactsAutoComplete.autoComplete({input:$("#zcl_addsrhmem")[0],excludeMe:!0,contactType:["org"],exclude:function(){var email=[];if($("#zcl_memView")[0].childNodes)for(var i in $("#zcl_memView")[0].childNodes){var attl=$("#zcl_memView")[0].childNodes[i].id;attl&&email.push(attl)}return email},onSelect:function(event,data){var data=data.item.attributes;zcl_addmem(data),$("#zcl_addsrhmem").val("")}})})),"Edit Group Calendar"!=cobj.title&&$("#zcl_grpcalname").on("focusout",function(){var ti=ZCL_$("zcl_grpcalname").value;if(""==ti)ZCL_$("zcl_ad_ti_er").style.display="",ZCL_$("zcl_grpcalname").className="SC_tiput zcl_cl_ad_er";else if(zcal.$("zcl_grpcalname").value){var is_equal=!1;for(var i in zcal.cdata.calGLst){var grp_name=zcal.cdata.calGLst[i][0];zcal.$("zcl_grpcalname").value==grp_name&&cobj.id!=i&&(is_equal=!0)}is_equal?(ZCL_$("zcl_ad_ti_er").style.display="",ZCL_$("zcl_grpcalname").className="SC_tiput zcl_cl_ad_er",ZCL_$("zcl_ad_ti_er").innerHTML="The group name you've entered is already in use"):(ZCL_$("zcl_ad_ti_er").style.display="none",ZCL_$("zcl_grpcalname").className="SC_tiput")}});var attList=$("#zcl_grpMemlist");$("#zcl_addGrpdiv").on("focusout",function(){attList[0].childNodes.length<=0?(ZCL_$("zcl_ad_att_er").style.display="",ZCL_$("zcl_addGrpMem").parentNode.className="zcl_ad_gr_m zcl_cl_ad_er"):(ZCL_$("zcl_ad_att_er").style.display="none",ZCL_$("zcl_addGrpMem").parentNode.className="zcl_ad_gr_m")}),$("#zcl_addGrpdiv").on("focusin",function(){attList[0].childNodes.length>0&&(ZCL_$("zcl_ad_att_er").style.display="none",ZCL_$("zcl_addGrpMem").parentNode.className="zcl_ad_gr_m")}),zmsuite.showWorkSpace(tabId),centerWrapper[0].$el.addClass("SC_sw"),centerWrapper[1].$el.addClass("SC_w100")},zcal.getCalLst=function(){for(var calObj={},x=0;x<zcal.cdata.calOrdArr.length;x++){var calId=zcal.cdata.calOrdArr[x],calProp=zcal.cdata.calLst[calId];calObj[calId]=calProp[0]}for(var y in zcal.cdata.calGLst){var ci=zcal.cdata.calGLst[y];"1"!=ci[8]||2!=ci[12]&&3!=ci[12]||(calObj[y]=ci[0]+"("+ci[14]+")")}for(var y in zcal.cdata.calALst){var ci=zcal.cdata.calALst[y];"1"!=ci[8]||2!=ci[12]&&3!=ci[12]||(calObj[y]=ci[0]+"("+ci[14]+")")}for(var y in zcal.cdata.calOLst){var ci=zcal.cdata.calOLst[y];"1"!=ci[8]||2!=ci[12]&&3!=ci[12]||(calObj[y]=ci[0]+"(others)")}return calObj},zcal.showDD=function(cur,dd_ty){if("remlst"==dd_ty)zcalDD.ddList(cur,zcal.REMSTR);else if("rem_rtype"==dd_ty)zcalDD.ddList(cur,zcal.ALARM_REMTYPE);else if("rem_atype"==dd_ty)zcalDD.ddList(cur,zcal.ALARM_ACTTYPE);else if("repfreq"==dd_ty)zcalDD.ddList(cur,zcal.REPEAT_FREQ);else if("callst"==dd_ty){var calObj=zcal.getCalLst();zcalDD.ddList(cur,calObj)}else"weekdays"==dd_ty?zcalDD.ddList(cur,Date.WEEK_DAYS[0]):"wktype"==dd_ty?zcalDD.ddList(cur,zcal.WEEK_TYPE):"months"==dd_ty?zcalDD.ddList(cur,Date.MONTH_NAMES[0]):"freebusy_db"==dd_ty&&zcalDD.ddList(cur,zcal.FREEBUSY_DD)};var zcalDD={};zcalDD.CUR_ELEMENT=null,zcalDD.valObj=null,zcalDD.isTZ=!1,zcalDD.ddList=function(cur,obj,isTZ){this.CUR_ELEMENT=cur,this.valObj=obj,this.isTZ=isTZ,this.constDD()},zcalDD.close=function(e){var curEle=document.getElementById&&!document.all?e.target:event.srcElement;curEle.id&&"zcl_ddlst"==curEle.id||(document.attachEvent?document.detachEvent("onmousedown",zcalDD.close):document.removeEventListener("mousedown",zcalDD.close,!1),zcalDD.delDD())},zcalDD.delDD=function(){var elObj=document.getElementById("zcl_ddlst");return elObj?(elObj.parentNode.removeChild(elObj),!0):!1},zcalDD.constDD=function(){document.attachEvent?document.attachEvent("onmousedown",zcalDD.close):document.addEventListener("mousedown",zcalDD.close,!1);var _ul=document.createElement("ul");_ul.className="zcl_optiondrpbx",_ul.setAttribute("id","zcl_ddlst"),_ul.onmousedown=function(event){zcalDD.returnVal(this,event)};var txt="";txt+=this.constLst(),_ul.innerHTML=txt,this.CUR_ELEMENT.appendChild(_ul),_ul.style.display="block"},zcalDD.constLst=function(){var txt="";if(this.isTZ)for(var i in this.valObj)for(var j in this.valObj[i])txt+="<li rel="+j+">"+unescape(this.valObj[i][j])+" ("+j+")</li>";else for(var i in this.valObj)txt+='<li rel="'+i+'">'+ZCL_getHTML(this.valObj[i])+"</li>";return txt},zcalDD.returnVal=function(cur,e){var curEle=document.getElementById&&!document.all?e.target:event.srcElement;if("LI"==curEle.tagName){if(this.CUR_ELEMENT){this.CUR_ELEMENT.childNodes[0].value=curEle.innerHTML;var selValue=curEle.getAttribute("rel");this.CUR_ELEMENT.childNodes[1].value=selValue,this.CUR_ELEMENT.getAttribute("callback")&&ZCL_Evl(0,this.CUR_ELEMENT.getAttribute("callback"),selValue)}this.CUR_ELEMENT=null,this.valObj=null,this.isTZ=!1,this.delDD(),this.stopEvent(e)}},zcalDD.stopEvent=function(ev){ev=ev||event,ev.stopPropagation?(ev.preventDefault(),ev.stopPropagation()):(ev.cancelBubble=!0,ev.returnValue=!1)},ZCL_openSAdd=function(cur){zcal.CAStck(new Array("zcl_smAdd")),document.addEventListener("mousedown",ZCL_mdownClr,!1),document.addEventListener("keydown",zcal.keyCtrl,!1);var smAdd=$(zcalTemplate.popupSmartAdd());ZCL_$("zcl_smAdd")||$("body").append('<ul id="zcl_smAdd" class="zcl_smtadd"></ul>');var smAddEle=$("#zcl_smAdd");smAddEle.html(smAdd);var pos=$(zcal.calCenter.listElem).offset();smAddEle.css({left:pos.left+"px",top:$(cur).offset().top+$(cur).height()+8+"px",display:""}),$("#zcl_smaddtxt").focus(),$("#zcl_smaddtxt").off("keydown").on("keydown",function(event){var x=event.which||event.keyCode;13==x&&(ZCL_clrStck(),ZCL_smartAdd(this))})},ZCL_openSAddHelp=function(){zcal.$("zcl_saddhelp").style.display="none"==zcal.$("zcl_saddhelp").style.display?"":"none"},ZCL_smartAdd=function(cur){var str=cur.value.trim();if(""==str)return!1;if(!zcal.validate(str))return alert(zcal.i18n.spchsmad),!1;str=str.replace(zcal.REG,"").replace(/ /g," "),""==str&&(str="NO SUBJECT");var timeextract=ZCL_nlp(str,1),SUM=timeextract.SUM.trim();""==SUM&&(SUM="NO SUBJECT");var SD=timeextract.SD&&""!=timeextract.SD?timeextract.SD:"",temdate=ZCL_parseDateStr(SD);SD=temdate.dateBy(zcal.DFORMAT[zcal.cdata.opt.DF]);var ED=timeextract.ED&&""!=timeextract.ED?timeextract.ED:"",temdate=ZCL_parseDateStr(ED);ED=temdate.dateBy(zcal.DFORMAT[zcal.cdata.opt.DF]);var ST=timeextract.ST?timeextract.ST:"0000",ET=timeextract.ET?timeextract.ET:"0000",ALLDAY=timeextract.ST||timeextract.ET?0:1,Eveobj={EID:"",EUID:"",RIDX:"",EPERM:2,DPERM:2,SD:SD,ST:ST,ED:ED,ET:ET,ATT:"",RMVATT:"",GATT:"",RMVGATT:"",CLASS:0,ADAY:ALLDAY,IMP:0,USTAT:0,UCMNT:"",SKEY:"",CNAME:zcal.cdata.defcal,LOC:"",TRANS:1,DESC:"",LINK:"",ETSK:0,ECRM:0,ENTS:0,EMET:0,SUM:SUM,ALARM:"",REP:"",TYPE:1,ISDMY:!1,ETZ:"",IN_ETZ:!1,DELRTO:!1,EC:-1,ADD_MODE:"DET"};return ZCL_detailObj(Eveobj),cur.blur(),!1},ZCL_retsAdd=function(xml){var res=ZCL_Evl(1,xml.responseText);if("success"==res.status){var eO=res.obj,rdats=res.rdats?res.rdats:"",loc=eO.LOC,tObj={CNAME:eO.CNAME,ORG:eO.ORG,SD:eO.SD,ST:eO.ST,ED:eO.ED,ET:eO.ET,SUM:eO.SUM,LOC:loc,REF:eO.REF,RTO:eO.RTO,ADAY:eO.ADAY,EPERM:"2",DPERM:"2",EUID:eO.EUID,EC:"-1"},t=ZCL_Evl(1,'{"'+eO.EID+'":'+JSON.stringify(tObj)+"}");if(""!=rdats)ZCL_insertRepEvents(t,rdats,eO.EID);else if(ZCL_insertEvent(t,eO.EID),4==zcal.view){tObj.EID=eO.EID;var agtxt=JSON.stringify(tObj);zcalAgenda.add(agtxt)}ZCL_enableCal(eO.CNAME),zcalView.plotEvents(),zmUtil.succErrMsg("s",zcal.i18n.evtadded)}else"Parser Error"==res.error?ZCL_callAdd(res.sub):zmUtil.succErrMsg("s",res.error)};var ZCL_RQ=[],ZCL_URL=[],ZCL_LOGIN_STATE=!0;ZCL_uXHR=function(u,f){return u="/mail"+u,rt=ZCL_RQ.length,ZCL_RQ[rt]=ZCL_GetHTTPTransport(),ZCL_URL[rt]=u,"function"==typeof f?(ZCL_RQ[rt].zcal_callback=f,ZCL_RQ[rt].zcal_reqindex=rt,ZCL_RQ[rt].onreadystatechange=function(){var callback=this.zcal_callback,rt=this.zcal_reqindex;if(4==this.readyState){var ret=this.getResponseHeader("Content-Type").toLowerCase().indexOf("text/xml");-1!=ret?callback(this.responseXML,ZCL_URL[rt]):callback(this,ZCL_URL[rt]),ZCL_RQ[rt]=null}}):ZCL_RQ[rt].onreadystatechange=new Function("{			if( ZCL_RQ["+rt+"].readyState == 4 ) { 				ZCL_XHRInclude(ZCL_RQ["+rt+"],ZCL_URL["+rt+"]);				var ret = ZCL_RQ["+rt+'].getResponseHeader("Content-Type").toLowerCase().indexOf("text/xml");				'+f+"((ret !=-1 ? ZCL_RQ["+rt+"].responseXML:ZCL_RQ["+rt+"]) ,ZCL_URL["+rt+"]);ZCL_RQ["+rt+"]=null;}}"),ZCL_RQ[rt].open("GET",u,!0),ZCL_RQ[rt].setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),ZCL_RQ[rt].send(null),!0},ZCL_GetHTTPTransport=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){throw new Exception("Browser not supported")}}},ZCL_formSubmit=function(obj,action,method){if(!ZCL_$("zcl_tarFrame")){var tarFrame=_zm.getDOM(["IFRAME",{attrs:{id:"zcl_tarFrame",name:"zcl_tarFrame",style:"display:none",width:"0",height:"0",frameborder:"0"}}]);document.body.appendChild(tarFrame)}var formObj=_zm.getDOM(["FORM",{attrs:{id:"dwnldForm",name:"dwnldForm",style:"display:none",target:"zcl_tarFrame",method:method||"post",action:"/mail"+action+"?frameorigin="+window.location.protocol+"//"+window.location.hostname}}]);for(var i in obj)formObj.appendChild(_zm.getDOM(["INPUT",{attrs:{type:"hidden",name:i,value:obj[i]}}]));var csr=ZCL_getCookie("aprmjrnpkcrkks");formObj.appendChild(_zm.getDOM(["INPUT",{attrs:{type:"hidden",name:"mstpcrdhkur",value:csr}}])),document.body.appendChild(formObj),formObj.submit(),formObj.parentNode.removeChild(formObj)},ZCL_getCookie=function(name){name=new RegExp("^"+name+"=");for(var ckarr=document.cookie.split(";"),i=0;i<ckarr.length;i++){var ck=ckarr[i].trim();if(name.test(ck))return ck.replace(name,"")}return null};var zcalSettings=function(settings){return settings.getCalConfig=function(){var config={orders:[["Preferences","Import","Subscribe","Sync","Groups","ZohoApps","OwnCalendars","GroupCalendars","AppCalendars","OtherCalendars"]],rows:{Preferences:{title:zcal.i18n.mypreference,html:function(){return zcalSettings.zcalMyPreferences.myprefRowHTML()},invokable:!0,uId:"zcalSettings.zcalMyPreferences"},Import:{title:zcal.i18n.import,html:zcal.i18n.mailimport,invokable:!0,uId:"zcalSettings.Import"},Subscribe:{title:zcal.i18n.subscribe,html:zcal.i18n.mailsubscibe,invokable:!0,uId:"zcalSettings.Subscribe"},Sync:{title:zcal.i18n.sync,html:zcal.i18n.mailsync,invokable:!0,uId:"zcalSettings.Sync"},Groups:{title:zcal.i18n.groups,html:zcal.i18n.mailgroupcalendars,invokable:!0,uId:"zcalSettings.zcalGroupList"},ZohoApps:{title:ZCL_replaceComName(zcal.i18n.zohoapps),html:ZCL_replaceComName(zcal.i18n.appsubscribe),invokable:!0,uId:"zcalSettings.appList"},OwnCalendars:{title:zcal.i18n.mycalendars,html:zcal.i18n.mailowncalendar,invokable:!0,uId:"zcalSettings.ownCalList"},GroupCalendars:{title:zcal.i18n.groupcalendars,html:zcal.i18n.mailgroupcalendar,invokable:!0,uId:"zcalSettings.grpCalList"},AppCalendars:{title:zcal.i18n.appcalendars,html:zcal.i18n.mailappcalendar,invokable:!0,uId:"zcalSettings.appCalList"},OtherCalendars:{title:zcal.i18n.othercalendars,html:zcal.i18n.mailotherscalendar,invokable:!0,uId:"zcalSettings.othCalList"}}};return config},settings}(zcalSettings||{}),zcalSettings=window.zcalSettings||{};zcalSettings.zcalMyPreferences=function(zcalmypref){zcalmypref=zcalmypref||{};var myprefHeaderDOM,myprefContentDOM,previewHeaderDOM,previewContentDOM,SETTINGS_APP_ID="settings",currentView="general",tOPT={},_getTabs=function(){return{general:{text:zcal.i18n.general,type:"general",id:"zcl_mypref_general",click:function(){currentView="general",updatePreviewContent()}},emailnotify:{text:zcal.i18n.emailnotify,type:"emailnotify",id:"zcl_mypref_enotify",click:function(){currentView="emailnotify",updatePreviewContent()}}}},showallTimezone=function(){zcal.timezones.length>0?setTZ():ZCL_getTZ({mode:"mypref",callback:function(){zcalSettings.zcalMyPreferences.showAllTimezone()}})},updatePreviewHeader=function(){myprefHeaderDOM=$('<div class="SC_filt"><div class="SC_filt_Tabs"/></div>');var tabs=_getTabs();for(var i in tabs){var tab=$('<a id="'+tabs[i].id+'"/>');tab.addClass(currentView==tabs[i].type?"sel":""),tab.text(tabs[i].text),tab.off("click").on("click",{click:tabs[i].click},function(ev){var $ele=$(this);$ele.parent().find("a").removeClass("sel"),$ele.addClass("sel"),ev.data.click()}),myprefHeaderDOM.find(".SC_filt_Tabs").append(tab)}previewHeaderDOM.append(myprefHeaderDOM)},updatePreviewContent=function(){myprefContentDOM=$('<div class="SC_setInner"><div class="SC_filt_bottom"/></div>');var opt=zcal.cdata.opt;if("emailnotify"==currentView){var contentDOM,tStr="",_MT=opt.MT,_MTO=opt.MTO;if(opt.CMAIL&&""!=opt.CMAIL)tStr+='<div class="folderRow"><div class="folderRowBox">',tStr+="<p>"+ZCL_replaceString(zcal.i18n.rnote1,['<span class="SC_lnk">'+opt.CMAIL+"</span>",'<span class="SC_lnk" data-marker="resendEmail">',"</span>"])+"</p>",tStr+="<p>"+ZCL_replaceString(zcal.i18n.rnote2,['<span class="SC_lnk">'+_MTO+"</span>"])+"</p>",tStr+='<div class="SC_PUbtm"><span data-marker="reverttoPrevious">'+zcal.i18n.rbutton+"</span></div>",tStr+="</div></div>";else{if(tStr='<ul class="SC_cal_prefer"><li>',"1"==zcal.emlNfy){var emailIds=opt.REMID.split(",");tStr+="<span>"+zcal.i18n.emailaddress+"<span>"+zcal.i18n.emailaddress_msg2+"</span></span><em><div>"+ZCL_selBox("zcl_MTO",_MTO,emailIds)}else tStr+="<span>"+zcal.i18n.emailaddress+"<span>"+zcal.i18n.emailaddress_msg1+"</span></span><em><div>"+_MTO,"0"!=zcal.emlNfy&&"1"!=zcal.emlNfy&&(tStr+='<span class="cnew SC_lnk pl5" data-marker="changeEmailNotify">'+zcal.i18n.change+"</span>");tStr+='<div class="block" id="enotifyType"><span data-marker="notifyType"><i class="'+(0==_MT?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.ashtml+'</span></span><span data-marker="notifyType"><i class="'+(1==_MT?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.asplaintext+"</span></span></div></div></em>",tStr+="</li>",0==_MT&&(tStr+="<li>",tStr+="<span>"+zcal.i18n.agendanotification+"<span>"+zcal.i18n.agendanotification_msg+"</span></span><em>"+ZCL_selBox1("zcl_AI",opt.AI,zcal.AGENDA_INTERVAL)+"</em>",tStr+="</li>"),tStr+='<div class="SC_PUbtm left"><span class="sel" data-marker="saveENotify">'+zcal.i18n.save+"</span></div>",tStr+="</ul>"}contentDOM=$(tStr);var notifyTypeDOM=contentDOM.find("[data-marker=notifyType]").removeAttr("data-marker");notifyTypeDOM.length&&notifyTypeDOM.on("click",function(){var $ele=$(this);$ele.parent().find("i").removeClass("msi-option").addClass("msi-unoption"),$ele.find("i").removeClass("msi-unoption").addClass("msi-option"),toggleAgendaNotify($ele.index())});var changeEmailNotifyDOM=contentDOM.find("[data-marker=changeEmailNotify]").removeAttr("data-marker");changeEmailNotifyDOM.length&&changeEmailNotifyDOM.on("click",function(){changeEmailNotify()});var resendEmailDOM=contentDOM.find("[data-marker=resendEmail]").removeAttr("data-marker");resendEmailDOM.length&&resendEmailDOM.on("click",function(){ZCL_XHR("/cal/set.do?type=resendemail",_resendEmailSts)});var reverttoPreviousDOM=contentDOM.find("[data-marker=reverttoPrevious]").removeAttr("data-marker");reverttoPreviousDOM.length&&reverttoPreviousDOM.on("click",function(){ZCL_XHR("/cal/set.do?type=revert",_revertEmailId)});var saveENotifyDOM=contentDOM.find("[data-marker=saveENotify]").removeAttr("data-marker");saveENotifyDOM.length&&saveENotifyDOM.on("click",function(){saveEmailNotify()}),myprefContentDOM.find(".SC_filt_bottom").append(contentDOM)}else{var contentDOM,tStr='<ul class="SC_cal_prefer">';tStr+="<li><span>"+zcal.i18n.timezone+'</span><em><div class="SC_select default">'+setTZ()+'</div><span class="cnew SC_lnk pl5" data-marker="showallTimezone">'+zcal.i18n.showall+"</span></em></li>",tStr+="<li><span>"+zcal.i18n.dateformat+"</span><em>"+ZCL_selBox("zcl_DF",opt.DF,zcal.DATEFORMAT)+"</em></li>",tStr+="<li><span>"+zcal.i18n.timeformat+"</span><em>"+ZCL_selBox("zcl_TF",opt.TF,zcal.TIMEFORMAT)+"</em></li>",tStr+="<li><span>"+zcal.i18n.defaultview+"</span><em>"+ZCL_selBox("zcl_DEF",opt.DEF,zcal.DEFAULTVIEW)+"</em></li>",tStr+="<li><span>"+zcal.i18n.weekstartson+"</span><em>"+ZCL_selBox("zcl_WK",opt.WK,Date.WEEK_DAYS[0])+"</em></li>",tStr+="<li><span>"+zcal.i18n.workweek+"</span><em><strong>"+zcal.i18n.startson+ZCL_selBox("zcl_WS",opt.WS,Date.WEEK_DAYS[0])+"</strong><strong>"+zcal.i18n.endson+ZCL_selBox("zcl_WE",opt.WE,Date.WEEK_DAYS[0])+"</strong></em></li>";var _SIE=opt.SIE,_DDE=opt.DDE,_REM=opt.REM,_NWTB=opt.NWTB;tStr+="<li><span>"+zcal.i18n.workhours+"</span><em><strong>"+zcal.i18n.startson+ZCL_selBox("zcl_HS",opt.HS,zcal.HOURS)+"</strong><strong>"+zcal.i18n.endson+ZCL_selBox("zcl_HE",opt.HE,zcal.HOURS)+'</strong><div class="block"><span data-marker="nonworkingHour" id="zcl_nonWHr"><i class="'+(1==_NWTB?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.nonworktime_busy+"</span></span></div></em></li>",tStr+="<li><span>"+zcal.i18n.automatic_inv+"<span>"+zcal.i18n.automatic_invmsg+'</span></span><em id="zcl_autoInv"><span data-marker="automaticInvitation"><i class="'+(0==_SIE?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.allow+'</span></span><span data-marker="automaticInvitation"><i class="'+(2==_SIE?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.allowiffree+'</span></span><span data-marker="automaticInvitation"><i class="'+(1==_SIE?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.dontallow+"</span></span></em></li>",tStr+="<li><span>"+zcal.i18n.denied_events+"<span>"+zcal.i18n.denied_eventsmsg+'</span></span><em id="zcl_showDE"><span data-marker="deniedEvents"><i class="'+(1==_DDE?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.show+'</span></span><span data-marker="deniedEvents"><i class="'+(0==_DDE?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.hide+"</span></span></em></li>",tStr+="<li><span>"+zcal.i18n.reminder_notification+"<span>"+zcal.i18n.reminder_notification_msg+'</span></span><em id="zcl_remNotify"><span data-marker="reminderNotify"><i class="'+(1==_REM?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.on+'</span></span><span data-marker="reminderNotify"><i class="'+(0==_REM?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.off+"</span></span></em></li>",tStr+='<div class="SC_PUbtm left"><span class="sel" data-marker="saveMyPrefGeneral">'+zcal.i18n.save+"</span></div>",tStr+="</ul>",contentDOM=$(tStr);var showallTimezoneDOM=contentDOM.find("[data-marker=showallTimezone]").removeAttr("data-marker");showallTimezoneDOM&&showallTimezoneDOM.on("click",function(){showallTimezone(),$(this).remove()}),contentDOM.find("#zcl_TZ").on("click",function(){if(zcal.timezones.length>0){var tzArr=zcal.timezones,tArr=[];for(var i in tzArr)for(var j in tzArr[i]){var obj={};obj.id=j,obj.name=tzArr[i][j]+" ("+j+")",obj.display_text=tzArr[i][j]+" ("+j+")",tArr.push(obj)}var component,config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.parWidth=!0,config.onSelect=function(id,selectObj){setGroupValue(that,id,selectObj),component.hide()},config.dataCallback=function(){return tArr},component=zmUtil.createFLComp("generic",config),component.show()}});var nonworkingHourDOM=contentDOM.find("[data-marker=nonworkingHour]").removeAttr("data-marker");nonworkingHourDOM&&nonworkingHourDOM.on("click",function(){var $ele=$(this);"msi-check"==$ele.find("i")[0].className?$ele.find("i").removeClass("msi-check").addClass("msi-uncheck"):$ele.find("i").removeClass("msi-uncheck").addClass("msi-check")});var automaticInvationDOM=contentDOM.find("[data-marker=automaticInvitation]").removeAttr("data-marker");automaticInvationDOM&&automaticInvationDOM.on("click",function(){var $ele=$(this);$ele.parent().find("i").removeClass("msi-option").addClass("msi-unoption"),$ele.find("i").removeClass("msi-unoption").addClass("msi-option")});var deniedEventDOM=contentDOM.find("[data-marker=deniedEvents]").removeAttr("data-marker");deniedEventDOM&&deniedEventDOM.on("click",function(){var $ele=$(this);$ele.parent().find("i").removeClass("msi-option").addClass("msi-unoption"),$ele.find("i").removeClass("msi-unoption").addClass("msi-option")});var reminderNotifyDOM=contentDOM.find("[data-marker=reminderNotify]").removeAttr("data-marker");reminderNotifyDOM&&reminderNotifyDOM.on("click",function(){var $ele=$(this);$ele.parent().find("i").removeClass("msi-option").addClass("msi-unoption"),$ele.find("i").removeClass("msi-unoption").addClass("msi-option")});var saveMyPrefGeneralDOM=contentDOM.find("[data-marker=saveMyPrefGeneral]").removeAttr("data-marker");saveMyPrefGeneralDOM&&saveMyPrefGeneralDOM.on("click",function(){saveGeneralSettings()}),myprefContentDOM.find(".SC_filt_bottom").append(contentDOM)}previewContentDOM.empty().append(myprefContentDOM)},setGroupValue=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("rel",id),$ele.attr("value",selectObj.display_text)},hasChangeInENotify=function(){var opt=zcal.cdata.opt,enotifyDOM=$("#enotifyType");if(ZCL_$("zcl_MTO")){var _newEmailId=ZCL_$("zcl_MTO").value;if(!ZCL_isEmail(_newEmailId))return _zm.succErrMsg("e",zcal.i18n.entervalidemailid),ZCL_$("zcl_MTO").focus(),!1;if(_newEmailId!=opt.MTO)return!0}if(enotifyDOM.length){var _MT=enotifyDOM.find(".msi-option").parent().index();if(opt.MT!=_MT)return!0;var _AI=-1;if(0===_MT&&(_AI=$("#zcl_AI").val()),_AI!=opt.AI)return!0}return!1},saveEmailNotify=function(){if(hasChangeInENotify()){var opt=zcal.cdata.opt,enotifyDOM=$("#enotifyType");tOPT={},tOPT.MTO=ZCL_$("zcl_MTO")?ZCL_$("zcl_MTO").value:opt.MTO,tOPT.MT=enotifyDOM.length?enotifyDOM.find(".msi-option").parent().index():opt.MT,tOPT.AI=0==tOPT.MT?$("#zcl_AI").val():-1,ZCL_XHR("/cal/set.do?type=notify&mailto="+tOPT.MTO.zcalescape()+"&as="+tOPT.MT+"&agenda_notify="+tOPT.AI,_updateENotifySts)}},_updateENotifySts=function(res){var obj=ZCL_Evl(1,res.responseText);"success"==obj.status&&(_zm.succErrMsg("s",zcal.i18n.successedit),zcal.cdata.opt.MTO=obj.MTO,zcal.cdata.opt.MT=obj.MT,zcal.cdata.opt.AI=obj.AI)},toggleAgendaNotify=function(mType){if(0===mType){if(0==$("#zcl_AI").length){var $anotify=$("<li/>");$anotify.html("<span>"+zcal.i18n.agendanotification+"<span>"+zcal.i18n.agendanotification_msg+"</span></span><em>"+ZCL_selBox1("zcl_AI",zcal.cdata.opt.AI,zcal.AGENDA_INTERVAL)+"</em>"),$(".SC_cal_prefer>li:first").after($anotify)}}else $("#zcl_AI").length>0&&$("#zcl_AI").parents("LI").remove()},changeEmailNotify=function(){var contentDOM,tStr="";myprefContentDOM=$('<div class="SC_setInner"><div class="SC_filt_bottom"/></div>'),tStr+='<ul class="SC_cal_prefer"><li><span>'+zcal.i18n.emailaddress+"<span>"+zcal.i18n.emailaddress_msg3+"</span></span>",tStr+='<em><input type="text" id="zcl_MTO" value="'+zcal.cdata.opt.MTO+'" class="inputDefault"></em></li>',tStr+='<div class="SC_PUbtm left"><span class="sel" data-marker="confirmEmail">'+zcal.i18n.confirm+'</span><span data-val="Cancel" data-marker="cancelEmail">'+zcal.i18n.cancel+"</span></div></ul>",contentDOM=$(tStr);var confirmDOM=contentDOM.find("[data-marker=confirmEmail]").removeAttr("data-marker");confirmDOM&&confirmDOM.on("click",function(){sendConfirmation()});var cancelDOM=contentDOM.find("[data-marker=cancelEmail]").removeAttr("data-marker");cancelDOM&&cancelDOM.on("click",function(){updatePreviewContent()}),myprefContentDOM.find(".SC_filt_bottom").append(contentDOM),previewContentDOM.empty().append(myprefContentDOM)},sendConfirmation=function(){var opt=zcal.cdata.opt,_newEmailId=ZCL_$("zcl_MTO").value.trim();if(opt.CMAIL&&""!=opt.CMAIL&&_newEmailId!=opt.CMAIL||void 0==opt.CMAIL||""==opt.CMAIL&&_newEmailId!=opt.MTO){if(!ZCL_isEmail(_newEmailId))return _zm.succErrMsg("e",zcal.i18n.entervalidemailid),ZCL_$("zcl_MTO").focus(),!1;opt.CMAIL=_newEmailId,ZCL_XHR("/cal/set.do?type=changeemail&mailto="+_newEmailId.zcalescape(),_confirmEmailSts)}else updatePreviewContent()},hasValidChange=function(){var _Odet,_SIE,_DDE,_REM,_NWTB,opt=zcal.cdata.opt;if(ZCL_$("zcl_TZ")){var tzz=ZCL_$("zcl_TZ").getAttribute("rel");if(tzz&&tzz!=opt.TIM)return!0}for(var _Odet=["DF","TF","DEF","WK","WS","WE","HS","HE"],i=0;i<_Odet.length;i++)if(opt[_Odet[i]]!=parseInt(ZCL_$("zcl_"+_Odet[i]).value,10))return!0;_NWTB=1==$("#zcl_nonWHr").find(".msi-check").length?1:0;var ind,_autoInv=$("#zcl_autoInv"),_showDE=$("#zcl_showDE"),_remNotify=$("#zcl_remNotify");return ind=_autoInv.find(".msi-option").parent().index(),_SIE=2==ind?1:1==ind?2:0,_DDE=0==_showDE.find(".msi-option").parent().index()?1:0,_REM=0==_remNotify.find(".msi-option").parent().index()?1:0,opt.DDE!=_DDE||opt.SIE!=_SIE||opt.REM!=_REM||opt.NWTB!=_NWTB?!0:!1},validateGeneralSettings=function(){tOPT={};var _Odet,HS,HE;if(_Odet=[["DF",3],["TF",1],["DEF",4],["WK",6],["WS",6],["WE",6]],HS=parseInt(ZCL_$("zcl_HS").value,10),HE=parseInt(ZCL_$("zcl_HE").value,10),HS>=HE)return _zm.succErrMsg("e",zcal.i18n.wkhretgrwkhrst),!1;tOPT.HS=HS,tOPT.HE=HE;var tzz=ZCL_$("zcl_TZ")?ZCL_$("zcl_TZ").getAttribute("rel"):null;tzz&&tzz!=zcal.cdata.opt.TIM?(tOPT.TIM=tzz,tOPT.CTIM=ZCL_$("zcl_TZ").value):tOPT.TIM=zcal.cdata.opt.TIM;for(var i=0;i<_Odet.length;i++){var _pa=_Odet[i][0],tmp=parseInt(ZCL_$("zcl_"+_pa).value,10);tOPT[_pa]=tmp>=0&&tmp<=_Odet[i][1]?tmp:opt[_pa]}var ind,_autoInv=$("#zcl_autoInv"),_showDE=$("#zcl_showDE"),_remNotify=$("#zcl_remNotify");return ind=_autoInv.find(".msi-option").parent().index(),tOPT.SIE=2==ind?1:1==ind?2:0,tOPT.DDE=0==_showDE.find(".msi-option").parent().index()?1:0,tOPT.REM=0==_remNotify.find(".msi-option").parent().index()?1:0,tOPT.NWTB=1==$("#zcl_nonWHr").find(".msi-check").length?1:0,!0},updateGeneralSettings=function(){var opt=zcal.cdata.opt;validateGeneralSettings()&&ZCL_XHR("/cal/set.do?type=gen&obj="+encodeURIComponent('{"DF":'+tOPT.DF+',"TF":'+tOPT.TF+',"DEF":'+tOPT.DEF+',"WK":'+tOPT.WK+',"WS":'+tOPT.WS+',"WE":'+tOPT.WE+',"HS":'+tOPT.HS+',"HE":'+tOPT.HE+',"MTO":'+opt.MTO+', "TH":'+opt.TH+',"FS":'+opt.FS+',"TIM":"'+tOPT.TIM+'", "DDE":'+tOPT.DDE+', "SIE":'+tOPT.SIE+',"REM":'+tOPT.REM+',"NWTB":'+tOPT.NWTB+"}"),_processGChanges)},_processGChanges=function(res){var obj=ZCL_Evl(1,res.responseText);if("success"==obj.status){var opt=zcal.cdata.opt;obj.TZLBL&&(opt.TZLBL=obj.TZLBL);for(var i in tOPT)opt[i]=tOPT[i];_zm.succErrMsg("s",zcal.i18n.successedit)}},saveGeneralSettings=function(){hasValidChange()?updateGeneralSettings():_zm.succErrMsg("i","No Changes made in My Preferences")},setTZ=function(){var tzStr='<input type="text" readonly  value="'+unescape(zcal.cdata.opt.CTIM)+'" id="zcl_TZ" class="SC_tiput zcl_nrbr" rel="'+zcal.cdata.opt.TIM+'" />		  ';return tzStr},_resendEmailSts=function(res){var obj=ZCL_Evl(1,res.responseText);zcal.cdata.opt.CMAIL=obj.CMAIL,_zm.succErrMsg("s",zcal.i18n.mailsendsuccess)},_revertEmailId=function(res){var obj=ZCL_Evl(1,res.responseText);zcal.cdata.opt.CMAIL=obj.CMAIL,updatePreviewContent()},_confirmEmailSts=function(res){var obj=ZCL_Evl(1,res.responseText);""!=obj.MTO&&""==obj.CMAIL?(zcal.cdata.opt.MTO=obj.MTO,zcal.cdata.opt.CMAIL=obj.CMAIL,void 0!=obj.MSG?"INVALID_ID"==obj.MSG?_zm.succErrMsg("e",zcal.i18n.nonregisteredemailid):"NOPERM"==obj.MSG&&_zm.succErrMsg("e",zcal.i18n.nonregisteredemailid):_zm.succErrMsg("s",zcal.i18n.mailconfirmed)):(zcal.cdata.opt.CMAIL=obj.CMAIL,_zm.succErrMsg("s",zcal.i18n.verifymailsend)),updatePreviewContent()},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),updatePreviewContent()},_destructViews=function(){myprefHeaderDOM.remove(),myprefContentDOM.remove()},_show=function(){zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&_constructViews()},_close=function(){currentView="general",_destructViews(),zmailSettings.currentAppName=void 0};return zcalmypref.myprefRowHTML=function(){{var html="",tZone=zcal.cdata.opt.TIM,dFormat=zcal.DFORMAT[zcal.cdata.opt.DF];zcal.timeformat[zcal.cdata.opt.TF],zcal.cdata.opt.MTO}return html+=ZCL_replaceString(zcal.i18n.mailtimezone,[tZone]),html+="<strong>|</strong>",html+=ZCL_replaceString(zcal.i18n.maildateformat,[dFormat])},zcalmypref.init=_show,zcalmypref.clearTrace=_close,zcalmypref.showAllTimezone=setTZ,zcalmypref}(zcalSettings.zcalMyPreferences||{}),zcalSettings.Import=function(zcalimport){zcalimport=zcalimport||{};var importHeaderDOM,importContentDOM,previewHeaderDOM,previewContentDOM,SETTINGS_APP_ID="settings",currentView="file",_getTabs=function(){return{file:{text:zcal.i18n.file,type:"file",id:"zcl_imp_file",click:function(){currentView="file",updatePreviewContent()}},url:{text:zcal.i18n.url,type:"url",id:"zcl_imp_url",click:function(){currentView="url",updatePreviewContent()}}}},updatePreviewHeader=function(){importHeaderDOM=$('<div class="SC_filt"><div class="SC_filt_Tabs"/></div>');var tabs=_getTabs();for(var i in tabs){var tab=$('<a id="'+tabs[i].id+'"/>');tab.addClass(currentView==tabs[i].type?"sel":""),tab.text(tabs[i].text),tab.off("click").on("click",{click:tabs[i].click},function(ev){var $ele=$(this);$ele.parent().find("a").removeClass("sel"),$ele.addClass("sel"),ev.data.click()}),importHeaderDOM.find(".SC_filt_Tabs").append(tab)}previewHeaderDOM.append(importHeaderDOM)},updatePreviewContent=function(){importContentDOM=$('<div class="SC_setInner"><div class="SC_filt_bottom"/></div>');var contentDOM,tStr='<ul class="SC_cal_prefer">';"url"==currentView?(tStr+="<li><span>"+zcal.i18n.weburl+"<span>"+zcal.i18n.weburl_msg+"</span></span>",tStr+='<em><input type="text" id="zcl_impUrl" class="inputDefault"/>'):(tStr+="<li><span>"+zcal.i18n.filename+"<span>"+zcal.i18n.browsefile+"</span></span>",tStr+="<em>",tStr+='<iframe name="zcl_imp" id="zcl_imp" style="display:none"></iframe><form action="/mail/cal/import.do" method="post" enctype="multipart/form-data" target="zcl_imp" onSubmit="return false;" id="zcl_impEve" name="zcl_impEve">',tStr+='<input id="zcl_impCkey" value="0" name="zcl_impCkey" type="hidden"/>',tStr+='<input id="zcl_owrEvent" value="false" name="zcl_owrEvent" type="hidden"/>',tStr+='<input id="zcl_incAtt" value="false" name="zcl_incAtt" type="hidden"/>',tStr+='<input id="zcl_incRem" value="false" name="zcl_incRem" type="hidden"/>',tStr+='<input id="zcl_mkPvt" value="false" name="zcl_mkPvt" type="hidden"/>',tStr+='<div class="SC_select default"><input type="file" id="zcl_impFil" name="zcl_impFil"/></div>',tStr+="</form>"),tStr+='<span id="zcl_impMoreOptTxt" class="cnew SC_lnk pl5">'+zcal.i18n.moreoptions+'</span><div style="display:none;" id="zcl_impMoreOpt" class="moreOptions"></div>',tStr+="</em></li>",tStr+="<li><span>"+zcal.i18n.calname+'</span><em><div class="SC_select default">'+calSelect()+"</div></em></li>",tStr+='<div class="SC_PUbtm left"><span class="sel" data-marker="calImport">'+zcal.i18n.import+"</span></div>",tStr+="</ul>",contentDOM=$(tStr);var calImportDOM=contentDOM.find("[data-marker=calImport]").removeAttr("data-marker");calImportDOM.length&&calImportDOM.on("click",{type:currentView},function(ev){"url"===ev.data.type?urlImport():fileImport()});var moreOpt=contentDOM.find("#zcl_impMoreOptTxt");moreOpt.off("click").on("click",function(){tgleMoreOptions()});var calSelDOM=contentDOM.find("select");calSelDOM.length&&calSelDOM.change(function(){var selVal=this.value;0==selVal&&ZCL_createCal()}),importContentDOM.find(".SC_filt_bottom").append(contentDOM),previewContentDOM.empty().append(importContentDOM)},tgleMoreOptions=function(){var $moreOpt=$("#zcl_impMoreOpt"),$moreOptTxt=$("#zcl_impMoreOptTxt");if($moreOpt.is(":visible"))$moreOpt.html(""),$moreOptTxt.text(zcal.i18n.moreoptions),$moreOpt.hide();else{var $ovr,$incAtt,$incRem,$pvt;$ovr=$('<span id="zcl_impOvr"><div><i class="msi-uncheck"/><span class="pl5">'+zcal.i18n.overrideevent+"</span></div></span>"),$ovr.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt.append($ovr),$incAtt=$('<span id="zcl_impAtt"><div><i class="msi-uncheck"/><span class="pl5">'+zcal.i18n.includeattendees+"</span></div></span>"),$incAtt.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt.append($incAtt),$incRem=$('<span id="zcl_impRem"><div><i class="msi-uncheck"/><span class="pl5">'+zcal.i18n.includereminder+"</span></div></span>"),$incRem.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt.append($incRem),$pvt=$('<span id="zcl_impPvt"><div><i class="msi-uncheck"/><span class="pl5">'+zcal.i18n.markallasprivate+"</span></div></span>"),$pvt.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt.append($pvt),$moreOptTxt.text(zcal.i18n.hideoptions),$moreOpt.show()}},chgChk=function($chk){$chk.hasClass("msi-check")?$chk.removeClass("msi-check").addClass("msi-uncheck"):$chk.removeClass("msi-uncheck").addClass("msi-check")},calSelect=function(){var calStr='<select id="zcl_impCal">';return calStr+=calSelOption(),calStr+="</select>"},calSelOption=function(selId){var calOrder=zcal.cdata.calOrdArr,calStr="";return calOrder.forEach(function(id){var calLst=zcal.cdata.calLst;"1"==calLst[id][8]&&(calStr+='<option value="'+calLst[id][9]+'" data-cid="'+id+'" '+(id==selId?"selected":"")+">"+ZCL_getHTML(calLst[id][0])+"</option>")}),calOrder.length<100&&(calStr+='<option value="0">'+zcal.i18n.newcal+"</option>"),calStr},_updCalSel=function(ev,data){var optStr,$calSel=$("#zcl_impCal");optStr=data&&data.calid?calSelOption(data.calid):calSelOption(),""!=optStr&&($calSel.empty(),$calSel.html(optStr))},_importStatus=function(val){if(""==val)zmUtil.succErrMsg("e",zcal.i18n.failimport);else{var robj=ZCL_Evl(1,val);0==robj.PCNT?zmUtil.succErrMsg("e",zcal.i18n.failimport):(robj.TCNT>"10000"?zmUtil.succErrMsg("e",zcal.i18n.failimport+"<br/>Unable to import as it exceeds the limit of 10000 events."):(zmUtil.succErrMsg("s",zcal.i18n.successimport+". "+zcal.i18n.totallyprocessed+" : "+(void 0==robj.PCNT?0:robj.PCNT)+". "+zcal.i18n.actuallyimported+" : "+(void 0==robj.ACNT?0:robj.ACNT)),zcalEvents.loadMonthData()),ZCL_$("zcl_impFil").value="")}},urlImport=function(){var calKey,calId,rgx,url=ZCL_$("zcl_impUrl").value.trim(),owrEvent=!1,incAtt=!1,incRem=!1,mkPvt=!1,$moreOpt=$("#zcl_impMoreOpt");if(rgx=/^(http|https|webcal|webcals)\:\/\/[-.\w]*(\/?)([a-zA-Z0-9\-\.\?\,\:\'\/\\\+=&amp;%\$#_@]*)?$/i,!rgx.test(url))return zmUtil.succErrMsg("e",zcal.i18n.entervalidhttpurl),!1;if($moreOpt.is(":visible")){var impOvr=$("#zcl_impOvr").find("i"),impAtt=$("#zcl_impAtt").find("i"),impRem=$("#zcl_impRem").find("i"),impPvt=$("#zcl_impPvt").find("i");owrEvent=impOvr.hasClass("msi-check")?!0:!1,incAtt=impAtt.hasClass("msi-check")?!0:!1,incRem=impRem.hasClass("msi-check")?!0:!1,mkPvt=impPvt.hasClass("msi-check")?!0:!1}if(calKey=ZCL_$("zcl_impCal").value,void 0==calKey)return zmUtil.succErrMsg("e",zcal.i18n.selvacalnam),!1;calId=$("#zcl_impCal option:selected").data("cid");var f="/cal/impurl.do?url="+encodeURIComponent(url)+"&impCkey="+calKey+"&incAtt="+incAtt+"&owrEvent="+owrEvent+"&incRem="+incRem+"&mkPvt="+mkPvt+(calId?"&calId="+calId:"");ZCL_XHR(f,function(res){var _robj=ZCL_Evl(1,res.responseText);processUrlImportResp(_robj)})},processUrlImportResp=function(robj){""==robj?zmUtil.succErrMsg("e",zcal.i18n.failimport):0==robj.PCNT?zmUtil.succErrMsg("e",zcal.i18n.failimport):(robj.TCNT>"10000"?zmUtil.succErrMsg("e",zcal.i18n.importfailure_exceedlimit):(zmUtil.succErrMsg("s",zcal.i18n.successimport+". "+zcal.i18n.totallyprocessed+" : "+(void 0==robj.PCNT?0:robj.PCNT)+". "+zcal.i18n.actuallyimported+" : "+(void 0==robj.ACNT?0:robj.ACNT)),zcalEvents.loadMonthData()),ZCL_$("zcl_impUrl").value="")},fileImport=function(){var calKey,fextn,owrEvent=!1,incAtt=!1,incRem=!1,mkPvt=!1,file=$("#zcl_impFil").val().trim(),$moreOpt=$("#zcl_impMoreOpt");if(fextn=file.substr(file.lastIndexOf(".")),".ics"!=fextn)return zmUtil.succErrMsg("e",zcal.i18n.validicsfile),!1;if($moreOpt.is(":visible")){var impOvr=$("#zcl_impOvr").find("i"),impAtt=$("#zcl_impAtt").find("i"),impRem=$("#zcl_impRem").find("i"),impPvt=$("#zcl_impPvt").find("i");owrEvent=impOvr.hasClass("msi-check")?!0:!1,incAtt=impAtt.hasClass("msi-check")?!0:!1,incRem=impRem.hasClass("msi-check")?!0:!1,mkPvt=impPvt.hasClass("msi-check")?!0:!1}if(calKey=$("#zcl_impCal").val(),void 0==calKey)return zmUtil.succErrMsg("e",zcal.i18n.selvacalnam),!1;$("#zcl_impCkey").val(calKey);var csr,tmp1=document.cookie;tmp1=tmp1.substring(tmp1.indexOf("aprmjrnpkcrkks=")+15,tmp1.length),csr=-1!=tmp1.indexOf(";")?tmp1.substring(0,tmp1.indexOf(";")):tmp1,document.zcl_impEve.appendChild(_zm.getDOM(["INPUT",{attrs:{type:"hidden",name:"mstpcrdhkur",value:csr}}])),$("#zcl_owrEvent").val(owrEvent),$("#zcl_incAtt").val(incAtt),$("#zcl_incRem").val(incRem),$("#zcl_mkPvt").val(mkPvt),document.zcl_impEve.submit()},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),updatePreviewContent()},_show=function(){zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&(_constructViews(),_subscribe())},_subscribe=function(){$.subscribe("/calendar/added",_updCalSel),$.subscribe("/calendar/updated",_updCalSel),$.subscribe("/calendar/deleted",_updCalSel),$.subscribe("/calendar/statusChanged",_updCalSel)},_destructViews=function(){importHeaderDOM.remove(),importContentDOM.remove()},_unsubscribe=function(){$.unsubscribe("/calendar/added",_updCalSel),$.unsubscribe("/calendar/updated",_updCalSel),$.unsubscribe("/calendar/deleted",_updCalSel),$.unsubscribe("/calendar/statusChanged",_updCalSel)},_close=function(){currentView="file",_destructViews(),zmailSettings.currentAppName=void 0,_unsubscribe()};return zcalimport.init=_show,zcalimport.clearTrace=_close,zcalimport.showImportStatus=_importStatus,zcalimport}(zcalSettings.Import||{}),zcalSettings.Subscribe=function(zcalsubscribe){zcalsubscribe=zcalsubscribe||{};var subscribeHeaderDOM,subscribeContentDOM,previewHeaderDOM,previewContentDOM,$loadAnimationDOM,$listContentDOM,SETTINGS_APP_ID="settings",HOLIDAYS_LIST=[],FCAL_OBJ=[],currentView="weburl",_getTabs=function(){return{weburl:{text:zcal.i18n.weburl,type:"weburl",id:"zcl_subscribe_weburl",click:function(){currentView="weburl",updatePreviewContent()}},friendscal:{text:zcal.i18n.friendscalendar,type:"friendscal",id:"zcl_subscribe_friendscal",click:function(){currentView="friendscal",updatePreviewContent()}},holidays:{text:zcal.i18n.holidays,type:"holidays",id:"zcl_subscribe_holidays",click:function(){currentView="holidays",updatePreviewContent()}}}},updatePreviewHeader=function(){subscribeHeaderDOM=$('<div class="SC_filt"><div class="SC_filt_Tabs"/></div>');var tabs=_getTabs();for(var i in tabs){var tab=$('<a id="'+tabs[i].id+'"/>');tab.addClass(currentView==tabs[i].type?"sel":""),tab.text(tabs[i].text),tab.off("click").on("click",{click:tabs[i].click},function(ev){var $ele=$(this);$ele.parent().find("a").removeClass("sel"),$ele.addClass("sel"),ev.data.click()}),subscribeHeaderDOM.find(".SC_filt_Tabs").append(tab)}previewHeaderDOM.append(subscribeHeaderDOM)},_loadHolidays=function(res){var resObj=ZCL_Evl(1,res.responseText),mode=resObj.mode;"list"==mode&&(HOLIDAYS_LIST=resObj.obj,listHolidays())},bindSubscribeHoliday=function(subDOM,hUid,hName){subDOM.on("click",{uid:hUid,name:hName},function(ev){subscribeHoliday(ev.data.uid,ev.data.name)})},bindUnSubscribeHoliday=function(unsubDOM,hUid){unsubDOM.on("click",{uid:hUid},function(ev){unsubscribeCal(ev.data.uid)})},listHolidays=function(){for(var hObj=HOLIDAYS_LIST,holLstDOM=$('<ul class="SC_cal_groups" id="zcl_hlist"/>'),i=0;i<hObj.length;i++){var calDOM=$("<li/>"),lStr="";lStr+="<span>"+ZCL_getHTML(hObj[i][0]),lStr+=-1==zcal.cdata.calOUids.indexOf(hObj[i][1])?'<span class="button" data-marker="sub">'+zcal.i18n.subscribe+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</span>",calDOM.html(lStr);var subDOM=calDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&bindSubscribeHoliday(subDOM,hObj[i][1],hObj[i][0]);var unsubDOM=calDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&bindUnSubscribeHoliday(unsubDOM,hObj[i][1]),holLstDOM.append(calDOM)}subscribeContentDOM.find(".SC_filt_bottom").empty().append(holLstDOM),$loadAnimationDOM.hide(),$listContentDOM.show()},subscribeHoliday=function(id,name){var flnam="/cal/subHoli.do?mode=sub&huid="+encodeURIComponent(id)+"&loc="+name;ZCL_XHR(flnam,function(res){_processSubscribeSts(res)})},requestHolidays=function(){if($loadAnimationDOM.show(),$listContentDOM.html("").hide(),0==HOLIDAYS_LIST.length){var flnam="/cal/subHoli.do?mode=list";ZCL_XHR(flnam,function(res){_loadHolidays(res)})}else listHolidays()},updatePreviewContent=function(){if(subscribeContentDOM=$('<div class="SC_setInner"><div class="SC_filt_bottom" data-marker="listContainer"/><div data-marker="loadingAnimation"/></div>'),$loadAnimationDOM=subscribeContentDOM.find("[data-marker=loadingAnimation]").removeAttr("data-marker"),$listContentDOM=subscribeContentDOM.find("[data-marker=listContainer]").removeAttr("data-marker"),"holidays"==currentView)previewContentDOM.empty().append(subscribeContentDOM),zmComponent.loadingBand({container:$loadAnimationDOM[0],type:"pagination"}),requestHolidays();else{var contentDOM,tStr;subscribeContentDOM=$('<div class="SC_setInner"><div class="SC_filt_bottom"/></div>'),tStr='<ul class="SC_cal_prefer">',"friendscal"==currentView?(tStr+="<li><span>"+zcal.i18n.friendemailaddress+"<span>"+zcal.i18n.friendemailaddress_msg+'</span></span><em><input type="text" class="inputDefault" id="zcl_fEmailId"></em></li>',tStr+='<div class="SC_PUbtm left"><span class="sel" data-marker="listFCal">'+zcal.i18n.ok+"</span></div>"):(tStr+="<li><span>"+zcal.i18n.weburl+"<span>"+zcal.i18n.weburl_msg+'</span></span><em><input type="text" class="inputDefault" id="zcl_subLink"></em></li>',tStr+='<div class="SC_PUbtm left"><span class="sel" data-marker="subToCal">'+zcal.i18n.subscribe+"</span></div>"),tStr+="</ul>",contentDOM=$(tStr);var listFCalDOM=contentDOM.find("[data-marker=listFCal]").removeAttr("data-marker");listFCalDOM.length&&listFCalDOM.on("click",function(){getFriendsCalendar()});var subToCalDOM=contentDOM.find("[data-marker=subToCal]").removeAttr("data-marker");subToCalDOM.length&&subToCalDOM.on("click",function(){var subURL=ZCL_$("zcl_subLink").value.trim();return""==subURL?(_zm.succErrMsg("e",zcal.i18n.entervalidhttpurl),ZCL_$("zcl_subLink").focus(),!1):void subscribeURL(subURL)}),subscribeContentDOM.find(".SC_filt_bottom").append(contentDOM),previewContentDOM.empty().append(subscribeContentDOM)}},confirmAndSubscribeURL=function(subURL){var _conEle,deferred=$.Deferred();$("#zcl_urlsubscribe_confirm").length||$("body").append("<div id='zcl_urlsubscribe_confirm' />"),_conEle=$("#zcl_urlsubscribe_confirm"),_conEle.html(subURL);var options={title:"Do you want to add calendar?",style:{left:"500px",top:"100px"},drag:!1,mask:!0,ptr:"tright",closeaction:function(){closeSubscribeConfirm(),deferred.reject()},buttons:[{txt:"Yes",callback:function(){subscribeURL(subURL),closeSubscribeConfirm(),deferred.resolve()}},{txt:"No",callback:function(){closeSubscribeConfirm(),deferred.reject()}}]};return zmsDialog.create("zcl_urlsubscribe_confirm",options),deferred.promise()},closeSubscribeConfirm=function(){zmsDialog.remove(!0),$("#zcl_urlsubscribe_confirm").remove()},subscribeURL=function(subURL){var f="/cal/subCal.do?mode=sub-url&url="+encodeURIComponent(subURL);ZCL_XHR(f,function(res){_processSubscribeSts(res)})},_processSubscribeSts=function(res){if(200===res.status){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var _stab,obj=_robj.obj;zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,ZCL_updateAppCalList(obj.aclst),_zm.succErrMsg("s",zcal.i18n.calSubSuccess),$.publish("/calendar/subscribed"),subscribeHeaderDOM&&(_stab=subscribeHeaderDOM.find(".sel"),"zcl_subscribe_holidays"==_stab[0].id?listHolidays():"zcl_subscribe_friendscal"==_stab[0].id&&constFCalList())}else _zm.succErrMsg("e",zcal.i18n[_robj.status])}else _zm.succErrMsg("e",zcal.i18n.errmsg)},_processUnsubscribeSts=function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var _stab,id=_robj.id;zcal.cdata.calLst[id]?(delete zcal.cdata.calLst[id],ZCL_remCalid(id),_zm.succErrMsg("s",zcal.i18n.caldeleted)):(zcal.cdata.calOLst[id]||zcal.cdata.calGLst[id]||zcal.cdata.calALst[id])&&(zcal.cdata.calGLst[id]?delete zcal.cdata.calGLst[id]:zcal.cdata.calALst[id]?delete zcal.cdata.calALst[id]:delete zcal.cdata.calOLst[id],ZCL_remOCalid(_robj.uid),_zm.succErrMsg("s",zcal.i18n.unsubscribesuc)),ZCL_gothro(id),_stab=subscribeHeaderDOM.find(".sel"),"zcl_subscribe_holidays"==_stab[0].id?listHolidays():"zcl_subscribe_friendscal"==_stab[0].id&&constFCalList()}else _zm.succErrMsg("e",_robj.status)},_listFriendsCalendar=function(res){var _robj=ZCL_Evl(1,res.responseText);if("pub-lst"==_robj.mode)if("du"==_robj.result){var obt=_robj.obj;FCAL_OBJ=[obt.pub,obt.pvt,_robj.mid],constFCalList()}else"su"==obj.result?_zm.succErrMsg("i",zcal.i18n.cannotsubtoowncal):"nonzoho"==obj.result?_zm.succErrMsg("i",ZCL_replaceComName(zcal.i18n.theuserdonthavezohoacc)):"np"==obj.result&&_zm.succErrMsg("e",zcal.i18n.cannotsubnonorgmemcal)},constFCalList=function(){var _pubLstDOM,_pubCalDOM,_pubCal=FCAL_OBJ[0],_pvtCal=FCAL_OBJ[1];if(_pubCalDOM=subscribeContentDOM.find("#zcl_FPubCalList"),_pubCalDOM.length||(_pubCalDOM=$('<div id="zcl_FPubCalList"/>'),subscribeContentDOM.append(_pubCalDOM)),_pubCalDOM.html("<h3>"+zcal.i18n.publiccal+'</h3><ul class="SC_cal_groups"></li>'),_pubLstDOM=_pubCalDOM.find(".SC_cal_groups"),ZCL_isEmpty(_pubCal)){var emptyStr="<li><em>"+zcal.i18n.calnotfound+"</em></li>";_pubLstDOM.html(emptyStr)}else for(var i in _pubCal){var calDOM=$("<li/>"),lStr="";lStr+="<span>"+ZCL_getHTML(_pubCal[i][0]),lStr+=-1==zcal.cdata.calOUids.indexOf(_pubCal[i][2])?'<span class="button" data-marker="sub">'+zcal.i18n.subscribe+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</span>",lStr+="<em>"+(1==_pubCal[i][1]?zcal.i18n.viewonlyfreebusy:zcal.i18n.vieweventdetail)+"</em>",calDOM.html(lStr);var subDOM=calDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",{id:i},function(ev){subscribePubSharedCal(ev.data.id)});var unsubDOM=calDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&unsubDOM.on("click",{uid:_pubCal[i][2]},function(ev){unsubscribeCal(ev.data.uid)}),_pubLstDOM.append(calDOM)}if(!ZCL_isEmpty(_pvtCal)){var _pvtCalDOM,_pvtLstDOM;_pvtCalDOM=subscribeContentDOM.find("#zcl_FPvtCalList"),_pvtCalDOM.length||(_pvtCalDOM=$('<div id="zcl_FPvtCalList"/>'),subscribeContentDOM.append(_pvtCalDOM)),_pvtCalDOM.html("<h3>"+zcal.i18n.privatecal+'</h3><ul class="SC_cal_groups"/>'),_pvtLstDOM=_pvtCalDOM.find(".SC_cal_groups");for(var i in _pvtCal){var calDOM=$("<li/>"),lStr="";lStr+="<span>"+ZCL_getHTML(_pvtCal[i][0]),lStr+=-1==zcal.cdata.calOUids.indexOf(_pvtCal[i][2])?'<span class="button" data-marker="sub">'+zcal.i18n.subscribe+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</span>",lStr+="<em>"+(1==_pvtCal[i][1]?zcal.i18n.viewonlyfreebusy:zcal.i18n.vieweventdetail)+"</em>",calDOM.html(lStr);var subDOM=calDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",{id:i},function(ev){subscribePvtSharedCal(ev.data.id)});var unsubDOM=calDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&unsubDOM.on("click",{uid:_pvtCal[i][2]},function(ev){unsubscribeCal(ev.data.uid)}),_pvtLstDOM.append(calDOM)}}var _sendReqDOM=subscribeContentDOM.find("#zcl_pvtshreqlnk");_sendReqDOM.length||(_sendReqDOM=$('<span class="SC_lnk" id="zcl_pvtshreqlnk"/>'),subscribeContentDOM.append(_sendReqDOM)),_sendReqDOM.html("&raquo;"+zcal.i18n.sendreqforindividualshare),_sendReqDOM.off("click").on("click",{eid:FCAL_OBJ[2]},function(ev){sendPvtShareReq(ev.data.eid)}),subscribeContentDOM.append(_sendReqDOM)},sendPvtShareReq=function(eid){var f="/cal/sentReq.do?mailId="+eid.zcalescape();ZCL_XHR(f,function(res){_processSendPvtShareReqSts(res)})},subscribePubSharedCal=function(id){var f="/cal/subCal.do?mode=sub-url&url="+encodeURIComponent(location.protocol+"//"+zcal.ZCAL+"/ical/"+id);ZCL_XHR(f,function(res){_processSubscribeSts(res)})},subscribePvtSharedCal=function(id){var _pvtCalObj=FCAL_OBJ[1];ZCL_XHR("/cal/shareCal.do?mode=pvtshcal-sub&ckey="+_pvtCalObj[id][4],function(res){_processSubscribeSts(res)})},unsubscribeCal=function(uid){ZCL_XHR("/cal/calAct.do?mode=delByUid&caluid="+encodeURIComponent(uid),function(res){_processUnsubscribeSts(res)})},_processSendPvtShareReqSts=function(){_zm.succErrMsg("s",zcal.i18n.requestmailsent)},getFriendsCalendar=function(){var fmailId=$("#zcl_fEmailId").val();return ZCL_isEmail(fmailId)?void ZCL_XHR("/cal/subCal.do?mode=pub-lst&mailId="+fmailId.zcalescape(),function(res){_listFriendsCalendar(res)}):(_zm.succErrMsg("e",zcal.i18n.entervalidemailid),ZCL_$("zcl_fEmailId").focus(),!1)},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),updatePreviewContent()},_show=function(){zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&_constructViews()},_destructViews=function(){subscribeHeaderDOM.remove(),subscribeContentDOM.remove()},_close=function(){currentView="weburl",_destructViews(),zmailSettings.currentAppName=void 0};return zcalsubscribe.init=_show,zcalsubscribe.clearTrace=_close,zcalsubscribe.confirmAndSubscribe=confirmAndSubscribeURL,zcalsubscribe}(zcalSettings.Subscribe||{}),zcalSettings.Sync=function(zcalsync){zcalsync=zcalsync||{};var syncHeaderDOM,syncContentDOM,previewHeaderDOM,previewContentDOM,$pploadAnimationDOM,$pplistContentDOM,SETTINGS_APP_ID="settings",gCalObj=[],gCalWinChkCount=1,gCalAuthWin=!1,gCalWinTimeOut=null,gCalSyncStatus=0,_getSyncList=function(){var syncList={};return-1!=zcal.ZCAL.indexOf("zoho")&&-1==zcal.ZCAL.indexOf("zoho.com.cn")&&-1==zcal.ZCAL.indexOf("baihui")&&(syncList.outlook={text:zcal.i18n.outlook,msg:ZCL_replaceProName(zcal.i18n.outlook_subnote),type:"outlook",click:function(){updatePreviewContent()}}),-1==zcal.ZCAL.indexOf("zoho.com.cn")&&-1==zcal.ZCAL.indexOf("baihui")&&(syncList.gcal={text:zcal.i18n.gcal,msg:ZCL_replaceProName(zcal.i18n.gcal_subnote),type:"gcal",click:function(){updatePreviewContent()}}),syncList.caldav={text:zcal.i18n.caldav,msg:ZCL_replaceProName(zcal.i18n.caldav_subnote),type:"caldav",click:function(){updatePreviewContent()}},-1==zcal.ZCAL.indexOf("zoho.com.cn")&&-1==zcal.ZCAL.indexOf("baihui")&&(syncList.zcalsync={text:ZCL_replaceComName(zcal.i18n.zcalsync),msg:ZCL_replaceProName(zcal.i18n.zcalsync_subnote),type:"zcalsync",click:function(){updatePreviewContent()}}),syncList},updatePreviewHeader=function(){syncHeaderDOM=$('<div class="SC_settHead"><div class="SC_phd">'+zcal.i18n.sync+"</div></div>"),previewHeaderDOM.append(syncHeaderDOM)},updatePreviewContent=function(){syncContentDOM=$('<div class="SC_setInner"><div class="SC_filt_bottom"><ul class="SC_cal_groups"/></div></div>');var contentDOM=syncContentDOM.find(".SC_cal_groups"),syncList=_getSyncList();for(var i in syncList){var sync=syncList[i],listDOM=$("<li/>");listDOM.html("<span>"+sync.text+"</span><em>"+sync.msg+"</em>"),listDOM.on("click",{type:sync.type},function(ev){openSyncPopup(ev.data.type)}),contentDOM.append(listDOM)}previewContentDOM.empty().append(syncContentDOM)},openSyncPopup=function(type){"caldav"===type?openCalDAVPopup():"gcal"===type?openGCalPopup():"outlook"===type?openOutlookPopup():"zcalsync"===type&&openZcalsyncPopup()},openZcalsyncPopup=function(){var url="https://"+zcal.ZOHOSTATIC+"/help/user-guide/calsync-android.html";window.open(url,"_blank")},openCalDAVPopup=function(){var caldavPPEle;ZCL_$("zcl_caldav_pp")||$("body").append("<div id='zcl_caldav_pp'/>"),caldavPPEle=$("#zcl_caldav_pp"),caldavPPEle.html('<div><div class="SC_filt_bottom zcl_cdavovr" data-marker="listContainer"/><div data-marker="loadingAnimation"/></div>'),$pploadAnimationDOM=caldavPPEle.find("[data-marker=loadingAnimation]").removeAttr("data-marker"),$pplistContentDOM=caldavPPEle.find("[data-marker=listContainer]").removeAttr("data-marker");var option={title:zcal.i18n.caldav_help,mask:!0,drag:!1,mask:!0,ptr:"tright",pos:"center",style:{"min-width":"600px","max-width":"750px"},customClass:"SC_SetPop",buttons:[{txt:zcal.i18n.ok,callback:function(){$("#zcl_caldav_pp").remove(),zmsDialog.remove(!0)}}],closeaction:function(){$("#zcl_caldav_pp").remove(),zmsDialog.remove()}};zmsDialog.create("zcl_caldav_pp",option),zmComponent.loadingBand({container:$pploadAnimationDOM[0],type:"pagination"}),$pploadAnimationDOM.show(),$pplistContentDOM.html("").hide(),ZCL_XHR("/cal/caldavCalLst.do?mode=callist",function(res){var _robj=ZCL_Evl(1,res.responseText);listCalendar(_robj)})},listCalendar=function(calList){$pplistContentDOM.empty();var calDOM=$('<div class="SC_cal_groups"><ul></ul></div>');for(var i in calList){var obj=calList[i],calName=ZCL_getHTML(obj.NAME),isVisible=1==obj.SHOWHIDE?!0:!1,calId=obj.CALID,isDefault=1==obj.ISDEF?!0:!1,isSynced=1==obj.SYNC?!0:!1,cbxDOM=$('<li class="'+(isVisible?"":"disable")+'"><i class="'+(isDefault||isSynced?"msi-check":"msi-uncheck")+'"></i><span>'+calName+"</span></li>");isDefault||cbxDOM.off("click").on("click",{calid:calId},function(ev){var $sts,sts,calid=ev.data.calid,$ele=$(this);$sts=$ele.find("i"),"msi-uncheck"==$sts[0].className?$sts.removeClass("msi-uncheck").addClass("msi-check"):$sts.removeClass("msi-check").addClass("msi-uncheck"),sts="msi-check"==$sts[0].className?"enable":"disable",ZCL_XHR("/cal/enablecaldav.do?mode="+sts+"&calid="+calid,function(res){ZCL_Evl(1,res.responseText)})}),calDOM.find("ul").append(cbxDOM)}$pplistContentDOM.append(calDOM),$pploadAnimationDOM.hide(),$pplistContentDOM.show()},openGCalPopup=function(){var gcalPPEle;ZCL_$("zcl_gcal_pp")||$("body").append("<div id='zcl_gcal_pp'/>"),gcalPPEle=$("#zcl_gcal_pp"),gcalPPEle.html('<div><div data-marker="loadingAnimation"/><div><ul class="SC_cal_groups SC_setInner zcl_ovr" id="zcl_gcallst"/><div/></div>'),$pploadAnimationDOM=gcalPPEle.find("[data-marker=loadingAnimation]").removeAttr("data-marker");var option={title:zcal.i18n.gcal,mask:!0,drag:!1,mask:!0,ptr:"tright",pos:"center",style:{"min-width":"600px","max-width":"750px"},customClass:"SC_SetPop",closeaction:function(){$("#zcl_gcal_pp").remove(),zmsDialog.remove()}};zmsDialog.create("zcl_gcal_pp",option),gCalObj&&gCalObj.length>0?_listGCal():(zmComponent.loadingBand({container:$pploadAnimationDOM[0],type:"pagination"}),$pploadAnimationDOM.show(),ZCL_XHR("/cal/getGCal.do?mode=auth",function(res){gCalObj=ZCL_Evl(1,res.responseText),_processGCalStatus()}))},_processGCalStatus=function(){if(gCalObj)$pploadAnimationDOM.hide(),_listGCal();else{var zcalOrigin=document.location.protocol+"//"+zcal.ZCAL,handleMessage=function(event){var origin=event.origin||event.originalEvent.origin;origin===zcalOrigin&&(_requestGCalList(),event.source.close(),window.addEventListener?window.removeEventListener("message",handleMessage,!1):window.detachEvent("onmessage",handleMessage))};window.addEventListener?window.addEventListener("message",handleMessage,!1):window.attachEvent("onmessage",handleMessage);var wTop=(document.body.offsetHeight-500)/2,wLeft=(document.body.offsetWidth-700)/2,winName="GoogleAuthenticationWindow_"+location.hostname.split(".")[0];gCalAuthWin=window.open(zcal.GCALSYNC,winName,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=no,width=700,height=500,left="+wLeft+",top="+wTop),gCalWinTimeOut||(gCalWinTimeOut=setTimeout(function(){checkGCalWinStatus()},5e3))}};checkGCalWinStatus=function(){gCalWinTimeOut&&clearTimeout(gCalWinTimeOut),12==gCalWinChkCount||gCalAuthWin.closed?(gCalAuthWin&&gCalAuthWin.close(),$("#zcl_gcal_pp").length>0&&(zmsDialog.remove(),$("#zcl_gcal_pp").remove()),gCalWinChkCount=1,gCalWinTimeOut=null,gCalAuthWin=!1):(gCalWinChkCount++,gCalWinTimeOut=setTimeout(function(){checkGCalWinStatus()},5e3))};var _requestGCalList=function(){gCalWinTimeOut&&clearTimeout(gCalWinTimeOut),ZCL_XHR("/cal/getGCal.do?mode=list",function(res){gCalObj=ZCL_Evl(1,res.responseText),_processGCalStatus()})},_listGCal=function(){if(gCalObj&&gCalObj.length>0){var _calDOM=$("#zcl_gcallst");if(_calDOM.length>0){_calDOM.empty();for(var i=0;i<gCalObj.length;i++){var liDOM=$("<li/>"),lStr="";gCalObj[i].gcalName=gCalObj[i].gcalName.replace("<","&lt;").replace(">","&gt;"),lStr+='<span id="zcl_synccal">'+gCalObj[i].gcalName,lStr+=-1==zcal.cdata.calOUids.indexOf("gCal_"+decodeURIComponent(gCalObj[i].gcalId))?'<span class="button" data-marker="sub">'+zcal.i18n.synchronize+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsynchronize+"</span>",lStr+="</span>",1===gCalSyncStatus&&(liDOM.addClass("zcl_disls"),lStr+='<s id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</s>"),liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&bindSyncButtonAction(subDOM,{gcalId:gCalObj[i].gcalId,gcalName:gCalObj[i].gcalName,authMail:gCalObj[i].authMail});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&bindUnSyncButtonAction(unsubDOM,{gcalId:gCalObj[i].gcalId,gcalName:gCalObj[i].gcalName,authMail:gCalObj[i].authMail}),_calDOM.append(liDOM)}}}},bindSyncButtonAction=function(subDOM,cobj){subDOM.off("click").on("click",{calid:cobj.gcalId,calname:cobj.gcalName,email:cobj.authMail},function(ev){setSyncStatus(),ZCL_XHR("/cal/getGCal.do?mode=sub&calId="+ev.data.calid+"&calName="+ev.data.calname+"&ownerMailID="+ev.data.email,_processGCalSubscribeSts)})},bindUnSyncButtonAction=function(unsubDOM,cobj){unsubDOM.off("click").on("click",{calid:cobj.gcalId,calname:cobj.gcalName},function(ev){ZCL_XHR("/cal/getGCal.do?mode=unsub&calId="+ev.data.calid+"&calName="+ev.data.calname,function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(gCalSyncStatus=0,gCalObj=null,$("#zcl_gcal_pp").length>0&&(zmsDialog.remove(),$("#zcl_gcal_pp").remove()),$.publish("/calendar/deleted",{calid:_robj.id,caluid:_robj.uid,mode:"delete"}))})})},_processGCalSubscribeSts=function(res){if(ZCL_clrStck(),200==res.status){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var obj=_robj.obj;zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,ZCL_updateAppCalList(obj.aclst),$.publish("/calendar/subscribed")}}},_setGCalSyncStatus=function(sts){gCalSyncStatus=sts},setSyncStatus=function(){var _calDOM=$("#zcl_gcallst");_setGCalSyncStatus(1);var statusEle,syncalEle=_calDOM.find("#zcl_synccal");0==_calDOM.find("#zcl_syncstatus").length&&syncalEle.after($('<s id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</s>")),statusEle=_calDOM.find("#zcl_syncstatus"),statusEle.parent().addClass("zcl_disls"),syncalEle.find("span.button").off("click")},openOutlookPopup=function(){var olPopup=$(zcalTemplate.OutlookPopup());olPopup.find("a").addClass("SC_lnk");var option={title:ZCL_replaceProName(zcal.i18n.mstitle),mask:!0,drag:!1,mask:!0,ptr:"tright",pos:"center",style:{"min-width":"600px","max-width":"750px"},customClass:"SC_SetPop",closeaction:function(){$("#zcl_grpcallst_pp").remove(),zmsDialog.remove()}};ZCL_$("zcl_olpp")||$("body").append('<div id="zcl_olpp"></div>'),$("#zcl_olpp").html(olPopup),zmsDialog.create("zcl_olpp",option)},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),updatePreviewContent()},_show=function(){zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&_constructViews()},_destructViews=function(){syncHeaderDOM.remove(),syncContentDOM.remove()},_close=function(){_destructViews(),zmailSettings.currentAppName=void 0};return zcalsync.init=_show,zcalsync.clearTrace=_close,zcalsync.reqGCalList=_requestGCalList,zcalsync.setGCalSyncStatus=_setGCalSyncStatus,zcalsync.listGCal=_listGCal,zcalsync}(zcalSettings.Sync||{}),zcalSettings.zcalGroupList=function(zcalgrplist){zcalgrplist=zcalgrplist||{};var GRP_NAME,groupHeaderDOM,groupContentDOM,previewHeaderDOM,previewContentDOM,SETTINGS_APP_ID="settings",GRP_CALLIST={},currentView="personal",_getTabs=function(){return{personal:{text:zcal.i18n.personal_group,type:"personal",id:"zcl_group_personal",click:function(){currentView="personal",updatePreviewContent()}},org:{text:zcal.i18n.org_group,type:"org",id:"zcl_group_org",click:function(){currentView="org",updatePreviewContent()}}}},updatePreviewHeader=function(){groupHeaderDOM=$('<div class="SC_filt"><div class="SC_filt_Tabs"/></div>');var tabs=_getTabs();for(var i in tabs){var tab=$('<a id="'+tabs[i].id+'"/>');tab.addClass(currentView==tabs[i].type?"sel":""),tab.text(tabs[i].text),tab.off("click").on("click",{click:tabs[i].click},function(ev){var $ele=$(this);$ele.parent().find("a").removeClass("sel"),$ele.addClass("sel"),ev.data.click()}),groupHeaderDOM.find(".SC_filt_Tabs").append(tab)}previewHeaderDOM.append(groupHeaderDOM)},bindClickEvent=function(listDOM,gid,gname){listDOM.on("click",{id:gid,name:gname},function(ev){GRP_NAME=ev.data.name,openGroupCalPopup(ev.data.id)})},updatePreviewContent=function(){var contentDOM,groupList;groupContentDOM=$('<div class="SC_setInner"><div class="SC_filt_bottom"><ul class="SC_cal_groups"/></div></div>'),contentDOM=groupContentDOM.find(".SC_cal_groups"),groupList=zcalGroup.getGroupList(currentView);for(var i=0;i<groupList.length;i++){var group=zcalGroup.getGroup(groupList[i]);if(group){var listDOM=$("<li/>"),gname=ZCL_getHTML(group.name);listDOM.html("<span>"+gname+"</span><em>"+ZCL_getDescHTML(group.desc)+"</em>"),bindClickEvent(listDOM,groupList[i],gname),contentDOM.append(listDOM)}}previewContentDOM.empty().append(groupContentDOM)},fetchGroupCalList=function(gid){var deferred=$.Deferred();return ZCL_XHR("/cal/grpDtl.do?mode=grp-callst&comid="+gid,function(res){GRP_CALLIST=ZCL_Evl(1,res.responseText),deferred.resolve(GRP_CALLIST)}),deferred},_processSubscribeSts=function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var _gtabDOM,_stab,obj=_robj.obj,uid=_robj.uid;zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,ZCL_updateAppCalList(obj.aclst),_zm.succErrMsg("s",zcal.i18n.calSubSuccess),updateGrpCalLst(uid),_gtabDOM=$("#zcl_grpcallst_tabs"),_stab=_gtabDOM.find(".sel"),listGroupCal("zcl_grpcal_sh"==_stab[0].id?"sh":"zcl_grpcal_sub"==_stab[0].id?"sub":"def"),$.publish("/calendar/subscribed")}else"available"==_robj.status?_zm.succErrMsg("s",zcal.i18n.calSubSuccess):_zm.succErrMsg("e",_robj.status)};updateGrpCalLst=function(uid){if(!ZCL_isEmpty(GRP_CALLIST)){if(GRP_CALLIST.owncLst&&GRP_CALLIST.owncLst[uid])return void(GRP_CALLIST.owncLst[uid].IS_SUB=0==GRP_CALLIST.owncLst[uid].IS_SUB?1:0);if(GRP_CALLIST.shdcLst&&GRP_CALLIST.shdcLst[uid])return void(GRP_CALLIST.shdcLst[uid].IS_SUB=0==GRP_CALLIST.shdcLst[uid].IS_SUB?1:0);GRP_CALLIST.subcLst&&GRP_CALLIST.subcLst[uid]&&(GRP_CALLIST.subcLst[uid].IS_SUB=0==GRP_CALLIST.subcLst[uid].IS_SUB?1:0)}};var _processUnsubscribeSts=function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var _gtabDOM,_stab,id=_robj.id,uid=_robj.uid;$.publish("/calendar/deleted",{calid:id,caluid:uid,mode:"unsubscribe"}),updateGrpCalLst(uid);var _gtabDOM=$("#zcl_grpcallst_tabs"),_stab=_gtabDOM.find(".sel");listGroupCal("zcl_grpcal_sh"==_stab[0].id?"sh":"zcl_grpcal_sub"==_stab[0].id?"sub":"def")}else _zm.succErrMsg("e",_robj.status)},openGroupCalPopup=function(gid){var groupPPEle;ZCL_$("zcl_grpcallst_pp")||$("body").append("<div id='zcl_grpcallst_pp' class='zcl_ovr'/>"),groupPPEle=$("#zcl_grpcallst_pp"),groupPPEle.html('<div><div class="SC_filt_Tabs none" id="zcl_grpcallst_tabs"></div><div data-marker="loadingAnimation"></div><div id="zcl_heigGrp" ><ul class="SC_cal_groups SC_setInner zcl_ovr" id="zcl_grpcallst"/></div></div>'),$loadAnimationDOM=groupPPEle.find("[data-marker=loadingAnimation]").removeAttr("data-marker"),constGroupCalTabs();var options={title:GRP_NAME,mask:!0,drag:!1,ptr:"tright",pos:"center",style:{"min-width":"600px","max-width":"750px"},customClass:"SC_SetPop",closeaction:function(){$("#zcl_grpcallst_pp").remove(),zmsDialog.remove()}};zmsDialog.create("zcl_grpcallst_pp",options),zmComponent.loadingBand({container:$loadAnimationDOM[0],type:"pagination"}),$loadAnimationDOM.show(),$.when(fetchGroupCalList(gid)).then(function(){$loadAnimationDOM.hide(),listGroupCal("def")})},bindTabClickEvent=function(tab,tabType){tab.off("click").on("click",{type:tabType},function(ev){var $ele=$(this);$ele.parent().find("a").removeClass("sel"),$ele.addClass("sel"),listGroupCal(ev.data.type)})},constGroupCalTabs=function(){for(var _tabDOM=$("#zcl_grpcallst_tabs"),defTab="def",_tabs=[{type:"def",text:zcal.i18n.default},{type:"sh",text:zcal.i18n.shared},{type:"sub",text:zcal.i18n.subscribed}],i=0;i<_tabs.length;i++){var tab=$('<a id="zcl_grpcal_'+_tabs[i].type+'"/>');tab.addClass(_tabs[i].type==defTab?"sel":""),tab.text(_tabs[i].text),bindTabClickEvent(tab,_tabs[i].type),_tabDOM.append(tab)}},listGroupCal=function(type){var calList,_calDOM=$("#zcl_grpcallst");if(calList="sh"==type?GRP_CALLIST.shdcLst:"sub"==type?GRP_CALLIST.subcLst:GRP_CALLIST.owncLst,_calDOM.empty(),Object.keys(GRP_CALLIST.shdcLst).length>5&&$("#zcl_heigGrp").css({height:"300px","overflow-x":"hidden","overflow-y":"auto"}),ZCL_isEmpty(calList)){if(_calDOM.is(":empty")){var liDOM=$("<li><em>"+zcal.i18n.nocalendar+"</em></li>");_calDOM.append(liDOM)}}else for(var i in calList){var _cal=calList[i],liDOM=$("<li/>"),lStr="";lStr+="<span>"+_cal.CNAME,lStr+=0==_cal.IS_SUB?'<span class="button" data-marker="sub">'+zcal.i18n.subscribe+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</span>",liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",{uid:i,gid:GRP_CALLIST.comid},function(ev){subscribeCal(ev.data.uid,ev.data.gid)});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&unsubDOM.on("click",{uid:i},function(ev){unsubscribeCal(ev.data.uid)}),_calDOM.append(liDOM)}},subscribeCal=function(calUId,gid){var f="/cal/subCal.do?mode=grpcal-sub&caluid="+encodeURIComponent(calUId)+"&grpid="+gid;ZCL_XHR(f,_processSubscribeSts)},unsubscribeCal=function(uid){ZCL_XHR("/cal/calAct.do?mode=delByUid&caluid="+encodeURIComponent(uid),_processUnsubscribeSts)},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),updatePreviewContent()},_show=function(){zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&_constructViews()},_destructViews=function(){groupHeaderDOM.remove(),groupContentDOM.remove()},_close=function(){currentView="personal",_destructViews(),zmailSettings.currentAppName=void 0};return zcalgrplist.init=_show,zcalgrplist.clearTrace=_close,zcalgrplist}(zcalSettings.zcalGroupList),zcalSettings.appList=function(zcalapps){zcalapps=zcalapps||{};var appsHeaderDOM,appsContentDOM,previewHeaderDOM,previewContentDOM,$loadAnimationDOM,zprojPortals,crmSyncObj,recruitSyncObj,taskSyncObj,SETTINGS_APP_ID="settings",appStatus={},_getAppsList=function(){return{zcrm:{text:ZCL_replaceComName(zcal.i18n.zohocrm),msg:zcal.i18n.sync,type:"crm",click:function(){updatePreviewContent()}},zrecruit:{text:ZCL_replaceComName(zcal.i18n.zohorecruit),msg:zcal.i18n.sync,type:"recruit",click:function(){updatePreviewContent()}},ztask:{text:ZCL_replaceComName(zcal.i18n.zohotask),msg:zcal.i18n.sync,type:"task-sync",click:function(){updatePreviewContent()}},zprojects:{text:ZCL_replaceComName(zcal.i18n.zohoprojects),msg:zcal.i18n.subscribe,type:"project",click:function(){updatePreviewContent()}},zcontacts:{text:ZCL_replaceComName(zcal.i18n.zohocontacts),msg:zcal.i18n.subscribe,type:"contacts",click:function(){updatePreviewContent()}}}},updatePreviewHeader=function(){appsHeaderDOM=$('<div class="SC_settHead"><div class="SC_phd">'+ZCL_replaceComName(zcal.i18n.zohoapps)+"</div></div>"),previewHeaderDOM.append(appsHeaderDOM)},updatePreviewContent=function(){appsContentDOM=$('<div class="SC_setInner"><div class="SC_filt_bottom"><ul class="SC_cal_groups"/></div></div>');var contentDOM=appsContentDOM.find(".SC_cal_groups"),appsList=_getAppsList();for(var i in appsList){var listDOM,app=appsList[i];("crm"==app.type&&""!=zcal.ZCRM||"recruit"==app.type&&""!=zcal.ZRECRUIT||"task-sync"==app.type&&""!=zcal.ZTSK||"project"==app.type||"contacts"==app.type)&&(listDOM=$("error"===appStatus[app.type]?'<li class="zcl_disable"/>':"<li/>"),listDOM.html("<span>"+app.text+"</span><em>"+app.msg+"</em>"),listDOM.hasClass("zcl_disable")||listDOM.on("click",{type:app.type,txt:app.text},function(ev){openAppCalPopup(ev.data.type,ev.data.txt)}),contentDOM.append(listDOM))}previewContentDOM.empty().append(appsContentDOM)},openAppCalPopup=function(type,txt){var appPPEle;ZCL_$("zcl_appcallst_pp")||$("body").append("<div id='zcl_appcallst_pp' class='zcl_ovr'/>"),appPPEle=$("#zcl_appcallst_pp"),appPPEle.html('<div><div data-marker="loadingAnimation"></div><div><ul class="SC_cal_groups SC_setInner zcl_ovr" id="zcl_appcallst" data-app="'+type+'"/></div></div>'),$loadAnimationDOM=appPPEle.find("[data-marker=loadingAnimation]").removeAttr("data-marker");var option={title:txt,mask:!0,drag:!1,ptr:"tright",pos:"center",style:{"min-width":"600px","max-width":"750px"},customClass:"SC_SetPop",closeaction:function(){$("#zcl_appcallst_pp").remove(),zmsDialog.remove()}};zmsDialog.create("zcl_appcallst_pp",option),zmComponent.loadingBand({container:$loadAnimationDOM[0],type:"pagination"}),$loadAnimationDOM.show(),ZCL_uXHR("/cal/getPortal.do?mode="+type,function(res){$loadAnimationDOM.hide(),_processAppRes(type,res)})},_processAppRes=function(type,res){if("contacts"==type){var contObj=res.getElementsByTagName("status")[0].firstChild.nodeValue;if("ok"==contObj)listContactsCal();else{appStatus.contacts="error";var _alrtMsg="503"==contObj?zcal.i18n.subscribeunavailable:ZCL_replaceComName(zcal.i18n.noacc_inzcontact);showErrorMsg(_alrtMsg)}}else if("task-sync"==type)if(taskSyncObj=ZCL_Evl(1,res.getElementsByTagName("obj")[0].firstChild.nodeValue),"in-process"==taskSyncObj.status||"success"==taskSyncObj.status)listTaskCal();else{appStatus.task="error";var _alrtMsg="503"==taskSyncObj?zcal.i18n.subscribeunavailable:ZCL_replaceComName(zcal.i18n.noacc_inztask);showErrorMsg(_alrtMsg)}else if("project"==type){var portalObj=res.getElementsByTagName("obj")[0].firstChild.nodeValue;if("503"!=portalObj&&"Empty result set"!=portalObj&&"error"!=portalObj)zprojPortals=ZCL_Evl(1,portalObj),listProjectsCal();else{appStatus.project="error";var _alrtMsg="503"==portalObj?zcal.i18n.subscribeunavailable:ZCL_replaceComName(zcal.i18n.noacc_inzproject);showErrorMsg(_alrtMsg)}}else if("crm"==type)if(crmSyncObj=ZCL_Evl(1,res.getElementsByTagName("obj")[0].firstChild.nodeValue),"in-process"==crmSyncObj.status||"success"==crmSyncObj.status)listCrmCal();else{appStatus.crm="error";var _alrtMsg="503"==crmSyncObj.status?zcal.i18n.subscribeunavailable:ZCL_replaceComName("sync-noperm"==crmSyncObj.status?zcal.i18n.crmcal_noperm:zcal.i18n.noacc_inzcrm);showErrorMsg(_alrtMsg)}else if("recruit"==type){recruitSyncObj=ZCL_Evl(1,res.getElementsByTagName("obj")[0].firstChild.nodeValue);{recruitSyncObj.obj.VERSION}if("503"!=recruitSyncObj.obj&&"error"!=recruitSyncObj.obj)listRecruitCal();else{appStatus.recruit="error";var _alrtMsg="503"==recruitSyncObj.obj?zcal.i18n.subscribeunavailable:ZCL_replaceComName(zcal.i18n.noacc_inzrecruit);showErrorMsg(_alrtMsg)}}},showErrorMsg=function(msg){var _calDOM=$("#zcl_appcallst").parent();_calDOM.empty(),_calDOM.append(msg),updatePreviewContent()},listContactsCal=function(){var _calDOM=$("#zcl_appcallst");_calDOM.empty();var liDOM=$("<li/>"),lStr="";lStr+="<span>"+zcal.i18n.contactscal,lStr+=-1==zcal.cdata.calOUids.indexOf("zohoContacts_")?'<span class="button" data-marker="sub">'+zcal.i18n.subscribe+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</span>",liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",function(){ZCL_XHR("/cal/subCal.do?mode=contactcal-sub",_processSubscribeSts)});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");if(unsubDOM.length){var s=zcal.cdata.calOUids.substring(zcal.cdata.calOUids.indexOf("zohoContacts_"));s=-1!=s.indexOf(",")?s.substring(0,s.indexOf(",")):s,unsubDOM.on("click",{uid:s,mode:"contacts"},function(ev){unsubscribeCal(ev.data.uid,ev.data.mode)})}_calDOM.append(liDOM)},listTaskCal=function(){var _calDOM=$("#zcl_appcallst");_calDOM.empty();var liDOM=$("<li/>"),lStr="";lStr+="<span>"+ZCL_replaceComName(zcal.i18n.zohotask),lStr+=-1==zcal.cdata.calOUids.indexOf("zohoTask_")?'<span class="button" data-marker="sub">'+zcal.i18n.synchronize+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+(taskSyncObj.isOldTaskSubscribed?zcal.i18n.unsubscribe:zcal.i18n.unsynchronize)+"</span>",lStr+="</span>","in-process"==taskSyncObj.status&&(liDOM.addClass("zcl_disls"),lStr+='<s id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</s>"),liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",function(){ZCL_XHR("/cal/subCal.do?mode=task-sync",_processSubscribeSts)});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");if(unsubDOM.length){var s=zcal.cdata.calOUids.substring(zcal.cdata.calOUids.indexOf("zohoTask_"));s=-1!=s.indexOf(",")?s.substring(0,s.indexOf(",")):s,unsubDOM.on("click",{uid:s,mode:"task"},function(ev){unsubscribeCal(ev.data.uid,ev.data.mode)})}_calDOM.append(liDOM)},listProjectsCal=function(){var _calDOM=$("#zcl_appcallst"),portals=zprojPortals;_calDOM.empty();for(var i in portals){var liDOM=$("<li/>"),lStr="";lStr+="<span>"+ZCL_getHTML(portals[i].portal),lStr+=-1==zcal.cdata.calOUids.indexOf("zohoProject_"+portals[i].portal_zoid)?'<span class="button" data-marker="sub">'+zcal.i18n.subscribe+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</span>",liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",function(){ZCL_XHR("/cal/subCal.do?mode=project-sub&portal="+portals[i].portal+"&portalId="+encodeURIComponent(portals[i].portal_zoid),_processSubscribeSts)});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&unsubDOM.on("click",{uid:"zohoProject_"+portals[i].portal_zoid,mode:"project"},function(ev){unsubscribeCal(ev.data.uid,ev.data.mode)}),_calDOM.append(liDOM)}},setSyncStatus=function(_calDOM){var statusEle,syncalEle=_calDOM.find("#zcl_synccal");0==_calDOM.find("#zcl_syncstatus").length&&syncalEle.after($('<s id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</s>")),statusEle=_calDOM.find("#zcl_syncstatus"),statusEle.parent().addClass("zcl_disls"),syncalEle.find("span.button").off("click")},listCrmCal=function(){var _calDOM=$("#zcl_appcallst");if(_calDOM.length>0){_calDOM.empty();var liDOM=$("<li/>"),lStr="";lStr+='<span id="zcl_synccal">'+ZCL_replaceComName(zcal.i18n.crmcal),lStr+=-1==zcal.cdata.calOUids.indexOf("zohoCrm_")?'<span class="button" data-marker="sub">'+zcal.i18n.synchronize+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsynchronize+"</span>",lStr+="</span>","in-process"==crmSyncObj.status&&(liDOM.addClass("zcl_disls"),lStr+='<s id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</s>"),liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.off("click").on("click",{soid:crmSyncObj.obj.ZSOID},function(ev){setSyncStatus(_calDOM),ZCL_XHR("/cal/subCal.do?mode=crm-sync&crmid="+ev.data.soid,_processCRMSubscribeSts)});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");if(unsubDOM.length){var s=zcal.cdata.calOUids.substring(zcal.cdata.calOUids.indexOf("zohoCrm_"));s=-1!=s.indexOf(",")?s.substring(0,s.indexOf(",")):s,unsubDOM.off("click").on("click",{uid:s,mode:"crm"},function(ev){unsubscribeCal(ev.data.uid,ev.data.mode)})}_calDOM.append(liDOM)}},listRecruitCal=function(){var _calDOM=$("#zcl_appcallst"),recruitVersion=recruitSyncObj.obj.VERSION;_calDOM.empty();var liDOM=$("<li/>"),lStr="";lStr+="<span>"+ZCL_replaceComName(zcal.i18n.recruitcal),lStr+="new"==recruitVersion?-1==zcal.cdata.calOUids.indexOf("zohoRecruit4_")?'<span class="button" data-marker="sub">'+zcal.i18n.synchronize+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsynchronize+"</span>":-1==zcal.cdata.calOUids.indexOf("zohoRecruit_")?'<span class="button" data-marker="sub">'+zcal.i18n.subscribe+"</span>":'<span class="button zcl_vis" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</span>",liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.off("click").on("click",{soid:recruitSyncObj.obj.ZSOID},function(ev){ZCL_XHR("/cal/subCal.do?mode=recruitcal-sub&recid="+ev.data.soid,_processSubscribeSts)});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");if(unsubDOM.length){var s=zcal.cdata.calOUids.substring(zcal.cdata.calOUids.indexOf("zohoRecruit"));s=-1!=s.indexOf(",")?s.substring(0,s.indexOf(",")):s,unsubDOM.on("click",{uid:s,mode:"recruit"},function(ev){unsubscribeCal(ev.data.uid,ev.data.mode)})}_calDOM.append(liDOM)},_processCRMSubscribeSts=function(res){if(ZCL_clrStck(),200==res.status){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){if("sync-initiated"==_robj.sync_mode)"in-process"==_robj.sync_status?crmSyncObj.status=_robj.sync_status:(crmSyncObj.status="success",setTimeout(function(){_zm.succErrMsg("s",zcal.i18n.synccompmsg)},2e3));else if("success"==_robj.sync_status){crmSyncObj.status=_robj.sync_status;var obj=_robj.obj;zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,zcal.cdata.calALst=obj.aclst,zcal.ZCRM_OBJ=obj.crmOrgObj,ZCL_updateAppCalList(obj.aclst),setTimeout(function(){_zm.succErrMsg("s",zcal.i18n.synccompmsg)},2e3),zcalCRM.loadCRMUsers()}else"in-process"==_robj.sync_status?crmSyncObj.status=_robj.sync_status:setTimeout(function(){_zm.succErrMsg("e",ZCL_replaceComName(zcal.i18n.crmcal_syncfailed))},2e3);listCrmCal(),$.publish("/calendar/subscribed")}else setTimeout(function(){_zm.succErrMsg("e",ZCL_replaceComName(zcal.i18n.crmcal_syncfailed))},2e3)}},_processSubscribeSts=function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){{var obj=_robj.obj,mode=_robj.mode;_robj.uid}zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,zcal.cdata.calALst=obj.aclst,ZCL_updateAppCalList(obj.aclst),"contactcal-sub"===mode?(_zm.succErrMsg("s",zcal.i18n.calSubSuccess),listContactsCal()):"project-sub"===mode?(_zm.succErrMsg("s",zcal.i18n.calSubSuccess),listProjectsCal()):"task-sync"===mode?("completed"==_robj.sync_status?(taskSyncObj.status="success",_zm.succErrMsg("s",zcal.i18n.synccompmsg)):"in-process"==_robj.sync_status&&(taskSyncObj.status="in-process"),listTaskCal()):"recruitcal-sub"==mode&&(_zm.succErrMsg("s",zcal.i18n.synccompmsg),listRecruitCal()),$.publish("/calendar/subscribed")}},_processUnsubscribeSts=function(res,type){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var id=_robj.id,uid=_robj.uid;$.publish("/calendar/deleted",{calid:id,caluid:uid,mode:"unsubscribe"}),"contacts"===type?listContactsCal():"project"===type?listProjectsCal():"task"===type?listTaskCal():"crm"===type?listCrmCal():"recruit"===type&&listRecruitCal()}else _zm.succErrMsg("e",_robj.status)},unsubscribeCal=function(uid,type){ZCL_XHR("/cal/calAct.do?mode=delByUid&caluid="+encodeURIComponent(uid),function(res){_processUnsubscribeSts(res,type)})},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),updatePreviewContent()},_show=function(){zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&_constructViews()},_destructViews=function(){appsHeaderDOM.remove(),appsContentDOM.remove()},_close=function(){_destructViews(),zmailSettings.currentAppName=void 0},_setCrmSyncStatus=function(syncStatus){crmSyncObj.status=syncStatus},_setCrmSyncFailedStatus=function(){crmSyncObj.status="success",_zm.succErrMsg("e",ZCL_replaceComName(zcal.i18n.crmcal_syncfailed)),listCrmCal()},_setTaskSyncStatus=function(syncStatus){taskSyncObj.status=syncStatus};return zcalapps.init=_show,zcalapps.clearTrace=_close,zcalapps.setCrmSyncStatus=_setCrmSyncStatus,zcalapps.setCrmSyncFailedStatus=_setCrmSyncFailedStatus,zcalapps.listCrmCal=listCrmCal,zcalapps.listTaskCal=listTaskCal,zcalapps.listRecruitCal=listRecruitCal,zcalapps.setTaskSyncStatus=_setTaskSyncStatus,zcalapps}(zcalSettings.appList||{}),zcalSettings.ownCalList=function(owncallist){owncallist=owncallist||{};var listHeaderDOM,listContentDOM,listDOM,previewHeaderDOM,previewContentDOM,customData,calOrder,calLst,SETTINGS_APP_ID="settings",scrollAreaTop="106px",updatePreviewHeader=function(){listHeaderDOM=$('<div class="SC_settHead"><div class="SC_phd">'+zcal.i18n.mycalendars+"</div></div>"),previewHeaderDOM.append(listHeaderDOM)},updatePreviewContent=function(){if(calOrder=zcal.cdata.calOrdArr,calLst=zcal.cdata.calLst,listDOM.empty(),calOrder.forEach(function(id){calLst[id]&&listCalendar(id,calLst[id])}),customData&&"share"===customData.action){var calDOM,$ele,calid=customData.id;calDOM=listContentDOM.find("[data-id="+calid+"]"),calDOM.length>0&&($ele=calDOM.find("[data-id=sh]"),_openShare($ele,calDOM,calid,calLst[calid]))}},listCalendar=function(id,cObj){var $details,$share,$exp,$empty,$del,$sts,$edit,calDOM=$('<div class="zmL '+(1==cObj[8]?"":"disableFilter")+'" data-id="'+id+'"><ul></ul></div>'),color=ZCL_getCalColor(cObj[1])[1],cname=ZCL_getHTML(cObj[0]),cbxDOM=$('<li><div style="background-color:'+color+'" class="SClbl"><i class="'+(1==cObj[2]?"msi-tick":"")+'"></i></div></li>');$sts=cbxDOM.find(".SClbl"),$sts.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_ChgCalSts(calid)}),calDOM.find("ul").append(cbxDOM);var nmDOM=$('<li><strong class="filterControl">'+cname+"<b></b></strong></li>"),actDOM=nmDOM.find("b");$details=$('<span data-id="det">'+zcal.i18n.details+"</span>"),$details.off("click").on("click",{calid:id,cobj:cObj},function(ev){var cDetail,$ele=$(this);zcalDetails.close(),zcalShare.close(),$ele.closest("ul").attr("class","sel"),$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),cDetail=zcalDetails.render(ev.data.calid,ev.data.cobj),cDetail.insertAfter(calDOM)}),actDOM.append($details),$edit=$('<span data-id="edit">'+zcal.i18n.edit+"</span>"),$edit.off("click").on("click",{calId:id},function(ev){var cobj=zcal.getCalObj(ev.data.calId),calCol=cobj[1].split(":")[0],txtCol=cobj[1].split(":")[1];ZCL_openCalPopup({id:ev.data.calId,name:cobj[0],desc:cobj[4],color:calCol,txtcolor:txtCol})}),actDOM.append($edit),("0"!=zcal.shrCal||"0"!=zcal.pvtUrl)&&($share=$('<span data-id="sh">'+zcal.i18n.share+"</span>"),$share.off("click").on("click",{calid:id,cobj:cObj},function(ev){_openShare($(this),calDOM,ev.data.calid,ev.data.cobj)}),actDOM.append($share)),"0"!=zcal.impExp&&1==cObj[13][2]&&($exp=$('<span data-id="exp">'+zcal.i18n.exports+"</span>"),$exp.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){ZCL_formSubmit({ckey:ev.data.ckey,mode:"calexp"},"/cal/export.do","GET")}),actDOM.append($exp)),1==cObj[13][3]&&($empty=$('<span data-id="emp">'+zcal.i18n.empty+"</span>"),$empty.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_empCal(calid)}),actDOM.append($empty)),1==cObj[13][4]&&($del=$('<span data-id="del">'+zcal.i18n.del+"</span>"),$del.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_delCal(calid,!1)}),actDOM.append($del)),calDOM.find("ul").append(nmDOM);var stsDOM=$('<li><strong class="filterControl"><span class="filterSate"/></strong></li>');if("false"==cObj[3]){var bar=$("<div/>");bar.addClass(0==cObj[8]?"sdiv sadiv":"sdiv inctop"),bar.off("click").on("click",{calid:id},function(ev){var $ele=$(this),$parEle=$ele.parents(".zmL"),calid=ev.data.calid;ZCL_XHR("/cal/calAct.do?mode=sh-hde&calid="+calid+"&isshow="+($ele.hasClass("sadiv")?!0:!1),function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[8]=_robj.isshow?1:0,$ele.removeAttr("class").addClass(_robj.isshow?"sdiv inctop":"sdiv sadiv"),$parEle.removeAttr("class").addClass(_robj.isshow?"zmL":"zmL disableFilter"),$.publish("/calendar/visibilityChanged",{calid:calid,visibility:_robj.isshow}))})}),stsDOM.find(".filterSate").append(bar)}calDOM.find("ul").append(stsDOM),listDOM.append(calDOM)},_openShare=function($ele,calDOM,calid,cobj){zcalDetails.close(),zcalShare.close(),$ele.closest("ul").attr("class","sel"),$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl");var cShare=zcalShare.render(calid,cobj);cShare.insertAfter(calDOM)},_updCalSts=function(ev,data){{var $ele,calid=data.calid;data.sts}$ele=listContentDOM.find("[data-id="+calid+"]"),$ele.find("i").length>0&&$ele.find("i").removeAttr("class").addClass(1==data.sts?"msi-tick":"")},_delCal=function(ev,data){var calid=data.calid;$ele=listContentDOM.find("[data-id="+calid+"]"),$ele.length&&$ele.remove()},listContent=function(){var cntStr="<div>";return cntStr+='<div class="SC_filt_bottom SC_Calendar">',cntStr+='<div class="zmL SC_filt_bld">',cntStr+='<ul class="bld custom">',cntStr+="<li>&nbsp;</li>",cntStr+="<li>"+zcal.i18n.calname+"</li>",cntStr+="<li>"+zcal.i18n.status+"</li>",cntStr+="</ul>",cntStr+="</div>",cntStr+="</div>",cntStr+='<div style="bottom:0px;top:'+scrollAreaTop+';" class="SC_Twpr">',cntStr+='<div class="SC_filt_bottom SC_Calendar" id="zcl_callist"></div>',cntStr+="</div>",cntStr+="</div>"},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),previewContentDOM.removeClass("SC_Twpr").removeAttr("style"),listContentDOM=$(listContent()),listDOM=listContentDOM.find("#zcl_callist"),previewContentDOM.append(listContentDOM),updatePreviewContent()},_show=function(data){customData=data,zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&(_constructViews(),_subscribe())},_subscribe=function(){$.subscribe("/calendar/added",updatePreviewContent),$.subscribe("/calendar/updated",updatePreviewContent),$.subscribe("/calendar/deleted",owncallist.delCal),$.subscribe("/calendar/statusChanged",owncallist.updCalSts)},_destructViews=function(){listHeaderDOM.remove(),listContentDOM.remove(),calLst=void 0,previewContentDOM.addClass("SC_Twpr"),previewContentDOM.css("top","61px")},_unsubscribe=function(){$.unsubscribe("/calendar/added",updatePreviewContent),$.unsubscribe("/calendar/updated",updatePreviewContent),$.unsubscribe("/calendar/deleted",owncallist.delCal),$.unsubscribe("/calendar/statusChanged",owncallist.updCalSts)},_close=function(){_destructViews(),zmailSettings.currentAppName=void 0,_unsubscribe()};return owncallist.init=_show,owncallist.clearTrace=_close,owncallist.updCalSts=_updCalSts,owncallist.delCal=_delCal,owncallist}(zcalSettings.ownCalList||{}),zcalSettings.grpCalList=function(grpcallist){grpcallist=grpcallist||{};var listHeaderDOM,listContentDOM,listDOM,previewHeaderDOM,previewContentDOM,customData,calLst,SETTINGS_APP_ID="settings",scrollAreaTop="106px",updatePreviewHeader=function(){listHeaderDOM=$('<div class="SC_settHead"><div class="SC_phd">'+zcal.i18n.groupcalendars+"</div></div>"),previewHeaderDOM.append(listHeaderDOM)},updatePreviewContent=function(){calLst=zcal.cdata.calGLst,listDOM.empty();for(var i in calLst)listCalendar(i,calLst[i]);if(customData&&"share"===customData.action){var calDOM,$ele,calid=customData.id;calDOM=listContentDOM.find("[data-id="+calid+"]"),calDOM.length>0&&($ele=calDOM.find("[data-id=sh]"),_openShare($ele,calDOM,calid,calLst[calid]))}_updList()},_updList=function(){if(listDOM.is(":empty")){var $clkLnk;listDOM.html('<div class="SC_nmsg">No calendars found, <font>click here</font> to subscribe.</div>'),$("#zcl_callist_hdr").empty(),$clkLnk=listDOM.find("font"),$clkLnk.off("click").on("click",function(){zmailSettings.init("calendar","zcalSettings.zcalGroupList")}),$(listDOM.parent()).css("top","86px")}},listCalendar=function(id,cObj){var $details,$share,$unsub,$sts,$edit,calDOM=$('<div class="zmL '+(1==cObj[8]?"":"disableFilter")+'" data-id="'+id+'"><ul></ul></div>'),color=ZCL_getCalColor(cObj[1])[1],cname=ZCL_getHTML(cObj[0]),cbxDOM=$('<li><div style="background-color:'+color+'" class="SClbl"><i class="'+(1==cObj[2]?"msi-tick":"")+'"></i></div></li>');$sts=cbxDOM.find(".SClbl"),$sts.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_ChgCalSts(calid)}),calDOM.find("ul").append(cbxDOM);var nmDOM=$('<li><strong class="filterControl">'+cname+"<b></b></strong></li>"),actDOM=nmDOM.find("b");$details=$('<span data-id="det">'+zcal.i18n.details+"</span>"),$details.off("click").on("click",{calid:id,cobj:cObj},function(ev){var cDetail,$ele=$(this);zcalDetails.close(),zcalShare.close(),$ele.closest("ul").attr("class","sel"),$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),cDetail=zcalDetails.render(ev.data.calid,ev.data.cobj),cDetail.insertAfter(calDOM)}),actDOM.append($details),$edit=$('<span data-id="edit">'+zcal.i18n.edit+"</span>"),$edit.off("click").on("click",{calId:id},function(ev){var cobj=zcal.getCalObj(ev.data.calId),calCol=cobj[1].split(":")[0],txtCol=cobj[1].split(":")[1];ZCL_openCalPopup({id:ev.data.calId,name:cobj[0],desc:cobj[4],color:calCol,txtcolor:txtCol})}),actDOM.append($edit),(0!=cObj[13][0]||0!=cObj[13][7])&&($share=$('<span data-id="sh">'+zcal.i18n.share+"</span>"),$share.off("click").on("click",{calid:id,cobj:cObj},function(ev){_openShare($(this),calDOM,ev.data.calid,ev.data.cobj)}),actDOM.append($share)),1==cObj[13][5]&&($unsub=$('<span data-id="del">'+zcal.i18n.unsubscribe+"</span>"),$unsub.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_delCal(calid,!0)}),actDOM.append($unsub)),calDOM.find("ul").append(nmDOM);var stsDOM=$('<li><strong class="filterControl"><span class="filterSate"/></strong></li>');if("false"==cObj[3]){var bar=$("<div/>");bar.addClass(0==cObj[8]?"sdiv sadiv":"sdiv inctop"),bar.off("click").on("click",{calid:id},function(ev){var $ele=$(this),$parEle=$ele.parents(".zmL"),calid=ev.data.calid;ZCL_XHR("/cal/calAct.do?mode=sh-hde&calid="+calid+"&isshow="+($ele.hasClass("sadiv")?!0:!1),function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[8]=_robj.isshow?1:0,$ele.removeAttr("class").addClass(_robj.isshow?"sdiv inctop":"sdiv sadiv"),$parEle.removeAttr("class").addClass(_robj.isshow?"zmL":"zmL disableFilter"),$.publish("/calendar/visibilityChanged",{calid:calid,visibility:_robj.isshow}))})}),stsDOM.find(".filterSate").append(bar)}calDOM.find("ul").append(stsDOM),listDOM.append(calDOM)},_openShare=function($ele,calDOM,calid,cobj){zcalDetails.close(),zcalShare.close(),$ele.closest("ul").attr("class","sel"),$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl");var cShare=zcalShare.render(calid,cobj);cShare.insertAfter(calDOM)},_updCalSts=function(ev,data){{var $ele,calid=data.calid;data.sts}$ele=listContentDOM.find("[data-id="+calid+"]"),$ele.find("i").length>0&&$ele.find("i").removeAttr("class").addClass(1==data.sts?"msi-tick":"")},_delCal=function(ev,data){var calid=data.calid;$ele=listContentDOM.find("[data-id="+calid+"]"),$ele.length&&$ele.remove(),_updList()},listContent=function(){var cntStr="<div>";return cntStr+='<div class="SC_filt_bottom SC_Calendar" id="zcl_callist_hdr">',cntStr+='<div class="zmL SC_filt_bld">',cntStr+='<ul class="bld custom">',cntStr+="<li>&nbsp;</li>",cntStr+="<li>"+zcal.i18n.calname+"</li>",cntStr+="<li>"+zcal.i18n.status+"</li>",cntStr+="</ul>",cntStr+="</div>",cntStr+="</div>",cntStr+='<div style="bottom:0px;top:'+scrollAreaTop+';" class="SC_Twpr">',cntStr+='<div class="SC_filt_bottom SC_Calendar" id="zcl_callist"></div>',cntStr+="</div>",cntStr+="</div>"},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),previewContentDOM.removeClass("SC_Twpr").removeAttr("style"),listContentDOM=$(listContent()),listDOM=listContentDOM.find("#zcl_callist"),previewContentDOM.append(listContentDOM),updatePreviewContent()},_show=function(data){customData=data,zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&(_constructViews(),_subscribe())},_subscribe=function(){$.subscribe("/calendar/subscribed",updatePreviewContent),$.subscribe("/calendar/updated",updatePreviewContent),$.subscribe("/calendar/deleted",grpcallist.delCal),$.subscribe("/calendar/statusChanged",grpcallist.updCalSts)},_destructViews=function(){listHeaderDOM.remove(),listContentDOM.remove(),calLst=void 0,previewContentDOM.addClass("SC_Twpr"),previewContentDOM.css("top","61px")},_unsubscribe=function(){$.unsubscribe("/calendar/subscribed",updatePreviewContent),$.unsubscribe("/calendar/updated",updatePreviewContent),$.unsubscribe("/calendar/deleted",grpcallist.delCal),$.unsubscribe("/calendar/statusChanged",grpcallist.updCalSts)},_close=function(){_destructViews(),zmailSettings.currentAppName=void 0,_unsubscribe()};return grpcallist.init=_show,grpcallist.clearTrace=_close,grpcallist.updCalSts=_updCalSts,grpcallist.delCal=_delCal,grpcallist}(zcalSettings.grpCalList||{}),zcalSettings.appCalList=function(appcallist){appcallist=appcallist||{};var listHeaderDOM,listContentDOM,listDOM,previewHeaderDOM,previewContentDOM,customData,calLst,SETTINGS_APP_ID="settings",scrollAreaTop="106px",updatePreviewHeader=function(){listHeaderDOM=$('<div class="SC_settHead"><div class="SC_phd">'+zcal.i18n.appcalendars+"</div></div>"),previewHeaderDOM.append(listHeaderDOM)},updatePreviewContent=function(){calLst=zcal.cdata.calALst,listDOM.empty();for(var i in calLst)listCalendar(i,calLst[i]);if(customData&&"share"===customData.action){var calDOM,$ele,calid=customData.id;calDOM=listContentDOM.find("[data-id="+calid+"]"),calDOM.length>0&&($ele=calDOM.find("[data-id=sh]"),_openShare($ele,calDOM,calid,calLst[calid]))}_updList()},_updList=function(){if(listDOM.is(":empty")){listDOM.html('<div class="SC_nmsg">'+zcal.i18n.noappcal+"</div>"),$("#zcl_callist_hdr").empty(),$(listDOM.parent()).css("top","86px")}},ZCL_mUpd=function(c){var f=1==zcal.CALMODE?"/cal/gsubCal.do?&grpid="+ZCL_ZGID+"&mode=userUpd&calid="+c:"/cal/subCal.do?mode=userUpd&calid="+c;ZCL_XHR(f,function(){ZCL_setCalendars(),zcalEvents.loadMonthData(),zmUtil.succErrMsg("s",zcal.i18n.updatedsuccessfully)})},listCalendar=function(id,cObj){var $details,$share,$unsub,$sts,$update,$edit,calDOM=$('<div class="zmL '+(1==cObj[8]?"":"disableFilter")+'" data-id="'+id+'"><ul></ul></div>'),color=ZCL_getCalColor(cObj[1])[1],cname=ZCL_getHTML(cObj[0]),cbxDOM=$('<li><div style="background-color:'+color+'" class="SClbl"><i class="'+(1==cObj[2]?"msi-tick":"")+'"></i></div></li>');$sts=cbxDOM.find(".SClbl"),$sts.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_ChgCalSts(calid)}),calDOM.find("ul").append(cbxDOM);var nmDOM=$('<li><strong class="filterControl">'+cname+"<b></b></strong></li>"),actDOM=nmDOM.find("b");$details=$('<span data-id="det">'+zcal.i18n.details+"</span>"),$details.off("click").on("click",{calid:id,cobj:cObj},function(ev){var cDetail,$ele=$(this);zcalDetails.close(),zcalShare.close(),$ele.closest("ul").attr("class","sel"),$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),cDetail=zcalDetails.render(ev.data.calid,ev.data.cobj),cDetail.insertAfter(calDOM)}),actDOM.append($details),$edit=$('<span data-id="edit">'+zcal.i18n.edit+"</span>"),$edit.off("click").on("click",{calId:id},function(ev){var cobj=zcal.getCalObj(ev.data.calId),calCol=cobj[1].split(":")[0],txtCol=cobj[1].split(":")[1];ZCL_openCalPopup({id:ev.data.calId,name:cobj[0],desc:cobj[4],color:calCol,txtcolor:txtCol})}),actDOM.append($edit),(0!=cObj[13][0]||0!=cObj[13][7])&&($share=$('<span data-id="sh">'+zcal.i18n.share+"</span>"),$share.off("click").on("click",{calid:id,cobj:cObj},function(ev){_openShare($(this),calDOM,ev.data.calid,ev.data.cobj)}),actDOM.append($share)),1==cObj[13][5]&&($unsub=$('<span data-id="del">'+zcal.i18n.unsubscribe+"</span>"),$unsub.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_delCal(calid,!0)}),actDOM.append($unsub)),(2==cObj[5]||5==cObj[5]&&("zcontacts"==cObj[14]||"zprojects"==cObj[14]))&&($update=$('<span data-id="upd">'+zcal.i18n.update+"</span>"),$update.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_mUpd(calid)}),actDOM.append($update)),calDOM.find("ul").append(nmDOM);var stsDOM=$('<li><strong class="filterControl"><span class="filterSate"/></strong></li>');if("false"==cObj[3]){var bar=$("<div/>");bar.addClass(0==cObj[8]?"sdiv sadiv":"sdiv inctop"),bar.off("click").on("click",{calid:id},function(ev){var $ele=$(this),$parEle=$ele.parents(".zmL"),calid=ev.data.calid;ZCL_XHR("/cal/calAct.do?mode=sh-hde&calid="+calid+"&isshow="+($ele.hasClass("sadiv")?!0:!1),function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[8]=_robj.isshow?1:0,$ele.removeAttr("class").addClass(_robj.isshow?"sdiv inctop":"sdiv sadiv"),$parEle.removeAttr("class").addClass(_robj.isshow?"zmL":"zmL disableFilter"),$.publish("/calendar/visibilityChanged",{calid:calid,visibility:_robj.isshow}))})}),stsDOM.find(".filterSate").append(bar)}calDOM.find("ul").append(stsDOM),listDOM.append(calDOM)},_openShare=function($ele,calDOM,calid,cobj){zcalDetails.close(),zcalShare.close(),$ele.closest("ul").attr("class","sel"),$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl");var cShare=zcalShare.render(calid,cobj);cShare.insertAfter(calDOM)},_updCalSts=function(ev,data){{var $ele,calid=data.calid;data.sts}$ele=listContentDOM.find("[data-id="+calid+"]"),$ele.find("i").length>0&&$ele.find("i").removeAttr("class").addClass(1==data.sts?"msi-tick":"")},_delCal=function(ev,data){var calid=data.calid;$ele=listContentDOM.find("[data-id="+calid+"]"),$ele.length&&$ele.remove(),_updList()},listContent=function(){var cntStr="<div>";return cntStr+='<div class="SC_filt_bottom SC_Calendar" id="zcl_callist_hdr">',cntStr+='<div class="zmL SC_filt_bld">',cntStr+='<ul class="bld custom">',cntStr+="<li>&nbsp;</li>",cntStr+="<li>"+zcal.i18n.calname+"</li>",cntStr+="<li>"+zcal.i18n.status+"</li>",cntStr+="</ul>",cntStr+="</div>",cntStr+="</div>",cntStr+='<div style="bottom:0px;top:'+scrollAreaTop+';" class="SC_Twpr">',cntStr+='<div class="SC_filt_bottom SC_Calendar" id="zcl_callist"></div>',cntStr+="</div>",cntStr+="</div>"},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),previewContentDOM.removeClass("SC_Twpr").removeAttr("style"),listContentDOM=$(listContent()),listDOM=listContentDOM.find("#zcl_callist"),previewContentDOM.append(listContentDOM),updatePreviewContent()},_show=function(data){customData=data,zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&(_constructViews(),_subscribe())},_subscribe=function(){$.subscribe("/calendar/subscribed",updatePreviewContent),$.subscribe("/calendar/updated",updatePreviewContent),$.subscribe("/calendar/deleted",appcallist.delCal),$.subscribe("/calendar/statusChanged",appcallist.updCalSts)},_destructViews=function(){listHeaderDOM.remove(),listContentDOM.remove(),calLst=void 0,previewContentDOM.addClass("SC_Twpr"),previewContentDOM.css("top","61px")},_unsubscribe=function(){$.unsubscribe("/calendar/subscribed",updatePreviewContent),$.unsubscribe("/calendar/updated",updatePreviewContent),$.unsubscribe("/calendar/deleted",appcallist.delCal),$.unsubscribe("/calendar/statusChanged",appcallist.updCalSts)},_close=function(){_destructViews(),zmailSettings.currentAppName=void 0,_unsubscribe()};return appcallist.init=_show,appcallist.clearTrace=_close,appcallist.updCalSts=_updCalSts,appcallist.delCal=_delCal,appcallist}(zcalSettings.appCalList||{}),zcalSettings.othCalList=function(othcallist){othcallist=othcallist||{};var listHeaderDOM,listContentDOM,listDOM,previewHeaderDOM,previewContentDOM,customData,calLst,SETTINGS_APP_ID="settings",scrollAreaTop="106px",updatePreviewHeader=function(){listHeaderDOM=$('<div class="SC_settHead"><div class="SC_phd">'+zcal.i18n.othercalendars+"</div></div>"),previewHeaderDOM.append(listHeaderDOM)},updatePreviewContent=function(){calLst=zcal.cdata.calOLst,listDOM.empty();for(var i in calLst)listCalendar(i,calLst[i]);if(customData&&"share"===customData.action){var calDOM,$ele,calid=customData.id;calDOM=listContentDOM.find("[data-id="+calid+"]"),calDOM.length>0&&($ele=calDOM.find("[data-id=sh]"),_openShare($ele,calDOM,calid,calLst[calid]))}_updList()},_updList=function(){if(listDOM.is(":empty")){var $clkLnk;listDOM.html('<div class="SC_nmsg">No calendars found, <font>click here</font> to subscribe.</div>'),$("#zcl_callist_hdr").empty(),$clkLnk=listDOM.find("font"),$clkLnk.off("click").on("click",function(){zmailSettings.init("calendar","zcalSettings.Subscribe")}),$(listDOM.parent()).css("top","86px")}},listCalendar=function(id,cObj){var $details,$share,$exp,$unsub,$sts,$update,$edit,calDOM=$('<div class="zmL '+(1==cObj[8]?"":"disableFilter")+'" data-id="'+id+'"><ul></ul></div>'),color=ZCL_getCalColor(cObj[1])[1],cname=ZCL_getHTML(cObj[0]),cbxDOM=$('<li><div style="background-color:'+color+'" class="SClbl"><i class="'+(1==cObj[2]?"msi-tick":"")+'"></i></div></li>');$sts=cbxDOM.find(".SClbl"),$sts.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_ChgCalSts(calid)}),calDOM.find("ul").append(cbxDOM);var nmDOM=$('<li><strong class="filterControl">'+cname+"<b></b></strong></li>"),actDOM=nmDOM.find("b");$details=$('<span data-id="det">'+zcal.i18n.details+"</span>"),$details.off("click").on("click",{calid:id,cobj:cObj},function(ev){var cDetail,$ele=$(this);zcalDetails.close(),zcalShare.close(),$ele.closest("ul").attr("class","sel"),$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),cDetail=zcalDetails.render(ev.data.calid,ev.data.cobj),cDetail.insertAfter(calDOM)}),actDOM.append($details),$edit=$('<span data-id="edit">'+zcal.i18n.edit+"</span>"),$edit.off("click").on("click",{calId:id},function(ev){var cobj=zcal.getCalObj(ev.data.calId),calCol=cobj[1].split(":")[0],txtCol=cobj[1].split(":")[1];ZCL_openCalPopup({id:ev.data.calId,name:cobj[0],desc:cobj[4],color:calCol,txtcolor:txtCol})}),actDOM.append($edit),0!=cObj[13][0]&&"0"!=zcal.shrCal&&($share=$('<span data-id="sh">'+zcal.i18n.share+"</span>"),$share.off("click").on("click",{calid:id,cobj:cObj},function(ev){_openShare($(this),calDOM,ev.data.calid,ev.data.cobj)}),actDOM.append($share)),0!=cObj[13][2]&&($exp=$('<span data-id="exp">'+zcal.i18n.exports+"</span>"),$exp.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){ZCL_formSubmit({ckey:ev.data.ckey,mode:"calexp"},"/cal/export.do","GET")}),actDOM.append($exp)),1==cObj[13][5]&&($unsub=$('<span data-id="del">'+zcal.i18n.unsubscribe+"</span>"),$unsub.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_delCal(calid,!0)}),actDOM.append($unsub)),2==cObj[5]&&($update=$('<span data-id="upd">'+zcal.i18n.update+"</span>"),$update.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_mUpd(calid)}),actDOM.append($update)),calDOM.find("ul").append(nmDOM);var stsDOM=$('<li><strong class="filterControl"><span class="filterSate"/></strong></li>');if("false"==cObj[3]){var bar=$("<div/>");bar.addClass(0==cObj[8]?"sdiv sadiv":"sdiv inctop"),bar.off("click").on("click",{calid:id},function(ev){var $ele=$(this),$parEle=$ele.parents(".zmL"),calid=ev.data.calid;ZCL_XHR("/cal/calAct.do?mode=sh-hde&calid="+calid+"&isshow="+($ele.hasClass("sadiv")?!0:!1),function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[8]=_robj.isshow?1:0,$ele.removeAttr("class").addClass(_robj.isshow?"sdiv inctop":"sdiv sadiv"),$parEle.removeAttr("class").addClass(_robj.isshow?"zmL":"zmL disableFilter"),$.publish("/calendar/visibilityChanged",{calid:calid,visibility:_robj.isshow}))})}),stsDOM.find(".filterSate").append(bar)}calDOM.find("ul").append(stsDOM),listDOM.append(calDOM)},_openShare=function($ele,calDOM,calid,cobj){zcalDetails.close(),zcalShare.close(),$ele.closest("ul").attr("class","sel"),$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl");var cShare=zcalShare.render(calid,cobj);cShare.insertAfter(calDOM)},ZCL_mUpd=function(c){var f=1==zcal.CALMODE?"/cal/gsubCal.do?&grpid="+ZCL_ZGID+"&mode=userUpd&calid="+c:"/cal/subCal.do?mode=userUpd&calid="+c;ZCL_XHR(f,function(){ZCL_setCalendars(),zcalEvents.loadMonthData(),zmUtil.succErrMsg("s",zcal.i18n.updatedsuccessfully)})},_updCalSts=function(ev,data){{var $ele,calid=data.calid;data.sts}$ele=listContentDOM.find("[data-id="+calid+"]"),$ele.find("i").length>0&&$ele.find("i").removeAttr("class").addClass(1==data.sts?"msi-tick":"")},_delCal=function(ev,data){var calid=data.calid;$ele=listContentDOM.find("[data-id="+calid+"]"),$ele.length&&$ele.remove(),_updList()},listContent=function(){var cntStr="<div>";return cntStr+='<div class="SC_filt_bottom SC_Calendar" id="zcl_callist_hdr">',cntStr+='<div class="zmL SC_filt_bld">',cntStr+='<ul class="bld custom">',cntStr+="<li>&nbsp;</li>",cntStr+="<li>"+zcal.i18n.calname+"</li>",cntStr+="<li>"+zcal.i18n.status+"</li>",cntStr+="</ul>",cntStr+="</div>",cntStr+="</div>",cntStr+='<div style="bottom:0px;top:'+scrollAreaTop+';" class="SC_Twpr">',cntStr+='<div class="SC_filt_bottom SC_Calendar" id="zcl_callist"></div>',cntStr+="</div>",cntStr+="</div>"},_constructViews=function(){zmailSettings.views.showPreview();var $previewDOM=$(zmailSettings.views.getPreviewDOM());previewHeaderDOM=$previewDOM.find(".SC_ptit"),updatePreviewHeader(),previewContentDOM=$previewDOM.find(".SC_Twpr"),previewContentDOM.removeClass("SC_Twpr").removeAttr("style"),listContentDOM=$(listContent()),listDOM=listContentDOM.find("#zcl_callist"),previewContentDOM.append(listContentDOM),updatePreviewContent()},_show=function(data){customData=data,zmsuite.isWorkspaceAvailable(SETTINGS_APP_ID)&&(_constructViews(),_subscribe())},_subscribe=function(){$.subscribe("/calendar/deleted",othcallist.delCal),$.subscribe("/calendar/statusChanged",othcallist.updCalSts)},_destructViews=function(){listHeaderDOM.remove(),listContentDOM.remove(),calLst=void 0,previewContentDOM.addClass("SC_Twpr"),previewContentDOM.css("top","61px")},_unsubscribe=function(){$.unsubscribe("/calendar/deleted",othcallist.delCal),$.unsubscribe("/calendar/statusChanged",othcallist.updCalSts)},_close=function(){_destructViews(),zmailSettings.currentAppName=void 0,_unsubscribe()};return othcallist.init=_show,othcallist.clearTrace=_close,othcallist.updCalSts=_updCalSts,othcallist.delCal=_delCal,othcallist}(zcalSettings.othcalList||{});var zcalDetails=function(caldetails){caldetails=caldetails||{};var $detailPaneWrapper,calId,calObj,calKey,$reminder,$fb,$save,$cancel,$din,_clearPaneTrace=function(){var listDOM=$("#zcl_callist");listDOM&&listDOM.find("ul.sel").removeClass(),$detailPaneWrapper&&($detailPaneWrapper.remove(),$detailPaneWrapper=void 0)},_updCalDetails=function(){var alarm,qryStr,markasBusy=$fb&&$fb.find(".msi-check").length>0?"1":"0";alarm=ZCL_getAlarmObj($reminder[0].childNodes)[0];var dlgInvNtfy=$din&&$din.find(".msi-check").length>0?"1":"0";alarm.ACTYPE||alarm.ACTYPE==calObj[6].ACTYPE&&void 0!=alarm.ACTYPE?(alarm.ACTYPE!=calObj[6].ACTYPE||alarm.REMTIME!=calObj[6].REMTIME||alarm.REMTYPE!=calObj[6].REMTYPE||markAsBusy!=calObj[16])&&(qryStr="&remt="+alarm.REMTIME+"&remty="+alarm.REMTYPE+"&actty="+alarm.ACTYPE+"&busy="+markasBusy+"&invNtfy="+dlgInvNtfy):qryStr="&remt=&remty=&actty=&busy="+markasBusy+"&invNtfy="+dlgInvNtfy,qryStr&&ZCL_XHR("/cal/calAct.do?mode=edit-adv&caluid="+calKey+"&calid="+calId+qryStr,function(res){var _robj=ZCL_Evl(1,res.responseText);"success"===_robj.status&&(calObj[6]=_robj.obj.REM,calObj[16]=_robj.obj.BUSY,calObj[17]=_robj.obj.INVNOTIFY,zmUtil.succErrMsg("s",zcal.i18n.updatedsuccessfully),_clearPaneTrace())})};return caldetails.render=function(id,cObj){calId=id,calObj=cObj,calKey=calObj[9],$detailPaneWrapper=$('<div id="zcl_caldetails" class="editFilterParent"></div>');var $detail=$(zcalTemplate.calDetials(calId,cObj)),$embedlk=$detail.find("[data-marker=embedMore]");if($embedlk.off("click").on("click",function(){zcalEmbed.render(calId,calObj)}),$reminder=$detail.find("[data-marker=calReminder]").removeAttr("data-marker"),$reminder.html(ZCL_putCalAlarm(calObj[6])),$reminder.find(".msi-close").off("click").on("click",function(){$(this).closest("ul").remove(),$reminder.find("#zcl_addrem").length||ZCL_AppendRemAddLnk($reminder[0])}),$fb=$detail.find("[data-marker=markAsBusy]").removeAttr("data-marker"),void 0!=calObj[16]&&""!=calObj[16]){var $fbChkBox=$fb.find("i");$fbChkBox.length>0&&($fbChkBox.removeAttr("class").addClass("1"==calObj[16]?"msi-check":"msi-uncheck"),$fbChkBox.off("click").on("click",function(){this.className="msi-check"==this.className?"msi-uncheck":"msi-check"}))}else $fb.remove();if($din=$detail.find("[data-marker=dlgInvNtfy]").removeAttr("data-marker"),2==calObj[13][0]&&1==calObj[5]){var $dinChkBox=$din.find("i");$dinChkBox.length>0&&($dinChkBox.removeAttr("class").addClass("1"==calObj[17]?"msi-check":"msi-uncheck"),$dinChkBox.off("click").on("click",function(){this.className="msi-check"==this.className?"msi-uncheck":"msi-check"}))}else $din.remove();return $save=$detail.find("[data-marker=detailSave]").removeAttr("data-marker"),$save.off("click").on("click",_updCalDetails),$cancel=$detail.find("[data-val=Cancel]"),$cancel.off("click").on("click",_clearPaneTrace),$detailPaneWrapper.html($detail),$detailPaneWrapper},caldetails.close=_clearPaneTrace,caldetails}(zcalDetails||{}),zcalShare=function(calshare){calshare=calshare||{};var $sharePaneWrapper,calId,calObj,calKey,$cancel,$loadAnimationDOM,$pubShare,$pvtAddress,$indShare,$shareType,$shareTo,$sharePerm,autofillId,$sharedList,groupList,sharedMemberList,shObj={},_clearPaneTrace=function(){var listDOM=$("#zcl_callist");listDOM&&listDOM.find("ul.sel").removeClass(),$sharePaneWrapper&&($sharePaneWrapper.remove(),$sharePaneWrapper=void 0,$loadAnimationDOM=void 0,$pubShare=void 0,$pvtAddress=$indShare=$shareType=void 0,autofillId&&zmAutoFill.removeAutoFill(autofillId)),shObj={},groupList=void 0,sharedMemberList=void 0},_getSharePermList=function(ty){var shPermMenu=[{value:0,text:zcal.i18n.private_shperm_freebusy},{value:1,text:zcal.i18n.private_shperm_viewevent}];return 0==ty&&(shPermMenu.push({value:2,text:zcal.i18n.private_shperm_editevent}),shPermMenu.push({value:3,text:zcal.i18n.private_shperm_delegate})),shPermMenu};calshare.render=function(id,cObj){calId=id,calObj=cObj,calKey=calObj[9],groupList=ZCL_Evl(1,JSON.stringify(zcal.cdata.grpLst)),$sharePaneWrapper=$('<div id="zcl_calshare" class="editFilterParent"></div>');var $share=$(zcalTemplate.calShare());return 0!=calObj[13][0]||1==calObj[13][7]?($pubShare=$share.find("[data-marker=publicShare]").removeAttr("data-marker"),$pvtAddress=$share.find("[data-marker=privateAddress]").removeAttr("data-marker"),$indShare=$share.find("[data-marker=indShare]").removeAttr("data-marker"),$sharedList=$share.find("[data-marker=sharedList]").removeAttr("data-marker"),$loadAnimationDOM=$share.find("[data-marker=loadingAnimation]").removeAttr("data-marker"),0==calObj[13][0]&&1==calObj[13][7]?0!=zcal.pvtUrl&&(3==calObj[5]?_reqCalPubPvtInfo():_setPvtAddress()):1==calObj[13][0]&&0==calObj[13][7]?0!=zcal.shCal&&1!=zcal.shCal&&(3==calObj[5]?_reqCalPubPvtInfo():_setPubShare()):1==calObj[13][0]&&1==calObj[13][7]?0==zcal.shCal&&0!=zcal.pvtUrl?3==calObj[5]?_reqCalPubPvtInfo():_setPvtAddress():0!=zcal.shCal&&1!=zcal.shCal&&0==zcal.pvtUrl?3==calObj[5]?_reqCalPubPvtInfo():_setPubShare():0!=zcal.shCal&&1!=zcal.shCal&&0!=zcal.pvtUrl&&(3==calObj[5]?_reqCalPubPvtInfo():(_setPubShare(),_setPvtAddress())):0==zcal.shCal&&0!=zcal.pvtUrl?($pubShare&&($pubShare.remove(),$pubShare=void 0),$indShare&&($indShare.remove(),$indShare=void 0),$sharedList&&($sharedList.remove(),$sharedList=void 0),_setPvtAddress()):1==zcal.shCal&&0==zcal.pvtUrl?($pubShare&&($pubShare.remove(),$pubShare=void 0),$pvtAddress&&($pvtAddress.remove(),$pvtAddress=void 0),zcal.cdata.calLst[calId]?_reqSharedMemberList():_reqCalShareInfo()):1==zcal.shCal&&0!=zcal.pvtUrl?($pubShare&&($pubShare.remove(),$pubShare=void 0),zcal.cdata.calLst[calId]?(_setPvtAddress(),_reqSharedMemberList()):_reqCalShareInfo()):2==zcal.shCal&&0==zcal.pvtUrl?($pvtAddress&&($pvtAddress.remove(),$pvtAddress=void 0),zcal.cdata.calLst[calId]?(_setPubShare(),_reqSharedMemberList()):_reqCalShareInfo()):zcal.cdata.calLst[calId]?(_setPubShare(),_setPvtAddress(),_reqSharedMemberList()):_reqCalShareInfo(),$cancel=$share.find("[data-val=Cancel]"),$cancel.off("click").on("click",_clearPaneTrace),$sharePaneWrapper.html($share),$sharePaneWrapper):($sharePaneWrapper=void 0,void $sharePaneWrapper.remove())};var ereqObj,$ereqCode,_reqCalPubPvtInfo=function(){zmComponent.loadingBand({container:$loadAnimationDOM[0],type:"pagination"}),$loadAnimationDOM.show();var url="/cal/shareCal.do?mode=cal-pubpvtinfo&caluid="+calObj[9]+"&calid="+calId+"&calmode=0";ZCL_XHR(url,function(res){var _robj=ZCL_Evl(1,res.responseText);$loadAnimationDOM.hide(),_robj.obj&&(calObj[10]=_robj.obj),_setPubShare()})},_reqCalShareInfo=function(){zmComponent.loadingBand({container:$loadAnimationDOM[0],type:"pagination"}),$loadAnimationDOM.show();var url="/cal/shareCal.do?mode=sh-calinfo&caluid="+calObj[9]+"&calid="+calId+"&calmode=0";ZCL_XHR(url,function(res){$loadAnimationDOM.hide();var _robj=ZCL_Evl(1,res.responseText);_robj.calinfo&&(calObj[10]=_robj.calInfo[10],calObj[11]=_robj.calInfo[11],calObj[12]=_robj.calInfo[12]),_robj.pvtLst&&(sharedMemberList=_robj.pvtLst,_setSharedList()),_robj.grpInfo&&(groupList.grp=_robj.grpInfo),_setPubShare()})},_reqSharedMemberList=function(){zmComponent.loadingBand({container:$loadAnimationDOM[0],type:"pagination"}),$loadAnimationDOM.show();var url="/cal/shareCal.do?mode=priv-shlst&calid="+calId+"&calmode=0";ZCL_XHR(url,function(res){$loadAnimationDOM.hide();var _robj=ZCL_Evl(1,res.responseText);_robj.obj&&(sharedMemberList=_robj.obj,_setSharedList())})},_showMenu=function(obj){var menus=[],menuItems=obj.menuItems||[];menuItems.forEach(function(menuItem){var value=menuItem.value,text=menuItem.text;menus.push({htm:"<div>"+text+"</div>",data:{value:value,text:text}})});var deferred=$.Deferred();return obj.list=menus,obj.clk=function(data,element,event){deferred.resolve(data,element,event)},obj.onHide=function(){deferred.reject()},menus.length?zmsuite.showMenu(obj):deferred.reject(),deferred.fail(zmUtil.hideMenu),deferred.promise()},_setSharedList=function(){var optStr='<h2 class="recom_conditionHeading">Share with individuals or groups</h2>';optStr+='<div class="zmL">',optStr+='<div class="SC_srch shw">',optStr+='<table class="condition"><tr><td>',optStr+='<table><tr><td width="60px"><div class="SC_select" data-marker="shareType">',optStr+='<i class="msi-invitee"></i>',optStr+="</div></td>",optStr+='<td width="43%"><div class="SC_select SC_selectnoneArw">',optStr+='<input type="text" placeholder="'+zcal.i18n.typeaemailid+'" value="" class="zm_sgst" data-marker="shareTo">',optStr+="</div></td>",optStr+='<td width="29%"><div class="SC_select">',optStr+='<input type="text" class="disabled" readonly value="'+zcal.i18n.private_shperm_viewevent+'" data-marker="sharePerm">',optStr+="</div></td>",optStr+='<td class="tRht"><span><i class="msi-plus"></i></span></td>',optStr+="</tr></table>",optStr+="</tr></table>",optStr+="</div>",optStr+="</div>",$indShare.html(optStr),$shareType=$indShare.find("[data-marker=shareType]").removeAttr("data-marker"),$shareTo=$indShare.find("[data-marker=shareTo]").removeAttr("data-marker"),$sharePerm=$indShare.find("[data-marker=sharePerm]").removeAttr("data-marker");var addIcon=$indShare.find(".msi-plus");addIcon.off("click").on("click",function(){if(1==shObj.type){var grpid=$shareTo.attr("data-gid");if(null==grpid)return!1;shObj.grpid=grpid}else{var email=$shareTo[0].value;if(!ZCL_isEmail(email))return zmUtil.succErrMsg("e",zcal.i18n.entervalidemail),$shareTo[0].focus(),!1;shObj.email=email}_shareCal(shObj)}),_changeShareOption({value:0}),_updateShdList()},_updateShdList=function(){var $shlst=$("<table/>");for(var user in sharedMemberList[0]){var $row,$inp,$del,menuItems=_getSharePermList(0),perm=menuItems[sharedMemberList[0][user]].text;$row=$('<tr><td><i class="msi-invitee"></i></td><td width="43%"><span>'+ZCL_getHTML(user)+'</span></td><td width="29%"><div class="SC_select"><input type="text" class="disabled" readonly value="'+perm+'"></div></td><td><i class="msi-close"></i></td></tr>'),$inp=$row.find("input"),$inp.off("click").on("click",{menuItems:menuItems,email:user},function(ev){_showMenu({menuItems:ev.data.menuItems,par:this,parWidth:!0}).then(function(data){_shareCal({type:0,email:ev.data.email,perm:data.value}),zmUtil.hideMenu()})}),$del=$row.find(".msi-close"),$del.off("click").on("click",{email:user},function(ev){_delCalSharing({email:ev.data.email,mode:0})}),$shlst.append($row)}for(var group in sharedMemberList[1]){var gO=groupList.pgrp[group]||groupList.ogrp[group];if(gO){var $row,$inp,$del,menuItems=_getSharePermList(1),perm=menuItems[sharedMemberList[1][group]].text;$row=$('<tr><td width="5%"><i class="msi-group"></i></td><td width="43%"><span>'+ZCL_getHTML(gO.GNAME)+'</span></td><td width="29%"><div class="SC_select"><input type="text" class="disabled" readonly value="'+perm+'"></div></td><td><i class="msi-close"></i></td></tr>'),$inp=$row.find("input"),$inp.off("click").on("click",{menuItems:menuItems,grpid:group},function(ev){_showMenu({menuItems:ev.data.menuItems,par:this,parWidth:!0}).then(function(data){_shareCal({type:1,grpid:ev.data.grpid,perm:data.value}),zmUtil.hideMenu()})}),$del=$row.find(".msi-close"),$del.off("click").on("click",{grpid:group},function(ev){_delCalSharing({grpid:ev.data.grpid,mode:1})}),$shlst.append($row)}}$sharedList.html($shlst)},_changeShareOption=function(obj){var isgrp=ZCL_isEmpty(groupList.pgrp)&&ZCL_isEmpty(groupList.ogrp)?!1:!0,ty=obj.value,shPermMenu=_getSharePermList(ty);if(shObj.type=ty,shObj.perm=shPermMenu[1].value,$shareType&&($shareType.html('<i class="'+(1==ty?"msi-group":"msi-invitee")+'"></i>'),$shareType.off("click").on("click",{isgrp:isgrp},function(ev){var shTypeMenu=[{value:0,text:zcal.i18n.individuals}];ev.data.isgrp&&shTypeMenu.push({value:1,text:zcal.i18n.groups}),_showMenu({menuItems:shTypeMenu,par:this,parWidth:!1}).then(function(data){_changeShareOption(data),zmUtil.hideMenu()})})),autofillId&&zmAutoFill.removeAutoFill(autofillId),$shareTo)if($shareTo.off("click"),$shareTo.val(""),1==ty){$shareTo.attr("placeholder",zcal.i18n.selectagroup);var groupArr=getGroupForList();$shareTo.off("click").on("click",function(){var component,config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.onSelect=function(id,selectObj){setGroupValue(that,id,selectObj),component.hide()},config.dataCallback=function(){return groupArr},component=zmUtil.createFLComp("generic",config),component.show()})}else{$shareTo.attr("placeholder",zcal.i18n.typeaemailid);var afObj=zmSearch.getAFObj(0,function(obj){$shareTo[0].value=obj.eid,shObj.email=obj.eid});autofillId=zmAutoFill.setAutofill(afObj,$shareTo)}$sharePerm&&$sharePerm.off("click").on("click",function(){var that=this;_showMenu({menuItems:shPermMenu,par:this,parWidth:!0}).then(function(data){that.value=data.text,shObj.perm=data.value,zmUtil.hideMenu()})})},setGroupValue=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("data-gid",id)},updateGroupList=function(groupArr,groupList){for(var i=0;i<groupList.length;i++){var group=zcalGroup.getGroup(groupList[i]);group&&groupArr.push({id:groupList[i],name:group.name,display_text:group.name})}},getGroupForList=function(){var groupList,groupArr=[];return groupList=zcalGroup.getGroupList("personal"),updateGroupList(groupArr,groupList),groupList=zcalGroup.getGroupList("org"),updateGroupList(groupArr,groupList),groupArr},_shareCal=function(obj){var url="/cal/shareCal.do?calid="+calId+"&perm="+obj.perm+"&caluid="+calKey+"&calmode=0";url+=1==obj.type?"&mode=grp-sh&grpid="+obj.grpid:"&mode=priv-sh&shuser="+obj.email.zcalescape(),ZCL_XHR(url,function(res){var shobj,_robj=ZCL_Evl(1,res.responseText);return"success"!=_robj.status?void("maxLmtReached"==_robj.status?zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.maxLmtReached,[60])):"noPermission"==_robj.status?zmUtil.succErrMsg("e",zcal.i18n.NoPermission):"WaitForApprvl"==_robj.status&&zmUtil.succErrMsg("e",zcal.i18n.waitforapprovalcalmsg)):(zmUtil.succErrMsg("s",zcal.i18n.sharedsuccessfully),shobj=_robj.obj,"grp-sh"===_robj.mode?sharedMemberList[1][shobj[0]]=shobj[1]:sharedMemberList[0][shobj[0]]=shobj[1],_setSharedList(),void 0)})},_delCalSharing=function(obj){var ty=obj.mode,url="/cal/shareCal.do?&calid="+calId+"&caluid="+calObj[9]+"&calmode=0";url+=0==ty?"&mode=priv-sh-del&shuser="+obj.email.zcalescape():"&mode=grp-sh-del&grpid="+obj.grpid,ZCL_XHR(url,function(res){var mode,obj,_robj=ZCL_Evl(1,res.responseText);mode=_robj.mode,obj=_robj.obj,"grp-sh-del"==mode?delete sharedMemberList[1][obj[0]]:delete sharedMemberList[0][obj[0]],zmUtil.succErrMsg("s","Calendar sharing removed successfully"),_updateShdList()})},_setPubShare=function(){var $pubEle,$chgPermEle,$icalEle,$htmlEle,$wapiEle,$ereqEle,pubStr='<h2 class="recom_conditionHeading">'+zcal.i18n.public_share+"</h2>";pubStr+='<div class="zmL">',pubStr+="<div>",pubStr+='<table class="condition">',pubStr+="<tr><td>",pubStr+='<div><span data-marker="makePublic"><i class="'+(0!=calObj[10][1]?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.makethiscalpub+"</span></span></div>",0!=calObj[10][1]&&(pubStr+='<div class="zcl_Sshp zcl_Sshpu">',pubStr+="<div>",pubStr+='<span data-marker="chgPubPerm" rel="fb"><i class="'+(1==calObj[10][1]||4==calObj[10][1]?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.public_shperm_freebusy+"</span></span>",pubStr+='<span data-marker="chgPubPerm" rel="vd"><i class="'+(2==calObj[10][1]||3==calObj[10][1]?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.public_shperm_viewevent+"</span></span>",1==calObj[13][1]&&(pubStr+='<div><span data-marker="allowER"><i class="'+(3==calObj[10][1]||4==calObj[10][1]?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.allow_requisition+"</span></span>",pubStr+=3==calObj[10][1]||4==calObj[10][1]?'<ul><li><span class="zcl_lk" data-marker="webAPI">'+zcal.i18n.webapiforevent+'</span></li><li><span class="zcl_lk" data-marker="eventReq">'+zcal.i18n.calpubevtreq+"</span></li></ul>":"",pubStr+="</div>"),pubStr+="</div>",pubStr+='<div><span class="zcl_lk" data-marker="pubICAL">'+zcal.i18n.ical+'</span><span class="zcl_sp"></span><span class="zcl_lk" data-marker="pubHTML">'+zcal.i18n.html+"</span></div>",pubStr+="</div>"),pubStr+="</td></tr>",pubStr+="</table>",pubStr+="</div>",pubStr+="</div>",$pubShare.html(pubStr),$pubEle=$pubShare.find("[data-marker=makePublic]").removeAttr("data-marker"),$pubEle.off("click").on("click",function(){var pubPerm,chk=$(this).find("i");chk.hasClass("msi-check")?(chk.removeClass("msi-check").addClass("msi-uncheck"),pubPerm=0):(chk.removeClass("msi-uncheck").addClass("msi-check"),pubPerm=1),_updateCalPubPerm({perm:pubPerm,mode:"enable/disable"})}),$chgPermEle=$pubShare.find("[data-marker=chgPubPerm]").removeAttr("data-marker"),$chgPermEle.off("click").on("click",function(){var pubPerm,$ele=$(this),parEle=$ele.parent();pubPerm="vd"===$(this).attr("rel")?2:1,pubPerm=calObj[10][1]>=3?1==pubPerm?4:3:pubPerm,parEle.find(".msi-option").removeClass().addClass("msi-unoption"),$ele.find("i").addClass("msi-option"),_updateCalPubPerm({perm:pubPerm,mode:"change"})}),$ereqEle=$pubShare.find("[data-marker=allowER]").removeAttr("data-marker"),$ereqEle.off("click").on("click",function(){var ereq,chk=$(this).find("i");chk.hasClass("msi-check")?(chk.removeClass("msi-check").addClass("msi-uncheck"),ereq=0):(chk.removeClass("msi-uncheck").addClass("msi-check"),ereq=1),_updateCalEventReqPerm(ereq)}),$icalEle=$pubShare.find("[data-marker=pubICAL]").removeAttr("data-marker"),$icalEle.off("click").on("click",function(){openCalPubURL("ical")}),$htmlEle=$pubShare.find("[data-marker=pubHTML]").removeAttr("data-marker"),$htmlEle.off("click").on("click",function(){openCalPubURL("embed")}),$wapiEle=$pubShare.find("[data-marker=webAPI]").removeAttr("data-marker"),$wapiEle.off("click").on("click",function(){openCalWebAPI()}),$ereqEle=$pubShare.find("[data-marker=eventReq]").removeAttr("data-marker"),$ereqEle.off("click").on("click",function(){openCalEventReq()})},_updateCalPubPerm=function(obj){var pubPerm=obj.perm,req="/cal/shareCal.do?pubshare="+pubPerm+"&mode=pub-sh&calid="+calId+"&caluid="+calObj[9]+"&calmode=0";ZCL_XHR(req,function(res){var stsMsg,_robj=ZCL_Evl(1,res.responseText);"success"===_robj.status&&(calObj[10][1]=_robj.pub,stsMsg="change"===obj.mode?zcal.i18n.publicsharechanged:0==pubPerm?zcal.i18n.publicshare_disabled:zcal.i18n.publicshare_enabled,zmUtil.succErrMsg("s",stsMsg)),_setPubShare()})},_updateCalEventReqPerm=function(ereq){var req,pubPerm=calObj[10][1];pubPerm=1==ereq?2==pubPerm?3:4:4==pubPerm?1:2,req="/cal/shareCal.do?pubshare="+pubPerm+"&mode=pub-sh&calid="+calId+"&caluid="+calObj[9]+"&calmode=0",ZCL_XHR(req,function(res){var stsMsg,_robj=ZCL_Evl(1,res.responseText);"success"===_robj.status&&(calObj[10][1]=_robj.pub,stsMsg=0==ereq?zcal.i18n.allow_requisition_disabled:zcal.i18n.allow_requisition_enabled,zmUtil.succErrMsg("s",stsMsg)),_setPubShare()})},openCalPubURL=function(type){$("#zcl_calpubaddress").length||$("body").append("<div id='zcl_calpubaddress' class='zcl_ovr'/>");var pubStr,calpubEle=$("#zcl_calpubaddress");pubStr='<div class="SC_set SC_filt_bottom">',pubStr+='<textarea type="text" class="zcl_Stxt">'+location.protocol+"//"+zcal.ZCAL+"/"+(""==calObj[14]||"gcal"==calObj[14]?"":calObj[14]+"/")+type+"/"+calObj[9]+"</textarea>",pubStr+='<span class="zcl_grey">'+zcal.i18n.calurlmsg+"</span>",pubStr+="</div>",calpubEle.html(pubStr);var options={title:zcal.i18n.publicaddress,mask:!0,pos:"center",closeaction:function(){calpubEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop"};zmsDialog.create("zcl_calpubaddress",options)},openCalWebAPI=function(){$("#zcl_calwebapi").length||$("body").append("<div id='zcl_calwebapi' class='zcl_ovr'/>");var wapiStr,calwapiEle=$("#zcl_calwebapi");wapiStr='<div class="SC_set SC_filt_bottom">',wapiStr+='<div class="zmL">',wapiStr+='<div class="SC_srch shw"><table class="condition">',wapiStr+='<tr><td class="gbld">'+zcal.i18n.calwebapimsg+"</td></tr>",wapiStr+="<tr><td><table>",wapiStr+='<tr><td><textarea type="text" class="zcl_Stxt">'+location.protocol+"//"+zcal.ZCAL+"/eventreq/"+calObj[9]+"?name=[name]&mailId=[EmailId]&date=[MM/dd/yyyy]&time=[13:00]&reason=[Reason for Appointment]</textarea></td></tr>",wapiStr+="</table></td></tr>",wapiStr+="</table></div>",wapiStr+="</div>",wapiStr+="</div>",calwapiEle.html(wapiStr);var options={title:zcal.i18n.apiforeventreq,mask:!0,pos:"center",closeaction:function(){calwapiEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop"};zmsDialog.create("zcl_calwebapi",options)},_getLangSelection=function(){var langArr=zcalEmbed.languages(),selStr='<select class="select">';for(var val in langArr)selStr+='<option value="'+val+'">'+langArr[val]+"</option>";return selStr+="</select>"},ereq=function(obj){this.theme=obj&&obj.theme||0,this.language=obj&&obj.lang||"en",this.calKey=obj&&obj.ckey};ereq.prototype={setTheme:function(theme){this.theme=theme},setLanguage:function(language){this.language=language},getURL:function(){var _url='<iframe src="'+location.protocol+"//"+zcal.ZCAL+"/eventreqForm/"+this.calKey+"?theme="+this.theme+"&l="+this.language+'" frameborder="0" scrolling="no" marginWidth="0" border="0px" marginHeight="0" height="300px" width="432px" allowTransparency="true" align="center"></iframe>';return _url}};var updateEReqURL=function(){$ereqCode&&$ereqCode.html('<textarea class="zcl_Stxt">'+ereqObj.getURL()+"</textarea>")},openCalEventReq=function(){$("#zcl_calereq").length||$("body").append("<div id='zcl_calereq' class='zcl_ovr'/>");var ereqStr,ereqCol,calereqEle=$("#zcl_calereq");ereqObj=new ereq({lang:"en",theme:0,ckey:calObj[9]}),ereqCol=["#D5E4F7","#899AFF","#6FC252","#D4D4D4","#FF8F8F","#FF8FC1","#C9CE46","#FFAE00","#6F0DC2","#C81515"],ereqStr='<div class="SC_set SC_filt_bottom">',ereqStr+='<div class="conditionDiv">',ereqStr+="<table><tr><td>",ereqStr+='<div><div class="zmL">',ereqStr+='<div class="SC_srch shw">',ereqStr+='<table class="condition">',ereqStr+='<tr><td class="gbld">'+zcal.i18n.chooseyourclolor+"</td></tr>",ereqStr+='<tr><td><ul class="zcl_cecolr" id="zcl_ereqTheme">';for(var i=0;i<ereqCol.length;i++)ereqStr+='<li style="background-color:'+ereqCol[i]+'" class='+(i===ereqObj.theme?"zcl_sl":"")+'><i class="msi-tick"></i></li>';ereqStr+="</ul></td></tr>",ereqStr+="</table>",ereqStr+="</div>",ereqStr+="</div></div>",ereqStr+="</td>",ereqStr+="<td>",ereqStr+='<div><div class="zmL">',ereqStr+='<div class="SC_srch shw">',ereqStr+='<table class="condition">',ereqStr+='<tr><td class="gbld">'+zcal.i18n.language+"</td></tr>",ereqStr+='<tr><td><table><tr><td><div class="SC_select" style="width:100%" data-marker="languageSel"/></td></tr></table></td></tr>',ereqStr+="</table>",ereqStr+="</div>",ereqStr+="</div></div>",ereqStr+="</td></tr></table>",ereqStr+="</div>",ereqStr+='<div class="zmL">',ereqStr+='<div class="SC_srch shw"><table class="condition">',ereqStr+='<tr><td class="gbld">'+zcal.i18n.calwebapimsg+"</td></tr>",ereqStr+="<tr><td><table>",ereqStr+='<tr><td data-marker="ereqCode"><textarea class="zcl_Stxt">'+ereqObj.getURL()+"</textarea></td></tr>",ereqStr+="</table></td></tr>",ereqStr+="</table></div>",ereqStr+="</div>",ereqStr+="</div>",calereqEle.html(ereqStr),$ereqCode=calereqEle.find("[data-marker=ereqCode]").removeAttr("data-marker");var $themeDOM=calereqEle.find("#zcl_ereqTheme");$themeDOM.find("li").off("click").on("click",function(){var $ele=$(this);$ele.parent().find("li").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),ereqObj.setTheme($ele.index()),updateEReqURL()});var $langDOM=calereqEle.find("[data-marker=languageSel]").removeAttr("data-marker"),langStr=_getLangSelection();$langDOM.html(langStr),$langDOM.find("select").off("change").on("change",function(){ereqObj.setLanguage(this.value),updateEReqURL()});var options={title:zcal.i18n.calpubevtreq,mask:!0,pos:"center",closeaction:function(){calereqEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop",buttons:[{txt:zcal.i18n.preview,callback:function(){var txt,previewWindow=window.open();previewWindow.document.open(),txt=ereqObj.getURL().replace(/&lt;/gi,"<").replace(/&gt;/gi,">"),previewWindow.document.write("<html><body>"+txt+"</body></html>"),previewWindow.document.close()}}]};zmsDialog.create("zcl_calereq",options)},_setPvtAddress=function(){var $pvtEle,$icalEle,$htmlEle,pvtStr='<h2 class="recom_conditionHeading">'+zcal.i18n.privateaddress+"</h2>";pvtStr+='<div class="zmL">',pvtStr+="<div>",pvtStr+='<table class="condition">',pvtStr+="<tr><td>",pvtStr+='<span data-marker="enablePvtURL"><i class="'+(calObj[10][0]?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.endableprivateadd+"</span></span>",calObj[10][0]&&(pvtStr+='<div class="zcl_Sshp"><div><span class="zcl_lk" data-marker="pvtICAL">'+zcal.i18n.ical+'</span><span class="zcl_sp"></span><span class="zcl_lk" data-marker="pvtHTML">'+zcal.i18n.html+"</span>",pvtStr+='<span class="SC_button zcl_ovr" data-marker="pvtReset">'+zcal.i18n.reset+"</span></div></div>"),pvtStr+="</td></tr>",pvtStr+="</table>",pvtStr+="</div>",pvtStr+="</div>",$pvtAddress.html(pvtStr),$pvtEle=$pvtAddress.find("[data-marker=enablePvtURL]").removeAttr("data-marker"),$pvtEle.off("click").on("click",function(){var mode,chk=$(this).find("i");chk.hasClass("msi-check")?(chk.removeClass("msi-check").addClass("msi-uncheck"),mode="priv-dis"):(mode="priv-reset",chk.removeClass("msi-uncheck").addClass("msi-check")),_updateCalPvtAddress({mode:mode,msg:"enable/disable"})}),$icalEle=$pvtAddress.find("[data-marker=pvtICAL]").removeAttr("data-marker"),$icalEle.off("click").on("click",function(){openCalPvtURL("ical")}),$htmlEle=$pvtAddress.find("[data-marker=pvtHTML]").removeAttr("data-marker"),$htmlEle.off("click").on("click",function(){openCalPvtURL("embed")}),$pvtReset=$pvtAddress.find("[data-marker=pvtReset]").removeAttr("data-marker"),$pvtReset.off("click").on("click",function(){_updateCalPvtAddress({mode:"priv-reset",msg:"reset"})})},_updateCalPvtAddress=function(pObj){var req,ckey=calObj[9],mode=pObj.mode;req="/cal/shareCal.do?calid="+calId+"&caluid="+ckey+"&mode="+mode+"&calmode=0",ZCL_XHR(req,function(res){var _robj=ZCL_Evl(1,res.responseText);"priv-reset"===mode?(calObj[10][0]=_robj.pvtId,zmUtil.succErrMsg("s","reset"==pObj.msg?zcal.i18n.privateurlchanged:zcal.i18n.privateshare_enabled)):(calObj[10][0]=null,zmUtil.succErrMsg("s",zcal.i18n.privateshare_disabled)),_setPvtAddress()})},openCalPvtURL=function(type){var calpvtEle;$("#zcl_calpvtaddress").length||$("body").append("<div id='zcl_calpvtaddress' class='zcl_ovr'/>"),calpvtEle=$("#zcl_calpvtaddress");var pvtStr='<div class="SC_set SC_filt_bottom">';pvtStr+='<textarea type="text" class="zcl_Stxt">'+location.protocol+"//"+zcal.ZCAL+"/"+(""==calObj[14]?"":calObj[14]+"/")+type+"/"+calObj[9]+"/pvt_"+calObj[10][0]+"</textarea>",pvtStr+='<span class="zcl_grey">'+zcal.i18n.calurlmsg+"</span>",pvtStr+="</div>",calpvtEle.html(pvtStr);var options={title:zcal.i18n.privateaddress,mask:!0,pos:"center",closeaction:function(){calpvtEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop"};zmsDialog.create("zcl_calpvtaddress",options)};return calshare.close=_clearPaneTrace,calshare}(zcalShare||{}),zcalEmbed=function(calembed){calembed=calembed||{};var $embedPaneWrapper,calId,calObj,embedObj,$embedTplImg,$embedTitleSec,$embedTZSec,$embedCode,sizeObj=[{w:"600",h:"500",c:-1,v:0},{w:"300",h:"500",c:0,v:-1},{w:"350",h:"500",c:10,v:-1},{w:"300",h:"500",c:0,v:-1},{w:"400",h:"400",c:-1,v:-1},{w:"700",h:"270",c:0,v:-1},{w:"300",h:"400",c:-1,v:-1},{w:"350",h:"500",c:1,v:-1},{w:"300",h:"500",c:7,v:-1},{w:"300",h:"500",c:0,v:-1}],_getEmbedColors=function(){return[zcal.i18n.blue,zcal.i18n.green,zcal.i18n.red,zcal.i18n.pink,zcal.i18n.violet,zcal.i18n.rosybrown,zcal.i18n.purple,zcal.i18n.grey,zcal.i18n.orange,zcal.i18n.brown,zcal.i18n.yellow]},_getEmbedLanguages=function(){return-1!=zcal.ZCAL.indexOf(".baihui.com")?{zh:zcal.i18n.chines,en:zcal.i18n.english}:{en:zcal.i18n.english,da:zcal.i18n.danish,de:zcal.i18n.german,es:zcal.i18n.spanish,fr:zcal.i18n.french,hu:zcal.i18n.hungarian,it:zcal.i18n.italian,ja:zcal.i18n.japanes,nl:zcal.i18n.dutch,pl:zcal.i18n.polish,pt:zcal.i18n.portuguese,ru:zcal.i18n.russian,sv:zcal.i18n.swedish,tr:zcal.i18n.turkish,zh:zcal.i18n.chines}},embed=function(obj){this.template=obj&&obj.type||0,this.title=obj&&obj.title,this.defaultCal=obj&&obj.dcal,this.selectedCal=[],this.view=sizeObj[this.template].v,this.color=sizeObj[this.template].c,this.language=obj&&obj.lang||"en",this.width=sizeObj[this.template].w,this.height=sizeObj[this.template].h,this.timezone=obj&&obj.tz,this.showTitle=!0,this.showTimezone=!0,this.detailview=!1};embed.prototype={setTemplate:function(template){this.template=parseInt(template),this.view=sizeObj[this.template].v,this.color=sizeObj[this.template].c,this.width=sizeObj[this.template].w,this.height=sizeObj[this.template].h},setTitle:function(title){this.title=title},setCalendars:function(calKey){this.selectedCal=""!=calKey?calKey.split(","):[]},setView:function(view){this.view=parseInt(view)},setColor:function(color){this.color=parseInt(color)},setLanguage:function(language){this.language=language},setWidth:function(width){this.width=parseInt(width)},setHeight:function(height){this.height=parseInt(height)},setTimezone:function(timezone){this.timezone=timezone},setShowTitle:function(showTitle){this.showTitle=showTitle},setShowTimezone:function(showTimezone){this.showTimezone=showTimezone},setDetailview:function(detailview){this.detailview=detailview},getURL:function(){var _url='<iframe src="'+location.protocol+"//"+zcal.ZCAL+(""===calObj[14]||"gcal"===calObj[14]?"":"/"+calObj[14])+"/embed/"+this.defaultCal+"?";if(zcal.cdata.calLst[calId]){var noofCal=this.selectedCal.length,calStr="";if(0!=noofCal)for(var i=0;noofCal>i;i++)calStr+=(0==i?"":",")+this.selectedCal[i];_url+=""!=calStr?"cal="+calStr+"&":""}return _url+="title="+ZCL_getHTML(this.title).replace("&#39;",""),_url+="&type="+(this.template+1),_url+="&l="+this.language,_url+="&tz="+this.timezone,_url+="&sh=["+(this.showTitle?1:0)+","+(this.showTimezone?1:0)+","+(this.detailview?1:0)+"]",_url+=-1!=this.color?"&c="+this.color:"",_url+=-1!=this.view?"&v="+this.view:"",_url+='" width="'+this.width+'" height="'+this.height+'" frameborder="0" scrolling="no"></iframe>'}};var _getDialogOptions=function(){return{title:zcal.i18n.calendardetails,style:{"max-width":"750px"},mask:!0,pos:"center",closeaction:_closeEmbed,customClass:"SC_SetPop",buttons:[{txt:zcal.i18n.preview,callback:function(){var txt,previewWindow=window.open();previewWindow.document.open(),txt=embedObj.getURL().replace(/&lt;/gi,"<").replace(/&gt;/gi,">"),previewWindow.document.write("<html><body>"+txt+"</body></html>"),previewWindow.document.close()}},{txt:zcal.i18n.refresh,callback:function(){embedObj=new embed({title:calObj[0],dcal:calObj[9],tz:zcal.cdata.opt.TIM,lang:zcal.cdata.opt.LANG,type:embedObj.template}),constEmbed()}}]}},_getCalSelOption=function(){var calOrder=zcal.cdata.calOrdArr,calStr="";return calOrder.forEach(function(id){var calLst=zcal.cdata.calLst,sel=calLst[id][9]==embedObj.defaultCal||-1!=embedObj.selectedCal.indexOf(calLst[id][9])?"selected":"";calStr+='<option value="'+calLst[id][9]+'" '+sel+">"+ZCL_getHTML(calLst[id][0])+"</option>"}),calStr},_getColorSelection=function(){for(var colorArr=_getEmbedColors(),selStr='<select class="select">',i=0;i<colorArr.length;i++)selStr+='<option value="'+i+'" '+(embedObj.color==i?"selected":"")+">"+colorArr[i]+"</option>";return selStr+="</select>"},_getViewSelection=function(){for(var viewArr=[zcal.i18n.vday,zcal.i18n.week,zcal.i18n.month],selStr='<select class="select">',i=0;i<viewArr.length;i++)selStr+='<option value="'+i+'" '+(embedObj.view==i?"selected":"")+">"+viewArr[i]+"</option>";return selStr+="</select>"},_getLangSelection=function(){var langArr=_getEmbedLanguages(),selStr='<select class="select">';for(var val in langArr)selStr+='<option value="'+val+'" '+(embedObj.lang==val?"selected":"")+">"+langArr[val]+"</option>";return selStr+="</select>"},setTZ=function(){var tzStr='<input type="text" readonly  value="'+unescape(zcal.cdata.opt.CTIM)+'" id="zcl_TZ" class="SC_tiput zcl_nrbr" rel="'+zcal.cdata.opt.TIM+'" />		  ';return tzStr},_closeEmbed=function(){$embedPaneWrapper&&(zmsDialog.remove(!0),$embedPaneWrapper.remove(),$embedPaneWrapper=void 0)},_constImgSec=function(){$embedTplImg&&$embedTplImg.html('<div><div class="zcl_emb'+(embedObj.template+1)+'"></div></div>')},_constTitleSec=function(){var $titleDOM,$calSelDOM,$colViewDOM,emStr;if($embedTitleSec){emStr='<div class="zmL">',emStr+='<div class="SC_srch shw"><table class="condition">',emStr+='<tr><td class="gbld">'+zcal.i18n.title+"</td></tr>",emStr+='<tr><td><input type="text" class="SC_tiput" value="'+ZCL_getHTML(embedObj.title)+'"/></td></tr>',emStr+="</table></div>",emStr+="</div>",emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw"><table class="condition">',emStr+='<tr><td class="gbld">'+zcal.i18n.select_calendar+"</td></tr>",emStr+='<tr><td><select style="width:100%" size="4" multiple="multiple"/></td></tr>',emStr+="</table></div>",emStr+="</div>",(-1!=embedObj.color||-1!=embedObj.view)&&(emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw"><table class="condition">',emStr+='<tr><td class="gbld">'+(-1!=embedObj.view?zcal.i18n.chooseyourview:zcal.i18n.chooseacolor)+"</td></tr>",emStr+='<tr><td><table><tr><td><div class="SC_select" data-marker="viewColorSel"/></td></tr></table></td></tr>',emStr+="</table></div>",emStr+="</div>"),$embedTitleSec.html(emStr),$titleDOM=$embedTitleSec.find("input.SC_tiput"),$titleDOM.off("change").on("change",function(){embedObj.setTitle(this.value),updateEmbedURL()}),$calSelDOM=$embedTitleSec.find("select");var calSelStr=_getCalSelOption();if($calSelDOM.html(calSelStr),$calSelDOM.off("click").on("click",function(){var $sel=$(this),selCal=[];$.each($sel.find("option:selected"),function(){var ckey=$(this).val();ckey!=embedObj.defaultCal&&selCal.push(ckey)}),embedObj.setCalendars(selCal.join(",")),updateEmbedURL()}),$colViewDOM=$embedTitleSec.find("[data-marker=viewColorSel]").removeAttr("data-marker")){var $sel;-1!=embedObj.color?($sel=$(_getColorSelection()),$sel.off("change").on("change",function(){embedObj.setColor(this.value),updateEmbedURL()}),$colViewDOM.html($sel)):-1!=embedObj.view&&($sel=$(_getViewSelection()),$sel.off("change").on("change",function(){embedObj.setView(this.value),updateEmbedURL()}),$colViewDOM.html($sel))}}},_constTZSec=function(){var $langDOM,$hgtDOM,$tzDOM,$showallTzDOM,emStr;if($embedTZSec){emStr='<div class="zmL">',emStr+='<div class="SC_srch shw"><table class="condition">',emStr+='<tr><td class="gbld">'+zcal.i18n.language+"</td></tr>",emStr+='<tr><td><table><tr><td><div class="SC_select" data-marker="languageSel"/></td></tr></table></td></tr>',emStr+="</table></div>",emStr+="</div>",emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw"><table>',emStr+='<tr><td><table class="condition">',emStr+='<tr><td class="gbld">'+zcal.i18n.width+"</td></tr>",emStr+='<tr><td><table><tr><td><input type="text" id="zcl_embedWdt" class="SC_tiput zcl_nrbr" value="'+embedObj.width+'px"></td></tr></table></td></tr>',emStr+="</table></td>",emStr+='<td><table class="condition">',emStr+='<tr><td class="gbld">'+zcal.i18n.height+"</td></tr>",emStr+='<tr><td><table><tr><td><input type="text" id="zcl_embedHgt" class="SC_tiput" value="'+embedObj.height+'px"></td></tr></table></td></tr>',emStr+="</table></td></tr>",emStr+="</table></div>",emStr+="</div>",emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw"><table class="condition">',emStr+='<tr><td class="gbld">'+zcal.i18n.timezone+'<span class="zcl_smlk SC_lnk pl5" data-marker="showallTimezone">('+zcal.i18n.showall+")</span></td></tr>",emStr+='<tr><td><table><tr><td><div class="SC_select" id="zcl_embedTZ">'+setTZ()+"</div></td></tr></table></td></tr>",emStr+="</table></div>",emStr+="</div>",emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw"><table class="condition">',emStr+="<tr><td><table>",emStr+="<tr>",emStr+='<td><span class="mLnone" id="zcl_embedShowTitle"><i class="'+(embedObj.showTitle?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.title+"</span></span></td>",emStr+='<td><span class="mLnone" id="zcl_embedShowTz"><i class="'+(embedObj.showTimezone?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.timezone+"</span></span></td>",emStr+="</tr>",emStr+="</table></td></tr>",0==embedObj.template&&(emStr+='<tr><td><span class="mLnone" id="zcl_embedDview"><i class="'+(embedObj.detailview?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.detailsview+"</span></span></td></tr>"),emStr+="</table></div>",emStr+="</div>",$embedTZSec.html(emStr),$langDOM=$embedTZSec.find("[data-marker=languageSel]").removeAttr("data-marker");var langStr=_getLangSelection();$langDOM.html(langStr),$langDOM.find("select").off("change").on("change",function(){embedObj.setLanguage(this.value),updateEmbedURL()}),$wdtDOM=$embedTZSec.find("#zcl_embedWdt"),$wdtDOM.off("change").on("change",function(){var wdt=this.value;""!=wdt&&(wdt=wdt.replace(/\D/g,""),embedObj.setWidth(wdt),updateEmbedURL())}),$hgtDOM=$embedTZSec.find("#zcl_embedHgt"),$hgtDOM.off("change").on("change",function(){var hgt=this.value;""!=hgt&&(hgt=hgt.replace(/\D/g,""),embedObj.setHeight(hgt),updateEmbedURL())}),$tzDOM=$embedTZSec.find("#zcl_embedTZ select"),$tzDOM.off("change").on("change",function(){embedObj.setTimezone(this.value),updateEmbedURL()}),$showallTzDOM=$embedTZSec.find("[data-marker=showallTimezone]").removeAttr("data-marker"),$showallTzDOM&&$showallTzDOM.off("click").on("click",function(){showallTimezone(),$(this).remove()}),$embedTZSec.find("#zcl_TZ").on("click",function(){var tzArr=zcal.timezones,tArr=[];for(var i in tzArr)for(var j in tzArr[i]){var obj={};obj.id=j,obj.name=tzArr[i][j]+" ("+j+")",obj.display_text=tzArr[i][j]+" ("+j+")",tArr.push(obj)}var component,config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.parWidth=!0,config.onSelect=function(id,selectObj){setGroupValue(that,id,selectObj),component.hide()},config.dataCallback=function(){return tArr},component=zmUtil.createFLComp("generic",config),component.show()});var $showTitDOM=$embedTZSec.find("#zcl_embedShowTitle");$showTitDOM.off("click").on("click",function(){var css,$chkbox,val,$ele=$(this);$chkbox=$ele.find("i"),css=$chkbox.hasClass("msi-check")?"msi-uncheck":"msi-check",val="msi-check"===css?!0:!1,$chkbox.attr("class",css),embedObj.setShowTitle(val),updateEmbedURL()});var $showTzDOM=$embedTZSec.find("#zcl_embedShowTz");$showTzDOM.off("click").on("click",function(){var css,$chkbox,val,$ele=$(this);$chkbox=$ele.find("i"),css=$chkbox.hasClass("msi-check")?"msi-uncheck":"msi-check",val="msi-check"===css?!0:!1,$chkbox.attr("class",css),embedObj.setShowTimezone(val),updateEmbedURL()});var $dviewDOM=$embedTZSec.find("#zcl_embedDview");$dviewDOM.off("click").on("click",function(){var css,$chkbox,val,$ele=$(this);$chkbox=$ele.find("i"),css=$chkbox.hasClass("msi-check")?"msi-uncheck":"msi-check",val="msi-check"===css?!0:!1,$chkbox.attr("class",css),embedObj.setDetailview(val),updateEmbedURL()})}},setGroupValue=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("rel",id),$ele.attr("value",selectObj.display_text),embedObj.setTimezone(id),updateEmbedURL()},showallTimezone=function(){zcal.timezones.length>0?setTZ():ZCL_getTZ({mode:"embed",callback:function(){zcalEmbed.showAllTimezone()}})},updateEmbedURL=function(){$embedCode&&$embedCode.html('<textarea class="zcl_Stxt">'+embedObj.getURL()+"</textarea>")},constEmbed=function(){_constImgSec(),_constTitleSec(),_constTZSec(),updateEmbedURL()},_showCalEmbed=function(id,cObj){calId=id,calObj=cObj,embedObj=new embed({title:calObj[0],dcal:calObj[9],tz:zcal.cdata.opt.TIM,lang:zcal.cdata.opt.LANG}),$embedPaneWrapper||($embedPaneWrapper=$('<div id="zcl_calembed" class="zcl_ovr zcl_Semd"></div>'),$("body").append($embedPaneWrapper));var $tmpEle,$embed=$(zcalTemplate.calEmbed()),tmpStr="";$tmpEle=$embed.find("[data-marker=embedTpl]").removeAttr("data-marker");for(var i=0;10>i;i++)tmpStr+="<span "+(i==embedObj.template?'class="zcl_sl"':"")+">"+(i+1)+"</span>";$tmpEle.html(tmpStr),$tmpEle.find("span").off("click").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),embedObj.setTemplate($ele.index()),constEmbed()}),$embedTplImg=$embed.find("[data-marker=embedTplImg]").removeAttr("data-marker"),$embedTitleSec=$embed.find("[data-marker=embedTitleSec]").removeAttr("data-marker"),$embedTZSec=$embed.find("[data-marker=embedTZSec]").removeAttr("data-marker"),$embedCode=$embed.find("[data-marker=embedCode]").removeAttr("data-marker"),constEmbed();var dialogOptions=_getDialogOptions();$embedPaneWrapper.html($embed),zmsDialog.create("zcl_calembed",dialogOptions)};return calembed.render=_showCalEmbed,calembed.showAllTimezone=setTZ,calembed.languages=_getEmbedLanguages,calembed}(zcalEmbed||{});ZCL_prntTitle=function(){return'<div class="zcl_prntlk"><b style="font-size:14px">'+zcal.i18n.calendar+"</b> : "+ZCL_getHTML(ZCL_CALNAME)+"</div>"},ZCL_getPrntWdt=function(){return 3==zcal.view?1051:ZCL_getEleWdt(ZCL_$("zcl_workarea"))-zcalInit.scrollWidth()},ZCL_prntPageHdTxt=function(){var txt1="<!DOCTYPE html><html><head>";return txt1+='<meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>'+ZCL_replaceProName(zcal.i18n.prttitle)+'</title><link type="text/css" rel="stylesheet" href="'+location.protocol+zcal.cssPath+'zmscal.css"</link><link href="'+location.protocol+zcal.cssPath+'zmscal-print.css" rel="stylesheet" type="text/css"></link>',txt1+="</head>"},ZCL_iPrnt=function(){ZCL_EClrStck();var prntFrame,txt1,wexpChk=navigator.userAgent,attriObj={id:"zcl_prntFrame",frameborder:0,style:"top:50px;display:none"};attriObj.src=wexpChk.match(/rv:11.0/i)?"":"/mail/cal/jsp/print.jsp",prntFrame=$("<IFRAME/>",attriObj),ZCL_$("zcl_pdfLoad")||$("body").append("<div id='zcl_pdfLoad' style='display:none'/>");var pdfEle=$("#zcl_pdfLoad");txt1=ZCL_prntPageHdTxt(),txt1+='<body style="padding-bottom:5px;padding-left:5px;padding-top:10px;overflow:auto;width:'+ZCL_getPrntWdt()+'px;height:100%" class="zcl" id="zcl_print" onload="printDoc()">',txt1+='<div class="zcl_P">'+ZCL_constructData()+"</div>",txt1+="<script>printDoc=function(){window.print()}</script></body></html>",pdfEle.empty(),pdfEle.append(prntFrame);var frameWdw=prntFrame[0].contentWindow||prntFrame[0].contentDocument;frameWdw.document&&(frameWdw=frameWdw.document),frameWdw.write(txt1),frameWdw.close()},isIE=function(){var sAgent=window.navigator.userAgent,Idx=sAgent.indexOf("MSIE");return Idx>0?!0:navigator.userAgent.match(/Trident/)?!0:!1},ZCL_print=function(){isIE()?ZCL_prntPreview(!0):ZCL_iPrnt()},ZCL_prntPreview=function(isPrnt){ZCL_EClrStck();var txt1=ZCL_prntPageHdTxt();txt1+='<body style="padding-bottom:5px;padding-left:5px;padding-top:10px;overflow:auto;width:'+ZCL_getPrntWdt()+'px;height:100%;display:none" class="zcl" id="zcl_print" onload="ZCL_dispPrntData();'+(isPrnt?"window.print()":"")+'">',txt1+='<div class="zcl_P">',txt1+=ZCL_constructData(),txt1+="</div>",txt1+='<script>ZCL_dispPrntData=function(){document.getElementById("zcl_print").style.display="";}</script></body></html>';var wexpChk=navigator.userAgent,prntWd="";prntWd=wexpChk.match(/rv:11.0/i)?window.open("","_blank"):window.open("/mail/cal/print.do"),prntWd.document.write(txt1),prntWd.document.close(),prntWd.focus()},ZCL_pdfDown=function(){var pwd=$("#zcl_pwd")[0].value,repwd=$("#zcl_repwd")[0].value;if(""==pwd&&""==repwd)$("#zcl_pwd_er")[0].style.display="",$("#zcl_repwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwdcon")[0].style.display="none";else if(pwd==repwd){$("#zcl_repeqwd_er")[0].style.display="none",$("#zcl_repwd")[0].className="SC_tiput",ZCL_EClrStck();var txt1=ZCL_prntPageHdTxt();txt1+='<body style="padding-bottom:5px;padding-left:5px;padding-top:10px;overflow:auto;width:'+ZCL_getPrntWdt()+'px;height:100%" class="zcl" id="zcl_print">',txt1+='<div class="zcl_P">',txt1+=ZCL_constructData(),txt1+="</div>",txt1+="</body></html>",ZCL_formSubmit({password:pwd,zcl_file:ZCL_prntTxt(txt1),zcl_ori:3==zcal.view?"landscape":"portrait"},"/cal/pwdPdf.do"),zmsDialog.remove()}else $("#zcl_repeqwd_er")[0].style.display="",$("#zcl_repwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwdcon")[0].style.display="none"},ZCL_svPdf=function(){var temp=!1;if(temp=zmAdHocSettings&&zmAdHocSettings.getSecuredownload&&"1"===zmAdHocSettings.getSecuredownload()?!0:!1)ZCL_secureDow();else{ZCL_EClrStck();var txt1=ZCL_prntPageHdTxt();txt1+='<body style="padding-bottom:5px;padding-left:5px;padding-top:10px;overflow:auto;width:'+ZCL_getPrntWdt()+'px;height:100%" class="zcl" id="zcl_print">',txt1+='<div class="zcl_P">',txt1+=ZCL_constructData(),txt1+="</div>",txt1+="</body></html>",ZCL_formSubmit({zcl_file:ZCL_prntTxt(txt1),zcl_ori:3==zcal.view?"landscape":"portrait"},"/cal/Pdf.do")}},ZCL_prntTxt=function(val){var rep=new RegExp(String.fromCharCode(160),"gi");return val=val.replace(rep,String.fromCharCode(32)),val=val.replace(/\n\t\r/g,""),val=val.replace(/https/g,"http"),encodeURIComponent(val)};var ZCL_PRINTDATA=[],zcalMonthPrint=function(){var gridDOM,eventCnt=[],cellWidth=150,sumReg="/<|>|&lt;|&gt;|&lt|&gt/gi",populateData=function(){for(var tempd=zcal.mlimit[0].clone(),i=0;i<ZCL_PRINTDATA.length;i++)eventCnt[i]=0,printRender(ZCL_PRINTDATA[i],tempd.dateBy("yyyyMMdd"),7,i),tempd.setDate(tempd.getDate()+7)},retdate=function(d,s){return null==s&&(s=0),new Date(d.substring(0,4),parseInt(d.substring(4,6),10)-1,parseInt(d.substring(6,8),10)+s)},mc=[],ms=1,mdtArr=[],meventObj={},rowMaxCount=0,printRender=function(obj,dt,no,row){ms=no,creArray();var sd=ZCL_parseDateStr(dt);mdtArr[0]=sd,mdtArr[1]=retdate(dt,no-1);for(var i=0;no>i;i++){var d,dd=new Date;dd.setTime(sd),dd.setDate(dd.getDate()+i),d=dd.dateBy("yyyyMMdd"),obj[d]&&obj[d].length>0&&mcreate(obj[d],i,d,row);var npos=7*row+i,mboxEle=gridDOM.querySelector("#zcl_pm"+npos),dispCount=(mboxEle.offsetHeight-18,0),eCount=0;eCount=meventObj[npos]?meventObj[npos].elements.length:0,rowMaxCount=eCount>=rowMaxCount?eCount:rowMaxCount,dispCount=eCount;for(var j=0;dispCount>j;j++)mboxEle.appendChild(meventObj[npos].elements[j])}var rowHgt,rowEle=gridDOM.querySelector("#zcl_pm_r"+row);rowHgt=5>rowMaxCount?100:17*rowMaxCount+18,rowEle.style.height=rowHgt+"px",mc=[],meventObj={},rowMaxCount=0},mcreate=function(obj,pos,d,r){for(var slot,wid,npos=7*r+pos,i=(gridDOM.querySelector("#zcl_pm"+npos),0);i<obj.length;i++)slot=freeS(pos),wid=eveWid(slot,pos,obj[i],d),divCont(slot,npos,obj[i],wid,d,r)},divCont=function(t,l,obj,wid,d){meventObj[l]=meventObj[l]||{};var _mbObj=meventObj[l];_mbObj.elements=_mbObj.elements||[],_mbObj.events=_mbObj.events||[];for(var i in obj){var startD,endD,tStr,mTime,calColor,colarr,caltxtCol,sub=obj[i].SUM.replace(sumReg,"").replace(/ /g,"&nbsp;"),calObj=zcal.getCalObj(obj[i].CNAME);if(""==sub&&(sub="NO SUBJECT"),startD=ZCL_parseDateStr(obj[i].SD),endD=ZCL_parseDateStr(obj[i].ED),tStr=ZCL_timeInUFormat(obj[i].ST),mTime=zcalEvents.alltime(obj[i]),calColor=calObj[1].split(":"),colarr=ZCL_getCalColor(calColor[0]),caltxtCol=0==calColor[1]?"zcl_event zcl_evwh":"zcl_event zcl_evbl","1"==obj[i].ADAY||endD>startD){var adayEle=document.createElement("DIV");adayEle.style.width=wid+"px",adayEle.className="zcl_mallev";var txt='<div class="zcl_mthev"><div class="'+caltxtCol+'" style="background-color:#ffffff;border-color:'+colarr[0]+'">';txt+='<ul><li class="zcl_sp"></li><li>'+mTime+"<span>"+ZCL_getHTML(sub)+(obj[i].LOC?"&nbsp;@&nbsp;"+ZCL_getHTML(obj[i].LOC):"")+"</span></li></ul>",txt+="</div></div>",adayEle.innerHTML=txt,_mbObj.elements.splice(t,0,adayEle),_mbObj.events.splice(t,0,obj);var end=obj[i].ED;end=ZCL_parseDateStr(end);var dlen=0;end>=mdtArr[1]?dlen=ZCL_daysBetween(d,mdtArr[1].dateBy("yyyyMMdd"))+1:end<mdtArr[1]&&(dlen=ZCL_daysBetween(d,end.dateBy("yyyyMMdd"))+1);for(var x=l+1;l+dlen>x;x++){meventObj[x]=meventObj[x]||{};var dmyEle,_tempmbObj=meventObj[x];_tempmbObj.elements=_tempmbObj.elements||[],_tempmbObj.events=_tempmbObj.events||[],dmyEle=document.createElement("DIV"),dmyEle.className="zcl_edmy",_tempmbObj.elements.splice(t,0,dmyEle),_tempmbObj.events.splice(t,0,obj)}}else{var normEle=document.createElement("DIV");normEle.className="zcl_mevent",normEle.innerHTML='<div><em class="zcl_st" style="color:'+colarr[0]+';">'+tStr+'</em><span style="color:'+colarr[0]+';">'+ZCL_getHTML(sub)+(obj[i].LOC?"&nbsp;@&nbsp;"+ZCL_getHTML(obj[i].LOC):"")+"</span></div>",_mbObj.elements.splice(t,0,normEle),_mbObj.events.splice(t,0,obj)}}},creArray=function(){for(var temp=mc[mc.length]=new Array,i=0;ms>i;i++)temp[i]=0;return mc.length-1},freeS=function(pos){for(var i=0;i<mc.length;i++)if(0==mc[i][pos])return i;return creArray()},fillspace=function(slot,pos,wid){for(var arr=mc[slot],i=pos;wid+pos>i;i++)arr[i]=1},eveWid=function(slot,pos,obj,d){var wid="",ed="";for(var i in obj)ed=obj[i].ED;return ed=ZCL_parseDateStr(ed),ed>=mdtArr[1]?wid=ZCL_daysBetween(d,mdtArr[1].dateBy("yyyyMMdd"))+1:ed<mdtArr[1]&&(wid=ZCL_daysBetween(d,ed.dateBy("yyyyMMdd"))+1),fillspace(slot,pos,wid),wid*cellWidth-5},constMonthPrintView=function(){return gridDOM=zcalView.constMonthPrintView(),populateData(),gridDOM.outerHTML},printObj={printMonth:constMonthPrintView};return printObj}(),crmCalId,zcalCRM=function(){var crmFields,relatedToModules,associateModules,crmCCode,CONTACTNAME="Contact Name",RELATEDTO="Related To",syncMode=0,crmUserObj=[],recruitUserObj=[],customFieldNames=[],customFieldLabels=[],LEADCONTACT_SEL="",recruitCUser={},crmCUser={},crmAttendees={},openCRMForm=function(){if(syncMode="recruit"==zcal.getCalObj(crmCalId)[14]?1:0,null==zcal.EOBJ.EID&&getFormData(),crmFields)constCRMForm();else{var ckey=zcal.getCalObj(crmCalId)[9];ZCL_uXHR("/cal/getCRMFlds.do?ckey="+ckey+"&service="+(1==syncMode?"ZohoRecruit":"ZohoCrm"),function(res){var obj=ZCL_Evl(1,res.responseText);(obj.status="success")&&updateCRMFieldInfo(obj)})}},getFormData=function(){zcal.EOBJ.SUM=ZCL_$("zcl_ce_tit")?ZCL_$("zcl_ce_tit").value:zcal.EOBJ.SUM,zcal.EOBJ.Venue=ZCL_$("zcl_ce_loc")?ZCL_$("zcl_ce_loc").value:"",zcal.EOBJ.Description=ZCL_$("zcl_ce_desc")?ZCL_$("zcl_ce_desc").value:"",zcal.EOBJ.SD=ZCL_$("zcl_ce_sd")?ZCL_DFDate(ZCL_$("zcl_ce_sd").value):zcal.EOBJ.SD,zcal.EOBJ.ST=ZCL_$("zcl_ce_st")?ZCL_TimetoNo(""==ZCL_$("zcl_ce_st").style.display?ZCL_$("zcl_ce_st").value:"00:00"):zcal.EOBJ.ST,zcal.EOBJ.ED=ZCL_$("zcl_ce_ed")?ZCL_DFDate(ZCL_$("zcl_ce_ed").value):zcal.EOBJ.ED,zcal.EOBJ.ET=ZCL_$("zcl_ce_et")?ZCL_TimetoNo(""==ZCL_$("zcl_ce_et").style.display?ZCL_$("zcl_ce_et").value:"00:00"):zcal.EOBJ.ET},reset=function(){crmFields=void 0,relatedToModules=[],associateModules=[],customFieldLabels=[],customFieldNames=[],crmCalId=void 0,syncMode=0},updateCRMFieldInfo=function(obj){zcal.EOBJ.SERVICE=obj.mode||"crm",crmCalId=zcal.EOBJ.CNAME,crmFields={},crmFields.flds=obj.flds.Events.section,crmFields.fieldname=obj.fieldname,crmFields.fieldtype=obj.fieldtype,crmFields.fieldlabel=obj.fieldlabel,relatedToModules=obj.relatedto_modules,associateModules=obj.associate_modules,constCRMForm()},constCRMForm=function(){ZCL_clrStck();var fieldsArr=crmFields.flds,txt="",reqNote=!1;if(zcal.EOBJ.SEMODULE&&("Leads"==zcal.EOBJ.SEMODULE?LEADCONTACT_SEL="Leads":"Candidates"==zcal.EOBJ.SEMODULE?LEADCONTACT_SEL="Candidates":(zcal.EOBJ[CONTACTNAME]||"Contacts"==zcal.EOBJ.SEMODULE)&&(LEADCONTACT_SEL="Contacts")),txt+='<div class="zcl zcl_CMS zcl_H100" id="zcl_ce">',txt+=setHiddenFlds(),txt+='<div class="zcl_table zcl_H100">',0==zcal.EMODE?(reqNote=!0,txt+='<ul><li><ul class="zcl_crevnt" id="zcl_ce_ele"><li><ul class="zcl_vwev"><li>'+ZCL_SetCrmsts()+constCommonFlds()+constCRMFlds(fieldsArr)+'</li><li class="zcl_crmnt"><div class="zcl_table"><ul><li>'+zcal.i18n.notes+'</li><li class="zcl_txr"><span class="zcl_lk" id="zcl_addnote"><i class="msi-add"></i>'+zcal.i18n.addnotes+'</span></li></ul></div><div data-marker="loadingAnimation"></div></li></ul></li></ul><li class="zcl_Cer zcl_vwCer" id="zcl_ce_ext">'+setMetaInfo()+setAttendeeInfo()+"</li></ul>"):txt+='<ul><li><ul class="zcl_crevnt" id="zcl_ce_ele"><li>'+ZCL_SetCrmsts()+constCommonFlds()+constCRMFlds(fieldsArr)+constButton()+'</li></ul></li><li class="zcl_Cer" id="zcl_ce_ext">'+setMetaInfo()+setAttendeeInfo()+"</li></ul>",txt+="</div></div>",ZCL_$("zcl_ce")?(ZCL_updEventPrevHeader("crm"),$("#zcl_ce").parent().html(txt)):ZCL_setEventWorkSpace(txt,"crm"),customFieldNames.length>0&&($("#zcl_custfldname").val(customFieldNames.join(";")),$("#zcl_custfldlbl").val(customFieldLabels.join(";"))),bindAction(),reqNote){var $loadAnimationDOM,$addNote;$addNote=$("#zcl_ce").find("span#zcl_addnote"),$addNote.length&&$addNote.off("click").on("click",function(){var $noteEle=$(this).closest("li.zcl_crmnt");_openAddNote($noteEle)}),$loadAnimationDOM=$("#zcl_ce").find("[data-marker=loadingAnimation]").removeAttr("data-marker"),zmComponent.loadingBand({container:$loadAnimationDOM[0],type:"pagination"}),$loadAnimationDOM.show();var ckey=zcal.getCalObj(crmCalId)[9],actId=zcal.EOBJ.ACTIVITYID,service=1==syncMode?"ZohoRecruit":"ZohoCrm";ZCL_uXHR("/cal/crmNotes.do?mode=list&eventId="+actId+"&service="+service+"&ckey="+ckey,function(res){$loadAnimationDOM.hide(),_updateNotes(res)})}zcal.EOBJ.ACTIVITYID&&_reqAttendees(zcal.EOBJ.ACTIVITYID)},constCRMFlds=function(fieldsArr){customFieldNames=[],customFieldLabels=[];for(var txt="",i=0;i<fieldsArr.length;i++){var sec=fieldsArr[i],fields=sec.FL,txt1="";for(var j in fields){var fld=fields[j];switch("true"==fld.customfield&&(customFieldNames.push(fld.label),customFieldLabels.push(fld.dv)),fld.type){case"Lookup":txt1+=lookupField(fld);break;case"Text":case"Email":case"Currency":case"Phone":case"Website":"Recurring Activity"!=fld.label&&"Subject"!=fld.label&&"Remind At"!=fld.label&&(txt1+=textField(fld));break;case"Date":txt1+=dateField(fld);break;case"DateTime":"Start DateTime"!=fld.label&&"End DateTime"!=fld.label&&(txt1+=dateTimeField(fld));break;case"TextArea":txt1+=textAreaField(fld);break;case"Boolean":txt1+=checkBoxField(fld);break;case"Integer":case"Double":txt1+=intField(fld);break;case"Pick List":txt1+=pickListField(fld);break;case"Multiselect Pick List":txt1+=mpickListField(fld);break;case"AutoNumber":txt1+=autoNumberField(fld);break;case"Formula":txt1+=formulaField(fld)}}txt+=txt1}return txt},setHiddenFlds=function(){var txt=ZCL_hdnFld("zcl_activityid",zcal.EOBJ.ACTIVITYID?zcal.EOBJ.ACTIVITYID:"")+ZCL_hdnFld("zcl_eid",zcal.EOBJ.EID?zcal.EOBJ.EID:"")+ZCL_hdnFld("zcl_ekey",zcal.EOBJ.EUID?zcal.EOBJ.EUID:"")+ZCL_hdnFld("zcl_crel",crmCalId)+ZCL_hdnFld("zcl_rmvatt","")+ZCL_hdnFld("zcl_crmfldname",crmFields.fieldname)+ZCL_hdnFld("zcl_crmfldtype",crmFields.fieldtype)+ZCL_hdnFld("zcl_crmfldlabel",crmFields.fieldlabel)+ZCL_hdnFld("zcl_custfldname","")+ZCL_hdnFld("zcl_custfldlbl","");return txt},constButton=function(){var txt='<ul class="zcl_frmrw"><li><div class="SC_PUbtm"><span data-marker="crmEventSave">'+zcal.i18n.save+'</span><span data-marker="crmFormClose" data-val="Cancel">'+zcal.i18n.cancel+"</span></div></li></ul>";return txt},constCommonFlds=function(){var txt=setEventTitle();return txt+=setEventScheduleTime(),txt+=setCalName()},setEventTitle=function(){var val,txt='<ul class="zcl_frmrw">';return 0==zcal.EMODE?(val=zcal.EOBJ.SUM?ZCL_getHTML(zcal.EOBJ.SUM):"",txt+='<li><div class="zcl_evttvw">'+val+"</div>"+setEventRelModuleInfo()+"</li>"):(val=zcal.EOBJ.SUM?ZCL_getHTML(zcal.EOBJ.SUM):"",txt+='<li class="zcl_W70pc"><input type="text" placeholder="Untitled event" class="zcl_crevntt SC_tiput" value="'+val+'" id="zcl_ce_tit"></li>'),txt+="</ul>"},setEventScheduleTime=function(){var tFormat=zcal.timeformat[zcal.cdata.opt.TF],aday=zcal.EOBJ.ADAY&&1==zcal.EOBJ.ADAY?!0:!1,sd=zcal.EOBJ.SD,ed=zcal.EOBJ.ED,st=aday?"8:00 am":zcal.EOBJ.ST,et=aday?"8:30 am":zcal.EOBJ.ET,tim1=st.getTimeBy(tFormat),tim2=et.getTimeBy(tFormat),de1=ZCL_splitDateVal(ZCL_putDate(sd)),de2=ZCL_splitDateVal(ZCL_putDate(ed)),ParST=ZCL_parseTime(tim1),ParET=ZCL_parseTime(tim2);if(ZCL_ESDATE=new Date(de1[2],de1[1]-1,de1[0],ParST.HH,ParST.mm,0,0),ZCL_EEDATE=new Date(de2[2],de2[1]-1,de2[0],ParET.HH,ParET.mm,0,0),0==zcal.EMODE){var dat1=ZCL_parseDateStr(sd),dat2=ZCL_parseDateStr(ed),txt='<ul class="zcl_frmrw"><li>'+dat1.dateBy("MMM dd, yyyy");return txt+=aday?sd!=ed?" - "+dat2.dateBy("MMM dd, yyyy"):"":sd!=ed?", "+tim1+" - "+dat2.dateBy("MMM dd, yyyy")+", "+tim2:", "+tim1+" - "+tim2,txt+="</li></ul>"}var ad_css=aday?'style="display:none"':"",txt='<ul class="zcl_frmrw zcl_when"><li class="zcl_select"><input class="zcl_w100 SC_tiput" type="text" value="'+ZCL_putDate(sd)+'" id="zcl_ce_sd" readonly /></li>&nbsp;&nbsp;<li class="zcl_select" '+ad_css+'><input class="zcl_w70 SC_tiput" type="text" id="zcl_ce_st" value="'+tim1+'"/></li><li class="zcl_tmto">to</li><li class="zcl_select"><input class="zcl_w100 SC_tiput" type="text" value="'+ZCL_putDate(ed)+'" id="zcl_ce_ed" readonly /></li>&nbsp;&nbsp;<li class="zcl_select" '+ad_css+'><input class="zcl_w70 SC_tiput" type="text" id="zcl_ce_et" value="'+tim2+'"/></li></ul>';return txt+='<ul class="zcl_frmrw"><li class="zcl_curpt"><i class="'+(zcal.EOBJ.ADAY&&1==zcal.EOBJ.ADAY?"msi-check":"msi-uncheck")+'" id="zcl_ce_aday"></i>'+zcal.i18n.allday+"</li></ul>"},setCalName=function(){return'<ul class="zcl_frmrw"><li><u class="zcl_grey">'+zcal.i18n.calendar+"</u><span>"+ZCL_GetCalName(crmCalId)+"</span></li></ul>"},setEventRelModuleInfo=function(){var txt="";if(0==zcal.EMODE){var moduleName,relToId="",relToName="",selMod="",assId="",assName="";relatedToModules&&relatedToModules.length>0&&(!zcal.EOBJ.SEMODULE||"Leads"!=zcal.EOBJ.SEMODULE&&"Candidates"!=zcal.EOBJ.SEMODULE?zcal.EOBJ[CONTACTNAME]&&(relToName=zcal.EOBJ[CONTACTNAME],relToId=zcal.EOBJ.CONTACTID):(relToName=zcal.EOBJ[RELATEDTO],relToId=zcal.EOBJ.RELATEDTOID)),associateModules&&associateModules.length>0&&zcal.EOBJ.SEMODULE&&"Leads"!=zcal.EOBJ.SEMODULE&&"Candidates"!=zcal.EOBJ.SEMODULE&&"Contacts"!=zcal.EOBJ.SEMODULE&&(selMod=zcal.EOBJ.SEMODULE,assId=zcal.EOBJ.RELATEDTOID?zcal.EOBJ.RELATEDTOID:"",assName=zcal.EOBJ[RELATEDTO]?zcal.EOBJ[RELATEDTO]:"",moduleName=findAssociatedModuleName(selMod)),(""!=relToName||""!=assName)&&(txt+='<div class="zcl_crminf"><span class="zcl_grey">'+ZCL_replaceString(zcal.i18n.eventfor,["</span><span>"+relToName])+"</span>",""!=txt&&""!=assName&&(txt+='<div class="zcl_SDot"></div>'),""!=assName&&(txt+='<span class="zcl_grey">'+moduleName+" </span><span>"+assName+"</span>"),txt+="</div>")}return txt},lookupField=function(field){if("Event Owner"==field.label)return"true"==field.isreadonly&&(1==syncMode?recruitUserObj=[]:crmUserObj=[]),"";var txt="";if(0==zcal.EMODE)var fLabel="";else if("Who Id"==field.label&&relatedToModules&&relatedToModules.length>0){var relToId="",relToName="",fLabel="";relatedToModules.unshift({None:zcal.i18n.none}),associateModules&&associateModules.length>0&&relatedToModules.push({Others:"Others"}),!zcal.EOBJ.SEMODULE||"Leads"!=zcal.EOBJ.SEMODULE&&"Candidates"!=zcal.EOBJ.SEMODULE?zcal.EOBJ[CONTACTNAME]&&(relToName=zcal.EOBJ[CONTACTNAME],relToId=zcal.EOBJ.CONTACTID):(relToName=zcal.EOBJ[RELATEDTO],relToId=zcal.EOBJ.RELATEDTOID);var selVal=""!=LEADCONTACT_SEL?LEADCONTACT_SEL:zcal.EOBJ.SEMODULE?"Others":"";txt+='<ul class="zcl_frmrw"><li><u>'+zcal.i18n.relatedto+"</u></li>",txt+='<li><div class="SC_select"><select id="zcl_CrmEvents_CONTACTMODULE" class="select">';for(var i=0;i<relatedToModules.length;i++){var module=relatedToModules[i];for(var modName in module)fLabel=""==fLabel&&modName==selVal?module[modName]:fLabel,txt+='<option value="'+modName+'" '+(modName==selVal?'selected="selected"':"")+">"+module[modName]+"</option>"}txt+="</select>",txt+="</div>",txt+="</li></ul>",""!=LEADCONTACT_SEL&&(txt+=relatedModule(fLabel,relToName,relToId))}else if("What Id"==field.label&&associateModules&&associateModules.length>0&&zcal.EOBJ.SEMODULE&&"Leads"!=zcal.EOBJ.SEMODULE&&"Candidates"!=zcal.EOBJ.SEMODULE&&"Contacts"!=zcal.EOBJ.SEMODULE){var selMod=zcal.EOBJ.SEMODULE,assId=zcal.EOBJ.RELATEDTOID?zcal.EOBJ.RELATEDTOID:"",assName=zcal.EOBJ[RELATEDTO]?zcal.EOBJ[RELATEDTO]:"";txt+=associateModuleSeletcion(selMod,assName,assId)}return txt},textField=function(field){var txt="",fVal=getFieldVal(field);return txt+='<ul class="zcl_frmrw"><li class="zcl_W70pc"><u>'+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+"</u>",txt+=0==zcal.EMODE||"true"==field.isreadonly?""!=fVal?fVal:"---":'<input type="text" class="zcl_crlk SC_tiput" value="'+fVal+'" id="zcl_'+field.label+'" maxlength="'+field.maxlength+'">',txt+="</li>",txt+="</ul>"},dateField=function(field){var txt=(zcal.timeformat[zcal.cdata.opt.TF],""),tVal=getFieldVal(field);if(txt+='<ul class="zcl_frmrw"><li class="zcl_select"><u>'+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+"</u>",0==zcal.EMODE||"true"==field.isreadonly)txt+=""!=tVal?tVal:"---";else{var fVal=""!=tVal?ZCL_putDate(parseDateTime(tVal,0)[0]):"";txt+='<input class="zcl_w100 SC_tiput" type="text" data-marker="dateField" value="'+fVal+'" id="zcl_'+field.label+'" readonly />'}return txt+="</li>",txt+="</ul>"},dateTimeField=function(field){var tFormat=zcal.timeformat[zcal.cdata.opt.TF],txt="",val=getFieldVal(field),dVal="",tVal=time().getTimeBy(tFormat);if(txt+='<ul class="zcl_frmrw">',0==zcal.EMODE||"true"==field.isreadonly)txt+="<li><u>"+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+"</u>"+(""!=val?val:"---")+"</li>";else{if(""!=val){var fVal=parseDateTime(val,0);dVal=ZCL_putDate(fVal[0]),tVal=fVal[1].getTimeBy(tFormat)}txt+='<li class="zcl_select"><u>'+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+'</u><input class="zcl_w100 SC_tiput zcl_m20" type="text" data-marker="dateField" value="'+dVal+'" id="zcl_'+field.label+'" readonly /><input class="zcl_w70 SC_tiput" type="text" data-marker="timeField" id="zcl_'+field.label+'_time" value="'+tVal+'"/></li>'}return txt+="</ul>"},textAreaField=function(field){var fVal=getFieldVal(field),txt="";return txt+='<ul class="zcl_frmrw"><li class="zcl_W70pc"><u>'+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+"</u>",txt+=0==zcal.EMODE||"true"==field.isreadonly?""!=fVal?ZCL_getDescHTML(fVal):"---":'<textarea style="height:44px;" class="zcl_Cedes SC_tiput" id="zcl_'+field.label+'">'+fVal+"</textarea>",txt+="</li>",txt+="</ul>"},checkBoxField=function(field){var fVal="true"==getFieldVal(field)?!0:!1,txt="";return txt+='<ul class="zcl_frmrw"><li class="zcl_curpt">',0==zcal.EMODE||"true"==field.isreadonly?(txt+="<u>"+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+"</u>",txt+=fVal?zcal.i18n.yes:"---"):(txt+='<i class="'+(fVal?"msi-check":"msi-uncheck")+'" data-marker="chkboxField" id="zcl_'+field.label+'"></i>',txt+=(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv),txt+="</li>",txt+="</ul>"},intField=function(field){var fVal=getFieldVal(field),txt="";return txt+='<ul class="zcl_frmrw"><li class="zcl_W70pc"><u>'+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+"</u>",txt+=0==zcal.EMODE||"true"==field.isreadonly?""!=fVal?fVal:"---":'<input class="zcl_w70 SC_tiput" type="text" id="zcl_'+field.label+'" value="'+fVal+'" maxlength="'+field.maxlength+'"/>',txt+="</li>",txt+="</ul>"},pickListField=function(field){var fVal=getFieldVal(field),selectionList=field.val,txt="";if(txt+='<ul class="zcl_frmrw"><li><u>'+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+"</u>",0==zcal.EMODE||"true"==field.isreadonly)txt+=""!=fVal?fVal:"---";else{txt+='<div class="SC_select"><select id="zcl_'+field.label+'" class="select">';for(var i=0;i<selectionList.length;i++)txt+=selectionList[i].content&&selectionList[i].default?'<option value="'+selectionList[i].content+'" selected="true">'+selectionList[i].content+"</option>":'<option value="'+selectionList[i]+'" '+(selectionList[i]==fVal?"selected":"")+">"+selectionList[i]+"</option>";txt+="</select>",txt+="</div>"}return txt+="</li>",txt+="</ul>"},mpickListField=function(field){var fVal=getFieldVal(field),selectionList=field.val,txt="";if(txt+='<ul class="zcl_frmrw"><li class="zcl_W70pc"><u>'+(1==zcal.EMODE&&"true"==field.req?"&#42;":"")+field.dv+"</u>",0==zcal.EMODE||"true"==field.isreadonly)txt+=""!=fVal?fVal:"---";else{var tVal=""!=fVal?fVal+";":"";txt+='<div class="SC_select"><select id="zcl_'+field.label+'" class="select" multiple="multiple" style="height:auto">';for(var i=0;i<selectionList.length;i++)txt+=selectionList[i].content&&selectionList[i].default?'<option value="'+selectionList[i].content+'" selected="true">'+selectionList[i].content+"</option>":'<option value="'+selectionList[i]+'" '+(-1!=tVal.indexOf(selectionList[i]+";")?"selected='true'":"")+">"+selectionList[i]+"</option>";txt+="</select>",txt+="</div>"}return txt+="</li>",txt+="</ul>"},autoNumberField=function(field){var txt="";if(0==zcal.EMODE){var fVal=getFieldVal(field);txt+='<ul class="zcl_frmrw"><li><u>'+field.dv+"</u>"+(""!=fVal?fVal:"---")+"</li></ul>"}return txt},formulaField=function(field){var txt="";if(0==zcal.EMODE){var fVal=getFieldVal(field);txt+='<ul class="zcl_frmrw"><li><u>'+field.dv+"</u>"+(""!=fVal?fVal:"---")+"</li></ul>"}return txt},getFieldVal=function(fld){return"true"==fld.customfield?zcal.EOBJ[fld.dv]?zcal.EOBJ[fld.dv]:"":zcal.EOBJ[fld.label]?zcal.EOBJ[fld.label]:""},setMetaInfo=function(){var _ownerName=zcal.EOBJ.ORGM?zcal.EOBJ.ORGM:1==syncMode?recruitCUser.Name:crmCUser.Name,_ownerId=zcal.EOBJ.SMOWNERID?zcal.EOBJ.SMOWNERID:1==syncMode?recruitCUser.USERID:crmCUser.USERID,txt='<ul class="zcl_vwmeta"><li><span onclick="ZCL_tgleNxtEle(this)"><i class="msi-barrow"></i>'+zcal.i18n.eventinfo+"</span></li>";if(txt+='<li><div class="zcl_table">',txt+="<ul><li>"+(zcal.EOBJ.ORG_PH?'<img src="'+zcal.EOBJ.ORG_PH+'"/>':"")+"</li><li><b>"+zcal.i18n.organizer,txt+='</b><span class="zcl_lk" id="zcl_ownerName">'+ZCL_getHTML(_ownerName)+'</span><input type="hidden" value="'+_ownerId+'" id="zcl_ownerId"/></li></ul>',zcal.EOBJ.ACTIVITYID){var ctime=zcal.EOBJ.CRETIME.split(","),mtime=zcal.EOBJ.LSTMODTIME.split(",");txt+="<ul><li>"+(zcal.EOBJ.CREBY_PH?'<img src="'+zcal.EOBJ.CREBY_PH+'">':"")+"</li><li>"+(zcal.EOBJ.CREBY?"<b>"+zcal.i18n.createdby+'</b><span class="zcl_lk">'+zcal.EOBJ.CREBY+"</span>":"<b>"+zcal.i18n.createdon+"</b>")+"<u>"+ZCL_parseDateStr(ctime[1]).dateBy("NNN dd, yyyy")+" @ "+ZCL_parseTime(ctime[2]).HH+":"+ZCL_parseTime(ctime[2]).mm+"</u></li></ul>",txt+="<ul><li>"+(zcal.EOBJ.MODBY_PH?'<img src="'+zcal.EOBJ.MODBY_PH+'"/>':"")+"</li><li>"+(zcal.EOBJ.MODBY?"<b>"+zcal.i18n.modifiedby+'</b><span class="zcl_lk">'+zcal.EOBJ.MODBY+"</span>":"<b>"+zcal.i18n.modifiedon+"</b>")+"<u>"+ZCL_parseDateStr(mtime[1]).dateBy("NNN dd, yyyy")+" @ "+ZCL_parseTime(mtime[2]).HH+":"+ZCL_parseTime(mtime[2]).mm+"</u></li></ul>"}return txt+="</div></li></ul>"},setAttendeeInfo=function(){var txt='<ul class="zcl_frmrw" id="zcl_crmatt_info"><li class="zcl_att"><u>'+zcal.i18n.attendees+"</u>";return 1==zcal.EMODE&&(txt+='<ul class="zcl_frmrw zcl_pddbz"><li class="zcl_atte"><div id="zcl_crmatt"><input type="text" id="zcl_ce_att_tbox" class="zm_sgst" placeholder="'+zcal.i18n.typeaemailid+'"></div></li></ul>'),txt+="</li>",txt+='<div><div class="zcl_viwatlst zcl_table" id="attlist"></div></div></ul>'},parseDateTime=function(dVal,add){if(dVal){var yyyy=dVal.substring(0,4),MM=dVal.substring(5,7),dd=dVal.substring(8,10),HH=dVal.substring(11,13),mm=dVal.substring(14,16);return[yyyy+MM+dd,HH+mm]}var hrs,min,st,d1=new Date;return d1.setTime(zcal.cdata.opt.DATE),hrs=d1.getHours(),min=d1.getMinutes(),st=2*hrs+(min>30?2:1),st=st>46?46:st,[d1.dateBy("yyyyMMdd"),zcal.TTT[st+add]]},time=function(){var d1=new Date,hrs=d1.getHours(),min=d1.getMinutes(),st=2*hrs+(min>30?2:1);return st=st>46?46:st,zcal.TTT[st]},bindAction=function(){var $relTo,$assMod,crmForm=$("#zcl_ce"),_sdEle=ZCL_$("zcl_ce_sd"),_edEle=ZCL_$("zcl_ce_ed");if(_stEle=ZCL_$("zcl_ce_st"),_etEle=ZCL_$("zcl_ce_et"),$allday=crmForm.find("#zcl_ce_aday"),$dateField=crmForm.find("[data-marker=dateField]"),$timeField=crmForm.find("[data-marker=timeField]"),$chkboxField=crmForm.find("[data-marker=chkboxField]"),$searchIcon=crmForm.find(".msi-search"),$crmAtt=crmForm.find("#zcl_crmatt"),$attAdd=$("#zcl_crmatt_info").find("[data-marker=attendeeAdd]"),$saveBtn=crmForm.find("[data-marker=crmEventSave]"),$closeBtn=crmForm.find("[data-marker=crmFormClose]"),_sdEle&&ZEVENTS(_sdEle.parentNode).picker("date",{dform:zcal.DFORMAT[zcal.cdata.opt.DF],refer:"zcl_ce_sd",wkst:0,mode:"popup",update:"yes",minhgt:251}).on("dateclick",function(){ZCL_calcEed(_sdEle)}).bind(),_edEle&&ZEVENTS(_edEle.parentNode).picker("date",{dform:zcal.DFORMAT[zcal.cdata.opt.DF],refer:"zcl_ce_ed",wkst:0,mode:"popup",update:"yes",minhgt:251}).on("dateclick",function(){ZCL_setEed(_edEle)}).bind(),_stEle&&ZEVENTS(_stEle).picker("time",{tform:zcal.timeformat[zcal.cdata.opt.TF],refer:"zcl_ce_st"}).on("change",function(){ZCL_calcEed(_stEle,!0)}).bind(),_etEle&&ZEVENTS(_etEle).picker("time",{tform:zcal.timeformat[zcal.cdata.opt.TF],refer:"zcl_ce_et"}).on("change",function(){ZCL_setEed(_etEle,!0)}).bind(),$allday.length>0&&$allday.parent().off("click").on("click",function(){ZCL_ChgChk(this),ZCL_checkAll()}),$dateField.length>0){$dateField.removeAttr("data-marker");for(var i=0;i<$dateField.length;i++){var dField=$dateField[i];ZEVENTS(dField).picker("date",{dform:zcal.DFORMAT[zcal.cdata.opt.DF],refer:dField.id,wkst:0,mode:"popup",update:"yes",minhgt:251}).bind()}}if($timeField.length>0){$timeField.removeAttr("data-marker");for(var i=0;i<$timeField.length;i++){var tField=$timeField[i];ZEVENTS(tField).picker("time",{tform:zcal.timeformat[zcal.cdata.opt.TF],refer:tField.id}).bind()}}$chkboxField.length>0&&($chkboxField.removeAttr("data-marker"),$chkboxField.parent().off("click").on("click",function(){ZCL_ChgChk(this)})),$relTo=crmForm.find("#zcl_CrmEvents_CONTACTMODULE"),$relTo.length>0&&$relTo.off("change").on("change",function(){var selVal=this.value,$ele=$(this);switch(selVal){case"Leads":case"Candidates":removeSelection($ele),setLeadSelection($ele);break;case"Contacts":removeSelection($ele),setContactSelection($ele);break;case"Others":removeSelection($ele),setAssociateModuleSelection($ele);break;case"None":removeSelection($ele)}}),$assMod=crmForm.find("#zcl_CrmEvents_SEMODULE"),$assMod.length>0&&$assMod.off("change").on("change",function(){$("#zcl_CrmEvents_SEID").val(""),$("#zcl_CrmEvents_SENAME").val("")}),$searchIcon.length>0&&$searchIcon.off("click").on("click",function(){var module,$ele=$(this),fname=$ele.data("fname"),fid=$ele.data("fid");if("zcl_CrmEvents_SEID"===fid?module=$("#zcl_CrmEvents_SEMODULE").val():"zcl_CrmEvents_CONTACTID"===fid&&(module=$("#zcl_CrmEvents_CONTACTMODULE").val()),module){var serviceName=document.location.hostname.startsWith("zmail")?"mail":"zmail",_url=(1==syncMode?zcal.ZRECRUIT+"/recruit":zcal.ZCRM+"/crm")+"/Search.do?service="+serviceName+"&searchmodule="+module+"&fldName="+fname+"&fldId="+fid+"&fldValue=",wTop=(document.body.offsetHeight-400)/2,wLeft=(document.body.offsetWidth-700)/2;window.addEventListener("message",function(event){handleMessage(event,{fldName:fname,fldId:fid,module:module}),this.removeEventListener("message",arguments.caller?arguments.caller.callee:arguments.callee)},!1),window.open(_url,"calwindow","menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes,width=700,height=400,left="+wLeft+",top="+wTop)}}),$crmAtt.length>0&&($("#zcl_ce_att_tbox").on("keydown",function(event){if(13==event.keyCode&&"zcl_ce_att_tbox"==this.id){for(var attArr=this.value.split(","),z=0;z<attArr.length;z++){var _emlid=attArr[z].trim(),idx1=_emlid.indexOf("<"),idx2=_emlid.indexOf(">");idx1>-1&&idx2>-1&&(_emlid=_emlid.substring(idx1+1,idx2)),_emlid=_emlid.replace(/,/g,"")}if(ZCL_isEmail(_emlid)){var data={};data.id=_emlid,ZCL_attCRMCont(data),$("#zcl_ce_att_tbox").val("")}}}),zmAppLoader.load("zmContactsAutoComplete").done(function(){zmContactsAutoComplete.autoComplete({input:$("#zcl_ce_att_tbox")[0],contactType:["org","crm"],excludeMe:!0,exclude:function(){var email=[];if($("#attlist")[0].childNodes){var attl=$("#attlist")[0].childNodes;for(var i in attl)email.push(attl[i].id)}return email},onSelect:function(event,data){var data=data.item.attributes;ZCL_attCRMCont(data)}})}),$attAdd.length>0&&$attAdd.off("click").on("click",function(){var attEmails=ZCL_getAttendee($("#attlist"));if(""!=attEmails){var _url,activityId=$("#zcl_activityid").val(),service=1==syncMode?"ZohoRecruit":"ZohoCrm",ckey=zcal.getCalObj(crmCalId)[9];_url="/cal/crmInvitees.do?mode=add&eventId="+activityId+"&service="+service+"&att="+attEmails.zcalescape()+"&ckey="+ckey,ZCL_XHR(_url,function(res){var _aobj=ZCL_Evl(1,res.responseText);_updateAttendees(_aobj,activityId)})}})),$saveBtn.length>0&&$saveBtn.off("click").on("click",function(){saveEvent()}),$closeBtn.length>0&&$closeBtn.off("click").on("click",function(){reset(),ZCL_eClose()})},ZCL_attCRMCont=function(data){var div=$("#attlist"),nDiv=document.createElement("ul");data.zid&&nDiv.setAttribute("data-zid",data.zid),nDiv.setAttribute("id",data.id),nDiv.setAttribute("class","zcl_sl"),nDiv.innerHTML="<li>"+(data.profileImage?"<img src="+data.profileImage+">":"<img src="+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+">")+"</li><li><b>"+data.id+'</b></li><li class="zcl_txr"><i class="msi-close" onclick="ZCL_rmvAtt(this,\''+data.id+'\')" title="Remove" ></i></li>',$("#zcl_crm_attlist")[0]?(nDiv.innerHTML="<li>"+(data.profileImage?"<img src="+data.profileImage+">":"<img src="+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+">")+"</li><li><b>"+data.id+'</b></li><li><i class="msi-close" onclick="ZCL_rmvAtt(this,\''+data.id+'\')" title="Remove" ></i></li>',$("#zcl_crm_attlist").prepend(div.append($(nDiv)))):(nDiv.innerHTML="<li>"+(data.profileImage?"<img src="+data.profileImage+">":"<img src="+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+">")+"</li><li><b>"+data.id+'</b></li><li class="zcl_txr"><i class="msi-close" onclick="ZCL_rmvAtt(this,\''+data.id+'\')" title="Remove" ></i></li>',div.append($(nDiv))),$("#zcl_ce_att_tbox").val("")},relatedModule=function(fieldLabel,fVal,relToId){var txt='<ul class="zcl_frmrw"><li><u>'+fieldLabel+'</u><input type="text" class="zcl_w200 SC_tiput zcl_m10" id="zcl_CrmEvents_CONTACTNAME" value="'+fVal+'" readonly><input type="hidden" value="'+relToId+'" id="zcl_CrmEvents_CONTACTID"><i class="msi-search" data-fname="zcl_CrmEvents_CONTACTNAME" data-fid="zcl_CrmEvents_CONTACTID"></i></li></ul>';return txt},setLeadSelection=function($ele){var searchIcon,leadEle,fieldLabel=$ele.find("option:selected").text(),relToId="",relToName="";!zcal.EOBJ.SEMODULE||"Leads"!=zcal.EOBJ.SEMODULE&&"Candidates"!=zcal.EOBJ.SEMODULE||(relToId=zcal.EOBJ.RELATEDTOID,relToName=zcal.EOBJ[RELATEDTO]),leadEle=$(relatedModule(fieldLabel,relToName,relToId)),searchIcon=leadEle.find(".msi-search"),searchIcon.off("click").on("click",function(){var serviceName=document.location.hostname.startsWith("zmail")?"mail":"zmail",_url=(1==syncMode?zcal.ZRECRUIT+"/recruit":zcal.ZCRM+"/crm")+"/Search.do?service="+serviceName+"&searchmodule=Leads&fldName=zcl_CrmEvents_CONTACTNAME&fldId=zcl_CrmEvents_CONTACTID&fldValue=",wTop=(document.body.offsetHeight-400)/2,wLeft=(document.body.offsetWidth-700)/2;window.addEventListener("message",function(event){handleMessage(event,{fldName:"zcl_CrmEvents_CONTACTNAME",fldId:"zcl_CrmEvents_CONTACTID",module:"Leads"}),this.removeEventListener("message",arguments.caller?arguments.caller.callee:arguments.callee)},!1),window.open(_url,"calwindow","menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes,width=700,height=400,left="+wLeft+",top="+wTop)}),$ele.parents("ul.zcl_frmrw").after(leadEle)},handleMessage=function(event,moduleObj){var origin=event.origin||event.originalEvent.origin,crmDomain=document.location.protocol+zcal.ZCRM.substring(zcal.ZCRM.indexOf("//"));if(origin===crmDomain){event.source.close(),ZCL_$(moduleObj.fldName).value="PriceBooks"===moduleObj.module?event.data.pbname:event.data.fldName,ZCL_$(moduleObj.fldId).value=event.data.fldId;var assModule=$("#zcl_CrmEvents_SEMODULE");event.data.acName&&"null"!=event.data.acName&&assModule.length>0&&"Accounts"===assModule.val()&&(ZCL_$("zcl_CrmEvents_SEID").value=event.data.acId,ZCL_$("zcl_CrmEvents_SENAME").value=event.data.acName)}},setContactSelection=function($ele){var searchIcon,contactEle,fieldLabel=$ele.find("option:selected").text(),relToId="",relToName="";zcal.EOBJ[CONTACTNAME]&&(relToName=zcal.EOBJ[CONTACTNAME],relToId=zcal.EOBJ.CONTACTID),contactEle=$(relatedModule(fieldLabel,relToName,relToId)),searchIcon=contactEle.find(".msi-search"),searchIcon.off("click").on("click",function(){var serviceName=document.location.hostname.startsWith("zmail")?"mail":"zmail",_url=(1==syncMode?zcal.ZRECRUIT+"/recruit":zcal.ZCRM+"/crm")+"/Search.do?service="+serviceName+"&searchmodule=Contacts&fldName=zcl_CrmEvents_CONTACTNAME&fldId=zcl_CrmEvents_CONTACTID&fldValue=",wTop=(document.body.offsetHeight-400)/2,wLeft=(document.body.offsetWidth-700)/2;window.addEventListener("message",function(event){handleMessage(event,{fldName:"zcl_CrmEvents_CONTACTNAME",fldId:"zcl_CrmEvents_CONTACTID",module:"Contacts"}),this.removeEventListener("message",arguments.caller?arguments.caller.callee:arguments.callee)},!1),window.open(_url,"calwindow","menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes,width=700,height=400,left="+wLeft+",top="+wTop)}),$ele.parents("ul.zcl_frmrw").after(contactEle),setAssociateModuleSelection($("#zcl_CrmEvents_CONTACTID"))},setAssociateModuleSelection=function($ele){if(associateModules&&associateModules.length>0){var assModSel,selMod="",assName="",assId="";zcal.EOBJ.SEMODULE&&"Leads"!=zcal.EOBJ.SEMODULE&&"Candidates"!=zcal.EOBJ.SEMODULE&&"Contacts"!=zcal.EOBJ.SEMODULE&&(selMod=zcal.EOBJ.SEMODULE,assName=zcal.EOBJ[RELATEDTO],assId=zcal.EOBJ.RELATEDTOID),assModSel=$(associateModuleSeletcion(selMod,assName,assId));var $assMod=assModSel.find("#zcl_CrmEvents_SEMODULE"),$searchIcon=assModSel.find(".msi-search");$assMod.length>0&&$assMod.off("change").on("change",function(){$("#zcl_CrmEvents_SENAME").val(""),$("#zcl_CrmEvents_SEID").val("")}),$searchIcon.off("click").on("click",function(){var serviceName=document.location.hostname.startsWith("zmail")?"mail":"zmail",module=$("#zcl_CrmEvents_SEMODULE").val(),_url=(1==syncMode?zcal.ZRECRUIT+"/recruit":zcal.ZCRM+"/crm")+"/Search.do?service="+serviceName+"&searchmodule="+module+"&fldName=zcl_CrmEvents_SENAME&fldId=zcl_CrmEvents_SEID&fldValue=",wTop=(document.body.offsetHeight-400)/2,wLeft=(document.body.offsetWidth-700)/2;window.addEventListener("message",function(event){handleMessage(event,{fldName:"zcl_CrmEvents_SENAME",fldId:"zcl_CrmEvents_SEID",module:m}),this.removeEventListener("message",arguments.caller?arguments.caller.callee:arguments.callee)},!1),window.open(_url,"calwindow","menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes,width=700,height=400,left="+wLeft+",top="+wTop)}),$ele.parents("ul.zcl_frmrw").after(assModSel)}},associateModuleSeletcion=function(selMod,assName,assId){var txt='<ul class="zcl_frmrw"><li><div class="SC_select"><select class="select" id="zcl_CrmEvents_SEMODULE">'+associateModuleOption(selMod)+'</select><div/></li><li><input type="text" class="zcl_crlk SC_tiput" id="zcl_CrmEvents_SENAME" value="'+assName+'"/><input type="hidden" value="'+assId+'" id="zcl_CrmEvents_SEID"/></li><li><i class="msi-search" data-fname="zcl_CrmEvents_SENAME" data-fid="zcl_CrmEvents_SEID"></i></li></ul>';return txt},findAssociatedModuleName=function(selMod){for(var module,moduleName="",i=0;i<associateModules.length;i++){module=associateModules[i];for(var modName in module)if(modName==selMod){moduleName=module[modName];break}if(""!=moduleName)break}return moduleName},associateModuleOption=function(selMod){for(var module,txt="",i=0;i<associateModules.length;i++){module=associateModules[i];for(var modName in module)txt+='<option value="'+modName+'" '+(modName==selMod?'selected="selected"':"")+">"+module[modName]+"</option>"}return txt},removeSelection=function(){$("#zcl_CrmEvents_CONTACTID").parents("ul.zcl_frmrw").remove(),$("#zcl_CrmEvents_SEID").parents("ul.zcl_frmrw").remove()},saveEvent=function(){if(!ZCL_crmFormValidate())return!1;var leContModSel,modSel,obj,isAllday=$("#zcl_ce_aday").hasClass("msi-check"),st=isAllday?"00:00":$("#zcl_ce_st").val(),et=isAllday?"00:00":$("#zcl_ce_et").val();obj={EID:ZCL_$("zcl_eid").value,EUID:ZCL_$("zcl_ekey").value,EPERM:2,DPERM:2,SD:ZCL_$("zcl_ce_sd").value,ST:ZCL_TimetoNo(st),ED:ZCL_$("zcl_ce_ed").value,ET:ZCL_TimetoNo(et),ATT:ZCL_getAttendee($("#attlist")),RMVATT:ZCL_$("zcl_rmvatt").value,ADAY:isAllday?1:0,CNAME:ZCL_$("zcl_crel").value,SUM:ZCL_$("zcl_ce_tit").value,LOC:ZCL_$("zcl_Venue")?ZCL_$("zcl_Venue").value:"",EC:-1,ETZ:"",LINK:"",ETSK:0,ECRM:0,ENTS:0,EMET:0,EMIL:0};var f="/cal/crmAddEvent.do?Subject="+obj.SUM.zcalescape()+"&all="+obj.ADAY+"&dateformat="+zcal.DFORMAT[zcal.cdata.opt.DF]+"&Start DateTime="+ZCL_$("zcl_ce_sd").value+"&Start DateTime_time="+ZCL_TimetoNo(st)+"&End DateTime="+ZCL_$("zcl_ce_ed").value+"&End DateTime_time="+ZCL_TimetoNo(et)+"&ownerId="+ZCL_$("zcl_ownerId").value+"&ownerName="+ZCL_$("zcl_ownerName").innerHTML+(ZCL_$("zcl_Venue")?"&Venue="+ZCL_$("zcl_Venue").value.zcalescape():"")+(ZCL_$("zcl_Description")?"&Description="+ZCL_$("zcl_Description").value.zcalescape():"")+(obj.ATT?"&att="+obj.ATT.zcalescape():"")+(obj.RMVATT?"&rmatt="+obj.RMVATT.zcalescape():"");if(leContModSel=ZCL_$("zcl_CrmEvents_CONTACTMODULE")?ZCL_$("zcl_CrmEvents_CONTACTMODULE").value:"None","None"!=leContModSel&&"Others"!=leContModSel&&(f+=""!=ZCL_$("zcl_CrmEvents_CONTACTNAME").value?"&leContModSel="+leContModSel+"&leContModId="+ZCL_$("zcl_CrmEvents_CONTACTID").value:""),modSel=ZCL_$("zcl_CrmEvents_SEMODULE")?ZCL_$("zcl_CrmEvents_SEMODULE").value:"",""==modSel||"None"!=leContModSel&&"Leads"==leContModSel&&"Candidates"==leContModSel||(f+=""!=ZCL_$("zcl_CrmEvents_SENAME").value?"&modsel="+modSel+"&modid="+ZCL_$("zcl_CrmEvents_SEID").value:""),f+="&Send Notification Email=false&Recurring Activity=false",ZCL_$("zcl_custfldname")&&""!=ZCL_$("zcl_custfldname").value){for(var cflds=ZCL_$("zcl_custfldname").value.split(";"),cfldlbl=ZCL_$("zcl_custfldlbl").value.split(";"),cfldVal="",i=0;i<cflds.length;i++)if(-1!=cflds[i].indexOf("boolean")){if(ZCL_$("zcl_"+cflds[i])){var val="msi-check"==ZCL_$("zcl_"+cflds[i]).className?"true":"false";f+="&"+cflds[i]+"="+val,cfldVal+=(""!=cfldVal?",":"")+'"'+cflds[i]+'":"'+cfldlbl[i]+'"'}}else if(-1!=cflds[i].indexOf("datetime"))ZCL_$("zcl_"+cflds[i])&&(f+="&"+cflds[i]+"="+ZCL_$("zcl_"+cflds[i]).value,cfldVal+=(""!=cfldVal?",":"")+'"'+cflds[i]+'":"'+cfldlbl[i]+'"',f+="&"+cflds[i]+"_time="+ZCL_TimetoNo(ZCL_$("zcl_"+cflds[i]+"_time").value));else if(-1!=cflds[i].indexOf("mselect")){if(ZCL_$("zcl_"+cflds[i])){for(var s=ZCL_$("zcl_"+cflds[i]),val="",j=0;j<s.length;j++)1==s[j].selected&&(val+=""==val?s[j].value:";"+s[j].value);f+="&"+cflds[i]+"="+val,cfldVal+=(""!=cfldVal?",":"")+'"'+cflds[i]+'":"'+cfldlbl[i]+'"'}}else{if(-1!=cflds[i].indexOf("anumber")||-1!=cflds[i].indexOf("formula"))continue;ZCL_$("zcl_"+cflds[i])&&(f+="&"+cflds[i]+"="+ZCL_$("zcl_"+cflds[i]).value.zcalescape(),cfldVal+=(""!=cfldVal?",":"")+'"'+cflds[i]+'":"'+cfldlbl[i]+'"')}cfldVal=""!=cfldVal?"{"+cfldVal+"}":cfldVal,f+=""!=cfldVal?"&customFlds="+encodeURIComponent(cfldVal):""}obj.EID&&(f+="&eid="+obj.EID+"&ekey="+obj.EUID),f+="&mstart="+zcal.mlimit[0].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF])+"&mend=",f+=zcal.mlimit[1].dateBy(zcal.DFORMAT[zcal.cdata.opt.DF]);var cObj=zcal.getCalObj(ZCL_$("zcl_crel").value);f+="&ckey="+cObj[9],null!=ZCL_OLD_COBJ&&(f+="&oldckey="+ZCL_OLD_COBJ[9],f+="&oldctype="+ZCL_OLD_COBJ[5]),ZCL_TEMP_EOBJ=obj,ZCL_XHR(f,function(res){ZCL_retDET(res)})},fetchCRMUsers=function(){if(-1!=zcal.cdata.calOUids.indexOf("zohoCrm_")){if(null==crmCalId)for(var cid in zcal.cdata.calALst)zcal.cdata.calALst.hasOwnProperty(cid)&&zcal.cdata.calALst[cid][10][2].startsWith("zohoCrm_")&&(crmCalId=cid);ZCL_uXHR("/cal/getCRMUsers.do?ckey="+zcal.cdata.calALst[crmCalId][9],function(res){updateUserObj(res)})}-1!=zcal.cdata.calOUids.indexOf("zohoRecruit4_")&&ZCL_uXHR("/cal/getCRMUsers.do?service=ZohoRecruit",function(res){updateUserObj(res)})},updateUserObj=function(res){var uobj=JSON.parse(res.responseText);"success"==uobj.status&&("recruit"==uobj.mode?(recruitUserObj=uobj.uobj,recruitCUser=uobj.cuser):(crmUserObj=uobj.uobj,crmCUser=uobj.cuser,crmCCode=uobj.ccode,ZCL_updateCalAndEvents()))},getCRMCurrentUser=function(){return crmCUser},getRecruitCurrentUser=function(){return recruitCUser},getCRMColorCode=function(){return crmCCode},getCRMCalChild=function(cno,pid){var calChild={};for(var id in crmCCode){var colorarr=ZCL_getCalColor(cno),clrno=ZCL_getColorNo(colorarr[0]);"OTHERS"==id&&(clrno=19==clrno?0:clrno+1,colorarr=ZCL_getCalColor(clrno)),calChild["zcrm_"+id]={CN:crmCCode[id][0],STS:crmCCode[id][2],CC:colorarr[1],ID:"zcrm_"+id,HC:0,SE:"OTHERS"==id?"2":"1"},zcal.appCount["zcrm_"+id]={c:"0",p:pid}}return calChild},chgUserSts=function(calId){for(var id in crmCCode)if(id==calId){crmCCode[id][2]="0"==crmCCode[id][2]?"1":"0",ZCL_updateCalAndEvents();break}},_updateNotes=function(res){var nobj=ZCL_Evl(1,res.responseText);if("list"==nobj.mode)_listNotes(nobj.notes);else if("add"==nobj.mode){if("success"==nobj.status){var $note,$firstNote,noteObj=nobj.nobj;$("div#zcl_addnoteform").remove(),$("#zcl_addnote").parent().show(),$note=_constNote(noteObj),$firstNote=$("#zcl_crm_noteslst").find("li:first"),$firstNote.length>0?$firstNote.before($note):$("#zcl_crm_noteslst").append($note)}}else if("edit"==nobj.mode){if("success"==nobj.status){var $note,noteObj=nobj.nobj,$noteLi=$("li#zcl_crmnote_"+noteObj.id);$("div#zcl_addnoteform").remove(),$("#zcl_addnote").parent().show(),$note=$("<div>"+(noteObj.Title?"<b>"+noteObj.Title+"</b>":"")+"<p>"+ZCL_getDescHTML(noteObj["Note Content"])+"</p></div>"),$noteLi.find("div:first").replaceWith($note),$noteLi.find(".zcl_txr").show()}}else"del"==nobj.mode&&"success"==nobj.status&&$("#zcl_crmnote_"+nobj.noteid).remove()},_listNotes=function(notesList){var nlistEle;if($("#zcl_crm_noteslst").length||$("#zcl_ce").find("li.zcl_crmnt").append('<ul id="zcl_crm_noteslst"/>'),nlistEle=$("#zcl_ce").find("#zcl_crm_noteslst"),nlistEle.length)for(var i=0;i<notesList.length;i++)nlistEle.append(_constNote(notesList[i]))},_constNote=function(noteObj){var $note,$edit,$del,ntxt="";return ntxt+='<li id="zcl_crmnote_'+noteObj.id+'"><div>'+(noteObj.Title?"<b>"+noteObj.Title+"</b>":"")+"<p>"+ZCL_getDescHTML(noteObj["Note Content"])+'</p></div><div class="zcl_table"><ul><li><span class="zcl_lk">'+noteObj["Owner Name"]+'</spam><span class="zcl_grey">'+noteObj["Created Time"]+'</span></li><li class="zcl_txr"><i class="msi-edit"></i><span></span><i class="msi-trash"></i></li></ul></div></li>',$note=$(ntxt),$edit=$note.find("i.msi-edit"),$edit.length&&$edit.off("click").on("click",{title:noteObj.Title||"",content:noteObj["Note Content"],id:noteObj.id},function(ev){_openEditNote($(this).parent(),ev.data.id,ev.data.title,ev.data.content)}),$del=$note.find("i.msi-trash"),$del.length&&$del.off("click").on("click",function(){var noteId=noteObj.id,service=1==syncMode?"ZohoRecruit":"ZohoCrm",ckey=zcal.getCalObj(crmCalId)[9];ZCL_XHR("/cal/crmNotes.do?mode=del&noteId="+noteId+"&service="+service+"&ckey="+ckey,function(res){_updateNotes(res)})}),$note},_openEditNote=function($ele,id,title,content){$ele.hide();var $addNoteForm,$noteEle=$ele.closest("li#zcl_crmnote_"+id);$addNoteForm=$("#zcl_addnoteform"),$addNoteForm.length&&("zcl_crm_noteslst"==$addNoteForm.parent().parent().attr("id")&&($addNoteForm.parent().find("div:first").show(),$addNoteForm.parent().find("li.zcl_txr").show()),$addNoteForm.remove()),$noteEle.length&&($noteEle.find("div:first").hide(),_openAddNote($noteEle,id,title,content))},_noteSelOption=function(selVal){for(var txt="",noteTypes=crmFields.notetype,i=0;i<noteTypes.length;i++){var note=noteTypes[i];txt+='<option value="'+note.id+'" '+(selVal==note.name?'selected="selected"':"")+">"+note.name+"</option>"}return txt},setNoteType=function(selVal){if(1==syncMode){{var txt;crmFields.notetype}return txt='<div class="SC_select"><select id="zcl_crmnote_title" class="select">'+_noteSelOption(selVal)+"</select></div>"}return'<input type="text" class="zcl_crlk SC_tiput" id="zcl_crmnote_title" value="'+(selVal||"")+'">'},_openAddNote=function($ele,id,title,content){var $addNoteForm,$save,$cancel,$addNote=$("#zcl_ce").find("span#zcl_addnote");$addNote.parent().hide();var txt='<div class="zcl_crmntad" id="zcl_addnoteform"><input type="hidden" id="zcl_crmnote_id" value="'+(id||"")+'"/><ul class="zcl_frmrw"><li><u>'+zcal.i18n.title+"</u>"+setNoteType(title)+'</li></ul><ul class="zcl_frmrw"><li><u>'+zcal.i18n.content+'</u><textarea style="height: 49px;" class="zcl_Cedes SC_tiput" id="zcl_crmnote_content">'+(content||"")+'</textarea></li></ul><ul class="zcl_frmrw"><li><div class="SC_PUbtm"><span data-marker="saveNote">'+zcal.i18n.save+'</span><span data-marker="closeNote" data-val="Cancel">'+zcal.i18n.cancel+"</span></div></li></ul></div>";$addNoteForm=$(txt),$save=$addNoteForm.find("[data-marker=saveNote]").removeAttr("data-marker"),$save.length&&$save.off("click").on("click",function(){validateAndSaveNote()}),$cancel=$addNoteForm.find("[data-marker=closeNote]").removeAttr("data-marker"),$cancel.length&&$cancel.off("click").on("click",function(){$(this).parents("div#zcl_addnoteform").remove(),$addNote.parent().show(),$ele.find("div:first").show(),$ele.find("li.zcl_txr").show()}),$ele.find("div:first").after($addNoteForm)},validateAndSaveNote=function(){return""==$("#zcl_crmnote_title").val()?(zmUtil.succErrMsg("e","Please enter note title"),ZCL_$("zcl_crmnote_title").focus(),!1):""==$("#zcl_crmnote_content").val()?(zmUtil.succErrMsg("e","Please enter note content"),ZCL_$("zcl_crmnote_content").focus(),!1):void _saveNote()},_saveNote=function(){var noteName,noteContent,noteId,service=1==syncMode?"ZohoRecruit":"ZohoCrm";noteName=1==syncMode?$("#zcl_crmnote_title").find("option:selected").text():$("#zcl_crmnote_title").val(),noteContent=$("#zcl_crmnote_content").val(),noteId=$("#zcl_crmnote_id").val();var ckey=zcal.getCalObj(crmCalId)[9],_url="/cal/crmNotes.do?note="+noteContent+"&title="+noteName+"&service="+service+"&ckey="+ckey+(1==syncMode?"&id="+$("#zcl_crmnote_title").val():"");_url+=""!=noteId?"&mode=edit&noteId="+noteId:"&mode=add&eventId="+$("#zcl_activityid").val(),ZCL_XHR(_url,function(res){_updateNotes(res)})},_delAttendees=function(invId){var ckey=zcal.getCalObj(crmCalId)[9],activityId=$("#zcl_activityid").val(),service=1==syncMode?"ZohoRecruit":"ZohoCrm",_url="/cal/crmInvitees.do?mode=del&attId="+invId+"&eventId="+activityId+"&service="+service+"&ckey="+ckey;ZCL_XHR(_url,function(res){var _aobj=ZCL_Evl(1,res.responseText);_updateAttendees(_aobj,activityId)})},_reqAttendees=function(activityId){var _url,ckey=zcal.getCalObj(crmCalId)[9],service=1==syncMode?"ZohoRecruit":"ZohoCrm";_url="/cal/crmInvitees.do?mode=list&eventId="+activityId+"&service="+service+"&ckey="+ckey,ZCL_uXHR(_url,function(res){var _aobj=ZCL_Evl(1,res.responseText);_updateAttendees(_aobj,activityId)})},_updateAttendees=function(aobj,activityId){"list"==aobj.mode?(crmAttendees[activityId]=aobj.invitees,listAttendees()):"del"==aobj.mode?"success"==aobj.status&&0==$("#zcl_crm_attlist").find("UL").length&&$("#zcl_crm_attlist").html('<ul><li><span class="zcl_grey">No attendee</span></li></ul>'):"add"==aobj.mode&&"success"==aobj.status&&_reqAttendees(activityId)},listAttendees=function(){var aObj,actId=zcal.EOBJ.ACTIVITYID,statusArr=["all"];if(aObj=crmAttendees[actId]||[],aObj.length>0){var $sts,$attList;$("#zcl_crm_attlist").length||($attList=$('<ul class="zcl_frmrw zcl_vwatte"><li><div><ul class="zcl_viwatt"/><div  id="zcl_crm_attlist"/></div></li></ul>'),$("ul#zcl_crmatt_info>li").append($attList)),$attList=$("#zcl_crm_attlist").parents("ul.zcl_vwatte"),$sts=$attList.find("ul.zcl_viwatt");for(var i=0;i<statusArr.length;i++){var _stsEle=$('<li data-usts="'+statusArr[i]+'" '+(0==i?'class="zcl_sl"':"")+">"+zcal.i18n[statusArr[i]]+"</li>");bindClickOnStatus(_stsEle),$sts.append(_stsEle)}_constAttendees("all")}},bindClickOnStatus=function(_stsEle){_stsEle.off("click").on("click",function(){var $ele=$(this);$ele.parent().find("li").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),_constAttendees($ele.data("usts"))})},_constAttendees=function(){var aObj,actId=zcal.EOBJ.ACTIVITYID,$list=$("#zcl_crm_attlist");aObj=crmAttendees[actId]||[],$list.empty();for(var i=0;i<aObj.length;i++){var txt,$del,attObj=aObj[i],$att=$('<div class="zcl_viwatlst zcl_table zcl_curpt"></div>');txt='<ul><li><img src="'+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+'"></li><li><b>'+ZCL_getHTML(attObj.EMAIL)+"</b></li><li>"+ZCL_AttStsIcn(attObj.STATUS)+'<i class="msi-delete"/></li></ul>',$att.append(txt),$del=$att.find("i.msi-delete"),bindClickOnAttendeeDelete($del,attObj),$list.append($att)}},bindClickOnAttendeeDelete=function($del,attObj){$del.off("click").on("click",{attId:attObj.INVITEEID,mode:zcal.EMODE},function(ev){var _attEle=$(this).parent().parent(),attid=ev.data.attId;_attEle.remove(),_delAttendees(attid)})},crmObj={showCRMForm:openCRMForm,updateCRMData:updateCRMFieldInfo,reset:reset,saveEvent:saveEvent,loadCRMUsers:fetchCRMUsers,getCRMCurrentUser:getCRMCurrentUser,getRecruitCurrentUser:getRecruitCurrentUser,getCRMColorCode:getCRMColorCode,getCRMCalChild:getCRMCalChild,chgUserSts:chgUserSts};return crmObj}();ZCL_SetCrmsts=function(){var txt='<ul class="zcl_frmrw">';return zcal.EOBJ.CRM_STATUS&&2==zcal.EOBJ.CRM_STATUS&&(txt+='<div style="display: inline-block;color:red;"><i class="msi-spam" style="color:red"></i> '+zcal.i18n.cancelled+"</div>"),txt+="</ul>"},ZCL_nlp=function(cur,op){function matchfordatest(temp){try{for(var j=0;j<mapar.length;j++)if(temp.match(mapar[j])){sd=filter(temp.match(mapar[j]),j,temp),aneg=17!=j?temp.match(mapar[j]):"";var keyfrtitext=(temp.match(mapar[j]),temp.match(mapar[j]));if(12==j&&temp.match(mapar[20])){sd=filter(temp.match(mapar[20]),20,temp);var keyfrtitext1=temp.match(mapar[20]);aneg=temp.match(mapar[20]),keyfrtitext=""}if(10==j)if(temp.match(mapar[21])){sd=filter(temp.match(mapar[21]),21,temp);var keyfrtitext1=temp.match(mapar[21]);aneg=temp.match(mapar[21]),keyfrtitext=""}else if(temp.match(reg31)){var ttemp=temp;if(aneg=temp.match(reg31),temp=temp.replace(/\'/g," "),temp.match(mapar[10])){sd=filter(temp.match(mapar[10]),10,temp);var keyfrtitext1=ttemp.match(reg31);keyfrtitext=""}}if(11==j){if(temp.match(reg25)){sd=filter(temp.match(reg25),22,temp);var keyfrtitext1=temp.match(reg25);aneg=temp.match(reg25),keyfrtitext=""}if(temp.match(reg24)){sd=filter(temp.match(reg24),23,temp);var keyfrtitext1=temp.match(reg24);aneg=temp.match(reg24),keyfrtitext=""}if(temp.match(reg29)){var keyfrtitext1=title_ext.match(reg29);keyfrtitext=""}if(temp.match(reg33)){var keyfrtitext1=title_ext.match(reg33);keyfrtitext=""}}if(14==j)if(temp.match(reg26)){sd=filter(temp.match(reg26),24,temp);var keyfrtitext1=temp.match(reg26);aneg=temp.match(reg26),keyfrtitext=""}else if(temp.match(reg28)){var keyfrtitext1=title_ext.match(reg28);keyfrtitext=""}else if(temp.match(reg34)){var keyfrtitext1=title_ext.match(reg34);keyfrtitext=""}else if(temp.match(reg35)){var keyfrtitext1=title_ext.match(reg35);keyfrtitext=""}if(j=15){var ttemp;if(temp.match(reg32)){ttemp=temp;var spli=temp.split("'"),yr="20"+spli[1];temp=temp.replace(/\'/g," ");var tomatch=temp.match(mapar[15])[0]+" "+yr;if(tomatch.match(mapar[15])){sd=filter(tomatch.match(mapar[15]),15,temp);var keyfrtitext1=ttemp.match(reg32);aneg=ttemp.match(reg32),keyfrtitext=""}}if(ttemp&&ttemp.match(reg30)||temp.match(reg30)){if(ttemp){var ttemp2=ttemp,spli=ttemp.split("'"),yr="20"+spli[1];ttemp=ttemp.replace(/\'/g," ");var tomatch=ttemp.match(mapar[15])[0]+" "+yr;tomatch.match(mapar[15])&&(sd=filter(tomatch.match(mapar[15]),15,ttemp),aneg=ttemp2.match(reg30))}var keyfrtitext1=title_ext.match(reg30);keyfrtitext=""}}if(""==keyfrtitext&&keyfrtitext1&&0!=op){var subs=title_ext.substring(0,title_ext.indexOf(keyfrtitext1[0]));subs=subs.trim();var indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]||","==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1]&&(indar[indar.length-1].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on|tomorrow|today|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)||indar[indar.length-1].match(/@/)))if(indar[indar.length-1].match(/\b(tomorrow|today|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)&&indar[indar.length-2]&&(indar[indar.length-2].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on)\b/)||indar[indar.length-2].match(/@/))){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-1]&&indar[indar.length-1].match(/\b(from|on)\b/)&&indar[indar.length-2]&&indar[indar.length-2].match(/\b(start)s?|(open)s?|starting|commence/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else{var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-1].match(/\b(next|this|first|second|third|fourth|last)/))if(indar[indar.length-2]&&indar[indar.length-2].match(/\b(from)/)&&indar[indar.length-3]&&indar[indar.length-3].match(/\b(start)s?|(open)s?|starting|commence/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-3]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-2]&&indar[indar.length-2].match(/\b(starts)s?|(commence)s?|from|starting|(open)s?|on|at|between?/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else{var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else title_ext=title_ext.replace(keyfrtitext1[0],"")}else if(""!=keyfrtitext&&0!=op){var subs=title_ext.substring(0,title_ext.indexOf(keyfrtitext[0])),subs1=title_ext.substring(title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length,title_ext.length);subs1=subs1.trim();var indar1=subs1.split(regex1);subs=subs.trim();var indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]||","==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1]&&(indar[indar.length-1].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on|tomorrow|today|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)||indar[indar.length-1].match(/@/)))if(indar[indar.length-1].match(/\b(tomorrow|today|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)&&indar[indar.length-2]&&(indar[indar.length-2].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on)\b/)||indar[indar.length-2].match(/@/))){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-1]&&indar[indar.length-1].match(/\b(from|on)\b/)&&indar[indar.length-2]&&indar[indar.length-2].match(/\b(start)s?|(open)s?|starting|commence/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else{var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-1].match(/\b(next|this|first|second|third|last|fourth)/))if(indar[indar.length-2]&&indar[indar.length-2].match(/\b(from|on|at)\b/)&&indar[indar.length-3]&&indar[indar.length-3].match(/\b(start)s?|(open)s?|starting|commence\b/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-3]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);if(title_ext=title_ext.replace(subtx,""),indar1[0]&&indar1[0].match(/\b(of)\b/)&&indar1[1]&&monthff.indexOf(indar1[1])>-1){var subtx=title_ext.substring(subs1.indexOf(indar[1])+indar[1].length,title_ext.length);title_ext=title_ext.replace(subtx,"")}}else if(indar[indar.length-2]&&indar[indar.length-2].match(/\b(starts)s?|(commence)s?|from|starting|(open)s?|on|at|between?\b/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else{var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else title_ext=title_ext.replace(keyfrtitext[0],"");indxarr.push(text.indexOf(keyfrtitext[0]))}return sd}}catch(ex){}}function matchfordateet(temp){try{for(var j=0;j<mapar.length;j++)if(temp.match(mapar[j])){ed=filter(temp.match(mapar[j]),j,temp),aneg=16!=j?temp.match(mapar[j]):"";var keyfrtitext1,keyfrtitext=(temp.match(mapar[j]),temp.match(mapar[j]));if(10==j&&temp.match(reg31)){var ttemp=temp;if(aneg=temp.match(reg31),temp=temp.replace(/\'/g," "),temp.match(mapar[10])){sd=filter(temp.match(mapar[10]),10,temp);var keyfrtitext1=ttemp.match(reg31);keyfrtitext=""}}if(11==j){if(temp.match(reg29)){var keyfrtitext1=title_ext.match(reg29);keyfrtitext=""}if(temp.match(reg33)){var keyfrtitext1=title_ext.match(reg33);keyfrtitext=""}}if(14==j)if(temp.match(reg34)){var keyfrtitext1=title_ext.match(reg34);keyfrtitext=""}else if(temp.match(reg35)){var keyfrtitext1=title_ext.match(reg35);keyfrtitext=""}if(j=15){var ttemp;if(temp.match(reg32)){ttemp=temp;var spli=temp.split("'"),yr="20"+spli[1];temp=temp.replace(/\'/g," ");var tomatch=temp.match(mapar[15])[0]+" "+yr;if(tomatch.match(mapar[15])){sd=filter(tomatch.match(mapar[15]),15,temp);var keyfrtitext1=ttemp.match(reg32);aneg=ttemp.match(reg32),keyfrtitext=""}}if(ttemp&&ttemp.match(reg30)||temp.match(reg30)){if(ttemp){var ttemp2=ttemp,spli=ttemp.split("'"),yr="20"+spli[1];ttemp=ttemp.replace(/\'/g," ");var tomatch=ttemp.match(mapar[15])[0]+" "+yr;tomatch.match(mapar[15])&&(sd=filter(tomatch.match(mapar[15]),15,ttemp),aneg=ttemp2.match(reg30))}var keyfrtitext1=title_ext.match(reg30);keyfrtitext=""}}if(""==keyfrtitext&&keyfrtitext1&&0!=op){var subs=title_ext.substring(0,title_ext.indexOf(keyfrtitext1[0]));subs=subs.trim();var indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]||","==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1]&&indar[indar.length-1].match(/\b(to|(end)s?|-|and|on|(close)s?|till|until|over|ending|tomorrow|today|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/))if(indar[indar.length-1].match(/\b(tomorrow|today|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)&&indar[indar.length-2]&&indar[indar.length-2].match(/\b(to|(end)s?|-|and|on|(close)s?|till|until|over|ending)\b/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-1]&&indar[indar.length-1].match(/\b(on)\b/)&&indar[indar.length-2]&&indar[indar.length-2].match(/\b(end)?s|(close)s?\b/)){if(subs=subs.replace(indar[indar.length-1],""),indar[indar.length-3]&&indar[indar.length-3].match(/\b(and)\b/))var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-3]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);else var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else{var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else title_ext=title_ext.replace(keyfrtitext1[0],"")}else if(keyfrtitext&&0!=op){var subs=title_ext.substring(0,title_ext.indexOf(keyfrtitext[0]));subs=subs.trim();var indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]||","==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1]&&(indar[indar.length-1].match(/\b(to|(end)s?|and|on|(close)s?|till|until|over|ending|today|tomorrow|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)||indar[indar.length-1].match("-")))if(indar[indar.length-1].match(/\b(today|tomorrow|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)&&indar[indar.length-2]&&indar[indar.length-2].match(/\b(to|(end)s?|-|and|on|(close)s?|till|until|over|ending)\b/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-1]&&indar[indar.length-1].match(/\b(on)\b/)&&indar[indar.length-2]&&indar[indar.length-2].match(/\b(end)?s|(close)s?\b/)){if(subs=subs.replace(indar[indar.length-1],""),indar[indar.length-3]&&indar[indar.length-3].match(/\b(and)\b/))var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-3]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);else var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else{var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-1].match(/\b(next|this|first|second|third|fourth|last)\b/))if(indar[indar.length-2]&&indar[indar.length-2].match(/\b(on)\b/)&&indar[indar.length-3]&&indar[indar.length-3].match(/\b(end)?s|(close)s?|ending\b/)){if(subs=subs.replace(indar[indar.length-1],""),indar[indar.length-4]&&indar[indar.length-4].match(/\b(and)\b/))var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-4]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);else var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-3]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else if(indar[indar.length-2]&&indar[indar.length-2].match(/\bto|(end)s?|till|untill|ending|over|(close)s?/)){subs=subs.replace(indar[indar.length-1],"");var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-2]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else{var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else title_ext=title_ext.replace(keyfrtitext[0],"")}return ed}}catch(ex){}}function matchforstime(a){try{a=aneg?a.replace(aneg[0]," "):a;for(var k=0;k<maptar.length;k++)if(a.match(maptar[k])){var settm=a?a.match(/[0-9]{1,2}\s?(hour|hours|minutes|minute)\s?after/)?a.match(/[0-9]{1,2}\s?(hour|hours|minutes|minute)\s?after/):a.match(/(after)\s?[0-9]{1,2}\s?(hour|hours|minutes|minute)/)?a.match(/(after)\s?[0-9]{1,2}\s?(hour|hours|minutes|minute)/):"":"",notoad=settm?settm[0].match(/[0-9]{1,2}/):"",addhrs=settm?a.match(/(hour|hours)/)?36e5*notoad[0]:6e4*notoad[0]:"";st=timefilter(a.match(maptar[k]),k),st=addhrs?parseInt(st)+parseInt(addhrs):st;var settm1=a?a.match(a.match(/(for)\s?[0-9]{1,2}\s?(hour|hours|minutes|minute)/)?/(for)\s?[0-9]{1,2}\s?(hour|hours|minutes|minute)/:/[0-9]{1,2}\s?(hours|hour|minutes|minute)\s?(from)/):"";notoad=settm1?settm1[0].match(/[0-9]{1,2}/):"",addhrs=settm1?a.match(/(hour|hours)/)?36e5*notoad[0]:6e4*notoad[0]:"",settm||(st=settm1?timefilter(a.match(maptar[k]),k):st),ettim=addhrs&&st?parseInt(st)+parseInt(addhrs):"";var keyfrtitext1,keyfrtitext=a.match(maptar[k]);if(0==k)if(a.match(maptar[4]))st=timefilter(a.match(maptar[4]),4),keyfrtitext1=a.match(maptar[4]),indxarr.push(text.indexOf(keyfrtitext1[0])),keyfrtitext="";else{var temp=a.match(maptar[k]);if(!temp[0].match(/(am|pm)/)&&a.match(/\b(0?[0-9]|1[0-9]|2[0-3])([:|.](0[0-9]|[1-4][0-9]|5[0-9]))\s?(am|pm|hrs)?\b/)&&0==op){keyfrtitext1=a.match(/\b(0?[0-9]|1[0-9]|2[0-3])([:|.](0[0-9]|[1-4][0-9]|5[0-9]))\s?(am|pm|hrs)?\b/),keyfrtitext="",indxarr.push(text.indexOf(keyfrtitext1[0]));var t=a.match(/(am|pm|hrs)/);st=timefilter(a.match(/\b(0?[0-9]|1[0-9]|2[0-3])([:|.](0[0-9]|[1-4][0-9]|5[0-9]))\s?(am|pm|hrs)?\b/),t?0:1)}else!temp[0].match(/(am|pm)/)&&a.match(/\b(0?[0-9]|1[0-9]|2[0-3])\s?(am|pm)\b/)&&0==op&&(keyfrtitext1=a.match(/\b(0?[0-9]|1[0-9]|2[0-3])\s?(am|pm)\b/),keyfrtitext="",indxarr.push(text.indexOf(keyfrtitext1[0])),st=timefilter(a.match(/\b(0?[0-9]|1[0-9]|2[0-3])\s?(am|pm)\b/),0))}if(""==keyfrtitext&&keyfrtitext1)if(title_ext.indexOf(keyfrtitext1[0])>0){var subs=title_ext.substring(0,title_ext.indexOf(keyfrtitext1[0])),indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on)\b/)||indar[indar.length-1].match(/@/)){var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext1[0])+keyfrtitext1[0].length);title_ext=title_ext.replace(subtx,"")}else title_ext=title_ext.replace(keyfrtitext1[0],"")}else title_ext=title_ext.replace(keyfrtitext1[0],"");else if(""!=keyfrtitext)if(title_ext.indexOf(keyfrtitext[0])>0){var subs=title_ext.substring(0,title_ext.indexOf(keyfrtitext[0])),indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on)\b/)||indar[indar.length-1].match(/@/)){var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else title_ext=title_ext.replace(keyfrtitext[0],"");indxarr.push(text.indexOf(keyfrtitext[0]))}else title_ext=title_ext.replace(keyfrtitext[0],"");return st}}catch(ex){}}function matchforetime(a){try{a=aneg&&a?a.replace(aneg[0]," "):a;for(var ke=0;ke<maptar.length;ke++)if(a.match(maptar[ke])){var settm=a?a.match(/[0-9]{1,2}\s?(hour|hours|minutes|minute)\s?after/):"",notoad=settm?settm[0].match(/[0-9]{1,2}/):"",addhrs=settm?a.match(/(hour|hours)/)?36e5*notoad[0]:6e4*notoad[0]:"";if(0==ke&&a.match(maptar[4])){sttim=timefilter(a.match(maptar[4]),4);var sptime=a.match(maptar[4]),tem=sptime[0].split("-");a=tem[1]}et=timefilter(a.match(maptar[ke]),ke),et=addhrs&&settm?parseInt(et)+parseInt(addhrs):et;var keyfrtitext=a.match(maptar[ke]);if(keyfrtitext){var subs=title_ext.substring(1,title_ext.indexOf(keyfrtitext[0])),indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1].match(/(to|(end)s?|-|and|on|(close)s?|till|until|over|ending|at)/)){var subtx=title_ext.substring(subs.lastIndexOf(indar[indar.length-1]),title_ext.indexOf(keyfrtitext[0])+keyfrtitext[0].length);title_ext=title_ext.replace(subtx,"")}else title_ext=title_ext.replace(keyfrtitext[0],"")}return indxarr.push(text.indexOf(keyfrtitext[0])),et}}catch(ex){}}function filter(c,d,t){try{if(0==d||1==d||2==d||3==d||4==d||5==d||6==d||7==d){var tmpwrds=t.split(regex1),idx=tmpwrds.indexOf(c[0]);c[0]=c[0].replace(/(-|\.)/g,"/");var temp=c[0].split("/");if(!(tmpwrds[idx-1]&&tmpwrds[idx-1].match(/(from|after|before)/)&&tmpwrds[idx-2].match(/(day)s?/)&&tmpwrds[idx-3]&&tmpwrds[idx-3].match(/[0-9]{1,2}/))||remindervariable.isrem)return tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)&&(etdat=Date.parse((0==d||2==d||4==d||6==d?(0==d||4==d||6==d)&&temp[1]<=12&&temp[0]<=12?temp[0]:temp[1]:1==d||5==d||7==d?temp[0]:3==d?temp[2]:"")+"/"+(parseInt(0==d||4==d||6==d?temp[1]<=12&&temp[0]<=12?temp[1]:temp[0]:1==d||3==d||5==d||7==d?temp[1]:2==d?temp[2]:"")+parseInt(tmpwrds[idx+2]))+"/"+(0==d||1==d?temp[2]:2==d||3==d?temp[0]:4==d||5==d?"20"+temp[2]:6==d||7==d?curdate.getFullYear():""))),Date.parse((0==d||2==d||4==d||6==d?(0==d||4==d||6==d)&&temp[1]<=12&&temp[0]<=12?temp[0]:temp[1]:1==d||5==d||7==d?temp[0]:3==d?temp[2]:"")+"/"+(0==d||4==d||6==d?temp[1]<=12&&temp[0]<=12?temp[1]:temp[0]:1==d||3==d||5==d||7==d?temp[1]:2==d?temp[2]:"")+"/"+(0==d||1==d?temp[2]:2==d||3==d?temp[0]:4==d||5==d?"20"+temp[2]:6==d||7==d?curdate.getFullYear():""));var temdat=new Date(Date.parse((0==d||2==d||4==d||6==d?(0==d||4==d||6==d)&&temp[1]<=12&&temp[0]<=12?temp[0]:temp[1]:1==d||5==d||7==d?temp[0]:3==d?temp[2]:"")+"/"+(0==d||4==d||6==d?temp[1]<=12&&temp[0]<=12?temp[1]:temp[0]:1==d||3==d||5==d||7==d?temp[1]:2==d?temp[2]:"")+"/"+(0==d||1==d?temp[2]:2==d||3==d?temp[0]:4==d||5==d?"20"+temp[2]:6==d||7==d?curdate.getFullYear():"")));if("Invalid Date"!=temdat&&tmpwrds[idx-4]&&"for"!=tmpwrds[idx-4]){if(tmpwrds[idx-1].match(/(from|after)/)?temdat.setDate(temdat.getDate()+parseInt(tmpwrds[idx-3])):tmpwrds[idx-1].match(/(before)/)&&temdat.setDate(temdat.getDate()-parseInt(tmpwrds[idx-3])),tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(for)/)&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx+2])),etdat=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear())}return Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear())}if("Invalid Date"!=temdat&&tmpwrds[idx-4]&&"for"==tmpwrds[idx-4]){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));return temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx-3])),etdat=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear()),temdat}if("Invalid Date"==temdat)return alretdat}if(8==d||9==d||10==d||12==d||13==d){var tmpwrds=t.split(regex1),temholder=c[0],temp=c[0].match("-")?c[0].split("-"):c[0].match(/\./)?c[0].split("."):"";if(c[0]=""!=temp?temp[0]+" "+temp[1]+" "+(3==temp.length?temp[2]:curdate.getFullYear()):c[0],""==temp){var yearreg=c[0].match(/[0-9]{4}/);if(yearreg){var spltoreg=/january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/,monex=c[0].match(spltoreg),datex=c[0].match(/[0-9]{1,2}/);c[0]=(monex[0]?monex[0]:curdate.getMonth()+parseInt(1))+" "+(datex?datex:curdate.getDate())+" "+yearreg}else{var spltoreg=/january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/,brsen=c[0].split(spltoreg),monex=c[0].match(spltoreg),datex=10==d?brsen[0]?brsen[0]:"":12==d&&brsen[1]?brsen[1]:"",yrex=10==d&&brsen[1]?brsen[1]:curdate.getFullYear();datex=datex?datex.replace(" ",""):"",yrex=10==d&&brsen[1]?yrex.replace(" ",""):yrex,monex[0]=monex[0]?monex[0].replace(" ",""):"",c[0]=(monex[0]?monex[0]:curdate.getMonth()+parseInt(1))+" "+(datex?datex:curdate.getDate())+" "+(10==d&&brsen[1]?20+yrex:curdate.getFullYear())}}var temp2=temholder.split(" "),idx=tmpwrds.indexOf(""==temp?temp2[0]:temholder);if(!(tmpwrds[idx-1]&&tmpwrds[idx-1].match(/(from|after|before)/)&&tmpwrds[idx-2]&&tmpwrds[idx-2].match(/(day)s?/)&&tmpwrds[idx-3]&&tmpwrds[idx-3].match(/[0-9]{1,2}/))||remindervariable.isrem){if(tmpwrds[idx-1]&&tmpwrds[idx-1].match("every")||t.match(/(every\s?year)/)){var da=c[0].match(/[0-9]{1,2}/),alph=c[0];alph=alph.replace(/[^A-Za-z]/g,""),wkrpobj.yearly=1,yearindex="",yeardate=da[0],yearmonname=alph,yeartype=1}if(t.match(/(every|all)\s?(weekday)s?/))wkrpobj.daily=1,dailyweekday=1;else if(t.match(/(every|all)\s?(weekend)s?/))wkrpobj.weekly=1,weekdy="saturday,sunday",repbfrefrom=1;else if(!stdat){var txrev=text,repcedtxt=txrev.replace(t," @ ");repcedtxt=repcedtxt?repcedtxt.split(regex1):"";var idx=repcedtxt.indexOf("@");repcedtxt[idx-1]&&repcedtxt[idx-1].match(/\b(weekday)s?\b/)&&repcedtxt[idx-2]&&repcedtxt[idx-2].match(/\b(every|all)\b/)&&(wkrpobj.daily=1,dailyweekday=1),repcedtxt[idx-1]&&repcedtxt[idx-1].match(/\b(weekend)s?\b/)&&repcedtxt[idx-2]&&repcedtxt[idx-2].match(/\b(every|all)\b/)&&(wkrpobj.weekly=1,weekdy="saturday,sunday"),"days"==repcedtxt[idx-1]&&repcedtxt[idx-2]&&repcedtxt[idx-2].match(/[0-9]{1,2}/)&&"every"==repcedtxt[idx-3]&&(wkrpobj.daily=1,dailyday=repcedtxt[idx-2],dailyweekday=1)}if(idx=tmpwrds.indexOf(""==temp?3==temp2.length?temp2[2]:temp2[1]:temholder),tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(((day)s?)|((year)s?))/))if(tmpwrds[idx+3].match(/(day)s?/)){var refdt=new Date(Date.parse(c[0]));etdat=Date.parse(refdt.getMonth()+parseInt(1)+"/"+(parseInt(refdt.getDate())+parseInt(tmpwrds[idx+2]))+"/"+refdt.getFullYear())}else(tmpwrds[idx+3].match(/(year)s?/)||1==wkrpobj.yearly)&&(yearuntil=Date.parse("12/31/"+(curdate.getFullYear()+parseInt(tmpwrds[idx+2]))));if(tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match("every")&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/[0-9]{1,2}/)&&tmpwrds[idx+4]&&tmpwrds[idx+4].match(/(day)s?/)&&(wkrpobj.daily=1,dailyday=tmpwrds[idx+3],stdat&&(dailyweekday=1)),Date.parse(c[0]))return Date.parse(c[0]);var cx=c[0].split(" "),fdat=3==cx.length&&8==d?cx[1]+" "+cx[0]+" "+(cx[2].match(/[0-9]{2}/)?20+cx[2]:""):"";return fdat=""==fdat?alretdat:fdat,Date.parse(fdat)}var temdat;if(Date.parse(c[0]))temdat=new Date(Date.parse(c[0]));else{var cx=c[0].split(" "),fdat=3==cx.length&&8==d?cx[1]+" "+cx[0]+" "+(cx[2].match(/[0-9]{2}/)?20+cx[2]:""):"";if(10==d||12==d){var tempv=cx[0].split(/[0-9]{1,2}/),mv=""!=tempv[0]?tempv[0]:tempv[1],nu=cx[0].match(/[0-9]{1,2}/);fdat=2==cx.length?mv+" "+nu[0]+" "+(cx[1].match(/[0-9]{4}/)?cx[1]:20+cx[1]):1==cx.length?mv+" "+nu[0]+" "+curdate.getFullYear():""}temdat=new Date(Date.parse(fdat))}if("Invalid Date"!=temdat&&(tmpwrds[idx-4]&&"for"!=tmpwrds[idx-4]||!tmpwrds[idx-4])){if(tmpwrds[idx-4]&&"every"==tmpwrds[idx-4]?(wkrpobj.daily=1,dailyday=tmpwrds[idx-3]):tmpwrds[idx-1].match(/(from|after)/)?temdat.setDate(temdat.getDate()+parseInt(tmpwrds[idx-3])):tmpwrds[idx-1].match(/(before)/)&&temdat.setDate(temdat.getDate()-parseInt(tmpwrds[idx-3])),idx=tmpwrds.indexOf(3==temp2.length?temp2[2]:temp2[1]),tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(for)/)&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx+2])),etdat=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear())}return tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match("every")&&tmpwrds[idx+3].match(/[0-9]{1,2}/)&&tmpwrds[idx+4]&&tmpwrds[idx+4].match(/(day)s?/)&&(wkrpobj.daily=1,dailyday=tmpwrds[idx+3]),Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear())}if("Invalid Date"!=temdat&&tmpwrds[idx-4]&&"for"==tmpwrds[idx-4]){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));return temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx-3])),etdat=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear()),temdat}if("Invalid Date"==temdat)return alretdat}if(14==d||11==d){var tmpwrds=t.split(regex1),temp=c[0].replace(/(\s|,)/g,"/"),num=temp.split("/"),idx=tmpwrds.indexOf(num[0]);if(!(tmpwrds[idx-1]&&tmpwrds[idx-1].match(/(from|after|before)/)&&tmpwrds[idx-2]&&tmpwrds[idx-2].match(/(day)s?/)&&tmpwrds[idx-3]&&tmpwrds[idx-3].match(/[0-9]{1,2}/))||remindervariable.isrem)return idx=tmpwrds.indexOf(3==num.length?num[2]:num[1]),tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)&&(etdat=Date.parse(3==num.length?(14==d?num[0]:num[1])+"/"+(parseInt(14==d?num[1]:num[0])+parseInt(tmpwrds[idx+2]))+"/"+(num[2].match(/((19|20)\d\d)/)?num[2]:20+num[2]):(14==d?num[0]:num[1])+"/"+(parseInt(14==d?num[1]:num[0])+parseInt(tmpwrds[idx+2]))+"/"+curdate.getFullYear())),Date.parse(3==num.length?(14==d?num[0]:num[1])+(14==d?num[1].replace(/[^(\d+)]/g,""):num[0].replace(/[^(\d+)]/g,""))+"/"+(num[2].match(/((19|20)\d\d)/)?num[2]:20+num[2]):(14==d?num[0]:num[1])+(14==d?num[1].replace(/[^(\d+)]/g,""):num[0].replace(/[^(\d+)]/g,""))+"/"+curdate.getFullYear());if(3==num.length)var temdat=new Date(Date.parse((14==d?num[0]:num[1])+(14==d?num[1].replace(/[^(\d+)]/g,""):num[0].replace(/[^(\d+)]/g,""))+"/"+(num[2].match(/((19|20)\d\d)/)?num[2]:20+num[2])));else var temdat=new Date(Date.parse((14==d?num[0]:num[1])+(14==d?num[1].replace(/[^(\d+)]/g,""):num[0].replace(/[^(\d+)]/g,""))+"/"+curdate.getFullYear()));if("Invalid Date"!=temdat&&tmpwrds[idx-4]&&"for"!=tmpwrds[idx-4]){if(tmpwrds[idx-1].match(/(from|after)/)?temdat.setDate(temdat.getDate()+parseInt(tmpwrds[idx-3])):tmpwrds[idx-1].match(/(before)/)&&temdat.setDate(temdat.getDate()-parseInt(tmpwrds[idx-3])),idx=tmpwrds.indexOf(3==num.length?num[2]:num[1]),tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(for)/)&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx+2])),etdat=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear())}return Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear())}if("Invalid Date"!=temdat&&tmpwrds[idx-4]&&"for"==tmpwrds[idx-4]){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));return temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx-3])),etdat=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear()),temdat}if("Invalid Date"==temdat)return alretdat}if(16==d||17==d){var org=c[0];c[0]=16!=d&&monthcap.indexOf(c[0].toLowerCase())<0?monthcap[monthcapsh.indexOf(c[0].toLowerCase())]:c[0];var tmpwrds=t.split(regex1),exemptions=t.match(reg19),alternative=17==d?tmpwrds.indexOf(c[0])>-1?dayrel1[relday1.indexOf(c[0])]:exemptions?dayrel1[relday1.indexOf(exemptions[0])]:"":"";if((tmpwrds.indexOf("from")>-1||tmpwrds.indexOf("after")>-1||tmpwrds.indexOf("before")>-1)&&(tmpwrds.indexOf("days")>-1||tmpwrds.indexOf("day")>-1)&&tmpwrds.indexOf(org)>-1&&tmpwrds[tmpwrds.indexOf(org)-1].match(/(from|after|before)/)&&!remindervariable.isrem){var idx=tmpwrds.indexOf(org)-1;if(tmpwrds[idx-1]&&tmpwrds[idx-1].match(/(day)s?/)&&tmpwrds[idx-2]&&tmpwrds[idx-2].match(/[0-9]{1,2}/)){var tmpwords=t.split(regex1),index=tmpwords.indexOf(org),det=tmpwords[index-1]&&tmpwords[index-1].match(/(next)/)?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":tmpwords[index-1]&&tmpwords[index-1].match(/(this)/)?monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"":alternative?alternative:monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"",temdat=new Date(Date.parse(det.getMonth()+parseInt(1)+"/"+det.getDate()+"/"+det.getFullYear()));if("Invalid Date"!=temdat&&(tmpwrds[idx-3]&&"for"!=tmpwrds[idx-3]||!tmpwrds[idx-3])){if(tmpwrds[idx-3]&&"every"!=tmpwrds[idx-3]||!tmpwrds[idx-3]?tmpwrds[idx]&&tmpwrds[idx].match(/(from|after)/)?temdat.setDate(temdat.getDate()+parseInt(tmpwrds[idx-2])):tmpwrds[idx]&&tmpwrds[idx].match(/(before)/)&&temdat.setDate(temdat.getDate()-parseInt(tmpwrds[idx-2])):tmpwrds[idx-3]&&(wkrpobj.daily=1,dailyday=tmpwrds[idx-2]),idx=tmpwrds.indexOf(org),tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(for)/)&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx+2])),etdat=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear())}var datobj,rslt=Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear());if(void 0!=stdat){if(stdat>rslt||rslt>stdat){rslt=new Date(rslt);var tpd=new Date(stdat);det=tmpwords[index-1]&&tmpwords[index-1].match(/(next)/)?getNextWeekDay(tpd,rslt.getDay()):tmpwords[index-1]&&tmpwords[index-1].match(/(this)/)?getThisWeekDay(tpd,rslt.getDay()):getThisWeekDay(tpd,rslt.getDay()),rslt=Date.parse(det.getMonth()+parseInt(1)+"/"+det.getDate()+"/"+det.getFullYear()),datobj=rslt}}else datobj=rslt;return datobj}if("Invalid Date"!=temdat&&tmpwrds[idx-3]&&"for"==tmpwrds[idx-3]){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));return temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx-2])),etdat=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear()),temdat}if("Invalid Date"==temdat)return alretdat}else{idx=tmpwrds.indexOf(org);var det=tmpwrds[idx-1].match(/(next)/)?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":tmpwrds[idx-1].match(/(this)/)?monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"":alternative?alternative:monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"";if("Invalid Date"!=det&&tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)){var exdtin=new Date;exdtin.setDate(det.getDate()),exdtin.setMonth(det.getMonth()),exdtin.setFullYear(det.getFullYear()),exdtin.setDate(exdtin.getDate()+parseInt(tmpwrds[idx+2])),etdat=etdat?etdat:Date.parse(exdtin.getMonth()+parseInt(1)+"/"+exdtin.getDate()+"/"+exdtin.getFullYear())}if("Invalid Date"!=det)return Date.parse(det.getMonth()+parseInt(1)+"/"+det.getDate()+"/"+det.getFullYear());if("Invalid Date"==det)return alretdat}}else{if(!t.match(reg18)){var tmpwords=t.split(regex1),index=tmpwords.indexOf(org),check=0;if(tmpwrds[index+1]&&tmpwrds[index+1].match("of")&&tmpwrds[index+2]&&tmpwrds[index+2].match(/(next|last|every)/)){if("month"!=tmpwrds[index+3]&&month.indexOf(tmpwrds[index+3])<0)var det="next"==tmpwrds[index+2]?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":"last"==tmpwrds[index+2]?monthcap.indexOf(c[0])>-1?dayrel3[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel3[monthcapsh.indexOf(c[0])]:"":monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"";else if(tmpwrds[index+2].match(/(next|last)/)&&month.indexOf(tmpwrds[index+3])<0){var montnam=monthsh[curdate.getMonth()+parseInt(1)],det=calculateweekday("first",c[0],montnam,"");if(stdat&&1==wkrpobj.weekly){var dtc=new Date(stdat);dtc=calculateweekday("first",monthcap[dtc.getDay()],montnam,""),stdat=Date.parse(dtc.getMonth()+parseInt(1)+"/"+dtc.getDate()+"/"+dtc.getFullYear());var c=new Date(dtc.getFullYear(),dtc.getMonth()+1,0,0,0,0);weekuntil=weekuntil?weekuntil:Date.parse(c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear())}if(t.match("every"))if(wkrpobj.weekly=1,stdat||1!=wkrpobj.weekly||"Invalid Date"==det){if("Invalid Date"==det)return alretdat}else{var c=new Date(det.getFullYear(),det.getMonth()+1,0,0,0,0);weekuntil=weekuntil?weekuntil:Date.parse(c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear())}}else if(tmpwrds[index+2]&&tmpwrds[index+2].match(/(next|last)/)&&month.indexOf(tmpwrds[index+3])>-1){var det=calculateweekday("first",c[0],month[month.indexOf(tmpwrds[index+3])],curdate.getFullYear()+1);if(stdat&&1==wkrpobj.weekly){var dtc=new Date(stdat);dtc=calculateweekday("first",monthcap[dtc.getDay()],month[month.indexOf(tmpwrds[index+3])],curdate.getFullYear()+1),stdat=Date.parse(dtc.getMonth()+parseInt(1)+"/"+dtc.getDate()+"/"+dtc.getFullYear());var c=new Date(dtc.getFullYear(),dtc.getMonth()+1,0,0,0,0);weekuntil=weekuntil?weekuntil:Date.parse(c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear())}if(t.match("every"))if(wkrpobj.weekly=1,stdat||1!=wkrpobj.weekly||"Invalid Date"==det){if("Invalid Date"==det)return alretdat}else{var c=new Date(det.getFullYear(),det.getMonth()+1,0,0,0,0);weekuntil=weekuntil?weekuntil:Date.parse(c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear())}}if("every"==tmpwrds[index+2])if(tmpwrds[index+3].match(/(month|week)/)){wkrpobj.weekly=1;var det=dayrel2[monthcap.indexOf(c[0])]}else if(tmpwrds[index+3]&&tmpwrds[index+3].match(/[0-9]{1,2}/)&&tmpwrds[index+4]&&tmpwrds[index+4].match(/(week)/)){wkrpobj.weekly=1;var det=dayrel2[monthcap.indexOf(c[0])];weekct=tmpwrds[index+3]}check="next"==tmpwrds[index+2]?"1":"2"}else if(tmpwrds[index+1]&&tmpwrds[index+1].match("of")&&tmpwrds[index+2]&&month.indexOf(tmpwrds[index+2])>-1){if(stdat&&1==wkrpobj.weekly){var det=calculateweekday("first",c[0],tmpwrds[index+2],""),c=new Date(stdat);stdat=calculateweekday("first",monthcapsh[c.getDay()],tmpwrds[index+2],"");var d="Invalid Date"!=det?new Date(det.getFullYear(),det.getMonth()+1,0,0,0,0):"";d=""!=d?Date.parse(d.getMonth()+parseInt(1)+"/"+d.getDate()+"/"+d.getFullYear()):"",weekuntil=weekuntil?weekuntil:d}else if(t.match("every")){var det=calculateweekday("first",c[0],tmpwrds[index+2],""),d="Invalid Date"!=det?new Date(det.getFullYear(),det.getMonth()+1,0,0,0,0):"";d=""!=d?Date.parse(d.getMonth()+parseInt(1)+"/"+d.getDate()+"/"+d.getFullYear()):"",weekuntil=weekuntil?weekuntil:d}}else if(tmpwrds[index+1]&&tmpwrds[index+1].match("for")&&tmpwrds[index+2]&&tmpwrds[index+2].match(/[0-9]{1,2}/)&&tmpwrds[index+3]&&tmpwrds[index+3].match(/((day)s?|(month)s?|(week)s?)/))if(tmpwrds[index+3].match(/(day)s?/)){var det=tmpwords[index-1]&&tmpwords[index-1].match(/(next)/)?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":tmpwords[index-1]&&tmpwords[index-1].match(/(this)/)?monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"":17==d?exemptions?dayrel1[relday1.indexOf(exemptions[0])]:"":monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"";etdat=Date.parse(det.getMonth()+parseInt(1)+"/"+(det.getDate()+parseInt(tmpwrds[index+2]))+"/"+det.getFullYear())}else if(t.match(/(every|all)/)&&tmpwrds[index+3].match(/(month)s?/)||1==wkrpobj.weekly){wkrpobj.weekly=1;var caluntdat=new Date;caluntdat.setMonth(caluntdat.getMonth()+(parseInt(tmpwrds[index+2])+1)),caluntdat.setDate(0);var det=tmpwords[index-1]&&tmpwords[index-1].match(/(next)/)?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":tmpwords[index-1]&&tmpwords[index-1].match(/(this)/)?monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"":17==d?exemptions?dayrel1[relday1.indexOf(exemptions[0])]:"":monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"";weekuntil=caluntdat}else if(t.match(/(every|all)/)&&tmpwrds[index+3].match(/(week)s?/)||1==wkrpobj.weekly){var caluntdat=new Date,daycnt=caluntdat.getDay(),cnt=0==daycnt?7*(tmpwrds[index+2]-1):7*(tmpwrds[index+2]-1)+(7-daycnt);caluntdat.setDate(caluntdat.getDate()+parseInt(cnt));var det=tmpwords[index-1].match(/(next)/)?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":tmpwords[index-1].match(/(this)/)?monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"":17==d?exemptions?dayrel1[relday1.indexOf(exemptions[0])]:"":monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"";wkrpobj.weekly=1,weekuntil=caluntdat}else var det=tmpwords[index-1].match(/(next)/)?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":tmpwords[index-1].match(/(this)/)?monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"":17==d?exemptions?dayrel1[relday1.indexOf(exemptions[0])]:"":monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"";else{if(t.match("every"))if(t.match(/(every|all)\s?(weekday)s?/))wkrpobj.daily=1,dailyweekday=1;else if(t.match(/(every|all)\s?(weekend)s?/))wkrpobj.weekly=1,weekdy="saturday,sunday",repbfrefrom=1;else{if(wkrpobj.weekly=1,weekdy=stdat?"":c[0],t.match(/(for)\s?[0-9]{1,2}\s?(month)s?/)){var temm=t.match(/(for)\s?[0-9]{1,2}\s?(month)s?/),num=temm[0].match(/[0-9]{1,2}/),caldav=new Date;caldav.setMonth(caldav.getMonth()+parseInt(num[0])),caldav.setDate(0),weekuntil=caldav}if(t.match(/(for)\s?[0-9]{1,2}\s?(week)s?/)){var temm=t.match(/(for)\s?[0-9]{1,2}\s?(week)s?/),num=temm[0].match(/[0-9]{1,2}/),caluntdat=new Date,daycnt=caluntdat.getDay(),cnt=0==daycnt?7*(tmpwrds[index+2]-1):7*(tmpwrds[index+2]-1)+(7-daycnt);caluntdat.setDate(caluntdat.getDate()+parseInt(cnt)),weekuntil=caldav}if(t.match(/(every)\s?[0-9]{1,2}\s?(week)s?/)){var temm=t.match(/(every)\s?[0-9]{1,2}\s?(week)s?/),num=temm[0].match(/[0-9]{1,2}/);wkrpobj.weekly=1,weekct=num[0]}}else if(!stdat){var txrev=text,repcedtxt=txrev.replace(t," @ ");repcedtxt=repcedtxt.split(regex1);var idx=repcedtxt.indexOf("@");repcedtxt[idx-1]&&repcedtxt[idx-1].match(/\b(weekday)s?\b/)&&repcedtxt[idx-2].match(/\b(every|all)\b/)&&(wkrpobj.daily=1,dailyweekday=1),repcedtxt[idx-1]&&repcedtxt[idx-1].match(/\b(weekend)s?\b/)&&repcedtxt[idx-2]&&repcedtxt[idx-2].match(/\b(every|all)\b/)&&(wkrpobj.weekly=1,weekdy="saturday,sunday"),repcedtxt[idx-1]&&repcedtxt[idx-1].match(/(day)s?/)&&repcedtxt[idx-2]&&repcedtxt[idx-2].match(/[0-9]{1,2}/)&&"every"==repcedtxt[idx-3]&&(wkrpobj.daily=1,dailyday=repcedtxt[idx-2],dailyweekday=1)}var det=index>-1&&tmpwords[index-1].match(/(next)/)?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":index>-1&&tmpwords[index-1].match(/(this)/)?monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"":alternative?alternative:monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:""}var dobj,rslt="Invalid Date"!=det&&void 0!=det?Date.parse(det.getMonth()+parseInt(1)+"/"+det.getDate()+"/"+det.getFullYear()):"";if(void 0!=stdat&&""!=rslt)if(stdat>rslt){rslt=new Date(rslt);var tpd=new Date(stdat);det=index>-1&&tmpwords[index-1].match(/(next)/)?getNextWeekDay(tpd,rslt.getDay()):index>-1&&tmpwords[index-1].match(/(this)/)?getThisWeekDay(tpd,rslt.getDay()):1==check?getNextWeekDay(tpd,rslt.getDay()):alternative?alternative:getThisWeekDay(tpd,rslt.getDay()),dobj=det}else dobj=rslt;else dobj=""!=rslt?rslt:alretdat;return dobj}var addtst,addtet,number=t.match(reg18),idx=tmpwrds.indexOf(org);if(tmpwrds[idx-2]&&tmpwrds[idx-2].match(/(from|after|before)/)&&tmpwrds[idx-3]&&tmpwrds[idx-3].match(/(day)s?/)&&tmpwrds[idx-4]&&tmpwrds[idx-4].match(/[0-9]{1,2}/)&&!remindervariable.isrem&&(tmpwrds[idx-5]&&tmpwrds[idx-5].match(/(for)/)?addtet=tmpwrds[idx-4]:tmpwrds[idx-5]&&!tmpwrds[idx-5].match(/(every)/)?addtst=tmpwrds[idx-4]:(wkrpobj.daily=1,dailyday=tmpwrds[idx-4])),tmpwrds[idx+1]&&tmpwrds[idx+1].match("of")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/(jan|feb|mar|apr|may|jun|july|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)/)){var yr=tmpwrds[idx+3]&&tmpwrds[idx+3].match(/[0-9]{4}/)?tmpwrds[idx+3]:"";t.match(/every/)&&(wkrpobj.yearly=1,yearday=c[0],yearmonname=tmpwrds[idx+2],yearindex=number[1]);var calwk=calculateweekday(number[1],c[0],tmpwrds[idx+2],yr);if(addtst&&(tmpwrds[idx-2].match(/(from|after)/)&&calwk.setDate(calwk.getDate()+parseInt(addtst)),tmpwrds[idx-2].match(/(before)/)&&calwk.setDate(calwk.getDate()-parseInt(addtst))),addtet){var endest=new Date;endest.setDate(calwk.getDate()),endest.setMonth(calwk.getMonth()),endest.setFullYear(calwk.getFullYear()),endest.setDate(endest.getDate()+parseInt(addtet)),etdat=Date.parse(endest.getMonth()+parseInt(1)+"/"+endest.getDate()+"/"+endest.getFullYear())}var rslt=Date.parse(calwk.getMonth()+parseInt(1)+"/"+calwk.getDate()+"/"+calwk.getFullYear());if(void 0==stdat||!rslt)return rslt?rslt:alretdat;if(rslt>stdat||stdat>rslt){rslt=new Date(rslt);var tpd=new Date(stdat);return tpd.getMonth()<rslt.getMonth()&&""==yr?(rslt=calculateweekday(number[1],c[0],tmpwrds[idx+2],tpd.getFullYear()),addtst&&(tmpwrds[idx-2].match(/(from|after)/)?rslt=Date.parse(rslt.getMonth()+parseInt(1)+"/"+(rslt.getDate()+parseInt(addtst))+"/"+rslt.getFullYear()):tmpwrds[idx-2].match(/(from|after)/)&&(rslt=Date.parse(rslt.getMonth()+parseInt(1)+"/"+(rslt.getDate()-parseInt(addtst))+"/"+rslt.getFullYear()))),rslt):(""==yr&&(rslt=calculateweekday(number[1],c[0],tmpwrds[idx+2],tpd.getFullYear()+1),addtst&&(tmpwrds[idx-2].match(/(from|after)/)?rslt=Date.parse(rslt.getMonth()+parseInt(1)+"/"+(rslt.getDate()+parseInt(addtst))+"/"+rslt.getFullYear()):tmpwrds[idx-2].match(/(before)/)&&(rslt=Date.parse(rslt.getMonth()+parseInt(1)+"/"+(rslt.getDate()-parseInt(addtst))+"/"+rslt.getFullYear())))),rslt?rslt:Date.parse(curdate.getMonth()+parseInt(1)+"/"+curdate.getDate()+"/"+curdate.getFullYear()))}}else{if(tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(of|for)/)&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/(next|this|every)/)&&(tmpwrds[idx+3]&&!tmpwrds[idx+3].match("month")&&tmpwrds[idx+3].match(/[0-9]{1,2}/)&&tmpwrds[idx+4]&&tmpwrds[idx+4].match("month")||tmpwrds[idx+3]&&tmpwrds[idx+3].match("month"))){"every"==tmpwrds[idx+2]&&(wkrpobj.monthly=1,monthday=c[0],monthindx=number[1],tmpwrds[idx+3].match(/[0-9]{1,2}/)&&tmpwrds[idx+4].match("month")&&(monthct=tmpwrds[idx+3]));var temp=tmpwrds[idx+2];tmpwrds[idx+2]="next"==tmpwrds[idx+2]?monthff[curdate.getMonth()+1]:monthff[curdate.getMonth()];var calwk=calculateweekday(number[1],c[0],tmpwrds[idx+2],"");if(addtst&&(tmpwrds[idx-2].match(/(from|after)/)?calwk.setDate(calwk.getDate()+parseInt(addtst)):tmpwrds[idx-2].match(/(before)/)&&calwk.setDate(calwk.getDate()-parseInt(addtst))),addtet){var endest=new Date;endest.setDate(calwk.getDate()),endest.setMonth(calwk.getMonth()),endest.setFullYear(calwk.getFullYear()),endest.setDate(endest.getDate()+parseInt(addtet)),etdat=Date.parse(endest.getMonth()+parseInt(1)+"/"+endest.getDate()+"/"+endest.getFullYear())}var rslt=Date.parse(calwk.getMonth()+parseInt(1)+"/"+calwk.getDate()+"/"+calwk.getFullYear());if(void 0!=stdat&&rslt){if(stdat>rslt){rslt=new Date(rslt);var tpd=new Date(stdat),moth=temp.match("next")&&monthff.indexOf(tmpwrds[idx+2])!=tpd.getMonth()?monthff[tpd.getMonth()+1==12?"0":tpd.getMonth()+1]:monthff[tpd.getMonth()];return calwk=calculateweekday(number[1],c[0],moth,tpd.getFullYear()),Date.parse(calwk.getMonth()+parseInt(1)+"/"+calwk.getDate()+"/"+calwk.getFullYear())}return rslt}return rslt?rslt:alretdat}if(tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(of|for)/)&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/(next|this|every)/)&&month.indexOf(tmpwrds[idx+3])>-1){var yr=tmpwrds[idx+3]&&tmpwrds[idx+3].match(/[0-9]{4}/)?tmpwrds[idx+3]:"next"==tmpwrds[idx+2]?parseInt(curdate.getFullYear())+parseInt(1):"";t.match(/every/)&&(wkrpobj.yearly=1,yearday=c[0],yearmonname=tmpwrds[idx+3],yearindex=number[1]);var calwk=calculateweekday(number[1],c[0],tmpwrds[idx+3],yr),rslt=Date.parse(calwk.getMonth()+parseInt(1)+"/"+calwk.getDate()+"/"+calwk.getFullYear());if(void 0==stdat||!rslt)return rslt?rslt:alretdat;if(rslt>stdat||stdat>rslt){rslt=new Date(rslt);var tpd=new Date(stdat);return tpd.getMonth()<rslt.getMonth()&&""==yr?(rslt=calculateweekday(number[1],c[0],tmpwrds[idx+2],tpd.getFullYear()),"Invalid Date"!=rslt?rslt:alretdat):(""==yr&&(rslt=calculateweekday(number[1],c[0],tmpwrds[idx+2],tpd.getFullYear()+1)),"Invalid Date"!=rslt?rslt:alretdat)}}else{if(tmpwrds[idx-1]&&tmpwrds[idx-1].match("every")||tmpwrds[idx-2]&&tmpwrds[idx-2].match("every")){wkrpobj.monthly=1,monthday=c[0],monthindx=number[1];var rslt=calculateweekday(number[1],c[0],monthsh[curdate.getMonth()],curdate.getFullYear());return"Invalid Date"!=rslt?rslt:alretdat}if(tmpwrds[idx-3]&&tmpwrds[idx-3].match(/\b(weekday)s?\b/)&&tmpwrds[idx-4]&&tmpwrds[idx-4].match(/\b(every|all)\b/)){wkrpobj.daily=1,dailyweekday=1;var rslt=calculateweekday(number[1],c[0],monthsh[curdate.getMonth()],curdate.getFullYear());return"Invalid Date"!=rslt?rslt:alretdat}if(!t.match(/\b(every|all)\b/)){var calwk;if(calwk=number[0].match("next")||number[0].match("this")?number[0].match(/(next)/)?monthcap.indexOf(c[0])>-1?dayrel[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel[monthcapsh.indexOf(c[0])]:"":monthcap.indexOf(c[0])>-1?dayrel2[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel2[monthcapsh.indexOf(c[0])]:"":number[0].match("last")&&!stdat?monthcap.indexOf(c[0])>-1?dayrel3[monthcap.indexOf(c[0])]:monthcapsh.indexOf(c[0])>-1?dayrel3[monthcapsh.indexOf(c[0])]:"":calculateweekday(number[1],c[0],monthsh[curdate.getMonth()],""),calwk&&tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)){var exdtin=new Date;exdtin.setDate(calwk.getDate()),exdtin.setMonth(calwk.getMonth()),exdtin.setFullYear(calwk.getFullYear()),exdtin.setDate(exdtin.getDate()+parseInt(tmpwrds[idx+2])),etdat=etdat?etdat:Date.parse(exdtin.getMonth()+parseInt(1)+"/"+exdtin.getDate()+"/"+exdtin.getFullYear())}if(addtst&&calwk.setDate(calwk.getDate()+parseInt(addtst)),addtet){var endest=new Date;endest.setDate(calwk.getDate()),endest.setMonth(calwk.getMonth()),endest.setFullYear(calwk.getFullYear()),endest.setDate(endest.getDate()+parseInt(addtet)),endest.setDate(endest.setDate()+parseInt(addtet)),etdat=Date.parse(endest.getMonth()+parseInt(1)+"/"+endest.getDate()+"/"+endest.getFullYear())}return Date.parse(calwk.getMonth()+parseInt(1)+"/"+calwk.getDate()+"/"+calwk.getFullYear())}if(t.match(/(every|all)\s?(weekday)s?/)){wkrpobj.daily=1,dailyweekday=1;var rslt=calculateweekday(number[1],c[0],monthsh[curdate.getMonth()],curdate.getFullYear());return"Invalid Date"!=rslt?rslt:alretdat}if(t.match(/(every|all)\s?(weekend)s?/)){wkrpobj.weekly=1,weekdy="saturday,sunday",repbfrefrom=1;var rslt=calculateweekday(number[1],c[0],monthsh[curdate.getMonth()],curdate.getFullYear());return"Invalid Date"!=rslt?rslt:alretdat}if(t.match(/every\s([0-9]{1,2})?\s?(month)s?/)){var tmp=t.match(/every\s([0-9]{1,2})?\s?(month)s?/),num=tmp[0].match(/[0-9]{1,2}/)?tmp[0].match(/[0-9]{1,2}/):"";wkrpobj.monthly=1,monthindx=tmpwrds[idx-1],monthday=c[0],monthct=num[0]?num[0]:"";var rslt=calculateweekday(number[1],c[0],monthsh[curdate.getMonth()],curdate.getFullYear());return"Invalid Date"!=rslt?rslt:alretdat}}}}}if(15==d){var tmpwrds=t.split(regex1),temp=c[0].replace(/(\s|,)/g,"/"),num=temp.split("/"),idx=tmpwrds.indexOf(num[0]);if(!(tmpwrds[idx-1].match(/(from|after)/)&&tmpwrds[idx-2].match(/(day)s?/)&&tmpwrds[idx-3]&&tmpwrds[idx-3].match(/[0-9]{1,2}/)))return idx=tmpwrds.indexOf(4==num.length?num[3]:num[2]),tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)&&(ed=Date.parse(4==num.length?num[2]+(parseInt(num[0].replace(/[^(\d+)]/g,""))+parseInt(tmpwrds[idx+2]))+"/"+num[3]:num[2]+"/"+(parseInt(num[0].replace(/[^(\d+)]/g,""))+parseInt(tmpwrds[idx+2]))+"/"+curdate.getFullYear())),Date.parse(4==num.length?num[2]+num[0].replace(/[^(\d+)]/g,"")+"/"+num[3]:num[2]+num[0].replace(/[^(\d+)]/g,"")+"/"+curdate.getFullYear());if(4==num.length)var temdat=new Date(Date.parse(num[2]+num[0].replace(/[^(\d+)]/g,"")+"/"+num[3]));else var temdat=new Date(Date.parse(num[2]+num[0].replace(/[^(\d+)]/g,"")+"/"+curdate.getFullYear()));if("Invalid Date"!=temdat&&tmpwrds[idx-4]&&"for"!=tmpwrds[idx-4]){if(temdat.setDate(temdat.getDate()+parseInt(tmpwrds[idx-3])),idx=tmpwrds.indexOf(3==num.length?num[2]:num[1]),tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(for)/)&&tmpwrds[idx+2]&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3]&&tmpwrds[idx+3].match(/(day)s?/)){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx+2])),ed=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear())}return Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear())}if("Invalid Date"!=temdat&&tmpwrds[idx-4]&&"for"==tmpwrds[idx-4]){var temdat2=new Date(Date.parse(temdat.getMonth()+parseInt(1)+"/"+temdat.getDate()+"/"+temdat.getFullYear()));return temdat2.setDate(temdat2.getDate()+parseInt(tmpwrds[idx-3])),ed=Date.parse(temdat2.getMonth()+parseInt(1)+"/"+temdat2.getDate()+"/"+temdat2.getFullYear()),temdat}if("Invalid Date"==temdat)return alretdat}if(18==d){var tmpwords=t.split(regex1),idx=tmpwords.indexOf(c[0]);if(monthpcap.indexOf(c[0])>-1&&"next"!=tmpwords[idx-1]){var det=dayrel2[monthpcap.indexOf(c[0])];if(wkrpobj.weekly=1,tmpwords[idx+1]&&tmpwords[idx+1].match("for")&&tmpwords[idx+2]&&tmpwords[idx+2].match(/[0-9]{1,2}/)&&tmpwords[idx+3].match(/((month)s?)/)){var caluntdat=new Date;caluntdat.setMonth(caluntdat.getMonth()+(parseInt(tmpwords[idx+2])+1)),caluntdat.setDate(0),weekuntil=caluntdat}else if(tmpwords[idx+1]&&tmpwords[idx+1].match("for")&&tmpwords[idx+2]&&tmpwords[idx+2].match(/[0-9]{1,2}/)&&tmpwords[idx+3].match(/((week)s?)/)){var caluntdat=new Date,daycnt=caluntdat.getDay(),cnt=0==daycnt?7*(tmpwords[idx+2]-1):7*(tmpwords[idx+2]-1)+(7-daycnt);caluntdat.setDate(caluntdat.getDate()+parseInt(cnt)),weekuntil=caluntdat}var rslt="Invalid Date"!=det?Date.parse(det.getMonth()+parseInt(1)+"/"+det.getDate()+"/"+det.getFullYear()):"";return""!=rslt?rslt:alretdat}}if(19==d){var tmpwrds=t.split(regex1),idx=tmpwrds.indexOf(c[0]);if(stdat){var det=tmpwrds[idx-1]&&tmpwrds[idx-1].match("this")?getThisWeekDay(new Date,0):tmpwrds[idx-1]&&tmpwrds[idx-1].match("next")?getNextWeekDay(new Date,0):getThisWeekDay(new Date,0),rslt=Date.parse(det.getMonth()+parseInt(1)+"/"+det.getDate()+"/"+det.getFullYear());return rslt}var det=tmpwrds[idx-1]&&tmpwrds[idx-1].match("this")?getThisWeekDay(new Date,6):tmpwrds[idx-1]&&tmpwrds[idx-1].match("next")?getNextWeekDay(new Date,6):getThisWeekDay(new Date,6),rslt=Date.parse(det.getMonth()+parseInt(1)+"/"+det.getDate()+"/"+det.getFullYear());if(tmpwrds[idx+1]&&tmpwrds[idx+1].match("for")&&tmpwrds[idx+2].match(/[0-9]{1,2}/)&&tmpwrds[idx+3].match(/((month)s?|(week)s?)/))if(tmpwrds[idx+3].match(/(month)s?/)){var temm=t.match(/(for)\s?[0-9]{1,2}\s?(month)s?/),num=temm[0].match(/[0-9]{1,2}/),caldav=new Date;caldav.setMonth(caldav.getMonth()+parseInt(num[0])),caldav.setDate(0),weekuntil=caldav}else{var temm=t.match(/(for)\s?[0-9]{1,2}\s?(week)s?/),num=temm[0].match(/[0-9]{1,2}/),caluntdat=new Date,daycnt=caluntdat.getDay(),cnt=0==daycnt?7*(tmpwrds[idx+2]-1):7*(tmpwrds[idx+2]-1)+(7-daycnt);caluntdat.setDate(caluntdat.getDate()+parseInt(cnt)),weekuntil=caluntdat}if(tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(from|of|in)/)&&month.indexOf(tmpwrds[idx+2])>-1){var gmo=monthsh.indexOf(tmpwrds[idx+2])>-1?monthsh.indexOf(tmpwrds[idx+2]):monthff.indexOf(tmpwrds[idx+2])>-1?monthff.indexOf(tmpwrds[idx+2]):"";if(rslt=Date.parse(gmo+parseInt(1)+"/01/"+curdate.getFullYear()),wkrpobj.weekly=1,weekdy="saturday,sunday",tmpwrds[idx+1].match(/(of|in)/)){var esd=new Date(rslt);esd.setMonth(esd.getMonth()+1),esd.setDate(0),weekuntil=Date.parse(esd.getMonth()+parseInt(1)+"/"+esd.getDate()+"/"+esd.getFullYear())}}if(tmpwrds[idx+1]&&tmpwrds[idx+1].match(/(from|of|in)/)&&tmpwrds[idx+2].match(/(this|next)/)&&tmpwrds[idx+3].match("month")){var gmo=tmpwrds[idx+2].match("this")?curdate.getMonth():curdate.getMonth()+1;if(rslt=Date.parse(gmo+parseInt(1)+"/01/"+curdate.getFullYear()),tmpwrds[idx+1].match(/(of|in)/)){var esd=new Date(rslt);esd.setMonth(esd.getMonth()+1),esd.setDate(0),weekuntil=Date.parse(esd.getMonth()+parseInt(1)+"/"+esd.getDate()+"/"+esd.getFullYear())}}return rslt}if(20==d||21==d){var yearidx;t.match(/[0-9]{4}/)&&(yearidx=t.match(/[0-9]{4}/));var splitind=c[0].split("-"),numsplit=20==d?splitind[0].split(/[0-9]{1,2}/):21==d?splitind[1].split(/[0-9]{1,2}/):"";return etdat=etdat?etdat:20==d?Date.parse(numsplit[0]+" "+splitind[1]+" "+(yearidx&&yearidx[0]?yearidx[0]:curdate.getFullYear())):21==d?Date.parse(splitind[1]+" "+(yearidx&&yearidx[0]?yearidx[0]:curdate.getFullYear())):"",20==d?Date.parse(splitind[0]+" "+(yearidx&&yearidx[0]?yearidx[0]:curdate.getFullYear())):21==d?Date.parse(numsplit[1]+" "+splitind[0]+" "+(yearidx&&yearidx[0]?yearidx[0]:curdate.getFullYear())):""}if(22==d){var spltvar=c[0].split("-"),temp=spltvar[0].replace(/(\s)/g,"/"),temp1=spltvar[1].replace(/(\s)/g,"/"),num=temp.split("/"),num1=temp1.split("/");return etdat=etdat?etdat:Date.parse(num1[0].replace(/[^(\d+)]/g,"")+" "+num1[1]+" "+curdate.getFullYear()),Date.parse(num[0].replace(/[^(\d+)]/g,"")+" "+num[1]+" "+curdate.getFullYear())}if(23==d||24==d){var spltvar=c[0].split("-"),temp1=23==d?spltvar[1].replace(/(\s)/g,"/"):spltvar[0].replace(/(\s)/g,"/"),num1=temp1.split("/");return etdat=etdat?etdat:Date.parse((23==d?num1[0].replace(/[^(\d+)]/g,""):spltvar[1].replace(/[^(\d+)]/g,""))+" "+(23==d?num1[1]:num1[0])+" "+curdate.getFullYear()),Date.parse((23==d?spltvar[0].replace(/[^(\d+)]/g,""):num1[1].replace(/[^(\d+)]/g,""))+" "+(23==d?num1[1]:num1[0])+" "+curdate.getFullYear())}}catch(ex){}}function timefilter(c,d){try{if(0==d){if(c[0].match(/(:|\.)/)){var temp=c[0].match(/(:)/)?c[0].split(":"):c[0].match(/(.)/)?c[0].split("."):"";if(temp[0]=temp[1].match("pm")?temp[0]<12?12+parseInt(temp[0]):temp[0]:12==temp[0]||24==temp[0]?0:temp[0],0!=op)temp[1]=temp[1].match("pm")?temp[1].replace("pm",""):temp[1].match("am")?temp[1].replace("am",""):temp[1].match("hrs")?temp[1].replace("hrs",""):"";else{if(sttim&&1==equatedt){var hour=parseInt(sttim/36e5),min=parseInt(sttim/6e4)%60,hourcor=temp[1].match("pm")?12>hour?parseInt(hour)+parseInt(12):hour:temp[1].match("am")?hour:temp[1].match("hours")&&12>hour?hour+parseInt(12):hour;sttim=36e5*hourcor+parseInt(6e4*min)}equatedt=temp[1].match(/(am|pm|hrs)/)?0:1,temp[1]=temp[1].match("pm")?temp[1].replace("pm",""):temp[1].match("am")?temp[1].replace("am",""):temp[1].match("hrs")?temp[1].replace("hrs",""):temp[1]}var millis=0!=temp[0]?36e5*temp[0]:1;return millis+=0!=temp[1]?6e4*temp[1]:1e3}if(0!=op){if(!c[0].match(/(hrs)/)){var tod=c[0].match("pm")?"1":c[0].match("am")?"0":null;c[0]=c[0].match("pm")?c[0].replace("pm",""):c[0].match("am")?c[0].replace("am",""):""}}else{if(sttim&&1==equatedt){var hour=parseInt(sttim/36e5),min=parseInt(sttim/6e4)%60,hourcor=c[0].match("pm")?12>hour?parseInt(hour)+parseInt(12):hour:c[0].match("am")?hour:c[0].match("hours")&&12>hour?hour+parseInt(12):hour;sttim=36e5*hourcor+parseInt(min?6e4*min:0)}if(equatedt=c[0].match(/(am|pm|hrs)/)?0:1,!c[0].match(/(hrs)/)){var tod=c[0].match("pm")?"1":c[0].match("am")?"0":"0";c[0]=c[0].match("pm")?c[0].replace("pm",""):c[0].match("am")?c[0].replace("am",""):c[0]}}if(c[0].match(/(hrs)/)){if(c[0]=c[0].match(/(hrs)/)?c[0].replace("hrs","").trim():c[0],2==c[0].length&&c[0]<24||4==c[0].length&&c[0]<2400){var millis=2==c[0].length?36e5*c[0]:4==c[0].length?36e5*parseInt(c[0]/100):"";return millis=0==millis?1e3:millis,millis=2==c[0].length?millis:4==c[0].length?millis+c[0]%100*6e4:""}return""}if(!c[0].match(/(hrs)/)){c[0]=1==tod?c[0]<12?12+parseInt(c[0]):c[0]:0==tod?12==c[0]?-1:c[0]:"";var millis=""!=c[0]?-1!=c[0]?36e5*c[0]:1e3:"";return millis}}if((2==d||3==d)&&timeofday[c[0]]){var millis=timeofday[c[0]];return millis}if(4==d){var splitind=c[0].split("-"),numsplit=splitind[1].match(/(am|pm)/);if(splitind[0].match(/(:|\.)/)){var temp=splitind[0].match(/(:)/)?splitind[0].split(":"):splitind[0].match(/(\.)/)?splitind[0].split("."):"";temp[0]=temp[1].match("pm")?temp[0]<12?12+parseInt(temp[0]):temp[0]:temp[1].match("am")?12==temp[0]?-1:temp[0]:numsplit[0].match("pm")?temp[0]<12?12+parseInt(temp[0]):temp[0]:12==temp[0]?-1:temp[0],temp[1]=temp[1].match("pm")?temp[1].replace("pm",""):temp[1].match("am")?temp[1].replace("am",""):temp[1];var millis=temp[0]?-1!=temp[0]?36e5*temp[0]:1e3:"";if(millis+=6e4*temp[1],splitind[1].match(/(:|\.)/)){temp=splitind[1].match(/(:)/)?splitind[1].split(":"):splitind[1].match(/(\.)/)?splitind[1].split("."):"",temp[0]=temp[1].match("pm")&&temp[0]<12?12+parseInt(temp[0]):temp[0],temp[1]=temp[1].match("pm")?temp[1].replace("pm",""):temp[1].match("am")?temp[1].replace("am",""):"";var millis2=36e5*temp[0];millis2+=6e4*temp[1],ettim=ettim?ettim:millis2}else{var tod=splitind[1].match("pm")?"1":splitind[1].match("am")?"0":"";splitind[1]=splitind[1].match("pm")?splitind[1].replace("pm",""):splitind[1].match("am")?splitind[1].replace("am",""):splitind[1],splitind[1]=1==tod?splitind[1]<12?12+parseInt(splitind[1]):splitind[1]:0==tod?splitind[1]:"";var millis2=splitind[1]?36e5*splitind[1]:"";ettim=ettim?ettim:millis2}return millis}var tod=splitind[0].match("pm")?"1":splitind[0].match("am")?"0":splitind[1].match("pm")?"1":splitind[1].match("am")?"0":"";splitind[0]=splitind[0].match("pm")?splitind[0].replace("pm",""):splitind[0].match("am")?splitind[0].replace("am",""):splitind[0],splitind[0]=1==tod?splitind[0]<12?12+parseInt(splitind[0]):splitind[0]:0==tod?12==splitind[0]?-1:splitind[0]:"";var millis=splitind[0]?-1!=splitind[0]?36e5*splitind[0]:1e3:"";if(splitind[1].match(/(:|\.)/)){temp=splitind[1].match(/(:)/)?splitind[1].split(":"):splitind[1].match(/(.)/)?splitind[0].split("."):"",temp[0]=temp[1].match("pm")&&temp[0]<12?12+parseInt(temp[0]):temp[0],temp[1]=temp[1].match("pm")?temp[1].replace("pm",""):temp[1].match("am")?temp[1].replace("am",""):"";var millis2=36e5*temp[0];millis2+=6e4*temp[1],ettim=ettim?ettim:millis2}else{var tod=splitind[1].match("pm")?"1":splitind[1].match("am")?"0":"";splitind[1]=splitind[1].match("pm")?splitind[1].replace("pm",""):splitind[1].match("am")?splitind[1].replace("am",""):splitind[1],splitind[1]=1==tod?splitind[1]<12?12+parseInt(splitind[1]):splitind[1]:0==tod?splitind[1]:"";var millis2=splitind[1]?36e5*splitind[1]:"";ettim=ettim?ettim:millis2}return millis}if(1==d&&c[0].match(/(:|\.)/)){var temp=c[0].match(/(:)/)?c[0].split(":"):c[0].match(/(.)/)?c[0].split("."):"",millis=36e5*temp[0];return millis+=6e4*temp[1]}if(5==d)return 36e5*curdate.getHours()+parseInt(6e4*curdate.getMinutes());if(6==d&&sttim){var temp=c[0],multfact=c[0].match(/(hour|hours|hr|hrs)/)?1:c[0].match(/(minute|minutes|min|mins)/)?0:"",numtomul=c[0].match(/[0-9]{1,2}/),timeline=c[0].match(/(after|in)/)?1:0,stmillitoadd=1==multfact?36e5*numtomul[0]:0==multfact?6e4*numtomul[0]:"",stmilli=1==timeline&&stmillitoadd?parseInt(sttim)+parseInt(stmillitoadd):"";return stmilli}}catch(ex){}}function getNextWeekDay(now,d){try{var x=7+d-now.getDay();if(d<now.getDay()&&0==d)var x=14-now.getDay();return now.setDate(now.getDate()+x),now}catch(ex){}}function getThisWeekDay(now,d){try{if(d>=now.getDay())var x=d-now.getDay();else var x=7+d-now.getDay();return now.setDate(now.getDate()+x),now}catch(ex){}}function getday(now,d){try{return now.setDate(now.getDate()+d),now}catch(ex){}}function getLastWeekDay(now,d){try{return now.setDate(now.getDate()-now.getDay()-(7-d)),now}catch(ex){}}function calculateweekday(a,b,c,d){try{var weeknumberreq,setdate,dayofcurweek,d,dayset;return 4==dayinw.indexOf(a)?(setdate=new Date,""!=d&&setdate.setFullYear(d),setdate.setMonth(monthsh.indexOf(c.toLowerCase())>-1?monthsh.indexOf(c.toLowerCase())+parseInt(1):monthff.indexOf(c.toLowerCase())+parseInt(1)),setdate.setDate(0),setdate.setDate(setdate.getDate()-7),dayofcurweek=setdate.getDay(),d=dayofcurweek<(monthcap.indexOf(b)>-1?monthcap.indexOf(b):monthcapsh.indexOf(b)>-1?monthcapsh.indexOf(b):"")?(monthcap.indexOf(b)>-1?monthcap.indexOf(b):monthcapsh.indexOf(b)>-1?monthcapsh.indexOf(b):"")-dayofcurweek:7-(dayofcurweek-(monthcap.indexOf(b)>-1?monthcap.indexOf(b):monthcapsh.indexOf(b)>-1?monthcapsh.indexOf(b):"")),setdate.setDate(setdate.getDate()+d),setdate):(weeknumberreq=dayinw.indexOf(a),setdate=new Date,""!=d&&setdate.setFullYear(d),setdate.setDate(1),setdate.setMonth(monthsh.indexOf(c.toLowerCase())>-1?monthsh.indexOf(c.toLowerCase()):monthff.indexOf(c.toLowerCase())),dayofcurweek=setdate.getDay(),d=dayofcurweek<=(monthcap.indexOf(b)>-1?monthcap.indexOf(b):monthcapsh.indexOf(b)>-1?monthcapsh.indexOf(b):"")?(monthcap.indexOf(b)>-1?monthcap.indexOf(b):monthcapsh.indexOf(b)>-1?monthcapsh.indexOf(b):"")-dayofcurweek:7-(dayofcurweek-(monthcap.indexOf(b)>-1?monthcap.indexOf(b):monthcapsh.indexOf(b)>-1?monthcapsh.indexOf(b):"")),dayset=new Date,dayset.setDate(setdate.getDate()+d+7*weeknumberreq),dayset.setMonth(setdate.getMonth()),dayset.setFullYear(setdate.getFullYear()),dayset)}catch(ex){}}function getresourcedetails(typ,typmatch){if(0==typ&&(resourcebj.typ="PC",resourcebj.details.machine=typmatch[0]),1==typ&&text.match(destination)){var dxn=text.match(destination);resourcebj.typ="CAB",resourcebj.details.destn=dxn[0]}if(2==typ)if(text.match(hallname)){var rnam=text.match(hallname);resourcebj.typ="ROOM",resourcebj.details.room=rnam[0];var flordet=text.match(/[0-9]{1,2}(st|nd|rd)\sfloor/),flrnum=flordet?flordet[0].match(/[0-9]{1,2}/):"",lnam=text.match(locationname);resourcebj.details.flrdt=flrnum?flrnum[0]:"",resourcebj.details.loc=lnam?lnam[0]:""}else{resourcebj.typ="ROOM";var flordet=text.match(/[0-9]{1,2}(st|nd|rd)\sfloor/),flrnum=flordet?flordet[0].match(/[0-9]{1,2}/):"",lnam=text.match(locationname);resourcebj.details.flrdt=flrnum?flrnum[0]:"",resourcebj.details.room="",resourcebj.details.loc=lnam?lnam[0]:""}return 0}var str=cur;if(""==str)return 0;new Date;input=str;var aneg,dayrel=[getNextWeekDay(new Date,0),getNextWeekDay(new Date,1),getNextWeekDay(new Date,2),getNextWeekDay(new Date,3),getNextWeekDay(new Date,4),getNextWeekDay(new Date,5),getNextWeekDay(new Date,6)],relday1=["tomorrow","today","now","dayaftertomorrow","day after tomorrow"],dayrel1=[getday(new Date,1),getday(new Date,0),getday(new Date,0),getday(new Date,2),getday(new Date,2)],dayrel2=[getThisWeekDay(new Date,0),getThisWeekDay(new Date,1),getThisWeekDay(new Date,2),getThisWeekDay(new Date,3),getThisWeekDay(new Date,4),getThisWeekDay(new Date,5),getThisWeekDay(new Date,6)],dayrel3=[getLastWeekDay(new Date,0),getLastWeekDay(new Date,1),getLastWeekDay(new Date,2),getLastWeekDay(new Date,3),getLastWeekDay(new Date,4),getLastWeekDay(new Date,5),getLastWeekDay(new Date,6)],monthcap=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],monthpcap=["sundays","mondays","tuesdays","wednesdays","thursdays","fridays","saturdays"],monthcapsh=["sun","mon","tue","wed","thu","fri","sat"],rtwk=["first","second","third","fourth","last"],curdate=new Date,alretdat=Date.parse(curdate.getMonth()+parseInt(1)+"/"+curdate.getDate()+"/"+curdate.getFullYear()),wkrpobj={};wkrpobj.daily,wkrpobj.weekly,wkrpobj.monthly,wkrpobj.yearly;var yearindex,yearmonname,yearday,yearuntil,yeartype,yeardate,monthindx,monthday,monthct,monthuntil,monthdate,weekuntil,weekdy,weekct,dailyday,dailyweekday,dailyuntil,month=["January","Jan","january","jan","February","february","Feb","feb","March","march","Mar","mar","April","april","Apr","apr","May","may","June","june","Jun","jun","July","july","Jul","jul","August","august","Aug","aug","September","Sep","september","sep","October","Oct","october","oct","November","Nov","november","nov","December","Dec","dec","december"],monthsh=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],monthff=["january","february","march","april","may","june","july","august","september","october","november","december"],ROOM=/(room|hall)/,PC=/\b(test\s?machine|server\s?machine|windows\s?machine|mac\s?machine|windows\sos\smachine|mac\sos\smachine)\b/,EQUIPMENT=/\b(projector|speaker)\b/,CAB=/\b(cab|shuttle)\b/,resourcetype=[PC,CAB,ROOM,EQUIPMENT],resourcebj={};resourcebj.typ,resourcebj.details={};var destination=/\b(avadi|dlf|guindy|puzthivakkam|thirumangalam|vadapalani|velachery|guduvanchery|urapakkam|perungalathur|mogappair|koyambedu|cmbt|medavakkam|vandalur)\b/,hallname=/\b(confluence|meeting|(video\s)?conference|seminar|training|join|lunch|party)\s(room|hall)\b/,locationname=/\b((tower|plaza)\s(building)|estancia)\b/,eventbj={},eventbj2={},reg1=/\b((0?[1-9]|[1|2][0-9]|3[0|1])[\-|\/|\.](0?[1-9]|1[012])[\-|\/|\.](19|20)\d\d)\b/,reg2=/\b(0?[1-9]|1[012])[\-|\/|\.](0?[1-9]|[1|2][0-9]|3[0|1])[\-|\/|\.](19|20)\d\d\b/,reg3=/\b(19|20)\d\d[\-|\/|\.](0?[1-9]|1[012])[\-|\/|\.](0?[1-9]|[1|2][0-9]|3[0|1])\b/,reg4=/\b(19|20)\d\d[\-|\/|\.](0?[1-9]|[1|2][0-9]|3[0|1])[\-|\/|\.](0?[1-9]|1[012])\b/,reg5=/\b(0?[1-9]|[1|2][0-9]|3[0|1])[\-|\/|\.](0?[1-9]|1[012])\b[\-|\/|\.]\d\d\b/,reg6=/\b(0?[1-9]|1[012])\b[\-|\/|\.](0?[1-9]|[1|2][0-9]|3[0|1])[\-|\/|\.]\d\d\b/,reg7=/\b(0?[1-9]|[1|2][0-9]|3[0|1])[\/](0?[1-9]|1[012])\b/,reg8=/\b(0?[1-9]|1[012])[\/](0?[1-9]|[1|2][0-9]|3[0|1])\b/,reg9=/\b(0[1-9]|[1|2][0-9]|3[0|1])[\-|\/|\.]((jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(january|february|march|april|may|june|july|august|september|october|november|december))[\-|\/|\.]?((19|20)?\d\d)?\b/,reg10=/\b(19|20)\d\d[\-|\/|\.]((jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(january|february|march|april|may|june|july|august|september|october|november|december))[\-|\/|\.](0[1-9]|[1|2][0-9]|3[0|1])\b/,reg11=/\b((jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(january|february|march|april|may|june|july|august|september|october|november|december))\s?(0?[1-9]|[1|2][0-9]|3[0|1])((\s|(\s+)?,(\s+)?)?(19|20)\d\d)?\b/,reg12=/\b(0?[1-9]|[1|2][0-9]|3[0|1])\s?((jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(january|february|march|april|may|june|july|august|september|october|november|december))((\s|(\s+)?,(\s+)?)(19|20)?\d\d(?!:))?\b/,reg13=/\b((jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(january|february|march|april|may|june|july|august|september|october|november|december))\s(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)((\s|(\s+)?,(\s+)?)(19|20)\d\d)?\b/,reg14=/\b(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)\s((jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(january|february|march|april|may|june|july|august|september|october|november|december))((\s|(\s+)?,(\s+)?)(19|20)?\d\d)?\b/,reg15=/(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)\sof\s((jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(january|february|march|april|may|june|july|august|september|october|november|december))((\s|(\s+)?,(\s+)?)(19|20)\d\d)?\b/,reg16=/\bsunday\b|\bmonday\b|\btuesday\b|\bwednesday\b|\bthursday\b|\bfriday\b|\bsaturday\b|\bsun\b|\bmon\b|\btue\b|\bwed\b|\bthu\b|\bfri\b|\bsat\b/,reg18=/\b(first|second|third|fourth|last|next|this)\s(\bsunday\b|\bmonday\b|\btuesday\b|\bwednesday\b|\bthursday\b|\bfriday\b|\bsaturday\b|\bsun\b|\bmon\b|\btue\b|\bwed\b|\bthu\b|\bfri\b|\bsat\b)\b/,reg19=/\b(today|now|tomorrow|(day\s?after\s?tomorrow))\b/,reg20=/\b(saturdays|sundays|mondays|tuesdays|wednesdays|thursdays|fridays)\b/,reg21=/\b(weekend)s?\b/,reg22=/\b(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)\s?(0?[1-9]|[1|2][0-9]|3[0|1])-(0?[1-9]|[1|2][0-9]|3[0|1])\b/,reg23=/\b(0?[1-9]|[1|2][0-9]|3[0|1])-(0?[1-9]|[1|2][0-9]|3[0|1])\s?(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)\b/,reg24=/\b(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)-(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)\s(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)\b/,reg25=/\b(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)\s(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)-(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)\s(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)\b/,reg26=/\b(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)\s(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)-(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)\b/,reg27=/\b(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|may|june|july|august|september|october|november|december)[\-|\/|\.](0?[1-9]|[1|2][0-9]|3[0|1])[\-|\/|\.]?((19|20)\d\d)?\b/,reg28=/((today|tomorrow)(\s+)?(,)?)(\s+)?(monday|tuesday|wednesday|thursday|friday|saturday|sunday|sun|mon|tue|wed|thu|fri|sat)(\s+)?(,)?(\s+)?\(?(\s+)?(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)(\s+)?[0-9]{1,2}(st|rd|th|nd)(\s+)?\)?/,reg29=/((today|tomorrow)(\s+)?(,)?(\s)?)?(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|wed|thu|fri|sat)(\s+)?(,)?(\s+)?\(?(\s+)?[0-9]{1,2}(st|rd|nd|th)?(\s+)?(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)(\s+)?\).?/,reg30=/\b(monday|tuesday|wednesday|thursday|friday|saturday|sunday|sun|mon|tue|thu|fri|sat|sun)(,)?(\s+)?(the)?(\s+)?(0?[1-9]|[1|2][0-9]|3[0|1])(st|nd|rd|th)\sof\s((jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(january|february|march|april|may|june|july|august|september|october|november|december))((\s(19|20)\d\d)|('[0-9]{1,2}))?\b/,reg31=/\b[0-9]{1,2}(\s+)?(january|february|march|april|may|june|july|august|sepetember|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)(')[0-9]{1,2}\b/,reg32=/\b[0-9]{1,2}(st|nd|rd|th)(\s+)(of)(\s+)(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)(\s+)?'[0-9]{2}\b/,reg33=/[0-9]{1,2}(st|rd|nd|th)?(\s+)?(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)(\s+)?(,)?(\s?)\(?(\s+)?(monday|tuesday|wednesday|thursday|friday|saturday|sunday|mon|tue|wed|thu|fri|sat|sun)(\s+)?\)?/,reg34=/(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)(\s+)?[0-9]{1,2}(st|rd|nd|th)(\s+)?(,)?(\s+)?\(?(\s+)?(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sun|mon|tue|wed|thu|fri|sat|sun)(\s+)?\)?/,reg35=/\b(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)(\s+)?[0-9]{1,2}(st|rd|nd|th)(\s+)?(,)?(\s+)?[0-9]{4}(\s+)?(,)?(\s+)?(sunday|monday|tuesday|wednesday|thursday|friday|saturday|sat|sun|mon|tue|wed|thu|fri)\b/,mapar=[reg1,reg2,reg3,reg4,reg5,reg6,reg7,reg8,reg9,reg10,reg12,reg14,reg11,reg27,reg13,reg15,reg16,reg19,reg20,reg21,reg22,reg23],regfrtim0=/\b(morning|noon|afternoon|evening)\b/,regfrtim=/\b(dinner|breakfast|lunch|supper|brunch|tea)\b/,timspreg=/\b(0?[0-9]|1[0-9]|2[0-4]){1,2}([:|\.](0[0-9]|[1-4][0-9]|5[0-9]))?\s?(am|pm|hrs)?-(0?[0-9]|1[0-9]|2[0-4]){1,2}([:|\.](0[0-9]|[1-4][0-9]|5[0-9]))?\s?(am|pm|hrs)\b/,regex1=/[ \t\n\r]+/gi,frg=/\b(0?[0-9]|1[0-9]|2[0-4]){1,2}([:|.](0[0-9]|[1-4][0-9]|5[0-9]))?\s?(am|pm|hrs)\b/,frg1=/\b(0?[0-9]|1[0-9]|2[0-3])([:](0[0-9]|[1-4][0-9]|5[0-9]))\b/,frg2=/\b(now)\b/,frg3=/\b(after)\s?[0-9]{1,2}\s?(hours|hrs)\b/,maptar=[frg,frg1,regfrtim0,regfrtim,timspreg,frg2,frg3],monthcap=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],timeofday=new Object;timeofday.noon="43200000",timeofday.breakfast="28800000",timeofday.dinner="75600000",timeofday.lunch="43200000",timeofday.afternoon="43200000",timeofday.supper="61200000",timeofday.morning="28800000",timeofday.evening="61200000",timeofday.tea="61200000";var dayonce,monthonce,numinwords={one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10",eleven:"11",twelve:"12",thirteen:"13",fourteen:"14",fifteen:"15",sixteen:"16",seventeen:"17",eighteen:"18",nineteen:"19",twenty:"20",thirty:"30",forty:"40",fifty:"50",sixty:"60",seventy:"70",eighty:"80",ninty:"90",hundred:"100"},dayinw=["first","second","third","fourth","last"],remindervariable=new Object,correctedwords=input.trim(),morecorrectedwords=correctedwords.toLowerCase();morecorrectedwords=morecorrectedwords.replace(/\ba.m\b/g,"am"),morecorrectedwords=morecorrectedwords.replace(/\bp.m\b/g,"pm");for(var sd,ed,repbfrefrom,stdat,etdat,sttim,ettim,title_ext=morecorrectedwords,indxarr=new Array,taggedWords=morecorrectedwords.split(regex1),beginar=[],endar=[],text="",i=(new Date,new Date,0);i<taggedWords.length;i++)numinwords[taggedWords[i]]&&taggedWords[i+1]&&numinwords[taggedWords[i+1]]&&(taggedWords[i+1]=(parseInt(numinwords[taggedWords[i]])+parseInt(numinwords[taggedWords[i+1]])).toString(),taggedWords[i]="for"==taggedWords[i-1]?taggedWords[i-1]:""),numinwords[taggedWords[i]]&&(taggedWords[i]=numinwords[taggedWords[i]]),taggedWords[i].match(/^(from|(begin)s?|(start)s?|between|(open)s?|starting|commence)$/)&&beginar.push(i),taggedWords[i].match(/^(to|(end)s?|-|and|(close)s?|till|until|over|ending)$/)&&endar.push(i),taggedWords[i].match("once")&&taggedWords[i-1]&&taggedWords[i-1].match(/(day)s?/)&&taggedWords[i-2]&&taggedWords[i-2].match(/[0-9]{1,2}/)&&(dayonce=taggedWords[i-2]),taggedWords[i].match("once")&&taggedWords[i-1]&&taggedWords[i-1].match(/(month)s?/)&&taggedWords[i-2]&&taggedWords[i-2].match(/[0-9]{1,2}/)&&(monthonce=taggedWords[i-2]),text=text+" "+taggedWords[i];if(0!=beginar.length&&0!=endar.length){if(beginar[0]<endar[0]){for(var temp="",initial=0;initial<beginar[0];initial++)temp=temp+" "+taggedWords[initial];if(stdat=matchfordatest(temp),sttim=matchforstime(temp),0==op)for(var t in timeofday)temp.match(t)&&timeofday[t]==sttim&&(sttim="",title_ext=text);temp.match(/\b(every|all)\b/)&&(stdat=temp.match(/\b(every|all)\b/)?"":stdat,sttim=temp.match(/\b(every|all)\b/)?"":sttim,repbfrefrom=1),ettim=sttim?parseInt(sttim)+parseInt(36e5):null}for(var d,c=0;c<beginar.length;c++){var adddays,addhours,addmins,staddhours,staddmins,forst,e=0;if((c<beginar.length?beginar[c]:100)<(c<endar.length?endar[c]:-1)){for(var e=c;beginar[e]<endar[c];)e++;for(var temp="",kl=beginar[c];kl<endar[c];kl++)temp=temp+" "+taggedWords[kl];"days"==taggedWords[beginar[c]-1]&&taggedWords[beginar[c]-2]&&taggedWords[beginar[c]-2].match(/[0-9]{1,2}/)&&taggedWords[beginar[c]-3]&&!taggedWords[beginar[c]-3].match("every")&&("for"==taggedWords[beginar[c]-3]&&(forst=1),adddays=864e5*taggedWords[beginar[c]-2]),taggedWords[beginar[c]-1]&&taggedWords[beginar[c]-1].match(/(hour|hours)/)&&taggedWords[beginar[c]-2]&&taggedWords[beginar[c]-2].match(/[0-9]{1,2}/)&&taggedWords[beginar[c]-3]&&!taggedWords[beginar[c]-3].match(/(after|in)/)?addhours=36e5*taggedWords[beginar[c]-2].match(/[0-9]{1,2}/):taggedWords[beginar[c]-1]&&taggedWords[beginar[c]-1].match(/(hour|hours)/)&&taggedWords[beginar[c]-2]&&taggedWords[beginar[c]-2].match(/[0-9]{1,2}/)&&taggedWords[beginar[c]-3]&&taggedWords[beginar[c]-3].match(/(after|in)/)&&(staddhours=36e5*taggedWords[beginar[c]-2].match(/[0-9]{1,2}/)),taggedWords[beginar[c]-1]&&taggedWords[beginar[c]-1].match(/(minute|minutes)/)&&taggedWords[beginar[c]-2]&&taggedWords[beginar[c]-2].match(/[0-9]{1,2}/)&&taggedWords[beginar[c]-3]&&!taggedWords[beginar[c]-3].match(/(after|in)/)?addmins=6e4*taggedWords[beginar[c]-2].match(/[0-9]{1,2}/):taggedWords[beginar[c]-1]&&taggedWords[beginar[c]-1].match(/(minute|minutes)/)&&taggedWords[beginar[c]-2]&&taggedWords[beginar[c]-2].match(/[0-9]{1,2}/)&&taggedWords[beginar[c]-3]&&taggedWords[beginar[c]-3].match(/(after)/)&&(staddmins=6e4*taggedWords[beginar[c]-2].match(/[0-9]{1,2}/));var ed=1;if(stdat?sttim||void 0!=matchfordatest(temp)||(sttim=sttim?sttim:matchforstime(temp),ettim=ettim?"":addhours?parseInt(matchforstime(temp))+parseInt(addhours):addmins?parseInt(matchforstime(temp))+parseInt(addmins):"",ed=0):(stdat=stdat?stdat:adddays&&!forst?parseInt(matchfordatest(temp))+parseInt(adddays):matchfordatest(temp),1==forst&&(etdat=etdat?etdat:parseInt(matchfordatest(temp))+parseInt(adddays)),sttim=sttim?sttim:staddhours?parseInt(matchforstime(temp))+parseInt(staddhours):staddmins?parseInt(matchforstime(temp))+parseInt(staddmins):matchforstime(temp),ettim=ettim?ettim:addhours?parseInt(matchforstime(temp))+parseInt(addhours):addmins?parseInt(matchforstime(temp))+parseInt(addmins):"",ed=0),(stdat||sttim)&&0==ed&&("and"==taggedWords[endar[c]]&&("between"==taggedWords[beginar[c]]||e-1!=c&&morecorrectedwords.match("between")||taggedWords[endar[c]+1]&&taggedWords[endar[c]+1].match(/(end|ends|closes|over|close|ending)/)||(c+1<endar.length?taggedWords[endar[c+1]].match(/(end|ends|closes|close|over|to|ending)/):""))||"and"!=taggedWords[endar[c]])){for(var temp1="",usec="",kl=endar[c]+1;kl<beginar[c+1];kl++)temp1=temp1+" "+taggedWords[kl];if("and"==taggedWords[endar[c]]&&"between"!=taggedWords[beginar[c]]){var chkvar=matchfordateet(temp1)?matchfordateet(temp1):matchforetime(temp1)?matchforetime(temp1):"";chkvar&&(temp1="")}if(temp1&&temp1.match("to")){var exendt=temp1.split("to");usec=exendt[1]}if(!beginar[c+1]&&endar[c+1]){for(var kt=endar[c]+1;kt<endar[c+1];kt++)temp1=temp1+" "+taggedWords[kt];if("and"==taggedWords[endar[c]]&&taggedWords[endar[c+1]].match(/(end|ends|closes|over|to|close|ending)/)){var chkvar=matchfordateet(temp1)?matchfordateet(temp1):matchforetime(temp1)?matchforetime(temp1):"";if(chkvar)"between"!=taggedWords[beginar[c]]&&(temp1="");else for(var kt=endar[c+1];kt<taggedWords.length;kt++)temp1=temp1+" "+taggedWords[kt]}if("to"==taggedWords[kt])for(var ktw=kt;ktw<taggedWords.length;ktw++)usec=usec+" "+taggedWords[ktw]}if(!beginar[c+1]&&!endar[c+1]&&!temp1)for(var kt=endar[c]+1;kt<taggedWords.length;kt++)temp1=temp1+" "+taggedWords[kt];if(e-1!=c&&beginar[e]&&!temp1)for(var kc=endar[c]+1;kc<beginar[e];kc++)temp1=temp1+" "+taggedWords[kc];else if(e-1!=c&&!beginar[e]&&!temp1){for(var kc=endar[c]+1;kc<taggedWords.length;kc++)temp1=temp1+" "+taggedWords[kc];if("and"==taggedWords[endar[c]]&&"between"!=taggedWords[beginar[c]]&&e-1!=c&&taggedWords["between"!=beginar[e-1]]){var chkvar=matchfordateet(temp1)?matchfordateet(temp1):matchforetime(temp1)?matchforetime(temp1):"";chkvar&&(temp1="")}}var chk=0;if(temp1.match(/[0-9]{1,2}\s?(day)s?/)){for(var kt=endar[c]+1;kt<(beginar[c+2]?beginar[c+2]:endar[c+1]?endar[c+1]:taggedWords.length);kt++)temp1=temp1+" "+taggedWords[kt];chk=1,beginar.shift()}var chk1=0;if(temp1.match(/[0-9]{1,2}\s?(hours|hour|minute|minutes)/)){for(var kt=endar[c]+1;kt<(beginar[c+2]?beginar[c+2]:endar[c+1]?endar[c+1]:taggedWords.length);kt++)temp1=temp1+" "+taggedWords[kt];chk1=1,beginar.shift()}if(etdat=etdat?etdat:matchfordateet(temp1),!temp1.match(/[0-9]{1,2}\s?(day)s?\s?(from|after)/)&&1==chk){var notoadd=temp1.match(/[0-9]{1,2}/);etdat=etdat?etdat:parseInt(stdat)+864e5*notoadd[0]}ettim=ettim?ettim:matchforetime(temp1),ettim&&!sttim&&usec&&matchforetime(usec)&&(sttim=ettim,ettim=matchforetime(usec)),stdat&&!etdat&&(etdat=stdat),!stdat&&etdat&&sttim&&(stdat=Date.parse(curdate.getMonth()+parseInt(1)+"/"+curdate.getDate()+"/"+curdate.getFullYear())),sttim&&!ettim&&(ettim=sttim+36e5),!sttim&&ettim&&(sttim=ettim-36e5)}}else if(c<endar.length&&endar[c]){for(var tbrvr,brvr=endar[c],temp="",preved=etdat,ed=0,kr=0;kr<endar[c];kr++)temp=temp+" "+taggedWords[kr];if(stdat=stdat?stdat:matchfordatest(temp),ed=!stdat&&taggedWords[endar[c]].match(/(till|end|ends)/)?1:"",sttim=sttim?sttim:matchforstime(temp),ed=!sttim&&taggedWords[endar[c]].match(/(till|end|ends )/)?1!=ed?1:ed:"",stdat||sttim||1==ed){for(var temp1="",kt=endar[c];kt<beginar[c];kt++)temp1=temp1+" "+taggedWords[kt];etdat=etdat?etdat:matchfordateet(temp1),tbrvr=matchfordateet(temp1),ettim=ettim?ettim:matchforetime(temp1),etdat&&!stdat&&(stdat=stdat?stdat:Date.parse(curdate.getMonth()+parseInt(1)+"/"+curdate.getDate()+"/"+curdate.getFullYear())),ettim&&!sttim&&(sttim=sttim?sttim:parseInt(36e5*curdate.getHours())+parseInt(6e4*curdate.getMonth()))}if(endar.shift(),"and"==taggedWords[brvr]&&void 0!=tbrvr||tbrvr&&tbrvr!=etdat){etdat=preved?preved:"";break}if(c=endar[c]?c-1:c,!endar[c]){if(!stdat){for(var temp="",tk=beginar[c];tk<taggedWords.length;tk++)temp=temp+" "+taggedWords[tk];stdat=matchfordatest(temp)}if(!sttim){for(var temp="",tk=beginar[c];tk<taggedWords.length;tk++)temp=temp+" "+taggedWords[tk];sttim=matchforstime(temp)}}}else{if(!stdat){for(var temp="",tk=beginar[c];tk<taggedWords.length;tk++)temp=temp+" "+taggedWords[tk],e=0;stdat=matchfordatest(temp)}if(!sttim){for(var temp="",tk=beginar[c];tk<taggedWords.length;tk++)temp=temp+" "+taggedWords[tk],e=0;sttim=matchforstime(temp)}}c=e-1==c||0==e?c:e-1}}if(0==beginar.length&&0!=endar.length)for(var c=0;c<endar.length;c++)if(0==c){for(var temp="",kl=0;kl<endar[c];kl++)temp=temp+" "+taggedWords[kl];var ed=1;if(stdat)sttim||void 0!=matchfordatest(temp)||(sttim=sttim?sttim:matchforstime(temp),ed=0);else{if(stdat=stdat?stdat:matchfordatest(temp),wkrpobj.daily=taggedWords[endar[c]].match(/(ends|end|until|till)/)&&!stdat&&temp.match(/(every|all)\s?(weekday)s?/)?1:"",dailyweekday=taggedWords[endar[c]].match(/(ends|end|until|till)/)&&!stdat&&temp.match(/(every|all)\s?(weekday)s?/)?1:"",taggedWords[endar[c]].match(/(ends|end|until|till)/)&&!stdat&&1!=wkrpobj.daily){var tg=temp.match(/every\s?[0-9]{1,2}\s?(day)s?/);dailyweekday=tg?1:"",wkrpobj.daily=tg?1:"";var tnu=tg?tg[0].match(/[0-9]{1,2}/):"";dailyday=tnu?tnu[0]:""}if(taggedWords[endar[c]].match(/(ends|end|until|till)/)&&!stdat&&1!=wkrpobj.daily&&temp.match(/[0-9]{1,2}\s?of\s?every\s?([0-9]{1,2})?\s?month/)){var txmod=temp.split("every"),numo=txmod[0].match(/[0-9]{1,2}/);if(txmod[1].match(/[0-9]{1,2}\s?month/)){var tx1mod=txmod[1].match(/[0-9]{1,2}\s?month/),num=tx1mod[0].match(/[0-9]{1,2}/);wkrpobj.monthly=1,monthdate=numo[0],monthct=num[0]}else wkrpobj.monthly=1,monthdate=numo[0]}stdat=taggedWords[endar[c]].match(/(ends|end|until|till)/)&&!stdat?Date.parse(curdate.getMonth()+parseInt(1)+"/"+curdate.getDate()+"/"+curdate.getFullYear()):stdat,sttim=sttim?sttim:matchforstime(temp),sttim=taggedWords[endar[c]].match(/(end|ends|until|till)/)&&!sttim?parseInt(36e5*curdate.getHours())+parseInt(6e4*curdate.getMinutes()):sttim,ed=0}if((stdat||sttim)&&0==ed&&"and"!=taggedWords[endar[c]]){for(var temp1="",kt=endar[c]+1;kt<endar[c+1];kt++)temp1=temp1+" "+taggedWords[kt];if(endar[c+1]&&temp1)for(var ktw=kt;ktw<taggedWords.length;ktw++)usec=usec+" "+taggedWords[ktw];if(!endar[c+1])for(var kc=endar[c]+1;kc<taggedWords.length;kc++)temp1=temp1+" "+taggedWords[kc];etdat=etdat?etdat:matchfordateet(temp1),ettim=ettim?ettim:matchforetime(temp1),!sttim&&ettim&&usec&&matchforetime(usec)&&(sttim=ettim,ettim=matchforetime(usec)),(etdat||ettim)&&c++}}else{for(var temp="",kl=endar[c-1]+1;kl<endar[c];kl++)"and"!=endar[c-1]&&"and"!=endar[c]&&(temp=temp+" "+taggedWords[kl]);var ed=1;if(stdat?sttim||void 0!=matchfordatest(temp)||(sttim=sttim?sttim:matchforstime(temp),ed=0):(stdat=stdat?stdat:matchfordatest(temp),stdat=taggedWords[endar[c]].match(/(end|ends|till)/)&&!stdat?Date.parse(curdate.getMonth()+parseInt(1)+"/"+curdate.getDate()+"/"+curdate.getFullYear()):stdat,sttim=sttim?sttim:matchforstime(temp),sttim=taggedWords[endar[c]].match(/(end|ends|till)/)&&!sttim?parseInt(36e5*curdate.getHours())+parseInt(6e4*curdate.getMinutes()):sttim,ed=0),(stdat||sttim)&&0==ed){for(var temp1="",kt=endar[c]+1;kt<endar[c+1];kt++)temp1=temp1+" "+taggedWords[kt];if(!endar[c+1])for(var kt=endar[c]+1;kt<taggedWords.length;kt++)temp1=temp1+" "+taggedWords[kt];if(endar[c+1]&&temp1)for(var ktw=kt;ktw<taggedWords.length;ktw++)usec=usec+" "+taggedWords[ktw];etdat=etdat?etdat:matchfordateet(temp1),ettim=ettim?ettim:matchforetime(temp1),!sttim&&ettim&&usec&&matchforetime(usec)&&(sttim=ettim,ettim=matchforetime(usec))}}var equatedt,calc;if(text.match(/(remind|reminder|notify|notification)/)){var splitword=text.match(/(remind|reminder|notify|notification)/),extractedtext=text.split(splitword[0]);if(extractedtext[1].match(/((in)?\s?[0-9]{1,2}\s?(day|hour|hr|minute|min)s?)/)){var extractedversion=extractedtext[1].match(/((in|after|before)?\s?[0-9]{1,2}\s?(day|hour|hr|minute|min)s?\s?(after|before)?)/),num=extractedversion[0].match(/[0-9]{1,2}/),mulfact=extractedversion[0].match(/(day)s?/)?864e5:extractedversion[0].match(/(hour|hr)s?/)?36e5:extractedversion[0].match(/(minute|min)s?/)?6e5:"",remty=extractedversion[0].match(/after/)?1:extractedversion[0].match(/before/)?0:1,itrval=num*mulfact,isrem=!0;remindervariable.isrem=isrem,remindervariable.remt=itrval,remindervariable.remty=remty}extractedtext[0].match(/([0-9]{1,2}\s?(day|hour|hr|minute|min)s?)/)&&(remindervariable.isrem="")}if(void 0==sttim&&void 0==stdat){if(stdat=matchfordatest(text),text.match(/((this|next)?\s?weekend)/)&&stdat){var txe=text.match(/((this|next)?\s?weekend)/),det=txe[0].match("this")?getThisWeekDay(new Date,0):txe[0].match("next")?getNextWeekDay(new Date,0):getThisWeekDay(new Date,0);etdat=Date.parse(det.getMonth()+parseInt(1)+"/"+det.getDate()+"/"+det.getFullYear())}if(text.match(/(every|all)\s?(weekend)s?/)&&stdat){wkrpobj.weekly=1;{var check=getThisWeekDay(new Date,6);Date.parse(check.getMonth()+parseInt(1)+"/"+check.getDate()+"/"+check.getFullYear())}weekdy="saturday,sunday",etdat=stdat}if(stdat&&!wkrpobj.daily&&!wkrpobj.monthly&&!wkrpobj.weekly&&!wkrpobj.yearly){if(text.match(/(every)\s?(first|second|third|fourth|last)\s?(saturday|sunday|monday|tuesday|wednesday|thursday|friday)/)){wkrpobj.monthly=1;var txrem=text.match(/(every)\s?(first|second|third|fourth|last)\s?(saturday|sunday|monday|tuesday|wednesday|thursday|friday)/),txext=txrem[0].split("every"),finalsplit=txext[1].split(" ");monthday=finalsplit[2],monthindx=finalsplit[1]}if(text.match(/every/)){for(var newtxt=text.split(/every(.+)?/),txt=newtxt[1].split(regex1),cxt="",cx=0;cx<txt.length;cx++)if(txt[cx].match(/(sun|mon|tue|wed|thu|fri|sat|sun|monday|tuesday|wednesday|thursday|friday|saturday|sunday)/)&&!txt[cx-1].match(/(first|second|third|fourth|last)/)){var matwrd=txt[cx].match(/^(sun|mon|tue|wed|thu|fri|sat|sun)$/);matwrd=matwrd?matwrd:txt[cx].match(/^(monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/),cxt+=matwrd?matwrd[0]+",":""}cxt&&(wkrpobj.weekly=1,weekdy=cxt?cxt:weekdy,repbfrefrom=1)}}if(stdat&&1==wkrpobj.weekly&&aneg&&aneg[0].match(/(sun|mon|tue|wed|thu|fri|sat|sun|monday|tuesday|wednesday|thursday|friday|saturday|sunday)/)&&text.match(/every/)){for(var newtxt=text.split(/every(.+)?/),txt=newtxt[1].split(regex1),cxt="",cx=0;cx<txt.length;cx++)if(txt[cx].match(/(sun|mon|tue|wed|thu|fri|sat|sun|monday|tuesday|wednesday|thursday|friday|saturday|sunday)/)){var matwrd=txt[cx].match(/^(sun|mon|tue|wed|thu|fri|sat|sun)$/);matwrd=matwrd?matwrd:txt[cx].match(/^(monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/),cxt+=matwrd?matwrd[0]+",":""}wkrpobj.weekly=1,weekdy=cxt?cxt:weekdy,repbfrefrom=1}calc=stdat?stdat:"0"}if(void 0==calc&&0!=calc||void 0!=sttim||(sttim=matchforstime(text)),void 0==stdat&&void 0==etdat){if(stdat=Date.parse(curdate.getMonth()+parseInt(1)+"/"+curdate.getDate()+"/"+curdate.getFullYear()),etdat=stdat,text.match(/(every|all)\s?(weekday)s?/)&&(wkrpobj.daily=1,dailyweekday=1),text.match(/(every|all)\s?(weekday)s?\s?(of|from|in)\s?(january|jan|february|feb|march|mar|april|apr|may|jun|june|jul|july|august|aug|september|sep|october|oct|november|nov|december|dec)/)){var dext=text.match(/(every|all)\s?(weekday)s?\s?(of|from|in)\s?(january|jan|february|feb|march|mar|april|apr|may|jun|june|jul|july|august|aug|september|sep|october|oct|november|nov|december|dec)/),exmon=dext[0].match(/(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/)?dext[0].match(/(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/):dext[0].match(/(january|february|march|april|may|june|july|august|september|october|november|december)/)?dext[0].match(/(january|february|march|april|may|june|july|august|september|october|november|december)/):"",exmonind=monthsh.indexOf(exmon[0])>-1?monthsh.indexOf(exmon[0]):monthff.indexOf(exmon[0])>-1?monthff.indexOf(exmon[0]):"";if(stdat=Date.parse(exmonind+parseInt(1)+"/01/"+curdate.getFullYear()),etdat=stdat,dext[0].match(/(of|in)/)){var exuntdate=new Date(stdat);exuntdate.setMonth(exuntdate.getMonth()+1),exuntdate.setDate(0),dailyuntil=Date.parse(exuntdate.getMonth()+parseInt(1)+"/"+exuntdate.getDate()+"/"+exuntdate.getFullYear())}}if(text.match(/[0-9]{1,2}\s?of\s?every\s?([0-9]{1,2})?\s?month/)){var txmod=text.split("every"),numo=txmod[0].match(/[0-9]{1,2}/);if(txmod[1].match(/[0-9]{1,2}\s?month/)){var tx1mod=txmod[1].match(/[0-9]{1,2}\s?month/),num=tx1mod[0].match(/[0-9]{1,2}/);wkrpobj.monthly=1,monthdate=numo[0],monthct=num[0]}else wkrpobj.monthly=1,monthdate=numo[0]}if(text.match(/every\s?([0-9]{1,2})?\s?(day)s?/)||text.match("daily")){var txtext=text.match(/every\s?([0-9]{1,2})?\s?(day)s?/)?text.match(/every\s?([0-9]{1,2})?\s?(day)s?/):text.match("daily")?text.match("daily"):"",num=txtext[0].match(/[0-9]{1,2}/)?txtext[0].match(/[0-9]{1,2}/):"1";wkrpobj.daily=1,dailyday=num[0]}if(text.match(/((in)\s?[0-9]{1,2}\s?(day)s?)/)&&!remindervariable.isrem){var exw=text.match(/((in|after)\s?[0-9]{1,2}\s?(day)s?)/),exn=exw[0].match(/[0-9]{1,2}/),datday=new Date(stdat);datday.setDate(datday.getDate()+parseInt(exn[0])),stdat=datday,etdat=stdat}if(text.match(/((for)\s?[0-9]{1,2}\s?(day)s?)/)&&!remindervariable.isrem){var exw=text.match(/((for)\s?[0-9]{1,2}\s?(day)s?)/),exn=exw[0].match(/[0-9]{1,2}/),datday=new Date(stdat);datday.setDate(datday.getDate()+parseInt(exn[0])),etdat=datday}}if(stdat&&!etdat){if(1==wkrpobj.weekly&&aneg&&aneg[0].match(/(sun|mon|tue|wed|thu|fri|sat|sun|monday|tuesday|wednesday|thursday|friday|saturday|sunday)/)&&text.match(/every/)){for(var newtxt=text.split(/every(.+)?/),txt=newtxt[1].split(regex1),cxt="",cx=0;cx<txt.length;cx++)if(txt[cx].match(/(sun|mon|tue|wed|thu|fri|sat|sun|monday|tuesday|wednesday|thursday|friday|saturday|sunday)/)){var matwrd=txt[cx].match(/^(sun|mon|tue|wed|thu|fri|sat|sun)$/);matwrd=matwrd?matwrd:txt[cx].match(/^(monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/),cxt+=matwrd?matwrd[0]+",":""}if(cxt&&(wkrpobj.weekly=1,weekdy=cxt?cxt:weekdy,repbfrefrom=1,text.match(/for\s?[0-9]{1,2}\s?(week|month)s?/))){var tmp1=text.match(/for\s?[0-9]{1,2}\s?(week|month)s?/);if(tmp1[0].match(/(month)s?/)){var num=tmp1[0].match(/[0-9]{1,2}/),caldav=new Date;caldav.setMonth(caldav.getMonth()+parseInt(num[0])),caldav.setDate(0),weekuntil=caldav}else{var num=tmp1[0].match(/[0-9]{1,2}/),caluntdat=new Date,daycnt=caluntdat.getDay(),cnt=0==daycnt?7*(num[0]-1):7*(num[0]-1)+(7-daycnt);caluntdat.setDate(caluntdat.getDate()+parseInt(cnt)),weekuntil=caluntdat}}}etdat=stdat}if(etdat&&void 0==stdat&&(stdat=Date.parse(curdate.getMonth()+parseInt(1)+"/"+curdate.getDate()+"/"+curdate.getFullYear())),sttim&&!ettim&&(ettim=parseInt(sttim)+parseInt(36e5)),!sttim&&ettim&&(sttim=ettim-36e5),!sttim&&!ettim){if(text.match(/(in|after)\s?[0-9]{1,2}\s?(hours|hrs|minute|minutes|hour|min|mins)/)){var extxt=text.match(/(in|after)\s?[0-9]{1,2}\s?(hours|hrs|minute|minutes|hour|min|mins)/),mulfact=extxt[0].match(/(hours|hour|hr|hrs)/)?1:0,numext=extxt[0].match(/[0-9]{1,2}/);sttim=1==mulfact?parseInt(36e5*curdate.getHours())+parseInt(36e5*numext[0]):6e4*(curdate.getMinutes()+parseInt(numext[0]))+parseInt(36e5*curdate.getHours())}if(text.match(/(for)\s?(next)?\s?[0-9]{1,2}\s?(hours|hrs|minute|minutes|hour|min|mins)/))if(sttim){var extxt=text.match(/(for)\s?(next)?\s?[0-9]{1,2}\s?(hours|hrs|minute|minutes|hour|min|mins)/),mulfact=extxt[0].match(/(hours|hour|hr|hrs)/)?1:0,numext=extxt[0].match(/[0-9]{1,2}/);ettim=1==mulfact?sttim+parseInt(36e5*numext[0]):sttim+parseInt(6e4*numext[0])}else{sttim=36e5*curdate.getHours()+parseInt(6e4*curdate.getMinutes());var extxt=text.match(/(for)\s?(next)?\s?[0-9]{1,2}\s?(hours|hrs|minute|minutes|hour|min|mins)/),mulfact=extxt[0].match(/(hours|hour|hr|hrs)/)?1:0,numext=extxt[0].match(/[0-9]{1,2}/);ettim=1==mulfact?sttim+parseInt(36e5*numext[0]):sttim+parseInt(6e4*numext[0])}sttim=sttim||ettim?ettim&&!sttim?sttim-36e5:sttim:"",ettim=ettim||sttim?sttim&&!ettim?sttim+36e5:ettim:""}if(sttim&&ettim&&sttim>ettim&&stdat==etdat&&-1!=ettim){var txtcon=new Date(stdat);txtcon.setDate(txtcon.getDate()+1);var dtinmill=Date.parse(txtcon.getMonth()+parseInt(1)+"/"+txtcon.getDate()+"/"+txtcon.getFullYear());etdat=dtinmill}if(stdat&&etdat){if(stdat==etdat||wkrpobj.daily||wkrpobj.monthly||wkrpobj.weekly||wkrpobj.yearly){if(stdat!=etdat&&1==wkrpobj.weekly){var jk=0;if(text.match(/every/)){for(var newtxt=text.split(/every(.+)?/),txt=newtxt[1].split(regex1),cxt="",cx=0;cx<txt.length;cx++)if(txt[cx].match(/(sun|mon|tue|wed|thu|fri|sat|sun|monday|tuesday|wednesday|thursday|friday|saturday|sunday)/)){var matwrd=txt[cx].match(/^(sun|mon|tue|wed|thu|fri|sat|sun)$/);if(matwrd=matwrd?matwrd:txt[cx].match(/^(monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/),cxt+=matwrd?matwrd[0]+",":"",txt[cx+1]&&txt[cx+1].match(/to/)){jk=1;break}}wkrpobj.weekly=1,weekdy=cxt?cxt:weekdy,repbfrefrom=1==jk?"":1}}}else{if(text.match(/(every)\s?(first|second|third|fourth|last)\s?(saturday|sunday|monday|tuesday|wednesday|thursday|friday)/)){wkrpobj.monthly=1;var txrem=text.match(/(every)\s?(first|second|third|fourth|last)\s?(saturday|sunday|monday|tuesday|wednesday|thursday|friday)/),txext=txrem[0].split("every"),finalsplit=txext[1].split(" ");monthday=finalsplit[2],monthindx=finalsplit[1],repbfrefrom=1}if(text.match(/(every|all)\s?(weekend)s?/)&&(wkrpobj.weekly=1,weekdy="saturday sunday",repbfrefrom=1),text.match(/(every\s?day)|(daily)/)&&(wkrpobj.daily=1,dailyday=1,dailyweekday=1),text.match(/every\s?[0-9]{1,2}\s?(day)s?/)){var temst=text.match(/every\s?[0-9]{1,2}\s?(day)s?/),nu=temst[0].match(/[0-9]{1,2}/);wkrpobj.daily=1,dailyday=nu[0],dailyweekday=1}for(var newtxt=text.match("every")?text.split(/every(.+)?/):"",txt=newtxt?newtxt[1].split(regex1):"",cxt="",cx=0;cx<txt.length;cx++)if(txt[cx].match(/(sun|mon|tue|wed|thu|fri|sat|sun|monday|tuesday|wednesday|thursday|friday|saturday|sunday)/)&&!txt[cx-1].match(/(first|second|third|fourth|last)/)){var matwrd=txt[cx].match(/^(sun|mon|tue|wed|thu|fri|sat|sun)$/);matwrd=matwrd?matwrd:txt[cx].match(/^(monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/),cxt+=matwrd?matwrd[0]+",":""}cxt&&(wkrpobj.weekly=1,weekdy=cxt?cxt:weekdy,repbfrefrom=1),text.match(/every\s?(weekday)s?/)&&(wkrpobj.daily=1,dailyweekday=1)}if(stdat>etdat){var txtcon=new Date(etdat);txtcon.setFullYear(txtcon.getFullYear()+1);var dtinmill=Date.parse(txtcon.getMonth()+parseInt(1)+"/"+txtcon.getDate()+"/"+txtcon.getFullYear());etdat=dtinmill}}var repobj={};if(repobj.typ,repobj.day,repobj.idx,repobj.month,repobj.ct,repobj.until,repobj.dat,repobj.wkday,1==wkrpobj.yearly||1==wkrpobj.monthly){if(stdat==etdat&&(repobj.typ=1==wkrpobj.yearly?3:2,repobj.day=3==repobj.typ?yearday?yearday:"":monthday?monthday:"",repobj.idx=3==repobj.typ?yearindex?yearindex:"":monthindx?monthindx:"",repobj.month=3==repobj.typ?yearmonname:"",repobj.ct=2==repobj.typ&&monthct?monthct:"",repobj.until=3==repobj.typ?yearuntil?yearuntil:"":2==repobj.typ&&monthuntil?monthuntil:"",repobj.dat=3==repobj.typ?yeardate?yeardate:"":2==repobj.typ&&monthdate?monthdate:""),stdat!=etdat&&1==yeartype){var caled=new Date(stdat);repobj.typ=1==wkrpobj.yearly?3:2,repobj.day=2==repobj.typ?caled.getDate():"",repobj.idx="",repobj.month=monthsh[caled.getMonth()],repobj.ct="",repobj.until=yearuntil?yearuntil:"",repobj.dat=3==repobj.typ?caled.getDate():""}stdat!=etdat&&1==repbfrefrom&&(repobj.typ=2,repobj.day=monthday,repobj.idx=monthindx?monthindx:"",repobj.ct=2==repobj.typ&&monthct?monthct:"",repobj.until=etdat&&etdat!=stdat?etdat:"",etdat=repobj.until?stdat:etdat)}if(1==wkrpobj.weekly)if(1!=repbfrefrom){var calday=new Date(stdat);repobj.typ=1,repobj.day=weekdy?weekdy:monthcapsh[calday.getDay()],repobj.idx="",repobj.month="",repobj.ct=weekct?weekct:"",repobj.until=weekuntil?weekuntil:""}else 1==repbfrefrom&&(repobj.typ=1,repobj.day=weekdy?weekdy:"",repobj.idx="",repobj.month="",repobj.ct=weekct?weekct:"",repobj.until=etdat?stdat!=etdat?etdat:weekuntil?weekuntil:"":"",etdat=repobj.until?stdat:etdat);if(1==wkrpobj.daily&&(stdat==etdat?(repobj.typ=0,repobj.ct=dailyday?dailyday:"",repobj.idx="",repobj.month="",repobj.day="",repobj.until=dailyuntil?dailyuntil:"",repobj.wkday=dailyweekday?dailyweekday:""):1==dailyweekday&&(repobj.typ=0,repobj.ct=dailyday?dailyday:"",repobj.idx="",repobj.month="",repobj.day="",repobj.until=etdat?etdat:"",etdat=repobj.until?stdat:etdat,repobj.wkday=repobj.ct?"":1)),dayonce&&!monthonce&&(repobj.typ=0,repobj.ct=dayonce,repobj.idx="",repobj.month="",repobj.day="",repobj.until=stdat!=etdat?etdat:"",etdat=repobj.until?stdat:etdat),monthonce&&!dayonce&&stdat==etdat){var exday=new Date(stdat),bcopy=new Date(stdat);bcopy.setDate(bcopy.getDate()-parseInt(7));var fcopy=new Date(stdat);if(fcopy.setDate(fcopy.getDate()+parseInt(7)),exday.getMonth()!=bcopy.getMonth())repobj.idx="first";else if(exday.getMonth()!=fcopy.getMonth())repobj.idx="last";else{for(var i=1;exday.getMonth()==bcopy.getMonth();)bcopy.setDate(exday.getDate()-7*i),i++;repobj.idx=3==i?"second":4==i?"third":5==i?"fourth":""}repobj.typ=2,repobj.month="",repobj.day=monthcap[exday.getDay()],repobj.ct=monthonce}if(remindervariable.isrem=remindervariable.remt?""==remindervariable.isrem?isrem:remindervariable.isrem:"",""==remindervariable.isrem)var remindervariable={};for(var ci=0;ci<resourcetype.length;ci++)if(text.match(resourcetype[ci])){{text.match(resourcetype[ci])}getresourcedetails(ci,text.match(resourcetype[ci]))}var titlesplit=title_ext;if(titlesplit.match(/\[(\s+)?\]/g)||titlesplit.match(/\((\s+)?\)/g)){var keyfrtitext=titlesplit.match(titlesplit.match(/\[(\s+)?\]/)?/\[(\s+)?\]/:/\((\s+)?\)/g);if(keyfrtitext&&0!=op){var subs=titlesplit.substring(0,titlesplit.indexOf(keyfrtitext[0])-1);subs=subs.trim();var indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]||","==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1]&&(indar[indar.length-1].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on|tomorrow|today|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)||indar[indar.length-1].match(/@/)))if(indar[indar.length-1].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on)\b/)||indar[indar.length-1].match(/@/)||null==indar[indar.length-1].match(/\b(today|tomorrow|saturday|sunday|monday|tuesday|wednesday|thursday|friday|sat|sun|mon|tue|wed|thu|fri)\b/)||!indar[indar.length-2]||null==indar[indar.length-2].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on)\b/)&&null==indar[indar.length-2].match(/@/)){var subtx=titlesplit.substring(subs.lastIndexOf(indar[indar.length-1]),titlesplit.indexOf(keyfrtitext[0])+keyfrtitext[0].length);titlesplit=titlesplit.replace(subtx,"")}else{subs=subs.replace(indar[indar.length-1],"");var subtx=titlesplit.substring(subs.lastIndexOf(indar[indar.length-2]),titlesplit.indexOf(keyfrtitext[0])+keyfrtitext[0].length);titlesplit=titlesplit.replace(subtx,"")}else titlesplit=titlesplit.replace(keyfrtitext[0],"")}if(keyfrtitext&&0==op){var subs=titlesplit.substring(0,titlesplit.indexOf(keyfrtitext[0])-1);subs=subs.trim();var indar=subs.split(regex1);if(indar.length=""==indar[indar.length-1]||","==indar[indar.length-1]?indar.length-1:indar.length,indar[indar.length-1]&&(indar[indar.length-1].match(/\b(from|(begin)s?|(start)s?|between|(open)s?|starting|commence|at|on)\b/)||indar[indar.length-1].match(/@/))){var subtx=titlesplit.substring(subs.lastIndexOf(indar[indar.length-1]),titlesplit.indexOf(keyfrtitext[0])+keyfrtitext[0].length);titlesplit=titlesplit.replace(subtx,"")}else titlesplit=titlesplit.replace(keyfrtitext[0],"")}}var altstd,altetd,alst,alet,dattopass=new Date(stdat);altstd=dattopass.getFullYear()+""+(dattopass.getMonth()+parseInt(1)<10?"0"+(dattopass.getMonth()+parseInt(1)):dattopass.getMonth()+parseInt(1))+(dattopass.getDate()<10?"0"+dattopass.getDate():dattopass.getDate()),rst=dattopass.getFullYear()+""+(dattopass.getMonth()+parseInt(1)<10?"0"+(dattopass.getMonth()+parseInt(1)):dattopass.getMonth()+parseInt(1))+(dattopass.getDate()<10?"0"+dattopass.getDate():dattopass.getDate());var dattopass1=new Date(etdat);altetd=dattopass1.getFullYear()+""+(dattopass1.getMonth()+parseInt(1)<10?"0"+(dattopass1.getMonth()+parseInt(1)):dattopass1.getMonth()+parseInt(1))+(dattopass1.getDate()<10?"0"+dattopass1.getDate():dattopass1.getDate()),rst=dattopass1.getFullYear()+""+(dattopass1.getMonth()+parseInt(1)<10?"0"+(dattopass1.getMonth()+parseInt(1)):dattopass1.getMonth()+parseInt(1))+(dattopass1.getDate()<10?"0"+dattopass1.getDate():dattopass1.getDate());var hours,mins,secs;hours=sttim?parseInt(sttim/36e5):"",mins=sttim?parseInt(sttim/6e4)%60:"";alst=(hours.toString().match(/^[0-9]{1}$/)?"0"+hours:hours)+""+(mins.toString().match(/^[0-9]{1}$/)?"0"+mins:mins),hours=ettim?parseInt(ettim/36e5):"",mins=ettim?parseInt(ettim/6e4)%60:"",secs=ettim?parseInt(ettim/1e3)%60:"";if(alet=(hours.toString().match(/^[0-9]{1}$/)?"0"+hours:hours)+""+(mins.toString().match(/^[0-9]{1}$/)?"0"+mins:mins),0==repobj.typ){if(eventbj2.RFRQ=repobj.typ,eventbj2.ROPT=""!=repobj.ct?"0":"1",eventbj2.RIVL=""==repobj.ct?"1":repobj.ct,eventbj2.RDAY=[],eventbj2.RTOWK="",eventbj2.RDATE="",eventbj2.RMON="",eventbj2.RCNT="",repobj.until){var utd=new Date(repobj.until);utd=utd.getFullYear()+""+(utd.getMonth()+parseInt(1)<10?"0"+(utd.getMonth()+parseInt(1)):utd.getMonth()+parseInt(1))+(utd.getDate()<10?"0"+utd.getDate():utd.getDate()),eventbj2.RUTL=utd}else eventbj2.RUTL="";eventbj2.RST=rst}if(1==repobj.typ){if(eventbj2.RFRQ=repobj.typ,eventbj2.ROPT=0,eventbj2.RIVL=""!=repobj.ct?repobj.ct:"1",repobj.day){eventbj2.RDAY=[];for(var ext=repobj.day.replace(/,/g," "),eext=ext.split(regex1),ty=0;ty<eext.length;ty++)(monthcap.indexOf(eext[ty])>-1||monthcapsh.indexOf(eext[ty])>-1)&&eventbj2.RDAY.push(monthcap.indexOf(eext[ty])>-1?monthcap.indexOf(eext[ty])+parseInt(1):monthcapsh.indexOf(eext[ty])+parseInt(1))}else eventbj2.RDAY=[];if(eventbj2.RTOWK="",eventbj2.RDATE="",eventbj2.RMON="",eventbj2.RCNT="",repobj.until){var utd=new Date(repobj.until);utd=utd.getFullYear()+""+(utd.getMonth()+parseInt(1)<10?"0"+(utd.getMonth()+parseInt(1)):utd.getMonth()+parseInt(1))+(utd.getDate()<10?"0"+utd.getDate():utd.getDate()),eventbj2.RUTL=utd}else eventbj2.RUTL="";eventbj2.RST=rst}if(2==repobj.typ){if(eventbj2.RFRQ=repobj.typ,eventbj2.ROPT=repobj.idx?"1":"0",eventbj2.RIVL=""!=repobj.ct?repobj.ct:"1",eventbj2.RDATE=repobj.dat?repobj.dat:"",eventbj2.RTOWK=repobj.idx&&rtwk.indexOf(repobj.idx)>-1?rtwk.indexOf(repobj.idx):"",repobj.day){eventbj2.RDAY=[];for(var ext=repobj.day.replace(/,/g," "),eext=ext.split(regex1),ty=0;ty<eext.length;ty++)(monthcap.indexOf(eext[ty])>-1||monthcapsh.indexOf(eext[ty])>-1)&&eventbj2.RDAY.push(monthcap.indexOf(eext[ty])>-1?monthcap.indexOf(eext[ty])+parseInt(1):monthcapsh.indexOf(eext[ty])+parseInt(1))}else eventbj2.RDAY=[];if(eventbj2.RMON="",eventbj2.RCNT="",repobj.until){var utd=new Date(repobj.until);utd=utd.getFullYear()+""+(utd.getMonth()+parseInt(1)<10?"0"+(utd.getMonth()+parseInt(1)):utd.getMonth()+parseInt(1))+(utd.getDate()<10?"0"+utd.getDate():utd.getDate()),eventbj2.RUTL=utd}else eventbj2.RUTL="";eventbj2.RST=rst}var remobj={};1==remindervariable.isrem&&(remobj.ACTYPE="1",remobj.REMTIME=remindervariable.remt.toString(),remobj.REMTYPE=remindervariable.remty.toString());var alarmar=[];alarmar.push(remobj);var orgtxt=input.split(regex1),contxt=input.toLowerCase(),contxt1=contxt.split(regex1),outtxt=titlesplit.split(regex1),txt="";for(var d in outtxt)for(var c in contxt1)if(contxt1[c]==outtxt[d]){txt=""!=txt?txt+" "+orgtxt[c]:orgtxt[c];break}return 1==orgtxt.length&&""==txt&&(txt=orgtxt[0]),titlesplit=txt?txt:title_ext,eventbj.SD=altstd,eventbj.ED=altetd,eventbj.ST=alst,eventbj.ET=alet,eventbj.REP=eventbj2,eventbj.ALARM=alarmar[0].REMTYPE?alarmar:"",eventbj.SUM=titlesplit,eventbj.DESC=input,eventbj};
"use strict";!function(){var a=zmail.Core.Namespaces,b=a.create("zmState"),c={},d={},e={TAB_SWITCH:"/apps/tabSwitched",DATA_CHANGED:"session/dataChanged"},f={zm_Container:"m",zm_link:"l",zm_task:"t",zm_notes:"n",zcal_Container:"c",zm_Contacts:"cn"},g=function(){return c},h=function(){return d},i=function(){var a={},c={},d={},e=zmsuite.getCurrentAppObjId();return c.app=b.appInfo.getDataToSave(),c.app.currApp=zmApp.currentApp,d.list=b.tabInfo.getTabData(),zmTab.currentTab!==e&&(d.selected=zmTab.currentTab),c.tab=d,a.data=c,a.type="restore",{state:a}},j=function(){b.tabInfo.init(),b.leftStateInfo.init();var a=zmAdHocSettings.getLPageType();"specific"!==a&&"restore"!==a||(b.getAndStoreSettingsValue(),"restore"===a&&zmAdHocSettings.setUiState({})),window.onbeforeunload=function(){"restore"===zmAdHocSettings.getLPageType()&&b.sendRequestToSaveState()},d={data:{app:{},tab:b.tabInfo.getTabInfo}},zmail.postJsDeffered.promise.then(function(){$.subscribe(e.DATA_CHANGED,function(){b.sendRequestToSaveState()}),$.subscribe(e.TAB_SWITCH,function(){setTimeout(function(){b.sendRequestToSaveState()},0)})}),b.registerAppHandlers("m",function(a,b){zmUtil.restoreLeftState(a,b)}),b.registerAppHandlers("stream",function(a,b){zmUtil.restoreLeftState(a,b)}),b.registerAppHandlers("t",function(a,b){zmUtil.requireTaskModule().done(function(){zmTaskRestore.restoreTaskSession(a,b)})}),b.registerAppHandlers("n",function(a,b){zmUtil.requireNotesModule().done(function(){notesRestore.restore(a,b)})})};b.rightInfo=function(a){return a}(b.rightInfo||{}),b.centerInfo=function(a){return a}(b.rightInfo||{});var k=function(){var a;if(c&&c.state&&c.state.data)switch(a=c.state.data,c.state.type){case"specific":b.setSpecificLandingPage(a);break;case"restore":b.restoreSessionFromData(a)}},l=function(a){var c,d=a.app,e=d.currApp,f=!0,g=$.Deferred();b.appHandlers[e]?(c=zmComponent.loadingMasks({maskText:"Restoring Session"}),f=!a.tab.selected,b.appHandlers[e](d,{avoidShow:f,deferred:g}),g.done(function(){c.remove(),b.tabInfo.setSavedTabInfo(a.tab)})):(zmApp.showApp("m"),1===zmInit.lPageType()?zmList.showMailListing({fId:zmail.folId.iId}):zmList.showMailListing({fId:"zm_unread"}))};b.setSpecificLandingPage=function(a){var c=a.app,d=c.currApp;b.appHandlers[d]?b.appHandlers[d](c):(zmApp.showApp("m"),1===zmInit.lPageType()?zmList.showMailListing({fId:zmail.folId.iId}):zmList.showMailListing({fId:"zm_unread"}))},b.sendRequestToSaveState=function(){var a=zmAdHocSettings.getLPageType();if("none"!==a&&"undefined"!=typeof zmApp&&"undefined"!=typeof zmTab){var c=zmAdHocSettings.getUiState();_.isEqual(c,b.getCurrentStateSnapshot())||zmAdHocSettings.setUiState(b.getCurrentStateSnapshot())}},b.getAndStoreSettingsValue=function(){c=zmAdHocSettings.getUiState()};var m=function(a,b){this.tabInfo.updateTabState(a,b),this.sendRequestToSaveState()},n=function(a,c){b.appHandlers[a]=c};b.getStoredSessionState=g,b.getCurrentStateObject=h,b.getCurrentStateSnapshot=i,b.setStoredLandingPageData=k,b.restoreSessionFromData=l,b.saveTabState=m,b.appHandlers={},b.registerAppHandlers=n,b.init=j,b.appsKeyMap=f}(),define([],function(a){var b=zmail.Core.Namespaces,c=a("zmAdHocSettings"),d=a("_"),e={GROUP:",",VALUE:"__"},f="--",g=b.get("zmState"),h=b.create("zmState.leftStateInfo"),i=g.appsKeyMap,j=Object.keys(i).sort(),k={},l=function(){var a=b.get("zmUtil.debugLog");"undefined"!=typeof a&&a(k)},m=function(a){var b;return b=d(k[a]).map(function(b,c){return a+e.VALUE+c})},n=function(){var a=[];return j.forEach(function(b){b=i[b],a=a.concat(m(b))}),a.join(e.GROUP)||f},o=function(){var a=n(),b=c.getLeftLayerState();b.collapsedState=a,c.setLeftLayerState(b)},p=function(a,b){k.hasOwnProperty(a)||(k[a]={});var c=k[a];return!c.hasOwnProperty(b)&&(c[b]=!0,l(),!0)},q=function(a,b){var c,d;return!!i.hasOwnProperty(a)&&(c=i[a],d=p(c,b),d&&o(),d)},r=function(a,b){var c;if(!i.hasOwnProperty(a))return!1;c=i[a];var d=k[c];return!(!d||!d.hasOwnProperty(b))&&(delete d[b],o(),l(),!0)},s=function(a){var b,c=a.split(e.GROUP);c.forEach(function(a){b=a.split(e.VALUE),p(b[0],b[1])})},t=function(){var a=c.getLeftLayerState();delete a.expandedState,c.setLeftLayerState(a)},u=function(){var a=c.getLeftLayerState().collapsedState||f,b=c.getLeftLayerState().expandedState;b&&t(),a!==f&&s(a)},v=function(a,b){if(!i.hasOwnProperty(b))return!1;var c=i[b],d=k[c];return!!d&&d.hasOwnProperty(a)},w={checkForPresence:function(a,b){return v(a,b)},getKeyFromAppId:function(a){for(var b in i)if(i.hasOwnProperty(b)&&a===i[b])return b}};return h.updateAdhocValues=o,h.getDataToStore=n,h.printData=l,h.addEntry=q,h.removeEntry=r,h.appsKeyMap=i,h.utils=d.extend({},w),h.init=u,h}),define([],function(a){var b=zmail.Core.Namespaces,c=b.get("zmState"),d=b.create("zmState.appInfo"),e=c.appsKeyMap,f={},g=function(){var c,d,g=a("zmsuite"),h=b.get("zmApp"),i={};return"object"===("undefined"==typeof h?"undefined":babelHelpers["typeof"](h))&&(d=g.getCurrentAppObjId(),e.hasOwnProperty(d)&&(c=e[d]),i.selInfo={id:g.getAppLeft().selId||"",layerId:g.getAppLeft().selLayerId||""},i.data=c&&f[c]||{}),i},h=function(a,b,c){var d;return!!e.hasOwnProperty(a)&&(d=e[a],!(f.hasOwnProperty(d)&&!c)&&(f[d]=b,!0))};return d.getDataToSave=g,d.addNew=h,d}),define([],function(a){var b=zmail.Core.Namespaces,c=b.get("zmState"),d=b.create("zmState.tabInfo"),e={},f={},g={},h={m:function(b){a("zmRestore").restoreTabs(b)},stream:function(b,c){a("zmRestore").restoreTabs(b,c)},cmp:function(b,c){a("zmUtil").cmpRestore(b,c)},t:function(b){a("zmUtil").requireTaskModule("taskPreview").done(function(){a("zmTaskRestore").restoreTab(b)})},n:function(b){a("zmUtil").requireNotesModule().done(function(){a("notesRestore").restoreTab(b)})},groups:function(b){a("zmUtil").loadGroupManagement().then(function(){a("zmStreamsApp").GroupManageApp.init({groupManage:!0,isRestore:!0})})}},i=function(){return f.list},j=function(){return f},k=function(a,b){var c,d=i();for(c=0;c<d.length;c+=1)if(d[c].appId===a)return d[c]=b,void(d[c].appId=b.appId||a);b.appId=a,d.push(b)},l=function(a){var b,c=i();for(b=0;b<c.length;b+=1)if(c[b].appId===a)return void Array.prototype.splice.call(c,b,1)},m=function(a){if(g[a])return g[a](a)},n=function(a,b){for(var c=0;c<b.length;c++)if(b[c].appId===a)return c;return-1},o=function(){for(var a=i(),b=[],d=0;d<zmTab.tabArr.length;d++){var e=n(zmTab.tabArr[d].appId,a);e>=0&&b.push(a[e])}f.list=b,c.sendRequestToSaveState()},p=function(){f={list:[]},$.subscribe("/apps/tabSwitching",function(a,b,c){b!==c&&d.callIfStillPending(c)}),$.subscribe("mailsuite/appClosed",function(a,b){var d=b.appID;l(d),c.sendRequestToSaveState()})},q=function(a,b){h[a.app]&&h[a.app](a,b)},r=function(b){var c=a("zmUtil");"function"==typeof c.modifyComposeObj&&c.modifyComposeObj(b)},s=function(b){var c,d,f,g,h,i=a("zmsuite"),j=b.selected,l=!1;for(h=0;h<b.list.length;h+=1)j===b.list[h].appId&&(l=!0),"compose_tab"===b.list[h].category&&r(b.list[h]),d=b.list[h].appObj,c=d,i.isWorkspaceAvailable(c.appId)||(i.createWorkspace(c),k(b.list[h].appId,b.list[h]),e[b.list[h].appId]=b.list[h]),l&&!f&&(f=b.list[h].appId,g=b.list[h]);j&&f&&e[f]&&(e[f]="",i.showWorkSpace(f),q(g,f))},t=function(a){if(e[a]){var b=e[a];return e[a]="",q(b),!0}return!1},u=function(a,b){var c,d,e=zmTab.tabArr,f=e.length,g=i(),h=-1;if(c=_.map(g,function(a){return a.appId}),c.indexOf(a)!==-1)return void k(a,b);for(d=0;d<f;d++)if(e[d].appId===a){h=d;break}var j,l=h-1,m=h+1;if(b.appId=a,0===h)e.splice(0,b);else if(h===length-1)e.splice(length-1,b);else for(;l>-1||m<length;){if((j=c.indexOf(zmTab.tabArr[l].appId))!==-1){e.splice(j+1,b);break}if((j=c.indexOf(zmTab.tabArr[m].appId))!==-1){e.splice(j-1,b);break}l--,m++}};return d.reorder=o,d.getTabDataInfo=m,d.getTabInfo=j,d.getTabData=i,d.setSavedTabInfo=s,d.syncAndInsert=u,d.updateTabState=k,d.callIfStillPending=t,d.init=p,d});
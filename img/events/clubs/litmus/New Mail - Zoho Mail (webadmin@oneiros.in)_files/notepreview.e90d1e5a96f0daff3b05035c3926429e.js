"use strict";define([],function(){var a=zmail.Core.Namespaces,b=a.get("zmail.DataLayer"),c=b.DSModel;zNote.Models=zNote.Models||{};var d=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"initialize",value:function(){zNote.eventBus.on("editNote",this.customEvent,this),this.triggerUpdateModelSubscription=this.triggerUpdateModel.bind(this),$.subscribe("zmstreamsapp/addLabel",this.triggerUpdateModelSubscription),this.debounceAddNote=_.debounce(this.addNote,1e3),this.view=0}},{key:"updateViewCount",value:function(){this.view+=1}},{key:"getViewCount",value:function(){return this.view}},{key:"customEvent",value:function(a,b){var c,d,e,f,g,h,i,j=this;if(b.id===this.get("notes").id)if("title"===b.cattribute)c=j.get("cntnt"),c.title=znBox.revSpCharRep(b.p.title),j.set("cntnt",c),j.trigger("change");else if("category"===b.cattribute)c=j.get("notes"),c.catid=b.p.catId,j.set("notes",c),j.trigger("change");else if("color"===b.cattribute)c=j.get("notes"),c.color=b.p.color,j.set("notes",c),j.trigger("change");else if("desc"===b.cattribute)c=j.get("notes"),c.notecont=b.p.desc,c.modified=b.p.updatedTime,j.set("notes",c),j.trigger("change");else if("archive"===b.cattribute)c=j.get("notes"),c.archived=b.p.archived,j.set("notes",c),j.trigger("change");else if("starred"===b.cattribute)c=j.get("myact"),c.starred=b.p.starred,j.set("myact",c),j.trigger("change");else if("addLabel"===b.cattribute)c=j.get("myact"),c.label=b.p,j.set("myact",c),j.trigger("change");else if("removeLabel"===b.cattribute)c=j.get("myact"),c.label=b.p,j.set("myact",c),j.trigger("change");else if("removeAttachment"===b.cattribute)d=j.get("attach").slice(),$.each(d,function(a,c){if(c.id===b.p.attachId)return d.splice(a,1),!1}),j.set("attach",d),j.trigger("change");else if("addAttachment"===b.cattribute){i=[],f=j.get("attach")?j.get("attach").slice():[];var k;_.each(b.p.attachments,function(a){k=_.keys(a)[0],g=a[k],e={id:g.Id,size:g.fs,name:g.fn,ft:g.ft,part:g.p},i.push(e)}),h=f.concat(i),j.set("attach",h),j.trigger("change")}}},{key:"triggerUpdateModel",value:function(a,b){var c,d={};b.id&&b.id.indexOf("#")!==-1?(d.id=b.id.slice(b.id.indexOf("#")+1,b.id.length),d.id===this.get("notes").id&&(void 0!==b.starred?(d.starred=b.starred,c={id:b.id,p:d},zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"starred",p:d})):b.isAddLabel===!0?(c=b.label,zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"addLabel",p:c})):b.isAddLabel===!1&&(c=b.label,zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"removeLabel",p:c})))):b.entityId===this.get("id")&&zNote.eventBus.trigger("editNote",self,{id:b.entityId,cattribute:"commentCount",p:{commentCount:b.total}})}},{key:"deleteNote",value:function(){var a=this,b={entityId:this.get("notes").id,mode:"delNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"delEntity",entityType:zNote.CONSTANTS.entityType},c=$.extend(!0,{},b);c.cat=this.get("cat"),a.destroy().then(function(){$.publish("/note/delete",[a.get("id"),a.get("namespaceId")]),$.publish("note/updateCount",b)})}},{key:"saveTitle",value:function(a){var b,c,d=this;if(a=a||"",this.get("notes").id)this.get("notes").title!==a&&(0===a.trim().length&&(a=znBox.CONTS.defaultTitle),b={title:a,entityId:this.get("notes").id,mode:"editNTitle",groupId:this.get("gnrl").group.id},this.save({title:a},{param:{mode:"editNTitle",actionType:"changeEntity"}}).then(function(a){zNote.eventBus.trigger("editNote",d,{id:b.entityId,cattribute:"title",p:b})}));else{if(0===a.trim().length)return;b={title:a,color:0},c=this.get("cntnt"),c.title=a,this.set("cntnt",c),this.debounceAddNote(b)}}},{key:"changeBook",value:function(a){var b=this,c=this.get("notes").catid,d={catId:a,entityId:this.get("notes").id,mode:"moveNote",groupId:this.get("gnrl").group.id},e=$.extend(!0,{},d);if(e.pCatId=c,this.get("notes").id)this.save({catId:a},{param:{mode:"moveNote",actionType:"changeEntity"}}).then(function(){zNote.eventBus.trigger("editNote",b,{id:d.entityId,cattribute:"category",p:d}),$.publish("note/updateCount",e)});else{var f=this.get("notes");f.catid=a,this.set("notes",f),this.trigger("change")}}},{key:"changeGroup",value:function(a){var b=this,c={toNamespace:a,entityId:this.get("notes").id,mode:"changeGroup",groupId:this.get("gnrl").group.id},d=$.extend(!0,{},c);if(d.cat=b.get("notes").catid,this.get("notes").id)this.save({toNamespace:a},{param:{mode:"changeGroup",actionType:"addEntity",deleteOriginal:!0,commentsNeeded:!0}}).then(function(a){var e=a.opts,f=e.resp,g=zNote.getNoteDataInListFormat(f[0].data);_zm.succErrMsg("s",zNote.notei18n.msg.noteMoved+" "+znBox.getGroupName(d.toNamespace)),b.set(f[0].data),b.get("showstream")===!1&&b.set("showstream",!0),$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("/note/groupChange",[f[0].data]),$.publish("note/deleteNote",[{pid:c.entityId,gid:c.groupId}]),$.publish("note/updateCount",d),$.publish("/note/add",[g]),$.publish("note/updateCount",[{mode:"addNote",cat:g.cat,namespaceId:g.namespaceId}])});else{var e=this.get("gnrl");e.group.id=a,this.set("gnrl",e);var f=znBox.getGeneralCatId(a),g=this.get("notes");g.catid=f,this.set("notes",g),this.trigger("change")}}},{key:"archiveOrUnarchiveNote",value:function(a){var b=this,c=this.get("notes").catid,d=a.archived?"archive":"unarchive",e={mode:d,entityId:this.get("notes").id,groupId:this.get("gnrl").group.id},f=$.extend(!0,{},e);f.pCatId=c,f.archived="archive"===d,this.save({},{param:{mode:d}}).then(function(){var a="archive"===d?zNote.notei18n.msg.noteArchived:zNote.notei18n.msg.noteUnarchived;_zm.succErrMsg("s",a),zNote.eventBus.trigger("editNote",b,{id:e.entityId,cattribute:"archive",p:f})})}},{key:"sendAsMail",value:function(){var a={},b=[],c=this;if(a.SUBJECT=this.get("notes").title,a.CONTENT=this.get("notes").notecont&&this.get("notes").notecont.replace(/\n/g,"<br/>")||this.get("cntnt").summary&&this.get("cntnt").summary.replace(/\n/g,"<br/>"),this.get("attach")&&this.get("attach").length){for(var d=this.get("attach").length,e=0;e<d;e++){var f=this.get("attach")[e];if(!f.inline){var g={gId:this.get("gnrl").group.id,Id:f.id,e:c.get("notes").id,et:2,fn:f.name,fs:f.size,p:f.part,ft:f.ft};b.push(g)}}a.NEWATT=b}zmUtil.compose(a,"",{entityType:"note"})}},{key:"saveAttachment",value:function(a){var b,c=this,d=[],e=[],f={mode:"addAttach",entityId:this.get("notes").id,groupId:this.get("gnrl").group.id,attachname:d,attachstore:e,attType:"attach"};if(a.tempLocation){for(var g=0;g<a.tempLocation.length;g++)"pending"!==a.tempLocation[g].virusFree&&a.tempLocation[g].virusFree!==!1&&(d.push(a.tempLocation[g].fP),e.push(a.tempLocation[g].sN));f.attachname=d,f.attachstore=e}a.myAttachment&&(b=JSON.stringify(a.myAttachment),f.attEntObj=b),(f.attachname.length||a.myAttachment.length)&&this.save({attEntObj:a.myAttachment,attachname:d,attachstore:e},{param:{mode:"addAttach",actionType:"addEntity"}}).then(function(a){var b=a.opts,d=b.resp;zNote.eventBus.trigger("editNote",c,{id:f.entityId,cattribute:"addAttachment",p:d[0]})})}},{key:"addAttachment",value:function(a){zNote.eventBus.trigger("editNote",self,{id:this.get("notes").id,cattribute:"addAttachment",p:a[0]})}},{key:"delAtt",value:function(a,b){$.publish("attachment/closeSlideshow");var c=this,d={mode:"delAttach",entityId:this.get("notes").id,groupId:this.get("gnrl").group.id,attachId:b};this.save({attachId:b},{param:{mode:"delAttach",actionType:"delEntity"}}).then(function(a){zNote.eventBus.trigger("editNote",c,{id:d.entityId,cattribute:"removeAttachment",p:d})})}},{key:"hideStream",value:function(){this.set("showstream",!1)}},{key:"addNote",value:function(a){var b=this,c={desc:a.desc||this.get("notes").notecont,mode:"addNote",groupId:this.get("gnrl").group.id,catId:this.get("notes").catid,title:a.title||this.get("cntnt").title,color:a.color||this.get("notes").color};return this.triggerAction("add",{param:c}).then(function(a){var c=a.opts,d=c.resp;b.set(d[0].data),b.set("showstream",!0);var e=zNote.getNoteDataInListFormat(d[0].data);$.publish("/note/add",[e]),$.publish("/note/addNote",[d[0].data]),e.mode="addNote",$.publish("note/updateCount",[e])})}},{key:"saveDescription",value:function(a){var b,c,d=this;if(this.get("notes").id){if(this.get("notes").notecont!==a){if(0===a.trim().length)return void _zm.succErrMsg("e",zNote.notei18n.descempty);b={desc:a,entityId:this.get("notes").id,mode:"editNContent",groupId:this.get("gnrl").group.id},znBox.isRichTextOpen()&&(b.isRichText="true"),this.save({},{setSessionId:!0,param:{mode:"editNContent",actionType:"changeEntity",isRichText:"true",desc:a}}).then(function(a){var c=a.opts,e=c.resp;b.updatedTime=e[0].updatedTime,zNote.eventBus.trigger("editNote",d,{id:b.entityId,cattribute:"desc",p:b})})}}else{if(0===a.trim().length)return;b={desc:a,color:0},c=this.get("notes"),c.notecont=a,this.set("notes",c),this.debounceAddNote(b)}}},{key:"addTag",value:function(a){var b=this,c={tagId:a,entityId:this.get("notes").id,mode:"setTag",groupId:this.get("gnrl").group.id};this.triggerAction("updateTag",{param:{tagId:a,mode:"setTag",actionType:"addLabel"}}).then(function(d){var e=b.get("myact").label.slice();e.push(a),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"addLabel",p:e}),$.publish("note/editNote",[{mode:"addLabel",gid:b.get("gnrl").group.id,pid:c.entityId,labelId:a}]),zmail.isOfflineEnabled&&b.triggerAction("updateNote",{attrs:zNote.getNoteDataInListFormat(b.toJSON()),adapterId:"indexDB"})})}},{key:"removeTag",value:function(a){var b=this,c={tagId:a,entityId:this.get("notes").id,mode:"removeTag",groupId:this.get("gnrl").group.id};this.triggerAction("updateTag",{param:{tagId:a,mode:"removeTag",actionType:"addLabel"}}).then(function(d){var e=b.get("myact").label.slice();e.splice(b.get("myact").label.indexOf(a),1),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"removeLabel",p:e}),$.publish("note/editNote",[{mode:"removeLabel",pid:c.entityId,gid:b.get("gnrl").group.id,labelId:a}]),zmail.isOfflineEnabled&&b.triggerAction("updateNote",{attrs:zNote.getNoteDataInListFormat(b.toJSON()),adapterId:"indexDB"})})}},{key:"saveColor",value:function(a){var b=this;if(this.get("notes").id){var c={color:a,entityId:this.get("notes").id,mode:"editNColor",groupId:this.get("gnrl").group.id};this.save({color:a},{param:{mode:"editNColor",actionType:"changeEntity"}}).then(function(a){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"color",p:c})})}else{var d=this.get("notes");d.color=a,this.set("notes",d),this.trigger("change")}}},{key:"stopSubscriptions",value:function(){this.view-=1,0===this.view&&(zNote.eventBus.off("editNote",this.customEvent,this),$.unsubscribe("zmstreamsapp/addLabel",this.triggerUpdateModelSubscription))}},{key:"saveFavourite",value:function(){var a=this,b=!this.get("myact").starred,c=b?"addLabel":"deleteLabel",d={starred:b,entityId:this.get("notes").id,mode:"editNFav",groupId:this.get("gnrl").group.id};this.save({starred:b},{param:{mode:"editNFav",actionType:c}}).then(function(){zNote.eventBus.trigger("editNote",a,{id:d.entityId,cattribute:"starred",p:d}),$.publish("note/editNote",[{mode:"changeFavourite",pid:d.entityId,gid:a.get("gnrl").group.id,starred:b}])})}}]),b}(c);return zNote.Models.previewNote=d,d}),define([],function(){zNote.Collections=zNote.Collections||{};var a=zmail.Core.Namespaces,b=a.get("zmail.DataLayer"),c=b.DSCollection,d=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"getBaseModelClass",value:function(){return zNote.Models.previewNote}}]),b}(c);return zNote.Collections.previewNote=d,d}),function(){zNote.Views=zNote.Views||{},zNote.Views.NotePreview=function(k){function p(a,b){babelHelpers.classCallCheck(this,p);var c=babelHelpers.possibleConstructorReturn(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,a,b));return c.setEditorFocus=c.setEditorFocus.bind(c),c}return babelHelpers.inherits(p,k),babelHelpers.createClass(p,[{key:"componentDidMount",value:function(){this.props.note.on("change",function(){this.props.note.hasChanged("showstream")&&this.props.note.get("showstream")===!0&&this.props.removeStreamsBar(),this.forceUpdate()}.bind(this)),this.triggerRemoveNoteSubscription=this.triggerRemoveNote.bind(this),this.props.streamList!==!0&&(!this.props.options||this.props.options&&this.props.options.print!==!0)&&this.refs.attachment.setAttachmentConfig(),this.props.note.updateViewCount()}},{key:"triggerRemoveNote",value:function(a,b){this.props.note.get("notes").id===b&&this.removeNote()}},{key:"componentWillUnmount",value:function(){this.refs.editorBar&&ReactDOM.unmountComponentAtNode(this.refs.editorBar),this.props.note.stopSubscriptions(),0===this.props.note.getViewCount()&&zNote.checkAndRemoveFromDS(this.props.note,"previewNote")}},{key:"removeNote",value:function(){var a={id:this.props.note.get("notes").id,namespaceId:this.props.note.get("gnrl").group.id};ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(this.refs.notebox)).parent()[0]),zNote.eventBus.trigger("removeMask",[a])}},{key:"stopEvents",value:function(a){zmUtil.stopEvents(a,!0)}},{key:"setEditorFocus",value:function(){znBox.isRichTextOpen()&&this.refs.desc.editor.squireInstance.focus()}},{key:"render",value:function(){var k=String("zn_note zn_popNote "+zNote.CONSTANTS.COLORCODE[this.props.note.get("notes").color]);return this.props.streamList?React.createElement("div",{className:k,ref:"notebox",id:this.props.note.get("notes").id},React.createElement("div",null,React.createElement(m,{note:this.props.note,streamList:this.props.streamList}),React.createElement(l,{note:this.props.note,ref:"desc",streamList:this.props.streamList}))):React.createElement("div",{className:k,ref:"notebox",id:this.props.note.get("notes").id},React.createElement(a,{note:this.props.note}),React.createElement(i,{note:this.props.note,showStreamsBar:this.props.showStreamsBar}),React.createElement(b,{note:this.props.note,options:this.props.options,readMode:this.props.readMode,removeNotePreview:this.props.removeNotePreview}),React.createElement("div",null,React.createElement(m,{note:this.props.note,options:this.props.options,setEditorFocus:this.setEditorFocus,ref:"title",parent:this}),React.createElement(l,{note:this.props.note,readMode:this.props.readMode,parent:this,options:this.props.options,ref:"desc"})),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt",ref:"iconBar"},React.createElement("ul",null,React.createElement(zNote.Views.NotePreview.FavouritePreview,{note:this.props.note,readMode:this.props.readMode,options:this.props.options}),React.createElement(h,{note:this.props.note,readMode:this.props.readMode,parent:this}),React.createElement(e,{note:this.props.note,options:this.props.options,readMode:this.props.readMode,ref:"attachment",parent:this}),React.createElement(c,{note:this.props.note,parent:this,readMode:this.props.readMode}),React.createElement(f,{note:this.props.note,removeNote:this.removeNote,readMode:this.props.readMode}),React.createElement(g,{note:this.props.note,options:this.props.options,readMode:this.props.readMode}),React.createElement(n,{note:this.props.note,options:this.props.options,readMode:this.props.readMode})),React.createElement("span",{ref:"editorBar"})),React.createElement("div",{className:"SC_frt"},React.createElement("ul",null,React.createElement(d,{note:this.props.note,removeNote:this.removeNote}))))),React.createElement(j,{note:this.props.note,readMode:this.props.readMode,removeNote:this.removeNote,options:this.props.options}),function(a){if(a.props.note.get("attach"))return React.createElement(o,{ref:"attDiv",note:a.props.note,options:a.props.options})}(this))}}]),p}(React.Component),zNote.Views.NotePreview.FavouritePreview=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetFavourite=d.handleSetFavourite.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})}},{key:"handleSetFavourite",value:function(){this.props.note.saveFavourite()}},{key:"render",value:function(){var a=this.props.note.get("myact").starred?"SC_fav":"";return!this.props.header||this.props.readMode?null:this.props.header?(a=this.props.note.get("myact").starred?"msi-fav SC_fav":"msi-fav",React.createElement("i",{className:a,ref:"star",onClick:this.handleSetFavourite})):React.createElement("li",{ref:"star",onClick:this.handleSetFavourite,className:a},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-fav"}))))}}]),b}(React.Component),zNote.Views.NotePreview.NoteCreatorPreview=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this;zmail.ContactBook.get({zuid:this.props.note.get("gnrl").by,type:"org"}).done(function(b){var c=b[0];c&&c.attrs&&c.attrs.fn&&($(ReactDOM.findDOMNode(a.refs.creator)).prepend(c.avatar()),$(ReactDOM.findDOMNode(a.refs.creator)).find(".zm_susr").text(c.attrs.fn),zmComponent.tooltip({elm:$(a.refs.creator).find(".SC_avtr")[0],text:c.attrs.fn,arrow:"top"}))})}},{key:"render",value:function(){return this.props.header?React.createElement("div",{ref:"creator"},React.createElement("div",{className:"SCS_postTitle"},React.createElement("strong",{className:"zm_susr"})," ",zNote.notei18n.preview.createdNote," ",znBox.getGroupName(this.props.note.get("gnrl").group.id))):React.createElement("span",{ref:"creator"})}}]),b}(React.Component);var a=function(a){function b(){babelHelpers.classCallCheck(this,b);var a=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.timer=a.timer.bind(a),a}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){if(this.props.extraOptions&&this.props.extraOptions.stickyNote){var a=setInterval(this.timer,5e3);this.setState({intervalId:a})}}},{key:"componentWillUnmount",value:function(){this.props.extraOptions&&this.props.extraOptions.stickyNote&&clearInterval(this.state.intervalId)}},{key:"timer",value:function(){this.forceUpdate()}},{key:"render",value:function(){if(!_zm._isPrivilegedUser())return null;var a=void 0;return a=zmComponent.dateTimeUtil.getRelativeTimeInNoteFormat(this.props.note.get("notes").modified,"mm dd at hr:min"),React.createElement("div",{className:"znUpdateTxt"},React.createElement("span",null,"Edited ",a))}}]),b}(React.Component),b=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c)),e=zNote.isStickyNote(d.props.note.toJSON());return d.state={sticky:e},d.handleMakeSticky=d.handleMakeSticky.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){this.showToolTips()}},{key:"componentDidUpdate",value:function(){this.showToolTips()}},{key:"showToolTips",value:function(){this.state.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"})}},{key:"stickyOrUnSticky",value:function(){var a=this;this.state.sticky===!1?(zNote.addAsStickyNote(zNote.getNoteDataInListFormat(this.props.note.toJSON())),setTimeout(function(){var b=zNote.stickyNoteCollectionView.getTopLeft(a.props.note.get("notes").id);$.publish("zm/closeAllOpenDialog",b)}),this.setState({sticky:!0})):(this.setState({sticky:!1}),$.publish("/note/closeStickyNote",[a.props.note.get("notes").id,a.props.note.get("gnrl").group.id]))}},{key:"handleMakeSticky",value:function(){var a=this;a.props.note.get("notes").id?a.stickyOrUnSticky():a.props.note.addNote({}).done(function(){a.stickyOrUnSticky()})}},{key:"render",value:function(){var a=this.state.sticky?"SC_mkStky active":"SC_mkStky",b=this.state.sticky?"msi-stiPNotes":"msi-stiNotes";return this.props.readMode||this.props.options&&this.props.options.previewCard?null:React.createElement("div",{className:a,ref:"stickyNote",onClick:this.handleMakeSticky},React.createElement("i",{className:b}))}}]),b}(React.Component),c=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleInsertImg=d.handleInsertImg.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.insertImgIcon,text:zNote.notei18n.tooltips.insertImg,arrow:"top"})}},{key:"handleInsertImg",value:function(){var a,b=this;a=this.props.note.get("notes").id?{componentId:"notes",attachFrom:["insertImage"],insertImage:{type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:zmail.conPath+"/NotesAction.do?mode=addAttach",requireParamToUpload:{groupId:b.props.note.get("gnrl").group.id,mode:"addAttach",entityId:b.props.note.get("notes").id,actionType:"addEntity",streamsView:"Notes",entityType:2,attType:"inline"},onUpload:function(a){b.props.parent.refs.desc.setImage(a[1])}}}:{componentId:"notes",attachFrom:["insertImage"],insertImage:{type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:"/zm/attach.do?mode=temp",requireParamToUpload:{type:"f",accId:zmail.accId,tSize:0},onUpload:function(a){b.props.parent.refs.desc.setImage1(a)}}},this.attRefObj?(b.attRefObj.updateConfig(a),this.attRefObj.init()):zmUtil.initAttachComponent(a,function(a){b.attRefObj=a})}},{key:"render",value:function(){var a=!0;return(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.note.get("gnrl").by!==zmail.zuid)&&(a=!1),!a||this.props.readMode?null:React.createElement("li",{ref:"insertImgIcon",onClick:this.handleInsertImg},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-image"}))))}}]),b}(React.Component),d=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleViewAssociatedMail=d.handleViewAssociatedMail.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})}},{key:"handleViewAssociatedMail",value:function(){$.publish("zm/closeAllOpenDialog");var a={};this.props.note.get("notes").email.accid!==zmail.accId&&(a={actionType:"viewGroupMailEntity",entityId:this.props.note.get("notes").email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("gnrl").by,accId:this.props.note.get("notes").email.accid}),zmList.getMailData({msgId:this.props.note.get("notes").email.msgid,opentype:2,type:"lt",src:"external",eprm:a})}},{key:"render",value:function(){var a=this.props.note.get("notes").email&&!$.isEmptyObject(this.props.note.get("notes").email)?"zn_actVIcon":"zn_actVIcon SC_dyn";return React.createElement("li",{className:a,ref:"mailopen",onClick:this.handleViewAssociatedMail},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-mailopen"}))))}}]),b}(React.Component),e=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleAddAttachment=d.handleAddAttachment.bind(d),d.attObj={tempLocation:[],myAttachment:[]},d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.attachIcon,text:zNote.notei18n.tooltips.addAttach,arrow:"top"})}},{key:"saveVirusPendingAttachments",value:function(a){if(a.tempLocation.length)for(var b=a.tempLocation.slice(),c=0;c<b.length;c++)"pending"!==b[c].virusFree&&b[c].virusFree!==!1||this.attObj.tempLocation.push(b[c])}},{key:"handleUpdateVirus",value:function(a){for(var b=this,c=this.attObj.tempLocation.length,d={tempLocation:[],myAttachment:[]},e=0;e<c;e++)this.attObj.tempLocation[e].fP===a.fp&&(this.attObj.tempLocation[e].virusFree=a.value,d.tempLocation.push(this.attObj.tempLocation[e]),this.attObj.tempLocation.splice(e,1));b.props.note.saveAttachment(d)}},{key:"setAttachmentConfig",value:function(){var a,b=this;a={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(b.props.parent.refs.attDiv)),autoLaunch:!1,updateVirus:function(a){b.handleUpdateVirus(a)},onAllUploadFinish:{handler:function(a){b.saveVirusPendingAttachments(a),b.props.note.saveAttachment(a)},resetData:!0,removeAttachDOM:!0},$dropCenter:$(ReactDOM.findDOMNode(this.props.parent.refs.notebox))},b.props.note.get("notes").id?a.beforeAttach=!1:a.beforeAttach=function(a){b.props.note.addNote({}).done(function(){b.attRefObj.updateConfig({}),a()})},zmUtil.initAttachComponent(a,function(a){b.attRefObj=a})}},{key:"handleAddAttachment",value:function(){var a=this,b=a.attRefObj.configJSON;a.props.note.get("notes").id?b.beforeAttach=!1:b.beforeAttach=function(b){a.props.note.addNote({}).done(function(){a.attRefObj.updateConfig({}),b()})},a.attRefObj.updateConfig(b),a.attRefObj.init()}},{key:"render",value:function(){var a=!0;return(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.note.get("gnrl").by!==zmail.zuid)&&(a=!1),!a||this.props.readMode?null:React.createElement("li",{ref:"attachIcon",onClick:this.handleAddAttachment},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-attachment"}))))}}]),b}(React.Component),f=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSendMail=d.handleSendMail.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.sendmail,text:zNote.notei18n.tooltips.sendMail,arrow:"top"})}},{key:"handleSendMail",value:function(){$.publish("zm/closeAllOpenDialog"),this.props.note.sendAsMail()}},{key:"render",value:function(){return!this.props.note.get("notes").id||this.props.readMode?null:React.createElement("li",{ref:"sendmail",onClick:this.handleSendMail},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-send"}))))}}]),b}(React.Component),g=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c)),e=zNote.isStickyNote(d.props.note.toJSON());return d.state={sticky:e},d.handleMakeSticky=d.handleMakeSticky.bind(d),d.updateSticky=d.updateSticky.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){this.showToolTips(),$.subscribe("stickyNoteMod",this.updateSticky)}},{key:"componentDidUpdate",value:function(){this.showToolTips()}},{key:"updateSticky",value:function(){var a=zNote.isStickyNote(this.props.note.toJSON());this.setState({sticky:a})}},{key:"componentWillUnmount",value:function(){$.unsubscribe("stickyNoteMod",this.updateSticky)}},{key:"showToolTips",value:function(){this.state.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"})}},{key:"stickyOrUnSticky",value:function(){var a=this;this.state.sticky===!1?(zNote.addAsStickyNote(zNote.getNoteDataInListFormat(this.props.note.toJSON())),setTimeout(function(){var b=zNote.stickyNoteCollectionView.getTopLeft(a.props.note.get("notes").id);$.publish("zm/closeAllOpenDialog",b)}),this.setState({sticky:!0})):(this.setState({sticky:!1}),$.publish("/note/closeStickyNote",[a.props.note.get("notes").id,a.props.note.get("gnrl").group.id]))}},{key:"handleMakeSticky",value:function(){var a=this;a.props.note.get("notes").id?("true"===a.props.options.tab&&zmsuite.isWorkspaceAvailable(a.props.note.get("notes").id)&&zmsuite.closeWorkspace(a.props.note.get("notes").id),a.stickyOrUnSticky()):a.props.note.addNote({}).done(function(){a.stickyOrUnSticky()})}},{key:"render",value:function(){if(!this.props.options||!this.props.options.previewCard)return null;var a=this.state.sticky?"msi-stiPNotes":"msi-stiNotes";return React.createElement("li",{ref:"stickyNote",onClick:this.handleMakeSticky},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:a}))))}}]),b}(React.Component);zNote.Views.NotePreview.TagsPreview=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"addLabel",value:function(a,b){var c,d=this,e={};e.parentDOM=this.refs.plus?ReactDOM.findDOMNode(this.refs.plus):ReactDOM.findDOMNode(this.refs.label),e.displayAs="popup",e.labelState={labelList:this.props.note.get("myact").label},e.showCreate=!0,e.accType="default",e.onCreate=function(a,b){znBox.sendNewLabReq(a,b).done(function(a){a&&1===a[0]&&a[1].labelId&&(c.hide(),d.props.note.addTag(a[1].labelId))})},e.onStateChange=function(a,b,c){b?d.props.note.addTag(a):d.props.note.removeTag(a)},c=zmUtil.createFLComp("label",e),c.show()}},{key:"render",value:function(){var a={backgroundColor:""},b=this;if(!this.props.header||this.props.readMode)return null;var c=function(a){return function(c){b.addLabel(c,a)}};return b.props.note.get("myact").label&&b.props.note.get("myact").label.length>0?React.createElement("div",{className:"zm_lbl"},React.createElement("div",{className:"zmLblGrp zmViewLtdLbl"},b.props.note.get("myact").label.map(function(b){return zmUtil.getTagList("default")[b]?(a={backgroundColor:zmUtil.getTagList("default")[b].color},React.createElement("div",{className:"zmLbl",title:zmUtil.getTagList("default")[b].label,onClick:c()},React.createElement("span",{style:a}))):null})),React.createElement("i",{className:"msi-plus",ref:"plus",onClick:c()})):React.createElement("div",{className:"zm_lbl",ref:"label",onClick:c()},React.createElement("i",{className:"msi-label",ref:"label"}))}}]),b}(React.Component);var h=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetAttributes=d.handleSetAttributes.bind(d),d.handleSetColor=d.handleSetColor.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})}},{key:"handleSetColor",value:function(a){var b=this;if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');
c.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("notes").color]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className])})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")}},{key:"handleSetAttributes",value:function(){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")}},{key:"render",value:function(){var a=!1;return!znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})&&(this.props.note.get("gnrl").by===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&(a=!0),!a||this.props.readMode?null:React.createElement("li",{ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"}))))}}]),b}(React.Component),i=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleShowStreamsBar=d.handleShowStreamsBar.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"handleShowStreamsBar",value:function(){this.props.showStreamsBar(this.props.note.toJSON())}},{key:"render",value:function(){var a;return a=this.props.note.get("showstream")&&this.props.note.get("notes").id?"zn_commentsOpen":"zn_commentsOpen SC_dyn",React.createElement("span",{className:a,ref:"showstream",onClick:this.handleShowStreamsBar},React.createElement("i",{className:"msi-nextH"}))}}]),b}(React.Component),j=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"render",value:function(){return!this.props.note.get("gnrl").group.isGroup&&this.props.note.get("gnrl").group.id!==zmail.zuid&&this.props.options&&this.props.options.print?React.createElement("div",{className:"zn_folder zn_clear SC_dyn"}):React.createElement("div",{className:"zn_folder zn_clear"},function(a){return React.createElement(zNote.Views.NotePreview.TagsPreview,{note:a.props.note,options:a.props.options,parent:a,ref:"tag"})}(this),React.createElement(k,{note:this.props.note,readMode:this.props.readMode,removeNote:this.props.removeNote}))}}]),b}(React.Component),k=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleChangeBook=d.handleChangeBook.bind(d),d.handleChangeGroup=d.handleChangeGroup.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){(this.props.note.get("gnrl").group.id===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&zmComponent.tooltip({elm:this.refs.book,text:zNote.notei18n.tooltips.moveNote,arrow:"top"}),(this.props.note.get("gnrl").by===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&zmComponent.tooltip({elm:this.refs.group,text:zNote.notei18n.tooltips.changeGroup,arrow:"top"})}},{key:"handleChangeBook",value:function(){var a,b=!1;if(!znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})&&(this.props.note.get("gnrl").by===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&(b=!0),b&&!this.props.readMode){var c=znBox.getCategoryArray(this.props.note.get("gnrl").group.id),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.book),e.displayAs="popup",e.onSelect=function(b){d.props.note.changeBook(b),a.hide()},(this.props.note.get("gnrl").group.id===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&(e.onCreate=function(b){znBox.sendNewCatReq(b,{},d.props.note.get("gnrl").group.id).done(function(b){d.props.note.changeBook(b[1][0].catId),a.hide()})}),e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},a=zmUtil.createFLComp("category",e),a.show()}}},{key:"handleChangeGroup",value:function(){if(this.props.note.get("gnrl").by===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner){var a,b=znBox.getGroupArray(),c=this,d={};d.parentDOM=ReactDOM.findDOMNode(this.refs.group),d.displayAs="popup",d.showCreate=!0,d.onSelect=function(b){c.props.note.changeGroup(b),a.hide()},d.onHide=function(){$("#zm_dropDown").remove()},d.dataCallback=function(){return b},a=zmUtil.createFLComp("group",d),a.show()}}},{key:"render",value:function(){var a;(this.props.note.get("gnrl").by===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&(a=!0);var b=znBox.getGroupName(this.props.note.get("gnrl").group.id),c=zNote.getNamefrmCatObj(this.props.note.get("notes").catid,this.props.note.get("gnrl").group.id),d=""===b?"zn_cgy SC_dyn":"zn_cgy",e=a?"zn_ngrp SC_csr":"zn_ngrp";return React.createElement("div",{className:d,ref:"cgy"},React.createElement("font",{className:e,ref:"group",onClick:this.handleChangeGroup},b),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},c))}}]),b}(React.Component),l=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));d.ispaste=!1;var e=d.props.note.get("notes").id?2e4:5e3;d.checkSaveDesc=_.debounce(d.setDescription,e);var f=!1;return d.props.note.get("notes").notecont&&d.props.note.get("notes").notecont.length>=255&&(f=!0),d.showEditor=znBox.isRichTextOpen()&&!d.props.streamList,d.state={height:0,readmore:f,istagCheck:!1},d.handleKeyDown=d.handleKeyDown.bind(d),d.handlePaste=d.handlePaste.bind(d),d.handleClickHandler=d.handleClickHandler.bind(d),d.handleSetHeight=d.handleSetHeight.bind(d),d.handleSaveSelection=d.handleSaveSelection.bind(d),d.fillSummary=d.fillSummary.bind(d),d.editorContentUpdate=d.editorContentUpdate.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"shouldComponentUpdate",value:function(a,b){return a.note.get("notes").notecont!==this.descOnView}},{key:"setDescription",value:function(a,b){b||this.ispaste===!1&&this.state.istagCheck===!1&&(this.showEditor?(this.descOnView=this.editor.getContent(),this.props.note.saveDescription(this.editor.getContent())):this.showEditor||(this.descOnView=$(ReactDOM.findDOMNode(this.refs.content)).html(),this.props.note.saveDescription($(ReactDOM.findDOMNode(this.refs.content)).html())))}},{key:"editorContentUpdate",value:function(a){var b=this;b.showEditor&&b.props.note.get("notes").notecont!==b.descOnView&&b.editor.setContent(b.props.note.get("notes").notecont)}},{key:"componentWillUnmount",value:function(){var a=this;$(ReactDOM.findDOMNode(this.refs.content)).off("mousedown","a"),$(ReactDOM.findDOMNode(this.refs.content)).off("click","a"),$(ReactDOM.findDOMNode(this.refs.content)).off("focus"),this.checkSaveDesc({},!0),a.props.note.off("change",a.editorContentUpdate)}},{key:"componentDidMount",value:function(){this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()});var a=this,b=function(b){a.props.note.addTag(b.id)},c=function(){a.setState({istagCheck:!0})},d=function(){a.setState({istagCheck:!1})},e={compare:["hashname"],LType:"2",OType:"4",callback:b,initialCallback:c,finallyCallback:d};if(e.getContentArray=function(){return znBox.getLabelArray(a.props.note.get("myact").label)},this.showEditor){var f={id:this.editorId,editorType:"smartCompose",editorheight:"200px",defaultfontsize:"14px",setdefaultfontcolor:"#000000",defaultfontfamily:"Verdana,Arial",styRewriter:["DIV","SPAN","P","H3","STRONG","EM","INS","STRIKE"],microParaToolbar:!1,microInsertToolbar:!1,avoidMoreOption:!0,removeStyleProps:["backgroundColor","fontSize","fontFamily","color"],generalToolbar:!1,content:this.content,notes:!0};this.editor=ZE.create(f);var g=Boolean(this.props.options&&"true"===this.props.options.disableShortcuts);this.editor.afterEditorLoad(function(){var b=$(a.editor.doc.body);b.css("line-height","1.4em");var c=$(a.editor.iframe);g||zmComponent.keybindings.listener.add(a.editor.doc),b.attr("data-enableshortcuts","true"),a.setHeight?(a.setHeight+=c.height(),c.css("height",a.setHeight)):c.css("height","auto"),c[0].style.overflow="hidden",c[0].style.overflowY="auto",b.on("keydown",function(b){a.handleKeyDown(b)}),b.on("mousedown",function(a){znBox.hideMenu()}),b.on("click",function(b){a.handleClickHandler(b)}),b.on("keyup",function(b){a.handleSetHeight(b)}),b.on("blur",function(b,c){a.setDescription(b,c),a.checkSaveDesc({},!0)}),a.props.note.on("change",a.editorContentUpdate);var d=function(b){null!==b&&a.props.options&&a.props.options.componentUpdated&&a.props.options.componentUpdated({type:"editorBar"})},e=a.props.note.get("notes");e.notecont=a.editor.getContent(),a.props.note.set({notes:e},{silent:!0}),a.props.readMode||ReactDOM.render(React.createElement(zNote.getEditorIcons,{readMode:a.props.readMode,editor:a.editor,ref:d}),a.props.parent.refs.editorBar)})}var h=function(a){a.preventDefault(),a.stopPropagation(),$("#ngoto").remove();var b=a.target.getBoundingClientRect().left,c=a.target.getBoundingClientRect().top+(a.target.getBoundingClientRect().bottom-a.target.getBoundingClientRect().top),d={left:b+"px",top:c+"px",right:"auto",zIndex:"1001"},e=$(zNote.templates.linkEl({style:d,href:this.href}));$("body").append(e),$("#ngoto").on("mousedown",function(a){a.stopPropagation()}),$("#ngoto").on("click",function(){$("#ngoto").remove()}),$("#nlink").on("click",function(a){a.stopPropagation(),$("#ngoto").remove()})};this.showEditor||this.props.streamList===!0||($(ReactDOM.findDOMNode(this.refs.content)).on("focus",a.handleSaveSelection),$(ReactDOM.findDOMNode(this.refs.content)).on("mousedown","a",h),$(ReactDOM.findDOMNode(this.refs.content)).on("click","a",function(a){a.preventDefault(),a.stopPropagation()}))}},{key:"setImage1",value:function(a){var b=this.selection,c=this.showEditor?$(this.editor.doc.body):$(ReactDOM.findDOMNode(this.refs.content)),d=zmail.conPath+"/FileDownload?mode=tmpview&entityType=1&accId="+zmail.accId+"&fpath="+a.fP+"&fstorename="+a.sN;if(this.showEditor)this.editor.insertImage(d,{size:"bestfit"});else{$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus",!0,!0);var e=znBox.restoreSelectionNew(c[0],b);e||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img src="+d+"></img>"):document.execCommand("insertHTML",!1,"<img src="+d+"></img>")}}},{key:"setImage",value:function(a){var b=this.selection,c=this.showEditor?$(this.editor.doc.body):$(ReactDOM.findDOMNode(this.refs.content)),d=Object.keys(a[0].inline[0])[0],e=zmail.conPath+"/FileDownload?attachId="+a[0].inline[0][d].Id+"&entityType=2&entityId="+this.props.note.get("notes").id+"&actionType=viewGroupEntity&groupId="+this.props.note.get("gnrl").group.id+"&streamsView=Notes&mode=view&app=notes&attachType=inline";if(this.showEditor)this.editor.insertImage(e,{size:"bestfit"});else{var f=znBox.restoreSelectionNew(c[0],b);f||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img id="+a[0].inline[0][d].Id+" src="+e+"></img>"):document.execCommand("insertHTML",!1,"<img id="+a[0].inline[0][d].Id+" src="+e+"></img>")}}},{key:"handleSetHeight",value:function(a){var b=this.props.note.get("notes").isRichText,c=this.showEditor?$(this.editor.doc.body):$(ReactDOM.findDOMNode(this.refs.content));this.selection=znBox.saveSelectionNew(c[0]),this.state.height!==c.height()&&this.setState({height:c.height()}),32!==a.keyCode||this.showEditor||zNote.updateLinks(c[0],b),this.checkSaveDesc()}},{key:"handleSaveSelection",value:function(a,b,c){if(!c){var d=this.showEditor?$(this.editor.doc.body):$(ReactDOM.findDOMNode(this.refs.content));this.selection=znBox.saveSelectionNew(d[0])}}},{key:"restoreSelection",value:function(){znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),this.selection)}},{key:"handlePaste",value:function(a){var b=this;this.ispaste=!0,znBox.handlePaste(a.target),setTimeout(function(){b.ispaste=!1},200)}},{key:"handleKeyDown",value:function(a){zNote.disable(a)||this.showEditor?27!==a.keyCode&&27!==a.which||this.setDescription():a.preventDefault()}},{key:"fillSummary",value:function(){this.setState({readmore:!1})}},{key:"setContentHeight",value:function(a){var b;this.showEditor?this.setHeight=a.height:(b=ReactDOM.findDOMNode(this.refs.content),$(b).css("height",a.height),b.style.overflow="hidden",b.style.overflowY="auto")}},{key:"updateHeight",value:function(a){var b;this.showEditor?(b=this.editor.iframe,this.setHeight=a.height+$(b).height(),$(b).css("height",this.setHeight)):(b=ReactDOM.findDOMNode(this.refs.content),$(b).css("height",a.height)),b.style.overflow="hidden",b.style.overflowY="auto"}},{key:"handleClickHandler",value:function(a){if("IMG"===a.target.nodeName){var b=a.target.src,c=[],d={ft:101,fn:" ",src:b};c.push(d),zmUtil.initAttSlideShow(c,0,!0)}else this.handleSaveSelection(a)}},{key:"render",value:function(){var a=this,b="true";(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.streamList||this.props.note.get("gnrl").by!==zmail.zuid||this.props.options&&this.props.options.print===!0)&&(b="false",this.showEditor=!1),this.content=this.props.note.get("notes").notecont?this.props.note.get("notes").notecont.replace(/\n/g,"<br>"):"";var c=this.props.options&&"true"===this.props.options.disableShortcuts?"false":"true",d=zNote.notei18n.placeholder.writeSome,e=this.state.readmore?"zn_cont zn_trunc":"zn_cont";this.editorId=(new Date).getTime();var f=function(){return function(b){a.setDescription(b),a.checkSaveDesc({},!0)}};return"false"===b&&this.props.streamList?React.createElement("div",{className:"zn_base"},React.createElement("div",{className:e,"data-enableshortcuts":c,"data-plhr":d,ref:"content",onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onClick:this.handleClickHandler,onKeyUp:this.handleSetHeight,onBlur:f(),contentEditable:b,dangerouslySetInnerHTML:{__html:this.content}}),function(){if(a.state.readmore)return React.createElement("div",{className:"znMore",onClick:a.fillSummary},"Read More ...")}()):React.createElement("div",{className:"zn_base",id:this.editorId},function(){return a.showEditor?null:React.createElement("div",{className:"zn_cont","data-enableshortcuts":c,"data-plhr":d,ref:"content",onKeyDown:a.handleKeyDown,onPaste:a.handlePaste,onClick:a.handleClickHandler,onKeyUp:a.handleSetHeight,onBlur:f(),contentEditable:b,dangerouslySetInnerHTML:{__html:a.content}})}())}}]),b}(React.Component),m=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c)),e=d.props.note.get("notes").id?2e4:5e3;return d.checkSaveTitle=_.debounce(d.setTitle,e),d.handlePasteForTitle=d.handlePasteForTitle.bind(d),d.handleSetMaxCharacter=d.handleSetMaxCharacter.bind(d),d.handleKeyUp=d.handleKeyUp.bind(d),d.handleKeyDown=d.handleKeyDown.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentWillUnmount",value:function(){zmail.showFeature&&this.checkSaveTitle({},!0)}},{key:"shouldComponentUpdate",value:function(a,b){return a.note.get("notes").title!==this.titleOnView}},{key:"handleKeyDown",value:function(a){13===a.keyCode?(a.preventDefault(),znBox.isRichTextOpen()?this.props.setEditorFocus():ReactDOM.findDOMNode(this.props.parent.refs.desc.refs.content).focus()):27===a.keyCode||27===a.which?this.setTitle():zNote.disable(a)||this.showEditor||a.preventDefault()}},{key:"setTitle",value:function(a,b){b||($(ReactDOM.findDOMNode(this.refs.title)).text().trim().length||$(ReactDOM.findDOMNode(this.refs.title)).text(""),this.titleOnView=znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.title)))),this.props.note.saveTitle($(ReactDOM.findDOMNode(this.refs.title)).text()))}},{key:"handlePasteForTitle",value:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;this.handleSetMaxCharacter(a)&&(this.ispaste=!0,znBox.handlePaste(a.target,void 0,b),this.ispaste=!1)}},{key:"handleKeyUp",value:function(){zmail.showFeature&&this.checkSaveTitle()}},{key:"handleSetMaxCharacter",value:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;return!(b<=0)||(a.preventDefault(),_zm.succErrMsg("e",zNote.notei18n.titexceed),!1)}},{key:"render",value:function(){var a=this,b=zNote.notei18n.placeholder.title,c="true";(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.streamList||this.props.note.get("gnrl").by!==zmail.zuid||this.props.options&&this.props.options.print===!0)&&(c="false");var d=this.props.note.get("cntnt").title&&this.props.note.get("cntnt").title!==znBox.CONTS.defaultTitle?znBox.spCharRep(this.props.note.get("cntnt").title):"",e=this.props.options&&"true"===this.props.options.disableShortcuts?"false":"true",f=function(){return function(){a.setTitle(),zmail.showFeature&&a.checkSaveTitle({},!0)}};return React.createElement("div",{className:"zn_tit","data-enableshortcuts":e,onPaste:this.handlePasteForTitle,onKeyPress:this.handleSetMaxCharacter,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,ref:"title",contentEditable:c,onBlur:f(),"data-plhr":b},d)}}]),b}(React.Component),n=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleArchive=d.handleArchive.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this.props.note.get("notes").archived?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"componentDidUpdate",value:function(){var a=this.props.note.get("notes").archived?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"handleArchive",value:function(a){a.stopPropagation();var b=!this.props.note.get("notes").archived;this.props.note.archiveOrUnarchiveNote({archived:b})}},{key:"render",value:function(){var a=this.props.note.get("notes").archived?"msi-unarchive":"msi-archive",b=!1;return!znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})&&(this.props.note.get("gnrl").by===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&(b=!0),znBox.isArchiveOpen()&&b&&!this.props.readMode?React.createElement("li",{ref:"archive",onClick:this.handleArchive},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:a})))):null}}]),b}(React.Component),o=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidUpdate",value:function(){this.props.options&&this.props.options.componentUpdated&&this.props.options.componentUpdated({type:"attachment"})}},{key:"viewImage",value:function(a,b){for(var c=this,d=[],e=this.props.note.get("attach"),f=0,g=e.length;f<g;f++){var h=$.extend(!0,{},e[f]);h.gId=this.props.note.get("gnrl").group.id,h.gId!==zmail.zuid&&(h.type="viewGroupData"),d.push(h)}var i={},j={},k=[];j.trash={"class":"msi-trash",title:zNote.notei18n.tooltips.deleteAttach,after:".msi-download",events:[{name:"click",listener:function(a,b,d){c.props.note.delAtt(b.e,b.Id,d)}}]},k.push("#etyIcon"),i.extraIcons=j,i.hideOptions=k,zmUtil.initAttSlideShow(d,b,!1,i)}},{key:"render",value:function(){var a,b,c=this,d=this.props.note.get("attach")&&_.filter(this.props.note.get("attach"),function(a){return!a.inline}),e=function(a,b){return function(){c.viewImage(a,b)}};return d&&d.length?React.createElement("div",{className:"zn_folder zn_clear zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})),d.map(function(d,f){var g=d,h=zmUtil.fileTyp(g.name);if("msi-attimg"===h[1])b=c.props.note.get("notes").id===zmail.zuid?zmail.conPath+"/FileDownload?attachId="+g.id+"&entityType=2&entityId="+c.props.note.get("notes").id+"&groupId="+c.props.note.get("gnrl").group.id+"&mode=thb&app=notes":zmail.conPath+"/FileDownload?attachId="+g.id+"&entityType=2&entityId="+c.props.note.get("notes").id+"&groupId="+c.props.note.get("gnrl").group.id+"&streamsView=Notes&actionType=viewGroupEntity&mode=thb&app=notes",a=React.createElement("img",{src:b});else{var i=h[1]+" zm-attIcn";a=React.createElement("i",{className:i})}return React.createElement("div",{className:"zmL zmAch",key:g.id,title:g.name,onClick:e(g,f)},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},a))))})):React.createElement("div",{className:"zn_folder zn_clear SC_dyn zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})))}}]),b}(React.Component)}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteHeaderPreview=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleOpenNoteInTab=d.handleOpenNoteInTab.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){this.props.note.on("change",function(){this.forceUpdate()}.bind(this))}},{key:"handleOpenNoteInTab",value:function(){zNote.openNoteInTab({namespaceId:this.props.note.get("gnrl").group.id,id:this.props.note.get("notes").id})}},{key:"render",value:function(){var a="/zm/#notes/tab/"+this.props.note.get("gnrl").group.id+"/"+this.props.note.get("notes").id;return React.createElement("div",{className:"SCS_postHead"},React.createElement(zNote.Views.NotePreview.NoteCreatorPreview,{note:this.props.note,header:"true"}),React.createElement("div",{className:"SCS_postDet"},React.createElement("a",{href:a,className:"dateTime"},this.props.note.get("notes").disptime," "),React.createElement("i",{className:"msi-more popOut SC_openTab","data-tooltip":zNote.notei18n.note.openTab,onClick:this.handleOpenNoteInTab}),React.createElement("div",{className:"SC_SDot"}),React.createElement("i",{className:"msi-notes"}),React.createElement("div",{className:"SC_SLine"}),function(a){return React.createElement(zNote.Views.NotePreview.TagsPreview,{note:a.props.note,header:"true",options:a.props.options,parent:a,ref:"tag"})}(this),React.createElement("div",{className:"SC_SLine"}),React.createElement(zNote.Views.NotePreview.FavouritePreview,{note:this.props.note,header:"true",options:this.props.options})))}}]),b}(React.Component)}();
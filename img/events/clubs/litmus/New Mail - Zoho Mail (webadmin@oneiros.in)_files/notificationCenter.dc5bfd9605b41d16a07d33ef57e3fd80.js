"use strict";define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.constants"),c=a("zmail"),d=a("zmText"),e=d.get("notificationCenter","global");return b.systemName=d.applyArgs(e.productName,{companyName:(a("zmail.globalI18N")||{}).companyName||e.companyName}),b.moduleName="notificationCenter",b.ncount=0,b.companyName=(e||{}).companyName,b.uri=c.conPath+"/ncenter.do",b.snoozeMailReminderURI=c.conPath+"/snooze.do",b.snoozeTaskReminderURI=c.conPath+"/taskAction.do",b.streamsModuleName="streamsApp",b.streamuri=c.conPath+"/stream.do",b.streamTabName="zm_stream",b.popoutElmId="zmncpreview",b.workSpaceName="zmncenter",b.actionIconId="zm-notifications",b.popoutId="zm-notification-list",b.viewSelfData="viewSelfData",b.viewGroupData="viewGroupEntity",b.pagination="pagination",b.systemIcon=zmResource.get("image","favicon.ico"),b.gender={0:"FEMALE",1:"MALE",2:"COMMON"},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.constants");return b.css={streamIconHighlight:"SC_newActivity",workSpaceClass:"zmNotiContent",tabIcon:"msi-notification",closeIcon:"msi-close",unread:"zmNotiUnRead",entityIcon:{1:"msi-mail",2:"msi-notes",3:"msi-task",4:"msi-calendar",6:"msi-status",9:"msi-mail",13:"msi-twitter"},actionIcon:{31:"msi-comment",36:"msi-comment",43:"msi-comment",25:"msi-mention",38:"msi-mention",44:"msi-mention",45:"msi-mention",23:"msi-love",49:"msi-love",29:"msi-invitee",50:"msi-addgroup"},list:{navClass:"sel",selection:"zmSLst",keyboardSelClass:"js-noti-sel"}},b.params={mode:"groupedlist",eType:"-1"},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.constants");return b.allowedDesktopNotificationTypes={streams:["25","29","38","44","45"],mail:["59"],task:["42"],notes:[]},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.constants");return b.tabSwitch="/apps/tabSwitched",b.removePreview={tab:"/ncenter/removePreview/tab",popout:"/ncenter/removePreview/popout"},b.newNotification={tab:"/ncenter/newNotification/tab",popout:"/ncenter/newNotification/popout"},b.removeNotification={tab:"/ncenter/removeNotification/tab",popout:"/ncenter/removeNotification/popout"},b.removeUnread={tab:"/ncenter/removeUnread/tab",popout:"/ncenter/removeUnread/popout"},b.pickerCloseEvent="/ncenter/snooze/picker/close",b.stopEvents="/ncenter/stopEvents",b.topbarCloseEvent="zmTopBar/popover/close",b.topbarOpenEvent="zmTopBar/popover/open",b.hideMenuEvent="/mail/menuCreated",b.removePopoutPreview="/ncenter/closePreview",b.range=20,b.reconnect="zmailReconnect",b.closePopoutFromStreams="/streams/closePopOut",b.tabClose="/ncenter/internal/tabClose",b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.constants");return b.formatter={showUsers:3,replacePatterns:{companyName:"{{companyName}}",productName:"{{productName}}",groupName:"{{groupName}}",entityName:"{{entityName}}",entityValue:"{{entityValue}}",entityAccess:"{{entityAccess}}",userName:"{{userName}}",tagName:"{{tagName}}",preposition:"{{preposition}}",wallName:"{{wallName}}",handleName:"{{handleName}}",taskName:"{{taskName}}",memberRole:"{{memberRole}}"}},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.constants");return b.types={addPost:"30",groupMember:["50","51"],sharedFolder:["52","53","54","60","74"],removeSelfFor:["23","31","49"],memberRoleChange:["109","150"],clearCount:"114",inviteUser:"29",addComment:"31",taskUser:["64"],notificationReminder:["42","59"],dismiss:["175"],addTweet:["112"],suppressNotification:["118","34","162"],markRead:["170"],deleteEntity:["32","48"],modifyEntity:["35","34"],taskAssign:["58"],updateEventStatus:["55","56","57"],taskMention:["321"],twitterConfig:["171","173","174"],acceptOrDeny:["29","137"],accessRequest:["117"]},b.notificationTypes={4:"MAIL_TYPE",23:"LIKE",24:"UNLIKE",25:"POST_MENTION",26:"UNLIKE_COMMENT",27:"UNSHARED",29:"INVITE",30:"ADD_POST",31:"ADD_COMMENT",32:"DELETE_POST",34:"DELETE_COMMENT",35:"DELETE_PRIVATE_COMMENT",36:"ADD_PRIVATE_COMMENT",37:"CHANGE_ENTITY",38:"COMMENT_MENTION",39:"BULK_UPDATE",40:"BULK_DELETE",41:"ADD_TASK",42:"REMINDER_TASK",43:"ADD_SHARE_COMMENT",44:"POST_GROUP_MENTION",45:"COMMENT_GROUP_MENTION",46:"ADD_EVENT",47:"UPDATE_EVENT",48:"DELETE_EVENT",49:"LIKE_COMMENT",50:"ADD_GROUP_MEMBER",51:"REMOVE_GROUP_MEMBER",52:"RESOURCE_SHARE",53:"SHAREPERM_CHANGE",54:"SHAREPERM_REMOVAL",55:"UPDATE_EVENT_STATUS_YES",56:"UPDATE_EVENT_STATUS_NO",57:"UPDATE_EVENT_STATUS_MAYBE",58:"TASK_ASSIGN",59:"MAIL_REMINDER",60:"ACCEPT_SHARE",61:"MAIL_SHARE",62:"ADD_ATTACHMENT",63:"CHANGE_TASK_DUE_DATE",64:"CHANGE_TASK_ASSIGNEE",65:"CHANGE_TASK_STATUS",66:"CHANGE_TASK_PRIORITY",67:"CHANGE_TASK_CATEGORY",68:"CHANGE_TASK_TITLE",69:"CHANGE_TASK_DESCRIPTION",70:"REMOVE_ATTACHMENT",71:"DRAFT_SHARE",72:"DRAFT_SHAREUPDATE",73:"DRAFT_MAILMENTION",74:"SHARE_UNSUBSCRIBE",75:"STREAM_GROUP_ENABLE",76:"STREAM_GROUP_DISABLE",77:"MAIL_STREAMS_ENABLE",78:"MAIL_STREAMS_DISABLE",79:"ADD_LINK",80:"CHANGE_LINK_CATEGORY",81:"CHANGE_LINK_TITLE",82:"CHANGE_LINK_DESCRIPTION",83:"CHANGE_LINK_URL",84:"MARK_LINK_FAV",85:"CALENDAR_REMINDER",86:"CALENDAR_REMINDER_MAILID_CHANGE",87:"CALENDAR_SHARING",88:"CALENDAR_UNSUBSCRIBE",89:"BIZ_SUB_ONLINE_RENEW_DUE_FEWDAY",90:"BIZ_SUB_ONLINE_RENEW_TDY",91:"BIZ_SUB_ONLINE_RENEW_OVERDUE",92:"BIZ_SUB_ONLINE_RENEW_OVERDUE_TDY",93:"BIZ_SUB_OFFLINE_RENEW_DUE_FEWDAY",94:"BIZ_SUB_OFFLINE_RENEW_TDY",95:"BIZ_SUB_OFFLINE_RENEW_OVERDUE",96:"BIZ_SUB_OFFLINE_RENEW_OVERDUE_TDY",97:"BIZ_SUB_PURCHASE_MORE",98:"BIZ_SUB_PURCHASE",99:"DOMAIN_NOT_VERIFIED",100:"DOMAINS_NOT_VERIFIED",101:"MAIL_HOSTING_NIL",102:"MX_NOT_POINTED_TO_ZOHO",103:"REG_DOMAIN_AUTO_RENEW",104:"REG_DOMAIN_MANUAL_RENEW",105:"ADD_SUBTASK",106:"EDIT_LINK",107:"LOCK_INVITES",108:"UNLOCK_INVITES",109:"GROUP_MEMBER_ROLE_CHANGE",110:"DOMAIN_SPF_MISSING",111:"DOMAIN_DKIM_MISSING",112:"ADD_TWEET",113:"INVITE_PERMISSION_REQUEST",117:"ACCESS_REQUEST",150:"ADD_GROUP_MODERATOR",161:"MAIL_SHARE_UPDATE",171:"NEW_TWITTER_CONFIGURATION",173:"ENABLED_TWITTER_CONFIGURATION",174:"DISABLED_TWITTER_CONFIGURATION",175:"DISMISS",301:"TASK_PICKUP",303:"TASK_COMPLETE",304:"TASK_REOPEN",305:"TASK_SET_REPEAT",306:"TASK_CHANGE_REPEAT",307:"TASK_SET_PRIORITY_HIGH",308:"TASK_SET_PRIORITY_MEDIUM",309:"TASK_SET_PRIORITY_LOW",310:"TASK_SET_DUE_DATE",311:"REMOVE_ASSIGNEE",312:"TASK_DUE_DATE_CLEAR",314:"TASK_ARCHIVE",315:"TASK_UNARCHIVE",321:"TASK_MENTION"},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.constants");return b.snoozeTypes={LABEL:"snoozeText",TEN_MINUTES:1,ONE_HOUR:2,TOMORROW_MORNING:3,NEXT_MONDAY:4,CUSTOM:5},b.taskModes={1:"10mins",2:"1hour",3:"tomorrow",4:"nextweek",5:"custom"},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.utils"),c=a("zmAjq"),d=a("_zm"),e=a("zmail.Core.Namespaces").create("zmNCenter"),f=e.constants;return b.checkStrIsJson=function(a){try{if("object"!==("undefined"==typeof a?"undefined":babelHelpers["typeof"](a)))return a=JSON.parse(a),!0}catch(b){return!1}return!1},b.parseTwitterName=function(b){var c=b||"";if("object"===("undefined"==typeof b?"undefined":babelHelpers["typeof"](b)))return b;try{return b="string"==typeof b&&$.parseJSON(b)}catch(d){return a("zmUtil").debugLog(d),a("zmUtil").debugLog(b),b="string"==typeof b&&b.split("@"),{oName:c,displayName:b[0],screenName:b[1]}}},b.paginate=function(a,b,c){var e=function(a,b,c){a.offsetHeight+a.scrollTop>=a.scrollHeight-50&&b(c)};d.bindReset(b,"scroll",e,[b,c,a])},b._req=function(a){var b={t:"POST",u:a.u||f.uri,p:a.param,h:!a.hasOwnProperty("setHeader")||a.setHeader,fn:function(a,b){b&&"function"==typeof b.fn&&b.fn(a,b.args)}};a.callback&&(b.ep=a.callback),a.onerror&&(b.onerror=a.onerror),a.onnetfailure&&(b.onnetfailure=a.onnetfailure),c.XHR(b)},b.suppressNotification=function(a){return f.types.suppressNotification.indexOf(a)>-1},b.isEventNotification=function(a){return"85"===String(d.getProperty(a,"ntype"))},b.isNotificationOf={newMemberAddition:function(a){return f.types.groupMember.indexOf(a)>-1},folderShare:function(a){return f.types.sharedFolder.indexOf(a)>-1},removeSelf:function(a){return f.types.removeSelfFor.indexOf(a)>-1},memberRoleChange:function(a){return f.types.memberRoleChange.indexOf(a)>-1},inviteUser:function(a){return f.types.inviteUser===a},addComment:function(a){return f.types.addComment===a},taskUser:function(a){return f.types.taskUser.indexOf(a)>-1},notificationReminder:function(a){return f.types.notificationReminder.indexOf(a)>-1},taskAssign:function(a){return f.types.taskAssign.indexOf(a)>-1},clearCount:function(a){return a===f.types.clearCount},dismiss:function(a){return f.types.dismiss.indexOf(a)>-1},addTweet:function(a){return f.types.addTweet.indexOf(a)>-1},markRead:function(a){return f.types.markRead.indexOf(a)>-1},modifyEntity:function(a){return f.types.modifyEntity.indexOf(a)>-1},deleteEntity:function(a){return f.types.deleteEntity.indexOf(a)>-1},twitterConfig:function(a){return f.types.twitterConfig.indexOf(a)>-1},accessRequest:function(a){return f.types.accessRequest.indexOf(a)>-1},acceptOrDeny:function(a){return f.types.acceptOrDeny.indexOf(a)>-1},updateEventStatus:function(a){return f.types.updateEventStatus.indexOf(a)>-1},taskMention:function(a){return f.types.taskMention.indexOf(a)>-1}},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.utils"),c=a("zmail.Core.Namespaces").create("zmNCenter"),d=a("zmail"),e=a("_zm"),f=c.constants,g=c.text;return b.isItemViewable=function(a){var c=a.ntype;if(!f.notificationTypes.hasOwnProperty(c))return!1;if(b.isNotificationOf.removeSelf(c)&&a.nby.indexOf(d.zuid)>-1){a.nby="string"==typeof a.nby?a.nby.split(","):a.nby;var e=a.nby.indexOf(d.zuid);e>-1&&a.nby.splice(e,1)}return a.nby.length>0},b.isItemClickable=function(a){return this.isEventNotification(a)||!(a.isDeleted||"true"===String(e.getProperty(a,"sysevent"))||this.isNotificationOf.twitterConfig(a.ntype))},b.isCommentBoxEmpty=function(b){if(g=g||a("zmNCenter.text"),b){var c=e("<","textArea",e(".","zm_mention",b)[0])[0];if(c&&"fixed"===e.attr(c,"data-type")&&""!==c.value)return!window.confirm(g.common.unpublishedContentWarning)}return!0},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.utils"),c=a("zmail.Core.Namespaces").create("zmNCenter");return b.deleteNotification=function(a){if(a=a||{},b.isNotificationOf.modifyEntity(a.ntype)){var d=c.dataStore.getEntity(a.nid);d&&(Array.isArray(d.commentuuid)&&1===d.commentuuid.length?($.publish(c.constants.removeNotification.tab,a),$.publish(c.constants.removeNotification.popout,a)):($.publish(c.constants.removeNotification.tab,a),$.publish(c.constants.removeNotification.popout,a)))}},b.markRead=function(a){a=a||{},b.parseJSON(a);var d=a.nIdKeys||[];Array.isArray(d)&&d.forEach(function(a){var b=c.dataStore.update(a,{unread:!1});$.publish(c.constants.removeUnread.tab,b),$.publish(c.constants.removeUnread.popout,b)})},b.updateAcceptOrDenyMembers=function(a){var b=String(a.eid+"_"+c.constants.types.accessRequest[0]);a.accessRequestID=b;var d=c.dataStore.cache.getEntity(b);if(d){var e=Object.keys(a.members||{})||[];d.nby=Array.isArray(d.nby)?d.nby:d.nby.split(","),d.nBy=d.nBy||[],d.nby=d.nby.filter(function(a){return e.indexOf(a)<0}),d.nBy=d.nBy.filter(function(a){return e.indexOf(a.zuid)<0})}},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.utils"),c=a("zmail.Core.Namespaces").create("zmNCenter"),d=a("zmail"),e=a("_zm"),f=c.text,g=c.constants;return b.getEntityName=function(b){return f=f||a("zmNCenter.text"),f.entity[b]},b.loadActionText=function(){f=f||a("zmNCenter.text"),f.actionText={}},b.getActionIcon=function(a,b){return g.css.actionIcon[a]||g.css.entityIcon[b]},b.getSummaryText=function(b,d){d=d instanceof Array?d[0]:d,d=!b&&d&&d.trim().length>0?d:"";var e=[],f=a("zmSmiley").replaceText(d);if(f.length){var g=0;f.forEach(function(a,b,f){var h=d.substring(g,a.from);e.push(c.views.textWrapper(h)),e.push(c.views.smileyWrapper(a.text)),g=a.to})}else e.push(c.views.textWrapper(d));return d&&(e.splice(0,0,c.views.textWrapper(" : ")),e.push(c.views.textWrapper("..."))),e},b.getStreamIcon=function(){return e(".","msi-streams",e("#","topBar"))[0]},b.getActionText=function(b,c,d,e){f=f||a("zmNCenter").text;var h=f.notificationTypes,i=g.notificationTypes[b],j=g.gender[c],k=d?"FOLLOWER":"OWNER",l=e?"PLURAL":j,m=[i,k,l],n=m.join("/");return h.hasOwnProperty(n)||(m.pop(),m.push("COMMON"),n=m.join("/")),h[n]||n},b.getUser=function(a,c){c=c||{};var e=c.nBy||[],f=!1,g=e.filter(function(b,c,d){return"undefined"!=typeof b[a]})[0]||{},h={g:2,zid:"",nn:"",photo:"",eid:"",fn:""};if((b.isNotificationOf.addTweet(c.ntype)||b.isNotificationOf.twitterConfig(c.ntype))&&(g[a]=b.checkStrIsJson(g[a])?$.parseJSON(g[a]):b.parseTwitterName(g[a]),g[a]=g[a]||{},g.fn=g[a].displayName||g[a].oName||g[a].screenName||"",h.screenName=g.screenName||g[a].screenName,h.photo=g[a].imageUrl||h.photo,f=!0),g[a]&&(h.zid=a,h.fn=g.fn||("string"==typeof g[a]?g[a]:"")),h.photo=h.photo||zmResource.get("image","SC-Photo.png"),h.isDummyObj=!0,!f){var i=d.ContactBook.get({zuid:a,promise:!1,type:"org"});i.length>0&&(h=i[0].attrs)}return h},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.utils"),c=a("zmail.Core.Namespaces").create("zmNCenter"),d=a("_zm"),e=c.text,f=c.constants;return b.openNotificationInTab=function(b,d){var e=a("zmList");if(b=b||{},"59"===String(b.ntype)&&e)return c&&c.counter&&c.counter.decrement(),void e.getMailData({msgId:b.eid,tId:b.tid||b.eid,opentype:2,type:"lt",isRemainder:!0,src:"external"});var f={gid:b.group.id,pid:b.eid,etype:b.etype,actionType:b.group.isGroup?c.constants.viewGroupData:c.constants.viewSelfData,allComments:!0,shId:b.shId||"",ntype:b.ntype,group:b.group,markRead:!0};b.commentuuid&&(f.commentuuid=b.commentuuid),c&&c.counter&&d&&c.counter.decrement();var g=a("zmUtil");g&&"function"==typeof g.loadStreamsInTab&&g.loadStreamsInTab(f)},b.workspace=function(b){e=e||a("zmNCenter.text");var g,h,i,j=a("zmsuite"),k=b.name;return j.isWorkspaceAvailable(k)||(j.setWorkSpace(b.appConfig),g=j.getCenter()[0].getNodes(),g[0].push({left:[],right:[]}),g[1].push({left:{leftHTML:b.appConfig.appname}}),j.renderWorkSpace(),g=j.getCenter()[0].getNodes(),g[1].$el.find(".SC_mtb").addClass("SC_Tcen"),g[2].setListener("click",b.listingClick),h=j.getCenter()[1],i=h.getNodes()[0],d.addClass(i.$el.children(".SC_phd")[0],"SC_Sph"),i.push({text:"",rIcons:[[{tooltip:e.common.close,iconClass:f.css.closeIcon,data:"close"}]]}),i.setListener("click",function(a){"close"===a&&b.closePreview&&(b.closePreview(h),c.removeSelectionInTab())})),j.showWorkSpace(k),g=j.getCenter(),{listArea:g[0].getNodes()[2].$el[0],previewCard:g[1]}},b.loadPreview=function(a){var b=a.data,c=a.previewElm,d=a.fixedComment,e=a.openType;this.isEventNotification(b)?this.notificationPreview.event(b,c):this.notificationPreview.stream(b,c,d,e)},b.notificationPreview={stream:function(b,c,d,e){var g,h,i=a("zmUtil"),j=b.group.id,k=b.eid,l=b.etype,m=b.group.isGroup?f.viewGroupData:f.viewSelfData,n=b.shId||"",o=b.ntype;return h=function(c,d,e){var f=2;c&&(f=3);var g={msgId:b.eid||b.eid,type:"lt",opentype:f,tId:b.tid,tabId:"zmncenter",subject:b.summary[0],src:"zmncenter",isReminder:!0},h={prevElem:c,viewDetails:{view:"notification"}};b.commentuuid&&(g.commentuuid=b.commentuuid),a("zmList").getMailData(g,h)},"59"===String(o)?void h(c,d,e):(g=function(c,d,e){var f={gid:j,pid:k,etype:l,actionType:m,fixedComment:d,allComments:!0,elm:c,shId:n,ntype:o,group:b.group,markRead:!0,opentype:e};b.commentuuid&&(f.commentuuid=b.commentuuid),a("zmStreamsApp").events.openPost(f)},void i.requireStreamsApp().done(function(){g(c,d,e)}))},event:function(b,c){a("ZCL_streamEve").streamEveNotificationPreview(b,c)}},b.showLoader=function(b){return a("zmComponent").loadingBand({container:b,type:f.pagination})},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.utils"),c=a("_zm"),d=a("zmail"),e=a("zmail.Core.Namespaces").create("zmNCenter"),f=e.constants;return b.reconnect=function(){e.dataStore.cache.reset(),"undefined"!=typeof c.getProperty(e,"tab.list")&&e.tab.list.init(),"undefined"!=typeof c.getProperty(e,"popout.list")&&e.popout.list.init()},b.eventTimeRemaining=function(a,b){var c=b/1e3,d={unit:"millis",value:b,state:a};return c<60?(d.unit="seconds",d.value=c,d):(c/=60,c<60?(d.unit="minutes",d.value=c,d):(c/=60,c<24?(d.unit="hours",d.value=c,d):(c/=24,d.unit="days",d.value=c,d)))},b.parseJSON=function(a){if(c.getProperty(a,"folder")&&(a.folder="string"==typeof a.folder?$.parseJSON(a.folder):a.folder),c.getProperty(a,"group")&&(a.group="string"==typeof a.group?$.parseJSON(a.group):a.group),c.getProperty(a,"shgroup")&&(a.shgroup="string"==typeof a.shgroup?$.parseJSON(a.shgroup):a.shgroup),c.getProperty(a,"nBy")&&(a.nBy="string"==typeof a.nBy?$.parseJSON(a.nBy):a.nBy),c.getProperty(a,"members")&&(a.members="string"==typeof a.members?$.parseJSON(a.members):a.members),c.getProperty(a,"nIdKeys")){var b=a.nIdKeys;b=b.replace("[",""),b=b.replace("]",""),b=b.split(","),a.nIdKeys=b}},b.updateTime={start:function(a){return setInterval(function(){for(var d,e=c(".","zmnTimer",a),f=0,g=e.length;f<g;f++){d=e[f];var h=d.getAttribute("zmn-time");c.setTextContent(d,b.relativeTime(h),!0)}},5e3)},stop:function(a){clearInterval(a)}},b.relativeTime=function(b){return a("zmComponent").dateTimeUtil.relativeTime(b,"mm dd at hr:min")},b.removeNotificationPreview=function(a,b){$.publish(f.removePreview.tab,b),$.publish(f.removePreview.popout,b)},b.removeNotification=function(a,d,e){$(a).slideUp("slow","linear",function(){c.remove(a)}),$.publish(f.removeNotification.tab,d),$.publish(f.removeNotification.popout,d),e||b.removeNotificationPreview(a,d)},b.dismissNotification=function(a,c,e,g){b._req({u:f.uri||d.conPath+"/ncenter.do",param:{mode:"clear",entityType:a.etype,notificationType:a.ntype,entityId:a.eid},callback:{fn:g,args:e}})},b.getDefaultShortcuts=function(b){var c=(a("zmshCut")["default"]||[]).slice();return b=b||[],c=c.filter(function(a,c,d){return b.indexOf(a.keyStr)<0})},b}),define([],function(a){var b,c,d,e,f,g,h,i,j,k=a("zmNCenter"),l={},m=0,n=k.utils;return b=function(a){n._req({param:{mode:"count"},callback:{fn:a}})},c=function(){var b=function(a,b){n._req({param:{mode:"reset",count:a},callback:{fn:b}})},c=a("_").debounce(function(a,c){b(a,c)},300),d=function(a,d,e){e?c(a,d):b(a,d)};return d}(),d=function(b){var c=a("zmTopBar");c.updateNotificationCount(b)},e=function(a){f=f||$("#zm-popout-count"),g=g||$(".zmNotiIW"),a>0?(f.text("("+a+")"),g.attr("title",[k.text.common.title," (",a,")"].join("")),g.removeClass("newNoti").addClass("newNoti"),setTimeout(function(){g.removeClass("newNoti")},2e3)):(f.text(""),g.attr("title",k.text.common.title),g.removeClass("newNoti"))},h=function(a){m+="undefined"==typeof a?1:Number(a),m=m<0?0:m,d(m),e(m)},i=function(a){m>0&&h(a||-1)},j=function(a){var b=function(a){m=0,d(m),e(m)};a?b():m>0&&c(m,b,!0)},l=function(){b(function(a){m=a.count,m+=k.bizNotification.count(),d(m),e(m)})},l.count=function(){return m},l.setCount=function(a){"number"==typeof a&&a>=0&&(m=a,d(m),e(m))},l.getBadgeCount=b,l.resetBadgeCount=c,l.increment=h,l.decrement=i,l.reset=j,k.counter=l,l}),define([],function(a){var b=a("zmText"),c=a("zmail.Core.Namespaces").create("zmNCenter");return c.text=b.get("notificationCenter"),c.init=function(){c.core()},c}),define([],function(a){var b=a("_zm"),c=a("zmail.Core.Namespaces").create("zmNCenter"),d=a("zmail.Core.Namespaces").create("zmNCenter.views"),e={height:0,maxHeight:{"max-height":"424.2px"},top:{top:"40px"},block:{display:"block"},none:{display:"none"}};return d.nameWrapper=function(a){return["STRONG",{child:[["text",a]]}]},d.nameSeparator=["text",", "],d.textWrapper=function(a){return["text",a]},d.smileyWrapper=function(a){return["FONT",{attrs:{"class":a}}]},d.andWrapper=function(a,b){return[d.textWrapper(" "+c.text.common.and+" "),a?d.textWrapper(b+" "+c.text.common.others):d.nameWrapper(b)]},d.notificationListContainer=function(){return zdom("div",{id:"zm-notifications-popover",className:"zmNotiWra zmHideD"},zdom("div",{className:"zmNotiHeader"},zdom("strong",{"data-id":"zm-notification-txt"}),zdom("span",{id:"zm-popout-count"}),zdom("span",{className:"SC_frt zmThmClr cursorPointer","data-id":"zm-mark-as-read",style:e.none}),zdom("div",{id:"zm-popout-icon",title:c.text.common.seeAll,className:"SCmb SC_frt zm-pop-out","data-popout":""},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("span",null,zdom("i",{className:"msi-popout"}))))))),zdom("div",{className:"zmNotiContent",id:"zm-notification-list"}))},d.notificationItem=function(a){var c=b.getProperty(a,"photo"),d=b.getDOM(b.getProperty(a,"framedText")),e=b.getProperty(a,"actionIcon"),f=b.getProperty(a,"timestamp"),g=b.getProperty(a,"ctime"),h=b.getProperty(a,"openInTab"),i=b.getProperty(a,"unread"),j="zmL"+(i?" zmNotiUnread":""),k=zdom("div",null,zdom("div",{className:j},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmImg"},zdom("img",{src:c})),zdom("div",{className:"zmFrm"},zdom("span",{"data-framedText":!0})),zdom("div",{className:"zmSub"},zdom("i",{className:e}),zdom("span",{className:"sum zmnTimer","zmn-time":g},f),zdom("font",{"data-id":"openInTab",className:"SC_lnk"},h))))));return $(k).find("span[data-framedText]").append(d),k},d.eventNotificationItem=function(a){var b=a._eventData.title,d=a._eventData.remTime,e=a._eventData.stDate,f=a.ctime||"",g=c.utils.relativeTime(f);return zdom("div",null,zdom("div",{className:"zmL"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmImg noBdr"},zdom("i",{className:"msi-remind"})),zdom("div",{className:"zmFrm"},zdom("span",null,zdom("strong",null,d,zdom("span",{className:"sum"}," @ ",e),zdom("h3",null,b)))),zdom("div",{className:"zmSub"},zdom("i",{className:"msi-calendar"}),zdom("span",{className:"sum zmnTimer","zmn-time":f},g))))))},d.getSnoozeDismissButton=function(a){return zdom("div",{className:"SC_frt zmBdrBtn zmNotiBtn"},zdom("span",{"data-val":"Snooze"},a.snooze," ",zdom("i",{className:"msi-barrow"})),zdom("span",{"data-val":"Dismiss"},a.dismiss))},d.getAcceptDenyButton=function(a){return zdom("div",{className:"SC_frt zmBdrBtn zmNotiBtn"},zdom("span",{"data-val":"accept"},a.accept),zdom("span",{"data-val":"deny"},a.deny))},d.getSnoozeDropDown=function(){var a=c.text.snooze||{};return zdom("div",{className:"zmLst",style:e.height},zdom("div",{className:"zm_ddSnooze SC_bigHdr",style:e.none},zdom("div",{className:"zm_slideAni zm_slide1"},zdom("h3",null,a.label),zdom("ul",{className:"SC_Phr zm_snoozeLst"},zdom("li",{"data-val":"1"},zdom("i",{className:"msi-pro10 SC_pink zmDoubleIcon"}),a.textLabels.TEN_MINUTES),zdom("li",{"data-val":"2"},zdom("i",{className:"msi-pro30 SC_skyBlue zmDoubleIcon"}),a.textLabels.ONE_HOUR),zdom("li",{"data-val":"3"},zdom("i",{className:"msi-day SC_texasRose"}),a.textLabels.TOMORROW_MORNING),zdom("li",{"data-val":"4"},zdom("i",{className:"msi-week SC_caribGreen zmDoubleIcon"}),a.textLabels.NEXT_MONDAY),zdom("li",{id:"zm_cusView","data-val":"5"},zdom("i",{className:"msi-calendar SC_slateBlue zmDoubleIcon"}),a.textLabels.CUSTOM,zdom("i",{className:"msi-larrow"}))))),zdom("input",{type:"text",id:"snooze-date-picker",style:e.none}))},d.AccessRequest={getPopupRowItemDOM:function(a){var b=c.text.label.accept,d=a.name,e=a.id,f=a.imgUrl,g=c.text.label.deny;return zdom("div",{className:"zmTableTr js-list-item",id:e},zdom("div",{className:"zmTableTd"},zdom("i",{className:"msi-uncheck js-select"})),zdom("div",{className:"zmTableTd zmnoWrap"},zdom("div",{className:"SC_cs"},zdom("img",{src:f}),zdom("span",null,d))),zdom("div",{className:"zmTableTd zmnoWrap zmRightAlign"},zdom("div",{className:"zmBtn"},zdom("span",{className:"zmThmBtn js-btn-accept","data-val":"accept"},b),zdom("span",{className:"js-btn-deny","data-val":"deny"},g))))},getPopupDialogDOM:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=c.text.label.accept,d=[a.members,c.text.common.members,c.text.requestAccess.title].join(" "),f=c.text.label.deny;return zdom("div",{className:"SC_Pop SC_cent wht js-popui-container"},zdom("div",{className:"SC_pe SC_PopTop",style:e.top},zdom("div",{className:"SC_PU"},zdom("div",{className:"SCmb puClose"},zdom("ul",null,zdom("li",null,zdom("b",{className:"js-icon-selector","data-id":"closeIcon"},zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:"msi-close"})))))),zdom("div",{className:"SC_PUtt SC_PUtIco"},zdom("div",{className:"SC_flt"}),zdom("div",{className:"SC_frt"}),zdom("h3",{id:"isMem"},d),zdom("div",{className:"zmTableCss zmVAlignM zmReqTbl zmReqTblHdr"},zdom("div",{className:"zmTableTr "},zdom("div",{className:"zmTableTd"},zdom("i",{className:"msi-uncheck js-select-all"})),zdom("div",{className:"zmTableTd zmnoWrap "},zdom("div",{className:"zmBtn"},zdom("span",{className:"zmThmBtn js-selectall-accept","data-val":"accept"},b),zdom("span",{className:"js-selectall-deny","data-val":"deny"},f)))))),zdom("div",{className:"SC_PUcen",style:e.maxHeight},zdom("div",{className:"zmTableCss zmVAlignM zmReqTbl",id:"zmNotiDialogReqAccList"})))))},getMoreDOM:function(){var a=c.text.common.more+"...";return zdom("div",{className:"zmTableTr js-list-item js-more"},zdom("div",{className:"zmTableTd zmnoWrap"},zdom("span",{className:"SC_lnk js-more",id:"moreAccess"},a)))},getInlineListItemDOM:function(a){var b=a.imgUrl,d=a.id,e=c.text.label.accept,f=c.text.label.deny,g=a.name;return zdom("div",{className:"zmTableTr js-list-item js-inline",id:d},zdom("div",{className:"zmTableTd zmnoWrap"},zdom("div",{className:"SC_cs"},zdom("img",{src:b}),zdom("span",null,g))),zdom("div",{className:"zmTableTd zmnoWrap zmRightAlign"},zdom("div",{className:"zmBtn"},zdom("span",{className:"zmThmBtn js-btn-accept","data-val":"accept"},e),zdom("span",{className:"js-btn-deny","data-val":"deny"},f))))},getContainerDOM:function(a){var b=c.text.requestAccess.title,d=c.text.common.show,f=a.ctime,g=a.nid,h=a.timestamp,i=c.text.common.openInTab,j=a.members+" "+c.text.common.members;return zdom("div",{id:g},zdom("div",{className:"zmL"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmImg noBdr"},zdom("i",{className:"msi-group SC_thm"})),zdom("div",{className:"zmFrm"},zdom("span",null,zdom("b",{className:"js-members"},j)," ",b)),zdom("div",{className:"zmSub"},zdom("div",{className:"SC_frt zmBdrBtn zmNotiBtn",id:"multiAccept"},zdom("span",null,d," ",zdom("i",{className:"msi-barrow"}))),zdom("i",{className:"msi-status"}),zdom("span",{className:"sum zmnTimer","zmn-time":f},h),zdom("font",{"data-id":"openInTab",className:"SC_lnk"},i))))),zdom("div",{className:"zmNotiToggle",id:"zmNotiMultiAcceptDD",style:e.block},zdom("div",{className:"zmTableCss zmVAlignM zmReqTbl",id:"zmNotiReqAccInlineList"})))}},d.getActionButton=function(a){return zdom("div",{className:"SC_frt zmBdrBtn zmNotiBtn"},zdom("span",null,a))},d.emptyList=function(){return zdom("div",{className:"SC_nmsg"},c.text.common.noNotifications)},d.popout=function(a){return zdom("div",{id:a,className:"zmNotiPopUp zmShowO"})},d}),define([],function(a){var b,c,d,e,f,g,h,i=a("_zm"),j=a("zmText"),k=a("$"),l=a("zmail.Core.Namespaces").create("zmNCenter"),m={},n=l.utils,o=l.constants,p=[],q=0;return c=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a=a||{},g=a.info||{},n._req({u:"/biz/bizApi.do",param:{mode:"bannerMsg"},setHeader:!1,callback:{fn:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p=a,q=a.length||0,l.counter.increment(q)}}})},d={item:function(b){var c,d=(a("zmail.globalI18N")||{}).productName||l.constants.systemName;return c=["DIV",{attrs:{"class":"zmL sysNoti js-biz-noti"},child:[["DIV",{attrs:{"class":"zmLst"},child:[["DIV",{attrs:{"class":"zmDtl"},child:[["DIV",{attrs:{"class":"zmImg zmModeBG"},child:[["I",{attrs:{"class":"js-icon"}}]]}],["DIV",{attrs:{"class":"zmFrm"},child:[["SPAN",{child:[["text",d]]}]]}],["DIV",{attrs:{"class":"zmSub",style:"width: inherit"},child:[["SPAN",{attrs:{"class":"sum",style:"white-space: normal"},child:[["text",b]]}],["SPAN",{attrs:{style:"white-space: normal; display: block","class":"zmn-bactions"}}]]}]]}]]}]]}],i.getDOM(c)},action:function(a){var b,c=a.text,d=a.type;return b=["B"],"goto"===d&&(b=["SPAN",{attrs:{"class":"SC_lnk js-link-txt",style:"display:inline"},child:[["text",c]]}]),i.getDOM(b)}},f=function(a){for(var c=0;c<q;c++){var f=p[c],g=f.actions,h={icon:"msi-zohoMail zmDoubleIcon",background:"rgba(206,239,255,.25)",txt:""},i=d.item(b(f));switch(g&&Array.isArray(g)&&e(i,g),f.notificationState&&f.notificationState.toLowerCase()){case"danger":h.background="rgba(242, 217, 217, .25)",h.txt="#ff595c",h.icon="msi-fail zmDoubleIcon";break;case"safe":h.background="rgba(217, 246, 236, .25)",h.txt="#10bc83";break;case"warning":h.background="rgb(255, 139, 3, 0.15)",h.txt="#ff8b03",h.icon="msi-warning zmDoubleIcon"}f.notificationState&&(k(i).css("background-color",h.background),k(i).find(".js-link-txt").css("color",h.txt)),k(i).find(".js-icon").addClass(h.icon),a.appendChild(i)}},b=function(b){var c=b.type,d=(a("zmail.globalI18N")||{}).companyName||l.constants.companyName,e=(a("zmail.globalI18N")||{}).productName||l.constants.productName,f=k.extend({},b.placeholder,{companyName:d,planName:g.planName||"",productName:e}),h=[c,"OWNER","COMMON"].join("/");return h="notificationTypes."+h,j.get(o.moduleName,h,f)},e=function(a,b){b=b||[];for(var c=i(".","zmn-bactions",a)[0],e=document.createDocumentFragment(),f=0,g=b.length;f<g;f++){var j=b[f],k=d.action(j),l=j.uri,m=j.type;e.appendChild(k),f!==g-1&&e.appendChild(i.getDOM(["SPAN",{attrs:{"class":"SC_ldot"}}])),"goto"===m&&h(k,l)}c.appendChild(e)},h=function(a,b){i.bindReset(a,"click",function(a){window.open(a,"_blank")},[b])},m.getText=b,m.render=f,m.data=function(){return p},m.count=function(){return q},m.load=c,l.bizNotification=m,l}),define([],function(a){var b,c,d,e,f,g,h,i=a("zmail.Core.Namespaces").create("zmNCenter"),j=a("zmail"),k=i.utils,l=i.constants,m=!0,n=k._req,o=l.range||20;return c=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,p,q,r=0;return k={keys:[],values:{},hasNext:!0},a=function(a){for(var b=a>0?a:0,c=0,d=[],e=k.keys.length;c<e;c++)d.push(k.values[k.keys[b+c]]);return d},b=function(a){if(a)return k.values[a]},j=function(a,b){if(a&&k.keys.indexOf(a)>-1&&b){var c=k.values[a];for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return k.values[a]=c,c}},c=function(a){a=a||{};var b=a.nid,c=k.keys.indexOf(b);c>=0&&(k.keys.splice(c,1),delete k.values[b],r=r>0?r-1:r)},e=function(a,b){var c,e=a.nid;return k.keys.indexOf(e)<0?(k.keys.splice(b,0,e),k.values[e]=a,++r,c=a):c=d(a),c},l=function(a){return a&&k.values[a]},i=function(a){a=a||{};var b=a.nid,c=k.keys.indexOf(b);return k.values[b]=a,k.keys.splice(c,1),--r,k.keys.splice(r,0,b),++r,a},d=function(a){var b,c=a.nid;b=k.values[c];var d=k.keys.indexOf(c);if(!a.isWms)return i(a);b.nBy=b.nBy||[],b.nBy=b.nBy&&"string"==typeof b.nBy?$.parseJSON(b.nBy):b.nBy,a.nBy=a.nBy||[],a.nBy="string"==typeof a.nBy?$.parseJSON(a.nBy):a.nBy;var e=[];a.nBy.forEach(function(a,b){for(var c in a)a.hasOwnProperty(c)&&e.indexOf(c)===-1&&e.push(c)}),b.nBy=b.nBy.filter(function(a,b){var c;for(var d in a)if(a.hasOwnProperty(d)){c=d;break}return c&&e.indexOf(c)===-1}),b.nBy=a.nBy.concat(b.nBy),b.nby=b.nby&&"string"==typeof b.nby?b.nby.split(","):b.nby,a.nby=a.nby&&"string"==typeof a.nby?a.nby.split(","):a.nby||[],b.nby=b.nby.filter(function(b,c,d){return a.nby.indexOf(b)===-1});var f=b.ncount||b.nby.length;if(b.nby=a.nby.concat(b.nby),a.ncount=f===b.nby.length?0:a.ncount||1,b.ncount="undefined"!=typeof b.ncount?b.ncount+a.ncount:b.ncount||b.nby.length||1,b.commentuuid=b.commentuuid&&"string"==typeof b.commentuuid?b.commentuuid.split(","):b.commentuuid,a.commentuuid="string"==typeof a.commentuuid?a.commentuuid.split(","):a.commentuuid||[],b.commentuuid=a.commentuuid.concat(b.commentuuid),b.ctime=a.ctime||b.ctime,a.members){b.members=b.members||{};var g=Object.keys(a.members);
g.forEach(function(c,d,e){b[c]||(b.members[c]=a.members[c])})}return["ctimestr","owner","sysevent","unread","memberzuid"].forEach(function(c){b[c]=a[c]||b[c]}),k.values[c]=b,b.summary=a.summary||"",d>0&&(k.keys.splice(d,1),k.keys.splice(0,0,c)),b},f=function(a){var b=a.length;k.hasNext=b>o;for(var c in a){var d=a[c];e(d,r)}},g=function(a){return e(a,0)},p=function(a){return k.keys.length>(a?o:1)},q=function(){return k.hasNext},h=function(){k.keys=[],k.values={},k.hasNext=!0,r=0},m=function(){return(k.values[k.keys[r-1]]||{}).nid},n=function(){return r},{data:k,reset:h,get:a,getEntity:b,update:j,remove:c,merge:d,append:f,prepend:g,itemIndex:n,lastItem:m,hasData:p,hasNext:q,hasNid:l}}(),g=function(){var a,b,c,d,e=!1;return b=function(a){e=!0,d=k.showLoader(a)},c=function(){e=!1,d()},a=function(){return e},{inProgress:a,initiated:b,completed:c}}(),d=function(a){var b=a.callback,d=a.initialLoad;if(d){if(c.hasData(d))return b(c.get(0),a),!1;c.hasNext()||c.reset()}else if(!d&&!c.hasNext()||g.inProgress())return!1;g.initiated(a.listInstance.listWrapper);var f={},h=c.itemIndex();f.mode=l.params.mode,f.range=o,f.isPrev=!1,f.entityType=l.params.eType,f.startIndex=h,d&&h>0&&(a.addPrev=!0),n({param:f,callback:{fn:e,args:[b,a]},onerror:g.completed,onnetfailure:g.completed})},h=function(a){var b=[];return Array.isArray(a)&&(m||(m=!0),b=a),b},e=function(a,b){var d=h(a),e=b[0],f=b[1];c.append(d),f.addPrev&&(d=c.get(0)||[]),e(d,f),g.completed()},f=function(a){j.hasOwnProperty("ncount")?a(l.ncount):n({param:{mode:"count"},callback:{fn:function(a,b){c.count=a.count,b(c.count)},args:a}})},b={cache:c,count:f,get:d,getEntity:c.getEntity,update:c.update,put:c.prepend,hasNext:c.hasNext,hasNid:c.hasNid},i.dataStore=b,window.zmNCenter=i,i}),define([],function(a){function b(a){a=a||{};var b=this;return b.$el=g(a.$el),b.scopeName=a.scopeName,b.selClass=a.selClass,b.navClass=a.navClass,b.allowDefaultShortcutScope=a.allowDefaultShortcutScope||!1,b.type=a.type||"scope",b.groupName=a.groupName||"",b.onUpKeyPress=a.onUpKeyPress||l,b.onDownKeyPress=a.onDownKeyPress||l,b.onEscKeyPress=a.onEscKeyPress||l,b}function c(a){return a=a||{},new b(a)}function d(a){a=a||{};var c=new b(a);return c.bindEvents(),c}function e(a){a instanceof b&&a.unbindEvents()}var f=a("zmail.Core.Namespaces").create("zmNCenter"),g=a("$"),h=a("_"),i=a("zmComponent"),j={ESC:27,UP_ARROW:38,DOWN_ARROW:40},k=f.constants.css.list.keyboardSelClass,l=function(){return!0};return b.prototype.constructor=b,b.prototype.upArrowKeyHandler=h.debounce(function(a,b,c){var d=this;if(d.onUpKeyPress()){var e,f=d.$el.children(),g=d.$el.find("."+k).eq(0);e=f.first().is(g)||!g.length?f.first():g.prev(),e.length&&(e.addClass(k),e.children().first().addClass(d.navClass),e[0].scrollIntoView(!1),e[0].click()),g.is(e)||(g.removeClass(k),g.children().first().removeClass(d.navClass))}return d},300,!0),b.prototype.downArrowKeyHandler=h.debounce(function(a,b,c){var d=this;if(d.onDownKeyPress()){var e,f=d.$el.children(),g=d.$el.find("."+k).eq(0);e=f.last().is(g)?f.last():g.length?g.next():f.first(),e.length&&(e.addClass(k),e.children().first().addClass(d.navClass),e[0].scrollIntoView(!1),e[0].click()),g.removeClass(k),g.children().first().removeClass(d.navClass)}return d},300,!0),b.prototype.escKeyHandler=function(a,b,c){var d=this;if(c&&c.stopPropagation&&c.stopPropagation(),d.onEscKeyPress()){var e=d.$el.find("."+k).eq(0);e.children().first().removeClass(d.navClass).removeClass(d.selClass)}return d},b.prototype.keyHandler=function(a){var b=this;if(a)switch(a.keyCode){case j.ESC:b.escKeyHandler(void 0,void 0,a);break;case j.UP_ARROW:a.stopPropagation(),b.upArrowKeyHandler(void 0,void 0,a);break;case j.DOWN_ARROW:a.stopPropagation(),b.downArrowKeyHandler(void 0,void 0,a)}return b},b.prototype.rebindEvents=function(){var a=this;if("scope"===a.type){var b=i.keybindings.getScope();a.prevScope=b!==a.scopeName&&b!==f.constants.workSpaceName?b:a.prevScope,a.prevScope=a.prevScope===a.scopeName?"default":a.prevScope,i.keybindings.setScope(a.scopeName)}},b.prototype.getShortcuts=function(){var a=this;return a.upArrowKeyHandler=a.upArrowKeyHandler.bind(this),a.downArrowKeyHandler=a.downArrowKeyHandler.bind(this),a.escKeyHandler=a.escKeyHandler.bind(this),(f.utils.getDefaultShortcuts(["upArrow","downArrow","esc"])||[]).concat([{scope:a.scopeName,uid:"notificationUpArrowHandler",keyStr:"upArrow",group:a.groupName,actions:[a.upArrowKeyHandler],preventDefault:!0},{scope:a.scopeName,uid:"notificationDownArrowHandler",keyStr:"downArrow",group:a.groupName,actions:[a.downArrowKeyHandler],preventDefault:!0},{scope:a.scopeName,uid:"notificationEscHandler",keyStr:"esc",group:a.groupName,actions:[a.escKeyHandler],preventDefault:!0}])},b.prototype.bindEvents=function(){var a=this;return"scope"===a.type?(a.prevScope=i.keybindings.getScope(),a.isScopeAlreadyRegistered||(i.keybindings.registerAll({scope:a.scopeName,allowDefaultScope:a.allowDefaultShortcutScope,shortcuts:a.getShortcuts()}),a.isScopeAlreadyRegistered=!0),i.keybindings.setScope(a.scopeName)):(a.keyHandler=a.keyHandler.bind(a),g(document.body).off("keydown",a.keyHandler).on("keydown",a.keyHandler)),a},b.prototype.unbindEvents=function(){var a=this;return"scope"===a.type?(a.prevScope=a.prevScope||"default",i.keybindings.setScope(a.prevScope),i.keybindings.dropScope(a.scopeName)):g(document.body).off("keydown",a.keyHandler.bind(a)),a},f.KeyboardHandler={},f.KeyboardHandler.bind=d,f.KeyboardHandler.unbind=e,f.KeyboardHandler.setConfig=c,f.KeyboardHandler}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.features"),c=a("zmNCenter"),d=a("_zm"),e=a("zmail"),f=a("zmail.Framework.Utils.PUBSUB"),g=new f,h=a("$.subscribe"),i=function(a,b,d,f){c.utils._req({u:e.conPath+"/post.do",param:{mode:"accessRequest",groupId:a.groupId,entityId:a.entityId,entityType:a.entityType,actionType:a.actionType,requesterId:a.requesterId},callback:{fn:b,args:f},onerror:d})},j=function(a){return Array.isArray(a.nby)?a.nby:a.nby.split(",")},k=function(a,b){var c=j(a);return c=c.filter(function(a,c,d){return b!==a}),a.nby=Array.isArray(a.nby)?c:c.join(","),a.nBy=a.nBy.filter(function(a,c,d){return a.id!==b}),a},l=function(a){return function(b){b.stopPropagation(),a&&b.preventDefault()}},m=function(){var d,e;e=function(){var b,d,e,f,h,m,n,o,p,q,r,s,t,u,v,w,x;return u=function(a,b,d){var e=[a.nBy.length,c.text.common.members,c.text.requestAccess.title].join(" ");$(d).find("#isMem").text(e)},e=function(a,b,c){var d=j(a)||[],e=Object.keys(a.selectedMembers||{})||[];e.length===d.length?$(c).find(".js-select-all").removeClass("msi-uncheck").addClass("msi-check"):$(c).find(".js-select-all").removeClass("msi-check").addClass("msi-uncheck")},d=function(a,b){var d=c.utils.getUser(b,{nBy:a.nBy,ntype:a.ntype});return c.views.AccessRequest.getPopupRowItemDOM({name:d.fn,imgUrl:d.photo,id:b})},w=function(a,b,d){r(a,b,d),c.utils.dismissNotification(a,d,[a],function(b,e){a.hideAcceptButton=!0,b&&c.utils.removeNotification(d&&d[0]?d[0]:d,a)})},b=function(a){var b=$(document.createDocumentFragment()),c=j(a);return c.forEach(function(c,e,f){b.append(d(a,c))}),b},f=function(a,b,c){return function(d){d.stopPropagation();var f=$(d.target).closest(".js-select"),g=$(d.target).closest(".js-list-item").attr("id");a.selectedMembers=a.selectedMembers||{},f.hasClass("msi-check")?(f.removeClass("msi-check").addClass("msi-uncheck"),g&&delete a.selectedMembers[g]):(f.removeClass("msi-uncheck").addClass("msi-check"),g&&(a.selectedMembers[g]=!0)),e(a,b,c)}},h=function(a,b,c){return function(c){c.stopPropagation();var d=j(a),e=$(c.target).closest(".js-select-all");e.hasClass("msi-check")?(e.removeClass("msi-check").addClass("msi-uncheck"),a.selectedMembers={},b.find(".js-select").removeClass("msi-check").addClass("msi-uncheck")):(a.selectedMembers={},d.forEach(function(b,c,d){a.selectedMembers[b]=!0}),e.removeClass("msi-uncheck").addClass("msi-check"),b.find(".js-select").removeClass("msi-uncheck").addClass("msi-check"))}},m=function(b,c,d,e,f){var h=function(a){var f=$(d).find("#"+e);f.slideUp("slow","linear",function(){f.remove(),k(b,e);var a=j(b);a.length?(u(b,c,d),g.publish(String("/inline/ui/render/"+b.nid),b)):w(b,c,d)})},l=function(b){b="object"===("undefined"==typeof b?"undefined":babelHelpers["typeof"](b))?b[Object.keys(b)[0]]:b,(a("_zm")||{}).succErrMsg("e",String(b))};i({groupId:(b.group||{}).id,entityId:b.eid,entityType:b.etype,actionType:f,requesterId:e},h,l,[])},n=function(a,b,c){return function(d){d.stopPropagation();var e=$(d.target).closest(".js-list-item"),f=e.attr("id"),g="accept";m(a,b,c,f,g)}},o=function(a,b,c){return function(d){d.stopPropagation();var e=$(d.target).closest(".js-list-item"),f=e.attr("id"),g="deny";m(a,b,c,f,g)}},x=function(b,d,e,f){var h=function(a){b._allHandlerConfirmationInitiated=!0;var c=Object.keys(b.selectedMembers||{});c.forEach(function(a,c,d){k(b,a)});var f=j(b)||[];f.length?(t(b,d,e),g.publish(String("/inline/ui/render/"+b.nid),b)):w(b,d,e)},l=function(c){c="object"===("undefined"==typeof c?"undefined":babelHelpers["typeof"](c))?c[Object.keys(c)[0]]:c,(a("_zm")||{}).succErrMsg("e",String(c)),b._allHandlerConfirmationInitiated=!1};if(!b._allHandlerConfirmationInitiated){b._allHandlerConfirmationInitiated=!0,b.selectedMembers=b.selectedMembers||{};var m=Object.keys(b.selectedMembers)||j(b);m.length?i({groupId:(b.group||{}).id,entityId:b.eid,entityType:b.etype,actionType:f,requesterId:m},h,l,[b,d,e]):((a("_zm")||{}).succErrMsg("e",String(c.text.requestAccess.popup.noSelection)),b._allHandlerConfirmationInitiated=!1)}},p=function(a,b,c){return function(d){d.stopPropagation(),x(a,b,c,"accept")}},q=function(a,b,c){return function(d){d.stopPropagation(),x(a,b,c,"deny")}},r=function(a,b,c){return function(d){d.stopPropagation(),v(a,b,c),$(c).remove()}},s=function(a,b,c){c.off("mousedown mouseup click").on("mousedown mouseup click",l()),b.find(".js-select").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",f(a,b,c)),b.find(".js-btn-accept").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",n(a,b,c)),b.find(".js-btn-deny").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",o(a,b,c)),c.find(".js-select-all").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",h(a,b,c)),c.find(".js-selectall-accept").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",p(a,b,c)),c.find(".js-selectall-deny").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",q(a,b,c)),c.find(".js-icon-selector").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",r(a,b,c)),g._subscribeHandler(String("/popup/ui/rerender/"+a.nid),function(d,e){e.nid===a.nid&&t(a,b,c)})},v=function(a,b,c){b.find(".js-select").off("mousedown mouseup click"),b.find(".js-select-all").off("mousedown mouseup click"),$(c).find(".js-select-all").off("mousedown mouseup click"),$(c).find(".js-selectall-accept").off("mousedown mouseup click"),$(c).find(".js-selectall-deny").off("mousedown mouseup click"),$(c).find(".js-icon-selector").off("mousedown mouseup click"),g._unsubscribeHandler(String("/popup/ui/rerender/"+a.nid))},t=function(a,c,d){v(a,c,d),c.html(""),c.append(b(a)),s(a,c,$(d))},{render:function(a){var d=c.views.AccessRequest.getPopupDialogDOM({members:a.nBy.length}),e=$(d).find("#zmNotiDialogReqAccList");e.append(b(a)),s(a,e,$(d)),$(document.body).append(d)}}}(),d=function(){var d,f,m,n,o,p,q,r,s,t,u;return d=function(a,b){var d=c.utils.getUser(b,{nBy:a.nBy,ntype:a.ntype}),e=c.views.AccessRequest.getInlineListItemDOM({id:b,name:d.fn,imgUrl:d.photo});return e},f=function(a){for(var b=$(document.createDocumentFragment()),e=j(a),f=e.length>4,g=e.length<4?e.length:4,h=0;h<g;++h)b.append(d(a,e[h]));if(f){var i=c.views.AccessRequest.getMoreDOM();b.append(i)}return b},m=function(a,b,d){var e=j(a);$(d).find(".js-members").text(String(e.length+" "+c.text.common.members))},n=function(b,c,d,e,f){var g=function(a){var f=$(d).find("#"+e);f.slideUp("slow","linear",function(){k(b,e),t(b,c,d)})},h=function(b){b="object"===("undefined"==typeof b?"undefined":babelHelpers["typeof"](b))?b[Object.keys(b)[0]]:b,(a("_zm")||{}).succErrMsg("e",String(b))};i({groupId:(b.group||{}).id,entityId:b.eid,entityType:b.etype,actionType:f,requesterId:e},g,h,[])},o=function(a,b,c){return function(d){d.stopPropagation();var e=$(d.target).closest(".js-list-item").attr("id");n(a,b,c,e,"accept")}},p=function(a,b,c){return function(d){d.stopPropagation();var e=$(d.target).closest(".js-list-item").attr("id");n(a,b,c,e,"deny")}},q=function(a){return function(b){b.stopPropagation(),e.render(a)}},r=function(a,b,c){return function(a){a.stopPropagation(),b.parent().slideToggle()}},u=function(a,b,c){var d=b.find(".js-more"),e=$(c).find("#multiAccept");e.off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",r(a,b,e)),d.off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",q(a)),b.find(".js-btn-accept").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",o(a,b,c)),b.find(".js-btn-deny").off("mousedown mouseup").on("mousedown mouseup",l()).off("click").on("click",p(a,b,c)),g._subscribeHandler(String("/inline/ui/render/"+a.nid),function(d,e){a.nid===e.nid&&t(a,b,c)}),h("/zmncenter/accessRequest/rerender",function(d,e){a.nid===e.accessRequestID&&t(a,b,c)})},s=function(a,b,c){var d=b.find(".js-more");d.off("mousedown mouseup click"),b.find(".js-btn-accept").off("mousedown mouseup click"),b.find(".js-btn-deny").off("mousedown mouseup click"),g._unsubscribeHandler(String("/inline/ui/render/"+a.nid))},t=function(a,d,e){s(a,d,e);var g=j(a);g.length?1===g.length?(a.hideAcceptButton=!1,$(e).replaceWith(b.accessRequest(a,e))):(m(a,d,e),d.html(""),d.append(f(a)),u(a,d,$(e))):c.utils.dismissNotification(a,e,[a],function(b,d){b&&c.utils.removeNotification(e&&e[0]?e[0]:e,a)})},{render:function(a,b){b=c.views.AccessRequest.getContainerDOM({ctime:a.ctime,timestamp:c.utils.relativeTime(a.ctime),members:a.nBy.length,id:a.nid});var d=$(b).find("#zmNotiReqAccInlineList");return d.append(f(a)),u(a,d,$(b)),b}}}();var f=function(a,b){return d.render(a,b)};return f}(),n=function(){var b,e,f=!1;return b=function(b,d,e,g){g.stopPropagation();var h=$(g.target).closest("span[data-val]").data("val"),j=function(a){b.hideAcceptButton=!0,f=!1,c.utils.dismissNotification(b,d,[b],function(a,e){b.hideAcceptButton=!0,a&&c.utils.removeNotification(d&&d[0]?d[0]:d,b)})},k=function(b){b="object"===("undefined"==typeof b?"undefined":babelHelpers["typeof"](b))?b[Object.keys(b)[0]]:b,(a("_zm")||{}).succErrMsg("e",String(b)),f=!1};f||(f=!0,i({groupId:(b.group||{}).id,entityId:b.eid,entityType:b.etype,actionType:h,requesterId:Array.isArray(b.nby)?b.nby[0]:b.nby},j,k,[]))},e=function(a,e){e=c.formatter.notificationItem(a);var g;return f=!1,a.hideAcceptButton||(g=c.views.getAcceptDenyButton({accept:c.text.label.accept,deny:c.text.label.deny}),d.bind(g,"click",b,[a,e,j(a)]),d.before(d(".","zmSub",e)[0].childNodes[0],g)),e}}();return b.accessRequest=function(a,b){var c=j(a).length;return c>1?m(a,b):n(a,b)},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.features"),c=a("zmNCenter"),d=a("_zm"),e=a("zmail"),f=c.utils,g=c.views;return b.folderShare=function(){var a,b,h,i,j=!1;return h=function(a){return d.getProperty(a,"folder.confirmationkey")},i=function(a,b,c,d,g){f._req({u:e.conPath+"/confirm.do",param:{mode:"sharedFolder",key:c,ownerZuid:b,shId:a},callback:{fn:d,args:g}})},b=function(a,b){if(!j){j=!0;var c=b.shId,e=b.owner,f=h(b);i(c,e,f,function(a,c){if(j=!1,a){var e=c[0];d.remove(e),b.hideAcceptButton=!0}},[a,b])}},a=function(a,e){if(f.isNotificationOf.folderShare(a.ntype)){var i,j=h(a);j&&!a.hideAcceptButton&&(i=g.getActionButton(c.text.label.accept),d.bind(i,"click",b,[i,a]),d.before(e.childNodes[0],i))}}}(),b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter"),c=a("_zm"),d=a("zmail"),e=b.text,f=b.constants.allowedDesktopNotificationTypes||{},g=function(){var a=function(a){var b=f.streams,c=f.task,d=f.notes,e=f.mail;return b.indexOf(a)>-1||(e.indexOf(a)>-1||(c.indexOf(a)>-1||d.indexOf(a)>-1))},g=function(a){a=a||{};var c,d,f,g=a.nby,h=[],i=a.ncount,j=0,k=0,l=b.constants.formatter.showUsers,m=0,n={},o=[];for(g="string"==typeof g?[g]:g,j=g.length,d=0;d<j;d++)n.hasOwnProperty(g[d])||(n[g[d]]=!0,h.push(g[d]));for(j=h.length,m=i-l,f=j>l&&i>l&&m>0,k=f?l:j,d=0;d<k;d++)c=h[d],c=b.utils.getUser(c),h[d]=c,d>0&&o.push(","),o.push(b.formatter.formatSpecialUseCase(c.fn,{ntype:a.ntype}));if(f){var p=(f?m:g[l])+e.common.others;o=o.concat(p)}return o.push(" "),{txt:o,recent:h[0]}},h=function(a){a=a||{};var f,h=g(a),i=b.utils,j=b.formatter,k=[],l=a.etype,m=a.ntype,n=a.owner===d.zuid,o=a.shgroup||a.group,p="undefined"!=typeof o&&o.isGroup,q=h.count>1,r=i.isNotificationOf.folderShare(m),s=r?a.folder:void 0,t=i.isNotificationOf.memberRoleChange(m),u=i.isNotificationOf.newMemberAddition(m),v=i.isNotificationOf.inviteUser(m),w=i.isNotificationOf.addComment(m),x=i.isNotificationOf.taskUser(m),y=h.recent.g,z=h.recent.photo,A=i.getActionText(m,y,!n,q),B={entityName:i.getEntityName(l),groupName:p?o.name:""};if(u||t||v||w||x){var C=w?a.owner:a.memberzuid,D=C===d.zuid;B.memberName=D?e.common.you:i.getUser(C).fn}return r&&(B.entityAccess=c.getProperty(s,"role"),B.entityValue=c.getProperty(s,"fName")),t&&(B.memberRole=c.getProperty(a,"memberRole")||"moderator"),f=i.getSummaryText(q,a.summary),k=h.txt,k.push(j.formatActionText(A,B,!0)),k.push(f),{title:k.join(""),imgUrl:z,callback:function(){i.openNotificationInTab(a,!0)}}},i=function(b){b=b||{};var d={title:"",msg:"",imgUrl:"",callback:void 0};a(b.ntype)&&(d=h(b),c.pushDesktopNotification(d))};return{show:i}}();return b.DesktopNotifier=g,b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter.features"),c=a("zmail.Core.Namespaces").create("zmNCenter"),d=c.utils;return b.openInTab=function(a,b){var c=$(b).find('[data-id="openInTab"]').eq(0);return!d.isItemClickable(a)||d.isNotificationOf.notificationReminder(a.ntype)?void c.remove():void c.on("mousedown mouseup click",function(b){if(b){if(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),"click"===b.type||"mouseup"===b.type)return;d.openNotificationInTab(a)}})},b}),define([],function(a){var b=a("zmail.Core.Namespaces").create("zmNCenter"),c=a("zmail.Core.Namespaces"),d=c.create("zmNCenter.features"),e=b.constants,f=a("zmail"),g=b.utils,h=g._req,i=b.views,j=b.text,k=a("_zm");return d.snoozeOrDismissNotification=function(){var c,d,l,m,n,o,p,q=!1,r=function(a,b){var c=b.getDate();c=c<10?"0"+c:c;var d=b.getMonth()+1;d=d<10?"0"+d:d;var e=d+"/"+c+"/"+b.getFullYear(),f=a.split(":");return"PM"===f[2]&&(f[0]=parseInt(f[0]),f[0]=12===f[0]?f[0]:f[0]+12),f[0]=parseInt(f[0]),f[1]=parseInt(f[1]),f[0]=f[0]<10?"0"+f[0]:f[0],f[1]=f[1]<10?"0"+f[1]:f[1],f[2]="00",e+=" "+f.join(":")};return n=function(b,c,d){b=$(b).closest("LI");var h=c.eid,i=b.data("val"),k={};return"42"===c.ntype||42===c.ntype?(k.u=e.snoozeTaskReminderURI,k.param={streamsView:!0,entityType:3,taction:"snoozeReminder",actionType:"changeEntity",entityId:c.eid,mode:e.taskModes[String(i)],groupId:c.group&&c.group.id}):(k.u=e.snoozeMailReminderURI,k.param={mode:"watch",mymId:h,snoozeType:i}),k.callback={fn:function(b,e){if(j=j||a("zmNCenter.text"),b="object"===("undefined"==typeof b?"undefined":babelHelpers["typeof"](b))?b[Object.keys(b)[0]]:b){var h=b.split(" "),i=h[0].split("/");i[0]=j.month[String(parseInt(i[0]))]+", ",h[0]=i.join(" ");var k=h[1].split(":");if(!f.userOptions.isRailTime){var l;k[0]>=12?(k[0]=parseInt(k[0])-12,l=j.meridieum.PM):l=j.meridieum.AM,k[0]=0===parseInt(k[0])?12:k[0],k.pop(),h[1]=k.join(":")+" "+l}b=h.join(" "),(a("_zm")||{}).succErrMsg("s",String(j.snooze.success+" "+b)),g.removeNotification(d,c)}},args:[d,c]},k},l=function(c,d,g){var i,j,k,l=$(c).find("#snooze-date-picker").eq(0);a("zmail.extAppsDeferred.calendar.picker").done(function(){var e=a("zmUtil").getDateFromDateObj(a("zmUtil").getCurrentDateObj());a("ZEVENTS")(l[0]).picker("date",{dform:f.userDateFormat.toUpperCase(),wkst:0,mode:"popup",range:[e,""],update:"yes",minhgt:251,time:"bottom",fn:function(c){var d,e=$(g)[0].getBoundingClientRect(),f={};j=c,$(document.body).has(j).length||$(document.body).append(j),d=$(j)[0].getBoundingClientRect()||{},b.isTabOpen()?(f.left=e.left+e.width-d.width,f.left=f.left>0?f.left:-f.left):b.isPopoutOpen()?(f.left=e.left-d.width,f.left=f.left>0?f.left:-f.left):a("zmUtil").debugLog("[Tab / Popout] not in open state"),e.top+d.height>document.body.offsetHeight?f.top=document.body.offsetHeight-(d.height+e.height):f.top=e.top,$(j).css(f),b.isPickerVisible=!0},position:"left"}).on("ok",function(){var a=this.getDateObj(),e=n($(g)[0],d,c);if(i=r(a.selectTime,a.selectDate)){"42"===d.ntype||42===d.ntype?e.param.reminderDate=i:e.param.time=i;var f=e.callback.fn;e.callback.fn=function(a,b){a="object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))?a[Object.keys(a)[0]]:a,a&&f.apply(null,arguments)},h(e)}b.isPickerVisible=!1}).bind()}),k=function(){j&&$(j).remove(),b.isPickerVisible=!1},$.unsubscribe(e.pickerCloseEvent,k),$.subscribe(e.pickerCloseEvent,k)},m=function(a){var b=$(a).find("#snooze-date-picker").eq(0);b.on("click",function(a){a.stopImmediatePropagation()}),b.trigger("click")},o=function(a,b,c,d){if(!d||(d.stopPropagation(),!$(d.target).closest("#snooze-date-picker").length)){var f=$(d.target).closest("LI"),g=f.data("val"),i=n(f,c,a);return g===e.snoozeTypes.CUSTOM?void m(a):void(f.length&&h(i))}},p=function(a,b,c,d,e){e&&e.stopPropagation(),$(a).hasClass("shwInfo")?$(a).removeClass("shwInfo"):$(a).addClass("shwInfo"),$(b.children[0]).slideToggle()},d=function(a,b,c,d){d&&d.stopPropagation(),q||(q=!1,g.dismissNotification(c,a,[b,c],function(b,d){q=!1,b&&g.removeNotification(a,c)}))},c=function(b,c){if(j=j||a("zmNCenter.text"),g.isNotificationOf.notificationReminder(b.ntype)){var e,f,h,m;e=$(i.getSnoozeDismissButton({snooze:j.label.snooze,dismiss:j.label.dismiss}))[0],h=$(e).find('[data-val="Dismiss"]').eq(0)[0],f=$(e).find('[data-val="Snooze"]').eq(0)[0],m=$(i.getSnoozeDropDown())[0],k.bind(h,"click",d,[c,h,b]),k.bind(f,"click",p,[c,m,f,b]),k.before(k(".","zmSub",c)[0].childNodes[0],e),k.bind(m,"click",o,[c,m,b]),k.after(k(".","zmLst",c)[0],m),l(c,b,$(c).find("#zm_cusView").eq(0)[0])}}}(),d}),define([],function(a){var b=a("$"),c=a("zmail.Core.Namespaces").create("zmNCenter");c.wmsData=c.wmsData||[];var d,e,f,g,h,i,j,k,l,m,n=b(document.body),o=c.constants;return d=function(){j(),f(),g(),e()},j=function(){var a=c.text.common;l=b("#topBar .zmNotiIW"),k=k||b(c.views.notificationListContainer()),m=m||k.find("#zm-popout-icon"),b("#wmstoolbar").length?b("#wmstoolbar").before(k):n.append(k),k.find('[data-id="zm-notification-txt"]').text(a.title),l.attr("title",c.text.common.title)},f=function(){var d=function(d,e){if(e=e||{},!(d&&(b(d.target).closest(".zmNotiPopUp").length||!b(d.target).closest(".zmNotiHeader").length&&b(d.target).closest(k).length||b(d.target).closest(".zcal_cn").length||b(d.target).closest("#wmstoolbar").length)||c.isPickerVisible&&(b.publish(o.pickerCloseEvent),d&&"keydown"===d.type)||k.find(".zmNotiPopUp").eq(0).length&&(b.publish(o.removePreview.popout,{closePreviewCard:!0}),d&&"keydown"===d.type)||d&&b(d.target).closest(".zmNotiHeader").length)){var f=a("zmUtil");f&&"function"==typeof f.hideMenu&&!e.disableHideMenu&&f.hideMenu(!0),k.addClass("zmHideD"),l.removeClass("sel"),b.publish(o.topbarCloseEvent),c.popout.preview.destroy()}},e=function(c){if(c)if(c.stopPropagation(),k.hasClass("zmHideD")){var e=a("zmUtil");e&&"function"==typeof e.hideMenu&&e.hideMenu(!0),b.publish("mailsuite/searchClose"),k.removeClass("zmHideD"),l.addClass("sel"),b("#wmstoolbar").length&&b("#wmstoolbar").before(k),b.publish(o.topbarOpenEvent)}else d()},f=function(a){a&&27===a.which&&d(a)};n.off("mousedown").on("mousedown",d),l.off("mousedown",e).on("mousedown",e),n.off("keydown",f).on("keydown",f),m.off("mousedown").on("mousedown",function(){d(),c.tab()}),b.unsubscribe(o.closePopoutFromStreams,d),b.subscribe(o.closePopoutFromStreams,d),c.popout()},g=function(){b.subscribe(o.reconnect,e),a("zmComponent").notifier.addHandler("streams",h)},e=function(){c.counter(),c.utils.reconnect()},i=function(a){if(a=a||{},!c.utils.suppressNotification(a.ntype)){var d=a.refList&&a.refList.split(",")||[];if(c.utils.isNotificationOf.acceptOrDeny(a.ntype)&&(c.utils.updateAcceptOrDenyMembers(a),b.publish("/zmncenter/accessRequest/rerender",a)),c.utils.isNotificationOf.dismiss(a.ntype))c.dataStore.hasNid(a.nid)&&c.counter.decrement(),b.publish(o.removeNotification.tab,a),b.publish(o.removeNotification.popout,a);else if(c.utils.isNotificationOf.clearCount(a.ntype))c.counter.reset(!0);else if(c.utils.isNotificationOf.markRead(a.ntype))c.utils.markRead(a);else if(d.indexOf(zmail.zuid)>-1)return c.isPopoutOpen()||c.isTabOpen()||c.counter.increment(),!0}return!1},h=function(a,d){d=d||{};var e=d.data||{};i(e)&&(c.wmsData.push(e),c.utils.parseJSON(e),e.isWms=e.isWms||!0,e.unread=e.unread||!0,e=c.dataStore.put(e),c.DesktopNotifier.show(e),b.publish(o.newNotification.tab,e),b.publish(o.newNotification.popout,e))},c.core=d,c.onNewNotification=h,window.zmNCenter=c,c}),define([],function(a){var b,c,d,e,f,g=a("zmText"),h=a("_zm"),i=a("zmail.Core.Namespaces").create("zmNCenter"),j={},k=i.views||{},l=i.utils||{},m=i.constants.formatter,n=k.textWrapper,o=k.nameWrapper,p=i.text;return j.stringReplaceAll=e=function(a,b,c){return a=a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),b.replace(new RegExp(a,"gi"),c)},j.formatRebrandedText=b=function(b){var c=m.replacePatterns,d=(a("zmail.globalI18N")||{}).companyName||i.constants.companyName,f=(a("zmail.globalI18N")||{}).productName||i.constants.systemName;return b=e(c.companyName,b,d),b=e(c.productName,b,f)},j.formatActionText=c=function(a,c,d){c=c||{};var e,f=c.entityName,g=c.memberName,h=c.groupName,i=c.entityValue,j=c.entityAccess,k=c.memberRole,l=c.wallName,p=c.preposition?c.preposition+" ":"",q=m.replacePatterns,r=q.groupName,s=[];return a=a.replace(q.entityName,f),a=b(a),j&&(a=a.replace(q.entityAccess,j)),i&&(a=a.replace(q.entityValue,i)),g&&(a=a.replace(q.userName,g)),k&&(a=a.replace(q.memberRole,k)),l&&(a=a.replace(q.wallName,l)),a=a.replace(q.preposition,p),e=a.indexOf(r),e>-1?d?a=a.replace(q.groupName,h):(s.push(n(a.substring(0,e))),s.push(o(h)),s.push(n(a.substring(e+r.length)))):s.push(n(a)),d?a:s},j.formatSpecialUseCase=d=function(a,b){return b=b||{},i.utils.isNotificationOf.notificationReminder(b.ntype)?(g.get("notificationCenter","common")||{}).You:a},f=function(a,b,c){var e,f,g,h=[],i={},j=0,n=0,p=m.showUsers,q={},r=0,s=[];for(a="string"==typeof a?[a]:a,j=a.length,e=0;e<j;e++)q.hasOwnProperty(a[e])||(q[a[e]]=!0,s.push(a[e]));for(j=s.length,r=b-p,g=j>p&&b>p&&r>0,n=g?p:j,e=0;e<n;e++)f=s[e],f=l.getUser(f,c),s[e]=f,e>0&&h.push(k.nameSeparator),h.push(o(d(f.fn,c)));if(g){var t=k.andWrapper(g,g?r:a[p]);h=h.concat(t)}return i.recent=s[0],i.formatted=h,i.count=b,i},j.notificationItem=function(a){var b,d=[],e=a.etype,g=h.getProperty(i.text,"common.few_seconds_ago"),j=a.ctime,m=a.nby,o=a.ncount,q=a.ntype,r=a.owner===zmail.zuid,s=a.unread,t=a.shgroups&&Array.isArray(a.shgroups)&&a.shgroups[0]||a.group,u="undefined"!=typeof t&&t.isGroup,v=l.getActionIcon(q,e),w=f(m,o,{ntype:q,nBy:a.nBy}),x=w.recent.g,y=w.recent.photo,z=w.count>1,A=l.isNotificationOf.folderShare(q),B=A?a.folder:void 0,C=l.isNotificationOf.memberRoleChange(q),D=l.isNotificationOf.newMemberAddition(q),E=l.isNotificationOf.inviteUser(q),F=l.isNotificationOf.addComment(q),G=l.isNotificationOf.twitterConfig(q),H=l.isNotificationOf.taskUser(q),I=l.getActionText(q,x,!r,z),J={entityName:l.getEntityName(e),groupName:u?t.name:t.name+p.phrases.someoneHome,preposition:u?"":h.getProperty(i.text,"common.your"),wallName:u?t.name:h.getProperty(i.text,"common.streams")},K=F?a.owner:a.memberzuid,L=K===zmail.zuid;if((D||C||E||F||H)&&(J.memberName=L?p.common.you:l.getUser(K).fn,J.memberName=F?J.memberName||a.ownerName:J.memberName,E&&a.members)){var M=Object.keys(a.members);J.memberName=M[0]===zmail.zuid?p.common.you:a.members[M[0]],M.length>=2&&(J.memberName+=", "+(M[1]===zmail.zuid?p.common.you:a.members[M[1]])),M.length>=3&&(J.memberName+=" "+p.common.and+" "+(M.length-2)+" "+p.common.others)}return A&&(J.entityAccess=h.getProperty(B,"role"),J.entityValue=h.getProperty(B,"fName")),G&&(J.handleName=w.recent.fn),l.isNotificationOf.updateEventStatus(q)&&(J.groupName=t.name,K===zmail.zuid?J.groupName=p.phrases.selfHome:u||(J.groupName+=p.phrases.someoneHome)),C&&(J.memberRole=h.getProperty(a,"folder.role")||"moderator"),d=w.formatted,b=l.getSummaryText(z,a.summary),d.push(n(" ")),d=d.concat(c(I,J)),b.forEach(function(a,b,c){d.push(a)}),h.getProperty(a,"ctime")&&(g=l.relativeTime(a.ctime)),k.notificationItem({photo:y,framedText:d,actionIcon:v,timestamp:g,ctime:j,unread:s,openInTab:p.common.openInTab})},j.eventNotificationItem=function(a){var b=Array.isArray(a.summary)?a.summary[0]:a.summary;return a._eventData="string"==typeof b?$.parseJSON(b):b,b=a._eventData,b.remTime=this.eventTimeRemaining("0"===String(b.remType)?"start":"end",b.remTime),k.eventNotificationItem(a)},j.eventTimeRemaining=function(a,b){var c=p.eventNotification.timeRemaining,d=l.eventTimeRemaining(a,b),e=d.unit,f=d.value;return g.applyArgs(c[e][a],{value:f})},i.formatter=j,window.zmNCenter=i,i}),define([],function(a){var b,c=a("_zm"),d=a("$"),e=a("zmail"),f=a("zmail.Core.Namespaces").create("zmNCenter"),g=f.constants,h=f.utils,i=f.views,j=f.features,k=f.formatter,l=f.dataStore;return b=function(b){var m,n,o,p,q,r,s=this;this.listWrapper=b.parent,this.onPagination=b.onPagination,this.whenSelected=b.whenSelected,this.onReselect=b.onReselect,this.lastSelectedObj={},this.objToElMap={},q=function(a,b,e,f){var h=g.css.list.selection,i=c(".",h,a.parentNode)[0];f&&"function"==typeof f.stopPropagation&&f.stopPropagation(),c.removeClass(i,h),d(a.parentNode).find("."+g.css.list.keyboardSelClass).removeClass(g.css.list.keyboardSelClass),d(a).addClass(g.css.list.keyboardSelClass),d(a.childNodes[0]).hasClass(g.css.unread)&&(d(a.childNodes[0]).removeClass(g.css.unread),b.unread=!1),c.addClass(a.childNodes[0]||a,h),s.lastSelectedObj.nid===b.nid?e.onReselect(a,b):(s.lastSelectedObj=b,e.whenSelected(a,b))},o=function(a){return a=a||{},a.nid},p=function(a,b){var c,e,f=b.listWrapper.children,g=f.length,h=o(a),i=s.objToElMap[h];if(i)return i;for(c=0;c<g;++c)if(e=d(f[c]).data("zmsData")||{},h===e.nid)return a.nid=h||e.nid,f[c]},n=function(b,g){if(!h.isItemViewable(g))return!1;var l;if(h.isEventNotification(g)?l=k.eventNotificationItem(g):e.isInternalOrgUser&&h.isNotificationOf.accessRequest(g.ntype)?l=j.accessRequest(g):(l=k.notificationItem(g),j.folderShare(g,c(".","zmSub",l)[0]),j.snoozeOrDismissNotification(g,l)),l){if(h.isItemClickable(g)){if(d(l).off("click").on("click",q.bind(null,l,g,b)),h.isEventNotification(g)){var m=d(i.getActionButton(a("zmNCenter.text").label.dismiss));d(l).find(".zmSub").prepend(m),m.off("mousedown").on("mousedown",function(a){a.stopPropagation(),h.dismissNotification(g,l,[],function(a){a&&h.removeNotification(l,g)})}),m.off("mouseup").on("mouseup",function(a){a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation()}),m.off("click").on("click",function(a){a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation()})}}else c.addClass(l.childNodes[0],"noPreview"),c.removeClass(l.childNodes[0]||l,f.constants.css.unread);!e.showFeature&&d(l).find("."+f.constants.css.unread).length&&d(l).find("."+f.constants.css.unread).removeClass(f.constants.css.unread),j.openInTab(g,l),l.id=g.nid,s.objToElMap[g.nid]=l}return d(l).data("zmsData",g),l},this.addItem=function(a,b,e){c.remove(c(".","SC_nmsg",e.listWrapper)[0]);var f=p(b,e);f&&d(f).remove();var h=n(e,b);if(h){if(e.listWrapper.hasChildNodes()){var i=d(e.listWrapper).find(".js-biz-noti");i.length?i.last().after(h):c.before(e.listWrapper.firstChild,h);
}else e.listWrapper.appendChild(h);b.isWms&&b.unread&&d(h).children().first().addClass(g.css.unread)}},this.removeItem=function(a,b,c){b=b||{};var e=p(b,c),g=d(e).attr("id");g&&"undefined"!=typeof s.objToElMap[g]&&delete s.objToElMap[g],d(e).slideUp("slow","linear",function(){setTimeout(function(){d(e).remove()},300)}),f.dataStore.cache.remove(b)},this.removeUnread=function(a,b,c){b=b||{};var e=p(b,c);d(e).find("."+f.constants.css.unread).removeClass(f.constants.css.unread)},r=function(a,b){for(var c,d=0,e=a.length,f=document.createDocumentFragment(),g=b.listInstance;d<e;d++){c=a[d],c.isMail="4"===c.ntype,c.isDeleted="34"===c.ntype;var h=n(g,c);h&&f.appendChild(h)}g.listWrapper.appendChild(f),g.emptyList()},m=function(a){l.hasNext()&&(a.loadList(),"undefined"!=typeof onPagination&&a.onPagination())},this.emptyList=function(){this.listWrapper.hasChildNodes()||(this.listWrapper.innerHTML="",s.objToElMap={},this.listWrapper.appendChild(f.views.emptyList()),d(".zmNotiSall").hide())},this.reset=function(){this.listWrapper.innerHTML="",s.objToElMap={},h.updateTime.stop(this.timerUpdate)},this.loadList=function(a){var b=this,c=h.showLoader(b.listWrapper);e.ContactBook.fetchProcess.done(function(){c(),d(b.listWrapper).find(".SC_sld").remove(),l.get({callback:r,listInstance:b,initialLoad:a})})},this.init=function(){this.reset(),this.timerUpdate=h.updateTime.start(this.listWrapper),f.bizNotification.render(this.listWrapper),this.loadList(!0),h.paginate(this,this.listWrapper,m)},this.init()},f.list=b,window.zmNCenter=f,f}),define([],function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=a("$"),o=a("_zm"),p=a("zmail.Core.Namespaces").create("zmNCenter"),q=!1,r={},s=p.constants;return b=function(){var a=function(){q||(q=!0,p.counter.reset(),d())};n.subscribe(s.topbarOpenEvent,function(b){b.stopPropagation(),a()}),n.subscribe(s.topbarCloseEvent,function(a){q&&(q=!1,f())}),e=o("#",s.popoutId)},f=function(){n.unsubscribe(s.newNotification.popout,c.addItem),c&&(c.reset(),g&&p.KeyboardHandler.unbind(g)),delete p.popout.list},d=function(){c=new p.list({parent:e,onReselect:k,whenSelected:function(a,b){p.popout.preview({fromElement:e,data:b}),r=b},onPagination:function(){}}),p.popout.list=c,g=p.KeyboardHandler.bind({scopeName:"notification-popout",$el:c.listWrapper,navClass:s.css.list.selection,selClass:s.css.list.selection,allowDefaultShortcutScope:!1,onEscKeyPress:k}),n.unsubscribe(s.newNotification.popout),n.unsubscribe(s.removeNotification.popout),n.unsubscribe(s.removeUnread.popout),n.unsubscribe(s.removePreview.popout),n.subscribe(s.newNotification.popout,h),n.subscribe(s.removeNotification.popout,i),n.subscribe(s.removeUnread.popout,m),n.subscribe(s.removePreview.popout,l)},h=function(b,d){d=d||{},q&&d.isWms&&a("zmail").windowVisibility&&p.counter.reset(),c.addItem(b,d,c)},i=function(a,b){c.removeItem(a,b,c)},m=function(a,b){c.removeUnread(a,b,c)},k=function(){return n("#zmncpreview").length||n.publish(s.closePopoutFromStreams),p.popout.preview.destroy(),c.lastSelectedObj={},r={},n(c.listWrapper).find("."+s.css.list.selection).removeClass(s.css.list.selection),!0},l=function(a,b){b=b||{},(r.nid===b.nid||b.closePreviewCard)&&k()},j=function(){return q},p.popout=b,p.isPopoutOpen=j,p}),define([],function(a){var b=a("$"),c=a("_zm"),d=a("zmail.Core.Namespaces").create("zmNCenter");d.popout=d.popout||{};var e,f,g,h,i,j,k=d.constants;return e=function(a){var b=a.data;g(),d.utils.loadPreview({data:b,previewElm:f,fixedComment:!0})},e.destroy=function(){f&&(b.publish(k.removePopoutPreview,[{element:f,from:"popout"}]),c.remove(f),i(),f=void 0)},g=function(){return f&&e.destroy(),f=d.views.popout(k.popoutElmId),b("#zm-notifications-popover").append(f),h(),f},j=function(a){b.publish(k.stopEvents),a&&"function"==typeof a.stopImmediatePropagation&&a.stopImmediatePropagation(),c.stopEvents(a,!0)},h=function(){c.bind(f,"mousedown",j),c.bind(f,"mouseup",j)},i=function(){f&&(c.unbind(f,"mousedown",j),c.unbind(f,"mouseup",j),c.unbind(f,"click",j))},d.popout.preview=e,d}),define([],function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=a("$"),q=a("_zm"),r=a("zmail.Core.Namespaces").create("zmNCenter"),s={},t=r.text,u=r.constants;return b=function(){h=r.KeyboardHandler.setConfig({scopeName:u.workSpaceName,selClass:u.css.list.selection,navClass:u.css.list.selection,allowDefaultShortcutScope:!1,onEscKeyPress:function(){return m({fromKeyboardListener:!0}),!0}});var b=r.utils.workspace({name:u.workSpaceName,appConfig:{appname:t.common.title,appId:u.workSpaceName,data:{CNodes:"3"},appIcon:u.css.tabIcon,hashKey:"notifications",hashChangeHandler:function(b,c){var d=this;a("zmUtil").debugLog("Notifications hash-url changed",c,d)},onDelete:function(a){var b=g.getNodes()[1].getDOMNode()[0];return p.publish(u.removePopoutPreview,[{element:b,from:"tab"}]),!0},shortcuts:h.getShortcuts(),allowDefaultShortcutScope:!1},destroy:function(){d()},listingClick:function(){},closePreview:function(a){p.publish(u.removePopoutPreview,[{element:a.$el[0],from:"tab"}]),s={},c.lastSelectedObj={},a.close()}});f=b.listArea,q.addClass(f,u.css.workSpaceClass),g=b.previewCard,e()},e=function(){c=new r.list({parent:f,onReselect:m,whenSelected:function(a,b){var c,d="59"!==String(b.ntype);s=b,d&&(g.getNodes()[0].headerArr.text=[],g.show(),c=g.getNodes()[1].getDOMNode()[0],p.publish(u.removePopoutPreview,[{element:c,from:"tab"}])),r.utils.loadPreview({data:b,previewElm:d?c:null,fixedComment:!1,openType:"preview"})},range:15}),r.tab.list=c,h.$el=p(r.tab.list.listWrapper),p.unsubscribe(u.newNotification.tab,i),p.unsubscribe(u.removeNotification.tab,j),p.unsubscribe(u.removeUnread.tab,o),p.unsubscribe(u.removePreview.tab,n),p.subscribe(u.newNotification.tab,i),p.subscribe(u.removeNotification.tab,j),p.subscribe(u.removeUnread.tab,o),p.subscribe(u.removePreview.tab,n)},i=function(b,d){d=d||{},l()&&d.isWms&&a("zmail").windowVisibility&&r.counter.reset(),c.addItem(b,d,c)},j=function(a,b){c.removeItem(a,b,c)},o=function(a,b){c.removeUnread(a,b,c)},m=function(a){p("#zmncpreview").length||p.publish(u.closePopoutFromStreams),g&&(p.publish(u.removePopoutPreview,[{element:g.$el[0],from:"tab"}]),g.close(),s={},c.lastSelectedObj={})},n=function(a,b){b=b||{},b.nid===s.nid&&m()},d=function(){g&&g.close(),p.unsubscribe(u.newNotification.tab,i),p.unsubscribe(u.removeNotification.tab,j),p.unsubscribe(u.removeUnread.tab,o),p.unsubscribe(u.removePreview.tab,n),c&&c.reset(),s={},h&&r.KeyboardHandler.unbind(h),h=void 0,delete r.tab.list},l=function(){var b=a("zmTab");return c&&c.listWrapper&&b.currentTab===u.workSpaceName},k=function(){p(c.listWrapper).find("."+u.css.list.selection).removeClass(u.css.list.selection)},r.tab=b,r.isTabOpen=l,r.removeSelectionInTab=k,r});
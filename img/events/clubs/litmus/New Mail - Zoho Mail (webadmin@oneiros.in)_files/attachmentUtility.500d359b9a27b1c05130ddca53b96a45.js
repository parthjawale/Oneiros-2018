"use strict";!function(a){var b=zmText.get("attachmentUtility");return a.templates=a.templates||{},$.extend(a.templates,{leftHeader:function(a,b){var c=zdom("b",{id:a},b);return c.outerHTML},filterDropDwon:function(){var a=b.filterMenu;return zdom("div",{className:"zmFilterDD zm_attFltr"},zdom("div",{className:"zmAttFilter"},zdom("div",{className:"SC_floatLabelRow fLCol4"},zdom("div",{className:"SC_floatLabel placeholder zmNoBdr"},zdom("div",{className:"zmSelect"},zdom("span",{id:"zmAttGrp"})),zdom("label",null,a.group)),zdom("div",{className:"SC_floatLabel placeholder zmNoBdr"},zdom("div",{className:"zmSelect"},zdom("span",{id:"zmAttEntity"})),zdom("label",null,a.attFrom)),zdom("div",{className:"SC_floatLabel placeholder zmNoBdr"},zdom("div",{className:"zmSelect"},zdom("span",{id:"zmAttFilTyp"})),zdom("label",null,a.attType)),zdom("div",{className:"SC_floatLabel placeholder zmNoBdr"},zdom("div",{className:"zmSelect"},zdom("span",{id:"zmAttLbl"})),zdom("label",null,a.tags))),zdom("div",{className:"SC_PUbtm SC_tranbdr"},zdom("span",{id:"attFilter",className:"sel"},a.filter),zdom("span",{id:"filterCncl","data-val":"Cancel"},a.cancel))))},cloudFrame:function(a){return zdom("iframe",{src:a,frameBorder:"0",id:"cloudIframe",style:{height:"100%",width:"100%"}})},favIcon:function(a){var c="msi-fav",d=b.UserMsg.fav;return a&&(c+=" SC_fav",d=b.UserMsg.remFav),zdom("i",{className:c,"data-tooltip":d,"data-tooltip-pos":"bottom"})},zmFdrBox:function(a,c,d){var e=b.UserMsg,f=[];return d!==zmAttachUtility.fileType.hugeAttachment&&f.push(zdom("i",{className:a,"data-tooltip":c,"data-tooltip-pos":"bottom"})),zdom("div",{className:"zmFdr"},zdom("span",null,f,zdom("i",{className:"msi-send","data-tooltip":e.attachToNewMail,"data-tooltip-pos":"bottom"}),zdom("i",{className:"msi-download","data-tooltip":e.download,"data-tooltip-pos":"bottom"}),zdom("i",{className:"msi-action","data-tooltip":e.more,"data-tooltip-pos":"bottom"})))},divZmFrm:function(a){return zdom("div",{className:"zmFrm"},zdom("span",{id:"thumbView","data-tooltip":a,"data-tooltip-pos":"bottom"},zmUtil.getSubString(17,a)),zdom("span",{id:"listView","data-tooltip":a,"data-tooltip-pos":"bottom"},zmUtil.getSubString(40,a)))},attListingTemplate:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return zdom("div",{className:"zmL SC_Pbar",title:a.name},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmSze"},zdom("span",{className:"sum"},a.size)),zdom("div",{className:"zmSub"},zdom("span",{"data-name":"rename"},b.UserMsg.rename),zdom("span",{"data-name":"download"},b.UserMsg.download),zdom("i",{className:"msi-action","data-tooltip":b.UserMsg.more,"data-name":"showMore"})),zdom("div",{className:"zmFrm"},zdom("span",{"data-name":"filename"},zmUtil.getSubString(20,a.name))),zdom("div",{className:"zmImg"},a.image),zdom("div",{className:"SC_icn"},zdom("i",{className:"msi-close"})))))},attPrevInr:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=zmUtil.fileTyp(a.fn,a.attType);return a.thn?zdom("img",{src:a.thn}):zdom("i",{className:b[1]+" zm-attIcn"})},prevTopDom:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return zdom("div",{id:"zmPhdAtt",className:"SC_ptit"},zdom("div",{className:"SCmb SC_frt"},zdom("ul",null,zdom("li",null,zdom("b",{className:"SC_nrr"},zdom("i",{className:"msi-prev"}))),zdom("li",null,zdom("b",{className:"SC_nlr"},zdom("div",{className:"SC_hd"}),zdom("i",{className:"msi-next"})))),zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-close"}))))),zdom("div",{className:"SC_phd",title:a},zmUtil.getSubString(40,a)))},prevMainDom:function(a,c){var d=b.UserMsg.addLabel;return zdom("div",{className:"SC_Twpr"},zdom("div",{className:"SC_pct zmAvi"},zdom("div",{id:"zmHdrAtt",className:"zmPHdr zmAPHdr"},zdom("div",{className:"zmPT"},zdom("div",{className:"zmpr"},zdom("div",{className:"SCmb SC_frt"},zdom("ul",null,zdom("li",null,zdom("b",null,zdom("i",{className:"msi-action"}),zdom("div",{className:"SC_hd"}))))),zdom("ul",{className:"SC_pvul"},zdom("li",null,a,zdom("div",null,zdom("span",{className:"sum"},c),zdom("div",{className:"SC_ldot zm_lbl"},zdom("i",{title:d,className:"msi-label zmAttLabelDrp"}),zdom("i",{title:d,className:"msi-plus zmAttLabelDrp SC_dyn"})))))))),zdom("div",null,zdom("div",{id:"zmPCAtt",className:"zmPCon"},zdom("div",{className:"zmPCnt"},zdom("div",null,zdom("div",{id:"msprevAttSrc",className:"zmAsrc"}))))),zdom("div",{className:"zmAtg"})))},loadingTemplate:function(){return zdom("div",{className:"At_load"},zdom("div",{className:"AT_lcntr Atlcr1"},zdom("div",{className:"Atcle1"}),zdom("div",{className:"Atcle2"}),zdom("div",{className:"Atcle3"}),zdom("div",{className:"Atcle4"})),zdom("div",{className:"AT_lcntr Atlcr2"},zdom("div",{className:"Atcle1"}),zdom("div",{className:"Atcle2"}),zdom("div",{className:"Atcle3"}),zdom("div",{className:"Atcle4"})),zdom("div",{className:"AT_lcntr Atlcr3"},zdom("div",{className:"Atcle1"}),zdom("div",{className:"Atcle2"}),zdom("div",{className:"Atcle3"}),zdom("div",{className:"Atcle4"})))},centerAlignBox:function(){return zdom("div",{className:"SC_Ialn"})},attachemntFileTypeIcon:function(a){return zdom("i",{className:a+" SC_vbig"})},attPreviewMsg:function(a){return zdom("div",{className:"txt"},a,zdom("font",{className:"SC_lnk"},b.common.downloadMsg))},attSelectedMsgContainer:function(){return zdom("ul",{className:"SC_ldot SC_itmSel"},zdom("li",null,zdom("strong",null)))},attDownloadContainer:function(){return zdom("ul",{className:"SC_ldot SC_itmSel",style:{display:"block"}},zdom("li",{className:"SC_thm SC_attDwnZip cursorPointer"},b.common.downloadAll))},attAddToContainer:function(){return zdom("ul",{className:"SC_ldot SC_itmSel",style:{display:"block"}},zdom("li",{className:"SC_attAttachTo SC_thm cursorPointer"},b.common.addTo,zdom("i",{className:"msi-rarrow",style:{verticalAlign:"middle"}})))},retryTemplate:function(){return zdom("div",{className:"zm_retMsg SC_nmsg"},zdom("p",null,zdom("i",{className:"msi-mailFail"}),b.common.errorMsg+" ",zdom("font",null,b.common.retry)))}},!0),a}(window.zmAttachment=window.zmAttachment||{}),function(){function a(a){this.appName=a.appName,this.$topEl=a.headerElem,this.$el=a.listElem,this.widthConst=a.thumbWidth,this.onFilterAction=a.onFilterAction,this.dType=a.dType||"t",this.viewType=a.viewType,this.groupId=a.groupId||zmail.zuid,this.entity=a.entity||"all",this.onScroll=a.onScroll,this.requireParams=a.requireParams,this.selectElm=a.selectElm,this.start=1,this.fileType=0,this.showNxt=void 0,this.showNxt101=0,this.showNxt102=0,this.showNxt103=0,this.showNxt104=0,this.showNxt105=0,this.isnew="y",this.attDet={},this.attArrObj={},this.selectedAttachment=[];for(var b=0,c=h.length;b<c;b++)this.attArrObj[h[b]]={showNxt:0,list:[]};this.prvFltr={lblId:" ",mthd:" "},this.fileTypeShowAll={101:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},102:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},103:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},104:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},105:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1}},this.isDone=!0,this.initView=!1,this.thumbCount=0,this.presentView="t"+zmail.zuid+"all0 ",a.cache&&(this.cachingEnabled=a.cache,this.cache={flush:u.flush,flushExcept:u.flushExcept}),"function"==typeof a.onListingUpdate&&(this.onListingUpdate=a.onListingUpdate)}var b=zmail.Core.Namespaces.create("zmAttachUtility"),c=zmText.get("attachmentUtility"),d="zmlightboxplugin",e=c.openEntity,f={1:e.email,2:e.note,3:e.task,4:e.event,6:e.status,10:e.link},g={1:"msi-mail",2:"msi-notes",3:"msi-task",4:"msi-calendar",6:"msi-status",10:"msi-links"},h=["0","101","102","103","104","105"],i={all:0,m:1,n:2,t:3,c:4,p:6,l:10,h:11},j=zmUtil.isHugeAttachmentUploadEnabled()?{htm:c.entityType.h,data:{type:"entList",action:"h"}}:"",k=[{htm:c.fType[101],data:{type:"attList",action:101}},{htm:c.fType[102],data:{type:"attList",action:102}},{htm:c.fType[103],data:{type:"attList",action:103}},{htm:c.fType[104],data:{type:"attList",action:104}},{htm:c.fType[105],data:{type:"attList",action:105}},{htm:c.fType[0],data:{type:"attList",action:""}}],l=[{htm:c.entityType.m,data:{type:"entList",action:"m"}},{htm:c.entityType.p,data:{type:"entList",action:"p"}},{htm:c.entityType.n,data:{type:"entList",action:"n"}},{htm:c.entityType.t,data:{type:"entList",action:"t"}},{htm:c.entityType.c,data:{type:"entList",action:"c"}},{htm:c.entityType.l,data:{type:"entList",action:"l"}},j,{htm:c.entityType[0],data:{type:"entList",action:"all"}}],m=[],n=[{htm:c.prevMenu.lstAttSender,data:{type:"attList",action:1}},{htm:c.prevMenu.lstAttType,data:{type:"attList",action:2}}],o={txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,html:!0,htm:!0,xml:!0,go:!0,eml:!0,sh:!0,bat:!0,log:!0,msg:!0},p={xml:!0,js:!0,css:!0},q={},r={};r.getFilterDropTemplate=function(){return zmAttachment.templates.filterDropDwon},q.isRestrictedIE=function(){return zmUtil.isIE()&&"Microsoft Internet Explorer"===window.navigator.appName},q.isDocsCompAllowed=function(){return!q.isRestrictedIE()},q.showSuccErrMsg=function(a,b){"error"===a?_zm.succErrMsg("e",b[a]):_zm.succErrMsg("s",b[a])},q.addEventsToCal=function(a){var b={groupId:a.gId,entityId:a.e,attachId:a.Id,entityType:a.et},d=c.SuccErrMsg;1===a.et&&(b.partId=a.p),a.shId&&(b.shId=a.shId),a.type?(2===a.et?b.streamsView="Notes":b.streamsView="true",b.actionType=a.type):b.accId=zmail.accId,zmAjq.XHR({u:zmail.conPath+"/OpenDocument",t:"POST",fn:function(a){q.showSuccErrMsg(a.msg,{added:d.Event_Added,exist:d.Event_Updated,error:d.Event_Error})},p:b,ep:{}})},q.parseToNumber=function(a){return window.Number(a)},q.parseToInteger=function(a,b){return b=b||10,window.parseInt(a,b)},q.uploadToCloud=function(){function a(a,b){var c,d,e=a.$el.find("#zmAddCloud"),f=zmComponent.loadingBand({container:e[0],type:"pagination"}),g=location.protocol+"//"+window.location.hostname,h=g,i=g,j=encodeURIComponent(b.fn),l=b.e+"_"+b.Id,m=g+zmail.conPath+"/jsp/cloudUploader.jsp?m="+l;if(zmail.fromOtherService&&document.referrer){var n=document.referrer.split("/"),o=n[0]+"//"+n[2];h=o+","+g}var p=[],q=zmail.IntegrationStatus;_zm.isCloudServiceIntegEnabled&&q?(q.gDrive&&p.push("gdrive"),q.dropBox&&p.push("dropbox"),q.oneDrive&&p.push("skydrive"),q.box&&p.push("box"),p.length&&(p=p.join(","))):p="gdrive,dropbox,skydrive,box",m=encodeURIComponent(m),c=zmail.urls.gadURL+"/CloudUploader?sources="+p+"&fileName="+j+"&purpose=mailView&zservice=zmail",c+="&disableSync="+p+"&serURL="+m+"&frameorigin="+h+"&originUrl="+i,d=$(zmAttachment.templates.cloudFrame(c)),k=b,d.on("load",function(){f()}),e.append(d)}function b(a,b){var d=c.SuccErrMsg;a.result="dropbox"===b.source?"success":a.result,q.showSuccErrMsg(a.result,{success:d.Docs_Uploaded,error:d.Docs_Error})}function d(a,b){var c,d,e=a.$el.find("#zmAddZDocs");"undefined"!=typeof G_ADDDOCS_OBJ&&(G_ADDDOCS_OBJ.folderid=-1,G_ADDDOCS_OBJ.workspaceid=-1),c=zmComponent.loadingBand({container:e[0],type:"pagination"}),d={servicename:"zmail",filename:b.fn,docsURL:"//"+zmail.urls.docsURL,containerDiv:"zmAddZDocs",isNewUI:!0,handbckobj:{attObj:b},callback:c},ADDDOCDIALOG.showAddDocDialog(d)}function e(a){var b=a.handbckobj&&a.handbckobj.attObj||{},d=b.sid||b.gId||zmail.zuid,e={method:"addtoZohoDocs",groupId:d,entityId:b.e,attachId:b.Id,entityType:b.et,filename:a.fname},f=c.SuccErrMsg;1===b.et&&(e.partId=b.p),b.shId&&(e.shId=b.shId),b.type?(2===b.et?e.streamsView="Notes":e.streamsView="true",e.actionType=b.type):e.accId=zmail.accId,a.issharedws&&(e.issharedws=a.issharedws),a.workspaceid&&q.parseToNumber(a.workspaceid)!==-1&&(e.wsId=a.workspaceid),e.foldId=a.folderid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:function(a){q.showSuccErrMsg(a[0].response,{success:f.Docs_Uploaded,error:f.Docs_Error})},p:e,ep:{}})}function f(a,b){var f=zmail.isRebranded?c.cloudServiceName.docs:c.cloudServiceName.zDocs;return{id:"zDocs",text:f,tabName:"zDocs",selected:a,onClk:function(a){d(a,b)},listingArea:{id:"zmAddZDocs",classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},buttons:[{text:c.dialogText.add,onClk:function(){q.uploadToCloud.addToCloudClose(),e(ADDDOCDIALOG.addToZDocsNewUI())}}]}}function g(b,d){var e=q.isDocsCompAllowed()?c.cloudServiceName.otherCloud:c.cloudServiceName.cloud;return{id:"oCloud",text:e,tabName:"oCloud",selected:b,onClk:function(b){a(b,d)},listingArea:{id:"zmAddCloud",classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},hideButtons:!0}}function h(a,b,c){return"zDocs"===a?f.call(this,b,c):"oCloud"===a?g.call(this,b,c):void 0}function i(a){var b={},c=[],d=!1;if(b.id="zmAddToCloudPopup",b.tabs=[],zmUtil.isAddToCloudAllowed()){q.isDocsCompAllowed()&&c.push("zDocs"),!zmail.isBaihui&&"false"!==zmail.isCloudServiceEnabled&&zmUtil.showAddToCloudTab()&&c.push("oCloud");for(var e=0,f=c.length;e<f;e++)d=0===e,b.tabs.push(h.call(this,c[e],d,a));b.onClose=function(){l=!1},b.dialogDidMount=function(a){var b=a.$el.find("."+a.contentClass);a.$el.find("."+a.contentClass).css({overflow:"hidden",width:""}),a.$el.find(".SCmc.SC_attachviewer").css({"max-height":b.css("max-height"),"max-width":b.css("max-width")})},b.classes="SC_add",j=zmsDialog.createTabPopupDialog(b)}else l=!1}var j,k,l=!1;return{initAddToCloud:function(a){l||(l=!0,i(a))},addToCloudClose:function(){j.close(),l=!1},cloudUpload:function(a,c,d,e){q.uploadToCloud.addToCloudClose();var f,g=k,h=g.sid||g.gId||zmail.zuid,i={groupId:h,entityId:g.e,entityType:g.et,attachId:g.Id};1===g.et&&(i.partId=g.p),g.shId&&(i.shId=g.shId),g.type?(2===g.et?i.streamsView="Notes":i.streamsView="true",i.actionType=g.type):i.accId=zmail.accId,i.folderPath=a,i.source=d,i.fileName=c,e&&(i.dbAccID=e),f={source:d},zmAjq.XHR({u:zmail.conPath+"/UploadToCloud",t:"POST",fn:b,p:i,ep:f})}}}(),q.openResult=function(a,b){zmUtil.prevCache(b.id,{mdata:a}),zmList.getMailData({msgId:b.id,type:"lt",opentype:2,src:"external"})},q.openMail=function(a){if(void 0!==a.sid&&a.sid!==q.parseToNumber(zmail.zuid)||a.gId!==zmail.zuid){var b=a.sid||a.gId,c=a.sid?"viewSelfData":"viewGroupEntity";zmUtil.loadStreamsInTab({pid:a.e,gid:b,etype:String(a.et),actionType:c})}else{var d={entityId:a.e,entityType:a.et,method:"openEntity"},e={id:a.e,F:a.dn};d.groupId=a.gId,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:q.openResult,p:d,ep:e})}},q.sendMail=function(a){zmUtil.openComposeWithAtt([a])},q.openPost=function(a){var b=a.sid?a.sid:a.gId,c=a.gId!==zmail.zuid||a.sid?"viewGroupEntity":"viewSelfData",d={pid:a.e,gid:b,etype:a.et,actionType:c};a.cId&&(d.commentId=a.cId),zmUtil.loadStreamsInTab(d)},q.printImageAtt=function(a){var b,c;if(!$("#"+d).length){var e=window.open(zmUtil.getTheSrc("FileDownload",a),"_blank");return e.opener=null,void(e.onload=function(){e.focus(),e.print()})}if(b=q.loadingIndicatorTemplate(),101===a.ft)c=$("#"+d).find(".ZAt_opt"),c.find("#attMsi-print").addClass("SC_vh"),c.append(zdom("div",{id:"zmTempDiv",style:{left:"96.4%",top:"1px"}},b));else if(101!==a.ft){var f=$("#"+d).find("iframe")[0];return void f.contentWindow.print()}zmail.prevAttachment={},a.src=zmUtil.getTheSrc("FileDownload",a),(window.ActiveXObject||"ActiveXObject"in window)&&(a.src+="&t="+Date.now()),zmail.prevAttachment.attObj=a;var g=zdom("iframe",{src:zmail.conPath+"/print.do?isImg="+!0});$("body").append(g),g.on("load",function(){window.setTimeout(function(){g.remove()},2e3)})},q.showLabelPopup=function(a,b,c,d){var e,f=b.l,g={};return f&&"$6"===f[0]&&f.splice(0,1),g.parentDOM=a,g.displayAs="popup",g.accType="default",g.labelState={labelList:f},g.onCreate=function(a,b){zmlab.isValidName(a,"","default")&&zmlab.labelCreate(a,"default",{reqDoneClbk:function(a,b){a&&(g.onStateChange(b,!0,function(){}),e.hide())},color:b})},g.onHide=function(){"function"==typeof d&&d(a,b)},c&&(g.direction=c),g.onStateChange=function(c,d){q.lblPopupAction(d?"addLabel":"deleteLabel",b,a,c)},g.divId="zmlightbox_dropDown",e=zmUtil.createFLComp("label",g),e.show(),{remove:function(){e.hide(),$("#zmlightbox_dropDown").remove()}}},q.lblPopupAction=function(a,b,c,d){"addLabel"===a?q.addLabelApi(c,b,d):q.removeLabelApi({el:c,id:b,lblId:d},q.removeLabelApiResult)},q.addLabelApi=function(a,b,c){var d,e=$(a).data().uid||c;if(e){var f=q.addLabelApiResult,g={method:"applyLabel",groupId:b.gId,entityId:b.e,attachId:b.Id,entityType:b.et,labelId:e,m:"a",fileType:b.ft,uuid:b.u};1===b.et&&(g.partId=b.p,g.accountId=zmail.accId),b.sid&&(g.sid=b.sid),d={attObj:b,labId:e},zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:f,p:g,ep:d})}},q.addLabelApiResult=function(a,b){var c,e,f,g=zmUtil.getTagList("default")[b.labId],h=b.attObj,i=h.e,j=h.Id+i;if($.publish("attachment/addLabel",b),g&&g.id){if($("#"+d).length){var k=$("#"+d).find(".ZAt_opt"),l=k.find("#sshwLeftIcons > div");e=l.find(".zmLblGrp"),e.length?(f=zmsTemplates.constructTagListHTML([b.labId],!0,void 0,"default",{constructOuterDiv:!1}),$(e).append(f)):(f=zmsTemplates.constructTagListHTML([b.labId],!0,void 0,"default",{constructOuterDiv:!0}),l.append(f))}if(c=$("div[data-atid='"+j+"']"),e=c.find(".zmLblGrp"),e.length)f=zmsTemplates.constructTagListHTML([b.labId],!1,2,"default",{constructOuterDiv:!1}),$(e).append(f);else{f=zmsTemplates.constructTagListHTML([b.labId],!1,2,"default",{constructOuterDiv:!0});for(var m=c.find(".zm_lbl"),n=0,o=m.length;n<o;n++)$(m[n]).find(".msi-label").length?$(m[n]).find(".msi-label").after(f):$(m[n]).append(f);c.find(".msi-label").addClass("SC_dyn"),c.find(".msi-plus").removeClass("SC_dyn")}c.addClass("SC_hlbl")}},q.removeLabelApi=function(a,b){var c,d=a.el.parentNode,e=d&&d.id?d.id:a.lblId;if(e){var f=a.id,g={method:"applyLabel",groupId:f.gId,entityId:f.e,attachId:f.Id,entityType:f.et,labelId:e,m:"d",uuid:f.u,fileType:f.ft};1===f.et&&(g.partId=f.p,g.accountId=zmail.accId),f.sid&&(g.sid=f.sid),c={attObj:f,ele:d,labId:e},zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:g,ep:c})}},q.removeLabelApiResult=function(a,b){var c=b.attObj,e=c.Id+c.e,f=b.labId;$.publish("attachment/removeLabel",b);var g=$("div[data-atid='"+e+"']"),h=g.find(".zm_lbl");h.find("div[data-mid='"+f+"']").remove(),h.find(".zmLbl").length||(g.removeClass("SC_hlbl"),h.find(".zmLblGrp").remove(),g.find(".msi-plus").addClass("SC_dyn"),g.find(".msi-label").removeClass("SC_dyn"));var i=$("#"+d);i.length&&(i.find("div[data-mid='"+f+"']").remove(),i.find(".zmLblGrp").children().length||i.find(".zmLblGrp").remove())},q.addLabel=function(a){var b=$("#"+d).find(".msi-label");q.showLabelPopup(b,a,"",function(){b.removeClass("SC_thm")}),$("#zmlightbox_dropDown").css("zIndex",999)},q.searchAttachment=function(a,b,c){var d="";"sender"===a?d=b.dn:"filetype"===a&&(d=zmUtil.fileTyp(b.fn)[2]),zmUtil.listAttachmentInAttSearchView({type:a,srchStr:d})},q.menuItemClick=function(a){var b,c,d=!1;if(void 0!==a&&a.constructor===Object){b=a.attObj;var f=b.attType===zmAttachUtility.fileType.hugeAttachment;switch(c=a.action,d=!1,zmUtil.hideMenu(),c){case"download":f?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(b.digest)):zmUtil.downloadAttachment(b);break;case"lstSender":q.searchAttachment("sender",b,3);break;case"lstType":q.searchAttachment("filetype",b,4);break;case"sMail":q.sendMail(b);break;case"attachToPost":zmUtil.loadNewPostDialog("",[b]);break;case"attachToNote":zmUtil.loadNotes("popup",{attEntObj:[b]});break;case"attachToTask":zmUtil.loadTask({action:"addCTask",tasks:{attEntObj:[b]}});break;case e.email:q.openMail(b);break;case e.note:zmUtil.loadNotes("openNote",b);break;case e.status:q.openPost(b);break;case e.task:q.openPost(b);break;case e.event:q.openPost(b);break;case e.link:q.openPost(b);break;case"remFav":q.attFav(b,!1);break;case"fav":q.attFav(b,!0);break;case"hideAtt":q.hideAtt(b,q.hideResult);break;case"unhideAtt":q.restoreToAttachmentView(b);break;case"addLab":q.addLabel(b);break;case"addToDocs":zmUtil.cloudUploader(b);break;case"addEvent":zmUtil.addEventsToCal(b);break;case"dwn":f?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(b.digest)):zmUtil.downloadAttachment(b);break;case"addTag":d=!0;break;case"printImg":q.printImageAtt(b);break;case"deleteAtt":f&&q.deleteHugeAtt(b);break;case"changePerm":zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.getListAndEditPerm(b,this);break;case"copyLink":zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.copyPermaLink(b)}if(d){var g=a.ele,h=g.parents(".zmL.zmAch");h.addClass("sel"),q.showLabelPopup(g,b,"",function(){h.removeClass("sel")})}}},q.attFav=function(a,b){if(a){var c={attObj:a,flag:b},d=q.favResult;q.favAttach(c,d)}},q.favAttach=function(a,b){var c=a.attObj,d={method:"markFavourite",groupId:c.gId,entityId:c.e,attachId:c.Id,entityType:c.et,flag:a.flag,fileType:c.ft,uuid:c.u},e={flag:a.flag,attObj:c};1===c.et&&(d.accountId=zmail.accId),c.sid&&(d.sid=c.sid),zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:d,ep:e})},q.favResult=function(a,b){if(a&&"success"===a[0].response){var d,e,f=b.attObj,g=b.flag,h=f.Id+f.e,i=$("div[data-atid='"+h+"'].zmAch"),j=$(".ZAt_opt").find(".msi-fav"),k=i.length,l=c.prevMenu;if(g){for(d=0;d<k;d++)e=$(i[d]).find("i.msi-fav"),e.addClass("SC_fav").attr("data-tooltip",l.remFav);j.length&&j.addClass("SC_fav").attr("data-tooltip",l.remFav)}else{for(d=0;d<k;d++)e=$(i[d]).find("i.msi-fav"),e.removeClass("SC_fav").attr("data-tooltip",l.fav);j.length&&j.removeClass("SC_fav").attr("data-tooltip",l.fav)}$.publish("attachment/modifyFavLbl",[h,g])}},q.hideAtt=function(a,b){Dialog["new"]({title:c.common.confirmHideAtt,buttons:[{name:zmText.get("dialog","ok"),callback:function(c){var d={method:"deleteFromAttachmentView",entityId:a.e,attachId:a.Id,filename:a.fn,entityType:a.et,uuid:a.u,fileType:a.ft};c.remove(),1===a.et&&(d.partId=a.p),a.sid?d.groupId=a.sid:d.groupId=zmail.zuid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:d,ep:{attObj:a}})}},{name:zmText.get("dialog","cancel"),isCancel:!0,callback:function(a){a.remove()}}],defaultCloseIcon:!1})},q.deleteHugeAtt=function(a){Dialog["new"]({title:c.common.confirmDeleteAtt,buttons:[{name:zmText.get("dialog","ok"),callback:function(b){zmUtil.loadHugeAttachComponent();var c={fn:q.hideResult,eprm:{attObj:a}};zmAttachComponent.hugeAttachment.deleteFile("",a.digest,"",c),b.remove()}},{name:zmText.get("dialog","cancel"),isCancel:!0,callback:function(a){a.remove()}}],defaultCloseIcon:!1})},q.hideResult=function(a,b){if(a&&(a[0]&&"success"===a[0].response||"success"===a)){for(var c=b.attObj.Id+b.attObj.e,d=zmsuite.getCenter()[0].$el,e=$("div[data-atid='"+c+"'].zmAch"),f=$("dl[data-atid='"+c+"'].zmAch"),g=e.length,h=d.find("div[data-atid='"+c+"'].zmAch").parent(),i=0;i<g;i++)$(e[i]).remove();f.remove(),q.listview.previewCard.closePrevCard.call(this),$.publish("attachment/hideAttachment",[d,c,h])}},q.restoreToAttachmentView=function(a){var b={method:"restoreToAttachmentView",entityId:a.e,attachId:a.Id,entityType:a.et};a.sid&&(b.streamsView=!0),b.groupId=a.sid||zmail.zuid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:function(a,b){Array.isArray(a)&&a[0]&&"success"===a[0].response?b&&b.attObj&&b.attObj.l&&(b.attObj.l.splice(b.attObj.l.indexOf("$HIDDEN"),1),zmUtil.succErrMsg("s",c.SuccErrMsg.unhideSuccess)):zmUtil.succErrMsg("e",c.SuccErrMsg.unhideFailure)},p:b,ep:{attObj:a}})},q.getGroups=function(){var a,b,d=zmUtil.getGroupOrder()||[],e=[],f=c.menuText.me;e.push({id:zmail.zuid,name:f,display_text:f,tooltip:f});for(var g=0,h=d.length;g<h;g++)a=zmail.ContactBook.getGroups(d[g])[0],a&&(b=a.attrs.name,e.push({id:d[g],name:b,display_text:b,tooltip:b}));return e},q.getLabels=function(){var a,b=zmUtil.getTagList("default"),d=[],e=c.menuText.favourites,f=c.menuText.none;d.push({id:"f",name:e,display_text:e,tooltip:e});for(var g in b)a=_zm.escapeTags(b[g].dispName),d.push({id:g,name:a,display_text:a,tooltip:a});return d.push({id:"all",name:f,display_text:f,tooltip:f}),d},q.noAttach=function(a,b){a.removeClass("SC_tmbvw").html(""),a.append(zdom("div",{id:"noattachs",className:"SC_nmsg"},b))},q.previewNotAvlbl=function(a,b,d,e){var f=zmAttachment.templates,g=c.common.previewNotAvlbl+" - ";d.prepend(f.attPreviewMsg(g)),d.prepend(f.attachemntFileTypeIcon(a));var h=e.attType===zmAttachUtility.fileType.hugeAttachment;d.find(".At_load").remove(),d.find("font").on("click",function(){h?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(e.digest)):zmUtil.downloadAttachment(e)})},q.attDropDown=function(a,b,c){var d,e,f,g=$(b),h={};switch(a&&(a=a.replace(/[0-9]/g,"")),d={id:a,par:g,align:"pright",parWidth:!0,divId:"zm_dropDown"},a){case"tfil":g.find("b").addClass("SC_ddn"),f=g.parent(".zmSelect"),f.addClass("zmSlOn"),d.list=k,d.divId="zmAtt_dropDown",d.align="pleft",d.clk=function(a){f.removeClass("zmSlOn"),c?c(a,g):q.dropDownClick(a,g)},d.onHide=function(){f.removeClass("zmSlOn")},zmDrop.consDropDown(d);break;case"ent":d.list=l,d.divId="zmAtt_dropDown",d.align="pleft",f=g.parent(".zmSelect"),f.addClass("zmSlOn"),d.clk=function(a){f.removeClass("zmSlOn"),c?c(a,g):q.dropDownClick(a,g)},d.onHide=function(){f.removeClass("zmSlOn")},zmDrop.consDropDown(d);break;case"grp":h={},h.parentDOM=b,h.displayAs="dropdown",f=g.parent(".zmSelect"),f.addClass("zmSlOn"),h.dataCallback=function(){return zmAttachUtility.getGroups()},h.onSelect=function(a){f.removeClass("zmSlOn"),e.hide(),c?c(a,g):q.showGroupAtt(a,g)},h.onHide=function(){f.removeClass("zmSlOn")},e=zmUtil.createFLComp("",h),e.show();break;case"lbl":h={},h.parentDOM=b,h.displayAs="dropdown",h.accType="default",h.dataCallback=function(){return zmAttachUtility.getLabels()},f=g.parent(".zmSelect"),f.addClass("zmSlOn"),h.onSelect=function(a){f.removeClass("zmSlOn"),e.hide(),c?c(a,g):q.showLabelAtt(a,g)},h.onHide=function(){f.removeClass("zmSlOn")},e=zmUtil.createFLComp("",h),e.show();break;case"zm_AttView":g.find("b").addClass("SC_ddn"),d.list=m,d.clk=function(a){q.menuItemClick(a)},zmDrop.consDropDown(d)}},q.dropDownClick=function(a,b){var c=a.type;switch(c){case"attList":q.showByType(a.action,b);break;case"entList":q.showEntLst(a.action,b);break;case"attGroup":q.showGroupAtt(a.action,b);break;case"lblList":q.showLabelAtt(a.action,b)}q.hideMenu()},q.hideMenu=function(){$("#zmAtt_dropDown").remove()},q.showEntLst=function(a,b){b.text(q.entDrpTxtChange(a)),b.data({dataIndex:a})},q.showByType=function(a,b){""===a&&(a=0),b.text(c.fType[a]),b.data({dataIndex:a})},q.showGroupAtt=function(a,b){var d="";if(a===zmail.zuid)d=c.menuText.me;else{var e=zmail.ContactBook.getGroups(a)[0];d=e?e.attrs.name:""}b.text(d),b.data({dataIndex:a})},q.showLabelAtt=function(a,b){"f"===a?b.text(c.menuText.favourites):"all"===a?b.text(c.menuText.none):b.text(_zm.escapeTags(zmUtil.getTagList("default")[a].dispName)),b.data({dataIndex:a})},q.entDrpTxtChange=function(a){var b=c.entityType,d=a?b[a]||b[0]:b[0];return d},q.emailSplit=function(a){if("string"!=typeof a)return[];var b=[],c=a.indexOf("<"),d=a.indexOf(">"),e="",f=a;return c!==-1&&d!==-1&&(e=a.substring(0,c),f=a.substring(c+1,d)),b.push(e),b.push(f),b},q.getLabelArr=function(a){var b=a.slice(0);return b&&"$6"===b[0]&&b.splice(0,1),b},q.getAttachObject=function(a,b,c){var d=c.attArrObj[b].list,e=d.slice(0);return e.splice(0,a),q.createAttObjectArr(e,c)},q.createAttObjectArr=function(a,b){for(var c,d=[],e=a.length,f=0;f<e;f++)c=b.attDet[a[f]],d.push(c);return d},q.thumbNailContainer=function(a,b,d){var e=zdom("div",{className:"zmAmht zmAv",id:b+a},zdom("div",null,c.fType[a],zdom("span",{className:"SC_lnk"}," - "+c.menuText.showAll)));return 0!==d&&$(e).find(".SC_lnk").hide(),e},q.chkAttResp=function(a){var b=!1;if(a)for(var c=h.length,d=0;d<c;d++)if(a[h[d]]){b=!0;break}return b},q.consList=function(a,b,c,d){var e,h,i,j,k,l,m,n,o,p,r,s,t,u,v,w=a.Id+a.e,x=zmAttachment.templates;a.tnsize="37",e=x.attPrevInr(a),h=a.fs>0?zmUtil.sizeConv(a.fs):"&nbsp;",i=parseInt(a.et),j=g[i],k=f[i],l=a.l,r=q.emailSplit(a.dn);var y=l&&"$6"===l[0];m=x.favIcon(y),s=x.zmFdrBox(j,k,a.attType),o=zdom("div",{className:"zmFlt"}),p=zdom("div",{className:"SC_icn"}),"attComp"===c?(m=zdom("i",{className:"msi-tick"}),p.appendChild(m)):"attView"===c||"attSrcView"===c||"attListing"===c||"streams"===c?(a.attType!==zmAttachUtility.fileType.hugeAttachment&&o.appendChild(zdom("i",{className:"msi-uncheck"})),o.appendChild(m)):o.appendChild(m),t=x.divZmFrm(a.fn),u=zdom("div",{className:"zm_lbl"}),n=zdom("div",{"data-atid":w,className:"zmL zmAch"},zdom("div",{className:"zmLst"},o,zdom("div",{className:"zmDtl"},zdom("div",{className:"zmImg"},e),t,zdom("div",{className:"zmDate"},zdom("span",null,a.rt)),zdom("div",{className:"zmSze"},zdom("span",{className:"sum"},h)),s,zdom("div",{className:"zmSub"},zdom("span",{className:"sum"},r[1])),p,u),zdom("div",{className:"zmFrt"}))),"t"===b?$(t).find("#listView").hide():($(t).find("#thumbView").hide(),_zm.addClass(n,"SC_mlst")),v=q.getLabelArr(a.l);var z=v.length;if(z&&"attComp"!==c){_zm.addClass(n,"SC_hlbl");var A=zmsTemplates.constructTagListHTML(v,!1,2,"default",{constructOuterDiv:!0});$(u).append(A)}var B=_.filter(d,function(b){return b.uniqueId===a.uniqueId});return B.length&&_zm.addClass(n,"SC_check"),zmail.isBlurThumb&&a.thn&&q.replaceBlurImage(n,a),n},q.replaceBlurImage=function(a,b){var c=$(a).find(".zmImg"),d=zdom("img",{style:{display:"none"},src:zmUtil.getTheSrc("FileDownload",b,"thb")}),e=c.find("img").css("min-width","100%");$(d).on("load",function(){$(d).show(),e.remove()}),$(d).on("error",function(){$(d).remove()}),c.append(d)};var s=function(a){var b=$(this.selectElm),d=b.find(".attSelectCnt"),e=this.selectedAttachment,f=e.length>1?c.common.noofattselected:c.common.oneattselected;d.text(e.length+" "+f),a?b.removeClass("SC_dyn"):e.length||b.addClass("SC_dyn")},t=function(){var a=this;this.attachUtil.selectedAttachment=[],$(a.attachUtil.$el).find(".SC_check").removeClass("SC_check"),$(this.attachUtil.selectElm).addClass("SC_dyn")};q.onSelectAttachment=function(a,b,d){return this.selectedAttachment.length>=10?void _zm.succErrMsg("i",c.SuccErrMsg.att_selection):(b.addClass("SC_check"),this.selectedAttachment.push(d),"streams"===this.appName&&this.selectElm&&s.call(this,!0),void $.publish("attachmentView/attachmentSelected",this.appName))},q.onUnselectAttachment=function(a,b,c){var d;b.removeClass("SC_check"),d=this.selectedAttachment.indexOf(_.findWhere(this.selectedAttachment,{uniqueId:c})),d>=0&&(this.selectedAttachment.splice(d,1),"streams"===this.appName&&this.selectElm&&s.call(this),$.publish("attachmentView/attachmentUnselected",this.appName))},q.createShareDropDownMenu=function(a){var b=$(a.ele),d=c.prevMenu,e={},f=[],g=a.attObj||{},h="left";b=b.hasClass("msi-rarrow")?b:b.find(".msi-rarrow"),b.length||(b=$(a.ele),h="bottom"),g.attType!==zmAttachUtility.fileType.hugeAttachment&&f.push({htm:d.attachToPost,data:{action:"attachToPost"}}),f.push({htm:d.sMail,data:{action:"attachToMail"}}),g.attType!==zmAttachUtility.fileType.hugeAttachment&&(f.push({htm:d.attachToNote,data:{action:"attachToNote"}}),f.push({htm:d.attachToTask,data:{action:"attachToTask"}})),e={par:b,list:f,clk:function(b,c){zmUtil.hideMenu(),"function"==typeof a.clk&&a.clk(b,c)},showArrow:!0,direction:h},a.divId&&(e.divId=a.divId),zmsuite.showMenu(e)},q.bindAttachListEvents=function(a,b){var d,e,f,g,h,i=$(a.target||a.srcElement);d=i.attr("class")||i.parent().attr("class")||"",e=zmList.getParent(i[0],"SC_mclst"),f=$(b).attr("data-atId"),g=this.attDet[f];var j=g.attType===zmAttachUtility.fileType.hugeAttachment;if(d.indexOf("msi-mail")!==-1)q.openMail(g);else if(d.indexOf("msi-fav")!==-1)h=!i.hasClass("SC_fav"),q.attFav(g,h);else if(d.indexOf("msi-download")!==-1)j?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(g.digest)):zmUtil.downloadAttachment(g);else if(d.indexOf("msi-send")!==-1)q.sendMail(g);else if(d.indexOf("msi-addcloud")!==-1)zmUtil.cloudUploader(g);else if(d.indexOf("msi-notes")!==-1)q.openPost(g);else if(d.indexOf("msi-status")!==-1||d.indexOf("msi-task")!==-1)q.openPost(g);else if(d.indexOf("msi-links")!==-1||d.indexOf("msi-calendar")!==-1)q.openPost(g);else if(d.indexOf("msi-hideattach")!==-1)q.hideAtt(g,q.hideResult);else if(d.indexOf("msi-trash")!==-1)j&&q.deleteHugeAtt(g);else if(d.indexOf("msi-uncheck")!==-1)i.closest(".zmL.zmAch").hasClass("SC_check")?q.onUnselectAttachment.call(this,i,$(b),f):q.onSelectAttachment.call(this,i,$(b),g);else if(d.indexOf("zmLbl")!==-1)q.showLabelPopup(i.parent(),g);else if(d.indexOf("msi-action")!==-1){
zmUtil.hideMenu();var k,l=c.prevMenu,m=[],n=95;j?(zmail.showFeature&&m.push({htm:l.changePermission,data:{action:"changePerm",attObj:g,ele:i}}),m.push({htm:l.addLabel,data:{action:"addTag",attObj:g,ele:i}}),m.push({htm:l.copylink,data:{action:"copyLink",attObj:g}}),m.push({htm:l.delAtt,data:{action:"deleteAtt",attObj:g,ele:i}})):(m.push({htm:l.attachToPost,data:{action:"attachToPost",attObj:g,ele:i}}),m.push({htm:l.attachToNote,data:{action:"attachToNote",attObj:g,ele:i}}),m.push({htm:l.attachToTask,data:{action:"attachToTask",attObj:g,ele:i}}),zmUtil.isAddToCloudAllowed()&&m.push({htm:l.addToDocs,data:{action:"addToDocs",attObj:g,ele:i}}),"ics"===zmUtil.fileTyp(g.fn)[2]&&m.push({htm:l.addEvent,data:{action:"addEvent",attObj:g,ele:i}}),m.push({htm:l.addLabel,data:{action:"addTag",attObj:g,ele:i}}),Array.isArray(g.l)&&g.l.indexOf("$HIDDEN")>=0&&zmail.showFeature?m.push({htm:l.unhideAtt,data:{action:"unhideAtt",attObj:g,ele:i}}):g.gId===zmail.zuid&&m.push({htm:l.hideAtt,data:{action:"hideAtt",attObj:g,ele:i}}),g.ft&&103!==g.ft&&"FileDownload"===zmUtil.isPreviewAvailable(g.fn).apiName&&m.push({htm:l.printImg,data:{action:"printImg",attObj:g,ele:i}})),i.parents(".zmL.zmAch").addClass("sel"),k=$("body").height()-i.offset().top>=n?"up":"bottom";var o={par:i,showArrow:!0,list:m,direction:k,onHide:function(){i.parents(".zmL.zmAch").removeClass("sel")},clk:function(a,b){q.menuItemClick(a,b)}};zmsuite.showMenu(o)}else if(e){var p,r,s,t,u,v={};if(r="attSrcView"===this.appName&&(void 0===this.dType||"l"===this.dType)||"attView"===this.appName&&"l"===this.dType||"attListing"===this.appName&&"list"===this.viewType)q.listview.previewCard.openPreviewCard.call(this,b),q.listview.previewCard.keyBindingForPreviwCard.call(this);else{for(t="attSrcView"===this.appName?0:"l"===this.dType?0:g.ft,p=this.attArrObj[t].list,s=p.length,v.startIndex=p.indexOf(f),v.attObjList=[],u=0;u<s;u++)v.attObjList.push(this.attDet[p[u]]);v.targetEle=i.parents(".zmL.zmAch").find(".zmImg"),zmAttachUtility.initSlideshow(v)}}},q.listOptions=function(a){var b,d,e,g,h,i=a.target||a.srcElement,j=$(i).closest(".zmL").attr("data-atid"),k=c.prevMenu,l=[];b=this.attachUtil?this.attachUtil.attDet[j]:this.attDet[j],l.push({htm:k.downLoad,data:{action:"dwn",attObj:b}}),l.push({sep:!0}),1===b.et&&(l.push({htm:k.lstAttSender,data:{action:"lstSender",attObj:b}}),l.push({htm:k.lstAttType,data:{action:"lstType",attObj:b}}),l.push({sep:!0})),e=b.et,g=f[e],h=b.l,g&&(l.push({htm:g,data:{action:g,attObj:b}}),l.push({sep:!0})),l.push({htm:k.sMail,data:{action:"sMail",attObj:b}}),b.attType!==zmAttachUtility.fileType.hugeAttachment&&(l.push({htm:k.attachToPost,data:{action:"attachToPost",attObj:b}}),l.push({htm:k.attachToNote,data:{action:"attachToNote",attObj:b}}),l.push({htm:k.attachToTask,data:{action:"attachToTask",attObj:b}})),l.push({sep:!0}),"$6"===h[0]?l.push({htm:k.remFav,data:{action:"remFav",attObj:b}}):l.push({htm:k.fav,data:{action:"fav",attObj:b}}),b.attType!==zmAttachUtility.fileType.hugeAttachment?(zmUtil.isAddToCloudAllowed()&&(l.push({sep:!0}),l.push({htm:k.addToDocs,data:{action:"addToDocs",attObj:b}})),"ics"===zmUtil.fileTyp(b.fn)[2]&&(l.push({sep:!0}),l.push({htm:k.addEvent,data:{action:"addEvent",attObj:b}})),h.indexOf("$HIDDEN")>=0&&zmail.showFeature?(l.push({sep:!0}),l.push({htm:k.unhideAtt,data:{action:"unhideAtt",attObj:b}})):b.gId===zmail.zuid&&(l.push({sep:!0}),l.push({htm:k.hideAtt,data:{action:"hideAtt",attObj:b}}))):(zmail.showFeature&&l.push({htm:k.changePermission,data:{action:"changePerm",attObj:b}}),l.push({htm:k.copylink,data:{action:"copyLink",attObj:b}}),l.push({htm:c.UserMsg.delAtt,data:{action:"deleteAtt",attObj:b}})),d={clk:function(a,b){q.menuItemClick(b,a)},conArr:l},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a)},q.loadingIndicator=function(a,b){var c=zmsuite.getCenter()[1].$el.find("#msprevAttSrc");c.find(".At_load").remove(),c.prepend(b),c.prepend(a)},q.loadingIndicatorTemplate=function(){return zmAttachment.templates.loadingTemplate()},q.removeLabelRef=function(a,b){var c,d,e,f;void 0!==b&&b.constructor===Object&&(c=b.attObj,void 0!==c&&c.constructor===Object&&(d=c.Id+c.e,this.attDet&&this.attDet[d]&&(e=this.attDet[d].l,f=e.indexOf(b.labId),f>=0&&e.splice(f,1))))},q.addLabelRef=function(a,b){var c,d,e,f;void 0!==b&&b.constructor===Object&&(c=b.attObj,void 0!==c&&c.constructor===Object&&(d=c.Id+c.e,this.attDet&&this.attDet[d]&&(e=this.attDet[d].l,f=e.indexOf(b.labId),f<0&&this.attDet[d].l.push(b.labId))))},q.modifyFavLblRef=function(a,b,c){var d,e,f;this.attDet&&this.attDet[b]&&(e=this.attDet[b],f=e.l,c?f.unshift("$6"):(d=f.indexOf("$6"),f.splice(d,1)))},q.ajaxReq={ajaxCallHelper:function(a,b){var c=zmComponent.loadingBand({container:b.loadingContainer,type:b.loadingType}),d=a.ep;return d.removeLoadingBand=c,{extraParam:d}},getGroupAttachments:function(a,b,c){var d,e=a.paramInfo;e.mode=e.mode||"lst";var f={u:zmail.conPath+"/attach.do",t:"POST",fn:b,p:e};if("object"===("undefined"==typeof c?"undefined":babelHelpers["typeof"](c))){var g=function(){d.extraParam.removeLoadingBand();var e=$(zmAttachment.templates.retryTemplate()),f=e.find("font")[0];f.onclick=function(){e.remove(),q.ajaxReq.getGroupAttachments(a,b,c)},c.loadingContainer.appendChild(e[0])};d=q.ajaxReq.ajaxCallHelper(a,c),f.onerror=g,f.onnetfailure=g}else d={extraParam:a.ep};f.ep=d.extraParam,zmAjq.XHR(f)},getGroupLblAttachments:function(a,b,c){var d,e=a.paramInfo,f={u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:e};if("object"===("undefined"==typeof c?"undefined":babelHelpers["typeof"](c))){var g=function(){d.extraParam.removeLoadingBand();var e=$(zmAttachment.templates.retryTemplate()),f=e.find("font")[0];f.onclick=function(){e.remove(),q.ajaxReq.getGroupLblAttachments(a,b,c)},c.loadingContainer.appendChild(e[0])};d=q.ajaxReq.ajaxCallHelper(a,c),f.onerror=g,f.onnetfailure=g}else d={extraParam:a.ep};f.ep=d.extraParam,zmAjq.XHR(f)}},q.listview={},q.listview.previewCard=function(){var a=function(a,b,c){var d={background:"white",visibility:"hidden"};return zdom("iframe",{id:"zmIframe",frameBorder:"0",scrolling:"auto",width:c,height:b,style:d,src:a})},b=function(a){a.load(function(){var b=zmsuite.getCenter()[1].$el;b.find("#msprevAttSrc").find(".At_load").remove(),a.css("visibility","visible")})},d=function(){var a,b=zmsuite.getCenter()[1].$el,c=b.height()-117+"px";return a=b.hasClass("shw")?b.width()-65+"px":b.width()+40+"px",{height:c,width:a}},e=function(a){var b=zmUtil.getTheSrc("FileDownload",a),c=$(zdom("img",{style:{display:"none"},src:b})),d=zmsuite.getCenter()[1].$el.find("#msprevAttSrc");c.on("load",function(){d.find(".At_load").remove(),c.css({display:"block","max-width":"100%","max-height":"100%"})}).on("error",function(){var b=zmAttachment.templates.centerAlignBox();d.append(b),d.find(".At_load").remove(),c.remove(),q.previewNotAvlbl("msi-attothers",!1,$(b),a)}),q.loadingIndicator(q.loadingIndicatorTemplate(),c),d.append(c)},g=function(c){var e=zmUtil.getTheSrc("OpenDocument",c),f=d(),g=$(a(e,f.height,f.width));q.loadingIndicator(q.loadingIndicatorTemplate(),g),b(g)},h=function(c,e){var f,g,h,i=!1,j=!0,k=d(),l=zmsuite.getCenter()[1].$el;(window.ActiveXObject||"ActiveXObject"in window)&&(i=!0,p[e[2]]&&(g=zmAttachment.templates.centerAlignBox(),j=!1,q.previewNotAvlbl(e[1],!1,$(g),c))),j&&("eml"===e[2]||"msg"===e[2]?(l.find("#msprevAttSrc").append(q.loadingIndicatorTemplate()),zmAttach.util.constMailFromEml(c,function(a){l.find("#zmHdrAtt").next().html(a)})):(h=zmUtil.getTheSrc("FileDownload",c),f=$(a(h,k.height,k.width)),q.loadingIndicator(q.loadingIndicatorTemplate(),f),i&&"msi-attpdf"===e[1]?window.setTimeout(function(){l.find("#msprevAttSrc").find(".At_load").remove(),f.css("visibility","visible")},2e3):b(f)))},i=function(a){var b=zmUtil.getTheSrc("FileDownload",a),c=zmsuite.getCenter()[1].$el.find("#msprevAttSrc"),d={filename:a.fn,source:b,$parent:c,height:c.height(),width:c.width()};zmAppLoader.load("slideshowComp").done(function(){zmAttachment.slideshow.player.create(d)})},j=function(a,b){var c=zmAttachment.templates.centerAlignBox();zmsuite.getCenter()[1].$el.find("#msprevAttSrc").append(c),q.previewNotAvlbl(a[1],!1,$(c),b)},k=function(a){var b=zmUtil.fileTyp(a.fn);101===a.ft?e(a):"msi-attdoc"!==b[1]&&"msi-attppt"!==b[1]&&"msi-attsheet"!==b[1]||o[b[2]]?"msi-attpdf"===b[1]||"msi-attdoc"===b[1]&&o[b[2]]||"msi-attothers"===b[1]&&o[b[2]]?h(a,b):"msi-attaudio"===b[1]||"msi-attvideo"===b[1]?i(a):j(b,a):g(a)},l=function(a){function b(){var a=this;c.length&&void 0!==c.attr("data-atid")?e.find("b.SC_nrr:first").unbind("click").bind("click",function(){q.listview.previewCard.openPreviewCard.call(a,c,"prev")}):e.find("b.SC_nrr:first").unbind("click").addClass("SC_opy3"),d.length&&void 0!==d.attr("data-atid")?e.find("b.SC_nlr:first").unbind("click").bind("click",function(){q.listview.previewCard.openPreviewCard.call(a,d,"next")}):e.find("b.SC_nlr:first").unbind("click").addClass("SC_opy3")}var c=a.prev(),d=a.next(),e=zmsuite.getCenter()[1].$el;b.call(this)},n=function(a){var b,d,e,g,h=zmsuite.getCenter()[1].$el.attr("data-atId"),i=c.prevMenu;m=[],b=this.attDet[h];var j=b.attType===zmAttachUtility.fileType.hugeAttachment;m.push({htm:i.downLoad,data:{action:"download",attObj:b}}),m.push({sep:!0}),1===b.et&&(m.push({htm:i.lstAttSender,data:{action:"lstSender",attObj:b}}),m.push({htm:i.lstAttType,data:{action:"lstType",attObj:b}}),m.push({sep:!0})),d=b.et,e=f[d],j?(zmail.showFeature&&m.push({htm:i.changePermission,data:{action:"changePerm",attObj:b}}),m.push({htm:i.sMail,data:{action:"sMail",attObj:b}}),m.push({sep:!0}),g=b.l,"$6"===g[0]?m.push({htm:i.remFav,data:{action:"remFav",attObj:b}}):m.push({htm:i.fav,data:{action:"fav",attObj:b}}),m.push({htm:i.copylink,data:{action:"copyLink",attObj:b}}),m.push({htm:i.delAtt,data:{action:"deleteAtt",attObj:b}})):(m.push({htm:e,data:{action:e,attObj:b}}),m.push({sep:!0}),m.push({htm:i.sMail,data:{action:"sMail",attObj:b}}),m.push({htm:i.attachToPost,data:{action:"attachToPost",attObj:b}}),m.push({htm:i.attachToNote,data:{action:"attachToNote",attObj:b}}),m.push({sep:!0}),g=b.l,"$6"===g[0]?m.push({htm:i.remFav,data:{action:"remFav",attObj:b}}):m.push({htm:i.fav,data:{action:"fav",attObj:b}}),zmUtil.isAddToCloudAllowed()&&(m.push({sep:!0}),m.push({htm:i.addToDocs,data:{action:"addToDocs",attObj:b}})),"ics"===zmUtil.fileTyp(b.fn)[2]&&(m.push({sep:!0}),m.push({htm:i.addEvent,data:{action:"addEvent",attObj:b}})),101===b.ft&&(m.push({sep:!0}),m.push({htm:i.printImg,data:{action:"printImg",attObj:b}})),g.indexOf("$HIDDEN")>=0&&zmail.showFeature?(m.push({sep:!0}),m.push({htm:i.unhideAtt,data:{action:"unhideAtt",attObj:b}})):b.gId===zmail.zuid&&(m.push({sep:!0}),m.push({htm:i.hideAtt,data:{action:"hideAtt",attObj:b}}))),q.attDropDown("zm_AttView",a)},r=function(a){var b,c,d,e,f=this.attDet[a],g=f.dn&&""!==f.dn?f.dn:zmail.aInfo[zmail.accId].mailId,h=q.emailSplit(g),i=""!==h[1]?h[1]:"&nbsp;",j=""!==h[0]?h[0]:i,k=zmConUtil.bubbleUtil({attr:{"data-eid":i},name:j,ret:"dom"}),l=zmAttachment.templates,m=this;b=document.createDocumentFragment(),c=$(l.prevTopDom(f.fn)),c.find(".msi-close").closest("b").off("click").on("click",function(){q.listview.previewCard.closePrevCard.call(m)}),b.appendChild(c[0]),d=$(l.prevMainDom(k,f.rt||" "));var o=d.find(".zm_lbl");if(e=q.getLabelArr(f.l),e.length){var p=zmsTemplates.constructTagListHTML(e,!1,2,"default",{constructOuterDiv:!0});o.find(".msi-label").addClass("SC_dyn").after(p),o.find(".msi-plus").removeClass("SC_dyn")}return d.find(".SCmb.SC_frt ul li").off("click").on("click",function(){n.call(m,this)}),d.find(".zmLbl").off("click").on("click",function(){q.showLabelPopup($(this),f)}),o.find(".zmAttLabelDrp").off("click").on("click",function(){q.showLabelPopup($(this),f)}),b.appendChild(d[0]),b};return{keyBindingForPreviwCard:function(){this.prev_shortcut_scope=zmComponent.keybindings.getScope();var a={allowDefaultScope:!1,shortcuts:[{uid:"next",keyStr:"downArrow",actions:[function(){zmsuite.getCenter()[1].$el.find("b.SC_nlr:first").trigger("click")}]},{uid:"previous",keyStr:"upArrow",actions:[function(){zmsuite.getCenter()[1].$el.find("b.SC_nrr:first").trigger("click")}]}],scope:this.appName+"attPreviewCard"};zmComponent.keybindings.registerAll(a),zmComponent.keybindings.setScope(this.appName+"attPreviewCard")},openPreviewCard:function(a,b){var d,e,f=$(a),g=f.attr("data-atId"),h=zmsuite.getCenter()[1].$el,i=zmsuite.getCenter()[0].getNodes()[2].$el,j=h.attr("data-atId"),m=c.contactCard,n=[{htm:m.addToContact,id:"zms_add",clk:zmConUtil.handleAddToContact},{htm:m.sendMail,clk:zmConUtil.loadCompose},{htm:m.listEmails,clk:zmConUtil.listMails}];if(g!==j){h.attr("data-atId",g).html(r.call(this,g)),d=this.attDet[g],i.find("div.zmAch").removeClass("zmSLst"),h.removeClass("SC_w100 zmHideV").show(),f.addClass("zmSLst"),l.call(this,f),e=d.dn&&""!==d.dn?d.dn:zmail.aInfo[zmail.accId].mailId;var o=q.emailSplit(e)[1],p=zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(o),avatarBgColor:zmail.ContactBook.Utils.colorClasses()})[0];if(h.find("#zmHdrAtt").find(".SC_pvul li").prepend(p),zmail.wmsAPI.showPresence(q.emailSplit(e)[1],$(p)),h.find("#zmHdrAtt").find(".SC_cs").click(function(a){zmConUtil.showContactCard({dom:this,items:n,event:a,source:"slideshow"})}),h.addClass("shw SC_scroll"),zmsuite.getCenter()[0].$el.addClass("SC_sw"),k(d),b){var s=i.find("[data-atId='"+j+"']");zmUtil.initScroll(i,f,s,b,!0)}}},closePrevCard:function(){var a=zmsuite.getCenter()[1].$el,b=zmsuite.getCenter()[0].getNodes()[2].$el;a.attr("data-atId",""),b.find("div.zmAch").removeClass("zmSLst"),zmsuite.getCenter()[1].close(),a.find("#msprevAttSrc").empty(),zmComponent.keybindings.dropScope(this.appName+"attPreviewCard"),this.prev_shortcut_scope&&zmComponent.keybindings.setScope(this.prev_shortcut_scope)}}}();var u=function(){var a={},b=function(b){a[b]||(a[b]={})},c=function(b){a[b]&&delete a[b]},d=function(b){return!!a[b]},e=function(b,c){if(a[b])return c?a[b][c]:a[b]},f=function(b,c,d){a[b]&&(a[b][c]=d)},g=function(b,c){var d,e=a[b];if(c=c||[],"object"===("undefined"==typeof e?"undefined":babelHelpers["typeof"](e)))for(d in e)c.indexOf(d)<0&&delete e[d]},h=function(b,c){a[b]&&(c&&a[b][c]?delete a[b][c]:g(b))},i=function(a,b){u.isRegisterd(this.appName)&&!b.fromCache&&f(this.appName,b.pView,{resp:a,eprm:b})},j=function(){var a,b=this;a=function(a,c){i.call(b,a,c)}," "!==this.prvFltr.lblId?this.getLblAttachments({loadingType:"loading",lstngObj:this.prvFltr,evType:!1,st:1,fType:this.fileType,forCaching:!0,callback:a}):this.getGroupAttachments("loading",!1,{callback:a})},k=function(){var a=e(this.appName,this.presentView);return"object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))&&a.resp&&j.call(this),a};return{register:b,deregister:c,isRegisterd:d,getStoreData:k,storeData:i,flush:h,flushExcept:g}}();a.prototype={initAttachViewComp:function(){var a,b=this;this.onScroll||this.$el.bind("scroll",function(){b.fillAttsOnScroll(),zmUtil.hideMenu()}),this.cachingEnabled?u.isRegisterd(this.appName)?(a=u.getStoreData.call(this),"object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))&&a.resp?this.attLst(a.resp,{pView:this.presentView,thisRef:this,fromCache:!0}):this.getGroupAttachments()):(u.register(this.appName),this.getGroupAttachments()):this.getGroupAttachments()},fillAttsOnScroll:function(){var a=this.$el,b=a[0];Math.floor(b.scrollHeight-a.scrollTop())<=Math.floor(a.height())&&("t"!==this.dType||this.fileType)&&this.getAttachemntOnScroll()},getAttachemntOnScroll:function(){this.isDone||(this.isnew="n","l"===this.dType?this.start=this.showNxt:"t"===this.dType&&(this.start=this["showNxt"+this.fileType]),this.start&&(" "===this.prvFltr.lblId?this.getGroupAttachments("pagination","scrollEv"):this.getLblAttachments({loadingType:"pagination",lstngObj:this.prvFltr,evType:"scrollEv"})))},onListingClick:function(a,b){q.bindAttachListEvents.call(this,a,b)},restoreOptions:function(a){var b=this.prvFltr,d=a.find("#zmAttGrp"),e=a.find("#zmAttLbl"),f=a.find("#zmAttEntity"),g=a.find("#zmAttFilTyp");"f"===b.lblId?e.text(c.menuText.favourites).data({dataIndex:b.lblId}):" "===b.lblId?e.text(c.menuText.none).data({dataIndex:b.lblId}):e.text(zmUtil.getTagList("default")[b.lblId].dispName).data({dataIndex:b.lblId}),q.showGroupAtt(this.groupId,d),f.text(q.entDrpTxtChange(this.entity)).data({dataIndex:this.entity}),g.text(c.fType[this.fileType]).data({dataIndex:this.fileType})},attLView:function(a,b){var c,d,e=document.createDocumentFragment();this.attachCache(a,b);for(var f in a){c=a[f];for(var g in c)d=c[g],d.Id?e.appendChild(q.consList(d,this.dType,this.appName,this.selectedAttachment)):void 0!==d.showNextPage&&(this.showNxt=d.showNextPage);return e}},attachCache:function(a,b){if(b){var c,d=h.length;for(c=0;c<d;c++)this.attArrObj[h[c]]={showNxt:0,list:[]}}for(var e in a){var f=e,g=a[e];for(var i in g){var j=g[i],k=j.Id+j.e;k&&(j.gId=this.groupId,j.uniqueId=k,j.sid?this.groupId!==zmail.zuid?j.type="viewGroupEntity":j.type="viewSelfData":this.groupId!==zmail.zuid&&(j.type="viewGroupData"),void 0===j.fn&&(j.fn=" "),this.attDet[k]=j,this.attArrObj[f].list.push(k))}}},attTView:function(a,b,c){var d,e,f,g,h=this.$el,i="msAttHdr";c&&"boolean"!=typeof c&&h.find("#msAttHdr"+this.fileType).find(".SC_lnk").trigger("click"),b?(e=$(zdom("div",{className:"SC_tbdr SC_Aview"})),h.html(e)):e=h.find(".SC_tbdr"),this.attachCache(a,b);for(var j in a)f=void 0,q.parseToNumber(j)&&a[j]&&(d=a[j],f=b?$(q.thumbNailContainer(j,i,this.fileType)):h.find("#msAttHdr"+j),f.length&&(g=this.fileTypeShowAll,g[j].insertSingleAttachment&&f.find("#tempLoadContainer").remove(),this.constThumbList(d,f,j)),b&&e.append(f));this.fileType&&1===q.parseToNumber(this.start)&&(h.find("#msAttHdr"+this.fileType).find(".SC_nobdr").remove(),h.find("#msAttHdr"+this.fileType).removeClass("zmAmht")),this.findScroll()},constThumbList:function(a,b,c,d){var e,f,g,h,i,j=a.length,k=!1,l=!1,m=0,n=1,o=this;d=d||!1,h=this.fileTypeShowAll,f=this.$el,g=this.widthConst,h[c].isHidden=!1,i=f[0].scrollWidth,f.is(":hidden")&&("attComp"===this.appName?i=f.closest(".SC_PUcen")[0].scrollWidth:(f=zmsuite.getCenter()[0].getNodes()[2].$el,i=f[0].scrollWidth));for(var p=0;p<j;p++){var r,s=a[p];if(s.Id)if(r=q.consList(s,this.dType,this.appName,this.selectedAttachment),b.append(r),1!==q.parseToNumber(this.start)||d||0!==this.fileType){if(!d&&p===j-2&&a[j-1].showNextPage){var t,u,v=b.children().length;t=this.thumbCount,u=(v-1)%t,e=v-u+1,k=!0,l=!0;for(var w=0;w<u;w++)b.children(":last").remove()}}else{if(m+=g,(m>i||h[c].insertSingleAttachment)&&2===n){b.children(":last").remove(),e=p,k=!0,this["showNxt"+c]=a[a.length-1].showNextPage,void 0!==h[c].insertSingleAttachment&&(h[c].insertSingleAttachment=!1),this.thumbCount=p/2;break}(m>i||h[c].insertSingleAttachment)&&(n=2,m=g)}else this["showNxt"+c]=s.showNextPage,s.showNextPage&&!k&&(k=!0)}k?("y"===this.isnew||l?h[c].stoppedIndex=0:h[c].stoppedIndex-=1,h[c].isHidden=!0,h[c].stoppedIndex+=e,b.find(".SC_lnk").off("click").on("click",function(){o.showAllThb(h[c].stoppedIndex,"t",a[a.length-1].showNextPage,this.entity,c,"n",l,b)})):b.find(".SC_lnk").hide()},showAllThb:function(a,b,c,d,e,f,g,h){var i,j,k,l;if(g)j=q.getAttachObject(a,e,this),this.constThumbList(j,h,e,!0);else{i=this.$el.find("#msAttHdr"+e),i.find(".SC_nobdr").remove(),i.find(".SC_lnk").hide();for(var m=101;m<=105;m++)m!==q.parseToNumber(e)&&this.$el.find("#msAttHdr"+m).remove();i.removeClass("zmAmht"),j=q.getAttachObject(a,e,this),this.constThumbList(j,h,e,!0),c&&1!==q.parseToNumber(c)?(k=this.prvFltr," "===k.lblId?this.getAttLst({groupId:this.groupId,dType:b,st:c,eType:d,fType:e,prvFltr:k,isNew:f,lstngObj:!1,flag:!0}):(l=k,this.getAttLst({groupId:this.groupId,dType:b,st:c,eType:d,fType:e,prvFltr:k,isNew:f,lstngObj:l,flag:!0}))):(this.fileType=e,this.showHideDefaultview())}},attLst:function(a,b){var d,e,f,g=b.thisRef,h=g.$el,i=g.presentView,j=g.dType;if("function"==typeof b.removeLoadingBand&&b.removeLoadingBand(),b.pView!==i)return void h.children().show();if(d=q.chkAttResp(a))e="y"===g.isnew,e&&g.cachingEnabled&&u.storeData.call(g,a,b),"l"===j?("attView"===g.appName||"attComp"===g.appName||"list"===g.viewType?h.removeClass("SC_tmbvw"):h.addClass("SC_tmbvw"),f=g.attLView(a,e),1===g.start?(h.html(f),h.scrollTop(0)):h.find(".zmAch:last").after(f),g.findScroll(h)):(h.addClass("SC_tmbvw"),g.initView=!0,g.attTView(a,e,b.evT));else{if(1===g.start){var k=g.initView||"attView"!==g.appName?c.common.noAttFound:c.common.noAttFoundAll;q.noAttach(h,k)}"t"===g.dType?g["showNxt"+this.fileType]=0:"l"===g.dType&&(g.showNxt=0)}h.children().show(),g.isDone=!1,g.showHideDefaultview(),"function"==typeof g.onListingUpdate&&g.onListingUpdate(b.fromCache)},findScroll:function(){if(!this.onScroll){var a,b,c=this.$el;a="t"===this.dType?this["showNxt"+this.fileType]:this.showNxt,a&&c[0].scrollHeight<=c[0].clientHeight&&(this.start=a,this.isnew="n",b=this.prvFltr," "===b.lblId?this.getGroupAttachments("pagination","scrollEv"):this.getLblAttachments({loadingType:"pagination",lstngObj:b,evType:"scrollEv"}))}},getAttLst:function(a){var b=a.lstngObj,c=a.prvFltr,d=a.dType,e=a.groupId,f=a.eType,g=a.fType;if(this.groupId!==e||this.dType!==d||this.fileType!==g||this.entity!==f||b&&c.lblId!==b.lblId){if("object"===("undefined"==typeof b?"undefined":babelHelpers["typeof"](b))?(c.lblId=b.lblId,c.mthd=b.mthd):(c.lblId=" ",c.mthd=" "),this.presentView=d+e+f+g+c.lblId,this.groupId=e,this.dType=d,a.st?this.start=a.st:this.start=1,f&&""!==f?this.entity=f:this.entity="all",g?this.fileType=g:this.fileType=0,a.isNew?this.isnew=a.isNew:this.isnew="n","y"===this.isnew&&this.cachingEnabled){var h=u.getStoreData.call(this);if("object"===("undefined"==typeof h?"undefined":babelHelpers["typeof"](h))&&h.resp)return void this.attLst(h.resp,{pView:this.presentView,thisRef:this,fromCache:!0})}"attView"===this.appName&&q.listview.previewCard.closePrevCard.call(this)," "!==c.lblId?this.getLblAttachments({loadingType:"loading",lstngObj:b,evType:a.flag}):this.getGroupAttachments("loading",a.flag)}},getLblAttachments:function(a){var b,c,d=this.$el,e=a.container||d[0],f=a.st||this.start,g=a.lstngObj,h=a.loadingType,j={method:g.mthd,dType:this.dType,from:f,range:25,groupId:this.groupId};return this.isDone=!0,b=this.attLst,"all"!==this.entity&&(j.entityType=i[this.entity]),c=a.fType||this.fileType,0!==c&&(j.fileType=c),"labelListing"===g.mthd&&(j.label=g.lblId),1===q.parseToNumber(f)&&(this.attDet=[],d.children().hide()),"streams"!==this.appName&&"attComp"!==this.appName||(h="pagination"),a.forCaching?void q.ajaxReq.getGroupLblAttachments({paramInfo:j,ep:{evT:a.evType,pView:this.presentView,thisRef:this}},a.callback):void q.ajaxReq.getGroupLblAttachments({paramInfo:j,ep:{evT:a.evType,pView:this.presentView,thisRef:this}},b,{loadingContainer:e,loadingType:h})},getGroupAttachments:function(a,b,c){var d,e,f=this.$el,g={};return this.isDone=!0,d=this.presentView,e=this.attLst,this.requireParams&&this.requireParams.constructor===Object?$.extend(!0,g,this.requireParams):(g.type=this.dType,g.frm=this.start,g.entity=this.entity,g.ftype=this.fileType,g.groupId=this.groupId),g.frm=this.start,"streams"!==this.appName&&"attComp"!==this.appName||(a="pagination"),"object"===("undefined"==typeof c?"undefined":babelHelpers["typeof"](c))?void q.ajaxReq.getGroupAttachments({paramInfo:g,ep:{evT:b,pView:d,thisRef:this}},c.callback):(1===q.parseToNumber(this.start)&&(this.attDet=[],f.children().hide()),void q.ajaxReq.getGroupAttachments({paramInfo:g,ep:{evT:b,pView:d,thisRef:this}},e,{loadingContainer:f[0],loadingType:a}))},showHideDefaultview:function(){if("function"==typeof this.onFilterAction)return void this.onFilterAction();var a=this.$topEl,b=a.find("#zmMyAttachments"),d=this.prvFltr.lblId;if(this.groupId===zmail.zuid&&"all"===this.entity&&0===this.fileType&&" "===d)a.find("#zmDfltAttView").hide(),b.html(c.common.me),a.find(".SC_frt").find("li").find("b").eq(0).removeClass("SC_sel");else{a.find("#zmDfltAttView").show();var e,f=c.menuText.notags,g="";if(this.groupId===zmail.zuid)g=c.menuText.me;else{var h=zmail.ContactBook.getGroups(this.groupId)[0];g=h?h.attrs.name:""}e="f"===d?c.menuText.favourites:" "===d?f:zmUtil.getTagList("default")[d].dispName,b.html(""),b.append(zdom("b",null,zdom("i",null,c.filterMenu.filterBy))),b.append(document.createTextNode(": "+g+" - "+zmAttachUtility.entDrpTxtChange(this.entity)+" - "+c.fType[this.fileType]+" - "+e+"  ")),a.find(".SC_frt").find("li").find("b").eq(0).addClass("SC_sel")}}};var v=function(){var a,b=0,e=[],h=0,i={},j={},k=function(a){zmAttachment.slideshow.closeSlideshow(),a&&$.publish("zm/closeAllOpenDialog")},l=function(a){return"msi-attimg"===a[1]||"msi-attpdf"===a[1]||"msi-attdoc"===a[1]&&o[a[2]]||"msi-attothers"===a[1]&&o[a[2]]},m=function(a,b){if(b.hasClass("SC_thm"))b.removeClass("SC_thm"),$("#zmlightbox_dropDown").remove();else{var e=b,f=c.prevMenu,g={},h=[],i=!0,j="";a&&a.fn&&(j=zmUtil.fileTyp(a.fn)[2]||""),h.push({htm:zmText.applyArgs(f.saveasfile,{filetype:j.toUpperCase()}),data:{action:"saveaseml"}}),h.push({htm:zmText.applyArgs(f.saveasfile,{filetype:"HTML"}),data:{action:"saveashtml"}}),g={par:b,list:h,onHide:function(){b.removeClass("SC_thm")},clk:function(b,c){"saveaseml"===b.action?zmUtil.downloadAttachment(a):zmAttach.util.save($("#"+d+" .SC_pEml").html(),"html",a.fn),zmUtil.hideMenu()},showArrow:i},g.divId="zmlightbox_dropDown",e.addClass("SC_thm"),zmsuite.showMenu(g),$("#zmlightbox_dropDown").css("zIndex",1e6)}},r=function(a,b,c){switch(a){case"msi-mail":k(!0),q.openMail(b);break;case"msi-notes":k(),zmUtil.loadNotes("openNote",b);break;case"msi-task":k(),q.openPost(b);break;case"msi-calendar":k(),q.openPost(b);break;case"msi-status":k(),q.openPost(b);break;case"msi-attsearch":var d,e=c;e.hasClass("SC_thm")?(e.removeClass("SC_thm"),$("#zmlightbox_dropDown").remove()):(e.addClass("SC_thm"),d={id:"zm_lstSrc",par:e,align:"pright"},d.divId="zmlightbox_dropDown",e.find("b").addClass("SC_ddn"),d.list=n,d.align="mright",d.showArrow=!0,d.direction="bottom",d.clk=function(a){var c=a.action;1===c?q.searchAttachment("sender",b):2===c&&q.searchAttachment("filetype",b),zmUtil.hideMenu(),k(!0)},zmDrop.consDropDown(d),$("#zmlightbox_dropDown").css("zIndex",1e6));break;case"msi-send":k(!0),q.sendMail(b);break;case"msi-share":var f=$(c);f.hasClass("SC_thm")?(f.removeClass("SC_thm"),$("#zmlightbox_dropDown").remove()):(q.createShareDropDownMenu({ele:f,clk:function(a){"attachToPost"===a.action?zmUtil.loadNewPostDialog("",[b]):"attachToMail"===a.action?zmUtil.openComposeWithAtt([b]):"attachToNote"===a.action?zmUtil.loadNotes("popup",{attEntObj:[b]}):"attachToTask"===a.action&&zmUtil.loadTask({action:"addCTask",tasks:{attEntObj:[b]}}),k(!0)},divId:"zmlightbox_dropDown",attObj:b}),$("#zmlightbox_dropDown").css("zIndex",1e6));break;case"msi-fav":q.attFav(b,c);break;case"addLabel":$(c).hasClass("SC_thm")?($(c).removeClass("SC_thm"),$("#zmlightbox_dropDown").remove()):(q.addLabel(b,"slideShow"),$(c).addClass("SC_thm"));break;case"removeLabel":q.removeLabelApi(b,q.removeLabelApiResult);break;case"msi-print":q.printImageAtt(b);break;case"msi-unhide":q.restoreToAttachmentView(b);break;case"msi-download":var g=zmUtil.fileTyp(b.fn);"eml"===g[2]||"msg"===g[2]?m(b,$(c)):b.attType===zmAttachUtility.fileType.hugeAttachment?zmAttachComponent.hugeAttachment.downloadFile(b.digest):zmUtil.downloadAttachment(b)}},s=function(a){var b=g[a.et],d=zmUtil.fileTyp(a.fn),e={};return(!i.hideIcons||i.hideIcons.indexOf(b)<0)&&(e.entity={"class":b,title:f[a.et],events:[{name:"click",listener:function(a,c){r(b,c)}}],before:".msi-send"}),(!i.hideIcons||i.hideIcons.indexOf("msi-print")<0)&&l(d)&&(e.print={"class":"msi-print",id:"attMsi-print",title:c.prevMenu.printImg,events:[{name:"click",listener:function(a,b){r("msi-print",b)}}],after:".msi-download"}),"msi-mail"===b&&(!i.hideIcons||i.hideIcons.indexOf("msi-attsearch")<0)&&(e.search={"class":"msi-attsearch",title:c.prevMenu.search,events:[{name:"click",listener:function(a,b){var c=$(a.target||a.srcElem);r("msi-attsearch",b,c)}}],before:".msi-mail"}),e},t=function(a){return $.extend(!0,{},a,i.addIcons)},u=function(){return{text:c.UserMsg.download,listener:function(a,b){b.attType===zmAttachUtility.fileType.hugeAttachment?(zmUtil.loadHugeAttachComponent(),zmAttachComponent.hugeAttachment.downloadFile(b.digest)):zmUtil.downloadAttachment(b)}}},v=function(){var a={},b=".msi-download",d=i.attObjList[i.startIndex]||{};return zmUtil.isAddToCloudAllowed()&&d.attType!==zmAttachUtility.fileType.hugeAttachment&&(a.addToCloud={"class":"msi-addcloud",title:c.UserMsg.addToCloud,events:[{name:"click",listener:function(a,b){k(!0),zmUtil.cloudUploader(b)}}]},b=".msi-addcloud"),a.download={"class":"msi-download",title:c.UserMsg.download,events:[{name:"click",listener:function(a,b){r("msi-download",b,a.target)}}]},a.share={"class":"msi-share",title:c.UserMsg.share,events:[{name:"click",listener:function(a,b){r("msi-share",b,a.target||a.srcElement)}}],before:b},a},w=function(a){var b,c=zmUtil.fileTyp(a.fn);if(!("msi-attdoc"!==c[1]&&"msi-attppt"!==c[1]&&"msi-attsheet"!==c[1]||o[c[2]]))return zmUtil.getTheSrc("OpenDocument",a);if("msi-attpdf"===c[1]||"msi-attdoc"===c[1]&&o[c[2]]||"msi-attothers"===c[1]&&o[c[2]]||"msi-atthtml"===c[1]&&o[c[2]]){if(b=!0,(window.ActiveXObject||"ActiveXObject"in window)&&p[c[2]]&&(b=!1),b)return zmUtil.getTheSrc("FileDownload",a)}else{if("msi-attaudio"===c[1]||"msi-attvideo"===c[1])return zmUtil.getTheSrc("FileDownload",a);if("msi-attimg"===c[1])return zmUtil.getTheSrc("FileDownload",a)}return""},x=function(a,b){var c=a.find("#sshwLeftIcons > div");if($(c).find(".zmLblGrp").remove(),b.l){var d=q.getLabelArr(b.l);if(d.length){var e=zmsTemplates.constructTagListHTML(d,!0,void 0,"default",{constructOuterDiv:!0});c.append(e)}}},y=function(){a=zmComponent.keybindings.getScope();var b={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){}]}],scope:"slideshowwrapper"};zmComponent.keybindings.registerAll(b),zmComponent.keybindings.setScope("slideshowwrapper")},z=function(a,b,c){j[b]&&j[b].l.indexOf(c)<0&&j[b].l.push(c)},A=function(a,b,c){if(j[b]){var d=j[b].l,e=d.indexOf(c);e>=0&&d.splice(e,1)}},B=function(a,b,c){if(j[b]){var d=j[b],e=d.l,f=e.indexOf("$6");c?f<0&&e.unshift("$6"):f>=0&&e.splice(f,1)}},C=function(a){k(!0)},D=function(){$.unsubscribe("attachment/addLabel",z),$.unsubscribe("attachment/removeLabel",A),$.unsubscribe("attachment/modifyFavLbl",B),$.unsubscribe("attachment/closeSlideshow",k),$.unsubscribe("mailsuite/hashurl/updated",C)},E=function(){zmComponent.keybindings.dropScope("slideshowwrapper"),zmComponent.keybindings.setScope(a),D(),"function"==typeof i.onCancel&&i.onCancel()},F=function(){$.subscribe("attachment/addLabel",z),$.subscribe("attachment/removeLabel",A),$.subscribe("attachment/modifyFavLbl",B),$.subscribe("attachment/closeSlideshow",k),$.subscribe("mailsuite/hashurl/updated",C)},G=function(a){return!!a&&!!a.attObjList},H=function(a){var b=$('<div class="SC_pEml">');return zmAttachment.slideshow.showLoading(),zmAttach.util.constMailFromEml(a.handBackObj,function(a){var c=b.closest(".ZC_Pop");b.closest(".SC_oh").addClass("SC_emlCont"),b.css({maxHeight:c.height()-5,maxWidth:c.width()-5}),zmAttachment.slideshow.removeLoading(),b.append(a)}),b},I=function(a){b=a.startIndex||0,e=a.attObjList,h=e.length,i=a,j={}},J=function(){var a,f,g={},k={},m=!1;y(),g.attachmentObjectList=[],g.setIndex=b,g._i18NText={common:c.common,prevMenu:c.prevMenu,loupe:c.slideshow.loupe,tooltip:c.slideshow.tooltip},g.onCancel=E,i.hideAllOptions||(g.rightIconList=v(),(!i.hideIcons||i.hideIcons.indexOf(".msi-fav")<0)&&(g.leftIconList={fav:{"class":"msi-fav",title:c.UserMsg.fav,events:[{name:"click",listener:function(a,b){var c=!0,d=$(a.target||a.srcElement);d.hasClass("SC_fav")&&(c=!1,b.l&&b.l.length&&"$6"===b.l[0]&&b.l.splice(0,1)),r("msi-fav",b,c)}}]},tag:{"class":"msi-label",title:c.UserMsg.addLabel,events:[{name:"click",listener:function(a,b){var c=a.target||a.srcElement;r("addLabel",b,c)}}]}})),i.targetEle&&(g.targetEle=i.targetEle,
g.onCloseAnimation=!0);for(var n=0;n<h;n++)k={},a=e[n],k.isImage=101===a.ft,k.filename=a.fn||"",k.source=a.src||w(a),k.thumbnail=a.thn,k.handBackObj=a,j[a.Id+a.e]=a,f=zmUtil.fileTyp(k.filename)[2],i.hideAllOptions||(k.iconList=s(a),k.action=u()),i.ignoreEMLParsing||"eml"!==f&&"msg"!==f||(k.source=void 0,k.handleFilePreview=H),(a.callee_type||a.showInFrame)&&(g.ignoreThumb=!0,k.showInFrame=a.showInFrame),i.ignoreThumb&&(g.ignoreThumb=i.ignoreThumb),a.hideFileName&&(m=!0),a.hideShareOption&&(k.hideShareOption=a.hideShareOption),a.tweetText&&(k.tweetText=a.tweetText,k.featureURL=window.location.protocol+"//zoho.to/newzmail"),i.addIcons instanceof Object&&(k.iconList=t(k.iconList)),g.attachmentObjectList.push(k);g.afterPreviewInit=function(a,b){if(b.l=j[b.Id+b.e].l,(window.ActiveXObject||"ActiveXObject"in window)&&"msi-attpdf"===zmUtil.fileTyp(b.fn)[1]&&window.setTimeout(function(){a.find(".At_load").remove(),a.find("iframe").css("visibility","visible")},2e3),zmUtil.isZohoAccount(zmail.accId)&&!i.hideAllOptions&&(!i.hideIcons||i.hideIcons.indexOf("msi-fav")<0)){var d=a.find(".msi-fav"),e=b.l;e&&e.length&&"$6"===e[0]?d.addClass("SC_fav").attr({"data-tooltip":c.UserMsg.remFav,"data-tooltip-pos":"top"}):d.removeClass("SC_fav").attr({"data-tooltip":c.UserMsg.fav,"data-tooltip-pos":"top"}),x(a,b)}},(i.hideFileName||m)&&(g.hideFileName=!0),i.onLoad&&(g.onLoad=i.onLoad),g.iconClasses={closeClass:"msi-close",prevClass:"msi-atprev",nextClass:"msi-atnext",moreClass:"msi-thumbnail",zoominClass:"msi-zoomin",zoomoutClass:"msi-zoomout",printClass:"msi-print",addToCloudClass:"msi-addcloud",downloadClass:"msi-download",zoomPlusClass:"msi-plus",zoomMinusClass:"msi-minus"},g.loupe=!0,g.iconClasses.loupeClass="msi-magnify",g.afterInit=function(a){a.removeClass("ZC_lightbox SC_lightbox")},g.shortCuts=[{keyStr:"ctrl+p",action:function(a){if(a&&a.fn&&a.e){var b=zmUtil.fileTyp(a.fn);l(b)&&r("msi-print",a)}},preventDefault:!0},{keyStr:"cmd+p",action:function(a){if(a&&a.fn&&a.e){var b=zmUtil.fileTyp(a.fn);l(b)&&r("msi-print",a)}},preventDefault:!0}],g.onMouseDown=function(a){var b=$(a.target||a.srcElement);$("#zmlightbox_dropDown").remove(),b.hasClass("SC_thm")||($("#"+d+" .SC_thm").removeClass("SC_thm"),zmAttachment.slideshow.getLoupeStatus()&&$("#"+d+" .msi-magnify").addClass("SC_thm"))},zmAppLoader.load("slideshowComp").done(function(){zmAttachment.slideshow.initSlideShow(g)})},K=function(a){G(a)?(I(a),J(),F()):zmUtil.debugLog("Slideshow: Invalid config")};return{init:K,action:r}}(),w=function(){function a(a){this.attachUtil=null,this.config=a}var b=function(a,b){this.attachUtil.$el.off(a).on(a,b.bind(this))};a.prototype.initComponent=function(){var a=this;this.attachUtil=new zmAttachUtility.AttachmentListing(this.config),this.config.listElem.undelegate("click").delegate(".zmAch","click",function(b){a.attachUtil.onListingClick(b,this)}),b.call(this,"contextmenu",function(a){q.listOptions.call(this,a)}),this.attachUtil.dType="l";var c=this.attachUtil.selectElm;if("streams"===this.attachUtil.appName&&c){var d=$(c).find(".SC_attDwnZip");d.click(function(){zmUtil.downloadSelected(a.attachUtil.selectedAttachment),setTimeout(function(){t.call(a)},1e3)});var e=$(c).find(".SC_attAttachTo");e.click(function(){q.createShareDropDownMenu({ele:this,clk:function(b){var c=a.attachUtil.selectedAttachment;"attachToPost"===b.action?zmUtil.loadNewPostDialog("",c):"attachToMail"===b.action?zmUtil.openComposeWithAtt(c):"attachToNote"===b.action?zmUtil.loadNotes("popup",{attEntObj:c}):"attachToTask"===b.action&&zmUtil.loadTask({action:"addCTask",tasks:{attEntObj:c}}),setTimeout(function(){t.call(a)},1e3)}})})}this.attachUtil.initAttachViewComp()},a.prototype.init=function(a){this.reset(a),this.attachUtil.getGroupAttachments()},a.prototype.onScroll=function(){this.attachUtil.onScroll&&this.attachUtil.getAttachemntOnScroll()},a.prototype.reset=function(a){a&&(a.headerElem&&(a.listElem||(a.headerElem.append('<div class="SC_tmbvw"></div>'),a.listElem=a.headerElem.find(".SC_tmbvw")),this.attachUtil.$topEl=a.headerElem,this.attachUtil.$el=a.listElem,b.call(this,"contextmenu",function(a){q.listOptions.call(this,a)})),a.groupId&&(this.attachUtil.groupId=a.groupId),a.onScroll&&(this.attachUtil.onScroll=a.onScroll),a.viewType&&(this.attachUtil.viewType=a.viewType),a.entity&&(this.attachUtil.entity=a.entity),a.fileType&&(this.attachUtil.fileType=a.fileType),this.attachUtil.start=1)},a.prototype.isNewRequest=function(){return 1===this.attachUtil.start},a.prototype.toggleView=function(){"list"===this.attachUtil.viewType?(this.attachUtil.viewType="thumb",this.attachUtil.$el.addClass("SC_tmbvw")):(this.attachUtil.viewType="list",this.attachUtil.$el.removeClass("SC_tmbvw"))};var c=function(b){var c;return b.listElem||(b.headerElem.append('<div class="SC_tmbvw"></div>'),b.listElem=b.headerElem.find(".SC_tmbvw")),b.thumbWidth||(b.thumbWidth=191),b.viewType||(b.viewType="thumb"),c=new a(b),c.initComponent(),c};return{init:c}}();b.attType=h,b.AttachmentListing=a,b.AttLstArr=k,b.AttEntLst=l,b.getGroups=q.getGroups,b.getLabels=q.getLabels,b.attDropDown=q.attDropDown,b.createShareDropDownMenu=q.createShareDropDownMenu,b.entDrpTxtChange=q.entDrpTxtChange,b.noAttach=q.noAttach,b.consList=q.consList,b.getGroupAttachments=q.ajaxReq.getGroupAttachments,b.getGroupLblAttachments=q.ajaxReq.getGroupLblAttachments,b.addEventsToCal=q.addEventsToCal,b.addToCloud=q.uploadToCloud.initAddToCloud,b.addToCloudClose=q.uploadToCloud.addToCloudClose,b.cloudUpload=q.uploadToCloud.cloudUpload,b.getFilterDropTemplate=r.getFilterDropTemplate,b.initSlideshow=v.init,b.initAttachListing=w.init,b.bindAttachListEvents=q.bindAttachListEvents,b.closePrevCard=q.listview.previewCard.closePrevCard,b.createAttContextMenu=q.listOptions,b.removeLabelRef=q.removeLabelRef,b.addLabelRef=q.addLabelRef,b.modifyFavLblRef=q.modifyFavLblRef,b.isRestrictedIE=q.isRestrictedIE,b.isDocsCompAllowed=q.isDocsCompAllowed,b.parseToNumber=q.parseToNumber,b.parseToInteger=q.parseToInteger,b.showLabelPopup=q.showLabelPopup}(),function(){function a(a){this.configuration=a,this.workspaceConfig=$.extend(!0,{},f.workspaceConfig),this.attachListingConfig=$.extend(!0,{},f.attachListingConfig),this.attListComp=null,this.workspaceConfig.onDelete=d.workspace.onDelete.bind(this),d.initialise.call(this),this.render()}var b=zmail.Core.Namespaces.create("zmAttachUtility"),c=zmText.get("attachmentUtility"),d={},e=null,f={workspaceConfig:{appname:"Attachment Listing",appId:"attachList",headerText:void 0,headerHTML:void 0,data:{CNodes:"3"},appIcon:"msi-attsearch",searchPlaceHolder:c.prevMenu.search,faqKey:"attachment",hashKey:"",hashChangeHandler:function(a){var b=this;zmUtil.debugLog("Attachment Listing Component URL Changed",a,b)}},attachListingConfig:{appName:"attListing",viewType:"thumb",onFilterAction:function(){return!0}}};a.prototype.render=function(){var a=this;d.createAttachmentListingInsance(this.attachListingConfig).then(function(b){a.attListComp=b,e||zmUtil.setDragAndDrop(b.attachUtil.$el,{getAttachments:function(){return a.attListComp.attachUtil},onDragEnd:function(){d.resetSelectionViewAndData.call(a)}}).done(function(a){e=a})})},a.prototype.rerender=function(a){var b,c,e;this.isWorkspaceAvailable()&&(a&&a.constructor===Object&&($.extend(!0,this.configuration,a),b=a.attachListingConfig,b&&b.constructor===Object&&$.extend(!0,this.attachListingConfig,b),c=a.workspaceConfig,c&&c.constructor===Object&&($.extend(!0,this.workspaceConfig,a.workspaceConfig),e=d.workspace.update,c.headerText&&e.title.call(this,c.headerText),c.headerHTML&&e.headerHTML.call(this,c.headerHTML),c.appname&&e.tooltip.call(this,c.appname))),this.attachListingConfig.listElem.html(""),this.showWorkSpace(),d.resetSelectionViewAndData.call(this),this.render())},a.prototype.isWorkspaceAvailable=function(){return zmsuite.isWorkspaceAvailable(this.workspaceConfig.appId)},a.prototype.showWorkSpace=function(){d.workspace.show.call(this)},a.prototype.getWorkspacekey=function(){return this.workspaceConfig.workspaceKey},a.prototype.changeView=function(a){this.attListComp.attachUtil.viewType!==a&&this.attListComp.toggleView()},d.createAttachmentListingInsance=function(a){var b=$.Deferred();return zmUtil.initAttachListing(a,function(a){b.resolve(a)}),b},d.isAttachmentListingInstance=function(){return this.constructor===a},d.initialise=function(){d.isAttachmentListingInstance.call(this)&&($.extend(!0,this.workspaceConfig,this.configuration.workspaceConfig),$.extend(!0,this.attachListingConfig,this.configuration.attachListingConfig),zmsuite.isWorkspaceAvailable(this.workspaceConfig.appId)?d.workspace.show.call(this):d.workspace.create.call(this),this.attachListingConfig.headerElem=zmsuite.getCenter(this.workspaceConfig.appId)[0].$el,this.attachListingConfig.listElem=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[2].$el)},d.onAttachmentSelect=function(a,b){var d,e=this.attListComp.attachUtil;if(b===e.appName){d=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes(),e.selectedAttachment[1]||(d[1].$el.find(".SC_flt .SC_mtb").removeClass("SC_Tcen"),d[0].$el.find(".SC_flt").removeClass("zmHideD"));var f=1===e.selectedAttachment.length?c.common.oneattselected:c.common.noofattselected;d[0].$el.find(".SC_flt .SC_ldot.SC_itmSel").find("strong").text(e.selectedAttachment.length+" "+f)}},d.onAttachmentUnselect=function(a,b){var d,e=this.attListComp.attachUtil;if(b===e.appName)if(d=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes(),e.selectedAttachment[0]){var f=1===e.selectedAttachment.length?c.common.oneattselected:c.common.noofattselected;d[0].$el.find(".SC_flt .SC_ldot.SC_itmSel").find("strong").text(e.selectedAttachment.length+" "+f)}else d[1].$el.find(".SC_flt .SC_mtb").addClass("SC_Tcen"),d[0].$el.find(".SC_flt").addClass("zmHideD")},d.resetSelectionViewAndData=function(){var a=this.attListComp.attachUtil,b=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes(),c=b[2].$el.find(".SC_check");c.removeClass("SC_check"),b[1].$el.find(".SC_flt .SC_mtb").addClass("SC_Tcen"),b[0].$el.find(".SC_flt").addClass("zmHideD"),a.selectedAttachment=[]},d.shareOptionHandler=function(a){var b=this.attListComp.attachUtil;"attachToPost"===a.action?zmUtil.loadNewPostDialog("",b.selectedAttachment):"attachToMail"===a.action?zmUtil.openComposeWithAtt(b.selectedAttachment):"attachToNote"===a.action?zmUtil.loadNotes("popup",{attEntObj:b.selectedAttachment}):"attachToTask"===a.action&&zmUtil.loadTask({action:"addCTask",tasks:{attEntObj:b.selectedAttachment}}),d.resetSelectionViewAndData.call(this)},d.subscribeToEvents=function(){$.subscribe("attachmentView/attachmentSelected",d.onAttachmentSelect.bind(this)),$.subscribe("attachmentView/attachmentUnselected",d.onAttachmentUnselect.bind(this))},d.unsubscribeToEvents=function(){$.unsubscribe("attachmentView/attachmentSelected",d.onAttachmentSelect.bind(this)),$.unsubscribe("attachmentView/attachmentUnselected",d.onAttachmentUnselect.bind(this))},d.workspace={getLeftHeaderHtml:function(){var a=this.workspaceConfig;return zmAttachment.templates.leftHeader(a.appId,a.headerText||a.headerHTML)},show:function(){zmsuite.showWorkSpace(this.workspaceConfig.appId)},render:function(){zmsuite.renderWorkSpace()},afterRender:function(){var a=zmsuite.getCenter(this.workspaceConfig.appId)[0],b=a.getNodes(),c=b[0].$el.find(".SC_flt"),d=a.$el;d.addClass("SC_attachviewer"),d.find(".SC_frt").find("li[data-event='thumb']").find("b").addClass("SC_sel"),b[1].$el.find(".SC_flt .SC_mtb").addClass("SC_Tcen"),b[2].$el.scroll(function(){zmUtil.hideMenu()}),c.find("ul:first").addClass("SC_ldot"),c.addClass("zmHideD").prepend(zmAttachment.templates.attAddToContainer()).prepend(zmAttachment.templates.attDownloadContainer()).prepend(zmAttachment.templates.attSelectedMsgContainer())},set:function(){zmsuite.setWorkSpace(this.workspaceConfig)},get:{center:function(){return zmsuite.getCenter(this.workspaceConfig.appId)[0]},listing:function(){return zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[2].$el}},update:{title:function(a){"string"==typeof a&&zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[1].$el.find(".SC_mtb").text(a)},headerHTML:function(a){"string"==typeof a&&zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[1].$el.find(".SC_mtb").html(a)},tooltip:function(a){var b;"string"==typeof a&&(b=zmTab.getTabObject(this.workspaceConfig.appId),b.appname=a,zmTab.updateTabLst(b))}},create:function(){var a,b,e,f,g,h={},i=this;d.workspace.set.call(this),a=zmsuite.getCenter(),b=a[0].getNodes(),e=a[1].getNodes(),f=zmsuite.getCenter()[0].$el,h={list:{left:[],right:[{actionArr:[{iconList:["msi-thumbview"],data:"thumb",tooltip:c.common.thumbView},{iconList:["msi-listview"],data:"list",tooltip:c.common.listView}]}]},clk:function(a,b,c){"thumb"!==c&&"list"!==c||(f.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(a.target).closest("b").addClass("SC_sel"),i.changeView(c))}},g={list:{left:{leftHTML:d.workspace.getLeftHeaderHtml.call(this),centerAlign:!0}}};var j;b[0].push(h.list),b[0].setListener("click",h.clk),b[1].push(g.list),b[1].setListener("click",g.clk),b[2].setListener("contextmenu",function(a){zmAttachUtility.createAttContextMenu.call(j,a)}),e[0].setListener("click",zmAttachUtility.closePrevCard.bind(j)),d.workspace.render(),d.workspace.show.call(this),d.workspace.afterRender.call(this);var k=b[0].$el,l=$(k).find(".SC_attDwnZip");$(l).click(function(){var a=i.attListComp.attachUtil.selectedAttachment;zmUtil.downloadSelected(a),setTimeout(function(){d.resetSelectionViewAndData.call(i)},1e3)});var m=$(k).find(".SC_attAttachTo");$(m).click(function(){zmAttachUtility.createShareDropDownMenu({ele:m,clk:d.shareOptionHandler.bind(i)})})},onDelete:function(){return e=null,"function"==typeof this.workspaceConfig.onClose&&this.workspaceConfig.onClose(),d.unsubscribeToEvents.call(this),!0}};var g=function(b){var c=new a(b);return d.subscribeToEvents.call(c),c};b.listingComp={init:g}}(),function(){var a=zmail.Core.Namespaces.create("zmAttachUtility"),b=zmText.get("attachmentUtility").SuccErrMsg;a.errorConstants={authFailed:10014,emptyTicket:10020},a.errorMsgs={10001:b.Invalid_input,10002:b.Server_error,10003:b.Server_error,10004:b.Server_error,10005:b.Virus_failed,10006:b.Virus_Found,10007:b.Invalid_FName,10008:b.Virus_progress,10009:b.No_file,10010:b.Param_Mismatch,10011:b.Err_Origin,10012:b.User_Blocked,10013:b.User_Blocked,10014:b.Server_error,10015:b.Err_ContType,10017:b.url_notFound,10018:b.File_sizeEx,10019:b.File_sizeEx,10020:b.Server_error},a.fileType={hugeAttachment:4},a.constants={HUGE_ATT_UPER_LIMIT:2096e5,share_private:0,share_org:2,share_public:1}}();
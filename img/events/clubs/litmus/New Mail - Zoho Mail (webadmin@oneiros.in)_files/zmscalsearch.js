!function(factory){"use strict";var Namespaces=zmail.Core.Namespaces,module=Namespaces.create("zmail.Search.Utils.CommonUtil");factory(module)}(function(module){"use strict";var st=1,calendarParam=function(config){var array=config.data,obj={};if(array.length>1)for(var data in array)obj.calmode=3,obj.sindex=1,obj.rcount=zmail.Search.Models.Contexts.calendarContextSearch.pageSize,config.paginate&&(st=1==st?obj.rcount+1:st+obj.rcount),obj.sindex=st,"calendar"==array[data].name&&(obj.calId=array[data].obj.calId),"title"==array[data].name&&(obj.title=array[data].value),"date"==array[data].name&&(obj.date=array[data].value,obj.dateformat=zmail.userDateFormat),"location"==array[data].name&&(obj.loc=array[data].value),"organizer"==array[data].name&&(obj.orgId=array[data].obj.ORGANIZERID),"from-date"==array[data].name&&(obj.from=array[data].value,obj.dateformat=zmail.userDateFormat),"to-date"==array[data].name&&(obj.to=array[data].value,obj.dateformat=zmail.userDateFormat),"allday event"==array[data].name?obj.allday=1:(obj.title=obj.title!=obj.title?"":obj.title,obj.from=obj.from!=obj.from?"":obj.from,obj.to=obj.to!=obj.to?"":obj.to,obj.calId=obj.calId!=obj.calId?"":obj.calId,obj.date=obj.date!=obj.date?"":obj.date,obj.loc=obj.loc!=obj.loc?"":obj.loc,obj.orgId=obj.orgId!=obj.orgId?"":obj.orgId,obj.dateformat=obj.dateformat!=obj.dateformat?"":obj.dateformat,obj.allday=obj.allday!=obj.allday?"":obj.allday);else obj.calmode=3,obj.sindex=1,obj.rcount=zmail.Search.Models.Contexts.calendarContextSearch.pageSize,config.paginate&&(st=1==st?obj.rcount+1:st+obj.rcount),obj.sindex=st,"calendar"==array[0].name?obj.calId=array[0].obj.calId:"title"==array[0].name?obj.title=array[0].value:"location"==array[0].name?obj.loc=array[0].value:"organizer"==array[0].name?obj.orgId=array[0].obj.ORGANIZERID:"date"==array[0].name?(obj.date=array[0].value,obj.dateformat=zmail.userDateFormat):"from-date"==array[0].name?(obj.from=array[0].value,obj.dateformat=zmail.userDateFormat):"to-date"==array[0].name?(obj.to=array[0].value,obj.dateformat=zmail.userDateFormat):"allday event"==array[0].name&&(obj.allday=1);return obj};module.calendarParam=calendarParam}),function(factory){"use strict";var Namespaces=zmail.Core.Namespaces,module=Namespaces.create("zmail.Search.Utils.CommonUtil");factory(module)}(function(module){"use strict";module.calendarGenerator=function(response,framework){var dataAr=response.obj,$fragment=$(document.createDocumentFragment()),headerDOM=["SPAN",{attrs:{"class":"SC_mtb"},child:[["text","Results from Calendar"]]}];if(headerDOM=_zm.getDOM(headerDOM),framework.listingHeader.$el.find(".SC_flt").html(headerDOM),void 0!=dataAr)if(0!=dataAr.length){var $div=$('<div class="zcl zcl_agendavw" id="zcl_workarea"></div>'),$ul=$('<ul id="zcl_encloser" class="zcl_frmbg"></ul>'),$li=$("<li></li>"),$zul=$('<ul id="zcl_agnlst" class="zcl_agnlst"></ul>');$div.append($ul),$ul.append($li),$li.append($zul);for(var data in dataAr)for(var data2 in dataAr[data]){var eobj=dataAr[data][data2],id=data2,sdate=(zcal.getCalObj(eobj.CNAME),dataAr[data][data2].SD),parseD=ZCL_parseDateStr(sdate),st=dataAr[data][data2].ST,et=dataAr[data][data2].ET,loc=dataAr[data][data2].LOC,aday=dataAr[data][data2].ADAY,calObj=zcal.getCalObj(dataAr[data][data2].CNAME),calColor=calObj[1].split(":"),colarr=ZCL_getCalColor(calColor[0]),$ele=$('<li><div class="zcl_table"><ul><li class="zcl_w70"><img src='+dataAr[data][data2].PHOTO+' height="42px" width="42px"></li><li class="zcl_w70"><ul class="zcl_agdate"><li>'+parseD.dateBy("E")+"</li><li>"+parseD.dateBy("dd")+"</li><li>"+parseD.dateBy("NNN yyyy")+'</li></ul> </li><li class="zcl_agncclr"><span style = "background-color:'+colarr[1]+'"></span></li><li class="zcl_grevlst"><ul><li><b>'+dataAr[data][data2].SUM+"</b></li><li>"+(1==aday?"<em>All day</em>":"<em>"+ZCL_timeInUFormat(st)+"-"+ZCL_timeInUFormat(et)+"</em>")+(""!=loc?"<span>Location</span>":"")+"<em>"+loc+"</em></li></ul></li></ul></div></li>");bindClickOnSearchresult($ele,eobj,id),$zul.append($ele),$fragment.append($div)}}else{var $div=$('<div class="SC_nmsg" id="noevents">No Events Found</div>');$fragment.append($div)}else{var $div=$('<div class="SC_nmsg" id="noevents">No Events Found</div>');$fragment.append($div)}return $fragment};var bindClickOnSearchresult=function($ele,eobj,id){$ele.on("click",{obj:eobj},function(ev){ZCL_editEve(id,ev,eobj.CNAME,eobj.EUID)})}}),function(factory){"use strict";var Namespaces=zmail.Core.Namespaces,module=Namespaces.create("zmail.Search.Models.Filters");factory.call(module,module,function(str){return Namespaces.get(str,{ignore__namespace:!0})})}(function(module,require){"use strict";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),TYPES=require("zmail.ValueTypeInferrer.TYPES"),ZCalTitleFilter=TypeCreator.newType(module.StringFilter,{className:"ZCalTitleFilter",name:"title",description:"text",valueType:TYPES.String.name,multipleInstance:!1,validate:function(value){return _.isString(value)}});module.ZCalTitleFilter=ZCalTitleFilter}),function(factory){"use strict";var Namespaces=zmail.Core.Namespaces,module=Namespaces.create("zmail.Search.Models.Filters");factory.call(module,module,function(str){return Namespaces.get(str,{ignore__namespace:!0})})}(function(module,require){"use strict";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),LocationFilter=TypeCreator.newType(module.StringFilter,{className:"LocationFilter",name:"location",description:"text",values:function(str){var deferred=$.Deferred(),arra=[];if(""!==str&&1==str.length)if(-1!=Object.keys(zcal.search).indexOf("location"))if(-1!=Object.keys(zcal.search.location).indexOf(str)){for(var i in zcal.search.location[str]){var obj2={LOC:zcal.search.location[str][i].LOC};arra.push(obj2)}deferred.resolve(arra)}else{var url="/cal/suggest.do?mode=loc&srchLoc="+str;ZCL_XHR(url,function(res){var sts=ZCL_Evl(1,res.responseText),obj=sts.obj,roArr=[];for(var i in obj)for(var j in obj[i])roArr.push(obj[i][j].LOC);var i,len=roArr.length,result=[],obj1={};for(i=0;len>i;i++)obj1[roArr[i]]=0;for(i in obj1){var obj2={LOC:i};result.push(obj2)}zcal.search.location?zcal.search.location[str]=result:(zcal.search.location={},zcal.search.location[str]=result),"success"==sts.status?deferred.resolve(result):deferred.reject()})}else{var url="/cal/suggest.do?mode=loc&srchLoc="+str;ZCL_XHR(url,function(res){var sts=ZCL_Evl(1,res.responseText),obj=sts.obj,roArr=[];for(var i in obj)for(var j in obj[i])roArr.push(obj[i][j].LOC);var i,len=roArr.length,result=[],obj1={};for(i=0;len>i;i++)obj1[roArr[i]]=0;for(i in obj1){var obj2={LOC:i};result.push(obj2)}zcal.search.location?zcal.search.location[str]=result:(zcal.search.location={},zcal.search.location[str]=result),"success"==sts.status?deferred.resolve(result):deferred.reject()})}return deferred.promise()},multipleInstance:!1,filterProps:["LOC"],filterValues:!0,autofillText:function(value){value=value||{};var text=[value.LOC||""].join(", ");return text},getValue:function(){var value=this.value||{};return _.isString(value)?value:value.LOC||""},validate:function(value){return"object"==typeof value||_.isString(value)?!0:void 0}});module.LocationFilter=LocationFilter}),function(factory){"use strict";var Namespaces=zmail.Core.Namespaces,module=Namespaces.create("zmail.Search.Models.Filters");factory.call(module,module,function(str){return Namespaces.get(str,{ignore__namespace:!0})})}(function(module,require){"use strict";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),ZCalOrganizerFilter=TypeCreator.newType(module.BaseFilter,{className:"ZCalOrganizerFilter",name:"organizer",description:"text/emailid",values:function(){var deferred=$.Deferred(),arra=[];if(-1!=Object.keys(zcal.search).indexOf("organizer")){for(var i in zcal.search)for(var j in zcal.search[i])arra.push(zcal.search[i][j]);deferred.resolve(arra)}else{var url="/cal/suggest.do?mode=orgname&srchOrg="+ZCalOrganizerFilter.name;ZCL_XHR(url,function(res){var sts=ZCL_Evl(1,res.responseText),rows="",obj=sts.obj;for(var i in obj)for(var j in obj[i])rows=obj[i][j],arra.push(rows);zcal.search.organizer=arra,"success"==sts.status?deferred.resolve(arra):deferred.reject()})}return deferred.promise()},multipleInstance:!1,filterProps:["ORGANIZERNAME","EMAIL_ID","PHOTO"],filterValues:!0,searchStartsWith:!0,autofillDOM:function(listItem){listItem=listItem||{};var name=listItem.ORGANIZERNAME||listItem.EMAIL_ID||listItem.PHOTO||"",emailId=listItem.EMAIL_ID||"",photo=listItem.PHOTO||"",$el=$('<div class="zmConWra">'),$div=$('<div class="SC_avtr"><img src='+photo+'></div><div class="zmConData"><div><strong class="js-name">'+name+'</strong></div><div><span class="js-desc">'+emailId+"</span></div></div></div>");return $el.append($div),$el},getValue:function(){var value=this.value||{};return _.isString(value)?value:value.ORGANIZERNAME||""},validate:function(value){var val;return"object"==typeof value&&(val=value.ORGANIZERNAME),_.isString(val)}});module.ZCalOrganizerFilter=ZCalOrganizerFilter}),function(factory){"use strict";var Namespaces=zmail.Core.Namespaces,module=Namespaces.create("zmail.Search.Models.Filters");factory.call(module,module,function(str){return Namespaces.get(str,{ignore__namespace:!0})})}(function(module,require){"use strict";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),ZCalCalendarFilter=TypeCreator.newType(module.BaseFilter,{className:"ZCalCalendarFilter",name:"calendar",description:"calendar name",values:function(){var calL=zcal.cdata.calLst,objArr=[],keyArr=Object.keys(calL);for(var i in keyArr){var obj={};obj.calName=calL[keyArr[i]][0],obj.calId=keyArr[i],objArr.push(obj)}return objArr},multipleInstance:!1,filterProps:["calName"],filterValues:!0,autofillText:function(value){return value.calName},getValue:function(){var value=this.value||{};return value.calName||""},validate:function(value){return"object"==typeof value?!0:!1}});module.ZCalCalendarFilter=ZCalCalendarFilter}),function(factory){"use strict";var Namespaces=zmail.Core.Namespaces,module=Namespaces.create("zmail.Search.Models.Filters");factory.call(module,module,function(str){return Namespaces.get(str,{ignore__namespace:!0})})}(function(module,require){"use strict";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),ZCalAlldayFilter=TypeCreator.newType(module.BooleanFilter,{className:"ZCalAlldayFilter",name:"allday event",multipleInstance:!1});module.ZCalAlldayFilter=ZCalAlldayFilter}),function(factory){"use strict";factory.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(require){"use strict";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),ZCalDateFilter=TypeCreator.newType(this.BaseFilter,{name:"date",className:"ZCalDateFilter",viewClassName:"DateFilter",value:void 0,multipleInstance:!0,validateOnSet:!1,validate:function(value){return value instanceof Date},getValue:function(){return this.value instanceof Date?this.value.getDateBy(zmail.userDateFormat):void 0}});this.ZCalDateFilter=ZCalDateFilter}),function(factory){"use strict";factory.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(require){"use strict ";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),ZCalDateFilter=this.ZCalDateFilter;this.ZCalFromDateFilter=TypeCreator.newType(ZCalDateFilter,{name:"from-date",className:"ZCalFromDateFilter",multipleInstance:!1,validate:function(fromDate){if(ZCalDateFilter.validate(fromDate)){var Environment=require("zmail.Search.Environment");if(Environment.has("ZCalToDateFilter")){var toDate=Environment.get("ZCalToDateFilter")[0].toJSON().actualValue;return ZCalDateFilter.validate(toDate)?fromDate.getTime()<toDate.getTime():!1}return!0}return!1}})}),function(factory){"use strict";factory.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(require){"use strict";var TypeCreator=require("zmail.Search.Utils.TypeCreator"),ZCalDateFilter=this.ZCalDateFilter;this.ZCalToDateFilter=TypeCreator.newType(ZCalDateFilter,{name:"to-date",className:"CalToDateFilter",multipleInstance:!1,validate:function(toDate){if(ZCalDateFilter.validate(toDate)){var Environment=require("zmail.Search.Environment");if(Environment.has("ZCalFromDateFilter")){var fromDate=Environment.get("ZCalFromDateFilter")[0].toJSON().actualValue;return ZCalDateFilter.validate(fromDate)?toDate.getTime()>fromDate.getTime():!1}return!0}return!1}})}),function(){"use strict";var Contexts=zmail.Search.Models.Contexts,constructionSearchContext=function(){var Filters=zmail.Search.Models.Filters,Util=zmail.Search.Utils.CommonUtil,searchContext={contextName:"Calendar",contextID:"calendar",tabRegexp:/zcal_Container/,placeholder:"Search Events",pageSize:100,defaultFilterClass:Filters.ZCalTitleFilter,filterClass:[Filters.ZCalTitleFilter,Filters.LocationFilter,Filters.ZCalOrganizerFilter,Filters.ZCalCalendarFilter,Filters.ZCalAlldayFilter,Filters.ZCalDateFilter,Filters.ZCalFromDateFilter,Filters.ZCalToDateFilter],shortcutId:"calendarSearch",url:"/mail/cal/srchAct.do",hasPagination:function(){return this.response&&this.response.haspagination},searchQuery:function(config){return Util.calendarParam(config)},getView:function(config){var response=config.response,framework=this.getFrameworkInstance(),rows=response;return this.response=response,Util.calendarGenerator(rows,framework)},contextIcon:"msi-calendar",ajax:function(data){var params=data;params.mstpcrdhkur=zmAjq.getCookie("aprmjrnpkcrkks");var xhrObj={url:this.url,type:"GET",data:$.param(params)};return $.ajax(xhrObj)}};return new zmail.Search.Models.Contexts.SearchContext(searchContext)},loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},strConObj=function(){"undefined"==typeof zcal?loadCalendarData().then(function(){Contexts.calendarContextSearch=constructionSearchContext(),zmail.Search.registerContext(Contexts.calendarContextSearch),zmail.Search.Models.Contexts.calendarContextSearch.contextName=zcal.i18n.calendar}):(Contexts.calendarContextSearch=constructionSearchContext(),zmail.Search.registerContext(Contexts.calendarContextSearch)),zmail.calSearchLoaded=!0,$.publish("CALSEARCH_INIT")};zmail.Search?strConObj():$.subscribe("SEARCH_INIT",function(){strConObj()})}();
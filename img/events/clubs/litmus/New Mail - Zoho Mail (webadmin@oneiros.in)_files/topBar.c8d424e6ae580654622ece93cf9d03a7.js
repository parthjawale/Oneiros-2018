"use strict";define([],function(a){var b=a("zmTopBar"),c=a("zmail.Utils.DOM"),d={getTopDOM:function(){return c.element(zdom("div",{id:"topBar",className:"SC_top"}))},getRHSDOM:function(){return c.element(zdom("div",{id:"jszmRHS",className:"zm_rhs"}))},getHamburgerMenuItem:function(){var a=c.element(zdom("span",null));return a},getHamburgerMenuDOM:function(){return c.element(zdom("div",{className:"zmHamburger"},zdom("div",null,zdom("span",null),zdom("span",null),zdom("span",null),zdom("span",null),zdom("span",null),zdom("span",null),zdom("span",null),zdom("span",null),zdom("span",null))))},getLogoElement:function(){return c.element(zdom("div",{className:"zmCustomLogo"},zdom("a",{href:"",style:{cursor:"pointer"},"data-homePageLink":!0},zdom("img",{src:"","data-logo":!0}))))},getTopLinkItem:function(){return c.element(zdom("li",null,zdom("a",{href:"",className:"SC_thm",target:"_blank","data-topBarLinkItem":!0})))},getSearchElement:function(){return c.element(zdom("div",{id:"zm-search",className:"zmTopSearch"},zdom("i",{id:"zm-search-filter",className:"msi-search zmTopSearchFilter"}),zdom("input",{id:"zm-search-field",className:"zmTopSearchField",type:"text",placeholder:"","data-placeholder":!0})))},getRightTopOuterFrame:function(){return c.element(zdom("div",{className:"SC_frt"}))},getTopLinksContainer:function(){return c.element(zdom("ul",{id:"zm-extraitems",className:"zmTopLinks"}))},getTopNavBarItem:function(){return c.element(zdom("li",{"data-navItem":!0},zdom("i",{className:"","data-topNavBarItem":!0})))},getTopNavBarContainer:function(){return c.element(zdom("div",{className:"zmTopNav"},zdom("ul",null)))},getRHSNavBarContainer:function(){return c.element(zdom("div",{className:"zmRightNav"},zdom("ul",null)))},getUserProfileItem:function(){return c.element(zdom("div",{className:"zmUPImgC"},zdom("img",{src:"","data-userProfileLink":!0})))},getNotificationDOM:function(){return c.element(zdom("div",{className:"zmNotiIW zmNotiOn"},zdom("i",{className:"msi-bell"}),zdom("i",{className:"msi-clapp"}),zdom("span",{className:"zm_mct"})))}};return b.View=d,b.View}),define([],function(a){var b,c,d,e,f,g,h=a("zmail.Core.Namespaces"),i=h.create("zmTopBar"),j=i.View,k=a("zmail.Utils.FeatureUtil"),l=a("zmComponent"),m=a("zmText"),n=a("zmail"),o=a("zmAppLoader"),p=a("$"),q="topBar",r={},s=!1,t=function(a){return p(b).has(a).length>0},u=function(){p("#jsZmTopWhatsNew").removeClass("zmWhatsNew"),s=!1},v=function(){setTimeout(function(){zmTab.tabResize({increaseInWidth:!1})},200)},w=function(){setTimeout(function(){zmTab.tabResize({increaseInWidth:!0})},200)},x=function(){return b||p(".SC_top")},y=function(){if(b=b||j.getTopDOM(),!document.getElementById(q)){zmsuite.$el.topBar=p(b),p(document.body).append(b);var a=parseInt(zmAdHocSettings.getLhsResize());n.fromOtherService||(a+=zmsuite.customization.appBar.width),p(b).css("left",a)}return 0===p("#jszmRHS").length&&(d=j.getRHSDOM(),p(document.body).append(d)),b},z=function(){var a=document.getElementsByClassName("zm_apps");if(a&&!n.fromOtherService){var b=j.getHamburgerMenuDOM();p(b).css({border:"2px solid red;"}),p(a).prepend(b),a.length>0&&g(b)}};g=function(a){var b,c,d=document.querySelector(".zmHamburger"),e=null,f=null,g=null,h=!1,i=!1,j=function(){h=!0,g&&g()},k=function(a,b){var c=document.createElement("script");c.setAttribute("src",a),c.setAttribute("charset","utf-8"),c.onload=j,g=b,document.body.appendChild(c)},l=function(c){return new Promise(function(g,h){var j=window.location.hostname;jQuery.ajax({url:window.location.protocol+"//"+j+"/biz/getHamburgerMenu.do",type:"GET",error:function(){},success:function(h){e=h[1];var l=j.substring(j.indexOf("."),j.length);f={jsBasePath:e.jsBasePath,cssBasePath:e.cssBasePath,zohoHomeDomain:"//home"+l,onShow:function(){i=!0;var c=function(){var a=p("<div/>",{"class":"zmAppMask blk",id:"jszmHamburgerMask"});return a};p(a).addClass("zmHactive"),b=c(),p(document.body).append(b)},left:d.getBoundingClientRect().right+"px",top:d.getBoundingClientRect().top+5+"px",showArrow:!0,onRemove:function(){i=!1,p(a).removeClass("zmHactive"),p(b).remove()}},k(e.initialJS,c),g()}})})},m=function(a){h?a():g=a},o=function(){return new Promise(function(a,b){var c={};c.mode="appsList",zmAjq.XHR({u:"/biz/bizApi.do",t:"post",p:c,fn:function(b){a(b)},efn:function(){b()},csr:"s"})})},q=function(a){Promise.all([l(a),o()]).then(function(a){q=m,f.defaultAppList=a[1]},function(){})},r=function t(){q(function(){n.isRebranded&&(f.zohoHomeDomain="//"+window.location.hostname+"/zm/home"),zmwp.HamburgerMenu.loadResources(f)}),d.removeEventListener("mouseover",t)},s=function(a){i!==!0&&(a.stopPropagation(),q(function(){c=!1,"1"===zmAdHocSettings.getNightMode()&&(c=!0),n.isRebranded&&(f.zohoHomeDomain="//"+window.location.hostname+"/zm/home"),f.nightMode=c,zmwp.HamburgerMenu.show(f)}))};d.addEventListener("mouseover",r),d.addEventListener("click",s)};var A=function(){c=c||j.getRightTopOuterFrame(),t(c)||p(b).append(c)},B=function(a,b,c){return m.get("mailsuite",a,b,c)},C=function(){var a=j.getTopNavBarContainer(),b=p("#topBar");b.append(a),n.fromOtherService||(e=j.getNotificationDOM(),e.data("name","notification"),a.prepend(e))},D=function(a){var b;return"string"==typeof a&&("99+"===a&&(a=100),isNaN(parseInt(a)))?0:(a=parseInt(a),!!n.fromOtherService||(clearTimeout(b),e.attr("class","zmNotiIW"),a<=0?e.find("span").eq(0).removeClass("zm_mct").text(""):(a>99&&(a="99+"),e.find("span").eq(0).addClass("zm_mct").text(a),b=setTimeout(function(){e.attr("class","zmNotiIW  zmNotiOn newNoti")})),void p.publish("/notifications/countChanged",a)))},E=function(a){var b=m.get("mailsuite","viewModes"),c=function(){r.order=["nightMode"];var a={tooltip:b.nightMode,className:"msi-nightModeOn zmDoubleIcon"};if("1"===zmAdHocSettings.getNightMode()&&(a.tooltip=b.dayMode,a.className="msi-dayModeOn zmDoubleIcon"),a.data="nightMode",a.callback=function(){var a,b=document.body;a=p(b).hasClass("zmNightMode")?0:1,_zm.toggleNightModeTheme({set:a})},r.nightMode=a,n.isRHSEnabled&&n.fromOtherService!==!0){r.order.push("integration");var c={tooltip:B("tooltips.integration"),className:"msi-integration zmDoubleIcon",data:"integration",callback:function(){zmsuite.toggleRHS()}};r.integration=c}var d=!1;d=n.Utils.FeatureUtil.isHidden("FeedbackForm"),d||n.fromOtherService||(r.order.push("feedback"),r.feedback={tooltip:B("tooltips.feedback"),className:"msi-feedback zmDoubleIcon",data:"feedback",parentClass:"jszmChtBndFdbck",callback:function(){zmsuite.loadFeedback()}})},d=function(a){for(var b=0;b<r.order.length;b++){var c=r[r.order[b]],d=p("<li/>",{"data-tooltip":c.tooltip,"data-tooltip-pos":"left"}),e=p("<i>");c.className&&e.attr("class",c.className),c.data&&(d.data({icon:c.data,name:c.data}),"feedback"===c.data&&d.addClass(c.parentClass)),c.id&&d.data("icon",c.id),c.target=d,d.append(e),a.append(d)}},e=function(){var b=p("<ul id='jsZmChatBarIcons' class='zmChatBarIcons'></ul>");p(a).append(b),f=b},g=function(){zmAdHocSettings.subscribeNightModeChange(function(a,c){var d="msi-nightModeOn",e=b.nightMode,f=r.nightMode.target,g=f.find(".msi-nightModeOn");g.length||(g=f.find(".msi-dayModeOn")),"1"===c.value&&(d="msi-dayModeOn",e=b.dayMode),p(f).attr({"data-tooltip":e,"data-tooltip-pos":"left"}),d+=" zmDoubleIcon",g.attr("class",d)})},h=function(a){a.off("click").on("click",function(a){var b=a.target||a.srcElement,c=p(b).closest("li").data("icon");r[c].callback()})};e(),c(),d(f),g(),h(f)},F=function(a){if(r[a.type])r[a.type].target.children().remove(),p(r[a.type].target).append(a.customHTML);else{var b=p("<li/>",{id:a.elementID});p(b).append(a.customHTML),f.prepend(b),a.target=b,r[a.type]=a,p(b).data("icon",a.type)}p(r[a.type].target).attr({"data-tooltip-pos":"left","data-tooltip":a.title})},G=function(a){var b=[];n.Utils.FeatureUtil.isHidden("newHelpMenu")||n.fromOtherService||b.push({iconType:!0,dataName:"whatsNew",iconClass:"msi-faq",title:B("whatsNew"),id:"jsZmTopWhatsNew",action:function(){o.load("helpMenuUtil").done(function(){n.topHelpMenu.init({isWhatsNewVisible:s,callback:function(){u(),p.publish("/whatsSeen/click")}})})},child:'<span class="zmWNtext">NEW</span>'}),b.push({iconType:!0,dataName:"attachmentViewer",iconClass:"msi-attachview",title:B("attachViewer"),action:function(){zmsuite.loadAttachView()}}),b.push({iconType:!0,dataName:"settings",iconClass:"msi-settings",title:B("settings"),action:function(){n.Settings.MailSuite.App.openApp()}});for(var c=a.find("ul"),d=0;d<b.length;d++){var e,f=p("<li/>").data({action:b[d].action,name:b[d].dataName}).attr({"data-tooltip-pos":"left","data-tooltip":b[d].title});b[d].iconType===!0&&(e=p("<i/>",{"class":b[d].iconClass})),b[d].id&&f.attr("id",b[d].id),b[d].child&&f.prepend(b[d].child),p(f).append(e),p(c).prepend(f)}c.on("click",function(a){var b=p(a.target).closest("li"),c=b.data("action");c()})},H=function(){var a=j.getRHSNavBarContainer(),b=d;b.append(a),G(b),E(b)},I=function(){var a;if(!n.fromOtherService){var b="//"+n.urls.contactsURL+"/file?fs=thumb&nocache="+Date.now();a=p('<li><img src = "'+b+'"></li>'),p(".zmTopNav ul").append(a),p(a).data({name:"profile"}),l.tooltip({elm:a[0],text:B("myProfile"),arrow:"right"})}n.fromOtherService||p(a).off("click").on("click",function(a){a.stopPropagation();var b=p('<div id = "zmUserProfile" class = "zmUserProfile"></div>');p(".zmUserProfile").remove(),p(document.body).append(b),setTimeout(function(){p(b).addClass("shw")},100);var c=l.loadingBand({container:b[0],type:"pagination"});o.load("userProfileUtil").done(function(){var a={},d=n.userProfile.getProfileInfo();a.basicInfo={name:n.IAMFullName,emailId:n.user.loginName,userId:n.zuid,photo:"//"+n.urls.contactsURL+"/file?fs=thumb&nocache="+Date.now(),myAccount:n.urls.accURL,signOut:n.logoutURL};var e=p("<div style='top:150px;' class = 'zmUPscroll'></div>"),f=n.userProfile.init(a,b);b.append(f.baseInfo),b.append(f.closeIcon),c(),p(b).prepend(e),l.loadingBand({container:e[0],type:"pagination"}),d.done(function(c,d){a.usage={},a.biz={},d&&d.info&&(n.isAdmin=d.info.isAdmin),a.biz.info=d.info;for(var f=d.links.length,g=0;g<f;g++)"UPG"===d.links[g].linkType?a.biz.upgrade=d.links[g]:"SUB"===d.links[g].linkType?a.biz.subscription=d.links[g]:"CP"===d.links[g].linkType?a.biz.controlPanel=d.links[g]:"EMH"===d.links[g].linkType&&(a.biz.mailHosting=d.links[g]);a.usage.curUsage=c.curUsage,a.usage.allotedUsage=c.allotedUsage,a.usage.docsUsage=c.docUsage;var h=n.userProfile.storageInfoCore(a);p(e).remove(),n.isFuji||!a.biz.info||"undefined"==typeof a.biz.info.superAdmin?p(b).find("#superAdmin").remove():a.biz.info&&a.biz.info.superAdmin?p(b).find("#sText").text(a.biz.info.superAdmin):p(b).find("#superAdmin").remove(),p(b).prepend(h.userPlan);var i=p(b).find(".zmUserData")[0].getBoundingClientRect().height,j=p(b).find(".zmUPscroll");j[0].style.top=i+"px",p(j).on("scroll",function(){j.scrollTop()>0?p(b).addClass("scrolled"):p(b).removeClass("scrolled")})})})})},J=function(){n.hamburgerDeferred.done(function(){k.isHidden("topbar:apps")||z()}),A(),H(),C(),n.fromOtherService||I()},K=function(a){y(),J()},L=function(){var a=p("#jsZmTopWhatsNew");a.hasClass("zmWhatsNew")||a.addClass("zmWhatsNew"),s=!0},M=function(){var a=p(".SC_top").outerHeight(),b=p("#jsZmTopBandSearch");return{top:a,left:b.offset().left,width:b.outerWidth()}},N=function(){var a,b,c,d={},e=x();d.tab=e.find(".zmTtab")[0];var f=e.find(".zmTopNav li");for(a=0;a<f.length;a++)b=p(f[a]),c=b.data("name"),d[String(c)]=b[0];return d.notification=e.find(".zmNotiIW")[0],d.search=e.find(".zmSearch")[0],d},O=function(){for(var a,b,c={},e=d.find("li"),f=0;f<e.length;f++)a=p(e[f]),b=a.data("name"),c[String(b)]=a[0];return c},P=function(){return p("#jszmRHS")},Q=function(){return p("#jsZmChatBarIcons")};return i.updateNotificationCount=D,i.getTopBandElements=N,i.getRHSElements=O,i.getSearchPosition=M,i.onSearchOpen=v,i.onSearchClose=w,i.hideWhatsNew=u,i.showWhatsNew=L,i.init=K,i.getRHSDOM=P,i.getRHSBottomDOM=Q,i.addRHSCustomElements=F,i.getTopbarElementRef=x,i});
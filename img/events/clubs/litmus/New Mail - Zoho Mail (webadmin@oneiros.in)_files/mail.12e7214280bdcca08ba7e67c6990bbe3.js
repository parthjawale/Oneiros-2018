"use strict";!function(a){var b,c,d,e={},f={},g="c",h="previouslySelected",i="expanded",j=ZMail.lConstants,k=j.cls;e.init=function(a){b=a.doAfterMailSelection,c=a.updateMailSelectionView,d=a.isThreadExpanded},e.isChildId=function(a){return a.indexOf(g)!==-1},e.getRawId=function(a){return a.replace(g,"")},e.getViewObjectStore=function(a){return a=a||zmTab.currentTab,f[a]||{}},e.getViewObject=function(a,b){return e.getViewObjectStore(b)[a]},e.setViewObject=function(a,b,c){c=c||zmTab.currentTab;var d=f[c]||{};d[a]=b,f[c]=d},e.dropViewObjectStore=function(a){a=a||zmTab.currentTab,delete f[a]};var l=function(a,b){if(a&&a.isSelected!==b)return void 0===b&&(b=!a.isSelected),a.isSelected=b,c(a.$element,b),!0};e.selectMail=function(a,c,d){var f=l(e.getViewObjectStore(d)[a],c);f&&b(c,{msgId:a,type:"single"})},e.selectMails=function(a,c,d){var f,g=e.getViewObjectStore(d),h=a.length;if(g){for(f=0;f<h;f++)l(g[a[f]],c);b(c,{type:"multiple"})}},e.getChildrenIdsOf=function(a,b){var c=zmUtil.getMailObj(a);if(!c)return b;var d,e=zmList.getViewBasedMsgList(c.T,zmInit.getListingDetObj()),f=e.length;for(b=b||[],d=0;d<f;d++)b.push(g+e[d]);return b};var m=function(a,b){a=a||[];var c,d,f=a.length;for(d=0;d<f&&!(c=e.getViewObject(a[d],b));d++);return c};e.getViewParentOf=function(a,b){a=e.getRawId(a);var c=zmUtil.getMailObj(a,"T"),d=m(zmList.getViewBasedMsgList(c,zmInit.getListingDetObj(),!0),b),f=zmUtil.getListMap(c);if(f&&(d=d||m(f.MO,b)),!d&&1===zmail.convSortOrder){var g=zmList.getDupThdRowId(a,zmUtil.getFolId());g&&(d=e.getViewObject(g,b))}return d},e.isChildrenAreSelected=function(a){a=e.getRawId(a);var b,c,d=zmList.getViewBasedMsgList(zmUtil.getMailObj(a,"T"),zmInit.getListingDetObj()),f=d.length;for(c=0;c<f;c++)if(b=e.getViewObject(g+d[c]),b&&!b.isSelected)return!1;return!0},e.getAllViewObjectIds=function(a){var b,c,d,f=[],g=e.getMailOrders(),h=g.length;for(d=0;d<h;d++)b=g[d],f.push(b),c=e.getViewObject(b),a?e.getChildrenIdsOf(b,f):c&&c.$element.next("."+k.thdChild).is(":visible")&&e.getChildrenIdsOf(b,f);return f},e.setPerviouslySelected=function(a,b){var c=e.getViewObjectStore(b);c[h]=a},e.getPerviouslySelected=function(a){var b=e.getViewObjectStore(a);return b[h]},e.setExpanded=function(a,b){var c=e.getViewObjectStore(b);c[i]=a},e.getExpanded=function(a){var b=e.getViewObjectStore(a);return b[i]},e.handleForChildSelection=function(a,b){if(e.isChildId(a)){var c=e.getViewParentOf(a),d=b&&e.isChildrenAreSelected(a);e.selectMail(c.id,d)}},e.filter=function(a){var b,c,f,g,h,i,j,k,l,m=[];for(b=e.getMailOrders(),j=b.length,k=0;k<j;k++)if(c=b[k],g=d(c)&&e.getChildrenIdsOf(c)||[],h=g.length){for(i=[],l=0;l<h;l++)f=g[l],a(e.getRawId(f))&&i.push(f);h===i.length&&m.push(c),m=m.concat(i)}else{var n=a(c);n&&m.push(c)}return m},e.readfilter=function(a){var b=zmUtil.getMailObj(a);return 0===b.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?1===b.S:1===b.TS},e.unreadfilter=function(a){var b=zmUtil.getMailObj(a);return 0===b.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?0===b.S:0===b.TS},e.flaggedfilter=function(a){var b=zmUtil.getMailObj(a);return 0===b.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?void 0!==b.NFG&&"0"!==b.NFG:b.TI||b.TF||b.TM},e.taggedfilter=function(a){var b,c=zmUtil.getMailObj(a);return 0===c.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?(b=c.TAG,b&&b.length>0):(b=c.TTAGS,b&&b.length>0)},e.attachmentfilter=function(a){var b=zmUtil.getMailObj(a);return 0===b.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?1===b.AT:1===b.TA},e.hasElement=function(a,b){var c=e.getViewObjectStore(b),d=c[a];if(d){if(document.contains(d.$element[0]))return d;delete c[a]}return!1},e.getMailOrders=function(a){a=a||zmTab.currentTab;var b;return a.indexOf("zm_srch")>=0?b=zmSearchUtil.getSearchList():(b=zmUtil.getListMap(zmUtil.getFolId()),b&&b.MO||[])},e.init({doAfterMailSelection:function(a,b){var c=zmList.getElemObj();(c.mainElem.hasClass("SC_sw")||c.mainElem.hasClass("SC_swB"))&&(a?zmPrev.setCountinPreview(c):zmPrev.removeCountinPreview(c)),zmList.updateSelectionCount(zmTab.currentTab);var d=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");zmList.isAllListingChecked(c.listElem)?d.removeClass().addClass("msi-uncheck msi-check"):zmList.isListingChecked(c.listElem)?d.removeClass().addClass("msi-uncheck msi-partcheck"):(d.removeClass().addClass("msi-uncheck"),zmList.resetSelectionInfo()),zmUtil.removeDocSelection();var e,f="zm_srch1"===zmTab.currentTab,g=zmUtil.getCheckedMailList(),h=g[0].length+g[1].length,i="zm_srch1"===zmTab.currentTab?"zm_srch1":"zm_Container";if(a){var j=b.msgId&&"c"===b.msgId.charAt(0)?b.msgId.substring(1):b.msgId;if(0===h||h>2&&"single"===b.type)return;e="single"===b.type?0!==h&&(h>1||g[1].length)?{view:zmInit.getListingDetObj(),isSearchView:f}:{msgId:j,isSearchView:f}:{view:zmInit.getListingDetObj(),isSearchView:f},e.type="functional",e.tabId=i,zmTopMenus.util.show(e)}else a||h||zmTopMenus.util.hide({type:"functional",tabId:i})},updateMailSelectionView:function(a,b){b?a.addClass(k.chkBox):a.removeClass(k.chkBox)},isThreadExpanded:function(a,b){if(!e.isChildId(a)){var c=e.getViewObjectStore(b),d=c[a];if(d.$element.next("."+k.thdChild).is(":visible"))return!0}return!1}}),a=a||{},a.mailObjectAPI=e}(zmCenterListing),define([],function(a){var b=zmail.Core.Namespaces,c=b.create("ZMail.lView"),d=a("zmText").get("mail").listing.common,e=a("ZMail.lConstants"),f={},g=void 0;return f.checkbox=function(a){var b=zdom("div",{"class":"zmLChk","data-action":"checkbox"});return a.shwChkBox&&b.appendChild(zdom("i",{"class":"msi-uncheck"})),b},f.envelope=function(a){if(g=zmAdHocSettings.getCustomizeMailListing(),a.hasOwnProperty("envelope")&&a.envelope||!parseInt(g.envelope)){var b=["msi-rpd","msi-fwd","msi-fwdRpd"],c=b.indexOf(a.iconCls)!==-1,d=zdom("div",{"class":"zmLType jsEnvelope","data-action":"envelope"},zdom("i",{"class":a.iconCls+" zmLTicon"}));return c&&_zm(".",a.iconCls,d)[0].appendChild(zdom("i",{"class":"path"})),d}return""},f.threadCount=function(a){return zdom("span",{"class":"jsThdCount",title:d.tooltip.showHideConversation},a.count)},f.flag=function(a){return g=zmAdHocSettings.getCustomizeMailListing(),a.hasOwnProperty("flag")&&a.flag||!parseInt(g.flag)?zdom("div",{"class":"zmLFg","data-action":"flag"},zdom("i",{"class":a.iconCls})):""},f.sender=function(a){var b=a.tooltip&&_zm.unescapeTags(a.tooltip)||"";return zdom("span",{"class":"zmLSender",title:b},_zm.unescapeTags(a.from))},f.draft=function(a){var b=[a.draftCount,a.draftCount>1?d.draftPlural:d.draft].join(" ");return zdom("span",{"class":"zmLDft"},zdom("span",null,b))},f.commentCount=function(a){g=zmAdHocSettings.getCustomizeMailListing();var b="";return parseInt(g.commentcount)||(b=zdom("span",{"class":"zmLCmnt zmThmClr","data-action":"commentcount"}),a.hasOwnProperty("cmtCount")&&a.cmtCount&&b.appendChild(zdom("span",null,a.cmtCount,zdom("i",{"class":"msi-lcmnt"})))),b},f.attachment=function(a){return g=zmAdHocSettings.getCustomizeMailListing(),a.hasOwnProperty("attachment")&&a.attachment||!parseInt(g.attachment)?zdom("i",{"class":"msi-attachicon","data-action":"attachment"}):""},f.subject=function(a){return zdom("span",null,zmUtil.replaceHTMLEntities(a.subject))},f.summary=function(a){var b=" - "+zmUtil.replaceHTMLEntities(a.summary);return zdom("span",{"class":"zmLSum"},b)},f.labels=function(a){if(a.hasOwnProperty("labels")&&a.labels||!parseInt(g.label)){var b={constructOuterDiv:!0,maxLblCnt:3,customAttribute:{key:"data-action",value:"label"}};zmUtil.getFolId()===zmail.folId.teId&&(b.mode="template");var c=zdom("div",{"class":"jsLabel"});return c.innerHTML=zmsTemplates.constructTagListHTML(a.tagLst,!0,4,"",b),"string"===a.ty?c.outerHTML:c}return""},f.quickAction=function(a){return zdom("span",{"class":"zmLBtn"+a.disableCls+" jsQukAct","data-action":"viewAction",title:a.tooltip},zdom("span",{"class":"jsQukAct"},a.quickAct),zdom("i",{"class":a.icon+" jsQukAct"}))},f.folderName=function(a){return g=zmAdHocSettings.getCustomizeMailListing(),a.hasOwnProperty("folder")&&a.folder||!parseInt(g.thread)?zdom("div",{"class":"zmLFolder jsFolName","data-action":"folder"},a.folName):""},f.mds=function(a){return zdom("div",{"class":"zmLSendSts "+e.jsCls.mdsStaus,title:a.tooltip},zdom("div",{"class":"zmSndStsCon "+a.mdsParentCls},zdom("span",{"class":"zmSndStsIco"},zdom("i",{"class":a.iconCls+" "+e.jsCls.mds}))))},f.RSICON=function(a){var b=zdom("div",{"class":"zmLSendSts "+e.jsCls.mdsStaus,title:a.tooltip},zdom("div",{"class":"zmSndStsRecall "+a.cls},zdom("span",{"class":"zmSndStsRIco"})));return a.gif?_zm(".","zmSndStsRIco",b)[0].appendChild(zdom("img",{src:zmResource.get("image","mail/recall-2x.gif"),width:"18px"})):_zm(".","zmSndStsRIco",b)[0].appendChild(zdom("i",{"class":"msi-recall "+e.jsCls.mds})),b},f.date=function(a){return g=zmAdHocSettings.getCustomizeMailListing(),a.hasOwnProperty("isDateAdhoc")&&a.isDateAdhoc||!parseInt(g.date)?zdom("div",{"class":"zmLDate","data-action":"date"},a.date):""},f.size=function(a){var b="";return g=zmAdHocSettings.getCustomizeMailListing(),(a.hasOwnProperty("isSizeAdhoc")&&a.isSizeAdhoc||!parseInt(g.size))&&(b=zdom("div",{"class":"zmLSize","data-action":"size"}),a.size&&(b.innerText=a.size)),b},f.trash=function(a){return g=zmAdHocSettings.getCustomizeMailListing(),a.iconCls&&(a.hasOwnProperty("delete")&&a["delete"]||!parseInt(g["delete"]))?zdom("div",{"class":"zmLTrash","data-action":"delete"},zdom("i",{"class":a.iconCls})):""},f.associate=function(a){return zdom("span",{"class":a.iconCls})},f.unReadCount=function(a){var b=a.unReadCount+" "+d.unreadTooltip;return zdom("span",{"data-action":"unReadCount",title:b,"class":a.unReadCountCls},"("+a.unReadCount+")")},c.constTemplate=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=f[a];return c?f[a](b):""},c}),define([],function(a){var b=zmail.Core.Namespaces,c=b.create("ZMail.lView"),d=a("zmCenterListing"),e=a("zmText").get("mail").listing.common,f=d.getMappedClass,g=ZMail.lConstants,h=g.jsCls,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0;c.constPart=function(a,b){var c=void 0;Object.keys(a).forEach(function(d){c=a[d](),c&&b.appendChild(c)})},l={},l.envelope=function(){var a=f(i,j,k,"markupIcons"),b=f(i,j,k,"calEvent"),d=f(i,j,k,"att"),e=a||b?a||b:d;return!!e&&c.constTemplate("envelope",{iconCls:e})},l.checkbox=function(){return c.constTemplate("checkbox",{shwChkBox:k.selBoxVisibility})},l.flag=function(){var a=f(i,j,k,"flagIcon");return!!a&&c.constTemplate("flag",{iconCls:a})},l.threadIcon=function(){var a=k[i.count]||k.count||"",b=zdom("div",{"class":"zmLTct","data-action":"thread"});return a===-1?b.appendChild(zdom("i",{"class":"msi-thread",title:e.tooltip.loadFullConversation})):a>0&&b.appendChild(zdom("span",{"class":h.thdCount,title:a>1?e.tooltip.showHideConversation:""}," ",a)),b};var o=function(){var b=void 0,d=f(i,j,k,"draftAdjustWidth")||"";d=" "+d;var e=a("zmAdHocSettings").getCustomizeMailListing(),g="";return"1"===e.envelope&&"1"===e.flag&&(g=" zmLact2CH"),b=zdom("div",{"class":"zmLact"+d+g,"data-action":"pRead"}),c.constPart(l,b),b},p=function(){var a=k[i.draftCount]||k.draftCount||0,b=a&&!k.hideDraftCount,d=zdom("div",{"class":"zmLDCInfo","data-action":"parCCount"}),e=!1;b?(d.appendChild(c.constTemplate("draft",{draftCount:a})),e=!0):d.appendChild(zdom("span",{"class":"zmLDft"}));var f=k.CMT,g=c.constTemplate("commentCount",{cmtCount:f});return""!==g&&d.appendChild(g),{elem:d,haveDraft:e}};m={},m.sender=function(){var a=zdom("div",{"class":"zmLFrom","data-action":"from"}),b=f(i,j,k,"outType")||"",d=k.SCTX||"";b&&a.appendChild(zdom("div",{"class":"zmLSchedule"},zdom("i",{"class":b,title:d})));var e=k[i.from]||k.from||g.SPACE,h=c.constTemplate("sender",{tooltip:k[i.sender]||"",from:e});a.appendChild(h);var l=f(i,j,k,"priority");l&&(l=" "+l,_zm.before(h,zdom("i",{"class":"msi-priority"+l})));var m=k.hasOwnProperty("TUC");if(m&&k.TUC>0){var n=c.constTemplate("unReadCount",{unReadCountCls:"zmLThreadUC zmThmClr",unReadCount:k.TUC});_zm.before(h,n)}var o=p();return a.appendChild(o.elem),o.haveDraft&&_zm.addClass(a,"zmLDftOn"),a},m.titleNsummary=function(){var a=k[i.sub]||k.sub||e.noSubject,b=zdom("div",{"class":"zmLContent"}),d=zdom("span",{"class":"zmLSub","data-action":"subject"}),g=f(i,j,k,"subIcon");if(g){var h=c.constTemplate("attachment");""!==h&&d.appendChild(h)}if(k.sumTxt&&Object.keys(k.sumTxt).length)d.appendChild(k.sumTxt.subject),b.appendChild(d),b.appendChild(k.sumTxt.summary);else{d.appendChild(c.constTemplate("subject",{subject:a})),b.appendChild(d);var l=k[i.sum]||k.sum||"";l&&b.appendChild(c.constTemplate("summary",{summary:l}))}return b},m.labelNqckActs=function(){var a=k[i.tagLst]||k.tagLst||"",b=zdom("div",{"class":"zmLData","data-action":"pLabel"});if(a.length){var d=c.constTemplate("labels",{tagLst:a});"undefined"!=typeof d&&""!==d&&b.appendChild(d)}var e=k[i.schemaText]||k.schemaText||"";if(e){var g=f(i,j,k,"schemaDisable")||"";g=" "+g;var h=k[i.schemaTip]||k.schemaTip||"",l=f(i,j,k,"schemaIcon"),m=c.constTemplate("quickAction",{quickAct:e,icon:l,disableCls:g,tooltip:h});b.appendChild(m)}return b};var q=function(){var a=zdom("div",{"class":"zmLFCD","data-action":"pFolder"});return c.constPart(m,a),a};n={},n.associates=function(){var a=f(i,j,k,"associate");return!!a&&c.constTemplate("associate",{iconCls:a})},n.folName=function(){var a=k[i.fName]||k.fName||"";return!!a&&c.constTemplate("folderName",{folName:a})},n.MDS=function(){var a=k[i.recallStatus]||0;if(a&&a!==-1){var b=f(i,j,k,"recallStatus");return c.constTemplate("RSICON",{tooltip:k.rsTip,cls:b})}var d=k[i.deliverySts]||0;if(d){var e=f(i,j,k,"mdsParentClass"),g=f(i,j,k,"deliverySts");return c.constTemplate("mds",{tooltip:k.mailDeliveryTip,mdsParentCls:e,iconCls:g})}return!1},n.size=function(){var a=k[i.size]||k.size||"",b=k[i.count]||k.count||0;return a=b&&b!==-1?0:a,c.constTemplate("size",{size:a})},n.date=function(){var a=k[i.date]||k.date||"";return!!a&&c.constTemplate("date",{date:a})},n.trash=function(){var a=k[i.iconArr]||k.iconArr||"";return!!a&&c.constTemplate("trash",{iconCls:a[0]})};var r=function(a){var b=a.returnType,d=void 0;i=a.propertyMap,j=a.classMap,k=a.data;var e=k[i.id]||k.id||"",h=" "+f(i,j,k,"unreadCls")||"",l=" "+f(i,j,k,"archive")||"",m=k[i.data]||k.data||"";return d=zdom("div",{id:e,"class":g.cls.mRow+h+l,"data-ty":m}),d.appendChild(o()),d.appendChild(q()),c.constPart(n,d),"dom"===b&&(d=$(d)[0]),d},s=function(){d.registerListItemTemplate({type:"Mail",generator:r})};return s(),c}),zmail.folderCache=function(){var a=function(){this.MO=[],this.showNextPage=0},b=function(b,c,d){var e,f,g,h=c.length,i=[];for(f=new a,e=0;e<h;e++){var j=c[e],k="";if(j.M){k=j.M;var l,m,n=0,o=zmList.getMailObj(k);o?(j.opened=o.opened,g=o.PA,j.TH&&(d||(n=o.TC,j.DC=o.DC||j.DC,j.DMID=o.DMID,l=void 0===o.TS?void 0!==j.TS?j.TS:j.S:o.TS,j.TS=l,j.TI=o.TI||j.TI||!1,j.TM=o.TM||j.TM||!1,j.TF=o.TF||j.TF||!1,m=j.TSN!==o.TSN?o.SN:j.SN,j.SN=m,j.TSM=o.TSM||j.TSM||"",j.TSN=o.TSN||j.TSN||"",j.TTAGS=j.TTAGS||o.TTAGS||[],j.TSB=o.TSB||j.TSB||"",j.TA=o.TA||j.TA,j.TOADDR=o.TOADDR||j.TOADDR,j.TSNADDR=o.TSNADDR||"",j.TC>0&&(n=j.TC),j.TC=n),j.SM=o.SM||j.SM,j.TO=o.TO||j.TO),g&&(j.PA=g),j.opened+=1):j.opened=1,0===j.TC&&(j.TC=1),void 0===j.FD&&j.TAG[0]&&(j.FD=j.TAG[0]),zmList.addModel(j,k),i.push(k)}else void 0!==j.showNextPage?f.showNextPage=j.showNextPage:j.stateinfo?f.showNextPage=j.stateinfo.showNextPage:void 0!==j.showMore&&(f.showNextPage=j.showMore)}return f.MO=i,f},c=function(a,b,c,d){var e,f,g,h,i=zmList.getListObj(c),j=i.MO,k=j.length,l=!1,m=!0,n=0;if(j.indexOf(a)!==-1)return void(m=!1);var o=zmList.getMailObj(a);if(o&&o.T&&(e=o.T,"msg"===d&&(f=zmList.getViewBasedMsgList(e,{fId:c},!0),1===f.length&&zmList.updateModel("TC",1,a))),d&&"newm"!==d)for(g=0;g<k;g++){if(j[g]===a){m=!1;break}if(h=zmList.getMailObj(j[g]),void 0!==e&&h.T===e){if(m=!1,1===zmUtil.getMLConversionValue())if(n=h.TC,zmList.getListObj(e)){for(var p=0;p<f.length;p++)if(b>zmList.getMailObj(f[p]).R){i.MO.splice(g,1),l=!0,m=!0,k=j.length,"thd"===d?zmList.updateModel("TC",o.TC+n,a):zmList.updateModel("TC",n+1,a);break}l||("thd"===d?zmList.updateModel("TC",n+o.TC,j[g]):zmList.updateModel("TC",n+1,j[g]))}else{var q=h.R;b>q?(i.MO.splice(g,1),"thd"===d?zmList.updateModel("TC",o.TC+n,a):zmList.updateModel("TC",n+1,a),k=j.length,m=!0):"thd"===d?zmList.updateModel("TC",n+o.TC,j[g]):zmList.updateModel("TC",n+1,j[g])}l=!1;break}}if(m){if(1===zmail.convSortOrder&&"newm"===d){for(g=k-1;g>=0;g--)if(h=zmList.getMailObj(j[g]),b>h.R){i.MO.splice(g+1,0,a),l=!0;break}}else if(0===zmUtil.getMLConversionValue()&&zmList.sortOrder(c)&&c===zmUtil.getFolId())0===i.showNextPage&&i.MO.push(a),l=!0;else for(g=0;g<k;g++)if(b>zmList.getMailObj(j[g]).R){i.MO.splice(g,0,a),l=!0;break}l||i.MO.push(a),o.T&&0===o.TC&&zmList.updateModel("TC",1,a)}},d=function(a,b,c){var d=zmList.getListObj(b,"MO")||[],e=d.indexOf(a);e!==-1&&d.splice(e,1)},e=function(a){var b=zmList.getMailObj(a);if(b.T){var c,d,e=b.T;if(c="zm_Container"===zmTab.currentTab?zmInit.getListingDetObj():zmsuite.getCenterOuter().$el.data("data-detail"),d=zmList.getViewBasedMsgList(e,c),0===d.length){var f,g=zmPrev.prevDetails().msgId;$("#"+a).length?(f=$("#"+a).parent().prev().attr("id"),f&&(f=f.substring(1))):""!==g&&e===zmList.getMailObj([g]).T&&(f=g),$("#thd"+f).remove(),$("#t"+f).remove()}}},f={dolistObj:function(a,c,d){return b(a,c,d)},updateObj:function(a){switch(a.mode){case"upd":zmList.updateModel(a.key,a.val,a.msgId);break;case"insert":zmList.getListObj(a.folId)&&c(a.msgId,a.rt,a.folId,a.type);break;case"delete":zmList.getListObj(a.folId)&&d(a.msgId,a.folId,a.type),e(a.msgId,a.folId),zmList.updateModel("FD",zmail.folId.tId,a.msgId);break;case"move":var b=zmList.getMailObj(a.msgId);zmList.getListObj(a.rFrom)&&d(a.msgId,a.rFrom,a.type),e(a.msgId,a.rFrom),zmList.updateModel("FD",a.addTo,a.msgId),zmList.getListObj(a.addTo)&&c(a.msgId,b.R,a.addTo,a.type)}},clearListObj:function(a){zmList.clearListObj("unread"),zmList.clearListObj("all"),zmList.clearListObj("flag");var b,c=zmList.getListObj("","",!0);for(b in c)(zmUtil.isFolderId(b)||zmUtil.isSharedFolder(b)||zmUtil.isLabelId(b))&&(a&&zmCache.clearMailObj({listId:b,reinit:!0}),zmList.clearListObj(b))},updateCacheForViews:function(a){var b=0,c=zmUtil.getFolId(),d=zmList.getListObj(c,"MO");b=$.inArray(a,d),b!==-1&&d.splice(b,1)},clearSearchList:function(){var a,b,c=zmSearchUtil.getSearchList(),d=c.length;for(a=0;a<d;a++)b=c[a],!b||zmList.isMailListedInApp(b)||zmUtil.isMailContentInUse(b)||zmUtil.isDraftMail(b)||zmList.removeModel(b)},clearSearchMsg:function(a){!a||zmList.isMailListedInApp(a)||zmUtil.isMailContentInUse(a)||zmUtil.isDraftMail(a)||zmList.removeModel(a)},clearMailObj:function(a){var b,c,d=0,e=a.msgId,f=[],g=a.listId&&zmList.getListObj(a.listId);if(!e||zmUtil.isMailContentInUse(e)||zmList.isMailListedInSearch(e)||zmUtil.isDraftMail(e)){if(g){f=g.MO,b=f.length;var h,i;for(d=0;d<b;d++)e=f[d],c=zmList.getMailObj(e),c&&(zmUtil.isMailContentInUse(e)||zmList.isMailListedInSearch(e)||zmUtil.isDraftMail(e)?a.reinit&&c.TH&&(i=c.T,$.publish("/mail/threadUpdated",i)):c.TH?(i=c.T,h=zmList.getListObj(i),h?(h=h.MO,h.forEach(function(a){zmList.getMailObj(a)&&zmList.removeModel(a)}),zmList.clearListObj(i)):zmList.removeModel(e)):zmList.removeModel(e))}}else zmList.removeModel(e)}};return f}(),function(){var a=window.zmInit||{};window.zmInit=a;var b=!1,c=!1,d=0,e=zmText.get("mail"),f=e.leftTree,g=e.listing,h=e.preview,i=e.actions,j=ZMail.lConstants,k=j.cls,l={list:zmTopMenus.util.get("all")},m={list:{left:{leftHTML:""},right:[]}},n=function(){return new Promise(function(b,c){a.isDL?zmAppLoader.load("mailModel").then(function(){b()}):b()})},o=function(){zmAppLoader.load("mailPostLoad")},p=function(a){var b,c,d="",e="",h=!1,j=!1;b={selectFolder:i.bulkaction.common.selectall,selectFolderViewAll:i.bulkaction.common.selectfolder,clearSelection:i.bulkaction.common.clearselection,clearAndSelect:i.bulkaction.common.clearandselectall};var k=function(){var a=['<div id="bulkActBand" class="SC_simg">','<span x-id="message"></span>','<font x-id="action" id="selectOpt"></font>',"</div>"].join(""),b=$(a),c=b.find("[x-id=message]").removeAttr("x-id"),f=b.find("[x-id=action]").removeAttr("x-id");return c.text(e),f.text(d),b[0]},l=function(){var a=['<div x-id="wrapper">','<span x-id="message"></span>','<font x-id="action" id="clearSelect"></font>',"</div>"].join(""),b=$(a),c=b,f=b.find("[x-id=message]").removeAttr("x-id"),g=b.find("[x-id=action]").removeAttr("x-id");return f.text(e),g.text(d),$(c.children())};return a.isBulkActionSet=!1,a.toggleListingBand=function(b){b?a.SpamTrashBand.setBand():a.SpamTrashBand.removeBand()},a.createBulkActionBand=function(f,g){if(g&&f){var i,l;l="zm_srch1"===zmTab.currentTab?zmsuite.getCenter()[0].getNodes()[2].$el:$(zmail.mailCenter.listElem),a.toggleListingBand(!1),a.removeBulkActionBand(),d=b[g],e=f,i=k(),c=$(i),c.find("#selectOpt").off("click").on("click",function(){a.isBulkActionSet=!0,a.showClearSelectionBand();var b=_zm.getDOM(["DIV",{attrs:{"class":"SC_Pop noanim wht",style:"top: 90px;z-index:0;"}}]);zmList.updateSelectionCount(zmTab.currentTab),zmsuite.getCenter()[0].$el.append(b)}),l.before(i),zmsuite.getCenter()[0].$el.addClass("SC_trsh"),h=!0,j=!0,zmUtil.applyLBDots(c)}},a.showClearSelectionBand=function(){var h;d=b.clearSelection,e=g.selmenuopt.all+" "+f.common.emailsel,h=l(),c.html(h),c.find("#clearSelect").off("click").on("click",function(){a.isBulkActionSet=!1,zmList.unchkAll()}),zmUtil.applyLBDots(c)},a.toggleBulkActionBand=function(a){a?!j&&h&&(c.show(),j=!0):j&&(c.hide(),j=!1)},a.removeBulkActionBand=function(){h&&(c.remove(),h=!1,p.isBulkActionSet=!1,zmsuite.getCenter()[0].$el.find(".noanim.wht").remove(),zmsuite.getCenter()[0].$el.removeClass("SC_trsh"),p.toggleListingBand(!0))},a}({});p=function(b){b=b||{};var c=['<div id="listingBand" class="SC_simg js-spam-trash-band">','<font id="emptyTSP" x-id="empty"></font>','<font id="helpET" x-id="more"></font>','<span x-id="message"></span>',"</div>"].join(""),d=function(a){a=a||{};var b=$(c);b.children().addClass("SC_ldot");var d={};return b.find("[x-id]").each(function(a,b){b=$(b),d[b.attr("x-id")]=b,b.removeAttr("x-id")}),"spam"===a.mode?($(d.empty).text(f.foldercontextmenu.emptyspam),$(d.message).text(f.foldercontextmenu.spamdelete),$(d.more).remove()):"trash"===a.mode&&($(d.empty).text(f.foldercontextmenu.emptytrash),$(d.message).text(f.foldercontextmenu.trashdelete),$(d.more).text(f.foldercontextmenu.lrnmore)),"undefined"!=typeof a.emptyAction&&$(d.empty).on("click",a.emptyAction),"undefined"!=typeof a.moreAction&&$(d.more).on("click",a.moreAction),a.hideEmpty&&$(d.empty).remove(),b},e=function(){return $(zmail.mailCenter.listElem)},g=function(){var b,c="",f=function(){var b=a.getListingDetObj()||{};b.fId!==zmail.folId.tId&&b.fId!==zmail.folId.spId||zmail.Folder.EventHandlers.emptyFolContextMenu(b.fId)},g=function(){var a="//www.zoho.com/mail/help/deleting-mail.html#alink3";zmail.isFuji&&(a="ja"===zmail.user.lang?"//www.skydesk.jp/ja/apps/mail/help/deleting-mail.html#alink3":"//www.skydesk.jp/en/apps/mail/help/deleting-mail.html#alink3"),window.open(a,"_blank").focus()},h=function(){if(c){b&&b.remove();var a=e(),h=0===a.find("."+j.cls.mRow).length;b=d({mode:c,hideEmpty:h,emptyAction:f,moreAction:g}),$("#listingBand.js-spam-trash-band").remove(),a.before(b),zmsuite.getCenter("zm_Container")[0].$el.addClass("SC_trsh")}},i=function(){zmsuite.getCenter("zm_Container")[0].$el.find("#bulkActBand").length||zmsuite.getCenter("zm_Container")[0].$el.removeClass("SC_trsh"),b&&(b.remove(),b=void 0)};return{setBand:function(){var b={};"zmlTreeH"===zmail.mailLeft.selLayerId&&(b=a.getListingDetObj()||{});var d=e().hasClass("zms_streams SC_streams"),f=zmInit.getListingDetObj()&&"2"===zmInit.getListingDetObj().attach;d||b.fId!==zmail.folId.spId||f?d||b.fId!==zmail.folId.tId||f?i():(c="trash",h()):(c="spam",h())},removeBand:function(){i()}}},h=function(){$.subscribe("mail/listing/viewchanged",g.setBand)};return h(),b.SpamTrashBand=g(),b}(p);var q=function(){var b=a.getListingDetObj(),c={};if(b.fId===zmail.folId.dId)c.children=[["text",g.emptylist.drafts]];else if(b.fId===zmail.folId.teId)c.children=[["text",g.emptylist.templates+" "],["font",{child:[["text",g.emptylist.composer]]}]],c.action=!0,c.id=b.fId;else if(b.fId===zmail.folId.sId)c.children=[["text",g.emptylist.folder]];else if(b.fId===zmail.folId.spId&&"unread"!==b.view)c.children=[["text",g.emptylist.spam]];else if(b.fId===zmail.folId.tId)c.children=[["text",g.emptylist.trash]];else if(b.fId===zmail.folId.oId)c.children=[["text",g.emptylist.outbox]];else if(b.fId&&"unread"===b.view)c.children=[["text",g.emptylist.unreadfolder]];else if(b.label)if("-1"===b.label)c.children=[["text",g.emptylist.tagview]];else{var d=g.emptylist.filteredtagview,e=zmText.applyArgs(d,{tagname:zmUtil.findTagName(b.label)});c.children=[["text",e]]}else if(b.flag)if("-1"===b.flag)c.children=[["text",g.emptylist.flagview]];else{var f=g.emptylist.filteredflagview,h=zmText.applyArgs(f,{flagname:zmUtil.findFlagName(b.flag)});c.children=[["text",h]]}else b.fId?c.children=[["text",g.emptylist.nomailfolder]]:c.children=[["text",g.emptylist.nomailview]];return c},r=function(a,b){b.id===zmail.folId.teId&&$(a).find("font").on("click",function(){zmUtil.hideMenu(),zmUtil.compose()})},s=function(a){var b,c={};a?b=[["text",a]]:(c=q(),b=c.children);var d=_zm.getDOM(["DIV",{attrs:{"class":"SC_nmsg",id:"nomails"},child:b}]);return c.action&&r(d,c),d},t=function(){c||(c=!0,$.subscribe("/folder/rename",function(){zmList.updateFolderName()})),zmail.onDemandListing&&!zmail.initialListingLoaded&&($.subscribe("/apps/tabSwitching",function(a,b,c){zmInit.loadOnDemandListing(c)}),$.subscribe("mailsuite/appOpened",function(a,b){zmInit.loadOnDemandListing(b)})),$.subscribe("/maction/newm",function(a,b,c){var d,e,f=b.length-1;zmAppLoader.load("NewMailNotifier").then(function(){for(;f>=0;f--){d=b[f],e=d.M,zmList.addModel(d,e);try{zmail.Listing.Notifier.reviewMailNotification(d,c)}catch(a){zmUtil.debugLog("Problem while updating new mail with id "+e+" "+a)}zmList.updateAttachmentCache(e)}})}),$.subscribe("folder/read",function(a,b,c){zmfolAction.loadFolderApp(function(){zmail.Folder.EventHandlers.markFolderAsReadHandler(b,c)})}),$.subscribe("folder/archived",function(a,b,c){zmfolAction.loadFolderApp(function(){zmail.Folder.EventHandlers.markFolderAsArchived(b,c)})}),$.subscribe("/mail/threadUpdated",function(a,b){zmList.updateThreadList(b)}),$.subscribe("/mail/listMails",function(a,b){"undefined"!=typeof zmList&&(b=b||{},zmList.showMailListing(b,{toSelFol:!0,retainPreview:b.retainPreview}))}),$.subscribe("/mail/updatemailview",function(a,b){zmPreviewTemplate.addMailsInView(b)}),$.subscribe("/mail/previewclosed",function(){zmList&&zmList.clearcpvReq()}),$.subscribe("/mail/msgDiscarded",function(a,b){zmUtil.discardMsg(b)}),$.subscribe("/mail/discardFromThread",function(a,b){zmUtil.discardFromThread(b)}),$.subscribe("wmsevents/mail",function(a,b){zmfolAction.loadFolderApp(function(){zmfolAction.handleWMSEvents(b.event,b.notification,b.content)})}),$.subscribe("wmsevents/mail",function(a,b){zmail.MailAction.Initializer.handleWMSEvents(b.event,b.notification,b.content)}),$.subscribe("m/mail_tab",function(a,b){if(!zmail.restoredAccId||zmail.restoredAccId&&zmail.restoredAccId===zmail.accId){var c=$.extend({},b.data);c.src="restore",zmList.getMailData(c)}else b.appId&&zmsuite.closeWorkspace(b.appId)}),$.subscribe("m/mail_attachment",function(a,b){b=b.data,b.attObj.src="restore",zmAttach.util.viewAttachment(b.attObj,b.mode,b.fileExtn)}),$.subscribe("stream/stream_app",function(a,b){var c=b.appId;b=b.data,b.src="restore",zmsuite.getAppObj(c).centerObj.paint(),zmsuite.addLoadingBand(c,"list"),zmUtil.requireStreamsApp().then(function(){zmStreamsApp.init(b.groupId,b.src)})}),$.subscribe("stream/stream_post",function(a,b){b=b.data,b.src="restore",zmUtil.loadStreamsInTab(b)}),$.subscribe("stream/stream_mail",function(a,b){b=b.data,zmUtil.loadStreamsInTab(b)}),$.subscribe("/zm/task/addTask",function(a,b,c){b.TASKID&&zmList.addTaskIndicator(b,c)}),$.subscribe("/note/add",function(a,b,c){b.id&&zmList.addNoteIndicator(b,c)}),$.subscribe("/mail/preview/draftClosed",zmUtil.removeComposer),$.subscribe("/mail/updateSchema",function(a,b){zmAppLoader.load("listingEventHandlers").then(function(){zmail.Listing.Handlers.SchemaActions.updateSchemaAction(b.msgId,b)})}),$.subscribe("FROM_ADDRESS/CHANGE",function(a,b){var c=zmail.cmpdata.FROM_LIST;c[b.emailId]&&(c[b.emailId].FRM_DISN=b.dispName,b.attr.isDefault?c[b.emailId].FRM_SIGMODE=0:b.attr.isGroup?c[b.emailId].FRM_SIGMODE=2:b.attr.isAliasOrGroup&&(c[b.emailId].FRM_SIGMODE=1),!b.attr.isReplyVerified&&zmail.cmpdata.SETREPTO?c[b.emailId].FRM_REPLY=zmail.cmpdata.SETREPTO:b.attr.isReplyVerified||(c[b.emailId].FRM_REPLY=""),b.attr.isReplyVerified&&(c[b.emailId].FRM_REPLY=b.attr.replyTo))}),$.subscribe("FROM_ADDRESS/REMOVE",function(a,b){var c=zmail.cmpdata.FROM_LIST;delete c[b.emailId]}),$.subscribe("FROM_ADDRESS/ADD",function(a,b){if(b.attr.isEnabled){var c=zmail.cmpdata.FROM_LIST;c[b.emailId]={FRM_DISN:b.dispName,FRM_SIGID:"null",FRM_SIGMODE:null},b.attr.isReplyVerified&&(c[b.emailId].FRM_REPLY=b.attr.replyTo),b.attr.isDefault?c[b.emailId].FRM_SIGMODE=0:b.attr.isGroup?c[b.emailId].FRM_SIGMODE=2:b.attr.isAliasOrGroup?c[b.emailId].FRM_SIGMODE=1:c[b.emailId].FRM_SIGMODE=3}})},u=function(){$(zmail.mailCenter.listElem).html(""),zmail.mailCenter.listElem.scrollTop=0,zmCache.clearListObj(),zmTopMenus.util.show({type:"listing",fId:zmUtil.getFolId(),tabId:"zm_Container"}),p.SpamTrashBand.setBand(),p.removeBulkActionBand(),zmCenterListing.mailObjectAPI.dropViewObjectStore("zm_Container")},v=function(){var a=function(a,b){b=b||{};var c=zmAdHocSettings.getSuppressedMessagesState();if("off"!==c.mailShareTip){var d=zmList.getMailObj(b.mailID)||{};if((b.mailID||"forward"!==b.mode)&&!(d&&[zmail.folId.teId,zmail.folId.oId,zmail.folId.dId].indexOf(d.FD)!==-1||d&&zmail.shrTree[0]&&zmail.shrTree[0][d.FD])){var e=zmUtil.getFolderObject(d.FD);e&&"-1"!==e.SH||zmail.MailAction.Initializer.mailShareTip.show()}}};$.subscribe("/mail/forwardmail",a),$.subscribe("/compose/bccpresent",a)},w=function(){var a=this;zmList.showMailListing({folId:a,view:"unread"})},x=function(b){var c,d,e,f,h,i,j,k,l,n,o="zmLink sum unreadCount";if("zmStreamTree"!==zmail.mailLeft.selLayerId){i=a.getListingDetObj(),d=zmail.mailLeft.selId,e=zmail.mailLeft.getSelectedRowObj()[d],f=e.FN||e.dispName||e.name,l=f;var p=zdom("div",null,l);c=zmsuite.getCenter("zm_Container")[0].getNodes()[1];var q=!1,r=function(a){var b={"-1":g.headertitle.flagmsg,1:g.headertitle.infoflagmsg,2:g.headertitle.impflagmsg,3:g.headertitle.followupmsg};return a&&b[a]?zdom("span",{className:o},b[a]):""};if("notification"===b&&c.$el.find(".selCount").is(":visible"))return void c.$el.find(".unreadCount").hide();if("zm_unread"===d)if(h=a.getUnreadViewCount(),h>1){var s=g.headertitle.multiplemail;j=zmText.applyArgs(s,{count:h}),n=zdom("span",{className:o},j)}else 1===h&&(n=zdom("span",{className:o},g.headertitle.singlemail));else if("zm_flag"===d)n=r(i.flag),q="-1"===i.flag?0:1;else if(zmail.folCount[d])if(i.flag)n=r(i.flag),q=!0;else if(i.label)"-1"===i.label?(n=zdom("span",{className:o},g.headertitle.alltagged),q=!0):(j=g.headertitle.filteredtag,k=zmText.applyArgs(j,{tagname:zmUtil.findTagName(i.label)}),n=zdom("span",{className:o},k),q=!0);else if("1"===i.attach)n=zdom("span",{className:o},g.headertitle.attachview),q=!0;else if("archive"===i.view)n=zdom("span",{className:o},g.headertitle.archiveview),q=!0;else if("unread"===i.view){var t;t=d===zmail.folId.sId?g.headertitle.unreadEmails:parseInt(zmail.folCount[d].c)?1===zmail.folCount[d].c?g.headertitle.singleunread:zmText.applyArgs(g.headertitle.multipleunread,{n:zmail.folCount[d].c}):g.headertitle.noUnreadEmails,n=zdom("span",{className:o},t),q=!0}else if("date"===i.sortBy&&i.sortOrder)q=!0,n=zdom("span",{className:o},g.headertitle.oldestOnTop);else if("size"===i.sortBy)q=!0,
n=i.sortOrder?zdom("span",{className:o},g.headertitle.smallestOnTop):zdom("span",{className:o},g.headertitle.largestOnTop);else if(zmail.folCount[d].c>0){var u=g.headertitle.singleunread,v=g.headertitle.multipleunread;d===zmail.folId.oId&&(u=g.headertitle.singleunreadOutbox,v=g.headertitle.multipleunreadOutbox),d===zmail.folId.sId&&(u=g.headertitle.sUndeliveredCount,v=g.headertitle.mUndeliveredCount),1===parseInt(zmail.folCount[d].c)?n=zdom("span",{className:o,"data-attr":"totalUnRead"},u):d!==zmail.folId.teId&&d!==zmail.folId.dId&&(k=zmText.applyArgs(v,{n:zmail.folCount[d].c}),n=zdom("span",{"data-attr":"totalUnRead",className:o},k))}if(n&&p.appendChild(n),q){var x=$(p);x.find(".sum").addClass("SC_folFil"),x.find(".sum").append('<i class = "msi-close"></i>')}if(m.list.left.leftHTML=p.innerHTML,c.push(m.list),c.paint(),n){var y=c.$el.find("[data-attr='totalUnRead']")[0];y&&y.addEventListener("click",w.bind(d),!1)}c.$el.find(".msi-close").off("click").on("click",function(){var a=zmUtil.getFolId();("date"===i.sortBy&&i.sortOrder||"size"===i.sortBy)&&zmList.updateSortProperties(0,a),a="flag"===a?"zm_flag":a,zmList.showMailListing({fId:a})}),"notification"===b&&c.$el.find(".selCount").is(":visible")&&c.$el.find(".unreadCount").hide()}},y=function(a){return a<1024?"1 KB":a<1048576?(a/1024).toFixed(0)+" KB":a<1073741824?(a/1048576).toFixed(0)+" MB":void 0},z=function(b){if(zmsuite.isWorkspaceAvailable("zm_Container")){var c,d=a.getListingDetObj();c=d.fId?parseInt(zmail.folCount[d.fId].c):parseInt(zmail.folCount[zmail.folId.iId].c),(d.fId&&d.fId!==zmail.folId.sId&&d.fId!==zmail.folId.teId&&d.fId!==zmail.folId.dId&&c!==b||!d.fId&&"unread"===d.view&&c!==b)&&a.getFolderTreeCount()}},A=function(a,b){var c,d={};return d.parentDOM=a instanceof $?a:$(a),d.displayAs="dropdown",d.hltPar=!0,d.offsets={left:0,top:-1},d.divId="folderComp",d.excludeList=[zmail.folId.dId,zmail.folId.teId,zmail.folId.oId],d.excludeChild=!0,d.viewDOM=$(zmsuite.getCenterOuter().$el).find(".SCmc"),d.onSelect=function(a){zmail.MailAction.Initializer.doActions("move","drop",{action:"move",folId:a})},d.direction=b,d.onCreate=function(a){zmAppLoader.load("zmFolder").then(function(){zmfolAction.isValidName(a,void 0,{opType:"new"})&&(zmfolAction.sendNewFolderReq(a,{reqDoneClbk:function(a,b){a&&d.onSelect(b)}}),c.hide())})},c=zmUtil.createFLComp("folder-path",d),c.show(),c},B=function(a,b){var c,d={};return d.parentDOM=a instanceof $?a:$(a),d.hltPar=!0,d.displayAs="dropdown",d.labelState={selectedMails:!0},d.direction=b,d.offsets={left:0,top:-1},d.divId="labelComp",d.viewDOM=$(zmsuite.getCenterOuter().$el).find(".SCmc"),d.onStateChange=function(a,b){zmail.MailAction.Initializer.applyActions("label","click",{lA:b?"add":"delete",lId:a,disp:zmail.labInfo[a].dispName})},d.onCreate=function(a,b){zmlab.isValidName(a)&&zmlab.labelCreate(a,"",{reqDoneClbk:function(a,b){a&&(d.onStateChange(b,!0,function(){}),c.hide())},color:b})},c=zmUtil.createFLComp("label",d),c.show(),c},C=function(){var b,c,d,e,f,h=a.getListingDetObj(),i=[],j="",k="",l=0;if(b={unread:g.common.unreadmsg,archive:g.common.archivemsg,all:g.common.allmsg},c={"-1":g.selmenuopt.all,1:g.flagmenu.infoflag,2:g.flagmenu.important,3:g.flagmenu.followup},d={"-1":g.windowtitle.flagfolder,1:g.windowtitle.infoflagfolder,2:g.windowtitle.impflagfolder,3:g.windowtitle.followupflagfolder},h){if(h.fId?(k=a.findFolName(h.fId),l=zmail.folCount[h.fId]&&zmail.folCount[h.fId].c,h.view?(e="unread"===h.view?l?g.windowtitle.unreadfolderwithoutmails:g.windowtitle.unreadfolder:"archive"===h.view?g.windowtitle.archivefolder:g.windowtitle.folder,f=zmText.applyArgs(e,{foldername:k}),i.push(f)):h.flag?(e=d[h.flag],f=zmText.applyArgs(e,{foldername:k}),i.push(f)):h.label?("-1"===h.label?(e=g.windowtitle.tagfolder,f=zmText.applyArgs(e,{foldername:k})):(e=g.windowtitle.filteredtagfolder,f=zmText.applyArgs(e,{foldername:k,tagname:zmail.labInfo[h.label].dispName})),i.push(f)):h.attach?(e=g.windowtitle.attachfolder,f=zmText.applyArgs(e,{foldername:k}),i.push(f)):(e=g.windowtitle.folder,f=zmText.applyArgs(e,{foldername:k}),i.push(f))):h.label?(e=g.windowtitle.tagview,f=zmText.applyArgs(e,{tagname:zmail.labInfo[h.label].dispName}),i.push(f)):h.view?(i.push(b[h.view]),"unread"===h.view&&(l=a.getUnreadViewCount())):h.flag&&("-1"!==h.flag?j=c[h.flag]+" ["+g.common.flagged+"]":j+=g.windowtitle.flagview,i.push(j)),l>0){if("undefined"!=typeof zmUtil){var m=!0;l=zmUtil.commaSeparateNum(l,m)}i.unshift("("+l+")")}return i}},D=function(){var a=function(a,b){b=b||{},b=b.data||{};var c={};if(b.cs&&(c=$.parseJSON(b.cs)[0]||{}),b.error)zmUtil.updOutbox(b);else if(c.event){var d=["moveMail","markFlagged","emptyFolder","folderRead","renameFolder","deleteFolder","moveFolder","addFolder"];"undo_expired"===c.event?window.zmRecall&&zmRecall.removeMessageBand():d.indexOf(c.event)!==-1&&$.publish("wmsevents/mail",{event:c.event,notification:b,content:c})}else b.MDS?zmAppLoader.load("listingEventHandlers").then(function(){zmail.Listing.Handlers.DeliveryStatus.updateMailDeliveryStatus(b)}):zmAppLoader.load("NewMailNotifier").then(function(){zmail.Listing.Notifier.getNewMessage("newm","chat",b)})},b=function(a,b){if(b=b.data||{},b.act){var c=b.act;switch(c){case"MAIL_DELIVERY_STATUS":zmAppLoader.load("listingEventHandlers").then(function(){zmail.Listing.Handlers.DeliveryStatus.updateMailDeliveryStatus(b.data)});break;case"RECALL_STATUS":zmAppLoader.load("listingEventHandlers").then(function(){var a=b.data;ZMail.recall.updateStatus(a.M,parseInt(a.RS))});break;case"UNDO_EXPIRED":window.zmRecall&&zmRecall.removeMessageBand();break;case"NEW_MAIL":zmAppLoader.load("NewMailNotifier").then(function(){zmail.Listing.Notifier.getNewMessage("newm","chat",b)});break;case"OUTBOX_ACTIVITY":zmUtil.updOutbox(b.data);break;case"MARK_FLAGGED":case"MOVE_MAIL":zmail.MailAction.Initializer.handleWMSEvents(c,b,b.data);break;case"EMPTY_FOLDER":case"FOLDER_READ":case"ADD_FOLDER":case"DELETE_FOLDER":case"MOVE_FOLDER":case"RENAME_FOLDER":zmfolAction.loadFolderApp(function(){zmfolAction.handleWMSEvents(c,b,b.data)});break;case"FOLDER_UPDATE":zmfolAction.loadFolderApp(function(){zmfolAction.updateFolProps(b.data)});break;case"BULK_OPR":zmail.MailAction.Initializer.notifyBulkAction(b.data);break;case"NEWUI_SETTINGS_UPDATE":uiStateSyncer.updProperties(b);break;case"WATCH_EXPIRED":var d=window.zmWatch;if(d){b.stat="success";var e={cmpId:b.data["MessageId "],watchMode:"d"};d.updateWatch(b,e)}}}else zmUtil.debugLog("WS notification ignored "+JSON.stringify(b))},c=function(a,b){zmAppLoader.load("sharefolder").then(function(){zmshare.shNotify(a,b)})};zmail.isWSEnabled?zmComponent.notifier.addHandler("mail",b):zmComponent.notifier.addHandler("mail",a),zmComponent.notifier.addHandler("sharedfolder",c)},E=function(){var b=_zm("#","nmenc");b||(b=_zm.getDOM(["DIV",{attrs:{id:"nmenc","class":"SC_mnoti"}}]),document.body.appendChild(b)),a.mNotifier=zmComponent.mailNotifier({parent:b,openMail:function(a){var b=a&&a.M;b&&zmList.getMailData({msgId:b,opentype:2,type:"lt",src:"external",eprm:{accId:zmail.accId}})}}),D()},F=function(a,b){var c=zmsuite.getCenter(a)[0].getNodes()[0].$el.find(".msi-classic,.msi-compact,.msi-superCompact");"0"===b?c.removeClass().addClass("msi-classic"):"1"===b?c.removeClass().addClass("msi-compact"):"2"===b&&c.removeClass().addClass("msi-superCompact")},G=zmsuite.createAppRouter();$.extend(a,{rclkId:0,startFill:!1,leftMain:null,mapObj:{bold:"S",unreadCls:"S",id:"M",data:"data",subIcon:"AT",count:"TC",flag:"NFG",flagIcon:"NFG",date:"DT",from:"F",sub:"SB",sum:"SM",pri:"PR",priority:"PR",tagLst:"TAG",dataAttr:"ty",fName:"FN",iconArr:"ICN",outboxSts:"OBT",att:"S",arch:"AR",archive:"AR",hasTask:"HT",associate:"HT",draftCount:"DC",outType:"OT",outText:"SCTX",calEvent:"HC",schemaIcon:"actionIcon",schemaIconColor:"actionIconColor",schemaDisable:"expired",sender:"fromaddr",deliverySts:"MDS",mdsParentClass:"MDS",adjustWidth:"AW",draftAdjustWidth:"AW",markupIcons:"MUI",size:"SZ",recallStatus:"RS"},classObj:{bold:{0:"zm_urd",2:"zm_urd",3:"zm_urd",7:"zm_urd"},unreadCls:{0:"zmLUrd",2:"zmLUrd",3:"zmLUrd",7:"zmLUrd"},markupIcons:{0:"msi-cart zmDoubleIcon zm_schmIco",1:"msi-flight zmDoubleIcon zm_schmIco"},att:{0:"msi-mail",1:"msi-mail","":"",2:"msi-rpd",3:"msi-fwd",4:"msi-rpd",5:"msi-fwd",6:"msi-edit",7:"msi-fwdRpd",8:"msi-fwdRpd",9:"msi-mail zmHideV"},calEvent:{2:"msi-calendar",3:"msi-calendar zmEvAcc",4:"msi-calendar zmEvDec",5:"msi-calendar zmEvMay",6:"msi-calendar zmEvCan",8:"msi-calendar",9:"msi-calendar",10:"msi-calendar",11:"msi-calendar",12:"msi-calendar"},subIcon:{1:"msi-attachicon"},flag:{0:"msi-flag zmflg jsFlg",1:"msi-flag zmflg zm_fgB jsFlg",2:"msi-flag zmflg zm_fgR jsFlg",3:"msi-flag zmflg zm_fgG jsFlg",4:"msi-priority zm_icn SC_lred",5:"msi-priority zm_icn SC_lgreen",6:"msi-flag msi-multiFlag zmflg zmDoubleIcon jsFlg"},flagIcon:{0:"msi-flag zmLNoFg jsFlg",1:"msi-flag blueFlag jsFlg",2:"msi-flag redFlag jsFlg",3:"msi-flag greenFlag jsFlg",4:"msi-priority zmOBPriority highPriority",5:"msi-priority zmOBPriority mediumPriority",6:"msi-multiFlag zmDoubleIcon jsFlg"},pri:{1:"SC_red",2:"SC_red",4:"SC_blue",5:"SC_blue"},priority:{1:"highPriority",2:"highPriority",4:"lowPriority",5:"lowPriority"},outboxSts:{0:"SC_lred",1:"SC_lgreen"},arch:{1:"zmarch"},archive:{1:"zmLArchive"},hasTask:{1:"SC_mdata"},associate:{1:"zmLAssoc"},outType:{1:"msi-clock",2:"msi-reccur"},schemaIcon:{one_click:"msi-tick","goto":"msi-more",review:"msi-rate",review_comment:"msi-review",rsvp:"msi-rsvp"},schemaIconColor:{one_click:"zmlbtn_green","goto":"zmlbtn_red",review:"zmlbtn_orange",review_comment:"zmlbtn_blue",rsvp:"zmlbtn_blue"},schemaDisable:{1:"zmlbtn_disable"},deliverySts:{0:"",1:"msi-mailQue",2:"msi-mailQue",3:"msi-mailQue",4:"msi-mailQue",5:"msi-mailSuc",6:"msi-mailFail",7:"msi-mailFail",8:"msi-mailUndo",9:"msi-mailRetry",10:"msi-mailRetry"},mdsParentClass:{0:"",1:"",2:"zmSndSts-pro",3:"zmSndSts-pro",4:"zmSndSts-pro",5:"zmSndSts-suc",6:"zmSndSts-fail",7:"zmSndSts-fail",8:"zmSndSts-fail",9:"zmSndSts-failB",10:"zmSndSts-fail"},adjustWidth:{1:"lsWidth"},draftAdjustWidth:{1:"zmLact2CV"},recallStatus:{1:"zmSndSts-Inpro",2:"zmSndSts-partial",3:"zmSndSts-fail",4:"zmSndSts-suc",5:"zmSndSts-fail"}},prevHeader:{id:"zmPrevHeader",text:"Preview Text",rIcons:[[{tooltip:i.iconTooltip.prev,iconClass:"msi-prev",data:{action:"msi-prev"}},{tooltip:i.iconTooltip.next,iconClass:"msi-next",data:{action:"msi-next"}}],[{tooltip:i.iconTooltip.popout,iconClass:"msi-popout",data:{action:"openwindow",from:"header"}}],[{tooltip:i.iconTooltip.close,tooltipDir:"right",iconClass:"msi-close",data:{action:"clsPrev"}}]]},initMailAppRouter:function(){G.initialize({hashKey:"mail",handler:zmUrlAct.manualHandler}),G.activate();var b=zmHash.decode();zmail.onDemandListing&&b.key&&(zmail.initialPageTrigger.hash=!0),!b.key||"mail"===b.key&&"tab"===b.params[0]||"mail"===b.key&&!b.params.length?a.lPageType()?(G.setParams(["folder","inbox"]),G.update()):(G.setParams(["views","unread"]),G.update()):"mail"!==b.key&&(a.lPageType()?G.setParams(["folder","inbox"]):G.setParams(["views","unread"]))},init:function(){var b={appname:"Mail",appId:"zm_Container",appIcon:"msi-mail",faqKey:"mail listing",searchPlaceHolder:zmText.get("mailsuite").searchMail,data:{LNodes:"2",CNodes:"3"},stateData:{type:"app",data:{accId:zmail.accId,listing:{view:{fId:zmail.folId.iId,view:"",viewId:""},expand:{mId:""}},preview:{p:""}}},handler:{create:function(){_zm.isSmartComposeEnabled()&&zmail.fromOtherService!==!0?zmUtil.loadSmartCompose({eType:"6",type:"tab"}):zmUtil.compose()}},shortcuts:zmshCut.mail,titleProvider:C,sortLeftLayers:!0,appBodyClassName:"SC_mailApp",router:G};zmsuite.setAppInfo(b),zmWinTitle.registerDefaultProvider(C),zmail.postJsDeffered.promise.then(function(){zmail.onDemandListing||a.initMailAppRouter()}),$.subscribe("/mail/accountSwitch",function(b,c){c=c||{},"success"===c.status&&(a.lPageType()?G.update(["folder","inbox"]):G.update(["views","unread"]))})},initials:function(){if(zmail.outboxFail){var a=zmsuite.getAppObj("zm_Container").centerObj.$el,b=e.global.notifoutbox,c=["DIV",{attrs:{id:"zm_outboxfail","class":"SC_msg SC_emsg"},child:[["SPAN",{}]]}],d=_zm.getDOM(c);a.append(d),b+=" <i class='msi-close' onclick='zmInit.outboxClose();'></i>",$("#zm_outboxfail").children("span").html(b),zmUtil.updSendErrorStatus(!0,zmail.folId.oId)}$("#MS_action span").unbind("click").click(function(){zmUtil.compose()}),$("#zmsignout").unbind("click").click(function(){location.href=zmail.logoutURL})},outboxClose:function(){$("#zm_outboxfail").remove()},sendLoadOutbox:function(a){if("hide"===a)$("#zm_outbox_send_load").remove();else{var b="Loading",c=["DIV",{attrs:{id:"zm_outbox_send_load","class":"SC_msg SC_imsg"},child:[["SPAN",{}]]}],d=_zm.getDOM(c);$("body").append(d),$("#zm_outbox_send_load").children("span").html(b)}},loadOnDemandListing:function(b){if("zm_Container"===b&&!zmail.initialListingLoaded)if(zmail.initialPageTrigger.restore&&"m"===zmail.restoredApp){var c=zmState.getStoredSessionState().state.data.app.data,d=$.Deferred();$.when(d).then(function(){var a=$.Deferred();c.listing.expand.mId?zmRestore.expandThread(c.listing.expand.mId,a):a.resolve(),$.when(a).then(function(){window.setTimeout(function(){c.preview.p&&zmRestore.restorePreview(c.preview.p)},400)})}),zmList.showMailListing(c.listing.view,{retainPreview:!1,sortAscending:void 0,mlDefObj:d})}else zmail.mailLeft.selId?zmList.showMailListing({fId:zmail.mailLeft.selId}):a.lPageType()?zmList.showMailListing({fId:zmail.folId.iId}):zmList.showMailListing({fId:"zm_unread"})},initMailList:function(){var b,c="",d={},e={},f={};1===a.lPageType()?(c=zmail.folId.iId,b=c,e={fId:c,view:"",label:"",flag:"",attach:""},f={fId:c,view:"",lId:"",flag:"",attach:""}):(c="zm_unread",b="unread",e={fId:"",view:"unread",label:"",flag:"",attach:""},f={fId:"",view:"unread",lId:"",flag:"",attach:""}),d=a.cacheDataObj(zmail.mailList,b,1),a.setListingDetObj(e),f.showNxt=d.showNextPage,a.mailList(d.MO,f),zmTopMenus.util.show({type:"listing",fId:b,tabId:"zm_Container"})},constructView:function(b){b&&(zmail.folId=b.folId,zmail.folTree=b.folTree,zmail.folCount=b.folCount,zmail.labInfo=b.labInfo,zmail.viewInfo=b.viewInfo,zmail.mailOpt=b.mailOpt),1===zmail.folviewThread&&(zmail.folviewThread=2);var c,d,e,f;for(c in zmail.folTree[0])e=zmail.folTree[0][c],1===e.CV&&(e.CV=2);for(d in zmail.folTree[1]){f=zmail.folTree[1][d].CH;for(c in f)e=f[c],1===e.CV&&(e.CV=2)}var g=zmUtil.getNonConversationFolders(),h=0,i=g.length;for(h=0;h<i;h++)zmail.folTree[0][g[h]].CV=0;if(zmail.shrTree=zmail.shrTree||[],zmail.shrLabelTree=zmail.shrLabelTree||[],zmail.showFeature&&zmail.shrLabelTree.length){var j=$.extend({},zmail.shrTree[0],zmail.shrLabelTree[0]);zmail.shrTree[0]=j}zmail.zohoAccLabInfo||(zmail.zohoAccLabInfo=zmail.labInfo),zmail.mailObj={},zmail.listObj={},zmail.sortOrder=!zmail.mailOpt.isDesc,zmail.mailLeft=zmsuite.getLeft(),a.setListingDetObj({}),zmail.folCount[zmail.folId.sId].c="0",zmail.folCount[zmail.folId.dId].c="0",a.translateSystemFolders(),a.constructLeft(),a.constructCenter(),a.constructRight(),zmsuite.showExistingApp("zm_Container"),zmail.mailCenter=zmsuite.getCenter(),zmail.mailCenter.listElem=zmail.mailCenter[0].getNodes()[2].$el[0],zmail.mailCenter.listObj=zmail.mailCenter[0].getNodes()[2],zmail.mailCenter.prevElem=zmail.mailCenter[1].$el[0],zmail.mailCenter.prevObj=zmail.mailCenter[1],zmail.mailCenter.prevObj.getNodes()[0].setListener("click",function(a,b){zmList.bindAction(a,b)})},zmfnPrecall:function(){zmail.win.zmCache=zmail.folderCache},getSuppressedFolders:function(){zmfolAction.getNotificationSuppressedFolders(zmail.accId).then(function(a){zmail.notificationSuppressedFolders=a.folderList||[]})},isNotificationSuppressed:function(a){return!(!a||!zmail.notificationSuppressedFolders||zmail.notificationSuppressedFolders.indexOf(a)===-1)},updateSuppressedFolders:function(a,b){zmail.notificationSuppressedFolders=zmail.notificationSuppressedFolders||[];var c,d=a.length;if(b)for(c=0;c<d;c++)zmail.notificationSuppressedFolders.indexOf(a[c]===-1)&&zmail.notificationSuppressedFolders.push(a[c]);else for(c=0;c<d;c++)zmail.notificationSuppressedFolders.indexOf(a[c]===-1)&&zmail.notificationSuppressedFolders.pop(a[c])},lPageType:function(){try{var a=zmail.Settings.Platform.Components.SettingManager.get("startup-action").get();if("new-session"===a)return zmail.mailOpt.isFol;if(a=zmail.Settings.Platform.Components.SettingManager.get("mail-app-startup").get(),"inbox"===a)return 1;if("unread"===a)return 0}catch(b){return zmUtil.debugLog(b),1}},initMailSuite:function(){a.isDL=!1,a.isFlex=!0,n().then(function(){if(zmshCut.currentLeftId=1===a.lPageType()?zmail.folId&&zmail.folId.iId:"zm_unread",a.isDL&&ZMail.listing.init.registerCollection(),zmfolAction.updateSFProperty(),zmUrlAct.init(),a.zmfnPrecall(),a.init(),a.constructView(),a.initials(),null===zmail.mailList){if(zmail.onDemandListing=!0,zmail.initialPageTrigger={hash:!1,restore:!1,setting:!1},zmail.initialListingLoaded=!1,a.initMailAppRouter(),!zmail.initialPageTrigger.hash&&"restore"===zmAdHocSettings.getLPageType()){zmail.initialPageTrigger.restore=!0;var b=zmState.getStoredSessionState().state;if(b&&b.data.app&&(zmail.restoredApp=b.data.app?b.data.app.currApp:"",zmail.restoredAccId=b.data.app.data?b.data.app.data.accId:"","m"===b.data.app.currApp)){var c=b.data.app.data;if(c.accId===zmail.accId){zmail.initialListingLoaded=!0;var d=c.listing.view;zmList.showMailListing(d,{retainPreview:!1,sortAscending:void 0})}}}zmail.initialListingLoaded||zmail.initialPageTrigger.hash&&zmail.initialPageTrigger.restore?a.removeMailPageLoader():(zmail.initialPageTrigger.setting=!0,zmail.initialListingLoaded=!0,a.lPageType()?zmList.showMailListing({fId:zmail.folId.iId}):zmList.showMailListing({fId:"zm_unread"}))}else a.initMailList();a.updateCountTitle(),E(),t(),v();var e=function(){zmail.allowInline=1!==zmail.mailOpt.compTab};zmAdHocSettings.subscribe("settingsloaded",e),zmAdHocSettings.subscribeComposeTypeChange(function(){e(),$.publish("/mail/listMails",{})}),zmail.loadCompleted=!0,zmInit.getSuppressedFolders(),o(),zmTopMenus.initMonitoring(),$.publish("/mail/app/init")})},hashFolPath:function(a){var b="",c="";return a===zmail.folId.iId||"inbox"===a?(b+="inbox",c=zmail.folId.iId):a===zmail.folId.dId||"drafts"===a?(b+="drafts",c=zmail.folId.dId):a===zmail.folId.spId||"spam"===a?(b+="spam",c=zmail.folId.spId):a===zmail.folId.teId||"templates"===a?(b+="templates",c=zmail.folId.teId):a===zmail.folId.sId||"sent"===a?(b+="sent",c=zmail.folId.sId):a===zmail.folId.tId||"trash"===a?(b+="trash",c=zmail.folId.tId):a===zmail.folId.oId||"outbox"===a?(b+="outbox",c=zmail.folId.oId):"unread"===a||"zm_unread"===a?(b+="unread",c="zm_unread"):"all"===a||"zm_all"===a?(b+="all",c="zm_all"):"flag"===a||"zm_flag"===a?(b+="flagged",c="zm_flag"):/^\+?(0|[1-9]\d*)$/.test(a)&&(b+=a,c=a),{hashTxt:b,folId:c}},constructLeft:function(){var b,c,d=[];b=zmail.mailLeft.getNodes();var h={id:"id",name:"name",count:"scount",sequence:"order"},i={id:"id",name:"FN",count:"c",parentId:"p",hasChild:"HC",expChild:"E",sequence:"SE",shared:"SH"},l={name:"dispName",color:"color",id:"id",count:"c",sequence:"se"};zmail.showFeature&&(l.shared="shId");var m={id:"id",name:"FN",count:"c",parentId:"p"},n={id:"id",name:"FN",OZUID:"OZUID",accessText:"ROLE",entityClass:"RT",sharedFolderToolTip:"roleName"},o={accessText:{11:"R",12:"W",13:"W"}},p={entityClass:{91:"msi-folder",92:"msi-label"}},q={id:"id",name:"FN",sequence:"SE"},r=new ZMLayer,s={type:"1",listId:"zmsTree",hasChild:!1,mapObject:h,id:"zmStreamTree",dataObject:{headerObject:{id:"zmStreamTree",name:"STREAMS",showList:!0},listObject:zmUtil.getEmailEnabledGroup()}};s.disableSelection=!0,s.dataObject.headerObject.scount="<i class='msi-plus'></i>",s.dataObject.headerObject.addIconTooltip=e.leftTree.streams.addGrp,zmUtil.isNewGroupUser()?(s.dataObject.headerObject.settingsOption=!0,s.dataObject.headerObject.settingsObject={className:"msi-manageGroup",tooltip:e.leftTree.streams.manageGrp,onClick:function(){zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({groupManage:!0,app:"streams",createCallback:function(a){zmsuite.loadStreams(a)}})})}},s.dataObject.headerObject.onAdd=function(){zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({createGroup:!0,app:"streams",createCallback:function(a){zmsuite.loadStreams(a)}})})}):s.dataObject.headerObject.onAdd=function(){zmGroupSubscription.showPage({onPreviewClose:zmStreamsApp.util.closePreview})},r.push(s),d.push(r),zmail.showFeature&&(zmail.folCount[zmail.folId.teId].c=zmail.discardFolCnt[zmail.folId.teId],zmail.folCount[zmail.folId.dId].c=zmail.discardFolCnt[zmail.folId.dId]);var t=new ZMLayer,u={type:"1",listId:"zmlTree",hasChild:!0,hasCountObject:!0,mapObject:i,id:"zmlTreeH",dataObject:{headerObject:{id:"zmlTreeH",name:f.header.folders,c:"<i class='msi-plus'></i>",showList:!0,onAdd:function(){zmfolAction.loadFolderApp(function(){zmfolAction.showCreateFolderPopUp({mode:"new"})})}},listObject:zmail.folTree[0],childObject:zmail.folTree[1],countObject:zmail.folCount}};t.push(u),t.setDragDrop({allowedParents:"#zmlTreeH",getDescendant:0===zmail.mailOpt.folSort,onDrop:function(a,b,c,d){zmfolAction.loadFolderApp(function(){zmfolAction.onDrop(a,b,c,d)})},allowDrag:function(a){return zmfolAction.allowDrag(a)},allowDrop:function(a,b,c){return zmfolAction.allowDrop(a,b,c)},dragStart:function(a,b){var d,e={};for(d in b)c=d;return e.text=b[c].FN,e}});var v=new ZMLayer,w={type:"2",mapObject:l,listId:"zmllabel",id:"zmllabelH",dataObject:{headerObject:{id:"zmllabelH",name:f.header.tag,showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){zmlab.showCreateTagPopUp({mode:"new"})}},listObject:zmail.labInfo}};v.push(w),v.setDragDrop({allowedParents:"#zmllabelH,."+j.cls.mRow,onDrop:function(b,c,d,e){var f,g,h,i,j={},k=[],l=[];for(f in c)h=f;if("center"===e){for(g=d.length,f=0;f<g;f++)d[f].id.indexOf("t")!==-1?k.push(a.zmsubStr(d[f].id,"t")):l.push(d[f].id);if(k.length||1!==l.length)i=zmTab.currentTab.indexOf("zm_srch")?a.getListingDetObj().fId:"";else{var m=zmList.getMailObj(l[0]);i=m&&m.FD}if(!i||i===zmail.folId.dId||i===zmail.folId.teId||i===zmail.folId.oId||i===zmail.folId.spId)return!1;j={action:"label",msgId:l,thd:k,lA:"add",lId:h},zmail.MailAction.Initializer.applyActions("label","click",j)}else zmlab.labelmov("m",c,d)},allowDrag:function(){return!0},allowDrop:function(a,b,c){return"inside"!==c&&(0===zmail.mailOpt.labSort||"next"!==c&&"prev"!==c)},dragStart:function(a,b){var c,d,e={};for(c in b)d=c;return e.text=b[d].dispName,e},rowCls:k.mRow,selCls:k.chkBox});var x=new ZMLayer,y={type:"1",mapObject:m,listId:"zmlview",id:"zmlviewH",hasCountObject:!0,dataObject:{headerObject:{id:"zmlviewH",name:f.iconTooltip.views,showList:!0},listObject:{zm_unread:{FN:g.common.unread},zm_all:{FN:g.common.allmsg},zm_flag:{FN:g.common.flagged}},countObject:{zm_unread:{c:a.getUnreadViewCount(),p:"-1"},zm_all:{c:0,p:"-1"},zm_flag:{c:0,p:"-1"}}}};if(x.push(y),d.push(t),zmail.shrTree.length&&zmail.accId===zmail.defAccId){var z=new ZMLayer,A={type:"3",mapObject:n,listId:"zmlSTree",id:"zmlSTreeH",classObject:o,dataObject:{headerObject:{id:"zmlSTreeH",name:f.header.sharedwithme,showList:!0},listObject:zmail.shrTree[0]}};zmail.showFeature&&(A.entityClass=p),z.push(A),d.push(z)}if(d.push(v),d.push(x),zmail.savedSearchList&&Object.keys(zmail.savedSearchList).length>0){var B=new ZMLayer,C={type:"1",mapObject:q,disableSelection:!0,listId:"zmlSSrchTree",id:"zmlSSrchTreeH",dataObject:{headerObject:{id:"zmlSSrchTreeH",name:f.header.savedsearch,showList:!0},listObject:zmail.savedSearchList}};B.push(C),d.push(B)}b[0].push({layerArr:d}),zmail.mailLeft.render(),1===a.lPageType()?(c=zmail.folId.iId,zmsuite.getLeft().selRow(c,"zmlTreeH")):(c="zm_unread",zmsuite.getLeft().selRow(c,"zmlviewH")),zmail.mailLeft.setListener("click",function(b){a.bindLeftActions(b)}),zmail.mailLeft.setListener("contextmenu",function(b){a.bindLeftActions(b)}),zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH").setChildToggle(a.viewChild)},constructCenter:function(){var b=zmsuite.getCenter(),c=b[0].getNodes();c[0].push(l.list),c[0].setListener("click",function(b,c,d){a.bindActionHeaderIcons(b,c,"",d)}),c[1].push(m.list),c[2].setListener("click",function(a){("zm_Container"!==zmTab.currentTab||"2"!==zmInit.getListingDetObj().attach&&"zmStreamTree"!==zmail.mailLeft.selLayerId)&&zmList.bindEventsMailRow(a)}),c[2].setListener("contextmenu",function(a){("zm_Container"!==zmTab.currentTab||"2"!==zmInit.getListingDetObj().attach&&"zmStreamTree"!==zmail.mailLeft.selLayerId)&&zmList.mailUtility(a)}),c[2].setDragDrop({onDrop:function(b,c,d){var e,f,g,h,i=[],j=[];for(g in d)e=g;for(h=c.length,g=0;g<h;g++)c[g].id.indexOf("t")!==-1?j.push(a.zmsubStr(c[g].id,"t")):i.push(c[g].id);d[e].FN?(f={action:"move",folId:e,msgId:i,thd:j},zmail.MailAction.Initializer.doActions("move","drop",f)):(f={action:"label",msgId:i,thd:j,lA:"add",lId:e},zmail.MailAction.Initializer.applyActions("label","drop",f))},allowDrag:function(){var b;return b=a.getListingDetObj().fId,b!==zmail.folId.dId&&b!==zmail.folId.teId&&b!==zmail.folId.spId&&b!==zmail.folId.oId&&"2"!==zmInit.getListingDetObj().attach&&!zmUtil.isSharedFolder(b)},allowDrop:function(a,b,c){var d,e;for(d in b)e=d;return b[e].FN?"inside"===c&&(e!==zmail.folId.dId&&e!==zmail.folId.teId&&e!==zmail.folId.oId&&"2"!==zmInit.getListingDetObj().attach):"inside"===c},dragStart:function(b,c){var d,e={};return c.length>1?(e.count=zmUtil.getCheckedMailCount(),e.text=f.common.emailsel):(d=a.zmsubStr(c[0].id,"t"),e.text=zmUtil.replaceHtmlInSubject(zmList.getMailObj(d).SB)),e},allowedParents:"#zmlTreeH,#zmllabelH,.zmTtab",rowCls:k.mRow,selCls:k.chkBox}),zmsuite.renderCenter(),x(),a.setDisplayDensity()},constructRight:function(){zmsuite.renderRight()},getListingDetObj:function(a){return zmInit.isDL?(a=a||zmTab.currentTab,ZMail.listing.collection.getViewDetails(a)||{}):zmail.listDetails},setListingDetObj:function(a,b){return zmInit.isDL?(b=b||"zm_Container",void ZMail.listing.collection.setViewDetails(b,a)):void("string"==typeof a?zmail.listDetails=$.parseJSON(a):zmail.listDetails=a)},viewChild:function(a,b){var c,d,e,f;if(a.zmsData)for(var g in a.zmsData.rowObject)c=a.zmsData.rowObject[g],d=g;else c=a,d=b[0].id;e=b.find(".msi-arrow45"),f={accId:zmail.accId,mode:"expand",folId:d},e.length?(f.isExpand=1,c.E=1):(f.isExpand=0,c.E=0),zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:"",p:f,csr:"s"})},flgClass:function(a,b){var c="";return a=parseInt(a),c=1===a?k.blueflag:2===a?k.redflag:3===a?k.greenflag:6===a?k.mulflag:"s"===b?"":k.noflag},getThdFlagvalue:function(a){var b=0;if(a){var c=zmList.getMailObj(a);b=c.TI&&c.TF||c.TF&&c.TM||c.TM&&c.TI?6:c.TF?3:c.TM?2:c.TI?1:0}return b},findFolName:function(a){if(zmail.folTree[0][a])return zmail.folTree[0][a].FN;var b,c=zmail.folTree[1];for(var d in c)if(b=c[d].CH,b[a])return b[a].FN;var e=zmail.shrTree||[];for(var f in e)if(e[f][a])return e[f][a].FN;return""},getMails:function(b,c,e,f,g){var h,i,j=zmail.mailOpt.isshowSummary,k=b.f,l=b.t,m=b.fId,n=b.label,o=b.flag,p=b.attach,q=b.view;k||(k=1);var r,s={from:k,to:l,ty:c,fId:m,lId:n,view:q,flag:o,attach:p,cache:!1,scenario:b.scenario,retainPreview:b.retainPreview,sortOrder:b.sortOrder,mlDefObj:g,sortType:b.sortType},t={mode:"listing",accId:zmail.accId,from:k,to:l,summary:j,sortBy:b.sortBy||"date",sortOrder:b.sortOrder,folderSpec:zmUtil.getMLConversionValue()};b.shId&&(t.shId=b.shId,2===zmail.folviewThread&&(t.folderSpec=1),zmail.opType.list?t.opType=zmail.opType.list:t.opType=0,m&&zmUtil.isSharedFolder(m)&&92===zmail.shrTree[0][m].RT&&(n=m,m="")),""!==m&&(t.folId=m,s.from=k,m===zmail.folId.sId&&(t.folderSpec=0)),""!==o&&(t.flag=o,b.sendReq=!0),""!==n&&(t.label=n,b.sendReq=!0),""!==p&&(t.attach=p,b.sendReq=!0),""!==q&&(m&&"all"===q||(t.view=q),b.sendReq=!0),r=m||n||q;var u=zmUtil.getListMap(r);if(u&&(h=u.MO,s.showNxt=u.showNextPage),i=b.callbk?b.callbk:a.mailList,!u||b.sendReq){s.req="server",s.reqId=++d;var v,w={u:zmail.conPath+"/ml.do",t:"POST",p:t,ep:s},x=zmail.mailCenter.listElem;if(!e){var y=1===b.f?"listing":"pagination";v=zmComponent.loadingBand({container:x,type:y,addAtFirst:1===b.f})}w.fn=function(a,b){v&&v(),i(a,b)},w.efn=function(b,c,d,e){v&&v(),a.onNetFailure(b,c,d,e)},zmInit.isDL?(w.type="POST",ZMail.listing.collection.fetchMailList(w)):zmAjq.XHR(w),zmUtil&&(zmUtil.isSharedFolder(m)||zmUtil.isFolderId(m)&&"-1"!==zmList.getRowInfo(m,"zmlTreeH","info").SH)&&"undefined"==typeof zmStream&&zmUtil.requireStreamsApp().then(function(){})}else i(h,s)},foldView:function(b){var c,d,e,f="",g="",h="",i="",j="",k="",l="",m=b.folId||"",n=b.view||"",o=b.viewId||"",p=b.reInitialize,q=b.isLoadingNotNeeded,r=b.retainPreview,s=b.sortOrder,t=zmfolAction.getSortProperties(m,"",s);if(d=a.getListingDetObj(),zmail.initialListingLoaded||(zmail.initialListingLoaded=!0),d.view?(l=d.view,g=d.view):d.label?(l="label",g=d.label):d.attach?(l="attach",g=d.attach):d.flag&&(l="flag",g=d.flag),d.fId?f=d.fId:d.label&&(f=d.label),m.indexOf("zm_")!==-1&&(n=m.substring(3,m.length),m="","unread"===n||"all"===n?o=n:""===o&&(o="-1")),f!==m||l!==n||g!==o){a.startFill=!1,c=m,"flag"===n?(n="",j=o||-1):"attach"===n?(n="",k=1):"label"===n&&(n="",i=o||-1),e=$("#zm_Main .SC_frt .SC_mtb").eq(1),m||"unread"!==n&&"all"!==n&&"flag"!==n?e.show():(m="","flag"===n?e.show():e.hide()),zmail.labInfo[m]&&(n="",i=m,m="",c=""),zmail.loadCompleted&&!r&&zmPrev.clsPreview("list"),("stream"===n||c&&"all"===n)&&(n=""),zmInit.isDL?ZMail.listing.collection.clearModels({listId:zmUtil.getFolId()}):zmCache.clearMailObj({listId:zmUtil.getFolId()}),h='{"fId":"'+c+'","view":"'+n+'","flag":"'+j+'","label":"'+i+'","attach":"'+k+'","sortBy":"'+t.sortBy+'","sortOrder":'+t.sortOrder+"}",a.setListingDetObj(h),$.isEmptyObject(d)||u();var v={f:1,t:zmail.mailOpt.range,fId:m,view:n,flag:j,label:i,attach:k,sortBy:t.sortBy,sortOrder:t.sortOrder,callbk:a.mailList,retainPreview:r,sortType:t.type};p?(zmsuite.getCenter("zm_Container")[0].getNodes()[0].$el.find(".msi-uncheck").removeClass().addClass("msi-uncheck"),v.callbk=function(b,c){a.reInitListing(),a.mailList(b,c)}):zmList.unchkAll(),"zmlSTree"===$("#"+m).parent().attr("id")&&(v.shId=zmList.getRowInfo(m,"zmlSTreeH","info").SHID),$.publish("mail/listing/viewchanged",[]);var w={fId:b.folId||zmail.mailLeft.selId,view:b.view,viewId:b.viewId};zmRestore.saveState("listing",w,{}),zmUrlAct.update(b),a.getMails(v,"n",q,"",b.hashDeffObj)}},checkThreadRead:function(b){var c,d,e=[];if(zmUtil.getListMap(b)){var f,g=a.getListingDetObj();for(e=zmList.getViewBasedMsgList(b,g),d=e.length,c=0;c<d;c++)if(f=zmList.getMailObj(e[c]),f&&0===f.S)return!1}return!0},onNetFailure:function(b,c,d,e){var f='<div class="zm_retMsg"><p><i class="msi-mailFail"></i>'+g.common.netFailure+'<br><span class="SC_nmsg"><font>'+g.common.eRetry+"</font></span></p></div>";$(zmail.mailCenter.listElem).html(f),a.removeMailPageLoader()},removeMailPageLoader:function(){$("#ms_load").remove();try{window.performance&&performance.mark&&!performance.getEntriesByName("mark_fully_visible").length&&(performance.mark("mark_fully_visible"),window.performance.timeOrigin&&zmail.isInternalOrgUser===!0&&zmsuite.setLoadingTime(new Date-performance.timeOrigin))}catch(a){zmUtil.debugLog(a)}},mailList:function(c,e){if(!zmail.loadCompleted||e.reqId===d){var f,g,h,i;if(i=a.getListingDetObj(),h=i.fId||i.view||i.label||i.flag,"-1"!==h&&"1"!==h&&"2"!==h&&"3"!==h||(h="flag"),"server"===e.req?(f=a.cacheDataObj(c,h,e.from),g=f.showNextPage,f=f.MO):(f=c,g=e.showNxt,e.to=f.length),void 0===e.sortOrder||0!==zmUtil.getMLConversionValue()&&h!==zmail.folId.sId||h===zmail.folId.teId||zmList.setListObj(h,"sortOrder",e.sortType),b=!1,a.startFill=!0,h===zmail.folId.oId?$(zmail.mailCenter.listElem).addClass("SC_obox"):$(zmail.mailCenter.listElem).removeClass("SC_obox"),f.length>0){var k=$(a.constructMailRow(h,f));if("h"===zmail.viewInfo[0].DT&&k.find("."+j.cls.date).hide(),"h"===zmail.viewInfo[0].SZ&&k.find("."+j.cls.size).hide(),$(zmail.mailCenter.listElem).find("."+j.cls.mRow).length){
var l=$(zmail.mailCenter.listElem)[0].scrollTop;$(zmail.mailCenter.listElem).append(k),$(zmail.mailCenter.listElem)[0].scrollTop=l;var m=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");m.hasClass("msi-check")&&m.removeClass().addClass("msi-uncheck msi-partcheck")}else $(zmail.mailCenter.listElem).html(k)}else $(zmail.mailCenter.listElem).html(s());if(a.removeMailPageLoader(),g>=0&&$(zmail.mailCenter.listElem).data("data-ty",g),zmail.loadCompleted&&1===e.from){if(zmail.mailCenter.listElem.scrollTop=0,e.fId&&!zmUtil.isSharedFolder(e.fId)||!e.fId&&"unread"===e.view){var n=parseInt(c[c.length-1].unCnt);z(n)}a.listingBand.SpamTrashBand.setBand()}if($(zmail.mailCenter.listElem).unbind("scroll").bind("scroll",function(){zmUtil.hideMenu(),a.fillMails()}),zmail.loadCompleted&&e.retainPreview){var o=zmPrev.prevDetails();o.msgId&&zmList.getMailObj(o.msgId)&&zmList.setMailSelection(o.msgId,o.type,$(zmail.mailCenter.listElem))}if(e.mlDefObj&&e.mlDefObj.resolve(),zmail.isRHSEnabled&&"true"===zmAdHocSettings.getRhsOnBoarding()){var p=function(){zmAppLoader.load("zmWidget").then(function(){zmAppLoader.loadFiles("extcss",zmResource.get("css","integrationOnboarding.css")).then(function(){$("body").append('<div class="blkMask" id="onboardingBlkMask"></div>'),zmsuite.toggleRHS()})})};"1"===zmAdHocSettings.getOnBoardingPage()?p():$.subscribe("mail/onBoardingCompleted",p)}}},cacheDataObj:function(b,c,d){var e,f;if(c&&c.length||(f=a.getListingDetObj(),c=f.fId||f.view||f.label||f.flag,"-1"!==c&&"1"!==c&&"2"!==c&&"3"!==c||(c="flag")),zmInit.isDL)e=ZMail.listing.collection.mapWithView(b,{mapId:c,startIndex:d});else if(e=zmail.folderCache.dolistObj(c,b,!0),c){var g=zmUtil.getListMap(c);g&&1!==d?(g.MO=g.MO.concat(e.MO),g.showNextPage=e.showNextPage):zmUtil.createListMap(c,e)}return e},constructMailRow:function(b,c){var d,e,f,i,k,l=document.createDocumentFragment(),m=[],n=[],o=a.getListingDetObj(),p=zmCenterListing.create({type:j.templateName.mail,mapObj:a.mapObj,classObj:a.classObj}),q={},r={},s=" ("+h.contentOptions.archived+")",t="zm_Container",u=zmUtil.getMLConversionValue(b),v=zmUtil.isSharedFolder(b);b===zmail.folId.sId&&(q={0:"",1:g.mailDeliveryStatus.tooltips.queued,2:g.mailDeliveryStatus.tooltips.inprogress,3:g.mailDeliveryStatus.tooltips.inprogress,4:g.mailDeliveryStatus.tooltips.inprogress,5:g.mailDeliveryStatus.tooltips.success,6:g.mailDeliveryStatus.tooltips.failure,7:g.mailDeliveryStatus.tooltips.failure,8:g.mailDeliveryStatus.tooltips.undo,9:g.mailDeliveryStatus.tooltips.retry,10:g.mailDeliveryStatus.tooltips.retry},r={0:"",1:g.mailDeliveryStatus.tooltips.rcProcess,2:g.mailDeliveryStatus.tooltips.rcParSucc,3:g.mailDeliveryStatus.tooltips.rcFailed,4:g.mailDeliveryStatus.tooltips.rcSuccess,5:g.mailDeliveryStatus.tooltips.rcFailed}),b||zmTab.currentTab.indexOf("zm_srch")===-1||(b=zmSearchUtil.getSearchedFolders()[0]||"",t=zmTab.currentTab),m=a.getMailRowIcons(b),n=c?c:zmList.getListObj(b,"MO"),k=n.length;var w,x;for(i=0;i<k;i++){e=n[i],w=zmList.getRowModel(e),x=w.attributes,d=$.extend({},x),(v||zmail.folCount[b])&&"zm_srch1"!==t||(d.FN=a.findFolName(x.FD),x.AR&&o.label&&!o.fId&&(d.FN+=s)),zmail.mailOpt.isshowSummary||(d.SM=""),b===zmail.folId.sId||b===zmail.folId.oId||b===zmail.folId.dId||b===zmail.folId.teId?d.fromaddr=d.TOADDR||d.TO||(d.CC&&"Not Provided"!==d.CC?d.CC:"")||d.BCC||"":d.fromaddr=d.F||d.SN||"",0!==t.indexOf("zm_srch")&&0!==u||(d.DC=0),0!==t.indexOf("zm_srch")&&0!==u&&x.TH&&b!==zmail.folId.tId&&b!==zmail.folId.dId&&b!==zmail.folId.sId&&x.TC>0&&(d.M="t"+d.M,d.S=x.TS,d.TS2&&(1===d.TS2?d.S=0===d.S?2:4:2===d.TS2?d.S=0===d.S?3:5:3===d.TS2&&(d.S=0===d.S?7:8)),d.NFG=a.getThdFlagvalue(e),zmail.mailOpt.isshowSummary&&(d.SM=x.TSM),d.SB=a.getThreadSubject(e),d.TAG=x.TTAGS,d.AT=x.TA),b===zmail.folId.sId||b===zmail.folId.oId?(b===zmail.folId.oId&&(d.S="6"),d.F=x.TOADDR||d.TO||(d.CC&&"Not Provided"!==d.CC?d.CC:"")||d.BCC||g.common.undisclosed):(b===zmail.folId.spId&&(d.NFG="-1",d.TAG=[]),0===u?d.F=x.SN||x.F:d.F=x.TSN||x.SN||x.F);try{0===d.TH&&d.F===zmail.aInfo[zmail.accId].mailId&&(d.F="Me")}catch(z){}if(b===zmail.folId.oId?"queue"===d.S3?d.NFG="5":(d.NFG="4",d.OBT="0"):b===zmail.folId.teId?(d.AW=1,d.TC=0,d.NFG="-1",d.S="",d.F=x.TOADDR||g.common.undisclosed):b===zmail.folId.dId?(d.AW=1,d.TC=0,d.NFG="-1",d.S="",d.TAG=[],d.F=x.TOADDR||g.common.undisclosed):b===zmail.folId.tId?d.TC=0:b===zmail.folId.sId?(d.S="",d.TH&&(d.TC=-1)):!d.TH||0!==u&&0!==t.indexOf("zm_srch")||(d.TC=-1,1===d.NS2?d.S=0===d.S?2:4:2===d.NS2?d.S=0===d.S?3:5:3===d.NS2&&(d.S=0===d.S?7:8)),d.UW=zmList.isRMOBJ(e),d.AWMID=e,d.data="lt",d.ICN=$.extend([],m),((x.MA||x.MSGREL&&x.MSGREL.indexOf("1")>-1)&&!zmUtil.isSharedFolder(b)||d.UW)&&(d.HT="1"),x.FD===zmail.folId.sId&&b===zmail.folId.sId||(d.MDS=0,d.RS=0),x.SZ&&(d.SZ=y(x.SZ)),x.SCO&&(d.OT=x.SCO.OT,d.SCTX=x.SCO.SCTX),d.hideDraftCount=x.FD===zmail.folId.dId,d.CT=Boolean(x.CT),d.mailDeliveryTip=q[d.MDS]||"",d.rsTip=r[d.RS]||"",x.SCOBJ&&x.FD!==zmail.folId.spId&&b!==zmail.folId.sId){var A=g.quickactions,B=x.SCOBJ[0]||{};if("REVIEWACTION"===B.SCATYPE)d.schemaTip=_zm.escapeTags(B.DESC||""),d.schemaText=A.review,B.SHOWRB?d.actionIcon=d.actionIconColor="review_comment":d.actionIcon=d.actionIconColor="review";else if("RSVPACTION"===B.SCATYPE){if(B.EXPIRED)d.schemaTip=A.eventexpired,d.schemaText=A.rsvp,d.expired=1;else{d.schemaTip=_zm.escapeTags(B.DESC||"");var C={yes:A.yes,no:A.no,maybe:A.maybe};B.RSVPSTUS?d.schemaText=A.attending+" : "+C[B.RSVPSTUS]:d.schemaText=A.rsvp}d.actionIcon=d.actionIconColor="rsvp"}else"CONFIRMACTION"===B.SCATYPE||"SAVEACTION"===B.SCATYPE?(d.schemaText=_zm.escapeTags(B.DN||""),d.schemaTip=_zm.escapeTags(B.DESC||""),d.actionIcon=d.actionIconColor="one_click",B.ASTATUS&&(d.expired=1)):"VIEWACTION"===B.SCATYPE||"TRACKACTION"===B.SCATYPE?(d.schemaText=_zm.escapeTags(B.DN||""),d.schemaTip=_zm.escapeTags(B.DESC||""),d.actionIcon=d.actionIconColor="goto"):"ORDER"===B.SCATYPE?(B.ORDEROBJ&&B.ORDEROBJ.VIEWORDERURL&&(d.schemaText=A.orderV,d.actionIcon=d.actionIconColor="goto"),d.F=d.SB,d.MUI=0,d.fromaddr="",d.sumTxt=zmList.markupSummary({schemaObj:B})):"PARCELDELIVERY"===B.SCATYPE?(B.PARCLDLVRYOBJ&&B.PARCLDLVRYOBJ.TRACKINGURL&&(d.schemaText=A.orderT,d.actionIcon=d.actionIconColor="goto"),d.F=d.SB,d.MUI=0,d.fromaddr="",d.sumTxt=zmList.markupSummary({schemaObj:B})):"FLIGHTRESERVATION"===B.SCATYPE&&(B.FLYTTKTOBJ&&B.FLYTTKTOBJ[0].url&&(d.schemaText=zmList.flightQAType(B.FLYTTKTOBJ[0]),d.schemaTip=_zm.escapeTags(B.DESC||""),d.actionIcon=d.actionIconColor="goto"),d.F=d.SB,d.MUI=1,d.fromaddr="",d.sumTxt=zmList.markupSummary({schemaObj:B}))}d.selBoxVisibility=!0,zmUtil.isSharedFolder(b,"R")&&(d.selBoxVisibility=!1),p.setDataObj(d),f=$(p.getHTML()),zmInit.isDL&&(w.$view=f),zmCenterListing.mailObjectAPI.setViewObject(e,{id:e,$element:f,isSelected:!1,isExpanded:!1},t),l.appendChild(f[0])}return l},constructListHolder:function(){$(".SCl").last().after("<div id='zm_centerHolder' class='SCm_parent'></div>")},getCurrentLeftId:function(){return zmail.mailLeft.selId},checkLoadMoreMails:function(){var a=0;return function(){var b=$(zmail.mailCenter.listElem),c=b[0].scrollTop,d=b[0].scrollHeight-b[0].offsetHeight,e=!1;return a>c?e=!1:c>=.8*Math.floor(d)&&(e=!0),a=c,e}}(),fillMails:_.debounce(function(c){var d,e,f,g,h,i,j="all",k="",l="",m="",n=!1,o="";if(a.checkLoadMoreMails()){if("2"===zmInit.getListingDetObj().attach)return void zmail.listObj.attachVw.attachUtil.getAttachemntOnScroll();n=!0,zmUtil.debugLog("Mail Listing","Scroll bottom reached. Have to fill new content")}if(c?(h=c<zmail.mailOpt.range?c:zmail.mailOpt.range,n=!0,a.startFill=!0):h=zmail.mailOpt.range,b&&(n=!1),n&&a.startFill===!0)if(g=$(zmail.mailCenter.listElem).data("data-ty"),g>0){i=a.getCurrentLeftId(),i.indexOf("zm_")!==-1&&(i=i.substring(3,i.length)),f=a.getListingDetObj(),o=f.fId,k=f.label,j=f.view,l=f.flag,m=f.attach,"unread"!==o&&"all"!==o&&"flag"!==o||(j=o,"flag"===o&&(j=""),o="");var p=zmPrev.prevDetails("zm_Container"),q=zmList.getListObj(i,"MO").length;if("unread"===j&&p.msgId){var r=p.msgId,s=zmList.getMailObj(r);e=s&&(0===s.TH||s.TH&&zmInit.checkThreadRead(s.T))?q:q+1}else e=q+1;var t=zmfolAction.getSortProperties(i);d={f:e,t:h,fId:o,view:j,flag:l,label:k,attach:m,sendReq:!0,sortBy:t.sortBy,sortOrder:t.sortOrder,sortType:t.type},zmUtil.isSharedFolder(o)&&(d.shId=zmUtil.getShareId(o)),$(zmail.mailCenter.listElem).unbind("scroll").bind("scroll",function(){a.fillMails()}),b=!0,a.getMails(d,"n")}else zmList.setEmptyListing()},500),constructListOuter:function(a){var b,c;b=["DIV",{attrs:{"class":"SCm SC_show",id:a.tId||""},child:[["DIV",{attrs:{"class":"SCmb SCmenu",id:a.actId||""}}],["DIV",{attrs:{"class":"SCmc",id:a.mId||""}}]]}],c=_zm.getDOM(b),$("#zm_centerHolder").append(c)},getUnreadViewCount:function(){var a=[zmail.folId.sId,zmail.folId.spId,zmail.folId.oId,zmail.folId.tId];a=a.concat(zmfolAction.getChildrenOf(zmail.folId.tId));var b=$.extend({},zmail.folCount),c=a.length;if(a)for(var d=0;d<c;d++)delete b[a[d]];var e=0;for(var f in b)e+=parseInt(b[f].c);return e},updateCountTitle:function(){zmWinTitle.updateTitle()},zmsubStr:function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},bindLeftActions:function(b){var c,d,e,f,g,h,i,j,k="",l="",m="";"clbk"in b&&(j=b.clbk),b=b.zmsData,e=b.type,f=b.eventInfo,d=f.srcElement||f.target,g=b.rowInfo.layerId,c=b.rowInfo.type,i=b.prevSelectLayer;for(var n in b.rowObject){k=b.rowObject.id||n;break}if("contextmenu"===e)zmList.FLUtility(f,d,g,c);else if("click"===e){if("zmlSSrchTreeH"===g)return void("header"===c&&"zmlSSrchTreeH"===k||zmAppLoader.load("mailSearch").then(function(){zmSearch.processSavedSearch({id:k,mode:"get"})}));if("zmStreamTree"===g&&g!==k){var o,p=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree");if("disabledGrp"===k)zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({groupManage:!0,view:"disabled"})});else if("createGrp"===k)if($(d).hasClass("closeImg")){var q=p.el.find("#"+k);q.find(".toHide").addClass("zmHideD"),q.find(".alignLeft").addClass("zmTreCreate"),zmAdHocSettings.setStreamsGroupImg("1")}else zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({app:"streams",isOnboard:!0,createCallback:function(a){zmsuite.loadStreams(a)}})});else if("more"===k||"less"===k){var r=k,s="less"===k?"more":"less",t=p.listObject,v="more"===k?"showNode":"hideNode",w=p.el.children("#zmsTree").children();_.each(w,function(a,b){o=a.id,(t[o].hideNode&&"more"===k||"less"===k&&b>5&&"more"!==o&&"less"!==o)&&p[v](o,j)}),p.hideNode(r,j),p.showNode(s,j),"more"===s&&($("#"+zmail.zuid)[0].scrollIntoView(),j&&"function"==typeof j&&j())}else h=zmail.mailLeft.getNodes()[0].getLayer(g),$(d).find(".SC_ct.SC_new").removeClass("SC_new"),zmUtil.requireStreamsApp().then(function(){zmail.ContactBook.fetchProcess.then(function(){return zmStreamsApp&&zmStreamsApp.GroupApp&&zmStreamsApp.GroupApp.GroupId&&zmStreamsApp.GroupApp.GroupId===k&&zmsuite.isWorkspaceAvailable("zmStreamsApp")?(zmsuite.showWorkSpace("zmStreamsApp"),void zmStreamsApp.util.removeCommentClass(k,h)):(zmSearch.updateSearchValues("zmStreamsApp"),zmStreamsApp.util.removeCommentClass(k,h),void zmStreamsApp.init(k,!0))})})}else{if(zmshCut.currentLeftId=k,"header"!==c&&zmsuite.showExistingApp("zm_Container"),"zmStreamTree"===i&&g!==i&&!b.rowObject.id){zmStreamsApp.PostApp.unsubscribeEvents(),zmail.mailCenter=zmsuite.getCenter("zm_Container"),a.constructCenter(),zmail.mailCenter.listElem=zmail.mailCenter[0].getNodes()[2].$el[0],zmail.mailCenter.listObj=zmail.mailCenter[0].getNodes()[2],zmail.mailCenter.prevElem=zmail.mailCenter[1].$el[0],zmail.mailCenter.prevObj=zmail.mailCenter[1],zmail.mailCenter.prevObj.getNodes()[0].setListener("click",function(a,b){zmList.bindAction(a,b)}),zmail.mailCenter[0].$el.removeClass("zms_streams SC_streams"),u(),a.setListingDetObj({}),zmSearch.updateSearchValues("m");var y=zmTab.getTabObject("zm_Container");y.searchPlaceHolder=zmText.get("search","searchInApp",{appname:"Mail"}),y.appIcon="msi-mail",zmTab.updateTabLst(y)}"zmlTreeH"===g&&"zmlTreeH"!==k&&(h=zmsuite.getLeft().getNodes()[0].getLayer(g),h.removeHighlightFromParent(k,!0)),k!==g&&("zmllabelH"===g?(l="label",m=k):"zmlviewH"===g&&(l=k.substring(3)),k===zmail.folId.sId&&zmUtil.updSendErrorStatus(!1,zmail.folId.sId),a.foldView({folId:k,view:l,viewId:m})),x(),(zmUtil.isSharedFolder(k)||zmUtil.isFolderId(k)&&"-1"!==zmList.getRowInfo(k,"zmlTreeH","info").SH)&&"undefined"==typeof zmStream&&zmUtil.requireStreamsApp(1).then(function(){})}}a.isLeftFocused=!0},bindActionHeaderIcons:function(b,c,d,e){var f,g,h,i=d||b.srcElement||b.target;c=e||c;var j=zmUtil.getFolId();switch(c){case"msi-uncheck msi-check":case"msi-uncheck msi-partcheck":zmList.unchkAll();break;case"msi-uncheck":$(i).hasClass("msi-uncheck")||(i=$(i).find(".msi-uncheck")),zmList.chkAll(i);break;case"msi-action":case"msi-customize":case"msi-filter":case"msi-barrow":if(f=$(i).closest("li"),g="pleft",f.find(".msi-action").length?(h=zmDrop.getActionDrop(),zmTab.currentTab.indexOf("zm_tab")!==-1&&(g="pright")):f.find(".msi-uncheck").length?h=zmDrop.getSelectDrop():f.find(".msi-filter").length&&(h=zmDrop.getViewDrop()),h){var k;zmUtil.hideMenu(),f.find("b").addClass("SC_ddn"),k=zmsuite.showMenu({par:f,list:h,align:g,clk:function(a,b){zmList.bindAction(a,b,"",k)},onHide:function(){f.find("b").removeClass("SC_ddn")}})}break;case"msi-dataSort":zmList.sort(i,j);break;case"msi-sortdatedn":zmList.changeListingSortOrder(0);break;case"msi-sortdateup":zmList.changeListingSortOrder(1);break;case"msi-folder":zmUtil.hideMenu(),f=$(i).closest("li"),A(f);break;case"msi-label":zmUtil.hideMenu(),f=$(i).closest("li"),B(f);break;case"msi-spam":zmList.bindAction({action:"spam"});break;case"msi-notspam":zmList.bindAction({action:"notspam"});break;case"msi-trash":zmList.bindAction({action:"delete"});break;case"msi-reply":zmList.bindAction({action:"reply"});break;case"msi-replyall":zmList.bindAction({action:"replyall"});break;case"forward":zmList.bindAction({action:"forward"}),zmUtil.hideMenu();break;case"msi-send":zmList.sendOutbox();break;case"msi-archive":zmList.bindAction({action:"archive"}),zmUtil.hideMenu();break;case"msi-unarchive":zmList.bindAction({action:"unarchive"}),zmUtil.hideMenu();break;case"msi-classic":case"msi-compact":case"msi-superCompact":f=$(i).closest("li"),g="pright",h=zmDrop.getCustomizeViewDrop(),h&&(zmUtil.hideMenu(),f.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:f,list:h,align:g,clk:function(a,b){zmList.bindAction(a,b)}}));break;case"msi-thread":zmList.changeListingView(0);break;case"msi-conversation":zmList.changeListingView(2);break;case"msi-listview":zmList.toggleAVView(i,"list");break;case"msi-thumbview":zmList.toggleAVView(i,"thumb");break;case"msi-chat":zmUtil.createContexualChat(i);break;case"msi-attsearch":f=$(i).closest("li"),g="pleft",h=zmDrop.getAttachOptions(),h&&(zmUtil.hideMenu(),f.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:f,list:h,align:g,clk:function(a,b){zmList.bindAction(a,b)}}));break;case"msi-plus":zmAppLoader.load("Template").then(function(){zmComponent.createTemplate()});break;case"msi-customList":zmAppLoader.load("showHideList").then(function(){var a=new zmail.mailShowHideList.list;h=a.getDropDownConfigList(),f=$(i).closest("li"),g="pright",zmUtil.hideMenu();var b=h.clk;f.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:f,list:h.list,align:g,clk:function(a,c){zmList.bindAction(a,c,b)}})})}a.isLeftFocused=!1},getFolderTreeCount:function(){var b={accId:zmail.accId,mode:"foldertree"};zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:a.updFolTreeCount,p:b})},updFolTreeCount:function(b){var c,d,e,f="zmlTreeH",g={},h="0",i=!1;zmail.folCount&&(h=zmail.folCount[zmail.folId.sId].c||"0",$("#"+zmail.folId.sId).hasClass("SC_redtxt")&&(i=!0));var j=b&&b.foltree;if(j){g=zmail.mailLeft.getNodes()[0].getLayer(f),j[zmail.folId.sId].c=h,j[zmail.folId.dId].c="0";for(var k in j)c=k,e=zmail.folCount[c].c,j[c]!==e&&g.updateCount(c,"upd",j[c].c,!1);zmail.outboxFail&&zmUtil.updSendErrorStatus(!0,zmail.folId.oId),"0"!==h&&i&&zmUtil.updSendErrorStatus(!0,zmail.folId.sId),d=a.getUnreadViewCount(),f="zmlviewH",g=zmail.mailLeft.getNodes()[0].getLayer(f),g.updateCount("zm_unread","upd",d),zmUtil.updateCountForAcc(zmail.accId,"upd",d),zmWinTitle.updateTitle(),"zm_unread"===zmail.mailLeft.selId&&zmail.mailLeft.selRow(zmail.mailLeft.selId,"zmlviewH"),x()}},getAccountInfo:function(){var b={mode:"getAccInfo"};zmAjq.XHR({u:zmail.conPath+"/mailUtilAction.do",t:"POST",fn:a.updateAccountUnreadCount,p:b})},updateAccountUnreadCount:function(a){if(a instanceof Object){var b=a.aInfo;for(var c in b)zmUtil.updateCountForAcc(b[c].accId,"upd",b[c].c)}},getMailRowIcons:function(a){var b=["msi-trash"];return a&&zmUtil.isSharedFolder(a)&&(b=[]),b},emptyRow:s,reInitListing:u,cSize:y,updateHeaderBand:x,listingBand:p,getThreadSubject:function(a){var b=zmList.getMailObj(a),c=b.SB||"",d=c.trim();return 0!==d.indexOf("Re:")&&0!==d.indexOf("Fwd:")||(c=b.TSB||c),c},isLeftFocused:!1,setDisplayDensity:function(b){var c=b||zmAdHocSettings.getListingDisplayDensity();a.customizeDisplayDensity(c)},customizeDisplayDensity:function(a,b){var c,d,e,f=["zm_Container","zm_srch1"],g=f.length,h=["zmLClassic","zmLCompact","zmLSCompact"];for(c=0;c<g;c++)if(zmsuite.isWorkspaceAvailable(f[c])&&(F(f[c],a),e="","zm_Container"===f[c]&&"zmStreamTree"!==zmail.mailLeft.selLayerId&&(e="m"),"zm_srch1"===f[c]&&(e=zmSearch.forceSearch?zmSearch.forceSearch:zmSearchUtil.getSearchAppType()),"m"===e)){var i=!0;"WS"===b&&(i=!1),d=zmsuite.getCenter(f[c])[0].getNodes()[2].$el||[];var j,k;for(j in h)k=h[j],a===String(j)&&k?d.addClass(k):d.removeClass(k),"2"===a&&d.addClass(h[1]);zmAdHocSettings.setListingDisplayDensity(a,{sync:i})}},translateSystemFolders:function(){var a,b=zmail.folId,c=zmail.folTree[0];for(var d in b)a=b[d],c[a].FN=f.systemFolder[c[a].FN]},loadFolderMenu:A,loadLabelMenu:B})}(),window.zmList=function(){var a,b,c=zmCenterListing.mailObjectAPI,d=zmText.get("mail"),e=d.leftTree,f=d.listing,g=d.preview,h=d.actions,i=ZMail.lConstants,j=i.cls,k=i.jsCls,l=["zmLTMenu_Nf","zmLTMenu_lne1","zmLTMenu_Fr","zmLTMenu_lne2","zmLTMenu_Sf","zmLTMenu_lne3","zmLTMenu_Rf","zmLTMenu_Df","zmLTMenu_lne4","zmLTMenu_Af","zmLTMenu_Ef"],m=0,n=function(a){return b="pvreq_"+Date.now(),a.cpvreq=b,b},o=function(a,b){var c,d=$(b.listElem).scrollTop(),e=a.height();c=d-e,$(b.listElem).scrollTop(c)},p=function(a){var b;b=a.mainElem.find("."+j.thdChild+":visible"),o(b,a),b.prev().removeClass(j.thdTreeLine),b.prev().find("i.msi-tarrow").addClass("msi-barrow"),b.hide()},q=function(a){var b,c="";b=a.mainElem.find("."+j.thdChild+":visible"),b.children("div."+j.sel).length?(c=b.prev().attr("id"),c.indexOf("t")||(c=c.substring(1)),zmList.setMailSelection(c,"lt",$(a.listElem))):b.prev().hasClass(j.sel)&&(c=zmUtil.getSelectedMails()[0][0],c&&zmList.setMailSelection(c,"th",$(a.listElem)))},r=function(a){a.rowElem.addClass(j.thdTreeLine),a.rowElem.hasClass(j.chkBox)&&a.rowElem.next().children("div").addClass(j.chkBox)},s=function(a,b,d){zmAppLoader.load("mailPostLoad").then(function(){var e,f=document.createDocumentFragment(),g=b.mId,h=a.MO,i=!0;if(e=d.rowElem.next(),e.hasClass(j.thdChild))d.rowElem.hasClass(j.thdTreeLine)?(e.slideUp(400,function(){return function(){d.rowElem.removeClass(j.thdTreeLine)}}(d)),i=!1):(p(d),e.slideDown(400),r(d));else{p(d);for(var k=$("<div class="+j.thdChild+' id="thd'+g+'">'),l=c.getViewObject(g)||c.getViewParentOf(h[0]),m=l&&l.isSelected,n=0;n<h.length;n++)f.appendChild(zmList.constructThreadChildRow(h[n],m)[0]);k.append(f),$(k).insertAfter(d.rowElem).hide().slideDown(400),r(d)}var o;o=i?{mId:b.mId}:{mId:""},zmRestore.saveState("expandThd",o,{mId:b.mId}),q(d),b.eTDefObj&&b.eTDefObj.resolve()})},t=function(a,b,c){var d,e,f="",g=b.mId,h=a.MO,i=h.length,j=zmUtil.getMLConversionValue(),k="",l={},m=!1;"zm_Container"===zmTab.currentTab?l=zmInit.getListingDetObj():zmTab.currentTab.indexOf("zm_tab")!==-1?l=zmsuite.getCenterOuter().$el.data("data-detail"):zmTab.currentTab.indexOf("zm_srch")!==-1&&(l=zmSearchUtil.getSearchViewDetails()),0===b.opentype||4===b.opentype?k="search"===l.view?"S":"P":2===b.opentype?k="T":3===b.opentype&&(k="N"),b.streamsMail||0===j&&(0!==j||"conversation"!==b.src)||(m=!0);for(var n,o=0;o<i;o++)if(n=zmList.getMailObj(h[o]),e=k+n.M,n.SM=n.SM||"",n.M&&n.M!==g){if(n.FD===zmail.folId.spId&&l.fId!==zmail.folId.spId||n.FD===zmail.folId.tId&&l.fId!==zmail.folId.tId)continue;f+=n.FD!==l.fId&&zmail.folCount[l.fId]&&3!==b.opentype?'<div class="SC_pct SC_Tfdr">':'<div class="SC_pct">',f+=zmPrev.getHeader({msgId:n.M,thd:!0,opentype:b.opentype,frm:n.F,sender:n.SN,hasAtt:n.AT,sm:n.SM,label:n.TAG,flag:n.NFG,date:n.DT,elemId:e,hdrId:c.hdrId,elemObj:c,showIndex:m}),f+="</div>"}0===b.opentype||4===b.opentype?(d=c.contElem,d.append(f),$(c.prevElem).addClass("tmail")):2===b.opentype?(d=c.contElem,d.append(f),zmsuite.getCenter()[1].$el.addClass("tmail")):3===b.opentype&&(d=c.contElem,_zm.addClass(d.parentElement,"tmail"),$(d).append(f))},u=function(a,b){var c,d=b.mId,e=[],f=[],g=0,h=zmList.getMailObj(d).T;a.tdata&&(a=a.tdata),c=b.elemObj;var i=c.viewDetails||zmInit.getListingDetObj(),j=zmList.getListObj(h);if(h&&!j&&(a.length||a.tdata)&&(zmInit.isDL||(j=zmCache.dolistObj(h,a),zmUtil.createListMap(h,j)),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(h)),"search"===i.view||"zmncenter"===i.view?f=e=j?j.MO:[]:(f=zmList.getViewBasedMsgList(h,i,!1),e=j?j.MO:[]),"tIcon"===b.from){if(f.length>1)s({MO:f},b,c);else if("unread"===i.view){var k=$.extend({},i);k.view="all",f=zmList.getViewBasedMsgList(h,k,!1),s({MO:f},b,c)}}else if("showMail"===b.from){t({MO:e},b,c),"0"!==b.opentype&&"4"!==b.opentype||zmsuite.getCenter()[1].$el.find(".SC_pct").removeClass("SC_Tfcs");for(var l=0;l<e.length;l++)if(b.mId===e[l]){g=l;break}g>0&&($(c.prevElem).find("#zmHdrP"+d).parent().insertAfter($(c.prevElem).find("#zmHdrP"+e[g-1]).parent()),$(c.prevElem).find("#zmHdrT"+d).parent().insertAfter($(c.prevElem).find("#zmHdrT"+e[g-1]).parent()),$(c.prevElem).find("#zmHdrS"+d).parent().insertAfter($(c.prevElem).find("#zmHdrS"+e[g-1]).parent()),$("#zmHdrN"+d).parent().insertAfter($("#zmHdrN"+e[g-1]).parent()))}},v=function(a,b,c){var d,e=j.parChild;if(d=b.attr("id")||b.attr("data-detail"),"add"===a){var f=zmList.getMailObj(d),g=f?f.PA:"";c.find("."+j.mRow).each(function(){var a=$(this),b=this.id||$(this).attr("data-detail");if(a.removeClass(e),b===d&&a.addClass(e),b===g){var c=zmList.getMailObj(g);a.addClass(e),g=void 0===c.PA?"":c.PA}})}else"remove"===a&&c.find("."+j.mRow).removeClass(e)},w=function(a,b,c){var d=zmUtil.getMailObj(a);d||(zmUtil.addMailData({M:a,FD:c||"",T:"",TAG:"",NFG:"",SM:"",SB:"",TH:0},a),d=zmUtil.getMailObj(a)),b&&(d.TH=1,d.T=b)},x=function(a,b,c){w(a,c);var d=zmList.getMailObj(a);d.F=d.F||b.FROM,d.TO=d.TO||b.TO,d.SN=d.SN||b.SENDER,d.R=d.R||b.RDT,d.SB=d.SB||b.SUBJECT,d.AT=d.AT||(b.NEWATT?1:0),d.MA=d.MA||b.MA},y=function(a,b,c){var d,e=b.msgId,f=b.type,h=b.prevId||e,i=zmList.getMailObj(e),j=b.tabId||zmTab.currentTab,k="",l=zmUtil.getMLConversionValue(),m=zmPreviewTemplate.getSubjectToPreview(i.SB);$(c.prevElem).removeClass("tmail smail"),c.rowElem&&zmList.doThreadPath(c.rowElem,"remove"),d=zmsuite.getCenter(j)[1].getNodes(),k=i.TH&&(0===l&&"zm_Container"===zmTab.currentTab||"zm_srch1"===zmTab.currentTab)?["DIV",{attrs:{"class":"SC_phd"},child:[["text",m],["I",{attrs:{"class":"msi-thread","data-event":"viewfullthd","data-from":"header",title:g.contextmenu.viewthd}}]]}]:["DIV",{attrs:{"class":"SC_phd"},child:[["text",m]]}];var n=_zm.copyOf(zmInit.prevHeader);if(n.rIcons=_zm.copyOf(zmInit.prevHeader.rIcons),i.streams&&(b.showIcons?n.rIcons.splice(2,n.rIcons.length-3):n.rIcons.splice(0,n.rIcons.length-1),b.titleTxt&&(k=["DIV",{child:[["SPAN",{attrs:{"class":"SC_StrmMT"},child:[["text",b.titleTxt]]}],["DIV",{attrs:{"class":"SC_phd"},child:[["text",m]]}]]}])),zmUtil.isChatletEnabled()&&zmUtil.isZohoAccount(zmail.accId)){var o=i.CLC,p=[];o>0&&p.push(["SPAN",{attrs:{"class":"zm_mct zmThmBG"},child:[["text",o]]}]),p.push(["I",{attrs:{"class":"msi-cliqColor"},child:[["I",{attrs:{"class":"path1"}}],["I",{attrs:{"class":"path2"}}]]}]),n.rIcons.unshift([{tooltip:zmText.applyArgs(zmText.get("mailsuite").tooltips.chatlet,{entity:zmText.get("mailsuite").entity[1]}),html:p,data:{action:"chatlet"}}])}zmInit.prevHeader.text=k,n.text=k,d[0].push(n),zmPrev.setMailDOMContent(a.mdata,b),"lt"===f&&zmsuite.getCenter(j)[1].contentObj.$el.find(".SC_pct").removeClass("SC_Tfcs"),c.contElem=zmsuite.getCenter(j)[1].contentObj.$el,c.hdrElem=zmsuite.getCenter(j)[1].getNodes()[0].$el,$(c.prevElem).attr({"data-mid":h,"data-ty":b.type});var q=b.opentype,r={fromMail:!1,previewType:""};"zm_Container"!==j&&(j.indexOf("zm_srch")||b.newStreams)||(r.fromMail=!0),0!==q&&4!==q||(r.previewType=0===q?"vertical":"horizontal"),zmsuite.getCenter(j)[1].show(r),i.TH&&c.viewDetails.fId!==zmail.folId.tId&&(0!==l&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||i.streams||"conversation"===b.src)?(u("",{mId:e,from:"showMail",opentype:b.opentype,elemObj:c}),$(c.prevElem).addClass("tmail"),"th"===f&&c.viewDetails.fId!==zmail.folId.spId&&c.viewDetails.fId!==zmail.folId.tId&&zmList.doThreadPath(c.rowElem,"add")):$(c.prevElem).addClass("smail"),zmPreviewTemplate.setPreviewHeaderHeight(c,j,b.opentype),$(c.prevElem).hasClass("tmail")?c.contElem.css({bottom:"0px"}):c.contElem.css({bottom:$(c.prevElem).find(".zmQRB").height()+"px"}),zmUtil.setScrollShadow(c.contElem),"conversation"===b.src?($(c.mainElem).find("i.msi-prev,i.msi-next").closest("b").addClass("SC_opy3"),zmTopMenus.util.show({type:"functional",view:zmInit.getListingDetObj(),tabId:b.tabId})):b.streamsShowMail||(zmTopMenus.util.show({type:"functional",msgId:e,view:zmInit.getListingDetObj(),tabId:b.tabId}),zmList.unchkAll(c),zmPrev.PvNt(b.rowId,b.type,b.opentype,zmTab.currentTab,c))},z=function(a,b,c){zmPrev.setMailDOMContent(a.mdata,b);var d=zmList.getMailObj(b.msgId),e=a.tdata&&a.tdata.length?"t"+d.T:d.M,f=c.contElem[0].parentElement,g=d.TH?d.T:"";if(_zm.setAttr(f,{msgId:e,groupId:b.shOwner||b.groupId,thId:g,pid:d.M,actionType:b.streamAction}),a.tdata&&a.tdata.length||zmList.getMailObj(e).T&&zmUtil.getListMap(g)){var h=a.tdata||zmUtil.getListMap(g,"MO");u(h,{mId:b.msgId,from:"showMail",opentype:3,elemObj:c})}},A=function(a,b,c){var d,e=zmList.getMailObj(a)&&zmList.getMailObj(a).T||void 0,f="zm_tab"+a;if(zmsuite.isWorkspaceAvailable(f)&&zmTopMenus.util.show({type:"functional",msgId:a,tabId:f,elem:zmsuite.getCenter(f)[1].getNodes()[0]}),f="zm_tabt"+e,e&&zmsuite.isWorkspaceAvailable(f)&&(d=zmUtil.getSelectedMails(f)[0][0],a===d&&zmTopMenus.util.show({type:"functional",msgId:a,tabId:f,elem:zmsuite.getCenter(f)[1].getNodes()[0]})),zmPrev.prevDetails()&&!zmList.getSelectedRowCount()){var g=zmUtil.getSelectedMails("zm_Container");d=g[0][0]||g[1][0],d===a&&zmTopMenus.util.show({type:"functional",msgId:a,tabId:"zm_Container"})}},B=function(a,b,c){var d,e,f=b.msgId,i=f,j=zmList.getMailObj(f),k=zmPreviewTemplate.getSubjectToPreview(j.SB),l="",m={},n=zmUtil.getMLConversionValue(),o=b.msgId;j.TH&&(0!==n&&c.viewDetails&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||j.streams||"conversation"===b.src||"restore"===b.src&&"conversation"===b.toOpen)&&(e=j.T,i=e,f="t"+e,o=e),d="zm_tab"+f;var p=function(a,b){var c=b.id.split("#")[1];c===o&&zmsuite.isWorkspaceAvailable(d)&&zmsuite.closeWorkspace(d)};if($.subscribe("zmstreamsapp/deletePost",p),zmsuite.isWorkspaceAvailable(d)&&"restore"!==b.src&&!b.streamsMail)return void zmsuite.showWorkSpace(d);b.tabId=d,b.from&&zmsuite.isWorkspaceAvailable("zm_tab"+b.from)&&"restore"!==b.src&&zmsuite.closeWorkspace("zm_tab"+b.from);var q=b.actionType;b.streamsMail&&(q=zmCont.isGroup(b.groupId)?"viewGroupEntity":"viewSelfData");var r=function(){var a=zmsuite.createAppRouter();return b.streamsMail?(a._hashKey="stream",a.initialize({hashKey:"stream",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),a.setParams(["tab",b.groupId,i,b.entityType,q])):(a._hashKey="mail",a.initialize({hashKey:"mail",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),a.setParams(["tab",f])),a},s=r(),t=function(){var b={appname:_zm.unescapeTags(k),title:a.mdata.SENDER,appId:d,faqKey:"Conversations",data:{CNodes:"2"},router:s,appIcon:"msi-mailopen",shortcuts:zmshCut.mail,titleProvider:function(){return zmUtil.decodeHTMLEntities(k)}};return b},v=t(),w={appId:d,msgId:b.msgId,opentype:2,type:b.type};v.onDelete=function(){var a=zmsuite.getCenter(d)[1].$el;return zmPreviewTemplate.unsubscribeNotesTasks(a),$.publish("/mail/tabClosed",{container:a}),!0},("restore"===b.src||b.streamsMail)&&zmsuite.isWorkspaceAvailable(d)?zmsuite.resetWorkspace(d,v):zmsuite.setWorkSpace(v),c=c||zmList.getListingElemObj(b);var x=zmsuite.getCenter(),y=x[0].getNodes(),z=x[1].getNodes();y[1].$el.remove(),zmsuite.renderCenter(),l=j.TH&&(0===n||c.viewDetails&&c.viewDetails.folId===zmail.folId.sId||c.viewDetails&&"search"===c.viewDetails.view)?["DIV",{attrs:{"class":"SC_phd"},child:[["text",k],["I",{attrs:{"class":"msi-thread","data-event":"msi-thread","data-action":"viewfullthd","data-from":"header",title:g.contextmenu.viewthd}}]]}]:b.titleTxt?["DIV",{child:[["SPAN",{attrs:{"class":"SC_StrmMT"},child:[["text",b.titleTxt]]}],["DIV",{attrs:{"class":"SC_phd"},child:[["text",k]]}]]}]:["DIV",{attrs:{"class":"SC_phd"},child:[["text",k]]}];var A=zmTopMenus.util.get("functional");if(!zmail.isPopupMail&&zmail.isOrg&&zmUtil.isChatletEnabled()){var B=j.CLC,C=[];B>0&&C.push(["SPAN",{attrs:{"class":"zm_mct zmThmBG"},child:[["text",B]]}]),C.push(["I",{attrs:{"class":"msi-cliqColor"},child:[["I",{attrs:{"class":"path1"}}],["I",{attrs:{"class":"path2"}}]]}]),A.unshift({groupId:"chat",actionArr:[{html:C,tooltip:zmText.applyArgs(zmText.get("mailsuite").tooltips.chatlet,{entity:zmText.get("mailsuite").entity[1]}),data:"msi-chat",hideIcon:!0}],hideGroup:!0})}if(A.push({groupId:"prevIcons",actionArr:[{iconClass:"msi-prev",data:"msi-prev",tooltip:h.iconTooltip.prev},{iconClass:"msi-next",data:"msi-next",tooltip:h.iconTooltip.next}]}),m={id:"zmPrevHeader",rIcons:A},m.text=l,z[0].push(m),b.streamsMail&&(m.rIcons=[]),z[0].setListener("click",function(a,b){switch(a){case"msi-prev":zmPreviewTemplate.loadPrevMail();break;case"msi-next":zmPreviewTemplate.loadNextMail();break;case"msi-close":zmList.bindAction({action:"clsPrev"}),$.unsubscribe("zmstreamsapp/deletePost",p);break;case"msi-thread":zmList.bindAction($(b).data(),b);break;default:zmInit.bindActionHeaderIcons(null,a,b)}}),zmsuite.getCenterOuter().$el.data("row-detail",b),c.viewDetails&&"search"===c.viewDetails.view)zmsuite.isWorkspaceAvailable("zm_srch1")&&zmsuite.getCenterOuter().$el.data("data-maillist",zmSearchUtil.getSearchList().slice()),zmsuite.getCenterOuter().$el.data("data-detail",c.viewDetails);else if(c.viewDetails&&"stream"===c.viewDetails.view)zmsuite.getCenterOuter().$el.data("data-maillist",[b.msgId]),zmsuite.getCenterOuter().$el.data("data-detail",c.viewDetails);else{var D=zmInit.getListingDetObj(),E=zmUtil.getFolId(D);zmsuite.getCenterOuter().$el.data("data-detail",D),zmsuite.getCenterOuter().$el.data("data-maillist",zmail.listObj[E]&&zmail.listObj[E].MO.slice()||[])}zmPrev.setMailDOMContent(a.mdata,b),c.mainElem=x[0].$el,c.contElem=x[1].contentObj.$el,c.hdrElem=z[0].$el,c.prevElem=x[1].$el,x[1].show(),b.isReminder||j.TH&&j.FD!==zmail.folId.tId&&(0!==n&&c.viewDetails&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||j.streams||"conversation"===b.src||"restore"===b.src&&"conversation"===b.toOpen)?(w.tId=j.T,u("",{mId:b.msgId,from:"showMail",opentype:b.opentype,elemObj:c}),$(c.prevElem).addClass("tmail")):$(c.prevElem).addClass("smail"),zmsuite.showWorkSpace(d),x[1].$el.addClass("SC_w100"),zmTopMenus.util.show({type:"functional",msgId:a.mdata&&a.mdata.MSGID||void 0,view:c.viewDetails,elem:z[0],tabId:d});var F=zmsuite.getCenter()[1].getNodes()[0].$el[0].clientHeight;c.contElem.css({top:F+"px"}),$(c.prevElem).hasClass("tmail")?c.contElem.css({bottom:"0px"}):(x[1].contentObj.$el.find(".SC_pct").removeClass("SC_Tfcs"),
c.contElem.css({bottom:$(c.prevElem).find(".zmQRB").height()+"px"})),$(c.prevElem).attr({"data-mid":b.msgId,"data-ty":b.type}),zmUtil.setScrollShadow(c.contElem),b.src&&("conversation"===b.src||"external"===b.src||"restore"===b.src)||j.streams?$(c.mainElem).find("i.msi-prev,i.msi-next").closest("b").addClass("SC_opy3"):b.streamsShowMail||zmPrev.PvNt(b.rowId,b.type,b.opentype,d,c),w.fId=j.FD,w.viewDetails=c.viewDetails,w.toOpen=b.toOpen||"conversation"===b.src?"conversation":void 0;var G={actionType:"viewGroupEntity",etype:b.entityType,gid:b.groupId};if(G.pid=w.tId?w.tId:b.msgId,b.streamsMail){var H={appId:d,appname:k,data:{},appIcon:"msi-mailopen"};$.publish("zmail/SaveTabState",[{appId:d,app:"stream",appObj:H,category:"stream_mail",data:G}])}else $.publish("zmail/SaveTabState",[{appId:d,app:"m",appObj:{appId:d,appname:k,data:{},appIcon:"msi-mailopen"},category:"mail_tab",data:w}]),zmRestore.saveState("tab",{key:"tab",data:{app:"m",category:"mail_tab",data:w}},{action:"open"})},C=function(a,b,c,d){if(b=b||{},"tIcon"!==b.from&&"prefetch"!==b.from&&"bulk"!==a.mode){var e=zmList.getMailObj(a.msgId)||{},f=a.entityId||e.T||a.msgId;f&&(a.entityId=f),a.groupId=a.groupId||zmail.zuid,a.entityType=1}(a.shId||a.shareId)&&(b.avoidCache=!0),a.msgId&&zmContentCache.isCached(a.msgId)&&a.hasdraft&&(b.forceFetch=!0);var g={u:zmail.conPath+"/md.do",t:"POST",fn:c,p:a,ep:b,setSessionId:b.setSessionId};"function"==typeof d&&(g.efn=d),zmInit.isDL&&"tIcon"===b.from?ZMail.listing.collection.fetchThdList(g):zmContentCache.fetch(g)},D=function(a){var b,c={};return a=a||zmTab.currentTab,b=zmsuite.getCenter(a),b[1]&&(c.prevElem=b[1].$el[0]),b[0].getNodes()[2]&&(c.listElem=b[0].getNodes()[2].$el[0]),c.mainElem=b[0].$el,c.hdrId="zmHdr",c.viewDetails=$.extend({},zmsuite.getCenterOuter(a).$el.data("data-detail")),a.indexOf("zm_srch")?a.indexOf("zmStreamsApp")?a.indexOf("zmncenter")?a.indexOf("zm_tab")?c.viewDetails=$.extend({},zmInit.getListingDetObj()):c.viewDetails=$.extend({},zmsuite.getCenterOuter(a).$el.data("data-detail")):c.viewDetails={view:"zmncenter"}:c.viewDetails={view:"stream"}:(c.id=1,c.viewDetails=$.extend({},zmSearchUtil.getSearchViewDetails())),c},E=function(a){var b,c,d,e,f,g,h,i,j={},k=!1,l=!1,m=zmUtil.getMLConversionValue();if(h=a.tabId||zmTab.currentTab,f=a.msgId,!f)return j;if(f.indexOf("t")||(f=f.substring(1)),i=zmList.getMailObj(f),h.indexOf("zm_srch")||(k=!0),zmUtil.getFolId()===zmail.folId.sId&&(l=!0),k)g=h.substring(7),d=zmSearchUtil.getSearchViewDetails(),b="lt"===a.type?zmSearchUtil.getSearchList():zmList.getViewBasedMsgList(i.T,d,!1);else{d=zmInit.getListingDetObj(),e=a.opentype,c=zmUtil.getFolId();var n;"lt"===a.type||2===e&&0!==m?(n=zmList.getListObj(c),n&&(b=n.MO)):zmList.getListObj(i.T)&&(b=zmList.getViewBasedMsgList(i.T,d,!1))}return 0===e||4===e?j=D("zmStreamsApp"===h?"zmStreamsApp":"zm_Container"):(j=D(h),j.listElem||(k?j.listElem=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el:j.listElem=zmail.mailCenter.listElem)),j.listArr=b,j.id=g,j.msgId=f,j.isParent=i.TH&&"lt"===a.type&&0!==m,"lt"===a.type&&i.TH&&0!==m?k||l?j.rowElem=$(j.listElem).find("#"+f):j.rowElem=$(zmail.mailCenter.listElem).find("#t"+f):k||l?j.rowElem=$(j.listElem).find("#"+f):j.rowElem=$(zmail.mailCenter.listElem).find("#"+f),k&&(zmSearchUtil.isNewSearch()?j.collection={}:j.collection=zmail.searchObj[1].collection),2===a.opentype?(j.contElem=zmsuite.getCenter("zm_Container")[1].getNodes()[1].$el.children().eq(0),j.hdrElem=zmsuite.getCenter("zm_Container")[1].getNodes()[0].$el):(j.contElem=zmsuite.getCenter()[1].getNodes()[1].$el.children().eq(0),j.hdrElem=zmsuite.getCenter()[1].getNodes()[0].$el),j.type=a.type,j},F=function(a,b,c,d,e){var f,g,h,i={attData:{},addInfo:{}},j=zmail.attachmentContainer;for(f in c)g=c[f].e,i.attData[g]||(i.attData[g]={},i.attData[g].attData=[],i.attData[g].addInfo={}),i.attData[g].attData.push(c[f]);i.addInfo.shownext=d,i.addInfo.isFull=!0,"tc"===e&&(i.addInfo.isFull=!1),h=j.getObject(b),h?"tc"===e?h.data.attData[a]=i.attData[a]:"t"===e&&(h.data=i):j.addObject({id:b,data:i})},G=function(a,b,c){var d=!1,e=zmail.attachmentContainer;switch(c){case"sm":(e.getObject(b)||zmail.mailAttachments[a])&&(d=!0);break;case"tc":(e.getObject(b)||zmail.mailAttachments[b])&&zmail.mailAttachments[b].data.attData[a]&&(d=!0);break;case"t":(e.getObject(b)||zmail.mailAttachments[b])&&zmail.mailAttachments[b].data.addInfo.isFull&&(d=!0)}return d},H=function(a,b,c){var d=[];switch(c){case"sm":zmail.mailAttachments[a]&&(d=zmail.mailAttachments[a].data.attData[a].attData);break;case"tc":zmail.mailAttachments[b]&&zmail.mailAttachments[b].data.attData[a]&&(d=zmail.mailAttachments[b].data.attData[a].attData);break;case"t":if(zmail.mailAttachments[b]){var e,f,g,h=zmail.mailAttachments[b].data.attData,i=Object.getOwnPropertyNames(h);for(e=0;e<i.length;e++){g=h[i[e]].attData;for(f in g)d.push(g[f])}}break;default:d=[]}return d},I=function(a){var b,c,d=a.mId||a.mailID,e=zmList.getMailObj(d),f=e.T?e.CMT:e.CT;"opening"===a.state?(b="/mail/openingincontainer",c={mailID:String(d),useConversation:Boolean(e.T),conversationID:e.T?String(e.T):"",openedBy:a.openedBy,openedTab:a.openedTab,folderID:e.FD,commentValue:f}):"opened"===a.state&&(b="/mail/openedincontainer",c={mailID:String(d),containerDOM:a.elem,useConversation:Boolean(e.T),commentValue:f,conversationID:e.T?String(e.T):"",openedBy:a.openedBy,folderID:e.FD,openedTab:a.openedTab}),$.publish(b,c)},J=function(a,c){var d;if(!a.MSGID||"bulk"!==c.mode&&"oldest"!==c.getUnread&&"latest"!==c.getUnread||c.msgId===a.MSGID||(d=zmList.getMailObj(c.msgId)||{},d.TH?x(a.MSGID,a,d.T):x(a.MSGID,a),c.msgId=a.MSGID),a.mdata&&c.streamsMail?zmContentCache.processResponse(a,"",c):zmContentCache.populateMailData(a,c),a.mdata&&a.mdata.MSGID&&1===Object.keys(a.mdata).length)return void(c.prevDefObj&&c.prevDefObj.resolve());zmUtil.debugLog("zmList.openMail()",a,c);var e,f,g,h,i,j,k,l,m,n;if(e=c.msgId,d=zmList.getMailObj(e),"external"!==c.src&&"restore"!==c.src&&"zmncenter"!==c.src||!a.mdata||(x(e,a.mdata),d.AT&&(c.att=d.AT),a.tdata&&a.tdata.length&&!d.T&&(d.TH=1,d.T=a.tdata[0].T)),c.streamsShowMail=c.streamsShowMail||!1,c.isDraftMail=c.isDraftMail||!1,c.isDraftEditable=c.isDraftEditable||!1,f=d.T,h=c.opentype,g=c.elemObj,l=c.isSh||!1,n=c.isReminder||!1,l&&3!==h&&delete c.streams,f&&!c.streamsMail&&("zm_srch1"===zmTab.currentTab&&("conversation"===c.src||"conversation"===c.toOpen||"content"===c.type)||0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==zmTab.currentTab||0===zmUtil.getMLConversionValue()&&("conversation"===c.src||"conversation"===c.toOpen))&&(c.showIndex=!0),0===h||4===h?g&&"search"===g.viewDetails.view?(k="S"+e,m="S"):(k="P"+e,m="P"):2===h?(k="T"+e,m="T"):3===h&&(k="N"+e,m="N"),c.prefix=m,g&&"search"===g.viewDetails.view&&!g.listArr){var o=g.id;zmSearchUtil.isNewSearch()?(g.searchStr=zmSearchUtil.getSearchString(),g.listArr=zmSearchUtil.getSearchList()):("srch"===zmail.searchObj[o].collection.type?(g.searchStr=zmail.searchObj[o].collection.searchContArr[0],g.searchType=2):(g.searchStr=zmail.searchObj[o].collection.advSearchStr,g.searchType=3),g.listArr=zmail.searchObj[o].collection.searchList),"lt"===c.type&&d.TH?g.rowElem=$(g.listElem).find("#t"+e):g.rowElem=$(g.listElem).find("#"+e)}if(a.tdata&&(c.sm=d.SM||"",c.streamsMail)){var p,q,r,s=a.tdata,t=s.length;for(p=0;p<t;p++)q=s[p].M,q&&(r=zmList.getMailObj(q),r.accId=c.accId,r.actionType=c.actionType,r.entityType=c.entityType,r.groupId=c.groupId,r.entityType=c.entityType,r.S=1,r.streams=!0,r.isFav=c.isFav,r.TAG=c.TAG,c.newStreams&&(r.newStreams=!0))}if(c.vfc){var u=zmContentCache.isCached(e)&&zmContentCache.get(e).EXTIMG||{};c.imgStatus=u.link,zmPreviewTemplate.showFullContent(a,c)}else if("content"===c.type)"bulk_mail"!==c.load_action&&$(g.prevElem).find(".SC_pct").removeClass("SC_Tfcs"),zmPrev.setMailDOMContent(a.mdata,c),2===h&&g&&("search"===g.viewDetails.view&&(g=zmList.getElemObj()),$(g.prevElem).attr({"data-mid":c.msgId,"data-ty":"th"})),3!==h&&zmPreviewTemplate.setPreviewHeaderHeight(g,c.tabId,h);else{if(0===h||4===h){if(c.cpvreq&&c.cpvreq!==b)return void(c.markread&&zmail.MailAction.Initializer.applyActions("unread","click",{msgId:[e],thd:[]}));y(a,c,g),c.streamsShowMail||"zm_srch1"===c.tabId||(zmUrlAct.update({from:"zmCenter",msgId:c.msgId,type:c.type,opentype:0}),zmRestore.saveState("preview",{p:c.msgId},{}))}else 2===h?B(a,c,g):3===h&&("zmncenter"===c.src&&(zmList.getNotifyPopupContainer(a.mdata,g.prevElem,l,n,g),c.parentElm=g.contElem,g.prevElem.className.indexOf("SC_Twpr")===-1&&(g.contElem[0].style.maxHeight=document.body.getBoundingClientRect().height-zmUtil.wmsBarHeight()-320+"px",g.contElem[0].style.overflow="auto"),a.mdata.shareId=c.shId||c.shareId),z(a,c,g));if(c.streamsMail&&3!==h&&!a.mdata.newStreams&&!l){var v=f||e;v=zmList.getMailObj(v).groupId+"#"+v,zmUtil.requireStreamsApp().then(function(){zmStreamsApp.PostActions.getSharedMail(v,$(g.contElem)[0])}).fail(function(){zmUtil.debugLog("Could not load comments !","zmList.openMail()",arguments)})}if(g.contElem){var w=$.extend({},c);$(g.contElem).data("msg_params",w)}}if(zmPreviewTemplate.addDraftsToView(d.T,$(g.prevElem),m),a.mdata&&a.mdata.READSTATUS&&c.reqSent)"success"===a.mdata.READSTATUS&&zmail.MailAction.Initializer.rapplyActions({result:"success"},{mailId:[e],thd:[],action:"read"});else if(0===d.S&&d.FD!==zmail.folId.oId&&"stream"!==g.viewDetails.view||c.markread){var A={};A.msgId=[e],A.thd=[],zmail.MailAction.Initializer.applyActions("read","click",A)}g?(i=$(g.prevElem),3===h&&(i.closest(".SCS_popUp").length?i=i.closest(".SCS_popUp"):i.closest("#postpopUp").length&&(i=i.closest("#postpopUp"))),j="th"===c.type||"content"===c.type?$("#zmCon"+k):$(g.prevElem)):i=j=$(c.parentElm),d.FD===zmail.folId.oId&&$(g.prevElem).find("i.msi-popout").closest("b").addClass("SC_opy3"),zmContentCache.isCached(e)&&zmContentCache.get(e).CALOBJ&&zmAppLoader.load("eventMarkup").then(function(){zmEventMarkup.construct(e,i,{prefix:c.prefix})});var C=a.mdata.SPAMDATA&&a.mdata.SPAMDATA.ALERT_TYPE;if(C=parseInt(C),C>0&&zmAppLoader.load("spamMarkup").then(function(){ZMail.Components.spamMarkup.load({fId:d.FD,container:i.find("#zmCon"+c.prefix+e)[0],headerElm:i.find("#zmHdr"+c.prefix+e)[0],alertType:C,alertMsg:a.mdata.SPAMDATA.ALERT_MSG,sender:a.mdata.FROM})}),d.SCOBJ&&d.FD!==zmail.folId.spId&&d.FD!==zmail.folId.sId&&zmAppLoader.load("markup").then(function(){zmMarkup.load({msgId:e,schemaObj:d.SCOBJ[0],selector:i,prefix:c.prefix})}),zmPreviewTemplate.showImageDisplayElem(e,i,{isvfc:c.vfc,imgStatus:c.imgStatus}),d.FD!==zmail.folId.spId&&zmPreviewTemplate.showUnsubscribe(e,i),"content"!==c.type&&(c.vfc||zmPreviewTemplate.showProfilePhoto({msgId:c.msgId,type:"lt"},i),f&&zmail.listObj[f]&&1===zmail.listObj[f].showNextPage&&(0!==zmUtil.getMLConversionValue()&&"search"!==g.viewDetails.view||"conversation"===c.src||"conversation"===c.toOpen||c.streamsMail)&&zmPreviewTemplate.addShowMoreMailsLink(g,h)),zmPreviewTemplate.bindPreviewEvents(i,h),zmPreviewTemplate.applyHeaderState(i.find("#zmHdr"+k)),"bulk_mail"===c.load_action||c.noScroll||c.vfc||zmUtil.setPreviewScroll($("#zmHdr"+k).closest(".SC_pct"),g.contElem),d.TH&&"lt"===c.type&&!c.streamsShowMail&&"1"===zmAdHocSettings.getMarkConversationRead()&&(zmInit.checkThreadRead(f)||zmList.loadUnreadMails(f,h,g.viewDetails)),c.showIndex&&$('[id="zmHdr'+k+'"]').each(function(a,b){setTimeout(function(){$(b).find("#zm_readtitle").fadeOut()},5e3)}),a.mdata.NEWATT){var D,E,H,J,K,L,M=a.mdata.NEWATT,N=M.length,O=0;for(d.TH?(K=d.T,L="tc"):(K=e,L="sm"),G(e,K,L)||F(e,K,M,void 0,L),J=d.FD,J&&zmUtil.isSharedFolder(J)&&(D=zmUtil.getShareId(J)),d.streams&&(H=d.groupId,E="viewGroupEntity"),O=0;O<N;O++)D&&(M[O].shId=D),H&&(M[O].gId=H,M[O].type=E);zmPreviewTemplate.setSlideShow(M,j[0])}if(!c.vfc){if(a.comment&&l){a.comment.comments||(a.comment={comments:{},order:[]}),a.comment.shOwner=c.shOwner;var P=f||e;zmUtil.requireStreamsApp().then(function(){var b=a.sharedUsers||[],e={comment:a.comment,shId:c.shId||c.shareId,sharedUsers:b,commentuuid:c.commentuuid,sharedToMe:zmUtil.isSharedFolder(d.FD)};3===h&&(e.fixedComment=!0),zmStreamsApp.PostActions.getSharedMail(P,g.contElem[0],e,!0)}).fail(function(){zmUtil.debugLog("Could not load comments for shared folder mail !","zmList.openMail()",arguments)})}else c.streamsMail||l||"content"!==c.type&&c.vfc!==!0&&($(g.contElem).siblings(".zms_fixed").remove(),zmUtil.requireMailCollab().then(function(){I({state:"opened",mId:e,elem:$(g.contElem)[0],openedBy:h,openedTab:zmTab.currentTab})}));zmUtil.publishMPreviewEvent(e),zmPreviewTemplate.processReadReceipt(e)}c.prevDefObj&&c.prevDefObj.resolve(e)},K=function(a,b){var c,d=b.msgId||[],e=d.length,f=!1;for(c=0;c<e;c++){var g=d[c];if(zmContentCache.isCached(g)){var h={},i={msgId:g,type:"content",reqSent:f,load_action:"bulk_mail"};i.elemObj=D(),i.opentype=b.opentype,i.markread=b.markread;var j=$(i.elemObj.prevElem).find(".zmPHdr[data-mid='"+g+"']"),k=j.attr("id");if(k){k=k.substring(5),i.from=$(i.elemObj.prevElem).find(".zmPHdr[data-mid='"+g+"']");var l=$("<div />");l.attr("id","zmCon"+k),j.after(l),J(h,i)}}}zmInit.checkThreadRead(b.thdId)||zmList.loadUnreadMails(b.thdId,b.opentype,b.viewDet)},L=function(a,b,c){var d=zmPrev.prevDetails().msgId;if(d){d.indexOf("t")||(d=d.substring(1));var e=zmList.getMailObj(d);if(e&&e.T===a){var f,g,h,i=[],j=[],k=[],l=[],m=5;c=c||D().viewDetails,i=zmList.getViewBasedMsgList(a,c,!0),f=i.length;var n;for(g=0,h=0;g<f&&h<m;g++)n=zmList.getMailObj(i[g]),n&&0===n.S&&(k.push(i[g]),zmContentCache.isCached(i[g])||(j.push(i[g]),n.AR?l.push(!0):l.push(!1)),h++);if(k.length){var o={accId:zmail.accId,summary:!0,mode:"bulk",markread:!0},p={markread:o.markread,msgId:k,thdId:a,opentype:b,viewDet:c};n=zmList.getMailObj(k[0]),o.msgId=j.join(),o.archiveStatus=l.join(),o.folId=n.FD,zmUtil.isSharedFolder(n.FD)&&(o.shId=p.shId=zmUtil.getShareId(n.FD)),j.length?C(o,p,K):K({},p)}}}},M=function(a,b){var c,d,e=a,f=[],g=0,h=zmList.getMailObj(a)||{};for(c=h.T,f=zmList.getViewBasedMsgList(c,b,!0),g=f.length,d=g-1;d>=0;d--)if(h=zmList.getMailObj(f[d])||{},0===h.S&&0===h.AR){e=f[d];break}return e},N=function(a,b){var c,d,e=a,f=[],g=0,h=zmList.getMailObj(a)||{};for(c=h.T,f=zmList.getViewBasedMsgList(c,b,!0),g=f.length,d=0;d<g;d++)if(h=zmList.getMailObj(f[d])||{},0===h.S&&0===h.AR){e=f[d];break}return e},O=function(a,b){if(a){var c=zmUtil.getFolId(),d=zmList.getListObj(c);d=d?d.MO:[];var e=d.length;if(e>0){var f,g,h,i,j,k=2,l=4,m=0,n=!1,o=!1,p=!1,q=!1,r=0,s=10,t=d.indexOf(a),u=[],v=[];if(t!==-1){for(0!==zmUtil.getMLConversionValue()&&"archive"!==zmInit.getListingDetObj().view&&"0"===zmAdHocSettings.getMarkConversationRead()&&(q=!0),f=t-1,g=0,h=0;f>=0&&g<k&&h<s;f--){if(i=d[f],j=zmList.getMailObj(i),j&&j.TH&&q&&0===j.TS&&zmList.getListObj(j.T)&&(i=M(i,zmInit.getListingDetObj())||d[f],j=zmList.getMailObj(i)),j&&0===j.S){if(n=!0,zmContentCache.isCached(i)){m++;break}v.push(i),u.push(!1),g++}h++}for(k=l-v.length,f=t+1,g=0,h=0;f<e&&g<k&&h<s;f++){if(i=d[f],j=zmList.getMailObj(i),j&&j.TH&&q&&0===j.TS&&zmList.getListObj(j.T)&&(i=M(i,zmInit.getListingDetObj())||d[f],j=zmList.getMailObj(i)),j&&0===j.S){if(o=!0,zmContentCache.isCached(i)){r++;break}v.push(i),u.push(!1),g++}h++}if((n&&0===m)|(o&&0===r)&&(p=!0),v.length&&p){if("mailIds"===b)return v;var w={from:"prefetch"},x={accId:zmail.accId,summary:!0};x.msgId=v[0],x.folId=zmList.getMailObj(v[0]).FD,v.splice(0,1),v.length&&(x.mailId=v.join(),w.setSessionId=!0),w=$.extend(w,x),C(x,w,"")}}}}},P=function(a,b){var c,d,e,f;if("header"===a.from){var g=$(b).closest(".SC_pv");zmInit.rclkId=g.attr("data-mid"),"zm_Container"===zmTab.currentTab&&"lt"===g.attr("data-ty")&&zmList.getMailObj(zmInit.rclkId).TH&&(zmInit.rclkId="t"+zmInit.rclkId)}else"list"===a.from&&(zmInit.rclkId=$(b).closest("."+j.mRow).attr("id"));if(zmInit.rclkId.indexOf("t")){if(c=zmInit.rclkId,f=zmList.getMailObj(c),f.FD===zmail.folId.oId)return;e=zmail.conPath+"/popMail.do?accId="+zmail.accId+"&msgId="+c+"&folId="+f.FD+"&att="+f.AT,zmUtil.isInlineCompose()&&(e+="&inlineCompose=true"),f.TH&&(e+="&thId="+f.T+"&showConv=false")}else c=zmInit.rclkId.substring(1),f=zmList.getMailObj(c),d=f.T,e=zmail.conPath+"/popMail.do?accId="+zmail.accId+"&msgId="+c+"&thId="+d+"&folId="+f.FD+"&att="+f.AT+"&showConv=true",zmUtil.isInlineCompose()&&(e+="&inlineCompose=true");var h,i=f.FD,k=!1;zmUtil.isSharedFolder(i)?(k=!0,e+="&rShareId="+zmUtil.getShareId(i)+"&isSh=true&groupId="+zmail.shrTree[0][i].OZUID):zmUtil.isFolderId(i)&&(k=!0,h=zmList.getRowInfo(i,"zmlTreeH","info").SH,"-1"!==h&&(e+="&isSh=true&groupId="+zmail.zuid+"&rShareId="+h)),k&&(e+="&entityId="+c+"&entityType=1"),zmTab.currentTab.indexOf("zm_srch")||(e+="&isSrch=true"),e+="&feature="+zmail.showFeature,a.actionSrc&&(e+="&actionSrc="+a.actionSrc),zmUtil.openWindow(e,60,80)},Q=function(a){var b=$(a).children("."+j.mRow);if(b.length>0){var c=b.filter(":not(."+j.chkBox+")");if(0===c.length)return!0}return!1},R=function(a){return!!$(a).find("."+j.chkBox).length},S=function(a,b){var c=b.cName,d=zmList.getElemObj();"success"===a.result?"show"===b.opt?("SZ"===c?$(d.listElem).find("."+j.size).show():"DT"===c&&$(d.listElem).find("."+j.date).show(),zmail.viewInfo[0][c]="s"):("SZ"===c?$(d.listElem).find("."+j.size).hide():"DT"===c&&$(d.listElem).find("."+j.date).hide(),zmail.viewInfo[0][c]="h"):zmsDialog.alert(f.common.errorCustomizeColumn)},T=function(a){var b=a.mailID,d=zmList.getMailObj(b);if(d){var e=d&&d.T,f=[];f=e&&zmList.getListObj(e)?zmList.getListObj(e).MO:[b];var g,h,i=a.total;if(!isNaN(i)){var k={};k.update=function(a,b){if(!parseInt(zmAdHocSettings.getCustomizeMailListing().commentcount)){var c=$(a).find("."+j.cmtCount);if(c.length){var d=b+'<i class="msi-lcmnt"></i>';c.html(d)}}},k.remove=function(a){var b=$(a).find("."+j.cmtCount);b.length&&b.html("")},k.getElem=function(){var a,b=["zm_Container","zm_srch1"],d=[];return b.forEach(function(b){a=c.getViewObject(h,b),a=a&&a.$element,a&&a.length&&d.push(a)}),d};for(g in f)h=f[g],zmList.updateModel("CMT",i,h),k.getElem().forEach(function(a){0===i?k.remove(a):k.update(a,i)})}}};$.subscribe("/streams/comment",function(a,b){if("1"===b.etype)try{T(b)}catch(c){zmUtil.debugLog(c)}});var U=function(a,b){var c,d="",e=[],f=zmList.getMailObj(a);if(!a||!f)return"";var g=zmList.getListObj(b);if(g?e=g.MO:"search"===b&&(e=zmSearchUtil.getSearchList()),c=e.length,c>0){var h,i,j=f.T;for(h=0;h<c;h++)if(i=zmList.getMailObj(e[h]),e[h]===j||i.TH&&i.T===j){d=e[h];break}}return d},V=function(a,b){var c,d,e,f=!1;if(d=b.msgId,e=b.type,d.indexOf("t")||(d=d.substring(1,d.length)),0===a||4===a){var g=b.tabId;c=zmPrev.prevDetails(g),f=d===c.msgId&&e===c.type&&"content"!==e}else if(2===a){var h=zmList.getMailObj(d)||{};"lt"!==e&&"th"!==e||!h.T||(d="t"+h.T),zmsuite.isWorkspaceAvailable("zm_tab"+d)&&"restore"!==b.src&&(zmsuite.showWorkSpace("zm_tab"+d),c=zmPrev.prevDetails("zm_tab"+d),f=b.msgId===c.msgId&&e===c.type&&"content"!==e)}return f},W=function(a){var b,c="",d="";if("string"==typeof a)d=a,c=$("#"+a).attr("data-ty");else{var e=j.mRow;b=$(a).closest("."+e),b.length&&(c=b.attr("data-ty"),d=b[0].id||b.attr("data-detail"))}return{msgId:d,type:c,opentype:zmail.mailOpt.isPopup}},X=function(){var a=zmsuite.getCenter()[0].getNodes()[2].$el[0];a.scrollTop=0;var b=$(a).children("."+j.chkBox+":first");b.length&&(a.scrollTop=b.offset().top-$(a).offset().top)},Y=function(a){return a=a||{},!!(a.view||a.flag||a.label||a.attach)},Z=function(a,b){var c;"zm_Container"===a&&(c="mListing",zmList.selDetails[c]={},"select_flag"===b?zmList.selDetails[c].flag="-1":"select_label"===b?zmList.selDetails[c].label="-1":"select_attach"===b?zmList.selDetails[c].attach="1":"select_unread"===b&&(zmList.selDetails[c].view="unread"))},_=function(a){a=a||zmTab.currentTab,"zm_Container"===a?zmList.selDetails.mListing={}:"zm_srch1"===a&&(zmList.selDetails.sListing={})},aa=function(a){var b,d=a.action,e=!0,g={},h=zmTab.currentTab,i=!1;"zm_Container"===h?(g=zmInit.getListingDetObj(),zmList.selDetails.mListing={}):h.indexOf("zm_srch")!==-1?(g=zmSearchUtil.getSearchViewDetails(),zmList.selDetails.sListing={}):g=zmsuite.getCenterOuter().$el.data("data-detail");var j=Y(g);switch(d){case"select_all":zmList.chkAll();break;case"select_none":e=!1;break;case"select_read":b=c.filter(c.readfilter),b.length?c.selectMails(b,!0):i=!0;break;case"select_unread":"unread"===g.view?zmList.chkAll():(b=c.filter(c.unreadfilter),b.length?(c.selectMails(b,!0),j||(zmList.showBulkActionBand("selFilter"),Z(h,d))):i=!0);break;case"select_flag":g.flag?zmList.chkAll():(b=c.filter(c.flaggedfilter),b.length?(c.selectMails(b,!0),j||(zmList.showBulkActionBand("selFilter"),Z(h,d))):i=!0);break;case"select_label":g.label?zmList.chkAll():(b=c.filter(c.taggedfilter),b.length?(c.selectMails(b,!0),j||(zmList.showBulkActionBand("selFilter"),Z(h,d))):i=!0);break;case"select_attach":g.attach?zmList.chkAll():(b=c.filter(c.attachmentfilter),b.length?(c.selectMails(b,!0),j||(zmList.showBulkActionBand("selFilter"),Z(h,d))):i=!0);break;default:e=!1}i&&_zm.succErrMsg("i",f.common.selectionWarnMsg),e&&"select_all"!==d&&X(),zmUtil.hideMenu()},ba=function(){var b=zmUtil.getFolId(),c=zmInit.findFolName(b),d=zdom("div",null,zdom("b",{className:"SC_opa50"},f.headertitle.attViewerHeader),zdom("i",{className:"msi-rarrow"}),c),e=zmText.applyArgs(f.headertitle.attViewerTabName,{folName:c}),g={accId:zmail.accId,mode:"lstEntity",thb:!0,fldId:b},h={workspaceConfig:{appname:e,headerHTML:d,onClose:function(){a=null},workspaceKey:b},attachListingConfig:{requireParams:g}};return a?void(a.getWorkspacekey()===b?zmsuite.showWorkSpace("attachList"):a.rerender(h)):void zmUtil.createAttachListingWorkspace(h,function(b){a=b})},ca=function(a){var b="",c="",d="",e=a.action,f=zmInit.getListingDetObj(),g=!0;switch(b=f.fId,e){case"view_all":c="all";break;case"view_unread":c="unread";break;case"view_flag":c="flag",d="-1";break;case"view_label":c="label",d="-1";break;case"view_attach":c="attach",d="1";break;case"view_archive":c="archive";break;case"listview":c=a.view,d=a.viewId;break;default:g=!1}g&&(("date"===f.sortBy&&f.sortOrder||"size"===f.sortBy)&&zmList.updateSortProperties(0),zmList.unchkAll(),zmInit.foldView({folId:b,view:c,viewId:d}),zmInit.updateHeaderBand()),zmUtil.hideMenu()},da=function(a,b){var c,d=[],e=[];"t"===a.charAt(0)?(a=a.substring(1),e.push(a)):d.push(a);var f="",g=zmList.getMailObj(a)||{};g.streams&&(f="default");var h={};if(zmUtil.getFolId()===zmail.folId.teId){var i=function(){var b=[],c=[],d={};return b=zmail.mailObj[a].TAG,zmail.templateCategory.forEach(function(e){d={},d.tempId=a,d.id=e.labelId,d.displayTxt=e.displayName,d.type="uncheck";var f=b.find(function(a){return a===e.labelId});f&&(d.type="check"),c.push(d)}),c},j=function(a){return"uncheck"===a.type||"partial"===a.type?(a.chkboxState(a,"check"),"add"):"check"===a.type?(a.chkboxState(a,"uncheck"),"delete"):void 0},k=function(a){var b=zmail.templateCategory.find(function(b){return b.labelId===a.id});return b.displayName};return h={parentDOM:$(b),data:i(),display:"displayTxt",direction:"right",displayAs:"popup",search:"displayTxt",showCheckbox:!0,showCreate:!1,onSelect:function(a,b){zmail.MailAction.Initializer.applyActions("label","click",{msgId:d,lA:j(a),lId:a.id,accType:f,disp:k(a)})}},zmUtil.createFLComp("checkbox",h).show(),!1}h={},h.parentDOM=$(b),h.displayAs="popup",h.accType=f,h.labelState={mailList:[{id:a,ttag:Boolean(e.length)}]},h.onStateChange=function(a,b){zmail.MailAction.Initializer.applyActions("label","click",{msgId:d,thd:e,lA:b?"add":"delete",lId:a,accType:f,disp:zmail.labInfo[a].dispName})},h.onCreate=function(a,b){zmlab.isValidName(a)&&zmlab.labelCreate(a,"",{reqDoneClbk:function(a,b){a&&(h.onStateChange(b,!0),c.hide())},color:b})},c=zmUtil.createFLComp("label",h),c.show()},ea=function(a,b){a.src="conversation",a.opentype=zmail.mailOpt.isPopup,zmList.getMailData(a,b)},fa=function(a,b,c,d){var e,f,g,h;if(e=f=a.msgId,g=zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails(),e.indexOf("t")||(f=e.substring(1)),0===a.opentype||4===a.opentype){var i=zmPrev.prevDetails(zmTab.currentTab);f===i.msgId&&a.type===i.type&&"content"!==a.type&&(zmPrev.clsPreview(),h=!0)}var j=zmList.getMailObj(f)||{};"unread"!==g.view||!c||f===c||j.TH&&j.T===zmList.getMailObj(c).T||zmList.remReadMail(),h||zmList.getMailData(a,b,d)},ga=function(a,b,c,d,e,f){zmAjq.XHR({u:zmail.conPath+a,t:b,fn:c,onerror:d,p:e,ep:f})},ha=function(a,b,c,d,e,f){var g,h,i="t"===d?1:0;g=i?"downloadconv":"downloadall";var j,k;j=zdom("div",{className:"SCmb puClose"},zdom("ul",null,zdom("li",null,zdom("b",{"data-tooltip":"Close"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"SC_ttip ttr"},zdom("i",{className:"msi-close"})))))),h=i?"zm_threadAtt":"",k=zmAttach.build({appName:"ML_popup",attList:b,zipType:g,showMOpt:!0,showTag:!0,supportDrag:!0,attClass:"zmAch",attListClass:"zmPAtt "+h,fileNameLen:20,entityInfo:{id:f,isThd:i,et:1}}),k=$("<li>").append(k),k.append(j),setTimeout(function(){var a=c.$el;a.find(".zmPAtt").length||(a.find("ul").append(k),e(),c.position(),zmPreviewTemplate.setSlideShow(b,a))},200)},ia=function(a){var b=zmsuite.showMenu(a),c=zmComponent.loadingBand({container:b.$el[0],type:"pagination"});return b.position(),[b,c]},ja=function(a,b,c,d,e,f){var g=function(g,h){if(h.reqId===m){var i;i="tc"===d?g[a]:g[b],i.length?(ha(c,i,f,d,e,b),F(a,b,i,g.shownext,d)):$("#zm_dropDown").remove()}},h=function(a,b){if(b.reqId===m){var c=a.msg;c&&_zm.succErrMsg("e",c),$("#zm_dropDown").remove()}},i={accId:zmail.accId,mode:"lstEntity",thb:!0};"t"===d?i.tId=b:i.mId=a,m++,ga("/attach.do","POST",g,h,i,{loadingBand:e,reqId:m})},ka=function(a){var b=zmList.getMailObj(a)||{},c=function(){return b.AT};if(c(a)&&b.TH){var d=b.T;G(a,d,"t")&&(zmail.mailAttachments[d].data.addInfo.isFull=!1)}};$.subscribe("mail/spam",function(a,b){ka(b)}),$.subscribe("mail/notspam",function(a,b){ka(b)}),$.subscribe("mail/delete",function(a,b,c,d){5===d&&ka(b)}),$.subscribe("compose/newTemplate",function(){zmail.showFeature&&zmail.MailPreUtils.updateCount({fId:zmail.folId.teId,mode:"inc"})}),$.subscribe("compose/newDraft",function(){zmail.showFeature&&zmail.MailPreUtils.updateCount({fId:zmail.folId.dId,mode:"inc"})}),$.subscribe("mail/updateRead",function(a,b){if(b.hasOwnProperty("oldMId"))return zmail.mailObj[b.msgId].TUC=zmail.mailObj[b.oldMId].TUC,!1;var c=ZMail.lView,e=b.msgId,f=zmsuite.getCurrentAppObjId(),g=zmsuite.getWorkSpace(f).listElem,h=zmList.getViewBasedMsgList(zmList.getMailObj(b.msgId).T,""),i=$(g).find("#t"+e),j=i.find("[data-action='unReadCount']");if(b.hasOwnProperty("newMailWS")){j[0]||(i=$(g).find("#"+b.row_Id),j=i.find("[data-action='unReadCount']"));var k=0;if(k="undefined"!=typeof zmail.mailObj[b.msgId].TUC?zmail.mailObj[b.msgId].TUC+1:1,zmail.mailObj[b.msgId].TUC=k,1===k||!j[0]){var l=c.constTemplate("unReadCount",{unReadCountCls:"zmLThreadUC zmThmClr",unReadCount:k}),m=i.find("[data-action='from']");return $(m).prepend(l),!1}return j.text("("+k+")"),j[0].title=k+" "+d.listing.common.unreadTooltip,!1}if(0===h.length&&j[0])zmail.mailObj[b.msgId].TUC=0,j.remove();else if(h.length>0||b.hasOwnProperty("resp")||b.hasOwnProperty("newMailWS")){var n,o=0;if(h.forEach(function(a){n=zmList.getMailObj(a),0===n.S&&n.FD!==zmail.folId.sId&&o++}),zmail.mailObj[b.msgId].TUC=o,j[0])return 0===o?(j.remove(),!1):(j.text("("+o+")"),j[0].title=o+" "+d.listing.common.unreadTooltip,!1);if(b.hasOwnProperty("resp")){o=0;var p=zmail.folId.sId,q=zmail.folId.tId,r=zmail.folId.spId,s=zmail.folId.dId,t=zmail.folId.oId;b.resp.count.forEach(function(a){a.hasOwnProperty(p)||a.hasOwnProperty(q)||a.hasOwnProperty(r)||a.hasOwnProperty(s)||a.hasOwnProperty(t)||(o+=parseInt(a[Object.keys(a)[0]]))})}else b.hasOwnProperty("newMailWS")&&(o=0,o="undefined"!=typeof zmail.mailObj[b.msgId].TUC?zmail.mailObj[b.msgId].TUC+1:1);if(zmail.mailObj[b.msgId].TUC=o,0===o)return!1;var u=c.constTemplate("unReadCount",{unReadCountCls:"zmLThreadUC zmThmClr",unReadCount:o}),v=i.find("[data-action='from']");$(v).prepend(u)}}),$.subscribe("mail/archive",function(a,b){ka(b)});var la=function(a,b){var c,d,e,f=a.msgId,g=a.type,h="zm_Container"===zmTab.currentTab&&zmUtil.getFolId();if(!h||!zmUtil.isSharedFolder(h)){if("t"===f.charAt(0)){if("zm_Container"===zmTab.currentTab&&(h===zmail.folId.spId||"archive"===zmInit.getListingDetObj().view))return;f=f.substring(1),c="t"}var i={par:b,showArrow:!0,liDom:"",spanClass:"zm_attPop minwid zmAtt_mulMail",liHover:!1,clk:function(a,b){$(b).closest(".puClose",e[0]).length?e[0].remove():zmAttach.util.removeMAct()},onHide:function(){zmUtil.hideMenu()}};e=ia(i);var j=zmList.getMailObj(f);if("t"===c?d=j.T:"lt"!==g||j.TH?(c="tc",d=j.T):(c="sm",d=f),G(f,d,c)){var k=H(f,d,c);ha(b,k,e[0],c,e[1],d),e[1]()}else ja(f,d,b,c,e[1],e[0])}},ma=function(a){try{var b=zmTab.currentTab,c="zm_srch1"!==b?$(zmail.mailCenter.listElem):zmailSearch.Model.getSearchData().elemObj.listingContentElem,d=a.offset().top-c.offset().top,e=c.height();if(e-=Number(zmAdHocSettings.getMailPreviewSize())/100*e,d>=e){var f=c.scrollTop()+(d-a.height());c.scrollTop(f)}}catch(g){return!0}},na={selDetails:{},excludeSent:!1,listingFocused:!0,showNotificationPopup:function(a){var b={},c={};b={msgId:a.pid,opentype:3,type:"lt",tabId:"zmncenter",src:"zmncenter",commentuuid:a.commentuuid},b.eprm={accId:zmUtil.getZohoAccId(),isSh:!0,groupId:a.gid,shareId:a.shId,thId:a.pid},a.gid!==zmail.zuid&&(b.eprm.shId=a.shId),c.prevElem=a.elm,c.viewDetails={view:"notification"},zmList.getMailData(b,c)},getNotifyPopupContainer:function(a,b,c,d,e){var f=a.SUBJECT,g=["DIV",{attrs:{"class":"SC_ptit"},child:[["DIV",{attrs:{"class":"SCmb SC_frt"},child:[["UL",{child:[["LI",{child:[["B",{child:[["SPAN",{attrs:{"class":"SC_ttip ttr"},child:[["I",{attrs:{"class":"msi-more popOut","data-shared":c,"data-reminder":d}}]]}]]}]]}]]}]]}],["DIV",{child:[["DIV",{attrs:{"class":"SC_phd"},child:[["text",f]]}]]}]]}],h=["DIV",{attrs:{"class":"SCS_postMail",type:"fixedComment"}}];b.appendChild(_zm.getDOM(g)),b.appendChild(_zm.getDOM(h)),d&&(b.className+=" zmMailReminder"),e.contElem=$(e.prevElem.childNodes[1])},isMailOpenInTab:function(a){var b,c=zmList.getMailObj(a)||{};return b=c.TH?"zm_tabt"+c.T:"zm_tab"+a,zmsuite.isWorkspaceAvailable(b)},getMailData:function(a,b,c){var d,e,g,h,i,k,l,m="",o={},p={},q=a.type,r=a.opentype,s={},t=a.tabId||zmTab.currentTab,u=!1,v=!1;m=a.msgId,d=a.from;var x=a.invokedFrom||"";if(p.invokedFrom=x,s=b&&b.viewDetails||{},("external"===a.src||"restore"===a.src||"zmncenter"===a.src&&!zmail.mailObj[m])&&("restore"===a.src&&(e=a.fId,s=a.viewDetails||{},l=a.toOpen),w(m,a.tId,e),zmail.mailObj[m]=$.extend(zmail.mailObj[m],a.eprm)),Object.keys(s).length||("zm_Container"===t?s=zmInit.getListingDetObj():t.indexOf("zm_tab")!==-1?s=zmsuite.getCenterOuter(t).$el.data("data-detail"):t.indexOf("zm_srch")!==-1?s=zmSearchUtil.getSearchViewDetails():t.indexOf("zmncenter")!==-1&&(s=b?b.viewDetails:{view:"zmncenter"})),s=s||{},"search"===s.view&&zmSearchUtil.isWorkspaceAvailable()&&(a.tabId="zm_srch1"),b=b||E(a),"restore"===a.src&&(b.viewDetails=s),m&&!m.indexOf("t")&&(m=m.substring(1,m.length)),"search"===s.view&&"th"===q&&(b.listArr=zmList.getViewBasedMsgList(zmail.mailObj[m].T,b.viewDetails,!1)),h=m,m&&zmail.mailObj[m]&&(a.vfc||!V(a.opentype,a,b)||("lt"!==q||zmail.mailObj[m].TH)&&"th"!==q)){if(1===zmail.mailObj[m].TH&&"external"===a.src&&(a.msgId="t"+a.msgId),e||(e=zmail.mailObj[m].FD),zmUtil.isInlineCompose()||e!==zmail.folId.dId||"lt"!==q||b.viewDetails.fId===zmail.folId.dId||"search"===b.viewDetails.view||(m=zmail.mailObj[m].T,e="",zmail.mailObj[m]||(zmail.mailObj[m]={M:m,FD:"",S:1,TH:1,T:m,SB:zmail.mailObj[h].SB})),0!==r&&4!==r||zmUtil.isMailOpenInPreview(m,t)&&("zm_Container"!==t||!zmList.isListingChecked(b.listElem))||$(b.prevElem).attr({"data-mid":"","data-ty":""}),e!==zmail.folId.dId||s.fId!==zmail.folId.dId&&zmUtil.isInlineCompose()&&"search"!==s.view)if(e===zmail.folId.teId)zmUtil.invokeComposer({msgId:m,mode:"template"});else{if(b.rowElem&&b.rowElem.length&&b.rowElem.is(":visible")&&(0===a.opentype||4===a.opentype)&&($(b.listElem).find("div."+j.mRow).removeClass(j.sel),
$(b.listElem).find(b.rowElem).addClass(j.sel)),o={accId:zmail.accId,split:!0,summary:!0},"external"!==a.src&&"zmncenter"!==a.src||(a.eprm?o=$.extend(o,a.eprm):o.accId=zmUtil.getZohoAccId()),g=zmail.mailObj[m],0!==zmUtil.getMLConversionValue()&&"search"!==s.view&&"archive"!==s.view&&1!==g.TS&&g.TH&&"lt"===q&&("1"===zmAdHocSettings.getMarkConversationRead()?zmail.listObj[g.T]?m=N(m,s):o.getUnread="latest":zmail.listObj[g.T]?m=M(m,s):o.getUnread="oldest"),zmUtil.isInlineCompose()&&("lt"===q?zmail.mailObj[m].DC&&zmail.mailObj[m].DC>0&&(o.hasdraft=!0,zmail.mailObj[m].T&&(o.thId=zmail.mailObj[m].T),zmail.mailObj[m].FD===zmail.folId.dId&&(m=zmail.mailObj[m].PA?zmail.mailObj[m].PA:zmail.mailObj[m].T,zmail.mailObj[m]||w(m),zmail.mailObj[m].TH=1,zmail.mailObj[m].T=o.thId)):"th"===q&&zmail.mailObj[m].DMID&&(o.hasdraft=!0,zmail.mailObj[m].T&&(o.thId=zmail.mailObj[m].T))),g=zmail.mailObj[m],o.msgId=m,"zmncenter"===a.src){var y=o.groupId!==zmail.zuid;e=e||zmUtil.getFolderForShID(o.shId,y)}e&&(g.FD||(g.FD=e),s.fId&&zmUtil.isSharedFolder(s.fId)&&92===zmail.shrTree[0][s.fId].RT?(o.label=s.fId,e=s.fId):o.folId=e),p={msgId:m,att:g.AT,tg:g.TAG,flg:g.NFG,type:q,sm:g.SM,opentype:a.opentype,from:d,noanim:a.noanim,rowId:a.msgId,prevId:h,src:a.src,reqSent:!0,invokedFrom:x,tabId:t,prevDefObj:c,toOpen:l,commentuuid:a.commentuuid,mode:o.mode,getUnread:o.getUnread,isReminder:a.isReminder},(a.tId&&a.isReminder||g.TH&&"content"!==q&&s.fId!==zmail.folId.tId&&("conversation"===a.src||"restore"===a.src&&"conversation"===l||0!==zmUtil.getMLConversionValue()&&"search"!==s.view&&s.fId!==zmail.folId.sId))&&(!zmail.listObj[g.T]||zmail.mailObj[g.T]&&zmail.mailObj[g.T].streams)&&(o.thId=g.T),"zmncenter"!==a.src&&(zmContentCache.isCached(m)&&zmContentCache.get(m).shareId&&(o.isSh=!0,o.shareId=k,o.groupId=zmail.mailObj[m].groupId),zmUtil.isSharedFolder(e)?(o.shId=p.shId=zmUtil.getShareId(e),o.isSh=!0,o.shareId=o.shId,o.groupId=zmail.shrTree[0][e].OZUID):s.fId&&zmUtil.isFolderId(s.fId)?(i=zmList.getRowInfo(s.fId,"zmlTreeH","info"),k=i?i.SH:"",k&&"-1"!==k&&(o.isSh=!0,o.shareId=k,o.groupId=zmail.zuid)):s.label&&zmUtil.isLabelId(s.label)?(i=zmList.getRowInfo(s.label,"zmllabelH","info"),k=i?i.shId:"",k&&"-1"!==k&&(o.isSh=!0,o.shareId=k,o.groupId=zmail.zuid)):"search"===s.view&&zmUtil.isFolderId(zmail.mailObj[m].FD)&&(i=zmList.getRowInfo(zmail.mailObj[m].FD,"zmlTreeH","info"),k=i?i.SH:"",k&&"-1"!==k&&(o.isSh=!0,o.shareId=k,o.groupId=zmail.zuid))),o.isSh&&(o.entityId=g.T?g.T:m,o.entityType=1,p.shOwner=o.groupId,p.shId=o.shId||k||"",p.shareId=o.shareId||"",zmContentCache.isCached(m)&&"notification-popout"!==x&&zmContentCache.remove(m),o.isSh="content"!==q&&o.isSh),p.isSh=o.isSh||!1,zmail.mailObj[m].FD===zmail.folId.oId?p.opentype=4===zmail.mailOpt.isPopup?4:0:0===zmail.mailObj[m].S&&(o.markread=!0,zmail.mailObj[m].AR&&(o.archiveStatus=!0)),a.vfc&&(o.vfc=p.vfc=a.vfc,p.forceFetch=!0),p.elemObj=b;var z=b.viewDetails.view;if("stream"!==z&&3!==r&&"zmStreamsApp"!==t&&!g.streams||!zmail.mailObj[m].actionType||a.src||(o.accId=zmail.mailObj[m].accId,delete o.folId,o.actionType=zmail.mailObj[m].actionType,o.streamsView="true",o.groupId=zmail.mailObj[m].groupId,o.entityId=m,o.entityType=zmail.mailObj[m].entityType),zmail.mailObj[m].TH||0!==zmail.mailObj[m].S||zmail.mailObj[m].FD===zmail.folId.oId||0!==a.opentype&&4!==a.opentype||(zmail.MailAction.Initializer.rapplyActions({result:"success"},{mailId:[m],thd:[],action:"read",from:"mail_preview"}),p.markread=!0),0!==a.opentype&&4!==a.opentype||n(p),"zmncenter"===a.src||!zmContentCache.isCached(m)||o.hasdraft||o.vfc||(o.thId?zmUtil.getListMap(o.thId)?u=!0:p.forceFetch=!0:u=!0),a.actionSrc&&(o.actionSrc=a.actionSrc),1===a.opentype)P({from:"list"},$("#"+a.msgId));else if(2!==a.opentype&&0!==a.opentype&&4!==a.opentype||a.vfc||"content"===q||!zmail.mailObj[m].TH||0===zmUtil.getMLConversionValue()||"search"===b.viewDetails.view||b.viewDetails.fId===zmail.folId.sId||b.viewDetails.fId===zmail.folId.tId||!(2===a.opentype&&"restore"!==a.src&&zmList.isMailOpenInTab(m)||(0===a.opentype||4===a.opentype)&&zmUtil.isMailOpenInPreview(m,t)))if(!u||a.vfc||o.thId){if((0===a.opentype||4===a.opentype)&&"content"!==q){var A=zmsuite.getCenter(t)[1].getNodes(),B=zmail.mailObj[m].SB||f.common.noSubject,D=["DIV",{attrs:{"class":"SC_phd"},child:[["text",B]]}];if(zmInit.prevHeader.text=D,A[0].push(zmInit.prevHeader),!o.vfc){A[1].getDOMNode().html(""),zmComponent.loadingBand({container:A[1].getDOMNode()[0],type:"pagination"});var F={fromMail:!1,previewType:""};"zm_Container"!==t&&t.indexOf("zm_srch")||(F.fromMail=!0),0!==a.opentype&&4!==a.opentype||(F.previewType=0===a.opentype?"vertical":"horizontal"),zmsuite.getCenter(t)[1].show(F)}"content"===q||o.vfc||o.isSh||I({state:"opening",mId:m,openedBy:x})}if("lt"===a.type&&"zm_Container"===t&&!o.isSh)try{v=!0;var G;G=O(h||m,"mailIds")||[],G.length&&(o.mailId=G.join(),p.setSessionId=!0)}catch(H){zmUtil.debugLog("Error while prefetch content for "+h||m,H)}C(o,p,J)}else p.reqSent=!1,"content"!==q&&I({state:"opening",mId:m,openedBy:x}),J({},p);else{var K,L,Q,R=a.type;0===a.opentype||4===a.opentype?(K="#zmHdr"+("search"===b.viewDetails.view?"S":"P")+m,L=$(K),zmPrev.removeCountinPreview(b,a.opentype),"lt"!==R&&(L.length||(Q=zmPreviewTemplate.getMissingMailList(zmail.mailObj[m].T,"P"),zmPreviewTemplate.removeNotifBand(b.prevElem),zmPreviewTemplate.addMailsInView({list:Q,opentype:a.opentype}),L=$(K)),L.length&&(L.find(".zmpr:first").trigger("click"),L.removeClass("zm_tm"),zmPreviewTemplate.alignMailTopToPreview(String(m))),zmRestore.saveState("preview",{p:m},{})),L.parent().addClass("js-scrolltop"),zmList.setMailSelection(m,R,$(b.listElem)),zmPreviewTemplate.setPreviewHeaderHeight(b,t,a.opentype),zmList.listingFocused=!0):(K="#zmHdr"+("search"===b.viewDetails.view?"S":"T")+m,L=$(K),"lt"!==R&&(L.length||(Q=zmPreviewTemplate.getMissingMailList(zmail.mailObj[m].T,"T"),zmPreviewTemplate.removeNotifBand(b.prevElem),zmPreviewTemplate.addMailsInView({list:Q,opentype:a.opentype}),L=$(K)),L.length&&(L.find(".zmpr:first").trigger("click"),L.removeClass("zm_tm"))),L.parent().addClass("js-scrolltop"),zmList.listingFocused=!0)}}else zmUtil.invokeComposer({msgId:m,mode:"draft"});if(!v&&"lt"===a.type&&"zm_Container"===t&&!o.isSh){var S=h||m;try{O(S,"sendReq")}catch(H){zmUtil.debugLog("Error while prefetch content for "+S,H)}}}},constructThreadChildRow:function(a,b){var d,e={},g={},h=[],i=zmInit.getListingDetObj(),k="";e=zmCenterListing.create({type:"subMail",mapObj:zmInit.mapObj,classObj:zmInit.classObj});var l=zmList.getMailObj(a);g=$.extend({},l),g.data="th",k=g.FD;var m=zmUtil.isSharedFolder(k);(""===i.fId||!m&&2===zmUtil.getMLConversionValue())&&(g.FN=zmInit.findFolName(l.FD)),h=zmInit.getMailRowIcons(i.fId),l.SZ&&(g.SZ=zmInit.cSize(l.SZ)),g.DC=0,1===g.NS2?g.S=0===g.S?2:4:2===g.NS2?g.S=0===g.S?3:5:3===g.NS2&&(g.S=0===g.S?7:8),zmail.mailOpt.isshowSummary||(g.SM=""),k===zmail.folId.oId||k===zmail.folId.dId||k===zmail.folId.teId?g.fromaddr=g.TO||g.TOADDR||"":g.fromaddr=g.F||g.SN||"",k===zmail.folId.oId?g.F=l.TOADDR||l.TO||f.common.undisclosed:(i.fId===zmail.folId.spId?(g.NFG="-1",g.TAG=[]):i.fId===zmail.folId.teId||i.fId===zmail.folId.dId?(g.NFG="-1",g.S=""):k===zmail.folId.sId&&(g.S=9),g.F=l.SN||l.F),g.UW=zmList.isRMOBJ(a),(l.MA||g.UW)&&(g.HT="1");try{g.F===zmail.aInfo[zmail.accId].mailId&&(g.F="Me")}catch(n){}if(l.SCOBJ&&l.FD!==zmail.folId.spId&&k!==zmail.folId.sId){var o=l.SCOBJ[0]||{};if("REVIEWACTION"===o.SCATYPE)g.schemaTip=_zm.escapeTags(o.DESC||""),g.schemaText=f.quickactions.review,o.SHOWRB?g.actionIcon=g.actionIconColor="review_comment":g.actionIcon=g.actionIconColor="review";else if("RSVPACTION"===o.SCATYPE){if(o.EXPIRED)g.schemaTip=f.quickactions.eventexpired,g.schemaText=f.quickactions.rsvp,g.expired=1;else{g.schemaTip=_zm.escapeTags(o.DESC||"");var p={yes:f.quickactions.yes,no:f.quickactions.no,maybe:f.quickactions.maybe};o.RSVPSTUS?g.schemaText=p[o.RSVPSTUS]:g.schemaText=f.quickactions.rsvp}g.actionIcon=g.actionIconColor="rsvp"}else"CONFIRMACTION"===o.SCATYPE||"SAVEACTION"===o.SCATYPE?(g.schemaText=_zm.escapeTags(o.DN||""),g.schemaTip=_zm.escapeTags(o.DESC||""),g.actionIcon=g.actionIconColor="one_click"):"VIEWACTION"===o.SCATYPE||"TRACKACTION"===o.SCATYPE?(g.schemaText=_zm.escapeTags(o.DN||""),g.schemaTip=_zm.escapeTags(o.DESC||""),g.actionIcon=g.actionIconColor="goto"):"ORDER"===o.SCATYPE?(o.ORDEROBJ&&o.ORDEROBJ.VIEWORDERURL&&(g.schemaText=f.quickactions.orderV,g.actionIcon=g.actionIconColor="goto"),g.F=g.SB,g.MUI=0,g.fromaddr="",g.sumTxt=zmList.markupSummary({schemaObj:o})):"PARCELDELIVERY"===o.SCATYPE?(o.PARCLDLVRYOBJ&&o.PARCLDLVRYOBJ.TRACKINGURL&&(g.schemaText=f.quickactions.orderT,g.actionIcon=g.actionIconColor="goto"),g.F=g.SB,g.MUI=0,g.fromaddr="",g.sumTxt=zmList.markupSummary({schemaObj:o})):"FLIGHTRESERVATION"===o.SCATYPE&&(o.FLYTTKTOBJ&&o.FLYTTKTOBJ[0].url&&(g.schemaText=zmList.flightQAType(o.FLYTTKTOBJ[0]),g.schemaTip=_zm.escapeTags(o.DESC||""),g.actionIcon=g.actionIconColor="goto"),g.F=g.SB,g.MUI=1,g.fromaddr="",g.sumTxt=zmList.markupSummary({schemaObj:o}))}if(g.selBoxVisibility=!0,zmUtil.isSharedFolder(k,"R")&&(g.selBoxVisibility=!1),g.iconArr=h,e.setDataObj(g),d=$(e.getHTML()),"h"===zmail.viewInfo[0].DT&&d.find("."+j.date).hide(),"h"===zmail.viewInfo[0].SZ&&d.find("."+j.size).hide(),l&&k===zmail.folId.sId&&d.addClass("zmsnt"),void 0===b){var q=c.getViewParentOf(a);b=q&&q.isSelected||!1}return zmCenterListing.mailObjectAPI.setViewObject("c"+a,{id:"c"+a,$element:d,isSelected:b,isExpanded:!0}),d},bindEventsMailRow:function(a,b){zmAppLoader.load("listingEventHandlers").then(function(){var c,d,e,f,g,h,l,m=a.target||a.srcElement;if(c=$(m),d=c.attr("class")||"",e=W(m),zmList.listingFocused=!0,!e.msgId){if("SC_nmsg"!==c.parent().attr("class"))return;d="SC_nmsg"}if(h=e.msgId,e.msgId.indexOf("t")||(h=e.msgId.substring(1)),l=h&&zmUtil.getMailObj(h,"FD"),(e.msgId||b)&&(b=b||zmList.getListingElemObj(e),b.rowElem=c.closest("."+j.mRow)),c.closest(".zmLbl").length&&(d="zm_lbl"),d.indexOf("msi-rpd")===-1&&d.indexOf("msi-fwd")===-1&&d.indexOf("msi-fwdRpd")===-1&&d.indexOf("path")===-1||(d="msi-mail"),d.indexOf(k.thdCount)!==-1)"1"===c.text()?(f=zmPrev.prevDetails().msgId,f&&f!==h?$.when(zmPrev.cmpClose()).then(function(a){a&&(zmContentCache.remove(f),zmList.getMailData(e,b))}):zmList.getMailData(e,b)):zmList.showHideThread(c,b);else if(d.indexOf("msi-uncheck")!==-1||d.indexOf("zmLChk")!==-1||d.indexOf("zmFlt")!==-1){if(zmUtil.isReadOnlyMail(h))return;e=W(c),b=zmList.getListingElemObj(e),zmList.chkBox(c,b,a)}else if(d.indexOf(j.flag)!==-1){if(zmUtil.isReadOnlyMail(h))return;c.hasClass(j.blueflag)||c.hasClass(j.greenflag)||c.hasClass(j.redflag)||c.hasClass(j.mulflag)?zmail.MailAction.Initializer.flagMail(c,"0"):zmail.MailAction.Initializer.flagMail(c,"2")}else if(d.indexOf("msi-trash")!==-1)zmUtil.isSharedFolder(l)||zmail.MailAction.Initializer.delMail(c);else if(d.indexOf("msi-edit")!==-1)zmUtil.invokeComposer({msgId:e.msgId,mode:"outbox"});else if(c.parent().attr("class")&&c.parent().attr("class").indexOf("zmSndSts")===-1&&d.indexOf("msi-mail")!==-1||d.indexOf("msi-calendar")!==-1||d.indexOf("msi-cart")!==-1||d.indexOf("msi-flight")!==-1)zmUtil.isReadOnlyMail(h)||zmail.MailAction.Initializer.markAsReadUnread(c);else if(d.indexOf("zm_lbl")!==-1){if(!zmUtil.isSharedFolder(l)){var n=String(e.msgId);da(n,c.closest(".zmLbl")[0])}}else d.indexOf(j.associate)!==-1?zmail.Listing.Handlers.Integrations.associateDialog({msgId:h,elemObj:b,rowDet:e,elem:c,loadType:"list",openWatch:"header_all"}):d.indexOf("msi-thread")!==-1?(f=zmPrev.prevDetails().msgId,f?$.when(zmPrev.cmpClose()).then(function(a){a&&ea(e,b)}):ea(e,b)):d.indexOf("msi-mailReminder")!==-1?zmWatch.showWatch({msgId:h,elemObj:b,rowDet:e,elem:c,loadType:"popup",openWatch:"header_list"}):d.indexOf(j.qckAct)!==-1?zmail.Listing.Handlers.SchemaActions.processSchemaAction(e,c):d.indexOf(i.jsCls.mds)!==-1?zmail.Listing.Handlers.DeliveryStatus.getMailDeliveryStatus(e.msgId):"msi-attachicon"===d?la(e,c):"SC_nmsg"===d?zmList.showMailListing():(f=zmPrev.prevDetails().msgId,g=zmUtil.getMLConversionValue(),!f||0!==e.opentype&&4!==e.opentype||(0!==zmUtil.getMailObj(f,"TH")&&0!==g||f===h)&&(0===g||zmUtil.getMailObj(f,"T")===zmUtil.getMailObj(h,"T"))?(fa(e,b),4!==e.opentype||f||ma(b.rowElem)):$.when(zmPrev.cmpClose()).then(function(a){a&&(zmContentCache.remove(f),fa(e,b,f))}));zmInit.isLeftFocused=!1})},isRMOBJ:function(a){var b=!1,c=zmList.getMailObj(a);if(c&&c.RMOBJ&&!$.isEmptyObject(c.RMOBJ)){var d=c.RMOBJ.WT;1!==d&&2!==d&&3!==d||(b=!0)}return zmail.folId.oId!==c.FD&&zmail.folId.dId!==c.FD&&zmail.folId.spId!==c.FD&&zmail.folId.tId!==c.FD&&zmail.folId.teId!==c.FD||(b=!1),b},unchkAll:function(){var a=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");a.length&&(a.hasClass("msi-check")||a.hasClass("msi-partcheck"))&&(c.selectMails(c.getAllViewObjectIds(!0),!1),zmList.resetThreadPath(),zmInit.listingBand.removeBulkActionBand())},chkAll:function(){c.selectMails(c.getAllViewObjectIds(!0),!0),zmList.showBulkActionBand()},chkBox:function(a,b,d){d=d||{};var e,f,g,h=b.isParent,i=b.msgId,j=i,k=c.getPerviouslySelected(),l=b.type;j="th"===l?"c"+i:i,e=c.getViewObject(j),f=!(e&&e.isSelected),c.selectMail(j,f),d.shiftKey&&k&&k!==j&&c.hasElement(k)&&(g=zmUtil.arrayExtractor(c.getAllViewObjectIds(),k,j),c.selectMails(g,f),c.handleForChildSelection(k,f)),h?c.selectMails(c.getChildrenIdsOf(i),f):c.handleForChildSelection(j,f),c.setPerviouslySelected(j),f||zmList.resetThreadPath(),zmList.showBulkActionBand()},chkSingleMsg:function(){var a={},b=zmPrev.prevDetails(),d=b.msgId,e="";d||(d=c.getMailOrders()[0]);var f=c.getViewObject(d);e=f&&f.$element.data("ty"),a.isParent=zmUtil.getMailObj(d,"TH")&&"lt"===e&&0!==zmUtil.getMLConversionValue(),a.msgId=d,a.type=e,a.msgId&&zmList.chkBox(null,a)},updateSelectionCount:function(a,b){a=a||"zm_Container";var c,d=zmsuite.getCenter(a)[0].getNodes()[1].$el,g=d.find(".unreadCount"),h=d.find(".zm_refine"),i=d.find(".zm_savesearch");if(d.length)if(c=d.find(".selCount"),void 0===b||b){var j=zmUtil.getCheckedMailCount();0===j?(c.remove(),"zm_Container"===a&&zmInit.updateHeaderBand(),h.show(),i.show()):(c.length||(c=$(_zm.getDOM(["SPAN",{attrs:{"class":"sum selCount"}}])),d.find(".SC_flt .SC_mtb").append(c)),zmInit.listingBand.isBulkActionSet?c.text(f.selmenuopt.all+" "+e.common.emailsel):1===j?c.text(f.common.singlemail):c.text(zmText.applyArgs(f.common.multiplemail,{count:j})),g.hide(),h.hide(),i.hide())}else c.remove(),"zm_Container"===a&&zmInit.updateHeaderBand(),h.show(),i.show()},doThreadPath:function(a,b){var c="";c=a.parents(".SC_mclst"),v(b,a,c)},resetThreadPath:function(){if("zm_Container"===zmTab.currentTab||"zm_srch1"===zmTab.currentTab){var a,b,c=zmPrev.prevDetails(zmTab.currentTab),d=c.msgId,e=c.type;a=zmsuite.getCenter(zmTab.currentTab)[0].getNodes()[2].$el,b="th"===e?a.find("#"+d):a.find("#t"+d),zmList.doThreadPath(b,"add")}},allowFLOperation:function(a){var b=!0;if(!a)return!1;for(var c in zmail.folId)if(zmail.folId[c]===a){b=!1;break}return b},remReadMail:function(){var a,b=zmList.getElemObj().listElem||zmail.mailCenter.listElem,c=$(b);a="zm_Container"===zmTab.currentTab?c.children("."+j.mRow+":not(."+j.unread+")"):c.children("."+j.mRow+":not(."+j.unread+",."+j.sel+")"),a.each(function(){var a,b,c=this.id;a=$(this),b=a.parent(),b.hasClass(j.thdChild)?b.children("."+j.mRow).hasClass(j.unread)||(b.remove(),b.prev().remove()):(a.remove(),c.indexOf("t")||(c=c.substring(1,c.length)),$("#thd"+c).length&&$("#thd"+c).remove()),zmCache.updateCacheForViews(c)})},mailUtility:function(a){var b,c,d,e,h,i,k="contextmenu";if(h=a.target||a.srcElement,b=$(h).closest("."+j.mRow).attr("id")){zmInit.rclkId=b,i="t"===b.charAt(0)?zmUtil.getFolId():zmList.getMailObj(b)&&zmList.getMailObj(b).FD,c=a.target||a.srcElement,d=$(c);var l=d.closest("."+j.mRow);if(l.length&&l.addClass(j.ritClk),d.hasClass(j.flag)){if(zmUtil.isSharedFolder(i,"R"))return;d.css("visibility","visible"),e={clk:function(a,b){zmail.MailAction.Initializer.setFlag(d,b)},removeSelection:!0,conArr:[{htm:"<i class='"+j.blueflag+"'></i>"+f.flagmenu.infoflag,data:{flag:"1"}},{htm:"<i class='"+j.redflag+"'></i>"+f.flagmenu.important,data:{flag:"2"}},{htm:"<i class='"+j.greenflag+"'></i>"+f.flagmenu.followup,data:{flag:"3"}},{sep:!0},{htm:"<i class='"+j.noflag+"'></i>"+f.flagmenu.clearflag,data:{flag:"0"}}]},e.onHide=function(){d.css("visibility","")},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a)}else if(i!==zmail.folId.oId&&i!==zmail.folId.teId&&i!==zmail.folId.dId){var m;m=i===zmail.folId.sId?{htm:f.contextmenu.listrecipient,data:{action:"listrecipient",from:"ctxtMenu"}}:{htm:f.contextmenu.listfromsender,data:{action:"listsender",from:"ctxtMenu"}};var n=[m,{htm:f.contextmenu.listbysubject,data:{action:"listsubject",from:"ctxtMenu"}},{sep:!0},{htm:f.contextmenu.openpreview,data:{action:"openpreview",opentype:4===zmail.mailOpt.isPopup?4:0}},{htm:f.contextmenu.opentab,data:{action:"opentab",opentype:2}},{htm:f.contextmenu.popout,data:{action:"openwindow",from:"ctxtMenu"}},{sep:!0},{htm:f.contextmenu.reply,data:{action:"reply",from:"ctxtMenu"}},{htm:f.contextmenu.replyall,data:{action:"replyall",from:"ctxtMenu"}},{htm:f.contextmenu.forward,data:{action:"forward",from:"ctxtMenu"}},{sep:!0},{htm:f.contextmenu.markspam,data:{action:"spam",from:"ctxtMenu"}},{htm:f.contextmenu.marknotspam,data:{action:"notspam",from:"ctxtMenu"}},{htm:f.contextmenu["delete"],data:{action:"delete",from:"ctxtMenu"}}];0===zmail.mailOpt.isPopup||4===zmail.mailOpt.isPopup?n.splice(3,1):1===zmail.mailOpt.isPopup?n.splice(5,1):n.splice(4,1),zmUtil.isSharedFolder(i)?n.splice(9,4):i===zmail.folId.spId?n.splice(10,1):n.splice(11,1),zmUtil.isSharedFolder(i,"R")&&n.splice(5,9);var o=[];zmUtil.isSharedFolder(i)||(o.push({htm:f.contextmenu.addfilter,data:{action:"addFilter"}}),zmUtil.isZohoAccount(zmail.accId)&&(o.push({htm:f.contextmenu.addtask,data:{action:"addTask"}}),zmUtil.isNoteReactUser()&&o.push({htm:f.contextmenu.addnote,data:{action:"addNote"}}),o.push({htm:f.contextmenu.addevent,data:{action:"addEvent"}}))),o.length&&(n.push({sep:!0}),1===o.length?n.push({htm:f.contextmenu.addtofilter,data:{action:"addFilter"}}):n.push({htm:g.contextmenu.addto+"<i class='msi-rarrow'></i>",data:{action:"addtomenu"},child:function(){var a={clk:function(a,b){b.actionSrc=k,zmList.bindAction(b,a)},divId:"zm_addtomenu",removeSelection:!0,conArr:o};return a}})),e={clk:function(a,b){b.actionSrc=k,zmList.bindAction(b,a)},conArr:n,removeSelection:!0},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a)}}},leftUtility:function(a,b,c){var d,f=b.id||$(b).parents(".SC_tre").attr("id");if(zmInit.rclkId=f,"zmlTreeH"===c)d={clk:function(a,b){zmAppLoader.load("zmFolder").then(function(){zmList.bindAction(b,a)})},conArr:[{htm:e.foldercontextmenu.createsub,id:"zmLTMenu_Nf",cEdit:!0,data:{action:"zmLTMenu_Nf"}},{sep:!0,id:"zmLTMenu_lne1"},{htm:e.foldercontextmenu.markfolread,id:"zmLTMenu_Fr",cEdit:!1,data:{action:"zmLTMenu_Fr"}},{sep:!0,id:"zmLTMenu_lne2"},{htm:e.foldercontextmenu.sharefol,id:"zmLTMenu_Sf",cEdit:!1,data:{action:"zmLTMenu_Sf"}},{sep:!0,id:"zmLTMenu_lne3"},{htm:e.foldercontextmenu.renamefol,id:"zmLTMenu_Rf",cEdit:!0,data:{action:"zmLTMenu_Rf"}},{htm:e.foldercontextmenu.delfol,id:"zmLTMenu_Df",cEdit:!1,data:{action:"zmLTMenu_Df"}},{sep:!0,id:"zmLTMenu_lne4"},{htm:e.foldercontextmenu.archfol,id:"zmLTMenu_Af",cEdit:!1,data:{action:"zmLTMenu_Af"}},{htm:e.foldercontextmenu.emptyfol,id:"zmLTMenu_Ef",cEdit:!1,data:{action:"zmLTMenu_Ef"}}]},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a);else if("zmllabelH"===c){if(!zmUtil.isSystemLabel(f)){var g=[{htm:e.tagCreateEdit.edittag,id:"zmLTMenu_El",cEdit:!0,data:{action:"zmLTMenu_El"}},{htm:e.tagCreateEdit.deltag,id:"zmLTMenu_Dl",cEdit:!1,data:{action:"zmLTMenu_Dl"}}];if(zmail.showFeature){var h={},i=e.tagCreateEdit.sharetag,j=zmList.getRowInfo(f,"zmllabelH","info");j&&j.shId&&"-1"!==j.shId&&(i=e.foldercontextmenu.shareinfo),h.htm=i,h.id="zmLTMenu_Sl",h.data={action:"zmLTMenu_Sl"},h.cEdit=!0,g.push(h)}d={clk:function(a,b){zmail.showFeature?zmAppLoader.load("sharefolder").then(function(){zmList.bindAction(b,a)}):zmList.bindAction(b,a)},conArr:g},zmsuite.showContextMenu(a,d)}zmUtil.stopEvents(a)}else if("zmlSSrchTreeH"===c)d={clk:function(a,b){zmAppLoader.load("mailSearch").then(function(){zmList.bindAction(b,a)})},conArr:[{htm:e.common.rename,id:"zmLTMenu_Rss",cEdit:!1,data:{action:"zmLTMenu_Rss"}},{htm:e.common["delete"],id:"zmLTMenu_Dss",cEdit:!1,data:{action:"zmLTMenu_Dss"}}]},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a);else if("zmlSTreeH"===c)d={clk:function(a,b){zmAppLoader.load("sharefolder").then(function(){zmList.bindAction(b,a)})},conArr:[{htm:e.foldercontextmenu.unsubscribe,id:"zmLTMenu_Unshare",cEdit:!1,data:{action:"zmLTMenu_Unshare",cur:b,zm_unshareId:f}}]},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a);else if("zmStreamTree"===c){if(d={clk:function(a,b){zmStreamsApp.events.groupAction(b)},conArr:[{htm:e.streams.viewMembers,id:"zmLTMenu_VMem",cEdit:!1,data:{action:"viewMembers",gid:f}}]},f!==zmail.zuid&&$.isNumeric(f)){var k=zmCont.getGroup(f);k.eid&&d.conArr.push({htm:e.streams.emailGroup,id:"zmLTMenu_Email",cEdit:!1,data:{action:"email",gid:f}}),zmail.IntegrationStatus.CHAT&&d.conArr.unshift({htm:e.streams.chatGroup,id:"zmLTMenu_CChat",cEdit:!1,data:{action:"createChat",gid:f}}),k.scount>0&&d.conArr.push({htm:e.streams.markRead,id:"zmLTMenu_Email",cEdit:!1,data:{action:"markRead",gid:f}}),zmUtil.isNewGroupUser()&&(d.conArr.push({htm:e.streams.hideGrp,id:"zmLTMenu_Email",cEdit:!1,data:{action:"hideGroup",gid:f}}),k.isOwner&&d.conArr.push({htm:e.streams.grpEdit,id:"zmLTMenu_Email",cEdit:!1,data:{action:"editGroup",gid:f}})),zmsuite.showContextMenu(a,d)}zmUtil.stopEvents(a)}},getMailSummaryList:function(a,b,c){var d,e=[],f=!1,g="archive"===a.view;if(a.fId!==zmail.folId.sId&&zmList.excludeSent||(f=!0),zmUtil.getListMap(b)){var h=zmList.getListObj(b,"MO"),i=zmail.folId.dId,j=zmail.folId.sId,k={};if(zmail.folCount[a.fId]||$("#"+a.fId).length)if(a.flag)if(parseInt(a.flag)===-1)for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD===a.fId&&0!==parseInt(k.NFG)&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD===a.fId&&parseInt(k.NFG)===parseInt(a.flag)&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.label)if("-1"===a.label)for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD===a.fId&&k.TAG&&k.TAG.length>0&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++){k=zmList.getMailObj(h[d]);var l=$.inArray(a.label,k.TAG);k.FD===a.fId&&l!==-1&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d])}else if("unread"===a.view)for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD===a.fId&&0===k.S&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.attach)for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD===a.fId&&1===k.AT&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(g)for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD===a.fId&&1===k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD===a.fId&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(zmail.labInfo[a.label]){for(d=0;d<h.length;d++)if(k=zmList.getMailObj(h[d]),k.TAG&&k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&k.FD!==i&&(k.FD!==j||k.FD===j&&f))for(var m=k.TAG,n=0;n<m.length;n++)m[n]===a.label&&e.push(h[d])}else if("unread"===a.view)for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&0===k.S&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.flag)if(parseInt(a.flag)===-1)for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&0!==parseInt(k.NFG)&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&parseInt(k.NFG)===parseInt(a.flag)&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if("all"===a.view)for(d=0;d<h.length;d++)k=zmList.getMailObj(h[d]),k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d])}return zmail.convSortOrder&&c?e.reverse():e},getListForAllMailsView:function(a,b,c){a=a||{};var d=[],e=0,f=!1,g="archive"===a.view;a=a||{},a.fId!==zmail.folId.sId&&zmList.excludeSent||(f=!0);var h=zmList.getListObj(b);if(h){var i,j=h.MO,k=zmail.folId.dId;for(e=0;e<j.length;e++)i=zmList.getMailObj(j[e]),i&&i.FD!==zmail.folId.spId&&i.FD!==zmail.folId.tId&&(g&&1===i.AR||!g&&1!==i.AR||c)&&i.FD!==k&&(i.FD!==zmail.folId.sId||i.FD===zmail.folId.sId&&f)&&d.push(j[e])}return d},showHideThread:function(a,b,c,d){var e,f,g,h,i,k={},l={};h=$(a).closest("."+j.mRow),f=e=h[0].id,f.indexOf("t")||(e=f.substring(1)),k={from:"tIcon",mId:e,elemObj:b},d&&(k.eTDefObj=d);var m=zmList.getMailObj(e);"search"!==b.viewDetails.view&&zmList.getListObj(m.T)?u({},{mId:e,from:k.from,elemObj:b,opentype:c}):(g=m.T,i=m.FD,l={accId:zmail.accId,thId:g,summary:!0},b.viewDetails.fId&&zmUtil.isSharedFolder(b.viewDetails.fId)?(i=b.viewDetails.fId,l.shId=zmUtil.getShareId(i),zmail.opType.read_mail?l.opType=zmail.opType.read_mail:l.opType=0):"zm_Container"===zmTab.currentTab&&(l.folId=i),C(l,k,u))},getThreadCount:function(a){var b,c=zmList.getMailObj(a.msgId).T,d={accId:zmail.accId,tId:c};d.folderSpec=2,d.mode="metadata",d.tId=a.msgId,b=zmList.updThdDetails,zmAjq.XHR({u:zmail.conPath+"/getThdCount.do",t:"POST",fn:b,p:d,ep:{msgId:a.msgId,deferredObj:a.deferredObj}})},updThdCount:function(a,b){var c=b.msgId,d=1;a.cntdata[0].count&&(d=parseInt(a.cntdata[0].count)),zmList.updateModel("TC",d,c),b.deferredObj&&b.deferredObj.resolve()},updThdDetails:function(a,b){var c=b.msgId,d=zmUtil.getMailObj(c);a&&(d.TC=a.TC,d.TA=a.TA,d.TS=a.TS,d.TI=a.TI,d.TM=a.TM,d.TF=a.TF,d.TTAGS=a.TTAGS,d.TSN=a.TSN,d.TSB=a.TSB,d.TSM=a.TSM),b.deferredObj&&b.deferredObj.resolve()},setEmptyListing:function(){var a,b;a=$(zmail.mailCenter.listElem),0!==a.find("."+j.mRow).length||a.data("ty")||(b=zmInit.emptyRow(),a.html(b),zmInit.listingBand.SpamTrashBand.setBand())},FLUtility:function(a,b,c,d){var f=b.id||$(b).parents(".SC_tre").attr("id"),g=zmail.folId;if(zmUtil.stopEvents(a),"zm_unread"===f||"zm_all"===f||"zm_flag"===f||f===g.dId)return void zmUtil.hideMenu();if("header"!==d)if(zmList.leftUtility(a,b,c),f&&"zmlTreeH"===c?zmfolAction.rgtFolId=f:"zmllabelH"===c?zmlab.labelId=f:"zmlSSrchTreeH"===c?zmSearch.savedSearchId=f:"zmStreamTree"===c&&zmUtil.requireStreamsApp().then(function(){zmStreamsApp.constants.rightClickId=f}),f===g.iId)zmList.dimUtility(l,[4,6,7]);else if(f===g.tId)zmList.dimUtility(l,[0,4,6,7,9]),zmfolAction.rgtFolId=zmail.folId.tId,$("#zmLTMenu_Ef").html(e.emptyfolder.emptytrash);else if(zmfolAction.isDeletedFolder(f))zmList.dimUtility(l,[0,4,6,9]),$("#zmLTMenu_Ef").html(e.emptyfolder.emptytrash);else if(f===g.sId)$("#zmLTMenu_Ef").html(e.emptyfolder.emptysent),zmList.dimUtility(l,[0,2,4,6,7]);else if(f===g.spId)$("#zmLTMenu_Ef").html(e.emptyfolder.emptyspam),zmList.dimUtility(l,[0,4,6,7,9]);else if(f===g.oId){$("#zmLTMenu_Ef").html(e.foldercontextmenu.sendnow);var h=[0,2,4,6,7,9];0===Number(zmail.folCount[zmail.folId.oId].c)&&h.push(10),zmList.dimUtility(l,h)}else f===g.teId?($("#zmLTMenu_Ef").text("Create Template"),zmList.dimUtility(l,[0,2,4,6,7,9])):$("#zmLTMenu_Ef").html(e.foldercontextmenu.emptyfol);zmail.isOrg||"1"!==zmail.aInfo[zmail.accId].accountType?"0"===zmail.aInfo[zmail.accId].accountType?($("#zmLTMenu_lne2").remove(),$("#zmLTMenu_Sf").remove()):zmUtil.isFolderId(f)&&"-1"!==zmList.getRowInfo(f,"zmlTreeH","info").SH&&$("#zmLTMenu_Sf").html(e.foldercontextmenu.shareinfo):$("#zmLTMenu_Sf").addClass("SC_op3")},getParent:function(a,b){for(;$(a).attr("tagName")!==zmInit.topelement&&!$(a).hasClass(b);)if(a=zmInit.nn6?a.parentNode:a.parentElement,$(a).hasClass(b)&&"DIV"===a.tagName)return a;return a},dimUtility:function(a,b){b=b.sort(function(a,b){return a===b?0:a>b?1:-1});for(var c=0,d=0;d<a.length;d++)d===b[c]?("zmLTMenu_Rf"===a[d]||"zmLTMenu_Nf"===a[d]?$("#"+a[d]).parent().addClass("SC_op3"):$("#"+a[d]).addClass("SC_op3"),c++):$("#"+a[d]).removeClass("SC_op3")},changeViewColumns:function(a){var b,c={},d={};b="s"===zmail.viewInfo[0][a]?"hide":"show",d={opt:b,accId:zmail.accId,cName:a},c.opt=b,c.cName=a,zmAjq.XHR({u:zmail.conPath+"/editHeader.do",t:"POST",fn:S,p:d,csr:"s",ep:c})},getRowInfo:function(a,b,c){var d,e,f={};return a&&(d=zmail.mailLeft.getNodes()[0].getLayer(b),f=d.getRowObj(a),c)?e=f[a]:f},editLeftRow:function(a,b){var c;c=zmail.mailLeft.getNodes()[0].getLayer(b),c.editNode(a,c.mapObject)},rnLabContextMenu:function(){var a="zmllabelH"!==zmlab.labelId,b=a?"e":"a",c=$("#zmLTMenu_El");zmUtil.setEditable({ele:$("#zmLTMenu_El"),target:$("#"+zmlab.labelId),callback:zmUtil.hideMenu,initialize:a,parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:c,activeMenuHandler:zmlab.labelMenuHadler,activeMenuArgsArray:[b]}])},delLabContextMenu:function(){var a=zmlab.labelId;return a?(zmsDialog.confirm(e.tagCreateEdit.deltagdialogmsg,{onOk:function(){zmlab.labelreq("d")}}),void zmUtil.hideMenu(!0)):void zmUtil.hideMenu(!0)},frmListObj:function(a){var b={};for(var c in a)a[c]&&"undefined"!=typeof a[c].FRM_SIGMODE&&6!==a[c].FRM_SIGMODE&&(b[c]=a[c]);return b},getFrmLst:function(a){var b,c=zmList.frmListObj(zmail.cmpdata.FROM_LIST),d={},e=[];for(var f in c)b={htm:f,data:{frm:f}},a.find("span").eq(0).text()!==f&&e.push(b);d.list=e,d.par=$("#zmshr_frmlst"),d.align="pleft",d.clk=function(a){$("#zmshr_frmlst").find("span").eq(0).text(a.frm),$("#zm_dropDown").remove()},zmsuite.showMenu(d)},updateThreadList:function(a){var b={},c={thId:a};a&&zmUtil.getListMap(a)&&(b={accId:zmail.accId,thId:a,summary:!0},c={thId:a,from:"tIcon"},C(b,c,zmUtil.cacheThreadList))},updateFolderName:function(){var a,b=zmList.getElemObj();a=b.viewDetails,$(b.listElem).length&&(""!==a.fId||"unread"!==a.view&&"all"!==a.view&&"flag"!==a.view?a.fId&&zmInit.updateHeaderBand():$(b.listElem).find("div."+j.mRow).each(function(){var a;a=this.id,a.indexOf("t")!==-1&&(a=a.substring(1,a.length)),a&&$(this).find("."+j.folName).text(zmInit.findFolName(zmList.getMailObj(a).FD))}))},bindAction:function(a,b,c,d){if(a){var e,f,g,h,i,j,k,l,m,n=a.action||a,o=a.actionSrc;switch(n){case"actionmenu":break;case"folread":zmfolAction.markAsReadFolder(),zmUtil.hideMenu(!0);break;case"recall":ZMail.recall.init({mId:a.mId}),d&&d.remove();break;case"upgrade":window.open("//www.zoho.com/workplace/pricing.html","_blank").focus();break;case"unread":zmail.MailAction.Initializer.applyActions(n,"dropdown"),zmUtil.hideMenu(!0);break;case"read":zmail.MailAction.Initializer.applyActions(n,"dropdown"),zmUtil.hideMenu(!0);break;case"flag":case"label":zmail.MailAction.Initializer.applyActions(n,"click",a),zmUtil.hideMenu(!0);break;case"move":zmail.MailAction.Initializer.doActions(n,"drop",a);break;case"spam":a.from&&"ctxtMenu"===a.from?(j=zmInit.rclkId,k=zmail.MailAction.Initializer.markSpamFromContextMenu):(j="spam",k=zmail.MailAction.Initializer.doActions),k(j,o);break;case"delete":a.from&&"ctxtMenu"===a.from?(j=zmInit.rclkId,k=zmail.MailAction.Initializer.delMailFromContextMenu):(j="delete",k=zmail.MailAction.Initializer.doActions),k(j,o);break;case"notspam":a.from&&"ctxtMenu"===a.from?(j=zmInit.rclkId,k=zmail.MailAction.Initializer.markNotSpamFromContextMenu):(j="notspam",k=zmail.MailAction.Initializer.doActions),k(j,o);break;case"archive":zmail.MailAction.Initializer.doActions("archive"),zmUtil.hideMenu();break;case"unarchive":zmail.MailAction.Initializer.doActions("unarchive"),zmUtil.hideMenu();break;case"sortdateup":zmList.changeListingSortOrder(1);break;case"sortdatedn":zmList.changeListingSortOrder(0);break;case"views":zmList.show("zm_viewLst",b);break;case"editrow":zmList.show("zm_shdLst",b);break;case"listview":zmUtil.hideMenu(),ca(a);break;case"clsPrev":if("zm_Container"!==zmTab.currentTab&&zmTab.currentTab.indexOf("zm_srch")){var p=zmsuite.getCenterOuter().$el.data("data-detail");
"unread"===p.view&&zmList.remReadMail(),$.when(zmPrev.cmpClose()).then(function(a){if(a){var b=zmPrev.prevDetails(zmTab.currentTab).msgId;zmContentCache.remove(b),zmsuite.closeWorkspace(zmTab.currentTab)}})}else zmPrev.clsPreview();break;case"editHeader":zmList.changeViewColumns(a.column),zmUtil.hideMenu();break;case"zmLTMenu_Nf":zmUtil.hideMenu(),zmfolAction.showCreateFolderPopUp({mode:"new",type:"subfolder"});break;case"zmLTMenu_Rf":zmUtil.hideMenu(),zmfolAction.showCreateFolderPopUp({mode:"rename"});break;case"zmLTMenu_Fr":zmail.Folder.EventHandlers.mrkReadContextMenu(),zmUtil.hideMenu(!0);break;case"zmLTMenu_Unshare":zmAppLoader.load("sharefolder").then(function(){zmshare.unshareContextMenu(a),zmUtil.hideMenu(!0)});break;case"zmLTMenu_Ef":zmfolAction.rgtFolId===zmail.folId.oId?zmList.sendOutbox("sendI"):zmfolAction.rgtFolId===zmail.folId.teId?zmAppLoader.load("Template").then(function(){zmComponent.createTemplate(),zmUtil.hideMenu()}):zmail.Folder.EventHandlers.emptyFolContextMenu();break;case"zmLTMenu_Df":zmail.Folder.EventHandlers.delFolContextMenu();break;case"zmLTMenu_El":zmUtil.hideMenu(),zmlab.showCreateTagPopUp({mode:"rename"});break;case"zmLTMenu_Dl":zmList.delLabContextMenu();break;case"zmLTMenu_Sf":zmAppLoader.load("sharefolder").then(function(){zmshare.shareFolContextMenu("fol"),zmUtil.hideMenu(!0)});break;case"zmLTMenu_Sl":zmAppLoader.load("sharefolder").then(function(){zmshare.shareFolContextMenu("tag"),zmUtil.hideMenu(!0)});break;case"zmLTMenu_Af":zmail.Folder.EventHandlers.archiveFolderContextMenu(),zmUtil.hideMenu(!0);break;case"zmLTMenu_Dss":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.delSavedSrchContextMenu()}),zmUtil.hideMenu();break;case"zmLTMenu_Rss":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.rnSSrchContextMenu()});break;case"listsender":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.listMailsContextMenuAction("sender",o)});break;case"listrecipient":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.listMailsContextMenuAction("recipient",o)});break;case"listsubject":zmAppLoader.load("mailSearch").then(function(){zmailSearch.Actions.listMailsContextMenuAction("subject",o)});break;case"openpreview":e=W(zmInit.rclkId),e.src=o,e.opentype=a.opentype,l=e.msgId,e.msgId.indexOf("t")||(l=e.msgId.substring(1));var q=zmUtil.getMLConversionValue(),r=zmPrev.prevDetails().msgId;r&&((0===zmUtil.getMailObj(r,"TH")||0===q)&&r!==l||0!==q&&zmUtil.getMailObj(r,"T")!==zmUtil.getMailObj(l,"T"))?$.when(zmPrev.cmpClose()).then(function(a){a&&(zmContentCache.remove(r),zmList.getMailData(e))}):zmList.getMailData(e),zmUtil.hideMenu();break;case"opentab":e=W(zmInit.rclkId),e.actionSrc=o,e.opentype=a.opentype,zmsuite.isMaxLimitReached()||zmList.getMailData(e),zmUtil.hideMenu();break;case"openwindow":P(a,b),zmUtil.hideMenu();break;case"viewfullthd":var s=a.from||$(b).attr("data-from");"header"===s&&(f=$(b).closest(".SC_pv"),l=f.attr("data-mid"),l&&zmList.getMailData({msgId:l,type:"lt",opentype:2,src:"conversation"}));break;case"reply":a.from&&"ctxtMenu"===a.from&&(f=zmsuite.getCenter()[1].$el,l=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),m={mode:"reply",msgId:l,prevElem:f},m.actionSrc=o,zmUtil.invokeComposer(m)),zmUtil.hideMenu();break;case"replyall":a.from&&"ctxtMenu"===a.from&&(f=zmsuite.getCenter()[1].$el,l=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),m={mode:"replyall",msgId:l,prevElem:f},zmUtil.invokeComposer(m)),zmUtil.hideMenu();break;case"forward":a.from&&"ctxtMenu"===a.from?(f=zmsuite.getCenter()[1].$el,l=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),m={mode:"fwdi",msgId:l,prevElem:f}):m={mode:"fwdi"},$.publish("/mail/forwardmail",{mailID:l,mode:"forward"}),zmUtil.invokeComposer(m),zmUtil.hideMenu();break;case"FwdAttach":zmUtil.hideMenu(),zmUtil.invokeComposer({mode:"fwdme"});break;case"select_all":case"select_none":case"select_unread":case"select_read":case"select_flag":case"select_label":case"select_attach":zmList.unchkAll(),aa(a);break;case"view_all":case"view_unread":case"view_flag":case"view_label":case"view_attach":case"view_archive":a&&a.isAttachOnly?(zmsuite.isMaxLimitReached()||ba(),zmUtil.hideMenu()):ca(a);break;case"customize":var t,u=a.value;"date"===u?t="DT":"size"===u&&(t="SZ"),zmList.changeViewColumns(t),zmUtil.hideMenu();break;case"addTask":l=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),g=zmList.getMailObj(l),h=g.SB?_zm.unescapeTags(g.SB):"",i=g.SM?_zm.unescapeTags(g.SM):"",zmUtil.hideMenu(),zmUtil.loadTask({action:"addPopupTask",groupId:zmail.zuid,tasks:{SUMMARY:i,TITLE:h},addparams:{msgid:l,accid:zmail.accId,senderid:g.F},actionSrc:o});break;case"addFilter":l=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),zmUtil.hideMenu(),zmPreviewTemplate.createNewFilter({action:n,msgId:l,actionSrc:o});break;case"addNote":l=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),g=zmList.getMailObj(l),h=g.SB?_zm.unescapeTags(g.SB):"",i=g.SM,zmUtil.hideMenu(),zmUtil.loadNotes("popup",{desc:i,title:h,addparams:{msgid:l,accid:zmail.accId,senderid:g.F,actionSrc:o}});break;case"addEvent":l=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),zmUtil.hideMenu(),zmUtil.loadEvents(function(){zmail.eventInteg.util.addEvent(l)});break;case"msi-prev":zmPreviewTemplate.loadPrevMail();break;case"msi-next":zmPreviewTemplate.loadNextMail();break;case"customize_view":zmInit.customizeDisplayDensity(a.value),zmUtil.hideMenu();break;case"sweep":zmAppLoader.load("listingEventHandlers").then(function(){zmail.Listing.Handlers.SweepAction.performSweepAction()});break;case"chatlet":zmUtil.createContexualChat(b);break;case"customizeActionList":c(a.value),zmail.showHideSkeleton.updateList(a.value);var v=b.getElementsByClassName("msi-tick")[0];v?v.className="":(v=document.createElement("i"),v.className="msi-tick",b.appendChild(v));break;default:zmUtil.hideMenu()}}},updOutbox:function(a,b){zmInit.sendLoadOutbox("hide"),zmList.unchkAll();var c=a.res.split(",")[0];if(c>0)for(var d=0;d<c;d++)zmail.MailPreUtils.updateCount({fId:zmail.folId.oId,mode:"dec"});var e=zmInit.getListingDetObj();if("zm_Container"===zmTab.currentTab&&zmail.folId.oId===e.fId){var f={folId:zmail.folId.oId};$(zmail.mailCenter.listElem).html(""),zmCache.clearListObj(),zmInit.setListingDetObj({});var g=zmPrev.prevDetails("zm_Container").msgId;if(g&&"sendM"===b.mode){var h=b.mIds||[];h.indexOf(g)===-1&&(f.retainPreview=!0)}zmInit.foldView(f)}},sendOutbox:function(a){zmUtil.hideMenu(),zmInit.sendLoadOutbox("show"),a||(a="sendM");var b={aId:zmail.accId},c={mode:a};if(b.mode=a,"sendM"===a){var d=zmUtil.getSelectedMails()[0];b.mId=d.join(","),c.mIds=d}zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmList.updOutbox,p:b,csr:"s",ep:c})},getElemObj:D,consPreview:J,getListingElemObj:E,showMailListing:function(a,b){b=b||{};var c,d,e,f="",g=!1,h={unread:"zm_unread",all:"zm_all",flag:"zm_flag"},i=b&&!(b.toSelFol===!1);a&&!$.isEmptyObject(a)?(c=a,f=c.fId||c.folId||"",d=c.view||"",e=c.viewId||""):(c=zmInit.getListingDetObj(),d=c.flag&&"flag"||c.label&&"label"||c.view||c.attach&&"attach",f=c.fId||c.folId||h[d]||"",e=c.label||c.flag);var j=b.sortAscending;if(void 0===j&&(j=zmfolAction.getSortProperties(zmUtil.getFolId(),"type")),i?f?zmUtil.isViewId(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlviewH",!0)):zmUtil.isSharedFolder(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlSTreeH",!0)):zmUtil.isFolderId(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlTreeH",!0)):zmUtil.isLabelId(f)&&(g=!0,zmail.mailLeft.selRow(f,"zmllabelH",!0)):e&&zmUtil.isLabelId(e)&&(g=!0,zmail.mailLeft.selRow(e,"zmllabelH",!0)):g=!0,g){$(zmail.mailCenter.listElem).html(""),zmCache.clearListObj(!0),zmInit.setListingDetObj({});var k={folId:f,view:d,viewId:e,reInitialize:!0,sortOrder:j,hashDeffObj:b.mlDefObj};b.retainPreview&&(k.retainPreview=!0),zmInit.foldView(k),zmInit.updateHeaderBand()}else b.mlDefObj&&b.mlDefObj.resolve()},getViewBasedMsgList:function(a,b,c){var d=[],e=zmUtil.getMLConversionValue();return a&&(b||(b=zmInit.getListingDetObj()),b.fId!==zmail.folId.sId&&b.fId!==zmail.folId.tId&&b.fId!==zmail.folId.spId||(e=0),1===e?d=zmList.getMailSummaryList(b,a):0!==e&&(d=zmList.getListForAllMailsView(b,a))),zmail.convSortOrder&&c?d.reverse():d},setScrollUnreadView:function(a,b){var c=a.find("#"+b);$(c).length&&$(a).length&&a.scrollTop($(a).scrollTop()+$(c).offset().top-$(a).offset().top)},isMailListedInApp:function(a){var b,c=zmUtil.getFolId(),d=zmUtil.getListMap(c,"MO")||[];return b=d.indexOf(a),b!==-1},isMailListedInSearch:function(a){if(zmSearchUtil.isWorkspaceAvailable()){var b,c=zmSearchUtil.getSearchList();if(b=c.indexOf(a),b!==-1)return!0}return!1},setMailSelection:function(a,b,c){var d,e,f,g,h,i=!1;if(f=Boolean(zmUtil.getMailObj(a,"TH")),zmsuite.getWorkSpace(zmTab.currentTab)[1]&&(e=zmsuite.getWorkSpace(zmTab.currentTab)[1].$el),d=f&&"lt"===b?c.find("#t"+a):c.find("#"+a),g=Boolean(d&&d.length&&d.is(":visible")),!g&&e&&e.attr("data-mid")&&(d=c.find("#"+e.attr("data-mid"))),d&&d.length&&(g&&d.is(":visible")?(c.find("div."+j.mRow).removeClass(j.sel),d.addClass(j.sel)):d.parent().hasClass(j.thdChild)&&(c.find("div."+j.mRow).removeClass(j.sel),d.parent().prev().addClass(j.sel))),g&&e)e.attr("data-mid",a),"content"===b&&f&&e.hasClass("tmail")&&e.attr("data-ty","th"),"lt"===b&&e.attr("data-ty","lt"),zmList.doThreadPath(d,"add"),i=!0;else if(d&&d.length&&d.parent().hasClass(j.thdChild)&&e){var k=d.parent().prev().attr("id");k="t"===k.charAt(0)?k.substr(1):k,e.attr("data-mid",k),e.attr("data-ty","lt"),zmList.doThreadPath(d,"remove"),i=!0}i&&"zmStreamsApp"!==zmTab.currentTab&&"zm_srch1"!==zmTab.currentTab&&(b="content"===b?"th":b,h=zmList.getListingElemObj({msgId:a,type:b,opentype:4===zmail.mailOpt.isPopup?4:0}),"lt"===b&&zmUtil.getMailObj(a,"TH")&&a.indexOf("t")===-1&&(a="t"+a),zmPrev.PvNt(a,b,0,zmTab.currentTab,h))},clearcpvReq:function(){b=void 0},changeListingView:function(a,b,c){if(b||(b=zmUtil.getFolId()),zmUtil.hasFolSpecConversation(b)){var d=function(c){"success"===c.status&&(zmfolAction.updateCV(b,a),zmList.updateSortProperties(0),zmList.showMailListing())},e=function(a){var b=a.msg;b&&_zm.succErrMsg("e",b)},f=function(){var c={accId:zmail.accId,mode:"updateConversationView",folId:b,convView:a};zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:d,onerror:e,p:c})};c?d({status:"success"}):f()}},setListingType:function(a,b){var c={accId:zmail.accId,folderSpec:a,mode:"setlisttype"},d=function(b){"success"===b.result&&(zmail.listObj={},zmail.mailObj={},zmail.folviewThread=a,zmUtil.closeMailTabs(),zmfolAction.updateFoldersCV(a),zmList.updateSortProperties(0),zmList.showMailListing())};return b?void d({result:"success"}):zmAjq.XHR({u:zmail.conPath+"/listOpt.do",t:"POST",fn:d,p:c})},setConversationOrder:function(a){a=Number(a);var b={accId:zmail.accId,isAscending:a,mode:"setsortorder"},c=function(a){"success"!==a.result&&_zm.succErrMsg("e",d.global.errmsg)};return zmAjq.XHR({u:zmail.conPath+"/listOpt.do",t:"POST",fn:c,p:b}).then(function(){zmUtil.succErrMsg("s",f.common.succConvSortorder,{hideAfter:3e3}),zmail.convSortOrder=a})},updateSortProperties:function(a,b){b=b||zmUtil.getFolId(),zmfolAction.updateFolSortType(b,a);var c=zmList.getListObj(b);return c&&(c.sortOrder=a),!0},changeListingSortOrder:function(a,b){b=b||zmUtil.getFolId(),zmList.updateSortProperties(a,b),zmList.showMailListing({fId:zmail.mailLeft.selId},{retainPreview:!1,sortAscending:a})},sort:function(a,b){var c=$(a).closest("li"),d=zmfolAction.getSortProperties(b,"type"),e=zmDrop.getSortOptions(d);if(e){c.find("b").addClass("SC_ddn");var f=zmsuite.showMenu({par:c,list:e,align:"pleft",clk:function(a,d){zmList.changeListingSortOrder(a.value,b),f.remove(),c.find("b").removeClass("SC_ddn")}})}},showBulkActionBand:function(a){var b=!1,c=300;if("zm_Container"===zmTab.currentTab){var d=zmUtil.getFolId();b=zmUtil.getListMap(d,"showNextPage")}else"zm_srch1"===zmTab.currentTab&&(b=zmSearchUtil.hasNextPage());var e,g,i=zmUtil.getCheckedMailCount();if(!i)return void zmInit.listingBand.removeBulkActionBand();if(i>c)e=zmText.applyArgs(h.bulkaction.common.selexceed,{n:c}),g="clearAndSelect",zmInit.listingBand.createBulkActionBand(e,g);else if(b&&i<=c&&i>=10){e=zmText.applyArgs(f.common.multiplemail,{count:i}),g="selectFolder";var j=zmInit.getListingDetObj();"zm_Container"===zmTab.currentTab&&""===j.view&&""===j.flag&&""===j.label&&""===j.attach&&"selFilter"!==a&&(g="selectFolderViewAll"),zmInit.listingBand.createBulkActionBand(e,g)}else zmInit.listingBand.removeBulkActionBand()},showThreadTree:function(){var a,b,c=zmTab.currentTab;if("zm_Container"===c||"zm_srch1"===c){var d=zmUtil.getSelectedMails();if(b=d[1][0],!b){var e=d[0][0];e&&zmUtil.getMailObj(e,"TH")&&(b=e)}if(b){a=zmList.getListingElemObj({msgId:b,type:"lt",tabId:c,opentype:4===zmail.mailOpt.isPopup?4:0});var f=a.rowElem||[];f.length&&f.hasClass(j.thdTreeLine)||(zmList.hideThreadTree(),zmList.showHideThread(f,a))}}},hideThreadTree:function(){var a,b=zmTab.currentTab;"zm_Container"!==b&&"zm_srch1"!==b||(a=D(b),q(a),p(a))},addTaskIndicator:function(a){var b,c,d,e,f,g,h=["zm_Container","zm_srch1"],i=h.length;if(a.data.tasks.email&&a.data.tasks.email.msgid){b=a.data.tasks.email.msgid;var k=zmList.getMailObj(b);for(k&&zmCache.updateObj({mode:"upd",msgId:b,key:"MA",val:32|k.MA}),f=0;f<i;f++)g=h[f],zmsuite.isWorkspaceAvailable(g)&&(d=zmCenterListing.mailObjectAPI.getViewObject(b,g),d?e=d.$element:(c=zmsuite.getCenter(g)[0].getNodes()[2].$el,e=c.find("#"+b)),e.length&&!e.find("."+j.associate).length&&zmList.addAssociateIndication(e));zmPreviewTemplate.updateTaskComponent(b)}},addNoteIndicator:function(a){var b,c,d,e,f,g,h=["zm_Container","zm_srch1"],i=h.length;if(a.email&&a.email.accid&&a.email.msgid){b=a.email.msgid;var k=zmList.getMailObj(b);for(k&&zmCache.updateObj({mode:"upd",msgId:b,key:"MA",val:64|k.MA}),f=0;f<i;f++)g=h[f],zmsuite.isWorkspaceAvailable(g)&&(d=zmCenterListing.mailObjectAPI.getViewObject(b,g),d?e=d.$element:(c=zmsuite.getCenter(g)[0].getNodes()[2].$el,e=c.find("#"+b)),e.length&&!e.find("."+j.associate).length&&zmList.addAssociateIndication(e));zmPreviewTemplate.updateNoteComponent(b)}},getSelectedRowCount:function(){var a=zmUtil.getCheckedMailList();return a[0].length+a[1].length},toggleAVView:function(a,b){var c=zmail.listObj.attachVw&&zmail.listObj.attachVw.attachUtil.viewType;c&&c!==b&&($(a).closest("ul").find("b").removeClass("SC_sel"),$(a).closest("b").addClass("SC_sel"),zmail.listObj.attachVw.toggleView())},sortOrder:function(a){if(a=a||zmUtil.getFolId(),zmUtil.isFolderId(a)){var b=zmfolAction.getSortProperties(a);return 1===b.type}var c=zmUtil.getListMap(a);return c?1===c.sortOrder:zmail.sortOrder},markupSummary:function(a){try{var b,c=a.schemaObj,d=f.markup,e={},g=function(){var a,c;return c=b.ITEMDETAILS.length,a=c&&c>1?b.ITEMDETAILS[0].ITEMNAME+zmText.applyArgs(d.moreItems,{count:c-1}):b.ITEMDETAILS[0].ITEMNAME},h=function(a){b="ORDER"===a?c.ORDEROBJ:c.PARCLDLVRYOBJ;var f="";return b.PRICECURRENCY&&b.PRICE&&(f=" - "+b.PRICECURRENCY+" "+b.PRICE),e.subject=zdom("span",null,g(),zdom("font",{"class":"SC_red"}," ",f)," - "+d.from+" "+b.MERCHANTNAME),e.summary=zdom("span",{"class":j.summary+" SC_ndot"}),e},i=function(){var a=c.FLYTTKTOBJ[0],b=a.DEPARTUREDETAILS.AIRPORTCODE+" to "+a.ARRIVALDETAILS.AIRPORTCODE;return e.subject=zdom("span",null,a.AIRLINENAME+" - ",zdom("font",{"class":"SC_red"},b+" ")),e.summary=zdom("span",{"class":j.summary+" SC_ndot"}," - "+a.DEPARTUREDETAILS.DATE+" - "+a.DEPARTUREDETAILS.TIME),e};return"ORDER"===c.SCATYPE||"PARCELDELIVERY"===c.SCATYPE?h(c.SCATYPE):"FLIGHTRESERVATION"===c.SCATYPE&&i(),e}catch(k){zmUtil.debugLog(k)}},flightQAType:function(a){try{var b=f.markup,c=["CHECKINURL","MODIFYRESERVATIONURL","VIEWRESERVATIONURL"],d=[b.checkin,b.modify,b.vTicket];return d[c.indexOf(a.URLACTTYPE)]}catch(e){zmUtil.debugLog(e)}},resetSelectionInfo:_,updateAttachmentCache:ka,isListingChecked:R,isAllListingChecked:Q,getDupThdRowId:U,sendMailDataReq:C,showMailPreview:fa,loadUnreadMails:L,getCachedAttachmentData:H,stimulateToTabView:A,getRowModel:function(a){return zmInit.isDL?ZMail.listing.collection.get(a):{attributes:zmail.mailObj[a]}},getMailObj:function(a){if(zmInit.isDL){var b=ZMail.listing.collection.get(a);return b&&b.attributes}return zmail.mailObj[a]},addModel:function(a,b){zmInit.isDL?ZMail.listing.collection.add(a):(b=b||a.M,zmail.mailObj[b]=a)},removeModel:function(a){return zmInit.isDL?ZMail.listing.collection.clearModel(a):void delete zmail.mailObj[a]},updateModel:function(a,b,c){try{var d;zmInit.isDL?(d=ZMail.listing.collection.get(c),d.set(a,b)):(d=zmail.mailObj[c],d[a]=b)}catch(e){zmUtil.debugLog(e)}},createListMap:function(a,b,c){zmInit.isDL?ZMail.listing.collection.createListObj(a,c):zmail.listObj[a]={MO:c}},setListObj:function(a,b,c){zmInit.isDL?ZMail.listing.collection.setListObj(a,b,c):zmail.listObj[a][b]=c},getListObj:function(a,b,c){if(zmInit.isDL)return ZMail.listing.collection.getListObj(a,b,c);if(c)return zmail.listObj;var d=zmail.listObj[a];return b?d&&d[b]:d},updateListObj:function(a,b,c,d,e){var f=zmInit.isDL?zmList.getListObj(b,"MO"):zmail.listObj[b].MO;"add"===a&&f.splice(c,d,e)},clearListObj:function(a){zmInit.isDL?ZMail.listing.collection.clearMap(a):delete zmail.listObj[a]},addCollection:function(a,b,c,d){return zmInit.isDL?ZMail.listing.collection.mapWithView(a,{mapId:b,startIndex:c}):zmCache.dolistObj(b,a,d)},haveMailRecallSupport:function(a){if(!zmUtil.isZohoAccount(zmail.accId)||zmail.zoid===-1)return!1;var b=zmList.getMailObj(a);return b&&!b.RS&&5===b.MDS},addAssociateIndication:function(a){a.find("."+j.mRowCenter).after(ZMail.lView.constTemplate("associate",{iconCls:j.associate}))}};return function(){$.subscribe("zmailReconnect",function(){if(window.console.log("Updating Listing View, in respond to zmailReconnect - "+new Date),zmInit.getFolderTreeCount(),zmInit.getAccountInfo(),"zmStreamTree"!==zmail.mailLeft.selLayerId){var a=!0;"zmStreamsApp"===zmTab.currentTab&&(a=!1),zmList.showMailListing({},{retainPreview:!0,mlDefObj:void 0,toSelFol:a})}})}(),zmail.postJsDeffered.promise.then(function(){zmail.mailAttachments={},zmail.attachmentContainer=new zmail.Container({store:zmail.mailAttachments,containerSize:200,evictCount:20,idName:"id",considerAsHitOnRetrieval:!0})}),na}(),window.zmPrev=function(){var a=zmText.get("mail"),b=a.listing,c=a.preview,d=ZMail.lConstants,e=d.cls,f=function(a,b){try{var c,d=!0;b=b||zmInit.getListingDetObj();var e;a.indexOf("t")!==-1?(c=a.substring(1,a.length),e=zmList.getMailObj(c),0===zmList.getMailSummaryList(b,e.T).length&&(d=!1)):(c=a,e=zmList.getMailObj(c),d=!1),("unread"===b.view&&1===e.S||b.flag&&("-1"===b.flag&&0===e.NFG||"-1"!==b.flag&&e.NFG!==b.flag))&&(d||zmList.remReadMail(),zmList.setEmptyListing())}catch(f){zmUtil.debugLog(f)}},g={prevDetails:function(a){a=a||zmTab.currentTab;var b="",c="";return zmsuite.isWorkspaceAvailable(a)&&zmsuite.getCenter(a)[1]&&(b=zmsuite.getCenter(a)[1].$el.attr("data-mid")||"",c=zmsuite.getCenter(a)[1].$el.attr("data-ty")||""),{msgId:b,type:c}},isPrevOpen:function(a){return a=a||zmTab.currentTab,zmsuite.getCenter(a)[1].$el.hasClass("shw")},posAView:function(a,b){var c=b.find("#zmC"+a+" div.zmPAtt");c.is(":visible")&&c[0].scrollIntoView({behavior:"smooth"})},PvNt:function(a,b,c,d,e){var f,g,h,i,j,k,l;if(f=e.listArr||[],j=zmUtil.getFolId(),a.indexOf("t")||(a=a.substring(1)),f.length&&(i=$.inArray(a,f),g=f[i-1],h=f[i+1]),g||"th"===b&&(k=zmList.getMailObj(a)||{},k.TH&&zmUtil.getListMap(j)&&(l=zmList.getDupThdRowId(a,j),l&&(f=zmUtil.getListMap(j,"MO"),f.length&&(i=f.indexOf(l),g=f[i-1])))),h||"th"===b&&(k=zmList.getMailObj(a)||{},k.TH&&zmUtil.getListMap(j)&&(l=zmList.getDupThdRowId(a,j),l&&(i=f.indexOf(l),h=f[i+1]))),g||h?g?h?zmUtil.enableNavigation(d,"both"):zmUtil.disableNavigation(d,"next"):zmUtil.disableNavigation(d,"prev"):zmUtil.disableNavigation(d,"both"),2===c){var m=function(a){return function(){a&&zmUtil.disableNavigation(a,"both"),$.unsubscribe("mail/listing/viewchanged",m)}}(d);$.subscribe("mail/listing/viewchanged",m)}},cmpClose:function(a){a=a||zmTab.currentTab;var b=$.Deferred();if(zmsuite.getCenter(a)[1]){var c=zmsuite.getCenter(a)[1].getNodes()[1].$el;zmPreviewTemplate.unsubscribeNotesTasks(c);var d=zmPrev.prevDetails(a).msgId,e="",f=zmList.getMailObj(d);if(d&&f&&(e=f.T||"",$.publish("mail/preview/unload",{prevElem:c,msgId:d,thdId:e})),"undefined"!=typeof zmComp){var g=zmsuite.getCenter(a)[1].getNodes()[1].$el,h=[],i=g.find(".zm_cmp");i.each(function(){var a=$(this).attr("id"),b={};a&&(b=a.split("_"),h.push({cmpId:b[0],msgId:b[1]}))}),h.length?zmComp.saveReply({deferObj:b,cmpList:h}):b.resolve(!0)}else b.resolve(!0)}else b.resolve(!0);return b},composeReply:function(a,b){var d=zmsuite.getCenter()[1].$el,e=b.M;a=$.extend(a,zmUtil.getCmpViewType()),zmUtil.isInlineCompose()?b&&b.DMID?(a.prevDOM=d.find("#zmCon"+a.viewType+b.DMID),zmPreviewTemplate.loadInlineCompose(e,a.prevDOM,a.mode)):zmUtil.getMailContent(e).then(function(b){a.prevElem=d,a.msgId=e,zmContentCache.isCached(e)&&(a.draftCont=b),zmUtil.invokeComposer(a)}).fail(function(){_zm.succErrMsg(c.inlinecompose.error)}):(a.prevElem=d,a.msgId=e,zmUtil.invokeComposer(a))},clsPreview:function(a){var b=a||zmTab.currentTab;"list"===a&&(b="zm_Container"),$.when(zmPrev.cmpClose(b)).then(function(b){if(b){var c,d,f,g;a=a||zmTab.currentTab;var h="zm_srch1"===a?"zm_srch1":"zm_Container";a.indexOf("zm_srch")?zmsuite.getCenter("zm_Container")[1].close():zmsuite.getCenter(a)[1].close(),zmPrev.prevDetails(h).msgId&&(a.indexOf("zm_tab")===-1&&(zmTopMenus.util.hide({type:"functional",isForceHide:!0,tabId:h}),zmUtil.hideMenu()),zmUrlAct.update({from:"zmCenter",remove:!0}),zmRestore.saveState("preview",{p:""},{})),"list"===a?(c=zmPrev.prevDetails("zm_Container").msgId,f=!0,g=zmList.getElemObj("zm_Container")):c=zmPrev.prevDetails().msgId,zmUtil.setInlineCmpScope(!1),g=g||zmList.getElemObj(a),g.rowElem=$(g.listElem).find("."+e.sel),$(g.prevElem).attr("data-mid",""),$(g.prevElem).attr("data-ty",""),$(g.prevElem).removeClass("SC_notr"),g.mainElem.removeClass("SC_sw"),zmList.listingFocused=!0,g.rowElem.length&&g.rowElem.removeClass(e.sel),d="zm_Container"===a||"list"===a?zmInit.getListingDetObj():zmsuite.getCenterOuter().$el.data("data-detail"),d&&"unread"===d.view&&c&&(f||zmList.remReadMail(),(""===d.fId&&0===zmInit.getUnreadViewCount()||""!==d.fId&&!zmUtil.isSharedFolder(d.fId)&&0===zmail.folCount[d.fId].c)&&zmList.setEmptyListing()),g.rowElem.length&&zmList.doThreadPath(g.rowElem,"remove"),zmContentCache.remove(c),$.publish("/mail/previewclosed",{})}})},updatePrevOnDeletion:function(a,b){var c,d,e,f,g,h;b=b||"zm_Container",a.indexOf("t")||(a=a.substring(1));var i,j=zmList.getMailObj(a)||{};"zm_Container"===b?(e=zmInit.getListingDetObj(),c=zmUtil.getFolId(),i=zmList.getListObj(c),h=$(zmail.mailCenter.listElem),"th"===h.find("#"+a).data("ty")?g=zmList.getViewBasedMsgList(j.T,e):i&&(g=i.MO)):"zm_srch1"===b&&(e=zmsuite.getCenterOuter(b).$el.data("data-detail"),c=e.view,h=zmsuite.getCenter(b)[0].getNodes()[2].$el,g="th"===h.find("#"+a).data("ty")?zmList.getListForAllMailsView(j.T,e):zmSearchUtil.getSearchList()),d=$.inArray(a,g),d!==-1&&(f=g[d+1],f||(f=g[d-1])),f&&b===zmTab.currentTab?(zmList.getMailObj(f).TH&&0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==b&&(f="t"+f),$.when(zmPrev.cmpClose(b)).then(function(c){c&&(zmContentCache.remove(a),zmList.getMailData({msgId:f,type:"lt",opentype:4===zmail.mailOpt.isPopup?4:0,tabId:b}))})):zmPrev.clsPreview(b)},setCountinPreview:function(a){var c,d,f,g,h=zmPrev.prevDetails(),i=h.msgId;a.rowElem&&a.rowElem.length||($("#"+i).length?a.rowElem=$(a.listElem).find("#"+i):a.rowElem=$(a.listElem).find("#t"+i));var j,k=a.rowElem;if(k.removeClass(e.sel),c=$(a.prevElem),c.find(".SC_Popn").length&&c.find(".SC_Popn").remove(),d=zmUtil.getCheckedMailCount(),f=$("<div/>"),f.addClass("SC_pct SC_Popn"),1===d)f.text(b.common.singlemail);else{var l=b.common.multiplemail,m=zmText.applyArgs(l,{count:d});f.text(m)}if(g=a.mainElem.height()-55,f.height(g),j=c.find(".SC_frt").eq(0).find("ul"),j.eq(0).hide(),j.eq(1).hide(),j.eq(2).hide(),c.find(".SC_pct").hide(),c.find(".zm_shwconv").parent().hide(),c.find(".SCS_postWra").hide(),c.find(".zms_fixed").length){c.find(".zms_fixed").hide();var n=c.find(".SC_Twpr"),o=String(n.css("bottom"));"0px"!==o&&(n.data("bottom",o),n.css("bottom","0px"))}zmsuite.getCenter()[1].getNodes()[1].$el.append(f),c.find(".SC_phd").hide(),c.find(".zmQry").hide(),zmList.doThreadPath(k,"remove")},removeCountinPreview:function(a,c){var d,f,g,h=$(a.prevElem);if(d=zmPrev.prevDetails(),f=d.msgId,g=zmUtil.getCheckedMailCount(),g>0)if(1===g)h.find(".SC_Popn").text(b.common.singlemail);else{var i=b.common.multiplemail,j=zmText.applyArgs(i,{count:g});h.find(".SC_Popn").text(j)}else{if(h.find(".SC_Popn").remove(),h.find(".SC_pct").show(),h.find(".zm_shwconv").parent().show(),h.find(".SCS_postWra").show(),h.find(".zms_fixed").length&&!zmUtil.hideCommentBox()){h.find(".zms_fixed").show();var k=h.find(".SC_Twpr");k.css("bottom",k.data("bottom"))}if(h.find(".SC_frt").eq(0).find("ul").show(),f){var l;4===c||a.mainElem.hasClass("SC_swB")||h.find(".SC_phd").show(),l="zm_srch1"===zmTab.currentTab?0:zmUtil.getMLConversionValue(),"lt"===d.type&&1===zmList.getMailObj(f).TH&&0!==l?a.rowElem=$(a.listElem).find("#t"+f):a.rowElem=$(a.listElem).find("#"+f),a.rowElem.addClass(e.sel)}}},toggleMailContentViewMode:function(a,b,c){var f,g,h,i=$(a),j=i.attr("data-mid"),k=i.attr("id"),l=i.next(),m=!1;c=c||zmTab.currentTab,k.indexOf("zmHdrT")||(b=2),3===b?(f={contElem:$(a).closest(".SC_pct"),hdrElem:$(a),viewDetails:{view:"notification"}},f.prevElem=f.contElem.parent(),g=[]):(f=zmList.getElemObj(c),g=f.listElem),zmList.setMailSelection(j,"content",$(g));var n=zmList.getMailObj(j);if(0===b){var o=zmsuite.getWorkSpace(c)[1].$el,p=o.find(".SC_ptit").find(".SC_phd"),q=zmPreviewTemplate.getSubjectToPreview(n.SB);p.html(q),!n.TH||(0!==zmUtil.getMLConversionValue()&&zmail.mailLeft.selId!==zmail.folId.sId||"zm_Container"!==zmTab.currentTab)&&"zm_srch1"!==zmTab.currentTab||p.append('<i class="msi-thread" data-event="viewfullthd" data-from="header"></i>'),zmPrev.removeCountinPreview(f,b),zmPreviewTemplate.setPreviewHeaderHeight(f,c)}else 4===b&&(zmPrev.removeCountinPreview(f,b),zmPreviewTemplate.setPreviewHeaderHeight(f,c,b));0===l.length&&(m=!0,n.FD!==zmail.folId.dId&&(h=$("<div />"),h.attr("id","zmCon"+k.substr(5)),setTimeout(function(){h.children().length||zmComponent.loadingBand({container:h[0],type:"pagination"})},100),i.after(h)),zmList.getMailData({msgId:j,type:"content",from:i,opentype:b,tabId:c},f)),n.T&&!$("t"+j).length&&$(g).find("."+d.cls.mRow).removeClass(e.chkBox),m||zmPreviewTemplate.applyHeaderState(i),0!==b&&4!==b||!i.parent().hasClass("js-scrolltop")||zmPreviewTemplate.alignMailTopToPreview(String(j)),3!==b&&zmTopMenus.util.show({type:"functional",msgId:zmUtil.getSelectedMails()[0][0],tabId:zmTab.currentTab})},setMailDOMContent:function(a,b){var c=zmPreviewTemplate.getTemplate("content",{data:a,prms:b});c=$(c);try{var d=c.find(".jsConTent")[0].childNodes[1].firstChild,e=d.style["font-size"];"0pt"===e&&(d.style["font-size"]="10pt")}catch(f){zmUtil.debugLog(f)}var g;a.NEWATT&&a.NEWATT.length&&(g=zmAttach.build({appName:"mail",attList:a.NEWATT,zipType:"downloadall",showMOpt:!0,showTag:!0,supportDrag:!0,attClass:"zmAch",attListClass:"zmPAtt",fileNameLen:23,entityInfo:{id:b.msgId}})),g&&c.find(".zmPCnt").after(g);var h,i,j,k=b.opentype,l=b.msgId,m=b.tabId||zmTab.currentTab;"content"===b.type?(h=$(b.from),i=$(h.next()),i.html(""),i.append($(c).children().eq(1).children()),c=i,zmPreviewTemplate.applyHeaderState(h),"bulk_mail"!==b.load_action&&h.closest(".SC_pct").addClass("SC_Tfcs"),0!==k&&4!==k||(zmPrev.removeCountinPreview(zmList.getElemObj(m),k),h.parent().hasClass("js-scrolltop")&&zmPreviewTemplate.alignMailTopToPreview(String(l)))):(j=c,b.parentElm?$(b.parentElm).append($(j)):zmsuite.getCenter(m)[1].getNodes()[1].push($(j)));var n=zmList.getMailObj(l);3!==k&&n&&!zmUtil.isSharedFolder(n.FD)&&(b.mailContElem=$(c),zmAppLoader.load("listingEventHandlers").then(function(){zmPreviewTemplate.showNotes(b),zmPreviewTemplate.showTasks(b),zmPreviewTemplate.showEvents(b),zmPreviewTemplate.showProjectsEntities(b)})),zmUtil.addSelectMenu({applyDOM:[$(c).find(".zmPCon")[0]]}),zmUtil.applyLBDots(c.find("[id^=vfc]").parent())},changeFlag:function(a,b){var c=b.flag;zmPrev.flagMail(a,c),zmUtil.hideMenu()},flagMail:function(a,b){var c,d,e={};d=a.parents(".zmPHdr"),c=d.attr("data-mid"),e.msgId=[c],e.thd=[],e.fVal=b,zmmailAct.applyActions("flag","click",e)},consFlagContextMenu:function(a){var c,d,e;return c=a.target||a.srcElement,d=$(c),d.hasClass("zmflg")&&(e={clk:function(a,b){zmPrev.changeFlag(d,b)},conArr:[{htm:"<i class='msi-flag zmflg zm_fgB'></i>"+b.flagmenu.infoflag,data:{flag:"1"}},{htm:"<i class='msi-flag zmflg zm_fgR'></i>"+b.flagmenu.important,data:{flag:"2"}},{htm:"<i class='msi-flag zmflg zm_fgG'></i>"+b.flagmenu.followup,data:{flag:"3"}},{sep:!0},{htm:"<i class='msi-flag zmflg'></i>"+b.flagmenu.clearflag,data:{flag:"0"}}]},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a)),!1},getHeader:function(a){return zmPreviewTemplate.getTemplate("header",a)},updatePvNtforNewMails:function(){if(zmsuite.isWorkspaceAvailable("zm_Container")&&$(zmail.mailCenter.prevElem).hasClass("shw")){var a,b,c=zmPrev.prevDetails("zm_Container").msgId,d=zmUtil.getFolId();a=$("#"+c).length>0?c:"t"+c,b=zmList.getElemObj("zm_Container"),b.rowElem=$("#"+a),b.listArr=zmUtil.getListMap(d,"MO")||[],zmPrev.PvNt(a,"lt",0,"zm_Container",b)}},show:function(a,d,e){var f={},g="",h=!1;g=$(d).closest(".SC_pct").find(".zmPHdr").attr("data-mid");var i=$(d).closest("li"),j=[],k=zmList.getMailObj(g),l=k.FD;if(h="zm_Container"!==zmTab.currentTab&&(k.streams||zmPreviewTemplate.isMailOpenedViaStreams(d)),zmail.folId.dId===k.FD)j=[{htm:c.contextmenu.editdraft,data:{action:"editdraft",msgId:g}},{htm:c.contextmenu.discarddraft,data:{action:"delete",msgId:g}}];else if(h)j=j.concat([{htm:c.contextmenu.editasnew,data:{action:"editasnew",msgId:g}},{sep:!0},{htm:c.contextmenu.save,data:{action:"save",msgId:g}},{htm:c.contextmenu.print,data:{action:"print",msgId:g}},{htm:c.contextmenu.showorg,data:{action:"original",msgId:g}},{htm:c.contextmenu.garbledmsg,data:{action:"garbled",msgId:g}}]),j=j.concat(zmStreamsApp.util.getDropdownMenu(g,"1"));else{if(k&&l&&!zmUtil.isSharedFolder(l,"R")&&k.FD!==zmail.folId.sId){var m=k.S?"markunread":"markread",n=k.S?b.maillistopt.markunread:b.maillistopt.markread;j=j.concat([{htm:n,data:{action:m,msgId:g}},{sep:!0}])}var o={allowed:void 0};if($.publish("/mail/collab/share/status",{mailID:g,config:o,container:e?e.containerDOM:""}),o.allowed!==!0||zmUtil.isSharedFolder(l)||zmfolAction.isMutualFolder(l))(zmUtil.isSharedFolder(l)||zmfolAction.isMutualFolder(l))&&j.push({htm:c.contextmenu.comment,data:{action:"focusComment",from:"preview",msgId:g}});else{var p="",q="";o.entityExists&&zmUtil.isSelectedShareEnabled()?o.isConvo?(p=o.sharedText,q="updateConvo"):(p=c.contextmenu.comment,q="share"):(p=k.TH?c.contextmenu.sharethd:c.contextmenu.share,q="share"),j.push({htm:p,data:{action:q,from:"preview",msgId:g}})}var r=c.contextmenu.reminder;if(zmList.isRMOBJ(g)&&(r=c.contextmenu.updrem),zmUtil.isSharedFolder(l,"R")||(j=j.concat([{htm:c.contextmenu.editasnew,data:{action:"editasnew",msgId:g}},{sep:!0}])),zmUtil.isZohoAccount(zmail.accId)&&!zmUtil.isSharedFolder(l)&&(j=j.concat([{htm:r,data:{action:"addtowatch",msgId:g}},{sep:!0}])),j=j.concat([{htm:"<i class='msi-larrow'></i>"+c.contextmenu.addto,data:{action:"addtolist",dropMenudirection:"left"},child:function(){return zmPreviewTemplate.getAddToMenu(g)}},{sep:!0},{htm:c.contextmenu.save,data:{action:"save",msgId:g}},{htm:c.contextmenu.print,data:{action:"print",msgId:g}},{htm:c.contextmenu.showorg,data:{action:"original",msgId:g}},{htm:c.contextmenu.garbledmsg,data:{action:"garbled",msgId:g}}]),k&&!zmUtil.isSharedFolder(l)){if(j.push({sep:!0}),k.FD===zmail.folId.spId)j=j.concat([{
htm:b.maillistopt.notspam,data:{action:"marknotspam",msgId:g}},{sep:!0}]);else{var s=k.AR;s||(j=j.concat([{htm:b.maillistopt.markspam,data:{action:"markspam",msgId:g}},{sep:!0}]))}j.push({htm:b.contextmenu["delete"],data:{action:"delete",msgId:g}})}}var t=[{htm:b.contextmenu.reply,data:{action:"reply",from:"prvInline",msgId:g,par:i}},{htm:b.contextmenu.replyall,data:{action:"replyall",from:"prvInline",msgId:g,par:i}},{htm:b.contextmenu.forward,data:{action:"forward",from:"prvInline",msgId:g,par:i}}],u=[{htm:c.attachmentmenu.downloadaszip,data:{action:"downloadall",msgId:g}}];f.align="pright",f.clk=function(a,b){zmPrev.bindAction(a,b,{sourceDOM:$(d).closest("li")})},"zm_prvRepLst"===a?(f.align="pleft",f.list=t,f.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")):"zm_dldLst"===a?(f.list=u,f.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")):"zm_preaLst"===a&&(f.list=j,f.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")),f.paddingOffset=5,zmsuite.showMenu(f)},isEntityOpenedInPreview:function(a,b){var c=zmList.getMailObj(a);if(!c)return!1;b=b||"zm_Container";var d=zmPrev.prevDetails(b).msgId;if(a===d)return!0;if(c.TH){var e=c.T,f=zmList.getListObj(e);return e&&d&&f&&f.MO.indexOf(a)!==-1}return!1},bindAction:function(a,b,c){c=c||{};var d=a.action,e=a.msgId,f={},g=a.from;e||(e=$(b).closest(".SC_pct").find(".zmPHdr").attr("data-mid")),"view"!==d&&zmUtil.hideMenu();var h="t",i=!1,j=null;g&&"prvInline"===g&&(h="p",i=!0,j=a.par);var k=zmList.getMailObj(e);switch(k&&k.streams&&(f.groupId=k.groupId,f.streamsView=!0),d){case"reply":i?zmComp.chgReply("reply",h,e,j):(f.mode="reply",zmPrev.composeReply(f,k));break;case"replyall":i?zmComp.chgReply("replyall",h,e,j):(f.mode="replyall",zmPrev.composeReply(f,k));break;case"forward":$.publish("/mail/forwardmail",{mailID:e,workspaceID:zmTab&&zmTab.currentTab,containerDOM:c.containerDOM,mode:"forward"}),i?zmComp.chgReply("fwdi",h,e,j):(f.mode="fwdi",zmPrev.composeReply(f,k));break;case"editasnew":i?zmComp.chgReply("eanew",h,e,j):(f.mode="eanew",f.msgId=e,zmUtil.invokeComposer(f));break;case"save":zmPreviewTemplate.saveHTMLFile({mId:e,mode:"msg"});break;case"print":zmPreviewTemplate.printMsg({mId:e});break;case"original":zmPreviewTemplate.showOrgMsg({mId:e});break;case"garbled":zmPreviewTemplate.garbMsg({mId:e});break;case"delete":zmList.bindAction({action:"delete"});break;case"markunread":zmmailAct.applyActions("unread","dropdown",{thd:[],msgId:[e]});break;case"markread":zmmailAct.applyActions("read","dropdown",{thd:[],msgId:[e]});break;case"markspam":zmmailAct.doActions("spam","dropdown",{thd:[],msgId:[e]});break;case"marknotspam":zmmailAct.doActions("notspam","dropdown",{thd:[],msgId:[e]});break;case"editdraft":var l=zmsuite.getCenter()[1].$el;f.mode="draft",f.msgId=e,f.prevElem=l,zmUtil.invokeComposer(f);break;case"addtotasks":var m=zmList.getMailObj(e),n=m.SB?_zm.unescapeTags(m.SB):"",o=m.SM?_zm.unescapeTags(m.SM):"";zmUtil.loadTask({action:"addPopupTask",groupId:zmail.zuid,tasks:{SUMMARY:o,TITLE:n},addparams:{msgid:e,accid:zmail.accId,senderid:m.F}});break;case"addtowatch":zmWatch.showWatch({msgId:e,elem:b,openWatch:"preview_dropdown",loadType:"popup"}),_zm.stopEvents();break;case"addtonotes":m=zmList.getMailObj(e),n=m.SB?_zm.unescapeTags(m.SB):"",o=m.SM;var p={addparams:{msgid:e,accid:zmail.defAccId,senderid:m.F}};(64|m.MA)!==m.MA&&(p.title=n,p.desc=o),zmUtil.loadNotes("popup",p);break;case"addtoevents":zmUtil.hideMenu(),zmUtil.loadEvents(function(){zmail.eventInteg.util.addEvent(e)});break;case"share":var q=$(c.sourceDOM).parents(".zmPHdr").parents(".SC_pct").parent();$.publish("/mail/view/focuscommentbox",{mailID:e,containerDOM:$(q)[0]});break;case"updateConvo":var r=$(c.sourceDOM).parents(".zmPHdr").parents(".SC_pct").parent();$.publish("/mail/preview/updateshare",{mailID:e,containerDOM:$(r)[0],elm:$(c.sourceDOM).parents(".zmPHdr").find(".js-shareicon")[0]});break;case"focusComment":var s=$(c.sourceDOM).parents(".zmPHdr").parents(".SC_pct").parent();s.find(".SCS_postWra").find(".zmCmntFixed").find("textArea").focus();break;case"addfilter":zmPreviewTemplate.createNewFilter(a);break;case"viewfullthd":zmList.getMailData({msgId:e,type:"lt",opentype:2,src:"conversation"});break;case"copylink":case"watch":case"streamsdelete":case"archive":case"streamsTimeline":a.fn&&a.fn();break;case"addsmartfilter":zmPreviewTemplate.classifySmartFilter(e,a.filtervalue,!0,$(b).closest(".SC_pct"));break;case"addtoprojects":zmUtil.loadProjects(function(){zmail.projectsInteg.util.addTaskBugFromMail(e),zmUtil.hideMenu()})}},updateListOnNavigation:f};return zmail.postJsDeffered.promise.then(function(){zmail.prevMails={},zmail.mailContainer=new zmail.Container({store:zmail.prevMails,containerSize:100,evictCount:25,idName:"id",isObjectInUse:zmUtil.isMailContentInUse,considerAsHitOnRetrieval:!1})}),g}(),window.zmDragger=function(){var a={},b=zmText.get("mail").listing.common.dropMsg;a.currPos=0,a.newPos=0,a.updatePos=_.throttle(function(b,c){var d,e;c=c[0],a.currPos?a.newPos=b.getBoundingClientRect().top:a.currPos=a.newPos=b.getBoundingClientRect().top,a.newPos<0||(d=a.newPos-a.currPos,e=c.scrollTop+d,e=Math.min(e,c.scrollHeight),c.scrollTop=e)},100),a.reset=function(){a.currPos=0,a.newPos=0};var c=function(a){try{var b;if(b=a.closest("li")){var c;b.hasClass("cantClose")?c=b.index():b.parents(".secContainer").length&&(c=b.index()+1);var d=zmTab.tabArr[c]&&zmTab.tabArr[c].appId;d.indexOf("SComp")&&d.indexOf("Cmp")&&("zm_Container"!==d&&d.indexOf("zm_tab")&&d.indexOf("zm_srch")||!zmsuite.getCenter(d)[1].$el.find(".SC_drag").length)||(zmsuite.showExistingApp(d),zmUtil.hideMenu())}}catch(e){zmUtil.debugLog(e)}},d=function(a,b,c){var d={};if(a.length>1)d=zmUtil.getSelectedMails(b),d.mIds=d[0],d.tIds=d[1];else{var e=a&&a[0].id;"t"===e.charAt(0)?(e=e.substring(1),d={mIds:[],tIds:[e]}):d={mIds:[e],tIds:[]}}zmComp.dropCmpFwdMe({msgList:d,maskElem:c})},e=function(){return b};return{updateScroll:a.updatePos,resetScrollPos:a.reset,hoverOnTabs:c,dropOnCompose:d,getDropMessage:e}}(),window.zmmailAct=function(){var a,b=zmText.get("mail"),c=b.listing,d=b.actions,e=b.preview,f=b.listing.common.deleteOutBox,g={},h={},i=[],j=zmail.folviewThread,k=ZMail.lConstants,l=k.cls;i=["read","unread","flag","label","move","delete","archive","unarchive","spam","notspam","folderread","sweep"];var m=function(a,b,c){zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:c,p:a,csr:"s",ep:b,setSessionId:b.suppressWSNoti})},n=function(a,b){a="thd"===b?"zm_tabt"+zmUtil.getMailObj(a,"T"):"zm_tab"+a,zmsuite.isWorkspaceAvailable(a)&&(zmsuite.closeWorkspace(a),zmsuite.showExistingApp(zmTab.currentTab))},o=function(a){zmCache.updateObj(a)},p=function(a,b){void 0!==zmUtil.getMailObj(a,"TS")&&(o({mode:"upd",msgId:a,key:"TS",val:b}),$.publish("mail/updateRead",{msgId:a}))},q=function(a,b,c){var d,e,f,h,i=[];if(f=zmUtil.getMailObj(a))switch(e=f.T,d=$.extend({},g),d.label="",d.attach="",d.flag=b,2!==j&&d.fId===zmail.folId.spId||(d.fId=""),i=zmList.getMailSummaryList(d,e),h=i.length,c){case"0":1===h&&("1"===b?f.TI=!1:"2"===b?f.TM=!1:"3"===b&&(f.TF=!1));break;case"1":f.TI=!0,1===h&&("2"===b?f.TM=!1:"3"===b&&(f.TF=!1));break;case"2":f.TM=!0,1===h&&("1"===b?f.TI=!1:"3"===b&&(f.TF=!1));break;case"3":f.TF=!0,1===h&&("1"===b?f.TI=!1:"2"===b&&(f.TM=!1))}},r=function(a,b){var c=zmUtil.getMailObj(a);if(c)switch(o({mode:"upd",msgId:a,key:"NFG",val:b}),b){case"0":c.TI=!1,c.TF=!1,c.TM=!1;break;case"1":c.TI=!0,c.TF=!1,c.TM=!1;break;case"2":c.TI=!1,c.TF=!1,c.TM=!0;break;case"3":c.TI=!1,c.TF=!0,c.TM=!1}},s=function(a,b,c){var d=zmUtil.getMailObj(a);if(d){d.TTAGS=d.TTAGS||[];var e,f,h,i=[],k=d.TTAGS,l=d.T;switch(c){case"add":for(e=0;e<b.length;e++)k.indexOf(b[e])===-1&&d.TTAGS.push(b[e]);break;case"delete":for(e=0;e<b.length;e++)f=k.indexOf(b[e]),h=$.extend({},g),2!==j&&h.fId===zmail.folId.spId||(h.fId=""),h.label=b[e],i=zmList.getMailSummaryList(h,l),f!==-1&&i.length<=1&&k.splice(f,1);break;case"deleteall":d.TTAGS=[]}}},t=function(a,b,c){var d=[];return zmUtil.getListMap(b)?d=zmList.getViewBasedMsgList(b,c):d.push(a),d},u=function(a,b,c,d){var e,f,h,i,j=[];i=c.folId;var k=zmUtil.getMailObj(a);if("msg"===d){if(o({mode:"move",msgId:a,rFrom:b,addTo:i,type:d}),!k.S&&!k.AR){var l={action:"move",src:b,dest:i};zmail.MailPreUtils.updateCount({fId:b,mode:"dec",actionObj:l}),zmail.MailPreUtils.updateCount({fId:i,mode:"inc",actionObj:l})}}else if("thd"===d)for(o({mode:"move",msgId:a,rFrom:b,addTo:i,type:d}),e=k.T,j=t(a,e,g),f=j.length,h=0;h<f;h++)o({mode:"upd",msgId:j[h],key:"FD",val:i});zmfolAction.isMutualFolder(i)&&zmContentCache.isCached(a)&&zmContentCache["delete"](a)},v=function(a,b){var c,d,e,f=[],h=zmUtil.getMailObj(a),i=h.FD;if("msg"===b)o({mode:"upd",msgId:a,key:"AR",val:1}),$.publish("folder/archived",[h.FD]),h.S||zmail.MailPreUtils.updateCount({fId:i,mode:"dec"});else if("thd"===b)for(e=h.T,f=t(a,e,g),d=f.length,c=0;c<d;c++)o({mode:"upd",msgId:f[c],key:"AR",val:1}),$.publish("folder/archived",[zmUtil.getMailObj(f[c],"FD")]);(g.fId&&"archive"!==g.view||!g.fId&&"unread"===g.view)&&zmCache.updateCacheForViews(a)},w=function(a,b){var c,d,e,f=[],h=zmUtil.getMailObj(a),i=h.FD;if("msg"===b)o({mode:"upd",msgId:a,key:"AR",val:0}),h.S||zmail.MailPreUtils.updateCount({fId:i,mode:"inc"});else if("thd"===b)for(e=h.T,f=t(a,e,g),d=f.length,c=0;c<d;c++)o({mode:"upd",msgId:f[c],key:"AR",val:0});g.fId&&"archive"===g.view&&zmCache.updateCacheForViews(a)},x=function(b,c,d){var e,f,i,k=0,m=[],n=[],q=[],r=zmUtil.getMailObj(b)||{};if("msg"===c){if(!r.S){e=r.FD,o({mode:"upd",msgId:b,key:"S",val:1});var s,t;if(t=$(zmail.mailCenter.listElem).find("#"+b),s=t.parent("."+l.thdChild).length?t.parent("."+l.thdChild):$(zmail.mailCenter.listElem).find("."+l.sel).next(),r.T&&0!==j){var u,v;u=s.prev(),u.length&&(v=u[0].id,0===v.indexOf("t")&&(v=v.substring(1),$.publish("mail/updateRead",{msgId:v})))}r.AR||zmail.MailPreUtils.updateCount({fId:e,mode:"dec",info:d}),n.push(b)}}else if("thd"===c){i=r.T;var w=$.extend({},g);for("unread"===g.view&&(""===g.fId?w.view="all":w.view=""),zmUtil.getListMap(i)?m=zmList.getViewBasedMsgList(r.T,w):m.push(b),f=m.length,k=0;k<f;k++)zmUtil.getMailObj(m[k],"S")||o({mode:"upd",msgId:m[k],key:"S",val:1});q.push(b),p(b,1)}if("unread"===g.view&&"mail_preview"!==a){var x=!1;if("zm_Container"!==zmTab.currentTab){var y=zmsuite.getCenterOuter().$el.data("row-detail")?zmsuite.getCenterOuter().$el.data("row-detail").rowId:"";y.indexOf("t")||(b=y.substring(1),r=zmUtil.getMailObj(b)),x=!0}else!r.TH&&$(h.prevElem).attr("data-mid")!==b||r.TH&&$(h.prevElem).attr("data-mid")&&zmUtil.getMailObj($(h.prevElem).attr("data-mid"),"T")!==r.T?x=!0:"dropdown"===a&&(x=!0);x&&(!r.TH||r.TH&&zmInit.checkThreadRead(r.T))&&zmCache.updateCacheForViews(b)}},y=function(a,b){var c,d,e,f=0,h=[],i=zmUtil.getMailObj(a);if("msg"===b)i.S&&(c=i.FD,c!==zmail.folId.sId&&o({mode:"upd",msgId:a,key:"S",val:0}),i.AR||zmail.MailPreUtils.updateCount({fId:c,mode:"inc"}));else if("thd"===b){e=i.T;var j=$.extend({},g);"unread"===g.view&&(""===g.fId?j.view="all":j.view=""),zmUtil.getListMap(e)?h=zmList.getViewBasedMsgList(i.T,j):h.push(a),d=h.length;var k;for(f=0;f<d;f++)k=zmUtil.getMailObj(h[f]),k.S&&k.FD!==zmail.folId.sId&&o({mode:"upd",msgId:h[f],key:"S",val:0});p(a,0)}},z=function(a,b,c){var d,e,f,h=[],i=zmUtil.getMailObj(a);if("msg"===b){if(0!==i.S||i.AR)g.fId===zmail.folId.teId?zmail.MailPreUtils.updateCount({fId:zmail.folId.teId,mode:"dec"}):g.fId===zmail.folId.dId&&zmail.MailPreUtils.updateCount({fId:zmail.folId.dId,mode:"dec"});else{var j={action:"delete",src:i.FD,dest:zmail.folId.tId};zmail.MailPreUtils.updateCount({fId:i.FD,mode:"dec",actionObj:j}),0===c&&zmail.MailPreUtils.updateCount({fId:zmail.folId.tId,mode:"inc",actionObj:j})}o({mode:"delete",msgId:a,folId:i.FD,type:b})}else if("thd"===b&&(d=i.T,zmUtil.getListMap(d)?h=zmList.getViewBasedMsgList(d,g):h.push(a),f=h.length,0===c))for(e=0;e<f;e++)o({mode:"delete",msgId:h[e],folId:zmUtil.getMailObj(h[e],"FD"),type:b});!g.fId&&(g.view||g.flag||g.label)&&zmCache.updateCacheForViews(a)},A=function(a,b){var c=$("#"+a),d=a,e=zmUtil.getMailObj(a);if(b=b||"zm_Container",zmTab.currentTab.indexOf("zm_tabt"))if(e&&zmUtil.getListMap(e.T)){var f=zmCenterListing.mailObjectAPI.getViewParentOf("c"+d,b);f&&(c=f.$element)}else d=zmList.getDupThdRowId(a,zmUtil.getFolId()),d&&(c=$(zmail.mailCenter.listElem).find("#t"+d));else d=zmsuite.getCenterOuter().$el.data("row-detail").rowId,c=$(zmail.mailCenter.listElem).find("#"+d);return c},B=function(a,b){zmail.folCount[g.fId]&&zmUtil.getMailObj(a,"TH")&&(g.fId!==b?($("#zmHdrP"+a).parent().addClass("SC_Tfdr"),$("#zmHdrT"+a).parent().addClass("SC_Tfdr")):($("#zmHdrP"+a).parent().removeClass("SC_Tfdr"),$("#zmHdrT"+a).parent().removeClass("SC_Tfdr")))},C=function(a,b){var c=zmInit.findFolName(b),d="";d=zmUtil.getMailObj(a,"AR")?c+" ("+e.contentOptions.archived+")":c,$(zmail.mailCenter.listElem).find("#"+a+" ."+l.folName).text(c),$("#zmHdrP"+a+" .zm_folname").text(d),$("#zmHdrT"+a+" .zm_folname").text(d),$("#zmHdrS"+a+" .zm_folname").text(d);var f=$(zmail.mailCenter.listElem).find("#t"+a);f.length&&f.find("."+l.folName).text(c)},D=function(a){var b=!1,c=zmUtil.getMailObj(a);return g.fId&&!g.flag&&!g.label||"all"===g.view?b=!0:0!==c.NFG&&g.flag?"-1"!==g.flag&&g.flag!==c.NFG||(b=!0):c.TAG&&g.label&&("-1"!==g.label&&"-1"===$.inArray(g.label,c.TAG)||(b=!0)),b},E=function(a,b){a.length<99?b.text(a.length+1):b.text("99+")},F=function(a,b){1!==a.length&&(a.length<=100?b.text(a.length-1):b.text("99+"))},G=function(a){var b=a.parent("."+l.thdChild);b.prev().find("."+l.thdTreeCircle).remove(),b.prev().removeClass(l.thdTreeLine),b.remove()},H=function(){var a="";return a+=zmInit.isFlex?"":'<div class="zm_td"><div class="zm_tlb"></div></div>'},I=function(a,b,c){var d,e=D(a),f=$("#"+a),i=zmUtil.getMailObj(a),j=zmList.getViewBasedMsgList(i.T,g);if("zm_Container"!==zmTab.currentTab){if(j.length>1&&e){var k=$("#"+j[0]);d=k.parent().prev().find("."+l.tc),g.fId===b?E(j,d):g.fId===c&&(F(j,d),"1"===d.text()&&G(k))}else if(1===j.length)if(g.fId===i.FD){zmPrev.clsPreview(),$("#t"+j[0]).remove(),n("t"+i.T);var m=zmUtil.getListMap(g.fId);if(m)for(var o in m)m[o]===g.fId&&m.MO.splice(o,1)}else e&&(d=$("#t"+j[0]).find("."+l.tc),d.text(parseInt(d.text())+1),"2"===d.text()&&d.before(H()));f.remove()}else if(f.length&&e){d=f.parent().prev().find("."+l.tc);var p=0;F(j,d),p=parseInt(d.text()),1===p?G(f):p<1&&(f.parent().prev().remove(),f.parent().remove(),$(h.prevElem).hasClass("shw")&&i.T===zmUtil.getMailObj(zmPrev.prevDetails().msgId,"T")&&zmPrev.clsPreview()),f.remove()}else if(zmPrev.prevDetails().msgId&&i.T===zmUtil.getMailObj(zmPrev.prevDetails().msgId,"T"))if(d=$(zmail.mailCenter.listElem).find("."+l.sel+" ."+l.tc),j.length>1&&e)g.fId===b?E(j,d):g.fId===c&&F(j,d);else if(j.length<=1)if(g.fId===i.FD){$(zmail.mailCenter.listElem).find("."+l.sel).remove(),zmPrev.clsPreview(),n("t"+i.T);var q=zmUtil.getListMap(g.fId);if(q)for(var r in q)q[r]===g.fId&&q.MO.splice(r,1)}else e&&(d.text(parseInt(d.text())+1),"2"===d.text()&&d.before(H()))},J=function(a,b){var c=$("#"+a),d=a,e=c.parent("."+l.thdChild),f=zmUtil.getMailObj(a);if("msg"===b&&f.T&&zmInit.checkThreadRead(f.T)&&(c=A(a),c.length)){d=c[0].id,0===d.indexOf("t")&&(d=d.substring(1)),c.removeClass(l.unread),zmTab.currentTab.indexOf("zm_tabt")||"unread"!==g.view||zmPrev.isEntityOpenedInPreview(d)||(c.remove(),e=$("#thd"+d),e.remove());var h=zmUtil.getFolId();if(zmUtil.getListMap(h)){var i=zmUtil.getFirstMsgId(f.T,g);i&&(d=i)}p(d,1)}},K=function(a,b){var c,d=0,e=[],f=0,i=zmUtil.getMailObj(a);for(0===i.TC&&(i.TC=1),zmUtil.isFolderId(b)&&(i.FD=b),c=zmList.constructThreadChildRow(a),e=zmList.getMailSummaryList(g,i.T),f=0;f<e.length;f++){var j=zmUtil.getMailObj(e[f]);if(j.R<i.R){d=f;break}}$(h.listElem).find("#"+e[d]).before(c)},L=function(a,b){var c=$("#"+a),d=a,e=zmUtil.getMailObj(a);if("msg"===b&&e.T&&!zmInit.checkThreadRead(e.T)&&(c=A(a),c.length)){d=c[0].id,0===d.indexOf("t")&&(d=d.substring(1)),c.addClass(l.unread);var f=zmUtil.getFolId();if(zmUtil.getListMap(f)){var h=zmUtil.getFirstMsgId(e.T,g);h&&(d=h)}p(d,0)}},M=function(a,b,c){if(!b.preAction){var d,e,f,i,k,m,o=zmUtil.getMailObj(a);if(o.AR&&w(a,c),d=o.FD,e=b.folId,"notifier"!==b.from||d!==e||zmUtil.getFolId()!==e){if("msg"===c){if(i=$(zmail.mailCenter.listElem).find("#"+a),C(a,e),B(a,e),d===zmail.folId.tId||zmfolAction.isDeletedFolder(d)||d===zmail.folId.spId||e===zmail.folId.tId||zmfolAction.isDeletedFolder(e)||e===zmail.folId.spId)k=!0;else if(m=o.T,m&&zmUtil.getListMap(m)){var p=zmList.getMailSummaryList(g,m);if(p.length<=1&&b.mailId.indexOf(p[0])!==-1){var q=A(a);q.length&&q.remove(),G(i),$(h.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(a)}}o.T&&(1===j||2===j&&k)?I(a,e,o.FD):(f=zmUtil.getFolId(),("unread"!==f&&"all"!==f&&"flag"!==f&&!zmUtil.isLabelId(f)&&"search"!==f||e===zmail.folId.tId||zmfolAction.isDeletedFolder(e)||e===zmail.folId.spId)&&(o.T&&0!==j||i.remove())),o.T&&(""===g.fId||g.fId===e)&&D(a)&&K(a,e)}else if("thd"===c){i=$(zmail.mailCenter.listElem).find("#t"+a),i.length||(i=$(zmail.mailCenter.listElem).find("#"+a));var r,s,t=[],v=zmInit.findFolName(e);if(m=o.T,zmUtil.getListMap(m)&&(t=zmList.getViewBasedMsgList(m,g)),r=t.length,2===j&&g.fId&&g.fId!==e||1===j&&g.fId===d&&d!==e||e===zmail.folId.tId||"archive"===g.view||e===zmail.folId.spId)i.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove();else if(i.find("."+l.folName).text(v),2===j||!g.fId)for(s=0;s<r;s++)$(zmail.mailCenter.listElem).find("#"+t[s]+" ."+l.folName).text(v),$.publish("mail/move",[t[s],"msg",b]);n(a,c)}$.publish("mail/move",[a,"msg",b]),u(a,d,b,c),"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(o.T)?J(a,c):L(a,c))}}},N=function(a){var b=$(zmail.mailCenter.listElem).find("#"+a);b.remove()},O=function(b,c,d){if(d){if(d.preAction)return;d.from&&(a=d.from)}var e,f,i,k,m=zmUtil.getMailObj(b),n=m.FD;if(g=zmInit.getListingDetObj(),n&&$("#"+n+" .SC_ct").hasClass("SC_new")){var o="zmlTreeH",p={};p=zmail.mailLeft.getNodes()[0].getLayer(o),p.clearNew(n)}if("msg"===c){if(e=$(zmail.mailCenter.listElem).find("#"+b),e.removeClass(l.unread),f=e.parent("."+l.thdChild),"mail_preview"!==a||"mail_preview"===a&&!zmTab.currentTab.indexOf("zm_srch"))if("unread"===g.view&&("zm_Container"!==zmTab.currentTab||!$(h.prevElem).attr("data-mid")||$(h.prevElem).attr("data-mid")&&$(h.prevElem).attr("data-mid")!==b&&(!m.TH||m.TH&&m.T!==zmUtil.getMailObj($(h.prevElem).attr("data-mid"),"T")))){var q=m.T;if(q&&0!==j){if(1===zmList.getMailSummaryList(g,q).length&&!zmPrev.isEntityOpenedInPreview(b)){G(e);var r=zmCenterListing.mailObjectAPI.getViewParentOf("c"+b,"zm_Container");if(r){var s="t"+r.id;N(s)}}}else e.remove()}else f.hasClass(l.thdChild)&&(f.children("div").hasClass(l.unread)||f.prev().removeClass(l.unread));$("#zmHdrP"+b).find(".zmPT").removeClass("zm_urd"),$("#zmHdrT"+b).find(".zmPT").removeClass("zm_urd"),$("#zmHdrS"+b).find(".zmPT").removeClass("zm_urd")}else if("thd"===c)if(e=$(zmail.mailCenter.listElem).find("#t"+b),e.length||(e=$(zmail.mailCenter.listElem).find("#"+b)),f=$(zmail.mailCenter.listElem).find("#thd"+b),e.removeClass(l.unread),f.children("div").removeClass(l.unread),"unread"!==g.view||"click"===a||"zm_Container"===zmTab.currentTab&&$(h.prevElem).attr("data-mid")===b)for(i=zmList.getViewBasedMsgList(m.T,g),k=0;k<i.length;k++)$("#zmHdrP"+i[k]).find(".zmPT").removeClass("zm_urd"),$("#zmHdrT"+i[k]).find(".zmPT").removeClass("zm_urd"),$("#zmHdrS"+i[k]).find(".zmPT").removeClass("zm_urd"),$.publish("mail/read",[i[k],"msg"]);else e.remove(),f.remove();$.publish("mail/read",[b,"msg"]),x(b,c,d),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&J(b,c)},P=function(a,b,c){if(!c){var d,e,f,h,i=zmUtil.getMailObj(a);if("msg"===b){if(d=$(zmail.mailCenter.listElem).find("#"+a),d.addClass(l.unread),e=d.parent("."+l.thdChild).length?d.parent("."+l.thdChild):$(zmail.mailCenter.listElem).find("."+l.sel).next(),i.T&&0!==j&&e.children("div").hasClass(l.unread)&&(""===g.fId||""!==g.fId&&g.fId===i.FD)){var k,m;k=e.prev(),k.addClass(l.unread),k.length&&(m=k[0].id,0===m.indexOf("t")&&(m=m.substring(1)),p(m,0))}$("#zmHdrP"+a).find(".zmPT").addClass("zm_urd"),$("#zmHdrT"+a).find(".zmPT").addClass("zm_urd"),$("#zmHdrS"+a).find(".zmPT").addClass("zm_urd")}else if("thd"===b){d=$(zmail.mailCenter.listElem).find("#t"+a),d.length||(d=$(zmail.mailCenter.listElem).find("#"+a)),d.addClass(l.unread),$(zmail.mailCenter.listElem).find("#thd"+a).children("div").not(".zmsnt").addClass(l.unread),f=zmList.getViewBasedMsgList(i.T,g);var n;for(h=0;h<f.length;h++)n=zmUtil.getMailObj(f[h],"FD"),n!==zmail.folId.sId&&($("#zmHdrP"+f[h]).find(".zmPT").addClass("zm_urd"),$("#zmHdrT"+f[h]).find(".zmPT").addClass("zm_urd"),$("#zmHdrS"+f[h]).find(".zmPT").addClass("zm_urd"),$.publish("mail/unread",[f[h],"msg"]))}$.publish("mail/unread",[a,"msg"]),y(a,b),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&L(a,b)}},Q=function(a,b){var c,d=zmList.getMailSummaryList(g,zmUtil.getMailObj(a,"T")),e=0,f=$("#"+a);g.flag?e="-1"===g.flag&&"0"===b||"-1"!==g.flag&&g.flag!==b?0:1:g.label&&(e=b),0===e?f.length?(c=f.parent().prev().find("."+l.tc),F(d,c),"1"===c.text()&&G(f)):(c=$(zmail.mailCenter.listElem).find("."+l.sel+" ."+l.tc),F(d,c)):f.length?(c=f.parent().prev().find("."+l.tc),E(d,c)):(c=$(zmail.mailCenter.listElem).find("."+l.sel+" ."+l.tc),E(d,c),"2"===c.text()&&c.before(H()))},R=function ja(a,b,c,d){if(!d){var e,f,i,k,m,n=zmInit.flgClass(b),p="",s=zmUtil.getMailObj(a);if("msg"===c){if(e=$(zmail.mailCenter.listElem).find("#"+a),s.TH&&0!==j){if(f=A(a),f.length){p=f[0].id,p.indexOf("t")!==-1&&(p=p.substring(1));var t=zmUtil.getFolId();if(zmUtil.getListMap(t)){var u=zmUtil.getFirstMsgId(s.T,g);u&&(p=u)}}q(p,s.NFG,b),k=zmInit.getThdFlagvalue(p),i=zmInit.flgClass(k),f.find("."+l.flag).removeClass().addClass(i)}if($("#zmHdrP"+a+" ."+l.flag).removeClass().addClass(n),$("#zmHdrT"+a+" ."+l.flag).removeClass().addClass(n),$("#zmHdrS"+a+" ."+l.flag).removeClass().addClass(n),g.flag&&"0"===b)s.T?"-1"!==g.flag&&g.flag!==s.NFG||0===s.NFG||(m=zmList.getMailSummaryList(g,s.T),1===j||2===j?(Q(a,b),2===m.length?G(e):1===m.length&&f.length&&(f.remove(),$(h.prevElem).attr("data-mid")===p&&"lt"===$(h.prevElem).attr("data-ty")&&zmPrev.clsPreview()),e.remove()):2===j&&1===m.length&&(G(e),f.length&&(f.remove(),$(h.prevElem).attr("data-mid")===p&&"lt"===$(h.prevElem).attr("data-ty")&&zmPrev.clsPreview()))):(e.remove(),$(h.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()),e.find("."+l.flag).removeClass().addClass(n);else if(0===b)e.find("."+l.flag).removeClass().addClass(n);else{if(s.T){if(g.flag)if(m=zmList.getMailSummaryList(g,s.T),1===j||2===j)if(""===g.fId)if("-1"===g.flag&&"0"===s.NFG||g.flag===b&&s.NFG!==b){if(K(a,""),1===m.length)if($("#t"+m[0]).length)$("#t"+m[0]).find("."+l.tc).before(H());else if($(zmail.mailCenter.listElem).find("."+l.sel).length){var v=zmail.mailCenter.listElem;$(v).find("."+l.sel+" ."+l.tc).before(H())}Q(a,b)}else"-1"!==g.flag&&s.NFG!==b&&(2===m.length?G(e):1===m.length&&(e.parent().prev().remove(),e.parent().remove(),zmPrev.clsPreview()),Q(a,b),e.remove());else g.fId===s.FD&&("-1"===g.flag&&"0"===s.NFG||g.flag===b&&s.NFG!==b?(K(a,""),Q(a,b)):"-1"!==g.flag&&s.NFG===g.flag&&s.NFG!==b&&(Q(a,b),e.remove()));else 2===j&&1===m.length&&(""===g.fId&&"-1"!==g.flag&&s.NFG!==b||g.fId===s.FD&&"-1"!==g.flag&&s.NFG===g.flag&&s.NFG!==b)&&(G(e),f.length&&(f.remove(),$(h.prevElem).attr("data-mid")===p&&"lt"===$(h.prevElem).attr("data-ty")&&zmPrev.clsPreview()))}else g.flag&&"-1"!==g.flag&&s.NFG!==b&&e.remove();e.find("."+l.flag).removeClass().addClass(n)}o({mode:"upd",msgId:a,key:"NFG",val:b})}else if("thd"===c){var w,x,y;for(m=[],y=s.T,m=zmList.getViewBasedMsgList(y,g),w=m.length,x=0;x<w;x++)ja(m[x],b,"msg",d);e=$(zmail.mailCenter.listElem).find("#t"+a),e.length||(e=$(zmail.mailCenter.listElem).find("#"+a)),r(a,b),g.flag&&"0"===b?(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove(),$(h.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()):"0"===b?e.find("."+l.flag).removeClass().addClass(n):g.flag&&"-1"!==g.flag&&g.flag!==b?($(zmail.mailCenter.listElem).find("#thd"+a).remove(),e.remove(),$(h.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()):e.find("."+l.flag).removeClass().addClass(n)}$.publish("mail/flag",[a,"msg",b]),g.flag&&("-1"===g.flag&&"0"===b||"-1"!==g.flag&&b!==g.flag)&&zmCache.updateCacheForViews(a),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(s.T)?J(a,c):L(a,c))}},S=function ka(a,b,c){if(!b.preAction){var d,e,f,i,k,m,n=!1,p=zmUtil.getMailObj(a);if("msg"===c){d=$(zmail.mailCenter.listElem).find("#"+a);var q;if(p.TH&&0!==j){if(e=A(a),e.length){f=e[0].id,f.indexOf("t")!==-1&&(f=f.substring(1));var r=zmUtil.getFolId();if(zmUtil.getListMap(r)){var t=zmUtil.getFirstMsgId(p.T,g);t&&(f=t)}}s(f,[b.lId],b.lA)}if("add"===b.lA){if(p.TAG=p.TAG||[],k=p.TAG,p.T&&(1===j||2===j)&&g.label)if(q=$.inArray(b.lId,p.TAG),""===g.fId){if(g.label===b.lId&&q===-1){if(K(a,""),i=zmList.getMailSummaryList(g,p.T),1===i.length)if($("#t"+i[0]).length)$("#t"+i[0]).find("."+l.tc).before(H());else if($(zmail.mailCenter.listElem).find("."+l.sel).length){var u=$(zmail.mailCenter.listElem).find("."+l.sel+" ."+l.tc);u.before(H())}Q(a,1)}}else g.fId===p.FD&&("-1"===g.label&&0===p.TAG.length||g.label===b.lId&&q===-1)&&(K(a,""),Q(a,1));q=$.inArray(b.lId,k),q===-1&&p.TAG.push(b.lId)}else if("delete"===b.lA&&p.TAG){var v=p.TAG,w=v.length;p.T?(1===j||2===j&&g.fId===zmail.folId.tId)&&("-1"===g.label&&1===p.TAG.length||g.label===b.lId)&&(Q(a,0),i=zmList.getMailSummaryList(g,p.T),2===i.length?G(d):1===i.length&&(e.length&&(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+f).remove(),$(h.prevElem).attr("data-mid")===f&&"lt"===$(h.prevElem).attr("data-ty")&&("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[]))),n=!0,m=f)):(n=!0,m=a);var x;for(x=0;x<w;x++)if(b.lId===v[x]){p.TAG.splice(x,1);break}}else"deleteall"===b.lA&&p.TAG&&(p.T?(Q(a,"0"),g.label&&(i=zmList.getMailSummaryList(g,p.T),2===i.length?G(d):1===i.length&&(e=A(a),e.length&&(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+f).remove(),$(h.prevElem).attr("data-mid")===f&&"lt"===$(h.prevElem).attr("data-ty")&&("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[]))),n=!0,m=f))):(n=!0,m=a),p.TAG=[]);(g.label&&"deleteall"===b.lA||(g.label===b.lId||"-1"===g.label)&&"delete"===b.lA)&&(d.remove(),$(h.prevElem).attr("data-mid")!==a||p.T&&"th"!==$(h.prevElem).attr("data-ty")||("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[])))}else if("thd"===c){var y,z,B=p.T;i=[],i=zmList.getViewBasedMsgList(B,g);var C;for(z=0,y=i.length;z<y;z++)C=zmUtil.getMailObj(i[z]),("deleteall"===b.lA&&C.TAG||"add"===b.lA&&(!C.TAG||$.inArray(b.lId,C.TAG)===-1)||"delete"===b.lA&&$.inArray(b.lId,C.TAG>=0))&&ka(i[z],b,"msg");if(d=e=$(zmail.mailCenter.listElem).find("#t"+a),d.length||(d=e=$(zmail.mailCenter.listElem).find("#"+a)),s(a,[b.lId],b.lA),"add"===b.lA)p.TAG||(p.TAG=[]),k=p.TAG,$.inArray(b.lId,p.TAG)===-1&&k.push(b.lId);else if("delete"===b.lA&&p.TAG){var D,E=p.TAG,F=E.length;for(D=0;D<F;D++)if(b.lId===E[D]){p.TAG.splice(D,1);break}("-1"===g.label&&0===p.TAG.length||g.label===b.lId)&&($(zmail.mailCenter.listElem).find("#thd"+a).remove(),d.remove(),$(h.prevElem).attr("data-mid")===a&&zmPrev.clsPreview(),n=!0,m=a)}else"deleteall"===b.lA&&p.TAG&&($(zmail.mailCenter.listElem).find("#t"+a+" p").remove(),p.TAG=[]);g.label&&"deleteall"===b.lA&&(d.remove(),o({mode:"upd",msgId:a,key:"TAG",val:""}),$(h.prevElem).attr("data-mid")===a&&zmPrev.clsPreview(),n=!0,m=a)}n&&m&&zmCache.updateCacheForViews(m),zmPreviewTemplate.refreshLabelsForMail(a,e),$.publish("mail/label",[a,"msg",b]),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(p.T)?J(a,c):L(a,c))}},T=function(a,b,c,d){if(!d){var e,f,h=zmUtil.getMailObj(a);if("msg"===c)f=$(zmail.mailCenter.listElem).find("#"+a),C(a,zmail.folId.tId),B(a,zmail.folId.tId),h.T&&(h.FD===zmail.folId.dId&&zmUtil.removeDraftMapping(a),I(a,zmail.folId.tId,h.FD)),5!==b&&h.FD===zmail.folId.tId&&(b=5),g.fId===zmail.folId.tId&&h.FD!==zmail.folId.tId&&D(a)&&K(a,zmail.folId.tId),h.TH&&0!==j||f.remove(),$.publish("/mail/msgDiscarded",[{draftId:a,actionType:"discard_draft"}]),zmContentCache.remove(a);else if("thd"===c){var i,k,l=[];for(f=$(zmail.mailCenter.listElem).find("#t"+a),f.length||(f=$(zmail.mailCenter.listElem).find("#"+a)),l=zmList.getViewBasedMsgList(e,g),k=l.length,i=0;i<k;i++)$.publish("mail/delete",[l[i],"msg",b]);f.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove()}n(a,c),$.publish("mail/delete",[a,"msg",b]),z(a,c,b),"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(h.T)?J(a,c):L(a,c))}},U=function(a,b){var c,d,e,f,h=zmUtil.getMailObj(a);c=t(a,h.T,g),e=$(zmail.mailCenter.listElem).find("#"+a),f=Boolean(g.fId),d=e.length?e.parent().prev().find("."+l.tc):$(zmail.mailCenter.listElem).find("."+l.sel+" ."+l.tc),f&&("unarchive"===b&&1===h.AR||"archive"===b&&0===h.AR)&&(F(c,d),"1"===d.text()&&G(e))},V=function(a,b,c){if(!c){var d,e,f=!0,i=zmUtil.getMailObj(a),k=i.T;if("msg"===b){if(d=$(zmail.mailCenter.listElem).find("#"+a),d.addClass(l.archIndication),k&&zmUtil.getListMap(k)){var m=zmList.getMailSummaryList(g,k);if(m.length<=1&&a===m[0]){var o=A(a);o.length&&o.remove(),G(d),$(h.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(a),f=!1}}f&&i.TH&&0!==j&&U(a,"archive"),("archive"!==g.view&&g.fId||!g.fId&&"unread"===g.view)&&d.remove()}else"thd"===b&&(d=$(zmail.mailCenter.listElem).find("#t"+a),e=$(zmail.mailCenter.listElem).find("#thd"+a),d.addClass(l.archIndication),"archive"!==g.view&&""!==g.fId&&(d.remove(),e.remove()));n(a,b),$.publish("mail/archive",[a,"msg"]),v(a,b),C(a,i.FD),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(i.T)?J(a,b):L(a,b))}},W=function(a,b,c){if(!c){var d,e,f=!0,i=zmUtil.getMailObj(a),k=i.T;if("msg"===b){if(d=$(zmail.mailCenter.listElem).find("#"+a),d.removeClass(l.archIndication),k&&zmUtil.getListMap(k)){var m=zmList.getMailSummaryList(g,k);if(m.length<=1&&a===m[0]){var n=A(a);n.length&&n.remove(),G(d),$(h.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(a),f=!1}}f&&i.TH&&0!==j&&U(a,"unarchive"),"archive"===g.view&&d.remove()}else d=$(zmail.mailCenter.listElem).find("#t"+a),e=$(zmail.mailCenter.listElem).find("#thd"+a),d.removeClass(l.archIndication),"archive"===g.view&&(d.remove(),e.remove());$.publish("mail/unarchive",[a,"msg"]),w(a,b),C(a,i.FD),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(i.T)?J(a,b):L(a,b))}},X=function(a,b,c){if(!c){var d,e,f=zmUtil.getMailObj(a);if("msg"===b){if(d=f.FD,e=zmail.folId.spId,C(a,e),B(a,e),f.T&&0!==j&&I(a,e,d),f.TH&&0!==j||$(zmail.mailCenter.listElem).find("#"+a).remove(),o({mode:"move",msgId:a,rFrom:d,addTo:e,type:b}),0===f.S&&!f.AR){var h={action:"spam",src:d,dest:e};zmail.MailPreUtils.updateCount({fId:d,mode:"dec",actionObj:h}),zmail.MailPreUtils.updateCount({fId:e,mode:"inc",actionObj:h})}}else if("thd"===b){var i,k,l,m=[];for(d=f.FD,e=zmail.folId.spId,l=f.T,$("#t"+a).remove(),$("#thd"+a).remove(),zmPrev.clsPreview(),o({mode:"move",msgId:a,rFrom:d,addTo:e,type:b}),m=t(a,l,g),i=m.length,k=0;k<i;k++)o({mode:"upd",msgId:m[k],key:"FD",val:zmail.folId.spId})}n(a,b),"msg"===b&&zmPreviewTemplate.updateMailHeaderView(a),$.publish("mail/spam",[a,"msg"]),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(f.T)?J(a,b):L(a,b))}},Y=function(a,b,c){var d,e,f,i,k,l;if(d=zmail.folId.spId,b){e=b.length;var m=zmUtil.getMailObj(a);if("msg"===c){if(f=b[0].folId,i=b[0].detail.m,C(a,f),B(a,f),(1===j||2===j&&g.fId===zmail.folId.spId)&&m.T&&g.fId===d&&I(a,f,d),$(h.prevElem).attr("data-mid")!==a||0!==j&&m.T&&"th"!==$(h.prevElem).attr("data-ty")||zmPrev.clsPreview(),
(0===j||!m.TH||m.TH&&"unread"!==g.view)&&$(zmail.mailCenter.listElem).find("#"+a).remove(),o({mode:"move",msgId:a,rFrom:zmail.folId.spId,addTo:f,type:c}),0===m.S&&!m.AR){var n={action:"notspam",src:d,dest:f};zmail.MailPreUtils.updateCount({fId:d,mode:"dec",actionObj:n}),zmail.MailPreUtils.updateCount({fId:f,mode:"inc",actionObj:n})}}else{$("#t"+a).remove(),$("#thd"+a).remove(),zmPrev.clsPreview();var p;for(k=0;k<e;k++)for(f=b[0].folId,i=b[0].detail.m,o({mode:"insert",msgId:a,rt:m.R,folId:f,type:c}),l=0;l<i.length;l++)if(p=zmUtil.getMailObj(i[l]),p&&(o({mode:"upd",msgId:i[l],key:"FD",val:f}),0===p.S&&!p.AR)){var q={action:"notspam",src:d,dest:f};zmail.MailPreUtils.updateCount({fId:d,mode:"dec",actionObj:q}),zmail.MailPreUtils.updateCount({fId:f,mode:"inc",actionObj:q})}}"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),$.publish("mail/notspam",[a,"msg",b]),0!==j&&g.fId!==zmail.folId.tId&&g.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(m.T)?J(a,c):L(a,c))}},Z=function(a,b){zmUtil.hideMenu();var e={read:c.maillistopt.markread,unread:c.maillistopt.markunread,flag:d.common.flag,label:d.common.label,move:d.common.move,"delete":d.common["delete"],spam:c.maillistopt.markspam,notspam:c.maillistopt.notspam,archive:c.maillistopt.archive,unarchive:c.maillistopt.unarchive};if("success"===a.result)return zmUtil.succErrMsg("s",zmText.applyArgs(d.bulkaction.common.info,{actionname:e[b.action]})),void zmList.unchkAll()},_=function(a,b){var c,d,e,f,g,h,i=a.length,k=b.length,l=zmPrev.prevDetails().msgId,m=zmUtil.getMailObj(l),n=m&&m.TH&&j||0,o=!1,p=!1,q=!0;if((1===i&&0===k||0===i&&1===k)&&(d=i?a[0]:b[0],l===d&&(o=!0)),n&&i>0&&0===k){var r=m.T;for(g=0;g<i;g++)if(zmUtil.getMailObj(a[g],"T")!==r){q=!1;break}if(q)return}if(!o&&!p)for(g=0,e=i;g<e;g++)if(l===a[g]){p=!0;break}if(!o&&!p)for(c=zmInit.getListingDetObj(),g=0,e=k;!p&&g<e;g++){if(l===b[g]){p=!0;break}for(a=zmList.getMailSummaryList(c,zmUtil.getMailObj(b[g],"T")),h=0,f=a.length;h<f;h++)if(l===a[h]){p=!0;break}}o?zmPrev.updatePrevOnDeletion(d):p&&zmPrev.clsPreview()},aa=function(){var a=zmUtil.getFolId(),b=zmUtil.getListMap(a);if(b){var c=parseInt(zmail.mailOpt.range)||50,d=b.MO&&b.MO.length;d<c&&zmInit.fillMails(c)}},ba=function(){var a,b=[{id:"zm_Container",view:zmUtil.getFolId()},{id:"zm_srch1",view:"search"}],c=b.length,d=0;for(d=0;d<c;d++){var e,f,g,h=b[d].id,i=b[d].view;zmsuite.isWorkspaceAvailable(h)&&(g=zmsuite.getCenter(h)[0].getNodes()[2].$el,f=zmPrev.prevDetails(h),e=f.msgId,e&&0===g.find("."+k.cls.mRow+"."+l.sel).length&&(a=zmList.getDupThdRowId(e,i),a&&zmList.setMailSelection(a,"lt",g)))}},ca=function(a,b){var c,e,f,i,k,l,m,n=[];if(h=zmList.getElemObj(),"success"===a.result){var o=zmUtil.getMLConversionValue();if(zmUtil.hideMenu(),g=zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),j=g.fId===zmail.folId.sId&&0!==o?0:o,n.push(b.mailId),"unarchive"===b.action&&n.push(b.amailId),n.push(b.tmailId),f=n.length,b.source&&"popup"===b.source&&("move"===b.action||"delete"===b.action||"archive"===b.action&&("archive"!==g.view&&g.fId||!g.fId&&"unread"===g.view)||"unarchive"===b.action&&"archive"===g.view||"spam"===b.action)&&""!==zmPrev.prevDetails().msgId){var p=b.mailId||[],q=b.tmailId||[];_(p,q)}for(i=0;i<f;i++)for(c=n[i],k=0===i?"msg":"thd",e=c?c.length:0,l=0;l<e;l++)if(m=c[l],zmUtil.isMetaDataAvailable(m)){switch(b.action){case"move":M(m,b,k);break;case"delete":T(m,b.fT,k,b.preAction);break;case"archive":V(m,k,b.preAction);break;case"unarchive":W(m,k,b.preAction);break;case"spam":X(m,k,b.preAction);break;case"notspam":Y(m,a.desFol||b.resp.desFol,k)}"delete"!==b.action&&"spam"!==b.action&&zmList.stimulateToTabView(m,k,b)}if(a.count)for(var r in a.count){var s=a.count[r];for(var t in s)zmail.MailPreUtils.updateCount({fId:t,mode:"binc",count:parseInt(s[t])})}"mail"===b.from||zmTab.currentTab.indexOf("zm_tab")!==-1||!g.fId&&((g.fId||"unread"!==g.view)&&"search"!==g.view||"delete"!==b.action&&"move"!==b.action&&"archive"!==b.action&&"spam"!==b.action&&"notspam"!==b.action)||("notifier"!==b.from&&(zmList.unchkAll(),"move"===b.action&&zmUtil.succErrMsg("s",d.info.moveSuccess)),$(h.prevElem).attr("data-mid")&&$(".SC_Popn").length&&zmPrev.removeCountinPreview(h)),ba(),aa()}else{var u=d.common.errorprocessing;a.result?u=a.result:a.error&&(u=a.error),zmsDialog.alert(u)}$.publish("/maction/"+b.action)},da=function(a,b){var c,e,f,i,k,l,m,n=[];if(h=zmList.getElemObj(),"success"===a.result){"unread"===b.action&&b.tmailId.length>0&&$.publish("mail/updateRead",{resp:a,data:b,msgId:b.tmailId[0]});var o=zmTab.currentTab,p=zmUtil.getMLConversionValue();for(g=o.indexOf("zm_tab")?o.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),j=g.fId===zmail.folId.sId&&0!==p?0:p,n.push(b.mailId),n.push(b.tmailId),k=n.length,i=0;i<k;i++)for(e=0===i?"msg":"thd",f=0,l=n[i],l&&(f=l.length),m=0;m<f;m++)if(c=l[m],zmUtil.isMetaDataAvailable(c))switch(b.action){case"read":O(c,e,b);break;case"unread":P(c,e,b.preAction);break;case"flag":R(c,b.fVal,e,b.preAction);break;case"label":S(c,b,e);break;case"spam":X(c,e)}if("notifier"!==b.from&&"zm_Container"===o&&("read"===b.action&&"unread"===g.view||"flag"===b.action&&g.flag||"label"===b.action&&g.label)&&zmList.unchkAll(),a.count)for(var q in a.count){var r=a.count[q];for(var s in r)zmail.MailPreUtils.updateCount({fId:s,mode:"binc",count:parseInt(r[s])})}$(h.prevElem).attr("data-mid")&&$(".SC_Popn").length&&zmPrev.removeCountinPreview(h),ba(),aa()}else{var t=d.common.errorprocessing;a.result?t=a.result:a.error&&(t=a.error),zmsDialog.alert(t)}},ea=function(a,b,c){var d,e,f,i,j,k,l,m=[],n=[],o=[];for(n=c.mailId||c.amailId,o=c.tmailId,m.push(n),m.push(o),d=m.length,h=zmList.getElemObj(),("move"===a||"delete"===a||"archive"===a&&("archive"!==g.view&&g.fId||!g.fId&&"unread"===g.view)||"unarchive"===a&&"archive"===g.view||"spam"===a)&&""!==zmPrev.prevDetails("zm_Container").msgId&&_(n,o),e=0;e<d;e++)for(k=0===e?"msg":"thd",i=0,j=m[e],j&&(i=j.length),f=0;f<i;f++)switch(l=j[f],a){case"read":O(l,k);break;case"unread":P(l,k);break;case"flag":R(l,b.fA,k);break;case"label":c.preAction=!1,S(l,c,k);break;case"move":c.preAction=!1,M(l,c,k);break;case"delete":T(l,c.fT,k);break;case"archive":V(l,k);break;case"unarchive":W(l,k);break;case"spam":X(l,k)}},fa=function(a,b,c,e){var f=zmUtil.getMLConversionValue();if(b<2||2!==f)return void c();var g,h={msg_dontshow:d.convDialog.suppresstext,msg_mvact:d.convDialog.movefullthreadtotrash,msg_delact:d.convDialog.deletefullthread,msg_spamact:d.convDialog.markfullthreadspam,msg_mfwdact:d.info.fwdConversations,msg_cont:d.common["continue"],msg_multiplemail:d.convDialog.selectionThread,txt_ok:d.common.ok,txt_cancel:d.common.cancel,msg_folspec:d.convDialog.note,msg_selectiontext:d.convDialog.selectiontext,msg_actiontext:d.convDialog.actiontext.doyou,mail_folderspec:d.convDialog.folderwise,mail_acrossfolders:d.convDialog.acrossfolders,msg_rememberaction:d.convDialog.rememberselection,1:{msg_mvtotrashact:d.convDialog.movefullthreadtotrash,msg_delact:d.convDialog.deletefullthread,msg_spamact:d.convDialog.markfullthreadspam,msg_mvact:d.convDialog.markentireconv},2:{msg_mvtotrashact:d.convDialog.actiontext.movetotrash,msg_delact:d.convDialog.actiontext["delete"],msg_spamact:d.convDialog.actiontext.markasspam,msg_mvact:d.convDialog.actiontext.move}};switch(a){case"delete":g=h[f].msg_delact;break;case"trash":g=h[f].msg_mvtotrashact;break;case"spam":g=h[f].msg_spamact;break;case"multipleforward":g=h.msg_mfwdact;break;case"move":g=h[f].msg_mvact}var i,j,k,l,m,n,o;2===f&&(n="conv_conf",o=["DIV",{attrs:{id:n,style:"display:none;"},child:[["DIV",{attrs:{"class":"paraDiv"},child:[["text",h.msg_selectiontext],["BR",{}],["BR",{}],["text",g],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-option",value:"1"}}],["SPAN",{child:[["text",h.mail_folderspec]]}]]}],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-unoption",value:"2"}}],["SPAN",{child:[["text",h.mail_acrossfolders]]}]]}],["BR",{}],["DIV",{child:[["SPAN",{child:[["I",{attrs:{"class":"msi-uncheck"}}],["text",h.msg_rememberaction]]}]]}]]}]]}],i=_zm.getDOM(o),l=$("div.mail_opt",i),m=$("i",l),l.on("click",function(){m.removeClass().addClass("msi-unoption"),$(this).closest("div").find("i").removeClass().addClass("msi-option")})),j=$("i.msi-uncheck",i).closest("span").eq(0),k=$("i.msi-uncheck",i).eq(0),j.on("click",function(){k.toggleClass("msi-uncheck"),k.toggleClass("msi-check")});var p=function(){zmsDialog.remove()},q=function(){var a=$("i.msi-option",l).attr("value");if(k.hasClass("msi-check")){var b=zmAdHocSettings.getSuppressedMessagesState();b.conversationAction="off",zmAdHocSettings.setSuppressedMessagesState(b),2===f&&zmAdHocSettings.setConversationActionType(a)}setTimeout(function(){c(a)},0),p()},r={style:{width:"500px"},buttons:[{txt:h.txt_ok,callback:q,selected:!0},{txt:h.txt_cancel,callback:p,isCancel:!0}],mask:!0,hideclose:!1,pos:"center",title:d.convDialog.title,closeaction:function(){$("#"+n).remove()}};document.body.appendChild(i),zmsDialog.create(n,r)},ga=function(){var a,b=[],c=[],d=[],e="",f=[],g=[];d=zmUtil.getCheckedMailList(),f=d[0],g=d[1];var h,i=zmUtil.getMailObj(f[0],"R"),j=zmUtil.getMailObj(g[0],"R");for(f.length&&g.length?e=parseInt(i)>=parseInt(j)?parseInt(i):parseInt(j):f.length?e=parseInt(i):g.length&&(e=parseInt(j)),a=0;a<f.length&&(h=zmUtil.getMailObj(f[a],"R"),parseInt(h)===e);a++)b.push(f[a]);for(a=0;a<g.length&&(h=zmUtil.getMailObj(g[a],"R"),parseInt(h)===e);a++)b.push(g[a]);return{receivedTime:e,list:[b,c]}},ha=function(){$.subscribe("/mail/draftsaved",function(a,b){b=b||{},zmUtil.isInlineCompose()&&zmUtil.getMailContent(String(b.draftId),{reload:!0}),zmmailAct.updateDraftCountInUI(b.msgId,"save_draft","","zm_Container")})},ia={applyActions:function(b,c,d){var e,f,h,k,l,n,o,p,q=!0,r=[],s=zmUtil.getMLConversionValue(),t={};if(a=c,f={accId:zmail.accId,mode:"markas"},h={action:b},zmInit.listingBand.isBulkActionSet){var u=ga();n=u.list,f.mode="bulkaction",f.receivetime=u.receivedTime,zmTab.currentTab.indexOf("zm_srch")||(f=$.extend(f,zmSearchUtil.getRequestParams()))}else{var v=zmUtil.getCheckedMailCount(),w=300;if(n=zmUtil.getSelectedMails(),v>w)return}if(h.mailId=e=d&&d.msgId?d.msgId:n[0],l=d&&d.thd?d.thd:n[1],h.tmailId=l,zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?(g=zmInit.getListingDetObj(),t=zmList.selDetails.mListing||{}):(g=zmSearchUtil.getSearchViewDetails(),t=zmList.selDetails.sListing||{}):g=zmsuite.getCenterOuter().$el.data("data-detail"),j=g.fId===zmail.folId.sId||g.fId===zmail.folId.tId||g.fId===zmail.folId.spId?0:s,g.fId&&(f.viewfolId=g.fId,p=g.fId),(g.view||zmInit.listingBand.isBulkActionSet&&t.view)&&(f.view=g.view||t.view,p=g.view),(g.flag||zmInit.listingBand.isBulkActionSet&&t.flag)&&(f.flag=g.flag||t.flag,p="flag"),(g.label||zmInit.listingBand.isBulkActionSet&&t.label)&&(f.label=g.label||t.label,p=g.label),(g.attach||zmInit.listingBand.isBulkActionSet&&t.attach)&&(f.attach=g.attach||t.attach,p=g.attach),zmInit.listingBand.isBulkActionSet||(f.folderSpec=j),l&&l.length&&(r=zmUtil.getThreadIdArr(l)),"zm_Container"===zmTab.currentTab&&"unread"===p&&$(zmail.mailCenter.prevElem).hasClass("shw")&&r.length){var x,y=zmPrev.prevDetails(),z=y.msgId,A=-1,B=$.extend({},g),C=z&&zmUtil.getMailObj(z);if(x=C.T,A=r.indexOf(x),C.TH&&A!==-1){""===g.fId?B.view="all":B.view="";var D=zmList.getMailSummaryList(g,x);0===D.length&&(D=zmList.getMailSummaryList(B,x),e=e.concat(zmUtil.getListMap(x,"MO")),h.mailId=e,l.splice(A,1),h.tmailId=l)}}if((g.fId===zmail.folId.tId||g.fId===zmail.folId.dId||0===j)&&l&&l.length&&(e=e.concat(l),l=[],h.mailId=e,h.tmailId=[]),e&&e.length&&(k=zmmailAct.separateArchive(e),f.mailId=k[0].join(),f.mailId.length||(delete f.mailId,delete h.mailId),k[0].length>0&&zmUtil.isSharedFolder(g.fId)&&(f.shId=h.shId=zmUtil.getShareId(g.fId),zmail.opType[b]?f.opType=zmail.opType[b]:f.opType=0)),k&&k[1].length>0&&(h.amailId=k[1],f.amailId=k[1].join(),zmUtil.isSharedFolder(g.fId)&&(f.shId=h.shId=zmUtil.getShareId(g.fId),zmail.opType[b]?f.opType=zmail.opType[b]:f.opType=0)),l&&l.length&&(f.tmailId=r.join(),zmUtil.isSharedFolder(g.fId)&&(f.shId=h.shId=zmUtil.getShareId(g.fId),zmail.opType[b]?f.opType=zmail.opType[b]:f.opType=0)),f.todo=$.inArray(b,i),"flag"===b?(f.fA=d.fVal,h.fVal=d.fVal):"label"===b?(h.lA=d.lA,d.lId&&(f.lId=h.lId=d.lId),"add"===d.lA?(f.mailId&&f.mailId.length?o=zmmailAct.rmDuplicateLabel(f.mailId,d.lId,"msg"):(delete f.mailId,delete h.mailId),o&&o.length>0?(f.mailId=o.join(),f.lA=0):l&&l.length?(f.lA=0,q=!0):f.amailId&&f.amailId.length?(o=zmmailAct.rmDuplicateLabel(f.amailId,d.lId,"msg"),o&&o.length>0&&(f.amailId=o.join()),f.lA=0):(zmUtil.hideMenu(),q=!1)):"delete"===d.lA?f.lA=2:f.lA=3,"default"===d.accType&&(f.accId=zmail.defAccId)):f.todo===-1&&(q=!1),q&&"zmStreamsApp"!==zmTab.currentTab){var E=da;if(h.suppressWSNoti=!0,zmInit.listingBand.isBulkActionSet?(h.suppressWSNoti=!1,h.preAction=!1,E=Z):f.shId?h.preAction=!1:h.preAction=!0,m(f,h,E),h.preAction){var F=$.extend({},f),G=$.extend({},h);ea(b,F,G)}}},doActions:function(b,c,d){var e,h,k,l,n,o,p,q={accId:zmail.accId,mode:"moveto"},r={action:b,from:c},s=!0,t=[],u=zmUtil.getMLConversionValue(),v={};if(a=c,zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?(g=zmInit.getListingDetObj(),v=zmList.selDetails.mListing||{}):(g=zmSearchUtil.getSearchViewDetails(),v=zmList.selDetails.sListing||{}):g=zmsuite.getCenterOuter().$el.data("data-detail"),j=g.fId===zmail.folId.sId||g.fId===zmail.folId.tId||g.fId===zmail.folId.spId?0:u,"newm"!==b){if("sweep"===b){q.mode="bulkaction";var w=zmUtil.createSearchParams(d.senderList,g);q=$.extend(q,w),k=zmUtil.getSelectedMails(),k[0]=k[0].concat(k[1])||[];var x=zmUtil.getFolId(g);zmUtil.getListMap(x,"MO").length?q.receivetime=zmUtil.getMailObj(zmUtil.getListMap(x,"MO")[0],"R"):q.receivetime=zmUtil.getMailObj(k[0][0],"R"),"delete"===d.actionType?q.sA=0:"archive"===d.actionType&&(q.sA=1,$.publish("folder/archived",[g.fId])),r.action=d.actionType}else if(zmInit.listingBand.isBulkActionSet){var y=ga();k=y.list,q.mode="bulkaction",q.receivetime=y.receivedTime,zmTab.currentTab.indexOf("zm_srch")||(q=$.extend(q,zmSearchUtil.getRequestParams()))}else{var z=zmUtil.getCheckedMailCount(),A=300;if(k=zmUtil.getSelectedMails(),z>A)return}if(r.mailId=e=d&&d.msgId?d.msgId:k[0],l=d&&d.thd?d.thd:k[1],r.tmailId=l,"sweep"!==b){if(g.fId&&(q.viewfolId=g.fId,n=g.fId),(g.view||zmInit.listingBand.isBulkActionSet&&v.view)&&(q.view=g.view||v.view,n=g.view,"bulkaction"===q.mode&&!g.fId&&"search"===g.view)){var B=zmSearchUtil.getSearchedFolders()[0]||"";B&&(q.viewfolId=B)}(g.flag||zmInit.listingBand.isBulkActionSet&&v.flag)&&(q.flag=g.flag||v.flag,n="flag"),(g.label||zmInit.listingBand.isBulkActionSet&&v.label)&&(q.label=g.label||v.label,n=g.label),(g.attach||zmInit.listingBand.isBulkActionSet&&v.attach)&&(q.attach=g.attach||v.attach,n=g.attach)}if(l&&l.length&&(t=zmUtil.getThreadIdArr(l)),"zm_Container"===zmTab.currentTab&&"unread"===n&&$(zmail.mailCenter.prevElem).hasClass("shw")&&t.length){var C,D=zmPrev.prevDetails(),E=D.msgId,F=zmUtil.getMailObj(E),G=-1,H=$.extend({},g);if(C=F.T,G=t.indexOf(C),F.TH&&G!==-1){""===g.fId?H.view="all":H.view="";var I=zmList.getMailSummaryList(g,F.T);0===I.length&&(I=zmList.getMailSummaryList(H,F.T),e=e.concat(I),r.mailId=e,l.splice(G,1),r.tmailId=l)}}(g.fId===zmail.folId.dId||g.fId===zmail.folId.tId||0===j)&&l&&l.length&&(e=e.concat(l),l=[],r.mailId=e,r.tmailId=[]),e&&e.length&&(h=zmmailAct.separateArchive(e),q.mailId=h[0].join(),q.mailId.length||(delete q.mailId,delete r.mailId),h[0].length>0&&zmUtil.isSharedFolder(g.fId)&&(q.shId=r.shId=zmUtil.getShareId(g.fId),zmail.opType[b]?q.opType=zmail.opType[b]:q.opType=0)),h&&h[1].length>0&&(r.amailId=h[1],q.amailId=h[1].join(),zmUtil.isSharedFolder(g.fId)&&(q.shId=r.shId=zmUtil.getShareId(g.fId),zmail.opType[b]?q.opType=zmail.opType[b]:q.opType=0)),l&&l.length&&(q.tmailId=t.join(),zmUtil.isSharedFolder(g.fId)&&(q.shId=r.shId=zmUtil.getShareId(g.fId),zmail.opType[b]?q.opType=zmail.opType[b]:q.opType=0))}if(q.todo=$.inArray(b,i),"move"===b){var J,K;if(q.folId=r.folId=d.folId,q.mailId){for(J=q.mailId.toString().split(","),q.mailId="",K=0;K<J.length;K++)d.folId!==zmUtil.getMailObj(J[K],"FD")&&(0!==K&&""!==q.mailId&&(q.mailId+=","),q.mailId+=J[K]);q.mailId||delete q.mailId}if(q.tmailId&&1===j&&zmail.folCount[g.fId])for(J=l.toString().split(","),q.tmailId="",K=0;K<J.length;K++)p=zmUtil.getMailObj(J[K]),d.folId!==p.FD&&(0!==K&&""!==q.tmailId&&(q.tmailId+=","),q.tmailId+=p.T)}else if("delete"===b){var L=g.fId;"search"===g.view&&(L=zmSearchUtil.getSearchedFolders()[0]||""),L===zmail.folId.dId?q.fT=r.fT=1:L===zmail.folId.teId?q.fT=r.fT=2:L===zmail.folId.spId?q.fT=r.fT=4:L===zmail.folId.tId?q.fT=r.fT=5:L===zmail.folId.oId?q.fT=r.fT=6:q.fT=r.fT=0,p=zmUtil.getMailObj(q.mailId),q.mailId&&p&&p.FD===zmail.folId.dId&&(q.fT=r.fT=1)}else if("notspam"===b){var M,N;if(q.mailId){for(M=q.mailId.toString().split(","),N=0;N<M.length;N++)zmUtil.getMailObj(M[N],"FD")!==zmail.folId.spId&&M.splice(N,1);q.mailId=M.join()}}else q.todo===-1&&(q.todo=-1);var O=zmAdHocSettings.getSuppressedMessagesState();if(g.fId!==zmail.folId.dId&&g.fId!==zmail.folId.tId&&r.tmailId&&r.tmailId.length&&"on"===O.conversationAction&&(!d||!d.scac)){var P,Q;switch(b){case"delete":P=g.fId===zmail.folId.tId||g.fId===zmail.folId.spId?"delete":"trash";break;case"spam":case"move":P=b}if(d=d||{},d.scac=!0,P)return Q=(r.mailId&&r.mailId.length||0)+zmUtil.getTotalMailCountInThreads(r.tmailId)+(r.amailId&&r.amailId.length||0),void fa(P,Q,function(c){d.listingType=c,zmmailAct.doActions(b,a,d)},g)}if(q.mailId||q.tmailId||q.amailId||"newm"===b||(zmUtil.hideMenu(),s=!1),"bulkaction"!==q.mode&&(1===j||2===j&&n===zmail.folId.tId||n===zmail.folId.dId?q.folderSpec=1:q.folderSpec=j,o=d&&d.listingType?d.listingType:zmAdHocSettings.getConversationActionType(),2!==q.folderSpec||"delete"!==b&&"spam"!==b&&"move"!==b||(q.folderSpec=parseInt(o))),s){var R=ca;if(r.suppressWSNoti=!0,"bulkaction"===q.mode?(r.preAction=!1,R=Z,r.suppressWSNoti=!1):q.shId||"notspam"===b?r.preAction=!1:r.preAction=!0,d&&d.actionSrc&&(q.actionSrc=d.actionSrc),"moveto"===q.mode&&6===q.fT){var S,T,U,V=q.mailId.split(",");$.subscribe("mail/updateOutBox",function(a,b){var c=b.M.split(",");V.forEach(function(a){c.forEach(function(b){if(a===b)return zmsDialog.remove(),!1})})}),1===V?(T=zmUtil.getMailObj(q.mailId),S=0===T.SCO.OT?f.schedule:f.Recurred):(S="",V.forEach(function(a){T=zmUtil.getMailObj(a),U=0===T.SCO.OT?f.schedule:f.Recurred,0===S.trim().length?S=U:S!==U&&(S=f.schedule)})),zmsDialog.confirm(S,{onOk:function(){if(m(q,r,R),r.preAction){var a=$.extend({},q),c=$.extend({},r);ea(b,a,c)}}})}else if(m(q,r,R),r.preAction){var W=$.extend({},q),X=$.extend({},r);ea(b,W,X)}}},rmDuplicateLabel:function(a,b){for(var c,d,e,f=a.toString().split(","),g=f.length,h=[],i=0;i<g;i++){if(e=f[i],d=zmUtil.getMailObj(e,"TAG"),c=!1,d){var j;for(j=0;j<d.length;j++)if(d[j]===b){c=!0;break}}c||h.push(e)}return h},separateArchive:function(a){for(var b=[],c=[],d=a.length,e=0;e<d;e++)1===zmUtil.getMailObj(a[e],"AR")?c.push(a[e]):b.push(a[e]);return[b,c]},createCommentEntity:function(){var a={no_data:{code:0,message:b.publishcomment.error.maildatanotavlbl},no_mention:{code:1,message:b.publishcomment.error.userorgrouprequire},req_fail:{code:2,message:b.publishcomment.error.requestfail}};return function(b,c,d){var e=$.Deferred();return b=String(b||""),c=c||"",b?c&&c.length?zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:function(){e.resolve()},p:{mode:"createCommentEntity",messageID:b,shareWith:c,shareConversation:d},csr:"s",efn:function(){e.reject({error:a.req_fail})}}).fail(function(){e.reject({error:a.req_fail})}):e.reject({error:a.no_mention}):e.reject({error:a.no_data}),e.promise()}}(),retrieveComments:function(){var a={};return function(b){var c=$.Deferred();b||c.reject();var d="comments_"+b;return a[d]?c=a[d]:(a[d]=c,c.always(function(){a[d]=void 0,delete a[d]}),zmAjq.XHR({u:zmail.conPath+"/mailComments.do",p:{accId:zmail.accId,entityId:b,groupId:zmail.zuid,comments:!0,entityType:1},t:"post",fn:function(a){c.resolve(a)},efn:function(){c.reject()}})),c.promise()}}(),updateDraftCountInUI:function(a,b,d,e){var f,g,h=zmUtil.getMLConversionValue();if(""!==b&&void 0!==b&&0!==h)if(f=A(a,e),"discard_draft"===b)d?(g=d>1?d+" "+c.common.draftPlural:d+" "+c.common.draft,f.find("."+l.draft).html("<span>"+g+"</span>")):(f.find("."+l.draft).html(""),f.find("."+l.from).removeClass(l.hasDftCount));else if("save_draft"===b){var i=zmUtil.getMailObj(a);i&&!i.DMID&&(f.length&&(a=f.attr("id"),0===a.indexOf("t")&&(a=a.substring(1),i=zmUtil.getMailObj(a))),d=i.DC?i.DC+1:1,g=d>1?d+" "+c.common.draftPlural:d+" "+c.common.draft,f.find("."+l.draft).html("<span>"+g+"</span>"),f.find("."+l.from).addClass(l.hasDftCount))}},rapplyAction:da,rdoAction:ca,confThreadAction:fa,updateUnreadStatusforThd:p,updateFlagStatusforThd:q,setFlagStatusforThd:r,updateLabelsforThd:s};return ha(),ia}(),window.zmUrlAct=function(){var a={},b=["folder","share","tags","views","all"],c=["view_unread","view_archive","view_all","flag_all","flag_1","flag_2","flag_3","label_all","label","view_attach","attach_1"],d={},e={},f={prev:[],curr:[]},g=function(){zmInit.lPageType()?f.curr=["folder","inbox"]:f.curr=["views","unread"]},h=function(a){f.curr.length&&(f.prev=f.curr),f.curr=a},i=function(a){var b=[];if(a.viewId)if(a.viewId&&"-1"===a.viewId)"label"===a.view?b.push("tags"):b.push(a.view),b.push("all");else{if(!a.viewId||"-1"===a.viewId)return!1;"label"===a.view?b.push("tags"):"attach"===a.view?b.push("attach"):b.push(a.view),b.push(a.viewId)}else"all"===a.view?b=[]:(b.push("view"),b.push(a.view));return b},j=function(a,b){a.length||(a=f.curr());for(var c=b.length,d=0;d<c;d++)if(a.indexOf(b[d])!==-1){a=a.slice(0,a.indexOf(b[d]));break}return a},k=function(){var a=zmail.mailLeft.selLayerId,c="";return"zmlTreeH"===a?c=b[0]:"zmlSTreeH"===a?c=b[1]:"zmllabelH"===a?c=b[2]:"zmlviewH"===a&&(c=b[3]),c},l=function(a){var b="",c="";if(a===zmail.folId.iId||"inbox"===a)b+="inbox",c=zmail.folId.iId;else if(a===zmail.folId.dId||"drafts"===a)b+="drafts",c=zmail.folId.dId;else if(a===zmail.folId.spId||"spam"===a)b+="spam",c=zmail.folId.spId;else if(a===zmail.folId.teId||"templates"===a)b+="templates",c=zmail.folId.teId;else if(a===zmail.folId.sId||"sent"===a)b+="sent",c=zmail.folId.sId;else if(a===zmail.folId.tId||"trash"===a)b+="trash",c=zmail.folId.tId;else if(a===zmail.folId.oId||"outbox"===a)b+="outbox",c=zmail.folId.oId;else if("unread"===a||"zm_unread"===a)b+="unread",c="zm_unread";else if("all"===a||"zm_all"===a)b+="all",c="zm_all";else if("flag"===a||"flagged"===a||"zm_flag"===a)b+="flagged",c="zm_flag";else if(/^\+?(0|[1-9]\d*)$/.test(a)){if(!(zmUtil.isFolderId(a)||zmUtil.isSharedFolder(a)||zmUtil.isLabelId(a)||zmUtil.isViewId(a)))return{folId:!1};b+=a,c=a}return{hashTxt:b,folId:c}},m=function(a){var b=[],c="",d="";return c=k(),d=l(a),b.push(c),b.push(d.hashTxt),{hashTxt:b,folId:d.folId}};a.update=function(a){var b,c,d,e=zmsuite.getAppRouter("zm_Container");if(b=a.from?a.from:a.folId&&!a.view||a.view&&a.folId===a.viewId||a.folId&&"zm"===a.folId.substring(0,2)?"zmLeft":"dropMenu","zmLeft"===b){var g=m(a.folId);c=g.hashTxt}else if("dropMenu"===b){var k=i(a);d=f.curr;var l=["view","tags","flag","attach","p"];d.length>2&&(d=j(d,l)),c=d.concat(k)}else{if("zmCenter"!==b)return;var n=function(){var b=zmail.folId,c=zmUtil.getFolId();if(c!==b.teId&&c!==b.oId&&c!==b.dId&&(0===a.opentype||4===a.opentype)){var d=a.msgId;return"t"===d.charAt(0)&&(d=d.substring(1)),"th"===a.type&&(d=zmCenterListing.mailObjectAPI.getViewParentOf("c"+a.msgId).id),d}};if(d=f.curr,d.length>2&&(d=j(d,["p"])),a.remove)c=d;else{var o=n();c=o?d.concat(["p",o]):d}}c.toString()!==f.curr.toString()&&(h(c),e.setParams(c),e.update())};var n=function(a){var f,g,h={};h[0]=function(a){if(!a[0]||!a[1])return!1;if(b.indexOf(a[0])!==-1){var c=l(a[1]);return!!c.folId&&(d.fId=c.folId,!0)}return!1},h[1]=function(a){var b;return"tags"===a[0]&&(a[0]="label"),b="label"===a[0]&&"all"!==a[1]?a[0]:a[0]+"_"+a[1],c.indexOf(b)!==-1&&("view"===a[0]?"all"!==a[1]&&(d.view=a[1]):(d.view=a[0],"all"!==a[1]?d.viewId=a[1]:d.viewId=-1),!0)},h[2]=function(a){var b;return"p"===a[0]&&(b="t"===a[1].charAt(0)?a[1].substring(1):a[1],!!/^\+?(0|[1-9]\d*)$/.test(b)&&(e.msgId=a[1],e.type="lt",e.opentype=4===zmail.mailOpt.isPopup?4:0,!0))};for(var i=0;i<a.length;i+=2)if(g=i/2,2===i&&"p"===a[i]&&(g=i),f=h[g]([a[i],a[i+1]]),!f)return!1;return!0},o=function(a){d={},e={};var b=function(b){var c=a.toString();return b=c.toLowerCase(),b=b.split(",")},c=function(){var b,c,d,e;return!f.curr.length||(d=f.curr.indexOf("p")===-1?f.curr.length:f.curr.indexOf("p"),e=a.indexOf("p")===-1?a.length:a.indexOf("p"),b=f.curr.slice(0,d),c=a.slice(0,e),b.toString()!==c.toString())},g=function(){var b;b="t"===e.msgId.charAt(0)?e.msgId.substring(1):e.msgId,zmList.getMailObj(b)&&($(zmail.mailCenter.listElem).find("#"+b).length||$(zmail.mailCenter.listElem).find("#t"+b).length)?zmList.showMailPreview(e):(zmsuite.isMaxLimitReached()||zmList.getMailData({msgId:e.msgId,opentype:2,type:"lt",src:"external"}),a=f.curr.length?f.curr:a.slice(0,a.indexOf("p")))};if(a=b(a),n(a)){if(d.fId)if("m"!==zmApp.currentApp&&zmApp.showApp("m"),"zm_Container"!==zmTab.currentTab&&zmsuite.showExistingApp("zm_Container"),c()||zmail.onDemandListing&&!zmail.initialListingLoaded)if(zmail.initialListingLoaded=!0,e.msgId){var h=$.Deferred();zmList.showMailListing(d,{retainPreview:!1,sortAscending:void 0,mlDefObj:h}),$.when(h).done(function(){g()})}else zmList.showMailListing(d);else e.msgId?g():zmPrev.prevDetails().msgId&&zmPrev.clsPreview();return!0}return!1},p=function(a){var b="lt",c=function(){var c=zmList.getMailObj(a);c&&c.TH&&(b="th"),zmList.getMailData({msgId:a,opentype:2,type:b,src:"external"})},d=function(){a=a.substring(1),zmList.getMailData({msgId:a,opentype:2,type:b,src:"external",tId:a})};"t"!==a.charAt(0)?c():d()},q=function(a){return a.length?1===a.length&&("inbox"===a[0]?a.unshift("folder"):"unread"===a[0]&&a.unshift("views")):1===zmInit.lPageType()?(a.push("folder"),a.push("inbox")):(a.push("views"),a.push("unread")),a};return a.manualHandler=function(a){var b=!1;a=q(a);var c={tab:{handler:function(a){zmsuite.isMaxLimitReached()||(p(a[1]),b=!0)}},"switch":{handler:function(a){var c=a[1];c&&zmail.aInfo[c]&&(zmUtil.switchAccount(c),b=!0)}}};return a[0]in c?(c[a[0]].handler(a),{updateParams:b,defaultAction:!1}):{updateParams:o(a)}},a.getZmLayers=function(){return b},a.init=g,a}(),window.zmRestore=function(){var a={},b="zm_Container",c=["listing","expandThd","preview","tab"],d=ZMail.lConstants,e=d.cls,f=function(){return"restore"===zmAdHocSettings.getLPageType()};a.saveState=function(a,d){if(f()){if(c.indexOf(a)===-1)return;var e=zmsuite.getAppObj(b).obj.stateData.data;"listing"===a?e.listing.view=d:"expandThd"===a?e.listing.expand=d:"preview"===a&&(e.preview=d),zmState.sendRequestToSaveState()}},a.restoreTabs=function(a){a.app&&a.category&&$.publish(a.app+"/"+a.category,[a])};var g=function(a){if(a){var c=zmList.getMailObj(a);if(c){var d;c.TH&&(d=zmCenterListing.mailObjectAPI.getViewParentOf("c"+a)),c.TH&&zmUtil.getFolId()!==zmail.folId.sId&&zmUtil.getMLConversionValue()&&d&&d.id===a?zmUtil.initScroll(zmsuite.getCenter(b)[0].getNodes()[2].$el,"t"+a,"t"+a):zmUtil.initScroll(zmsuite.getCenter(b)[0].getNodes()[2].$el,a,a)}}},h=function(a,c){if(a){var d=$.Deferred();if($.when(d).done(function(){zmPrev.prevDetails(b).msgId&&g(a),c&&c.deferred.resolve()}),zmList.getMailObj(a)&&($(zmail.mailCenter.listElem).find("#"+a).length||$(zmail.mailCenter.listElem).find("#t"+a).length)){var e=$("#"+a).attr("data-ty")||$("#t"+a).attr("data-ty"),f={msgId:a,type:e,opentype:zmail.mailOpt.isPopup},h=zmList.getListingElemObj(f);zmList.showMailPreview({msgId:a,opentype:4===zmail.mailOpt.isPopup?4:0,type:e,tabId:b},h,void 0,d)}else zmsuite.isMaxLimitReached()||zmList.getMailData({msgId:a,opentype:2,type:"lt",src:"external"},void 0,d)}},i=function(a,b){var c=$(zmail.mailCenter.listElem).find("#t"+a);if(!c.length)return void(b&&b.resolve());var d=$("#t"+a).attr("data-ty"),f={msgId:a,type:d,opentype:zmail.mailOpt.isPopup},g=zmList.getListingElemObj(f),h=$(c).find("."+e.tc),i=$(h);g.rowElem=$(h).closest("."+e.mRow),zmList.showHideThread(i,g,void 0,b)},j=function(a){var b=a.listing.view.fId,c=a.listing.view.view,d=a.listing.view.viewId;return!(b===zmail.folId.iId&&zmInit.lPageType()&&""===c&&""===d||"zm_unread"===b&&!zmInit.lPageType()&&"unread"===c&&""===d)};return $.subscribe("/mail/switchAccount",function(a,c){var d=zmsuite.getAppObj(b).obj.stateData.data;d.accId=c}),a.restoreMailApp=function(a,b){try{var c=a.accId;if(zmail.accId!==c||zmail.onDemandListing)b.deferred.resolve();else{var d=$.Deferred();$.when(d).done(function(){var c=$.Deferred();a.listing.expand.mId?i(a.listing.expand.mId,c):c.resolve(),$.when(c).done(function(){window.setTimeout(function(){a.preview.p?h(a.preview.p,b):b.deferred.resolve()},400)})}),j(a)?zmList.showMailListing(a.listing.view,{retainPreview:!1,sortAscending:void 0,mlDefObj:d}):d.resolve()}}catch(e){b.deferred.resolve()}},a.expandThread=i,a.restorePreview=h,a}(),function(){var a,b=zmail.Core.Namespaces,c=b.create("zmContentCache"),d=function(){var b={type:"MFU",keyParam:"msgId",requestURI:"md.do",requestType:"POST",beforeAdd:zmContentCache.processResponse,maxSize:200};a=new zmail.Components.ContentCache.ContentCacheComp(b)},e=function(a,b){return zmUtil.isChildWindow()?zmWindow.addinList(a,b):zmCache.dolistObj(a,b)};c.get=function(b){return zmail.prevMails[b]?zmail.prevMails[b].data.mdata:a.getCacheLib().get(b)||{}},c.fetch=function(b){if(b.p&&!b.p.msgId)zmAjq.XHR(b);else{var c=!!b.ep&&b.ep.avoidCache,d=!!b.ep&&b.ep.forceFetch;b.avoidCache=c,b.forceFetch=d,$.when(a.get(b)).then(function(a){b.fn&&b.fn(a,b.ep)})}},c.remove=function(a){zmail.mailContainer&&zmail.mailContainer.getObject(a)&&zmail.mailContainer.removeObject(a)},c.isCached=function(b){try{return!!zmail.prevMails[b]||!!a.getCacheLib().hasKey(b)}catch(c){return!1}},c.processResponse=function(a,b,c){var d;if("CID"!==b){if(a.mdata?(d=a.mdata.MSGID,b&&b!==d&&c&&c.updateKey&&(b=d,c.updateKey(d))):(d=b,a=a[d]?{mdata:a[d]}:{mdata:a},a.mdata.MSGID=d),a.mdata&&(a.comment&&(a.mdata.comment=a.comment,a.mdata.sharedUsers=a.sharedUsers,a.mdata.metadata=a.metadata),zmContentCache.remove(d),zmUtil.prevCache(d,a)),a.tdata&&a.tdata.length){var f=a.tdata[0].T;f&&(!zmUtil.getListMap(f)||zmUtil.isInlineCompose()||a.streamsMail)&&(zmUtil.createListMap(f,e(f,a.tdata)),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(f))}if(a.ddata){var g,h,i=a.ddata,j=i.length,k=0;for(k=0;k<j;k++)g=i[k].draftId,h=i[k].content,zmContentCache.isCached(g)&&zmContentCache.remove(g),zmUtil.prevCache(g,{mdata:h})}return a.mdata}},c.getCacheStore=function(){return a},c.getCacheLib=function(){return a.getCacheLib()},c.populateMailData=function(a,b){var c=b.msgId,d=b.thId;c&&!a.mdata&&(a.mdata=zmContentCache.get(c),a.mdata.comment&&(a.comment=a.mdata.comment),a.mdata.sharedUsers&&(a.sharedUsers=a.mdata.sharedUsers));var e=zmUtil.getListMap(d);if(d&&!a.tdata&&e){var f,g=e.MO?e.MO.length:0,h=0;for(h=0;h<g;h++)f=zmList.getMailObj(e.MO[h]),f&&a.tdata.push(f)}},c["delete"]=function(b){a.remove(b)},d()}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmail.MailPreUtils");b.updateCount=function(a){var b=a.fId,c=a.mode,d=a.count,e=a.actionObj,f=a.isHighlight,g=a.state,h=!1;if(!zmUtil.isSharedFolder(b)&&b!==zmail.folId.sId&&b!==zmail.folId.dId){if(e){var i=e.src,j=e.dest,k=e.action,l=["move","spam","notspam","delete"],m=[zmail.folId.spId,zmail.folId.tId,zmail.folId.sId];k&&l.indexOf(k)!==-1&&(m.indexOf(b)===-1||b!==i&&b!==j||(h=!0))}else h=!0;var n,o="zmlTreeH",p={};p=zmail.mailLeft.getNodes()[0].getLayer(o),p.updateCount(b,c,d,f,!0,{state:g}),h&&(n=zmInit.getUnreadViewCount(),o="zmlviewH",p=zmail.mailLeft.getNodes()[0].getLayer(o),
p.updateCount("zm_unread","upd",n),zmUtil.updateCountForAcc(zmail.accId,"upd",n));var q=zmInit.getListingDetObj();(q.fId||"unread"===q.view&&h)&&zmInit.updateHeaderBand("notification"),zmWinTitle.updateTitle(),(!a.info||a.info&&"mail_preview"!==a.info.from)&&$.publish("mail/folder/countUpdated",{fId:b})}}}();
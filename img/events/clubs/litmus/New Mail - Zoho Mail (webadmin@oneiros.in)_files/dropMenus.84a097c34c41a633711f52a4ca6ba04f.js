"use strict";define([],function(a,b){var c=a("zmText"),d=a("zmUtil"),e=a("zmInit"),f=a("zmWindow"),g=a("zmail.Core.Namespaces"),h=a("zmail.Utils.DOM"),i=g.create("zmDrop"),j=c.get("dropMenus"),k=function(b,c){var e,f=a("zmComp"),g=!1;b&&"inline"===b&&(g=!0),c&&(e=c.cmpId);var h=[],i={htm:j.send};i.data={},i.data.action="s",g&&(i.data.cmpId=e);var k={htm:j.sendNow};k.data={},k.data.action="si",g&&(k.data.cmpId=e),h.push(i,k);var l={list:h,clk:function(a){var b=a.action,c=a.cmpId;"s"===b?(f.sendMail({action:"compose",cmpId:c}),d.hideMenu()):"si"===b&&(f.sendMail({action:"compose",sendIm:!0,cmpId:c}),d.hideMenu())}};return l},l=function(){var b=a("zmComposeTemplates"),c=a("zmComp"),d=$(b.getTemplate("schPop")),e=$(b.getTemplate("sendLater")),f=$(b.getTemplate("recBand")),g=$(b.getTemplate("recChild"));return d.find("tbody").append(e,f,g),c.bindScheduleEvents({parentElement:d,scheduleElement:e,recurringBand:f,recurringChild:g}),d},m=function(){var b=a("zmComp"),c=b.getCurrentCompId(),e={list:[{htm:j.draft,data:{action:"sdraft",cmpId:c}},{htm:j.template,data:{action:"stemplate",cmpId:c}}],clk:function(a){var c=a.action,e=a.cmpId,f={cmpId:e};switch(c){case"sdraft":f.action="sdraft",b.sendMail(f),d.hideMenu();break;case"stemplate":f.action="stemplate",b.sendMail(f),d.hideMenu()}}};return e},n=function(b){var c,e,f=a("zmComp"),g=a("zmCUtil"),h=f.getCurrentCompId(),i="",k="",l="",m={},n="";c="msi-tick",e=f.getPriority(f.getCurrentCompId());var o=f.getAskReceipt(h);return"yes"===o&&(n=c),"High"===e?i=c:"Low"===e?l=c:k=c,m={list:[{htm:"<b> "+j.priority+" : </b>",nohover:"nohr"},{htm:"<i class='msi-none "+i+"'></i>"+j.high,data:{action:"h",par:b}},{htm:"<i class='msi-none "+k+"'></i>"+j.medium,data:{action:"m",par:b}},{htm:"<i class='msi-none "+l+"'></i>"+j.low,data:{action:"l",par:b}},{sep:!0},{htm:"<b>"+j.insert+" : </b>",nohover:"nohr"},{htm:j.template,data:{action:"insTemplate",cmpId:h}},{htm:j.signature,data:{action:"sig",cmpId:h}},{sep:!0},{htm:j.encoding+"<i class='msi-rarrow'></i>",childCls:"SC_tin",child:function(){return g.compLst("encod",h)}},{sep:!0},{htm:"<i class='"+n+"'></i>"+j.askreceipt,data:{action:"askReceipt",par:o}}],clk:function(a){var b=a.action,c=a.cmpId,e=a.par,h={cmpId:c};switch(b){case"sdraft":h.action="sdraft",f.sendMail(h),d.hideMenu();break;case"stemplate":h.action="stemplate",f.sendMail(h),d.hideMenu();break;case"insTemplate":g.insTemplate(c),d.hideMenu();break;case"sig":g.insSign(c),d.hideMenu();break;case"h":g.chgPriority("h",e),d.hideMenu();break;case"m":g.chgPriority("m",e),d.hideMenu();break;case"l":g.chgPriority("l",e),d.hideMenu();break;case"askReceipt":g.askRepChk(e,f.getCurrentCompId()),d.hideMenu()}}}},o=function(b){var c=a("zmComp"),e={},f=c.getCurrentCompId();return e.list=[{htm:j.draft,data:{action:"d",par:b}},{htm:j.template,data:{action:"t",par:b}}],e.clk=function(a,b){var e,g=a.action;switch(g){case"d":e={action:"sdraft",cmpId:f},c.sendMail(e),d.hideMenu();break;case"t":e={action:"stemplate",cmpId:f},c.sendMail(e),d.hideMenu()}},e},p=function(b){var c,e,f=a("zmComp"),g=a("zmCUtil"),h="",i="",k="",l={};return c="msi-tick",e=f.getPriority(f.getCurrentCompId()),"High"===e?h=c:"Low"===e?k=c:i=c,l.list=[{htm:"<i class='msi-none "+h+"'></i>"+j.high,data:{action:"h",par:b}},{htm:"<i class='msi-none "+i+"'></i>"+j.medium,data:{action:"m",par:b}},{htm:"<i class='msi-none "+k+"'></i>"+j.low,data:{action:"l",par:b}}],l.clk=function(a,b){var c=a.action,e=a.par;switch(c){case"h":g.chgPriority("h",e),d.hideMenu();break;case"m":g.chgPriority("m",e),d.hideMenu();break;case"l":g.chgPriority("l",e),d.hideMenu()}},l},q=function(){var b,c=a("zmList"),f=[],g={date:"",size:""},h="<i class='msi-tick'></i>";return"s"===zmail.viewInfo[0].DT&&(g.date=h),"s"===zmail.viewInfo[0].SZ&&(g.size=h),b=e.getListingDetObj(),f=b.fId===zmail.folId.oId?[{htm:g.date+j.date,clk:function(){c.changeViewColumns("DT"),d.hideMenu()}}]:[{htm:g.date+j.date,clk:function(){c.changeViewColumns("DT"),d.hideMenu()}},{htm:g.size+j.size,clk:function(){c.changeViewColumns("SZ"),d.hideMenu()}}]},r=function(){var b,c=a("zmApp"),e=[],f=0;if(_zm.isSmartComposeEnabled()&&(e.push({htm:j.smartCompose,data:{action:"smartdialog"}}),f=1),e.push({htm:j.composemail,data:{action:"mail"}},{htm:j.createnote,data:{action:"note"}},{htm:j.createtask,data:{action:"task"}},{htm:j.createevent,data:{action:"event"}},{htm:j.createcontact,data:{action:"contact"}},{htm:j.createlink,data:{action:"link"}}),zmail.fromOtherService){var g=_zm.isSmartComposeEnabled()?1:0;"workerly"===zmail.fromService||"recruit"===zmail.fromService?"m"===c.currentApp?e=[e[3+g],e[4+g]]:"c"===c.currentApp?e=[e[0+g],e[4+g]]:"cn"===c.currentApp&&(e=[e[0+g],e[3+g]]):"crm"===zmail.fromService&&("m"===c.currentApp?e=[e[3+g]]:"cn"===c.currentApp&&(e=[e[0+g]]))}return zmail.showFeature&&e.push({htm:"Quick Compose",data:{action:"cmpdialog"}}),zmail.fromOtherService||("m"===c.currentApp?e.splice(0,1):"n"===c.currentApp?e.splice(f+1,1):"t"===c.currentApp?e.splice(f+2,1):"c"===c.currentApp?e.splice(f+3,1):"cn"===c.currentApp?e.splice(f+4,1):"l"===c.currentApp&&e.splice(f+5,1)),b=function(b){var e=a("zmcontact"),f=b.action;d.hideMenu(),"mail"===f?d.compose():"note"===f?d.loadNotes("popup"):"task"===f?d.loadTask({action:"addCTask",groupId:zmail.zuid}):"event"===f?c.loadCalendar("/calendar/event"):"contact"===f?e.showQuickCreate():"cmpdialog"===f?d.cmpDialog():"link"===f?d.loadLink({mode:"create",groupId:zmail.zuid,catid:""}):"smartdialog"===f&&d.loadSmartCompose({eType:"6",type:"tab"})},{list:e,clk:b}},s=function(b,c){var d,e=zmail.labInfo,f=[],g=0,h={};d="action"===c?b:"listview","flag"===b&&(e={1:{dispName:j.info,id:"1",seq:0},2:{dispName:j.important,id:"2",seq:1},3:{dispName:j.followup,id:"3",seq:2}},"action"===c&&(e[0]={dispName:j.clearflag,id:"0",seq:3}));var i=function(){return function(b,c){a("zmList").bindAction(b,c)}};for(var k in e)h={},"flag"===b?(h.fVal=e[k].id,g=e[k].seq):(h.lId=e[k].id,h.lA="add",h.disp=e[k].dispName),h.action=d,"view"===c&&(h.clk=i(),h.view=b,h.viewId=k),f[g]={htm:e[k].dispName,data:h},g++;return"label"===b&&"action"===c&&(0===g&&(f[g++]={htm:j.notagsfound}),f[g++]={sep:!0},h={lA:"deleteall",action:b},f[g++]={htm:j.cleartag,data:h}),f},t=function(b){var c={};return c.divId="zm_dropflag","view"===b?c.list=s("flag","view"):"action"===b&&(c.list=s("flag","action")),c.align="cleft",c.clk=function(b,c){a("zmList").bindAction(b,c)},c},u=function(b){var c=a("zmList"),d={};return d.divId="zm_dropflag","view"===b?d.list=s("label","view"):"action"===b&&(d.list=s("label","action")),d.align="cleft",d.clk=function(a,b){c.bindAction(a,b)},d},v=[{htm:j.markfolderread,data:{action:"folread"}},{htm:j.sweep,data:{action:"sweep"}}],w=[{htm:j.markasread,data:{action:"read",from:"dropdown"}},{htm:j.markasunread,data:{action:"unread",from:"dropdown"}},{htm:j.flagas+" <i class='msi-rarrow'></i>",data:{action:"flaglist",from:"dropdown"},child:function(){return d.isChildWindow()?f.getFlagMenu():t("action")},align:"cleft"},{htm:j.markspam,data:{action:"spam",from:"dropdown"}},{htm:j.marknotspam,data:{action:"notspam",from:"dropdown"}},{htm:j.forwardasinline,data:{action:"forward",from:"dropdown"}},{htm:j.forwardasattachment,data:{action:"FwdAttach"}},{htm:j.forwardmultipleemail,data:{action:"FwdAttach"}},{htm:j.recall,data:{action:"recall",mId:""}}],x=function(){var a,b=[{htm:j.viewAll,data:{action:"view_all"}},{htm:j.unread,data:{action:"view_unread"}},{htm:j.flagged+"<i class='msi-rarrow'></i>",data:{action:"view_flag"},child:function(){return t("view")}},{htm:j.tags+"<i class='msi-rarrow'></i>",data:{action:"view_label"},child:function(){return u("view")}},{htm:j.archived,data:{action:"view_archive"}}],c=[{htm:j.info,data:{action:"listview",view:"flag",viewId:1}},{htm:j.important,data:{action:"listview",view:"flag",viewId:2}},{htm:j.followup,data:{action:"listview",view:"flag",viewId:3}},{htm:j.viewAll,data:{action:"view_flag"}}],d=e.getListingDetObj(),f=d.fId;if(f){var g=b.slice();$.isEmptyObject(zmail.labInfo)&&(g[3]=""),(f===zmail.folId.spId||f&&zmail.folTree[0][f]&&0===zmail.folTree[0][f].IA)&&(g[5]=""),f===zmail.folId.teId&&(g[1]="",g[2]="",g[4]=""),f===zmail.folId.sId&&(g[1]="");for(var h;(h=g.indexOf(""))!==-1;)g.splice(h,1);a=g}else a=c;return a},y=function(){var b={};return b.divId="zm_filter",b.list=x(),b.align="cleft",b.clk=function(b,c){a("zmList").bindAction(b,c)},b},z=function(){var a,b=[{htm:j.attachmentView,data:{action:"view_attach",isAttachOnly:!0}},{htm:j.mailWithAttach,data:{action:"view_attach"}}],c=e.getListingDetObj(),f=c.fId;return f&&(a=b,!d.isSharedFolder(f)&&d.isZohoAccount(zmail.accId)||(a.splice(0,1),a[0].htm=j.mailWithAttach)),a},A=function(a){var b=[j.latestOnTop,j.oldestOnTop,j.largestOnTop,j.smallestOnTop],c=[];return b.forEach(function(b,d){c.push({htm:b,data:{action:"sort",value:d},className:d===a?"zmThmClr":""})}),c.splice(2,0,{sep:!0}),c},B=function(){var b={};return b.divId="zm_att_opts",b.list=z(),b.align="cleft",b.clk=function(b,c){a("zmList").bindAction(b,c)},b},C=function(){var b=a("zmTab"),c={},d=e.getListingDetObj().fId,f=b&&"zm_srch1"===b.currentTab,g=[],h=[zmail.folId.teId,zmail.folId.dId,zmail.folId.oId];c.selAll=function(){return{htm:j.all,data:{action:"select_all"}}},c.none=function(){return{htm:j.none,data:{action:"select_none"}}},c.unread=function(){if(f||h.indexOf(d)===-1&&d!==zmail.folId.sId)return{htm:j.unread,data:{action:"select_unread"}}},c.read=function(){if(f||h.indexOf(d)===-1)return{htm:j.read,data:{action:"select_read"}}},c.flag=function(){if(f||h.indexOf(d)===-1)return{htm:j.flagged,data:{action:"select_flag"}}},c.tag=function(){if(f||h.indexOf(d)===-1&&!$.isEmptyObject(zmail.labInfo))return{htm:j.tags,data:{action:"select_label"}}},c.attachment=function(){if(f||h.indexOf(d)===-1)return{htm:j.attachments,data:{action:"select_attach"}}};var i;return Object.keys(c).forEach(function(a){i=c[a](),i&&g.push(i)}),g},D=function(){var b=a("zmTab"),c=b.currentTab;if("zm_Container"===c||"zm_srch1"===c){var d=a("zmAdHocSettings"),e=[],f=["msi-classic","msi-compact","msi-superCompact"],g=[j.classic,j.compact,j.superCompact];return f.forEach(function(a,b){e.push({htm:"<i class="+f[b]+"></i> "+g[b],data:{action:"customize_view",value:String(b)},className:d.getListingDisplayDensity()===String(b)?"zmThmClr":""})}),e}},E=function(){var b=function(a,b){for(var c=a.length,e=0;e<c;e++)if(d.getMailObj(a[e],"S")?b.unread=!0:b.read=!0,b.unread&&b.read)return};return function(c,f){var g,h,i,j=a("zmsuite"),k=a("zmList"),l={read:!1,unread:!1},m=e.getListingDetObj(),n=j.getCenter()[0].getNodes()[2].$el;if(c.length&&b(c,l),l.unread&&l.read)return l;for(h=f.length,i=0;i<h;i++)if(g=d.getMailObj(f[i]),g.TS?(l.unread=!0,l.read||(c=k.getMailSummaryList(m,g.T),c.length&&b(c,l))):(l.read=!0,!l.unread&&n.find("#thd"+g.M).is(":visible")&&(c=k.getMailSummaryList(m,g.T),c.length&&b(c,l))),l.unread&&l.read)return l;return l}}(),F=function(){try{var b=a("zmsuite"),c=b.getCenter("zm_Container")[0].getNodes()[0].iconArr,f=c.monitor.hiddenElements;if(f.length){var g,h,i,k=[],l={"msi-filter":{htm:j.views,child:function(){return y()}},"msi-attsearch":{htm:j.attachOptions+"<i class='msi-rarrow'></i>",child:function(){return B()}},"msi-sortdateup":{htm:j.sortAscend,data:{action:"sortdateup"}},"msi-sortdatedn":{htm:j.sortDescend,data:{action:"sortdatedn"}},"msi-folder":{htm:j.moveto+"<i class='msi-rarrow'></i>",data:{action:"moveTo"},customList:{remove:function(){g&&g.hide()},show:function(a){g=e.loadFolderMenu(a,"cleft")}}},"msi-label":{htm:j.tagas+"<i class='msi-rarrow'></i>",data:{action:"tagAs"},customList:{remove:function(){h&&h.hide()},show:function(a){h=e.loadLabelMenu(a,"cleft")}}},"msi-trash":{htm:j["delete"],data:{action:"delete"}},"msi-spam":{htm:j.spam,data:{action:"spam"}},"msi-notspam":{htm:j.notspam,data:{action:"notspam"}},"msi-archive":{htm:j.archive,data:{action:"archive"}},"msi-unarchive":{htm:j.unarchive,data:{action:"unarchive"}}};return f.forEach(function(a){a instanceof $||(a=$(a)),i=a.attr("data-event"),l[i]&&k.push(l[i])}),k}return[]}catch(m){return d.debugLog(m),[]}},G=function(){var b=a("zmTab"),c=a("zmsuite"),f=a("zmSearchUtil"),g=[],h=d.isChildWindow()?"window":b.currentTab,i="zm_Container"===h,k="zm_srch1"===h,l=d.getSelectedMails(),m=l[1].length+l[0].length,n={};d.isChildWindow()?n=$("#zmWindowWrapper").data("detail"):i?n=e.getListingDetObj():k?n=f.getSearchViewDetails():h.indexOf("zmTab")||(n=c.getCenterOuter().$el.data("data-detail"));var o=function(){if(d.isChildWindow())return[];var a={},b=[];return a.markFolRead=function(){if(i&&n.fId&&!d.isSharedFolder(n.fId)){var a=zmail.folCount[n.fId]&&parseInt(zmail.folCount[n.fId].c);if(a)return[v[0]]}return[]},a.scrub=function(){return i&&m&&!d.isSharedFolder(n.fId)?[v[1]]:[]},Object.keys(a).forEach(function(c){b=b.concat(a[c]())}),b},p=function(){var b,c=!l[1].length&&1===l[0].length&&l[0][0];c&&(b=d.getMailObj(c,"FD")||n.fId);var e=b===zmail.folId.dId||b===zmail.folId.teId||b===zmail.folId.oId,f={},g=[],h=d.isChildWindow();return f.readOptions=function(){var a,c=[];if(b===zmail.folId.sId)return[];if(i||k)a=E(l[0],l[1]);else{a={read:!0,unread:!0};var e=l[0][0];e.indexOf("t")===-1&&(d.getMailObj(e,"S")?a.read=!1:a.unread=!1)}return a&&a.read&&c.push(w[0]),a&&a.unread&&c.push(w[1]),c},f.markflag=function(){return b===zmail.folId.spId?[]:[w[2]]},f.fwdAsInline=function(){return 1===m?[w[5]]:[]},f.fwdAsMultiple=function(){return d.isChildWindow()?[]:1===m?[w[6]]:m>1?[w[7]]:[]},f.recall=function(){if(!h&&1===m&&b===zmail.folId.sId){var c=a("zmList"),d=l[0][0];if(c.haveMailRecallSupport(d)){if(w[8].data.mId=d,"false"===zmail.isPaidUser&&!zmail.isInternalOrgUser){var e=j.recall+'<span class="zmUpgradeTxt"><i class="msi-fav"></i>'+j.rcUpgrade+"</span>";w[8].htm=e,w[8].className="zmUpgrade nohr",w[8].data.action="upgrade"}return[w[8]]}}return[]},!m||e?[]:(Object.keys(f).forEach(function(a,b){g=g.concat(f[a]())}),g)};return"zm_Container"===h&&(g=F()),g=g.concat(p()),g=g.concat(o()),g.length||g.push(v[0]),g},H={consDropDown:function(b){var c=a("zmDropDownMenu"),d=new c(b);d.paint()},show:function(b,c,e,f){var g,j,s,t,u=a("zmWatch"),v=a("zmSchedule");switch(c=h.element(c),e=e||{id:b,par:c},e.cmpId&&(b=e.id),b&&(b=b.replace(/[0-9]/g,"")),b){case"zm_shdLst":c.addClass("SC_bsel"),e.align="pright",e.ulClass="SC_tin",e.list=q();break;case"zm_priLst":c.find("b").addClass("SC_ddn"),e.ulClass="SC_tin",g=p(c),e.list=g.list,e.clk=g.clk,e.align="pright",e.parWidth=!0;break;case"zm_watchLst":h.addClass(h.selector("b",e.par),"SC_ddn"),e.onHide=function(){u.hideWatch(e.cmpId)},e.htm=u.loadWatch(e.cmpId),e.parWidth=!0,e.loadCopt=!0,e.align="pright";break;case"zm_addWatch":h.addClass(h.selector("b",e.par),"SC_ddn"),e.align="mright",e.showArrow=!0,e.direction="top",e.loadHTML=!0,e.onHide=function(){u.hideWatch(e.cmpId)},e.htm=u.loadWatch(e.cmpId);break;case"zm_sendLater":e.par=c.find("b"),c.find("b").addClass("SC_ddn"),e.htm=v.scheduleDROP(b),e.loadCopt=!0,e.align="pright";break;case"zm_recurring":e.par=c.find("b"),c.find("b").addClass("SC_ddn"),e.htm=v.scheduleDROP(b),e.loadCopt=!0,e.align="pright";break;case"zm_savecomp":c.find("b").addClass("SC_ddn"),e.ulClass="SC_tin",t=o(c),e.list=t.list,e.clk=t.clk;break;case"zm_compactLst":c.find("b").addClass("SC_ddn"),e.ulClass="SC_tin",j=n(c),e.list=j.list,e.clk=j.clk;break;case"zm_SndLst":e.par=c;var w;f&&(w=f.snd_type);var x=k(w,f);c.find("b").addClass("SC_ddn"),e.list=x.list,e.clk=x.clk,e.leftOffset=4;break;case"zm_ScheduleLst":e.par=c,c.find("b").addClass("SC_ddn"),e.htm=l();break;case"zm_SveLst":e.par=c,c.find("b").addClass("SC_ddn"),e.list=m().list,e.clk=m().clk,e.align="pright",e.loadCopt=!0,e.parWidth=!0;break;case"zm_createLst":s=r(),e.list=s.list;var y=c.find(".msi-barrow");y.addClass("sel"),e.onHide=function(){y.removeClass("sel")},e.clk=s.clk,e.ulClass="zm_compul",e.defaultclass=!1,e.parWidth=!0,e.removeBorderValue=!0,e.spanClass="SC_dd wbdr"}e.align=e.align||"pleft","pleft"!==e.align&&"pright"!==e.align||!c.attr("data-drop")?i.consDropDown(e):(c.removeAttr("data-drop"),d.hideMenu())},getActionDrop:G,getViewDrop:x,getAttachOptions:z,getSelectDrop:C,getCustomizeViewDrop:D,getSortOptions:A};return i=$.extend(i,H)}),define([],function(a){function b(a){return(parseFloat(a.css("margin-top"))||0)+(parseFloat(a.css("padding-top"))||0)+parseFloat(a.css("border-top")||0)}function c(){if(j.keybindings.scopeInfos.hasOwnProperty("dropDownNavigation")){for(var a=["upArrow","leftArrow","rightArrow","downArrow","enter","esc","space"],b=0;b<a.length;b++)j.keybindings.deregister("dropDownNavigation",a[b]);j.keybindings.dropScope("dropDownNavigation"),j.keybindings.setScope(g)}}function d(){c()}function e(a){$(a).off("mousemove.dd").one("mousemove.dd",function(a){$(this).children().removeClass("sel"),$(this).hasClass("sel")||($(this).addClass("SC_Phr"),$(a.target).trigger("mouseenter"))}).removeClass("SC_Phr")}function f(a){this.dropObj=a}var g,h=a("zmsuite"),i=a("_zm"),j=a("zmComponent"),k=function m(a){var b,c;for(b=0;b<a.length;b++)a[b]&&(a[b].child?a[b].child.divId?$("#"+a[b].child.divId).remove():$("#"+a[b].child("",a[b].data).divId).remove():a[b].customList&&a[b].customList.remove(),c="function"==typeof a[b].child?a[b].child("rem",a[b].data):a[b].child,c&&c.list&&m(c.list))},l=function(b,d,e,f){var g=a("zmUtil");b&&b.removeAttr("data-drop"),d&&(g.removeHighlight(),c()),f.remove()};return f.prototype.removeBindings=function(){c()},f.prototype={setDropObj:function(a){this.dropObj=a},paint:function(){this.dropObj.showArrow?this.paintArrowDrop():this.paintDrop()},initShortcutHandler:function(a,b,c){if($(a).data({listArr:b,position:c}),this.dropObj.isChild===!0)return 0;var f=function(a){var b=a.parent().parent(),c=b.height(),d=a.position().top,e=b.scrollTop(),f=a.outerHeight();d+f>c?b.scrollTop(Math.abs(d+f-c)+e):d<0&&b.scrollTop(Math.abs(d+e))},h=function(a,b){(b<0||"undefined"==typeof b)&&(b=b||a.children().length-1);for(var c=a.children(),d=b;d>=0;d--){var g=$(c[d]);if("SC_lne"!==g.attr("class")&&"nohr"!==g.attr("class"))return f(g),a.children().closest(".sel").removeClass("sel"),g.addClass("sel"),e(g.parent()),a.data("currentSelected",d),!0}return!1},i=function(a,b){var c=a.children();b=b||0;for(var d=b;d<c.length;d++){var g=$(c[d]);if("SC_lne"!==g.attr("class")&&"nohr"!==g.attr("class"))return f(g),a.children().closest(".sel").removeClass("sel"),g.addClass("sel"),e(g.parent()),a.data("currentSelected",d),!0}return!1},k=function(a,b){var c=b.data("currentSelected")||0;1===a?i(b,c+1)||i(b):a===-1&&(h(b,c-1)||h(b))},l=function(a,b){1===b?k(1,a):b===-1&&k(-1,a),a.children().find(".sel").removeClass("sel")},m=function(a,b){var c,e,f=$(".zmcDrpDwnMnu").length;e=$($(".zmcDrpDwnMnu")[f-1]);var g=-1;if("undefined"!=typeof e.data("currentSelected")&&(g=e.data("currentSelected")),("nextChildElement"===a||"prevChildElement"===a)&&(c=e.children().closest(".sel").prevAll().length,"undefined"!=typeof $(e).data().listArr[c].data)){var j=$(e).data().listArr[c].data.dropMenudirection;"undefined"==typeof j&&(j=$(e).data().listArr[c].data.menuDirection),"left"!==j&&"cright"!==$(e).data().position||(a="nextChildElement"===a?"prevChildElement":"nextChildElement")}if(g===-1)"prevElement"===a?h(e):"nextElement"===a&&i(e);else{var k=0;if("prevElement"===a)k=-1,l(e,k);else if("nextElement"===a)k=1,l(e,k);else{if("selectElement"===a)return c=e.children().closest(".sel").prevAll().length,"undefined"!=typeof b[c]&&"function"==typeof b[c].child?void e.children().closest(".sel").trigger("mouseenter"):(d(),void e.children().closest(".sel").trigger("click"));"nextChildElement"===a&&(c=e.children().closest(".sel").prevAll().length,"function"==typeof $(e).data().listArr[c].child&&(e.children().closest(".sel").trigger("mouseenter"),$(".zmcDrpDwnMnu").length>f&&$(".zmcDrpDwnMnu").last().children().eq(0).addClass("sel")))}}if("removeElement"===a||"prevChildElement"===a){var m=$(".zmcDrpDwnMnu").length;"removeElement"===a&&m<=1&&d(),(m>1||"removeElement"===a)&&e.parent().remove()}},n=function(a,c,d){m(a,b),d.preventDefault()},o=[n],p={scope:"dropDownNavigation",allowDefaultScope:!1,defaultOccurrence:!0,shortcuts:[{uid:"prevElement",keyStr:"upArrow",scope:"dropDownNavigation",actions:o},{uid:"removeElement",keyStr:"esc",scope:"dropDownNavigation",actions:o},{uid:"nextElement",keyStr:"downArrow",scope:"dropDownNavigation",actions:o},{uid:"nextChildElement",keyStr:"rightArrow",scope:"dropDownNavigation",actions:o},{uid:"prevChildElement",keyStr:"leftArrow",scope:"dropDownNavigation",actions:o},{uid:"selectElement",keyStr:"enter",scope:"dropDownNavigation",actions:o},{uid:"selectElement",keyStr:"space",scope:"dropDownNavigation",actions:o}]};"dropDownNavigation"!==j.keybindings.getScope()&&(g=j.keybindings.getScope(),j.keybindings.registerAll(p),j.keybindings.setScope("dropDownNavigation"))},paintDrop:function(){var a,c,g,j,m,n,o,p,q=this.dropObj,r=q.list||[],s=q.liDom||[],t=$(q.par),u=q.align,v=q.divId,w=t.offset(),x=t.outerHeight(),y=w.left,z=q.container||document.body,A=q.htm,B=w.top,C=void 0===q.defaultclass||q.defaultclass,D=q.dir,E=$(z).offset(),F=q.avoidScroll,G=q.paddingOffset||40,H="",I=40,J=parseFloat($(z).css("border-top-width")),K=parseFloat($(z).css("margin-top")),L=parseInt(zmUtil.wmsBarHeight()),M=q.avoidAutoPosition;$(q.par[0]).addClass("zmcDrpDwnOpn");var N,O,P,Q,R,S,T,U,V,W=r.length||s.length;m=z.offsetHeight,n=z.offsetWidth,u||(c=h.getCenter()[0].$el,j=c.offset().left+c.width()/2,u=t.offset().left>j?"pright":"pleft"),T=this,R=$("<div/>"),v?($("#"+v).remove(),R[0].id=v):($("#zm_dropDown").remove(),R[0].id="zm_dropDown");var X="SC_dd";if(!C&&q.spanClass&&(X=q.spanClass),R.addClass(X+" shw"),R.mousedown(function(a){i.stopEvents(a,!0)}),q.removeLi){for(var Y=0;Y<q.liDom.length;Y++){var Z=$(q.liDom[Y]);R.append(Z)}a=q.scrollElement,$(z).append(R),"pleft"===u&&y+$(R).width()>n&&(u="pright"),q.liDom=null,W=!1}if(W){if(Q=$("<ul/>"),q.clk&&Q.click(function(a){var b,c=a.target||a.srcElement,e=$(c).closest("li");b=e.data(),e.hasClass("SC_op3")||(d(),q.clk(b,c,a))}),$(Q).on("mouseleave",function(){$(this).data("childrenVisible")||$(Q).find(".sel").removeClass("sel")}),q.ulClass&&Q.addClass(q.ulClass),q.liDom)for(W=q.liDom.length,N=0;N<W;N++)Q.append(q.liDom[N]);else{var _=function(a,b,c){return function(d){var e=$(d.target);if("disabled"!==r[a].state){var g,i,j,l,m;k(r),r[a].customList&&(r[a].customList.show(b),$(e).parent().children().removeClass("sel")),$(P).parent().hasClass("SC_Phr")&&($(P).parent().data("currentSelected",$(d.target).prevAll().length),$(e).parent().children().removeClass("sel")),g="function"==typeof r[a].child?r[a].child():r[a].child,g?(r[a].align?i=r[a].align:(l=zmail.isComposeMail?$("#zmComposeWrapper"):h.getCenter()[0].$el,m=l.offset().left+l.width()/2,i=t.offset().left>m?"cright":"cleft"),g.par=b,g.align=i,g.clk=g.clk||q.clk,g.isChild=!0,g.container=c.dropObj.container,j=new f(g),j.paint()):$(e).parent().data("childrenVisible",!1),(g||r[a].customList)&&($(e).parent().data("childrenVisible",!0),$(e).addClass("sel"))}}};for(N=0;N<W;N++)r[N]&&(P=$("<li/>"),r[N].sep?P.addClass("SC_lne"):r[N].txt?P.text(r[N].txt):P.html(r[N].htm),r[N].className&&P.addClass(r[N].className),r[N].nohover&&P.addClass("nohr"),r[N].noclick&&P.addClass(r[N].noclick),r[N].data&&P.data(r[N].data),"disabled"===r[N].state&&P.addClass("SC_op3"),P.mouseover(_(N,P,T)),Q.append(P))}e(Q),Q.on("contextmenu",function(){return!1}),a=$("<div/>"),q.removeLi||(a.append(Q),R.append(a))}else A&&R.append(A);if($(z).append(R),$(Q).addClass("zmcDrpDwnMnu"),q.disableShortCut!==!0&&this.initShortcutHandler(Q,r,u),q.parWidth){var aa=t.outerWidth();R.width()<aa?(R.width(aa),R.addClass("topSt SC_ddT")):R.addClass("topLt SC_ddT"),q.removeBorderValue&&R.width(aa-((parseInt($(R).css("border-left-width"))||0)+(parseInt($(R).css("border-right-width"))||0)))}var ba=R.height();if("cleft"===u||"colorpicker"===u){O="cleft"===u?t.parent().width():t.width(),g=R.width(),q.container&&(n-=parseFloat($(q.container).css("border-left-width"))||0),w.left+O+g>n?(R.find("ul").addClass("SC_ddr"),R.css("right",n-w.left)):R.css("left",y+O),B-=parseFloat(R.find("ul").css("padding-top"));var ca=0;q.isChild&&(ca=b(R),B-=ca),B+ba>m&&B-ba>0?R.css({top:B+x-ba}):B+ba+L+G>m&&B>m/2?(R.css({bottom:m-B-x-2*ca}),S="bottom"):R.css({top:B})}else if("pright"===u)g=t.outerWidth(),y-=E.left,B-=E.top,n-=parseFloat($(q.container).css("border-right-width"))||0,y=n-(y+g),q.isChild&&(B-=b(R)),R.find("ul").addClass("SC_ddr"),.7*z.getBoundingClientRect().height-L<B&&!M&&(D="bottom"),D&&"bottom"===D?(V=B-ba,V<10&&a&&!F&&(a.css("height",R.height()-(E.top+5-V)).addClass("zmDDScroll"),V=E.top+5,F=!0),p="SC_ddRtB",H="botRt"):(V=B+x-J-K,p="SC_ddRt",H="topRt",D="top"),V+R.outerHeight()<t.offset().top-E.top+x&&(V-=R.outerHeight()-ba),a&&R.addClass(p),R.css({right:y+"px",top:V+"px"});else if("cright"===u)g=t.outerWidth(!0),y-=E.left,B-=E.top,q.container&&(n-=parseFloat($(q.container).css("border-right-width"))||0),y=n-y,q.isChild&&(B-=b(R)),R.find("ul").addClass("SC_ddr"),R.css({right:y+"px"}),R.find("ul").length&&(B-=parseFloat(R.find("ul").css("padding-top"))),a&&R.addClass("SC_ddRt"),B+R.outerHeight()+L>m&&B-R.outerHeight()>0?R.css({top:B+x-ba}):R.css({top:B});else if("pleft"===u){if(U=y-E.left,B-=E.top,.7*z.getBoundingClientRect().height-L<B&&!M&&(D="bottom"),q.isChild&&(B-=b(R)),D&&"bottom"===D){if(R.find("ul").addClass("SC_ddr"),V=B-ba-2*b(R)+1,V<10&&a&&!F){var da=0;q.showSearch&&(da=I),a.css("height",R.height()-da-(E.top+5-V)).addClass("zmDDScroll"),V=E.top+5,F=!0}p="SC_ddLtB",H="botLt",H+=" "+p,(!q.parWidth||R.width()<=t.outerWidth())&&(H="botSt")}else V=B+x-J-K-1,q.parWidth||(H="topLt"),D="top";R.css({left:U+"px",top:V+"px"}),U+R.outerWidth()>n&&!q.container&&$(R).css("width",n-U)}else"mright"===u&&(g=t.width(),q.container&&(n-=parseFloat($(q.container).css("border-right-width"))||0),y=n-y,R.find("ul").addClass("SC_ddr"),R.css({right:y+"px",top:B-R.height()/2}));H&&R.addClass(H);var ea=R.height();"bottom"!==S&&(o=ea+R.offset().top-E.top-(m-G),q.showSearch&&(o+=I)),o>0&&a&&!F&&(q.isChild===!0&&(o-=G),a.css("max-height",ea-o-b(R)-L).addClass("zmDDScroll")),q.isChild&&o>0&&a&&!F&&a.css("top",parseFloat(a.css("top")-o)),$("[data-drop='1']").removeAttr("data-drop"),"pleft"!==u&&"pright"!==u||t.attr("data-drop","1"),q.leftOffset&&(R[0].style.left=parseFloat(R[0].style.left)+q.leftOffset+"px"),q.topOffset&&(R[0].style.top=parseFloat(R[0].style.top)+q.topOffset+"px"),setTimeout(function(){R.addClass("shw")},300),$.publish("/mail/menuCreated",[{element:R[0],menuHandler:l,menuArgsArray:[t,!q.isChild,q,this]}]),this.dropObj.mountPosition=D,this.$el=R},paintArrowDrop:function(){var a,c,d,e,g,j,m=this.dropObj,n=m.list,o=$(m.par),p=o.offset(),q=o.height(),r=o.width(),s=m.divId,t={},u={},v=m.container||document.body,w=$(v).offset(),x=parseInt(zmUtil.wmsBarHeight());m.par&&(u=o[0].getBoundingClientRect());var y,z,A,B,C,D,E,F,G,H,I=0,J=40;if(d=v.offsetHeight-x,e=v.offsetWidth,j=15,B=$("<div/>"),E=this,s?($("#"+s).remove(),B[0].id=s):($("#zm_dropDown").remove(),B[0].id="zm_dropDown"),B.addClass("SC_arm"),B.mousedown(function(a){i.stopEvents(a,!0)}),g=m.ulClass||(m.liHover===!1?"":"SC_Phr "),A=$("<ul/>"),A[0].className=g,A.addClass("zmListReset"),m.spanClass&&B.addClass(m.spanClass),m.clk&&A.click(function(a){var b,c=a.target||a.srcElement;b=$(c).closest("li").data(),m.clk(b,c)}),m.removeLi){for(var K=0;K<m.liDom.length;K++){var L=$(m.liDom[K]);B.append(L)}A.remove(),m.liDom=null,m.scrollElement&&(A=m.scrollElement)}if(m.liDom)for(C=m.liDom.length,y=0;y<C;y++)A.append(m.liDom[y]);else if(n&&n.length){var M=function(a,b,c){return function(d){var e=$(d.target);if("disabled"!==n[a].state){var g,i,j,l,p;k(n),n[a].customList&&(n[a].customList.show(b),$(e).parent().children().removeClass("sel")),$(z).parent().hasClass("SC_Phr")&&($(z).parent().data("currentSelected",$(d.target).prevAll().length),$(e).parent().children().removeClass("sel")),g="function"==typeof n[a].child?n[a].child("",n[a].data):n[a].child,g?(n[a].align?i=n[a].align:(l=zmail.isComposeMail?$("#zmComposeWrapper"):h.getCenter()[0].$el,p=l.offset().left+l.width()/2,i=o.offset().left>p?"cright":"cleft"),g.par=b,g.align=i,g.clk=g.clk||m.clk,g.isChild=!0,g.container=c.dropObj.container,j=new f(g),j.paint()):$(e).parent().data("childrenVisible",!1),(g||n[a].customList)&&($(e).parent().data("childrenVisible",!0),$(e).addClass("sel"))}}};for(C=n.length,y=0;y<C;y++)n[y]&&(z=$("<li/>"),n[y].sep?z.addClass("SC_lne"):z.html(n[y].htm),n[y].data&&z.data(n[y].data),"disabled"===n[y].state&&z.addClass("SC_op3"),n[y].nohover&&z.addClass("nohr"),z.mouseover(M(y,z,E)),A.append(z))}if(m.buttons){for(F=m.buttons,I=F.length,G=$("<div class='SC_PUbtm'/>"),z=$("<li/>"),y=0;y<I;y++)D=$("<span/>"),D.html(F[y].txt),D.on("click",F[y].callback),G.append(D);z.append(G),A.append(z)}m.htm&&m.loadHTML?B.append(m.htm):m.removeLi||B.append(A);var N=13,O=15;m.removeArrow&&(B.addClass("na"),N=0),m.showSearch&&(j+=J),m.direction||(m.autoPosition=!0,p.top>d/2&&(m.direction="bottom")),d-=j;var P={};if("left"===m.direction)$(document.body).append(B),a=m.left||p.left+r,H=B.outerHeight(),c=m.top||p.top+q/2-H/2,c<10||c+H/2<d-j?p.top<d/2?(c=p.top-(N+O)+o.width()/2,B.addClass("ltt"),c+B.height()>d-j&&(A.css("height",B.height()-(c+B.height()-d+j)),A.addClass("zmDDScroll"))):(c=m.top||p.top+q/2+O+N-H,B.addClass("ltb"),!m.top&&c<1&&(c=N,A.css("height",p.top+N),A.addClass("zmDDScroll"))):B.addClass("lt"),B.css({left:a+"px",top:c+"px"}),P.left=B.offset().left+N+"px";else if("bottom"===m.direction){$(document.body).append(B);var Q=B.width();m.fromFolderLabel&&$(B).css("width",Q),a=m.left+r/2-Q/2||p.left+r/2-B.outerWidth()/2,c=m.top-B.height()-b(B)||p.top-B.outerHeight(),a+Q+5>e&&m.par?(B.addClass("btr"),a=p.right,t.right=e-u.right+o.width()/2-(N+O)+"px",parseInt(t.right)+Q+10>e&&$(B).css("width",e-parseInt(t.right)-10)):a<0?(t.left=p.left+r/2+"px",parseInt(t.left)+Q+10>e&&$(B).css("width",e-parseInt(t.left)-10),B.addClass("btl")):(B.addClass("bt"),t.left=a+"px"),c<10&&(A.css("height",p.top-(70+O+j)).addClass("zmDDScroll"),c=70+N),t.top=c+"px",B.css(t),P.top=B.offset().top-N+"px"}else if("right"===m.direction)$(document.body).append(B),H=B.height(),c=m.top||p.top+q/2-H/2,a=m.right||e-p.left,c<10||c+H/2<d?p.top<d/2?(c=p.top-(N+O)+o.width()/2,B.addClass("rtt"),c+B.height()>d-j&&(A.css("height",B.height()-(c+B.height()-d+j)),A.addClass("zmDDScroll"))):(c=m.top||p.top+q-B.height(),B.addClass("rtb"),!m.top&&c<1&&(c=N,A.css("height",p.top+N),A.addClass("zmDDScroll"))):B.addClass("rt"),B.css({right:a+"px",top:c+"px"}),P.right=e-B.offset().left-B.width()+N+"px";else if("rightBottom"===m.direction)$(document.body).append(B),a=m.right||e-p.left,c=m.top||p.top+q-B.height(),B.addClass("rtb"),!m.top&&c<1&&(c=N,A.css("height",p.top+N).addClass("zmDDScroll")),B.css({right:a+"px",top:c+"px"}),m.bottom&&B.css({bottom:m.bottom}),P.right=e-B.offset().left-B.width()+N+"px";else{if($(v).append(B),a=m.left||p.left+r/2-B.width()/2,a-=w.left,c=m.top||p.top,c-=w.top,H=B.height(),a+B.width()+5>e&&m.par?(B.addClass("tpr"),t.right=e-u.right+o.width()/2-(N+O)+"px"):a<0?("left"===m.directionAlign?(a=m.left||p.left+r/2,a-=w.left,a-=N+O+"px",t.left=a):t.left=p.left+r/2-(N+O)+"px",B.addClass("tpl")):(B.addClass("tp"),t.left=a+"px"),t.top=c+q+"px",c+H+10>d){var R=H+c-d;R+=70,A.css("max-height",H-R+"px").addClass("zmDDScroll")}B.css(t);var S=B.offset().top;B.css("top",S+2*N+"px"),P.top=S+N+"px"}setTimeout(function(){B.addClass("shw"),B.css(P)},200),$.publish("/mail/menuCreated",[{element:B[0],menuHandler:l,menuArgsArray:[null,!m.isChild,m,this]}]),A.on("contextmenu",function(){return!1}),this.$el=B}},f.prototype.hide=function(){var a=this;a.$el.hide()},f.prototype.remove=function(){var a=this;a.$el.remove(),"function"==typeof a.dropObj.onHide&&a.dropObj.onHide(),$(a).triggerHandler("removed",a)},f.prototype.show=function(){var a=this;a.$el.show(),a.position()},f.prototype.position=function(a){var b=this,c=zmail.Components.AutoFill.Helper.getAutofillViewPort();a=a||{},a.arrowPadding=a.arrowPadding||12,b.dropObj.showArrow||(a.arrowPadding=0);
var d=$(b.$el)[0],e=$(b.dropObj.par)[0],f=null,g=null,h=null,i=a.arrowPadding,j=0,k=0,l=!1,m=!0;f={left:0,top:0},d&&e&&($(d).css({height:"auto"}),g=e.getBoundingClientRect(),h=d.getBoundingClientRect(),f.left=g.left,f.left-=(h.width-g.width)/2,j=Math.abs(g.top-c.top),k=Math.abs(g.bottom-c.bottom),b.dropObj.autoPosition||"top"!==b.dropObj.direction?b.dropObj.autoPosition===!0&&(m=j<k):m=!1,$(d).removeClass("tp").removeClass("bt").removeClass("scroll-active"),m?(f.top=g.bottom+i,k<h.height+i&&($(d).css({height:k-i+"px"}).addClass("scroll-active"),l=!0),$(d).addClass("tp")):(f.top=g.top-h.height-i,f.top<c.top&&(f.top=c.top),j<h.height+i&&($(d).css({height:j-i+"px"}).addClass("scroll-active"),l=!0),$(d).addClass("bt")),$(d).hide(),$(d).css({top:f.top+"px",left:f.left+"px"}),$(d).show(),l&&"function"==typeof a.onResize&&a.onResize({wrapperDOM:d,height:d.getBoundingClientRect().height,position:m?"bottom":"top",insufficientSpace:l}))},window.zmDropDownMenu=f,window.zmDropDownMenu}),define([],function(a){function b(){if(k.keybindings.scopeInfos.hasOwnProperty("contextMenuNavigation")){for(var a=["upArrow","leftArrow","rightArrow","downArrow","enter","esc","space"],b=0;b<a.length;b++)k.keybindings.deregister("contextMenuNavigation",a[b]);k.keybindings.dropScope("contextMenuNavigation"),k.keybindings.setScope(f)}}function c(a){return(parseInt(a.css("margin-top"))||0)+(parseInt(a.css("padding-top"))||0)+parseInt(a.css("border-top")||0)}function d(a){i(a).off("mousemove.cm").one("mousemove.cm",function(){i(this).children().removeClass("sel"),i(this).hasClass("sel")||i(this).addClass("SC_Phr")}).removeClass("SC_Phr")}function e(a){this.menuObj=a&&a.menuObj}var f,g,h,i=a("$"),j=a("zmUtil"),k=a("zmComponent"),l=function(a,c,d){a&&c&&j.removeRightClickSelection(a),b(),d.remove()};return e.prototype={setMenuObj:function(a){this.menuObj=a},remove:function(){var a=this;"function"==typeof a.menuObj.onHide&&a.menuObj.onHide()},initShortcutHandler:function(a,c,e){if(i(a).data({listArr:c,position:e}),"undefined"!=typeof this.menuObj.parent)return 0;var g=function(a,b){(b<0||"undefined"==typeof b)&&(b=b||a.children().length-1);for(var c=a.children(),e=b;e>=0;e--)if("SC_lne"!==i(c[e]).attr("class")&&"nohr"!==i(c[e]).attr("class"))return a.children().closest(".sel").removeClass("sel"),i(c[e]).addClass("sel"),d(i(c[e]).parent()),a.data("currentSelected",e),!0;return!1},h=function(a,b){var c=a.children();b=b||0;for(var e=b;e<c.length;e++)if("SC_lne"!==i(c[e]).attr("class")&&"nohr"!==i(c[e]).attr("class"))return a.children().closest(".sel").removeClass("sel"),i(c[e]).addClass("sel"),d(i(c[e]).parent()),a.data("currentSelected",e),!0;return!1},j=function(a,b){var c=b.data("currentSelected")||0;1===a?h(b,c+1)||h(b):a===-1&&(g(b,c-1)||g(b))},l=function(b,c){1===c?j(1,a):c===-1&&j(-1,a),a.children().find(".sel").removeClass("sel")},m=function(c,d){var e,f=i(".zmcCntxtMnu").length;a=i(i(".zmcCntxtMnu")[f-1]);var j=-1;if("undefined"!=typeof a.data("currentSelected")&&(j=a.data("currentSelected")),("nextChildElement"===c||"prevChildElement"===c)&&(e=a.children().closest(".sel").prevAll().length,"undefined"!=typeof i(a).data().listArr[e].data)){var k=i(a).data().listArr[e].data.dropMenudirection;"left"!==k&&"cright"!==i(a).data().position||(c="nextChildElement"===c?"prevChildElement":"nextChildElement")}if(j===-1)"prevElement"===c?g(a):"nextElement"===c&&h(a);else{var m=0;if("prevElement"===c)m=-1,l(a,m);else if("nextElement"===c)m=1,l(a,m);else{if("selectElement"===c)return e=a.children().closest(".sel").prevAll().length,"function"==typeof d[e].child?void a.children().closest(".sel").trigger("mouseenter"):void a.children().closest(".sel").trigger("click");"nextChildElement"===c&&(e=a.children().closest(".sel").prevAll().length,"function"==typeof i(a).data().listArr[e].child&&(a.children().closest(".sel").trigger("mouseenter"),i(".zmcCntxtMnu").length>f&&i(".zmcCntxtMnu").last().children().eq(0).addClass("sel")))}}if("removeElement"===c||"prevChildElement"===c){var n=i(".zmcCntxtMnu").length;"removeElement"===c&&n<=1&&b(),(n>1||"removeElement"===c)&&a.parent().remove()}},n=function(a,b,d){m(a,c),d.preventDefault()},o=[n],p={scope:"contextMenuNavigation",allowDefaultScope:!1,defaultOccurrence:!0,shortcuts:[{uid:"prevElement",keyStr:"upArrow",scope:"contextMenuNavigation",actions:o},{uid:"removeElement",keyStr:"esc",scope:"contextMenuNavigation",actions:o},{uid:"nextElement",keyStr:"downArrow",scope:"contextMenuNavigation",actions:o},{uid:"nextChildElement",keyStr:"rightArrow",scope:"contextMenuNavigation",actions:o},{uid:"prevChildElement",keyStr:"leftArrow",scope:"contextMenuNavigation",actions:o},{uid:"selectElement",keyStr:"enter",scope:"contextMenuNavigation",actions:o},{uid:"selectElement",keyStr:"space",scope:"contextMenuNavigation",actions:o}]};"contextMenuNavigation"!==k.keybindings.getScope()&&(f=k.keybindings.getScope(),k.keybindings.registerAll(p),k.keybindings.setScope("contextMenuNavigation"))},paint:function(a){var e,f,h,k,m=this.menuObj.conArr,n=this.menuObj.par,o=this.menuObj.position||"right",p=this,q=document.body.offsetWidth;if(m){e=this.menuObj.divId||"zmCntxtMenu";var r=m.length;if(r){var s=i("<div/>");i("#"+e).remove(),s[0].id=e,s[0].className="SC_dd shw",s.mousedown(function(a){j.stopEvents(a,!0)});var t=i("<div/>");s.append(t),s.click(function(a){var c=a.target||a.srcElement;b(),c=i(c).closest("li"),c.hasClass("SC_op3")||p.menuObj.clk(a,c.data())}),s.on("contextmenu",function(){return!1});var u=i("<ul/>");t.append(u);for(var v=function(){i(this).parent().children().removeClass("sel"),i(this).hasClass("nohr")||i(this).addClass("sel")},w=0;w<r;w++){var x=i("<li/>"),y=m[w].cEdit===!0,z=m[w].id?m[w].id:"";if(x.data(m[w].data),m[w].htm)if(y){var A=i("<div/>");A[0].innerHTML=m[w].htm,A[0].id=z,x.append(A)}else x[0].innerHTML=m[w].htm,x[0].id=z;else m[w].sep&&(x[0].className="SC_lne",x[0].id=z);u.append(x),n&&q<a.clientX+n[0].offsetWidth+200&&(o="left"),x.mouseover(g(w,m,x,o)),x.hover(v)}i(u).on("mouseleave",function(){i(this).data("childrenVisible")||i(u).find(".sel").removeClass("sel")}),d(u);var B=a.clientY,C=a.clientX;i("body").append(s),u.addClass("zmcCntxtMnu"),this.initShortcutHandler(u,m),f=s[0].offsetWidth||0,n&&(i(n).addClass("sel"),h=n[0].offsetWidth,k=n[0].getBoundingClientRect(),"left"===o?C=k.left-f:"right"===o?C=k.right:q<C+h+f&&(C=k.left-f),B=k.top);var D=i("#"+e).height()+B,E=i("#"+e).height(),F=i(document.body).height();if(s)if(q<C+f&&(C-=f),D>F-100&&B-E>=0){n&&(B+=k.height);var G=F-B;n&&(G-=c(s)),s.css({bottom:G,left:C})}else n&&(B-=c(s)),s.css({top:B,left:C});i.publish("/mail/menuCreated",[{element:s[0],menuHandler:l,menuArgsArray:[a.target||a.srcElement,this.menuObj.removeSelection,this]}])}}}},h=function(a,b){for(var c=a.length,d=0;d<c;d++)if(a[d].child){var e=a[d].child();i("#"+e.divId)&&i("#"+e.divId).remove()}},g=function(a,b,c,d){return function(f){var g={};if(h(b,c),i(i(c).parent()).hasClass("SC_Phr")&&i(i(c).parent()).data("currentSelected",i(f.target).prevAll().length),b[a].child&&(g=b[a].child(),g.par=c,g.position=d),Object.keys(g).length>0){var j=new e;j.setMenuObj(g),j.paint(f),i(c).parent().data("childrenVisible",!0)}else i(c).parent().data("childrenVisible",!1)}},window.zmContextMenu=e,e});
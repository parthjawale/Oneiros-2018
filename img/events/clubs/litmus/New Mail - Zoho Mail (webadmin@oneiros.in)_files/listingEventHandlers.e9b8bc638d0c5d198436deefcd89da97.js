"use strict";define([],function(a){var b=zmail.Core.Namespaces,c=zmText.get("mail").listing,d=ZMail.lConstants,e=d.cls,f=b.create("zmail.Listing.Handlers.DeliveryStatus");return f.getMailDeliveryStatus=function(a,b,c){if(a){0===a.indexOf("t")&&(a=a.subtring(1));var d={accId:zmail.accId,mode:"getMailDeliveryStatus",msgId:a};zmAjq.XHR({u:zmail.conPath+"/mailUtilAction.do",t:"POST",fn:f.showDeliveryStatusDialog,p:d,ep:{msgId:a,refresh:b,dInst:c},csr:"s"})}},f.showDeliveryStatusDialog=function(b,e){if(!b.error&&b.MDS){1===b.MDS&&b.userstatus&&b.userstatus.toLogs.length&&(b.MDS=5);var g,h,i,j={},k=b.MDS,l=e.msgId,m="",n=e.dInst||{},o=c.mailDeliveryStatus,p={},q="",r={0:"",1:c.mailDeliveryStatus.statusTitle.queued,2:c.mailDeliveryStatus.statusTitle.inprogress,3:c.mailDeliveryStatus.statusTitle.inprogress,4:c.mailDeliveryStatus.statusTitle.inprogress,5:c.mailDeliveryStatus.statusTitle.success,6:c.mailDeliveryStatus.statusTitle.failure,7:c.mailDeliveryStatus.statusTitle.failure,8:c.mailDeliveryStatus.statusTitle.undo,9:c.mailDeliveryStatus.statusTitle.retry,10:c.mailDeliveryStatus.statusTitle.retry},s={0:"",1:c.mailDeliveryStatus.statusContent.queued,2:c.mailDeliveryStatus.statusContent.inprogress,3:c.mailDeliveryStatus.statusContent.inprogress,4:c.mailDeliveryStatus.statusContent.inprogress,5:c.mailDeliveryStatus.statusContent.success,6:c.mailDeliveryStatus.statusContent.failure,7:c.mailDeliveryStatus.statusContent.failure,8:c.mailDeliveryStatus.statusContent.undo,9:c.mailDeliveryStatus.statusContent.retry,10:c.mailDeliveryStatus.statusContent.retry};6!==k&&7!==k||(q=zdom("font",{id:"helpDF","class":"SC_ldot"},o.common.learnmore)),h=e.refresh||!1,b.userstatus.toLogs?(i=b.userstatus.toLogs||[],m=b.userstatus.nrcpts||""):(i=b.userstatus||[],m=i.length);var t=function(a){var b="",c=zmail.ContactBook.get({eid:a,promise:!1})[0];return b=c?c.attrs.fn||c.attrs.nn||c.attrs.eid:zmConUtil.parseContacts(a)[0].fn||a},u=function(a){var b="";return b="<div>"+t(a)+"<font><b> - </b>"+a+"</font><span>"+a+"</span></div>",b+='<img src="">'},v=function(a,b){if(!a&&!b)return"";var d="",e={TEMP_FAILURE:"msi-mailRetry",SUCCESS:"msi-mailSuc",PERM_FAILURE:"msi-mailFail"},f={TEMP_FAILURE:"zmSndSts-fail",SUCCESS:"zmSndSts-suc",PERM_FAILURE:"zmSndSts-fail"};return d='<div class="zmDel_status">',b&&(d+='<span class="zmSndSts_PopupIcon"><div class="zmSndStsCon '+f[b]+'"><span class="zmSndStsIco"><i class="'+e[b]+'"></i></span></div></span>'),a&&(d+='<span class="zmDel_time">'+a+"</span>"),"TEMP_FAILURE"!==b&&"PERM_FAILURE"!==b||(d+='<span class="zmDel_failLnk">'+c.mailDeliveryStatus.common.knowwhy+"</span>"),d+="</div>"},w=function(a){var b="";return a&&(b='<div class="zmDel_failMsg"><p>'+a+"</p></div>"),b},x=function(a){var b="";return b+='<li eid="'+a.rcpt+'">',k>1&&k<10&&8!==k&&(b+=v(a.deliveryTime,a.status)),b+=u(a.rcpt)+"</li>",6!==k&&7!==k&&10!==k&&9!==k||(b+=w(a.reason)),b},y=function(a){var b,c=i.length,d=0,e=!1;for(d=0;d<c;d++)if(b=i[d],b.rcpt===a){e=!0;break}return e},z=function(){var a,c,d=i.length,e="";for(a=0;a<d;a++)c=i[a],e+=x(c),p[c.rcpt]=c.status;if(k>0&&k<5||8===k||9===k||10===k)for(d=b.undelivered.length,a=0;a<d;a++)c=b.undelivered[a],y(c)||(e+=x({rcpt:c,status:"",reason:"",deliveryTime:""}),p[c]="PERM_FAILURE");return e},A=function(){var a=$("#mail_delivery_status");return a.length||(a=$('<div id="mail_delivery_status" class="delStatus_content" data-msg="'+e.msgId+'">')),a},B=function(){var a,b,d="",e="",f=c.mailDeliveryStatus.common.member,g=c.mailDeliveryStatus.common.members,h="",j=0,l=0;if(7===k){for(a=0;a<m;a++)b=i[a]||{},"PERM_FAILURE"===b.status?(h+=x(b),l++):"SUCCESS"===b.status&&(e+=x(b),j++);d=['<div id=“mds_right” class="delStatus_rht">','<div class="partialMail_contact zmTV">',"<h4>"+c.mailDeliveryStatus.common.delivered+" "+j+" "+(j>1?g:f)+"</h4>",'<div class="SC_PUcen">','<ul class="SC_P2r">'+e+"</ul>","</div>","</div>",'<div class="partialMail_contact">',"<h4>"+c.mailDeliveryStatus.common.failure+" "+l+" "+(l>1?g:f)+"</h4>",'<div class="SC_PUcen">','<ul class="SC_P2r">'+h+"</ul>","</div>","</div>","</div>"].join("")}else d=['<div id=“mds_right” class="delStatus_rht">','<div class="singleMail_contact">','<ul class="SC_P2r">'+z()+"</ul>","</div>","</div>"].join("");return d},C=function(){var b=a("zmList"),c=b.getMailObj(l),e=void 0;if(c.RS&&c.RS!==-1){var f={1:"rcProcess",2:"rcParSucc",3:"rcFailed",4:"rcSuccess",5:"rcNonOrg"};e=zdom("div",null,zdom("h3",{id:"mdsHeader"},zdom("span",{id:"mdsTitle"},o.statusTitle[f[c.RS]])),zdom("p",null,zdom("span",{id:"mdsContent"},o.statusContent[f[c.RS]]),zdom("font",{id:"helpRS","class":"SC_ldot"},o.common.learnmore)))}else{if(e=zdom("div",null,zdom("h3",{id:"mdsHeader"},zdom("span",{id:"mdsTitle"},r[k])),zdom("p",null,zdom("span",{id:"mdsContent"},s[k]))),b.haveMailRecallSupport(l)){var g=zdom("div",{id:"RCOpt","class":"zmRecallPopTxt"},zdom("div",null,zdom("span",{"class":"zmRbr"},zdom("i",{"class":"msi-recall "+d.jsCls.rsIcon}),zdom("span",{id:"rsText"},o.common.recallOpt)),zdom("i",{"class":"msi-infoRound zmDoubleIcon"})));if("false"===zmail.isPaidUser&&!zmail.isInternalOrgUser){_zm(".","zmRbr",g)[0].classList.add("zmUpgrade");var h=zdom("div",{"class":"zmUpgradeTxt"},zdom("i",{"class":"msi-fav"}),o.common.upgrade);g.appendChild(h)}_zm("<","h3",e)[0].appendChild(g)}q&&_zm("<","p",e)[0].appendChild(q)}return e.innerHTML},D=function(){var a=[];return a=['<div class="delStatus_row">','<div id=“mds_left” class="delStatus_lft">'+C(),k>1&&k<5?'<p><a id="mds_update" class="SC_lnk">'+c.mailDeliveryStatus.common.refresh+"</a>  "+c.mailDeliveryStatus.common.inprogresstext+"</p>":"",6===k||7===k||8===k?'<div id="mds_resend" class="SC_PUbtm"><span>'+c.mailDeliveryStatus.common.resend+"</span></div>":"","</div>",B(),"</div>"].join("")},E=function(){var a=g.find("li");a.each(function(a,b){var c=$(b).attr("eId");c&&zmail.ContactBook.get({eid:c}).then(function(a){var d,e=a[0];d=e?e.avatar():zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(c),avatarBgColor:zmail.ContactBook.Utils.colorClasses()}),$(b).find("img").remove(),$(b).append(d)})})},F=function(){var a,b,c,d;g.length&&(a=g.find("#mds_update"),b=g.find(".zmDel_failLnk"),c=g.find("#mds_resend"),d=g.find("#helpDF"),a.length&&a.off("click").on("click",function(){f.getMailDeliveryStatus(l,!0,n)}),b.length&&b.off("click").on("click",function(){var a=$(this).closest("li");a.next().slideToggle(),a.toggleClass("zm_failMsg")}),c.length&&c.off("click").on("click",function(){n.remove(),zmUtil.invokeComposer({mode:"eanew",msgId:l,recipientList:p})}),d.length&&d.off("click").on("click",function(){6===k?window.open("//www.zoho.com/mail/help/how-email-works.html#alink1","_blank").focus():7===k&&window.open("//www.zoho.com/mail/help/how-email-works.html#alink2","_blank").focus()}),g.on("click","#helpRS",function(a){window.open(zmail.urls.helpURL+"recall-sent-email.html","_blank").focus()}),g.on("click","#RCOpt",function(a){var b=a.target;_zm.hasClass(b,"msi-infoRound")?window.open(zmail.urls.helpURL+"recall-sent-email.html","_blank").focus():_zm.hasClass(b,"zmUpgradeTxt")||_zm.hasClass(b,"msi-fav")?window.open("//www.zoho.com/workplace/pricing.html","_blank").focus():ZMail.recall.init({mId:l,mdsRef:$(b.closest("#mail_delivery_status"))})}))};if(b.undelivered.length){var G,H=b.undelivered.length,I=0;for(I=0;I<H;I++)G=b.undelivered[I],0===G.indexOf(l)&&(b.undelivered[I]=b.undelivered[I].substring(l.length+1,G.length)),y(b.undelivered[I])||m++}!h&&A().parent().length&&(h=!0),h?(g=A(),g.html(D()),E(),F()):(g=A(),g.html(D()),j.$content=g,j.ignoreMouseDown=!1,j.contentWrapperClass="SC_PU singleMail_DelStatus zmSnd_stsPopup",j.dialogDidMount=function(){},j.dialogWillMount=function(){E(),F()},n=Dialog["new"](j)),k!==zmList.getMailObj(l).MDS&&f.updateMailDeliveryStatus({module:"mail",MDS:k,M:l,ignorePopupUpdate:!0})}},f.updateMailDeliveryStatus=function(a){var b=a.M;a.MDS=parseInt(a.MDS);var g=zmList.getMailObj(b),h=a.ignorePopupUpdate||!1,i="",j=a.MDS;if(6===j||7===j){var k=zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH");k.updateCount(zmail.folId.sId,"inc"),zmUtil.updSendErrorStatus(!0,zmail.folId.sId)}if(g&&j!==g.MDS){if(i=g.MDS,j>1&&j<5&&i>1&&i<5||j<5&&i>4)return;if(zmCache.updateObj({mode:"upd",msgId:b,key:"MDS",val:j}),zmUtil.getFolId()===zmail.folId.sId){var l,m=zmCenterListing.mailObjectAPI.getViewObject(b,"zm_Container"),n={0:"",1:c.mailDeliveryStatus.statusTitle.queued,2:c.mailDeliveryStatus.statusTitle.inprogress,3:c.mailDeliveryStatus.statusTitle.inprogress,4:c.mailDeliveryStatus.statusTitle.inprogress,5:c.mailDeliveryStatus.statusTitle.success,6:c.mailDeliveryStatus.statusTitle.failure,7:c.mailDeliveryStatus.statusTitle.failure,8:c.mailDeliveryStatus.statusTitle.undo,9:c.mailDeliveryStatus.statusTitle.retry,10:c.mailDeliveryStatus.statusTitle.retry},o=function(a,b){var c="",f=a.find(".zmSndSts-anipro"),g=a.find(".zmSndStsCon");!f.length&&b>1&&b<5&&(c='<span class="zmSndSts-anipro"><span class="zmSndSts-Inpro zm_delspinner"></span><span class="zmSndSts-Inpro zm_delfiller"></span><span class="zm_delmask"></span></span>'),a.length?(!f.length||b>1&&b<5?g.prepend($(c)):f.remove(),g.attr("class","zmSndStsCon "+zmInit.classObj.mdsParentClass[b]),10===i&&2===b&&g.addClass("zmSndSts-fpro"),a.find("i").removeClass().addClass(zmInit.classObj.deliverySts[b]+" jsMDSIcon"),a.attr("title",n[b])):(a='<div class="'+e.mdsOuter+" "+d.jsCls.mdsStaus+'" title="'+n[b]+'"><div class="zmSndStsCon '+zmInit.classObj.mdsParentClass[b]+'" >'+c+'<span class="zmSndStsIco"><i class="'+zmInit.classObj.deliverySts[b]+' jsMDSIcon"></i></span></div></div>',$(a).insertAfter(m.find("."+e.mRowCenter)))};m&&(m=$(m.$element),m.length&&(l=m.find("."+e.mdsOuter),1!==j?o(l,2):o(l,j),j>4&&(l.length||(l=m.find("."+e.mdsOuter)),setTimeout(function(){o(l,j)},1500))))}!h&&$("#mail_delivery_status").length&&$("#mail_delivery_status").attr("data-msg")===b&&f.getMailDeliveryStatus(b)}},f}),define([],function(a){var b=zmail.Core.Namespaces,c=zmText.get("mail"),d=b.create("ZMail.recall"),e=ZMail.lConstants,f={},g=c.listing.mailDeliveryStatus,h=function(a,b){var c=function(a,c){_zm.succErrMsg("i",g.common.recallSucc,{hideAfter:2e3,parElem:b})},d=function(a,c,d,e){_zm.succErrMsg("e",g.common.recallFail,{parElem:b})},e={u:zmail.conPath+"/mA.do",t:"POST",fn:c,efn:d,ep:{mId:a},p:{mode:"recall",mailId:a}};zmAjq.XHR(e)};d.updateStatus=function(b,c){var d=a("zmList");if(d.getMailObj(b)){d.updateModel("RS",c,b);var h={1:"rcProcess",2:"rcParSucc",3:"rcFailed",4:"rcSuccess",5:"rcNonOrg"},i=f[b]||{};if(i.listRef){var j=i.listRef.find("."+e.jsCls.mdsStaus);j.after(ZMail.lView.constTemplate("RSICON",{tooltip:g.tooltips[h[c]],cls:zmInit.classObj.recallStatus[c],gif:1===c})),j.remove(),1!==c&&_zm.succErrMsg("i",g.statusContent[h[c]],{hideAfter:2e3,parElem:i.mdsRef&&i.mdsRef[0]})}if(i.mdsRef){i.mdsRef.find("#mdsTitle").text(g.statusTitle[h[c]]),i.mdsRef.find("#mdsContent").text(g.statusContent[h[c]]);var k=i.mdsRef.find(".zmRecallPopTxt");1===c?(k.html(""),k.append(zdom("img",{src:zmResource.get("image","mail/recall-2x.gif"),width:"14px"})),k.append(zdom("span",null,g.common.recallPros))):k.closest("#RCOpt").remove()}c&&1!==c&&delete f[b]}};var i=function(a){var b=Dialog["new"]({title:g.common.recallOpt,ignoreMouseDown:!1,$content:"<p>"+g.common.mdsConfirmation+"</p>",buttons:[{name:c.actions.common.ok,callback:function(){h(a.mId),b.remove()}},{name:c.actions.common.cancel,callback:function(){b.remove(),delete f[a.mId]}}]})},j=function(a,b){var d=zdom("div",{"class":"SC_simg js-rConf",style:{display:"none"}},zdom("p",null,g.common.mdsConfirmation),zdom("div",{"class":"SC_PUbtm"},zdom("span",{id:"ok",tabIndex:"1"},c.actions.common.ok),zdom("span",{id:"cancel","data-val":"Cancel"},c.actions.common.cancel)));return d=$(d),d.find("#ok").off("click").on("click",a),d.find("#cancel").off("click").on("click",b),d};return d.init=function(a){if("false"!==zmail.isPaidUser||zmail.isInternalOrgUser)if(f[a.mId]=a,a.listRef=zmCenterListing.mailObjectAPI.getViewObject(a.mId,e.tab).$element,a.mdsRef&&a.mdsRef.length){a.mdsRef.addClass("zmTxtDisabled");var b=j(function(){b.remove(),a.mdsRef.removeClass("zmTxtDisabled"),h(a.mId,a.mdsRef[0])},function(){b.slideToggle(300,"linear",function(){b.remove()}),a.mdsRef.removeClass("zmTxtDisabled"),delete f[a.mId]});a.mdsRef.find("#mdsHeader").after(b[0]),b.slideToggle(300,"linear")}else i(a)},d}),function(){var a=zmail.Core.Namespaces,b=zmText.get("mail"),c=b.listing,d=a.create("zmail.Listing.Handlers.SchemaActions"),e=function(a,b){var d=zmList.getMailObj(a);if(a&&d&&d.SCOBJ[0]){var e,f=d.SCOBJ[0];f.ASTATUS=!0,b.suppress||_zm.succErrMsg("s",c.quickactions.success);var g=ZMail.lConstants.cls;"CONFIRMACTION"===b.actName||"SAVEACTION"===b.actName?(e=$("#"+a+"  span."+g.qckAct),!e.length&&d.TH&&(e=$("#t"+a+"  span."+g.qckAct)),e.length&&e.each(function(a,b){$(b).html("<font class='SC_op3'>"+_zm.escapeTags(f.DN)+"</font>"),$(b).append("<i class='msi-tick "+g.qckAct+"'></i>")})):"REVIEWACTION"===b.actName?(f.RB=b.reviewBody||"",f.RR=b.reviewRating):"RSVPACTION"===b.actName&&(f.RSVPSTUS=b.rsvpStatus.toLowerCase(),e=$("#"+a+"  span."+g.qckAct),!e.length&&d.TH&&(e=$("#t"+a+"  span."+g.qckAct)),e.length&&e.each(function(a,d){$(d).text(c.quickactions.attending+" : "+b.rsvpStatus),$(d).append("<i class='msi-rsvp "+g.qckAct+"'></i>")}))}},f=function(a,b,c){if(a&&b){c=c||{};var d={msgId:b,accountId:zmail.accId,actName:a.SCATYPE},f=$.extend({},d);c.evtstatus?(d.rsvpStatus=c.evtstatus.toLowerCase(),f.rsvpStatus=c.evtstatus):c.reviewRating&&(d.reviewRating=f.reviewRating=c.reviewRating,c.reviewBody&&(d.reviewBody=f.reviewBody=c.reviewBody));var g=function(a,c){"SUCCESS"===a.ASTATUS&&e(b,c)},h=function(a){_zm.succErrMsg("e",a.msg)};if(!a.ASTATUS||"RSVPACTION"===a.SCATYPE){var i={u:zmail.conPath+"/executeActSchema.do",t:"POST",fn:g,onerror:h,p:d,ep:f};zmAjq.XHR(i)}}},g=function(a,b,c){var d=$(a).data().value||"";d&&c&&!c.EXPIRED&&(f(c,b,{evtstatus:d}),zmUtil.hideMenu())},h=function(a){if(a){var b=a.GURL||a.AURL;if(b=b?decodeURIComponent(b):a.ORDEROBJ&&a.ORDEROBJ.VIEWORDERURL||a.FLYTTKTOBJ&&a.FLYTTKTOBJ[0].url||a.PARCLDLVRYOBJ&&a.PARCLDLVRYOBJ.TRACKINGURL,a.ZMAIL_INTERNAL_SERVICE&&"task"===a.ZMAIL_INTERNAL_SERVICE){var c=zmHash.decode(b);if("stream"===c.key){var d=c.params;zmUtil.loadStreamsInTab({pid:d[1],gid:d[0],etype:d[2],actionType:d[3],commentId:d[4]})}else{var e=window.open(b,"_blank");e.focus()}}else{var f=window.open(b,"_blank");f.focus()}}},i=function(a,b){a&&f(a,b)},j=function(a,b,d){var e=$(a).data().value||"";if("publish"===e){var g,h,i;if(i=$(a).closest("ul"),g=i.find("#zm_reviewbody").val(),h=i.find(".sel").length,0===h)_zm.succErrMsg("e",c.quickactions.alertrating);else if(d.REVPARAM){var j={};j=g?{reviewRating:h,reviewBody:g}:{reviewRating:h},f(d,b,j),zmUtil.hideMenu()}}else if(0===e.indexOf("rate")){var k=e.substring(4)||0,l=$(a).closest("li").find(".msi-fav"),m=l.length,n=0;for(k=parseInt(k),l.removeClass("sel"),n=1;n<=k;n++)l.eq(m-n).addClass("sel")}},k=function(a,b,d){if(a&&d.length){var e,f={},g="",h="",i="",k="SC_Rating yetToRate",l=c.quickactions.reviewcomment,m="";for(a.ASTATUS&&(l=_zm.escapeTags(a.RB||""),m="readonly",h="sel",k="SC_Rating"),e=a.RWR;e<=a.RBR;e++)i=e<=a.RR?"msi-fav "+h:"msi-fav",g='<i class="'+i+'" data-value="rate'+e+'" title="'+e+'"></i>'+g;var n=["<li><b>"+a.DN+"</b></li>",'<li style="width:200px">'+_zm.escapeTags(a.DESC||"")+"</li>",a.SHOWRB?'<li><textarea tabindex="0" placeholder="'+l+'" maxlength="1500" id="zm_reviewbody" '+m+"></textarea></li>":"",'<li><div class="'+k+'"><div>'+g+"</div></div></li>"];a.ASTATUS||(n=n.concat(['<li><div class="SC_PUbtm"><span data-value="publish">'+c.quickactions.submit+"</span></div></li>"])),n=n.join(""),f={par:d,showArrow:!0,liDom:$(n),spanClass:"minwid",ulClass:"noclass",clk:function(c,d){j(d,b,a)}},zmsuite.showMenu(f)}},l=function(a,d,e){if(a&&e.length){var f,h,i,j,k,l={},m=a.EXPIRED,n="",o="",p="";f=new Date(a.SD),a.ED&&(h=new Date(a.ED));var q=function(){var a=(new Date).getTime(),b=f.getTime(),c=h&&h.getTime();return!!(a>=b&&(c&&a<c||!c))},r=q();if(m||r){n="zmsEventExpired",o="zmEvExp";var s;s=r?c.quickactions.ongoing:c.quickactions.expired,p='<div class="zmEventTag"><span>'+s+"</span></div>"}var t={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"},u={0:b.days.sun,1:b.days.mon,2:b.days.tue,3:b.days.wed,4:b.days.thu,5:b.days.fri,6:b.days.sat};i=t[f.getMonth()],j=f.getDate();var v=function(){var a=!0;return h&&(a=f.getFullYear()===h.getFullYear()&&f.getDate()===h.getDate()&&f.getMonth()===h.getMonth()),a},w=function(a){var b="",c="",d="";return c=a.getHours().toString(),1===c.length&&(c="0"+c),d=a.getMinutes().toString(),1===d.length&&(d="0"+d),b=c+":"+d},x=function(){var a="";return a=v()?[u[f.getDay()],w(f),"-",w(h)].join(" "):t[f.getMonth()]+" "+f.getDate()+" "+f.getFullYear()+" "+w(f)+" - "+t[h.getMonth()]+" "+h.getDate()+" "+h.getFullYear()+" "+w(h)};k=x();var y={yes:"",no:"",maybe:""};a.ASTATUS&&(y[a.RSVPSTUS]="sel");var z=['<div class="zmsEventAction '+n+'">'+c.quickactions.query+'<ul><li class="'+y.yes+'" data-value="Yes">'+c.quickactions.yes+"</li>","true"===a.SHOWMB&&a.MBURL?'<li  class="'+y.maybe+'" data-value="Maybe">'+c.quickactions.maybe+"</li>":"",'<li class="'+y.no+'" data-value="No">'+c.quickactions.no+"</li>","</ul></div>"].join(""),A=[a.PADDR.ADDRNAME?a.PADDR.ADDRNAME+",":"",a.PADDR.ADDRBOXNO?a.PADDR.ADDRBOXNO+",":"",a.PADDR.STREET?a.PADDR.STREET+",":"",a.PADDR.ADDRLOCALITY?a.PADDR.ADDRLOCALITY+",":"",a.PADDR.ADDRREGION?a.PADDR.ADDRREGION+",":"",a.PADDR.ADDRCOUNTRY?a.PADDR.ADDRCOUNTRY+",":"",a.PADDR.ADDRPCODE?a.PADDR.ADDRPCODE:""].join(" ");A=A.trim(),A.endsWith(",")&&(A=A.substring(0,A.length-1)+" "),A=_zm.escapeTags(A);var B=['<div class="zmsEventCal zmEventInfo '+o+'">',"<span>"+i+"</span><span>"+j+"</span>",p,"</div>"].join(""),C=['<div class="zmsEventDtl">','<div><i class="msi-clock"></i><strong>'+k+"</strong></div>",A.length?'<div><i class="msi-location"></i>'+A+"</div>":"",z,"</div>"].join(""),D=["<li><h3>"+a.DN+"</h3>",'<div class="zmsEventPost '+n+'"><div class="zmsEventWra">',B,C,"</div></div></li>"].join("");l={par:e,showArrow:!0,liDom:$(D),spanClass:"minwid",ulClass:"noclass",clk:function(b,c){g(c,d,a)}},zmsuite.showMenu(l)}},m=function(a,b){var c,d=a.msgId;if(d&&0===d.indexOf("t")&&(d=d.substring(1)),c=zmList.getMailObj(d),c&&c.SCOBJ){var e,f;switch(f=c.SCOBJ[0],e=f.SCATYPE){case"VIEWACTION":case"TRACKACTION":case"ORDER":case"FLIGHTRESERVATION":case"PARCELDELIVERY":h(f,e);break;case"SAVEACTION":case"CONFIRMACTION":i(f,d);break;case"REVIEWACTION":k(f,d,b);break;case"RSVPACTION":l(f,d,b)}}};d.processSchemaAction=m,d.updateSchemaAction=e}(),function(){var a=zmail.Core.Namespaces,b=zmText.get("mail"),c=b.listing,d=b.actions,e=a.create("zmail.Listing.Handlers.SweepAction"),f=function(){zmsDialog.remove(),$("#sweeppopup").remove()},g=function(a,b,d){if((d||a.length)&&b.length){var e=[],g=[];if(d=d||a.find(".msi-option").data("value"),b.find(".msi-check").each(function(){e.push($(this).data("value")),g.push($(this).data("msg"))}),0===e.length)return void zmUtil.succErrMsg("i",c.sweep.selonesender);if(e.length>5)return void zmUtil.succErrMsg("i",c.sweep.sellimit);if(!d)return void zmUtil.succErrMsg("i",c.sweep.seloption);var h={mode:"sweep",senderList:e,actionType:d,msgId:g,thd:[]};zmail.MailAction.Initializer.doActions("sweep","dropdown",h),f()}},h=function(a){var b,e,h,i="",j=0,k="msi-check";if("zm_Container"===zmTab.currentTab)if(zmUtil.isFolderId(zmUtil.getFolId())){var l=zmInit.findFolName(zmUtil.getFolId());e=c.sweep.title+" - "+l,h=zmText.applyArgs(c.sweep.sweepmsg,{foldername:l})}else e=c.sweep.titleAllFol,h=c.sweep.acrossFoler;for(a.length>5&&(k="msi-uncheck"),j=0;j<a.length;j++)i+='<li class="senderid"><i class="'+k+'" data-msg="'+a[j].msgId+'" data-value="'+a[j].emailId+'"></i><label>'+a[j].emailId+"</label></li>";b=['<div id="sweeppopup" style="display:none">','<ul class="zm_formArea zmListReset">',"<li>"+h+"</li>"+i,"</ul>","</div>"].join(""),b=$(b);var m=b.find(".action_type"),n=b.find(".senderid");n.off("click").on("click",function(a){var b=a.srcElement||a.target;b=$(b),b.length&&(b=b.closest("i").length?b.closest("i"):b.closest("li").find("i"),b.hasClass("msi-check")?b.removeClass().addClass("msi-uncheck"):b.hasClass("msi-uncheck")&&b.removeClass().addClass("msi-check"))}),m.off("click").on("click",function(a){var b=a.srcElement||a.target;b=$(b),b.length&&(b=b.closest("i").length?b.closest("i"):b.prev(),(b.hasClass("msi-option")||b.hasClass("msi-unoption"))&&(m.find("i").removeClass().addClass("msi-unoption"),b.removeClass().addClass("msi-option")))}),$("body").append(b);var o={title:e,style:{width:"500px"},buttons:[{txt:d.common.archive,selected:!1,callback:function(){g(m,n,"archive")}},{txt:d.common["delete"],selected:!1,callback:function(){g(m,n,"delete")}},{isCancel:!0,txt:d.common.cancel,callback:function(){f()}}],drag:!0,mask:!0,hideclose:!1,pos:"center",closeaction:function(){f()}};zmsDialog.create("sweeppopup",o)},i=function(a){var b,d=[],e=[],f=0,g=0;a||(a=zmUtil.getSelectedMails(),a=a[0].concat(a[1])),g=a.length;var i=function(a){return a=a.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"'),a.indexOf("<")!==-1&&(a=a.substring(a.lastIndexOf("<")+1,a.lastIndexOf(">"))),a=a.trim()};for(f=0;f<g;f++)b=zmList.getMailObj(a[f]).F,b&&(b=i(b),d.indexOf(b)===-1&&(d.push(b),e.push({msgId:a[f],emailId:b})));0===d.length?zmUtil.succErrMsg("i",c.sweep.selone):h(e)};e.performSweepAction=i}(),function(){var a=zmail.Core.Namespaces,b=zmText.get("mail").listing,c=a.create("zmail.Listing.Handlers.Integrations");c.associateDialog=function(a){var d,e,f,g,h,i=a.msgId,j=zmList.isRMOBJ(i),k={text:b.mailAssociates.titleReminder,selected:!0,tabName:"watch",onClk:function(b){zmWatch.listDialog(a,b)},buttons:[{text:b.mailAssociates.updateReminder,onClk:function(b){var c=a.msgId,d=b.getButtonContainer().find("span").eq(0);d.attr("id","zmWatch_save_"+c),zmWatch.addWatch(c,d)}}]},l=function(){$.unsubscribe("zm/closeAllOpenDialog",h)},m=zmList.getMailObj(a.msgId);if((32|m.MA)===m.MA){var n=function(b,c){return{mailId:a.msgId,mountingElem:b,listParam:{showHeader:!1,dialog:c}}};d={text:b.mailAssociates.titleTask,hideCloseButton:!0,tabName:"task",onClk:function(b){b.showLoadingBand("task");var d=b.getCenterElem("task"),e=n(d,b);e.taskPreCallback=function(){b.removeLoadingBand("task"),b.hideButtons("task")},c.taskAssociates(a.msgId,e)},icons:[{iconClass:"msi-add",selected:!0,text:b.mailAssociates.addTask,onClk:function(d){var e=d.getCenterElem("task");zmUtil.loadTask({action:"addAsTask",addparams:{msgid:a.msgId,accid:zmail.accId,senderid:m.F},groupId:zmail.zuid,tasks:{SUMMARY:m.SM,TITLE:m.SB}},function(f){d.getCenterElem("task").html(f.$el),f.setHeightforEle(),d.replaceButtons([{text:b.mailAssociates.add,onClk:function(){var b=n(e,d);f.addTask(c.taskAssociates.bind(c,a.msgId,b))}},{text:b.mailAssociates.cancel,onClk:function(){var b=n(e,d);c.taskAssociates(a.msgId,b)},attr:{"data-val":"Cancel"}}],"task")}),d.showButtons("task")}}]}}if((64|m.MA)===m.MA){var o,p;e={text:b.mailAssociates.titleNotes,hideCloseButton:!0,tabName:"notes",onClk:function(b){b.showLoadingBand("notes"),o=function(){b.removeLoadingBand("notes"),b.hideButtons("notes")},p=function(a){b.configOption.onClose=function(){l(),ReactDOM.unmountComponentAtNode(b.getCenterElem("notes")[0])}},c.notesAssociates(a.msgId,{mountingElem:b.getCenterElem("notes"),preCallback:o,postCallback:p})},icons:[{iconClass:"msi-add",selected:!0,text:b.mailAssociates.addNotes,onClk:function(b){var c={addparams:{msgid:a.msgId,accid:zmail.accId,senderid:m.F}};zmUtil.loadNotes("popup",c),b.showButtons("notes")}}]}}(4|m.MA)===m.MA&&(f={text:zmText.applyArgs(b.mailAssociates.titleProjects,{companyName:zmail.globalI18N.companyName}),tabName:"projectsEntity",hideCloseButton:!0,onClk:function(b){b.showLoadingBand("projectsEntity"),zmUtil.loadProjects(function(){b.removeLoadingBand("projectsEntity"),zmail.projectsInteg.util.listProjectsEntities(a.msgId,b.getCenterElem("projectsEntity"))})}}),m.MSGREL&&m.MSGREL.indexOf("1")>-1&&(g={text:b.mailAssociates.titleEvent,tabName:"eventsEntity",hideCloseButton:!0,onClk:function(b){b.showLoadingBand("eventsEntity"),zmUtil.loadEvents(function(){b.removeLoadingBand("eventsEntity"),zmail.eventInteg.util.listEvents(a.msgId,b.getCenterElem("eventsEntity"),b)})},icons:[{iconClass:"msi-add",selected:!0,text:b.mailAssociates.addEvent,onClk:function(b){zmUtil.loadEvents(function(){zmail.eventInteg.util.addEvent(a.msgId,function(){b.getCenterElem("eventsEntity").html(""),g.onClk(b)})})}}]});var q={};q.tabs=[],j&&q.tabs.push(k),d&&q.tabs.push(d),q.onClose=function(){l(),d&&zmUtil.requireTaskModule("taskMail").done(function(){zmTask.Integrations.Mail.unsubscribeTaskListeners()})},q.ignoreMouseDown=!0,zmUtil.isNoteReactUser()&&(64|m.MA)===m.MA&&q.tabs.push(e),(4|m.MA)===m.MA&&q.tabs.push(f),g&&q.tabs.push(g),j||(q.tabs[0].selected=!0);var r=zmsDialog.createTabPopupDialog(q);h=function(){r.close()},$.subscribe("zm/closeAllOpenDialog",h)},c.taskAssociates=function(a,b){var d={taction:"getTasksAssociatedMail",msgid:a,accid:zmail.accId,streamsView:!0},e=$.extend(!0,{},b);zmAjq.XHR({u:zmail.conPath+"/getTasks.do",t:"POST",fn:c.showTaskAssociates,p:d,ep:e})},c.notesAssociates=function(a,b){var d={mode:"getMailNotes",messageId:a,accid:zmail.accId,streamsView:"Notes"},e=$.extend(!0,{},b);e.mailId=a,e.accId=zmail.defAccId,zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:c.showNotesAssociates,p:d,ep:e})},c.showNotesAssociates=function(a,b){try{b.preCallback();var c={id:"mailassociated",msgid:b.mailId,accid:b.accId,senderid:zmList.getMailObj(b.mailId).F},d=b.listParam;zmUtil.loadNotes("notelist",{data:a,extraparams:{options:d,listInfo:c},mountingElem:b.mountingElem,postCallback:b.postCallback})}catch(e){zmUtil.debugLog(e)}},c.showTaskAssociates=function(a,b){try{var c="";b.preCallBk&&b.preCallBk(),b.listParam&&b.listParam.dialog&&(b.listParam.dialog.removeLoadingBand("task"),b.listParam.dialog.hideButtons("task")),zmUtil.requireTaskModule("taskMail").done(function(){c=zmTask.Integrations.Mail.generateTaskList(a,b),b.mountingElem&&(b.mountingElem.empty(),b.mountingElem.append(c))}),b.postCallBk&&b.postCallBk(c)}catch(d){zmUtil.debugLog(d)}}}();
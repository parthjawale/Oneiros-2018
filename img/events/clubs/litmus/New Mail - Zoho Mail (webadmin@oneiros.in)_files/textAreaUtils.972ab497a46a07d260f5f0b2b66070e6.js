"use strict";define([],function(a,b){var c=a("$"),d=a("zmail.Core.Namespaces"),e=a("zmail.Utils.DOM"),f=d.create("zmail.Utils.TextAreaResizer"),g={TextDIVWithWrapper:function(){return zdom("div",{id:"text-area-resizer-wrapper"},zdom("div",{id:"resize-duplicate"}))}},h={TextDIVWrapper:{opacity:"0",position:"fixed",left:"0",top:"0",padding:"0",margin:"0",overflow:"hidden",display:"block","pointer-events":"none",border:"none",outline:"none"},TextDIV:{opacity:"0",height:"auto","max-height":"auto","min-height":"auto",overflow:"hidden",display:"block",position:"static","pointer-events":"none"}},i={heightResize:50,scrollAdjust:50},j=function(){var a;return function(b){if(b=b||{},!a){var c=e.element(g.TextDIVWithWrapper());c.css(h.TextDIVWrapper),a=e.selector("#resize-duplicate",c),a.css(h.TextDIV),e.mount(c,document.body)}return a}}(),k=function(a){a=e.element(a,!0);var b,c={};return a&&"function"==typeof window.getComputedStyle?(b=window.getComputedStyle(a),Array.prototype.forEach.apply(b,[function(a){c[a]=b[a]}]),c):c},l=function(a){a=a||{};var b,c,d,e,f,g;e=a.scrollParent,f=a.scrollTopBeforeResize,g=a.scrollAdjustDuration,d=e.scrollTop(),c=Math.round(document.body.clientHeight/10),b=d-f,0!==b&&(b<0&&(c=-c),e.animate({scrollTop:e.scrollTop()+c},{duration:g,queue:!1,easing:"linear"}))},m=function(a,b){if(b=b||{},a){var d,f,g,m,n,o,p,q,r,s,t,u,v,w;if(v=i.heightResize,w=i.scrollAdjust,d=a.value||"",d=d.replace(/\n/gim,"\n_"),f=k(a),b.minHeight&&window.isFinite(b.minHeight)?g=b.minHeight:(g=f["min-height"],g=window.parseInt(g),window.isFinite(g)||(g=f["line-height"],g=window.parseInt(g),window.isFinite(g)||(g=0),g*=2)),g=g||0,f=c.extend(f,h.TextDIV),m=j(),n=m[0],m.css(f),m.text(d),o=n.offsetHeight+(b.heightPadding||0),o<g&&(o=g),p=a.offsetHeight,q=o-p,0!==q){u="hidden",b.maxHeight?(t="function"==typeof b.maxHeight?b.maxHeight():b.maxHeight,t<=0?t=o:o>=t&&(u="auto",v=0,w=0)):t=o,r=e.element(a).scrollParent(),s=r.scrollTop();var x=function(){"function"==typeof b.onResize&&b.onResize({element:e.element(a,!0),height:o,maxHeight:t,overflow:u,change:q}),l({scrollParent:r,scrollTopBeforeResize:s,scrollAdjustDuration:w})};e.setStyle(a,{"max-height":t+"px","overflow-y":u}),e.element(a).animate({height:o+"px"},{duration:v,easing:"linear",queue:!1,complete:x})}}};return f.resize=m,f}),define([],function(a,b){var c=a("$"),d=a("zmail.Core.Namespaces"),e=a("zmail.Utils.DOM"),f=d.create("zmail.Utils.TextArea"),g=function(a){a=e.element(a,!0);var b,c={};return a&&"function"==typeof window.getComputedStyle?(b=window.getComputedStyle(a),Array.prototype.forEach.apply(b,[function(a){c[a]=b[a]}]),c):c},h=function(a){return a.selectionEnd||a.selectionStart||0},i=function(a,b){b=b||{};var d=a.getBoundingClientRect(),f=d.width+"px",h=d.height+"px";b.autoWidth&&(f="auto");var i=zdom("div",null),j=g(a);return j=c.extend(j,{position:"absolute",top:"0",left:"0",width:f,height:h,opacity:"0",margin:"0","pointer-events":"none"}),e.setStyle(i,j),e.mount(i,document.body),i},j=function(a,b){var c=a.value||"";c=c.substr(0,b);var d=/(?:(?=\s*)([\S]+[^\S\n]*)$)/i,e=d.exec(c),f=e?e[1]:" ";return f},k=function(a,b){if(b=b||{},a=e.element(a,!0),!a)return null;var c=i(a,b),d=a.value||"",f=h(a),g=j(a,f);d=d.substring(0,f),d=d.substr(0,d.length-g.length);var k=zdom("span",{className:"content-span"},d),l=zdom("span",{className:"content-span-last-word"},g);c.appendChild(k),c.appendChild(l);var m=l.getBoundingClientRect();return e.unmount(c,!0),c=null,m},l=function(a,b){b=b||{};var c=e.element(i(a,b)),d=e.element(zdom("span",null));d.text(a.value),e.mount(d,c);var f=c[0].getBoundingClientRect();c.remove(),c=null,d=null,b.suppressResize||e.setStyle(a,{width:f.width+"px"});var g=f.width,h=f.height;return b.minWidth&&(g=Math.max(g,b.minWidth)),{width:g,height:h}};return f.findCurrentTypingWord=j,f.findCursorPosition=k,f.fitInputWidth=l,f});
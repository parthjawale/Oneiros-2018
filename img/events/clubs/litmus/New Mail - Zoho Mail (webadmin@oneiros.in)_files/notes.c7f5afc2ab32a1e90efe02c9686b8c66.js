"use strict";window.znNote=function(){var a,b,c,d,e,f,g;g={appid:"zm_notes",appicon:"msi-notes",modulename:"notes"},f=zmText.get("noteutil");var h={fav:f.fav,sharedtome:f.left.sharedtome};return a={switchView:function(){var b,c,d=$.extend(!0,{},znNote.noteListing.props.noteList);if(d.unmountCalled!==!0)if(znNote.lstDetails().type===d.listInfo.mode&&znNote.lstDetails().fId===d.listInfo.id){var e=[{}];e[0].Notes=d.toJSON(),e[0].page=d.options.page;var f={mode:d.listInfo.mode,id:d.listInfo.id,groupId:d.listInfo.groupId};f.noteView=znNote.noteView,f.isnew=!0;var g=function(d){d&&(znNote.noteListing=d,znNote.noteListing.props.noteList.on("remove",function(){if(this.length<25){var d=this.options.page;if(d&&"1"===d.showNextPage){var e=znNote.lstDetails();b=e.fId,c=e.type;var f=zmail.streamsHbaseReadEnabled?this.length+1:d.end,g={start:f};a.getNotes(c,b,g)}}}))};znNote.noteListing&&ReactDOM.unmountComponentAtNode(znNote.noteListing.props.noteList.mountingElem[0]),zNote.listRowNotes(e,f,d.mountingElem,g)}else a.getNotes(znNote.lstDetails().type,znNote.lstDetails().fId)},getNotes:function(b,d,e){znNote.currNoteId="";var f,g,h={limit:"25"},i={},j=znNote.lstDetails().groupId;if(e)e.start&&(h.start=e.start,i.isnew=!1),f=function(a,b){c.scrolling=!1,c.destroyLoadingDiv(),c.containerDiv&&c.containerDiv.remove(),i.groupId=j,b.currentObj=znNote.noteListing,i.noteView=znNote.noteView,zNote.listRowNotes(a,b,document.getElementsByClassName("SC_mclst SC_notes"))};else{i.isnew=!0,i.groupId=j;var k=function(c){c&&(znNote.noteListing=c,znNote.noteListing.props.noteList.on("remove",function(){if(this.length<25){var c=this.options.page;if(c&&"1"===c.showNextPage){var e=znNote.lstDetails();d=e.fId,b=e.type;var f=c.end,g={start:f};a.getNotes(b,d,g)}}}))};znNote.previousListingAjax&&"pending"===znNote.previousListingAjax.state()&&znNote.previousListingAjax.abort(),znNote.noteListing&&ReactDOM.unmountComponentAtNode(znNote.noteListing.props.noteList.mountingElem[0]),c.destroyLoadingDiv=zmComponent.loadingBand({container:znNote.listingDiv[0],type:"listing"}),f=function(a,b){c.scrolling=!1,c.destroyLoadingDiv(),i.noteView=znNote.noteView,znNote.noteListing?zNote.listRowNotes(a,b,znNote.noteListing.props.noteList.mountingElem,k):zNote.listRowNotes(a,b,document.getElementsByClassName("SC_mclst SC_notes"),k)}}"c"===b?("zn_catAll"===d?h.mode="getAllNotes":(h.mode="getCatNotes",h.catId=d),h.groupId=znNote.groupId,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"l"===b?(h.mode="getTagNotes",h.tagId=d,h.groupId=zmail.zuid,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"fav"===b?(h.mode="getAllFavNotes",h.groupId=zmail.zuid,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"sharedtome"===b?(h.mode="getNotesToMe",h.groupId=zmail.zuid,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"sharedbyme"===b?(h.mode="getMyNotes",h.groupId=zmail.zuid,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"byuser"===b?(h.mode="getAllNotes",h.userId=d,h.groupId=znNote.groupId,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"modifieddatedesc"===b?(h.mode="getNotesByModifiedDate","zn_catAll"!==d&&(h.catId=d),h.groupId=znNote.groupId,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType,h.isPrev=!1):"modifieddateasc"===b?(h.mode="getNotesByModifiedDate","zn_catAll"!==d&&(h.catId=d),h.groupId=znNote.groupId,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType,h.isPrev=!0):"archive"===b&&(h.mode="getArchiveNotes",h.groupId=znNote.groupId,g="GET",h.streamsView="Notes"),i.mode=b,i.id=d;var l={};return l.prm=h,l.eprm=i,l.t=g,znNote.previousListingAjax=a.sendListingRequest(l,f),znNote.previousListingAjax},sendListingRequest:function(a,b){return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:a.t||"POST",fn:b,p:a.prm,ep:a.eprm})},sendEditCatReq:function(a,d){var e,f,g;g=c.currLayId,e={mode:"editCat",catName:a,catId:d,groupId:g,streamsView:"Notes",actionType:"editCommonLabel"},f={mode:"editCat",groupId:g},zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",fn:b.left.cateResult,t:"POST",p:e,ep:f})},sendEditLabReq:function(a,b,c){var d,e={};a=$.trim(a),e={name:a,color:b,accId:zmail.defAccId,labId:znNote.labelId,mode:"e"},d={name:a,color:b,labId:znNote.labelId,mode:"e"},zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:c.fn,p:e,ep:d})},sendDelLabReq:function(a){var b={labId:znNote.labelId,mode:"d",accId:zmail.defAccId},c={labId:znNote.labelId,mode:"d"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:a.fn,p:b,ep:c})},delNoteCat:function(a){var d={mode:"delCat",catId:a,groupId:c.currLayId,streamsView:"Notes",actionType:"deleteCommonLabel"},e={catId:a,mode:"delCat",groupId:c.currLayId};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:b.left.cateResult,p:d,ep:e})}},b={left:{handleAddCategory:function(a,c,d){b.left.cateResult(c,d)},handleAddTag:function(a,c,d){b.left.tagResult(c,d)},cateResult:function(a,b){var d,e,f,g,h=b.mode;if(a&&a[0]&&(a[0].catId||"success"===a[0].response))if(g=b.groupId===zmail.zuid?"nviews":c.getGroupLayerName({groupId:b.groupId}),d=a[0],e=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(g),"addCat"===h){f={},f[d.catId]={},f[d.catId].name=d.category,f[d.catId].id=d.catId,f[d.catId].groupId=b.groupId,d.count=0;var i=zNote.catCacheObj[b.groupId].length;if(i>1){var j=zNote.catCacheObj[b.groupId][i-1].catId;e.insertNodeAfter(f,e.mapObject,j,b.groupId)}else e.appendNode(f,e.mapObject,b.groupId);znBox.updateCatCache(h,b.groupId,d)}else if("editCat"===h)f=e.getRowObjfromId(d.catId),f[d.catId].name=d.category,e.editNode(f,e.mapObject),znBox.updateCatCache(h,b.groupId,d),$.publish("/rename/notescat",[d]);else if("delCat"===h){f=e.getRowObjfromId(b.catId);var k=$.extend(!0,{},e.countObject[b.catId]);e.deleteNode(f,b.groupId),$.publish("note/updateCount",[{namespaceId:b.groupId,count:k.c,mode:"delCat"}]),znBox.updateCatCache(h,b.groupId,b),$.publish("/delete/notescat",[b.catId])}},tagResult:function(a,b){var c,d=a.labelId,e={};e[d]={color:a.color,id:a.labelId,label:a.displayName,dispName:a.displayName,fav:"true",se:a.sequence};var f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("zmllabelH");if("a"===b.mode){var g=_.findWhere(zmail.labInfo,{se:e[d].seq});g?f.insertNodeBefore(e,f.mapObject,g.id):f.appendNode(e,f.mapObject)}else"e"===b.mode?(c=f.getRowObjfromId(d),c[d].dispName=c[d].label=e[d].dispName,c[d].color=e[d].color,f.editNode(c,f.mapObject),$.publish("/rename/noteslabel",[b])):"d"===b.mode&&(c=f.getRowObjfromId(b.labId),f.deleteNode(c),$.publish("/delete/noteslabel",[b]));zmail.zohoAccLabInfo=$.extend({},f.getListObject()),zmail.accId===zmail.defAccId&&(zmail.labInfo=f.getListObject())}}},e={cmenuItemClick:function(d){var e,g;switch(d.action){case"EditLabel":e=c.rgtMenuId,zmlab.labelId=e,zmlab.showCreateTagPopUp({mode:"rename",accType:"default",callback:function(d,e,f){c.isValidLabel($("#zm_createlabelpopup").find("input").val(),"e")&&(g={fn:b.left.tagResult},a.sendEditLabReq($("#zm_createlabelpopup").find("input").val(),f,g),zmsDialog.remove())}}),$("#znCntxtMenu").hide();break;case"DelLabel":if(e=c.rgtMenuId,!e)return!1;var h={};h.onOk=function(){g={fn:b.left.tagResult},a.sendDelLabReq(g)},h.stopPropagation=!0,zmsDialog.confirm(f.deltag,h),$("#znCntxtMenu").hide();break;case"CreateCat":e=c.rgtMenuId,zmUtil.setEditable({ele:$("#znLTMenu_Nc"),target:$("#"+e),callback:c.cmenuActions,allowCondition:function(){if(!e)return!0},parentdiv:$("#znCntxtMenu")});break;case"EditCat":e=c.rgtMenuId;var i=!0,j=zNote.getNamefrmCatObj(e,c.currLayId);if(""===e||"zn_catAll"===e||"General"===j||!j)return!1;zmUtil.setEditable({ele:$("#znLTMenu_Rc"),target:$("#"+e).find(".zmTreWra"),callback:c.cmenuActions,initialize:!0,allowCondition:function(){return!!e&&i},parentdiv:$("#znCntxtMenu")});break;case"DelCat":if(e=c.rgtMenuId,h={},j=zNote.getNamefrmCatObj(e,c.currLayId),""===e||"zn_catAll"===e||"General"===j||!j)return znBox.hideMenu(),!1;h.onOk=function(){znBox.hideMenu(),a.delNoteCat(e)},h.stopPropagation=!0,zmsDialog.confirm(f.delbook,h)}}},c={currLayId:"",rgtMenuId:"",destroyLoadingDiv:"",scrolling:!1,nCMenuCatArr:[{htm:f.left.createBook,id:"znLTMenu_Nc",cEdit:!0,data:{action:"CreateCat"}},{sep:!0},{htm:f.left.renameBook,id:"znLTMenu_Rc",cEdit:!0,data:{action:"EditCat"}},{htm:f.left.deleteBook,id:"znLTMenu_Dc",data:{action:"DelCat"}}],nCMenuTagArr:[{htm:f.left.editTag,id:"znLTMenu_Rl",data:{action:"EditLabel"}},{htm:f.left.deleteTag,id:"znLTMenu_Dl",data:{action:"DelLabel"}}],nCMenuTagArr1:[{htm:f.left.createTag,id:"znLTMenu_Cl",cEdit:!0,data:{action:"CreateLabel"}},{htm:f.left.deleteTag,id:"znLTMenu_Dl",data:{action:"DelLabel"}}],actIconObj:{list:{left:{leftHTML:"",centerAlign:!0},right:[]}},actIconObj2:{list:{left:[{groupId:"filter",actionArr:[{iconList:["msi-filter"],dropAction:!0}]},{groupId:"sort",actionArr:[{iconList:["msi-sort"],dropAction:!0}]}],right:[{actionArr:[{iconList:["msi-thumbview"],data:"thumb",tooltip:f.tooltips.gridView},{iconList:["msi-listview"],data:"list",tooltip:f.tooltips.listView}]}]},clk:function(b,d){"msi-filter"===d?($(b.target).closest("li").find("b").addClass("SC_ddn"),zmsuite.showMenu({par:$(b.target).closest("li"),list:c.filterOptions(),align:"pleft",clk:function(b){var c="archive";a.getNotes(c);var d='{"fId":"'+znNote.lstDetails().fId+'","type":"'+c+'","groupId":"'+znNote.groupId+'"}';znNote.listingDiv.attr("data-detail",d),znNote.updateHeaderBandWithObj({groupId:znNote.groupId,mode:"archive"}),$("#zm_dropDown").remove(),$("[data-drop='1']").removeAttr("data-drop"),$(".SC_ddn").removeClass("SC_ddn")}})):"msi-sort"===d?($(b.target).closest("li").find("b").addClass("SC_ddn"),zmsuite.showMenu({par:$(b.target).closest("li"),list:c.filterOptions("sort"),align:"pleft"})):"msi-thumbview"===d?(zmsuite.getCenter()[0].getNodes()[2].$el.removeClass("zmLstvw"),zmsuite.getCenter()[0].$el.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(b.target).closest("b").addClass("SC_sel"),znNote.noteView=1,zmAdHocSettings.setNotes({stickyNotes:znBox.getAdhocSettingsStickyNotes(),listingType:zNote.CONSTANTS.viewName[znNote.noteView]}),a.switchView()):"msi-listview"===d&&(zmsuite.getCenter()[0].getNodes()[2].$el.addClass("zmLstvw"),zmsuite.getCenter()[0].$el.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(b.target).closest("b").addClass("SC_sel"),znNote.noteView=2,zmAdHocSettings.setNotes({stickyNotes:znBox.getAdhocSettingsStickyNotes(),listingType:zNote.CONSTANTS.viewName[znNote.noteView]}),a.switchView())}},filterOptions:function(a){var b;return b="sort"===a?[{htm:f.common.sortmodified+"<i class='msi-rarrow'></i>",data:{key:"datesort"},childCls:"SC_tin",child:function(){return c.dateSort()}}]:[{htm:"Archived Notes",data:{key:"archived"}}]},dateSort:function(){var b,c,d,e=[{htm:f.common.descend,data:{type:"mdate",key:"desc"}},{htm:f.common.ascend,data:{type:"mdate",key:"asc"}}],g={};return g.list=e,g.divId="zt_ddlist",g.clk=function(e){"desc"===e.key?(b="modifieddatedesc",c=znNote.lstDetails().fId,a.getNotes(b,c),d='{"fId":"'+c+'","type":"'+b+'","groupId":"'+znNote.groupId+'"}',znNote.listingDiv.attr("data-detail",d),znNote.updateHeaderBandWithObj({groupId:znNote.groupId,mode:"modifieddatedesc"}),znBox.hideMenu()):"asc"===e.key&&(b="modifieddateasc",c=znNote.lstDetails().fId,a.getNotes(b,c),d='{"fId":"'+c+'","type":"'+b+'","groupId":"'+znNote.groupId+'"}',znNote.listingDiv.attr("data-detail",d),znNote.updateHeaderBandWithObj({groupId:znNote.groupId,mode:"modifieddateasc"}),znBox.hideMenu())},g},pageDetails:function(){var a=znNote.listingDiv.attr("page-detail");if(a=$.parseJSON(a))return a},getFrameworkObject:function(){var a,b,c,d,e=$.extend(!0,{},zNote.catCacheObj),f={},g={},h={},i={};delete e[zmail.zuid];var j=[],k=[];for(var l in e)e.hasOwnProperty(l)&&(znBox.checkForGroupDisabled({groupId:l})?j.push(l):znBox.checkForGroupHidden({groupId:l})||k.push(l));d=k.length;var m=function(a){return function(c){if(k[a]!==zmail.zuid){if(c.id=c.catId,c.name=c.category,"General"!==c.category)return c.seq=b++,c.name=c.category,c.SE=c.seq,c.groupId=k[a],i[c.catId]={},i[c.catId].c=c.count,i[c.catId].p=k[a],c.catId;zNote.catIdGen[k[a]]=c.catId}}};for(a=0;a<d;a++)b=1,c=_.map(e[k[a]],m(a)),f[k[a]]={},f[k[a]].CH=_.object(c.slice(1,c.length),e[k[a]].slice(1,e[k[a]].length));var n=j.length,o=function(a){return function(c){if(j[a]!==zmail.zuid){if(c.id=c.catId,c.name=c.category,"General"!==c.category)return c.seq=b++,c.name=c.category,c.SE=c.seq,c.groupId=j[a],h[c.catId]={},h[c.catId].c=c.count,h[c.catId].p=j[a],c.catId;zNote.catIdGen[j[a]]=c.catId}}};for(a=0;a<n;a++)b=1,c=_.map(e[j[a]],o(a)),g[j[a]]={},g[j[a]].CH=_.object(c.slice(1,c.length),e[j[a]].slice(1,e[j[a]].length));return{newObject:f,countObject:i,disabledNewObject:g,disabledCountObject:h}},getCountAndChildObject:function(){var a,b=$.extend(!0,{},zNote.catCacheObj),c={};c[zmail.zuid]={},c[zmail.zuid].c=zNote.myNotesCount,c[zmail.zuid].p="-1";var d={},e=1;return d[zmail.zuid]={},a=_.map(b[zmail.zuid],function(a){return a.id=a.catId,a.name=a.category,"General"!==a.category?(a.seq=e++,a.name=a.category,a.SE=a.seq,a.groupId=zmail.zuid,c[a.catId]={},c[a.catId].c=a.count,c[a.catId].p=zmail.zuid,a.catId):void(zNote.catIdGen[zmail.zuid]=a.catId)}),d[zmail.zuid].CH=_.object(a.slice(1,a.length),b[zmail.zuid].slice(1,b[zmail.zuid].length)),{childObject:d,countObject:c}},getGroupLayerName:function(a){return znBox.checkForGroupDisabled({groupId:a.groupId})?"dgroups":"ngroups"},setChildToggle:function(){zmsuite.getLeft("zm_notes").setListener("click",znNote.znLeftClbk),zmsuite.getLeft("zm_notes").setListener("contextmenu",znNote.znLeftClbk),zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("ngroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("dgroups")&&zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("dgroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("nviews").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0})},getDisabledLayer:function(a){var b,c=a.disabledNewObject,d=a.disabledCountObject;if(!$.isEmptyObject(c)){var e=new ZMLayer,g=[],h={id:"hdgroups",showList:!1,name:"Disabled Groups"},i=$.extend(!0,{},zNote.groupObj);delete i[zmail.zuid];var j={name:"name",id:"id",groupId:zmail.zuid,count:"c",parentId:"p",notBold:!0,infoObject:"c",sequence:"SE",hasChild:"HC",expChild:"E"};g=_.omit(i,function(a,b,d){return _.indexOf(_.keys(c),b)===-1}),b=1,_.each(zNote.noteGroupOrderAndCount,function(a,e){if(c[a.groupId]){7===b&&_.keys(c).length>7&&(g.more={showNode:!0,id:"more",name:f.left.more,SE:b++,rowTitle:f.tooltips.viewallgroups,txtNodeClass:"SC_thm"},d.more={},d.more.c=0,d.more.p="-1");var h=g[a.groupId];zNote.catCacheObj[a.groupId]&&zNote.catCacheObj[a.groupId].length?h.HC=_.keys(c[a.groupId].CH).length:h.HC=0,d[a.groupId]={},d[a.groupId].c="-"===a.count?0:a.count,d[a.groupId].p="-1",h.E=0,h.id=a.groupId,h.SE=b++,b>=7&&(h.hideNode=!0),g[a.groupId].shouldshow=g[a.groupId].hideNode}}),g.more&&(g.less={hideNode:!0,id:"less",name:f.left.less,SE:b++,rowTitle:f.tooltips.hidegroups,txtNodeClass:"SC_thm"},d.less={},d.less.c=0,d.less.p="-1");var k={type:"1",hasChild:!0,hasCountObject:!0,mapObject:j,id:"dgroups",isHeaderSel:!1,avoidStateSave:!0,showList:!1,dataObject:{headerObject:h,listObject:g,childObject:c,countObject:d}};return e.push(k),e}},promoteGroup:function(a){var b=c.getGroupLayerName({groupId:a.group.id}),d=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(b),e=d.getRowObjfromId(a.group.id);if(d.getListObject()[a.group.id].shouldshow=!1,d.moveNode(e,d.mapObject),d.getListObject().more&&d.getListObject().more.SE>8){var f=_.findWhere(d.getListObject(),{SE:7});e=d.getRowObjfromId(f.id),d.moveNode(e,d.mapObject,"more"),d.getListObject()[f.id].shouldshow=!0,d.getListObject().more.hideNode||d.hideNode(f.id)}},showMoreOrLess:function(a,b){var c,d,e=Object.keys(a.rowObject)[0];"more"===a.rowObject[e].id?(c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(a.rowInfo.layerId),d=c.listObject,Object.keys(d).forEach(function(a){c.showNode(a,b)}),c.showNode("less",b),c.hideNode("more",b)):"less"===a.rowObject[e].id&&(c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(a.rowInfo.layerId),d=c.listObject,Object.keys(d).forEach(function(a){d[a].shouldshow?c.hideNode(a,b):c.showNode(a,b)}),c.showNode("more",b),c.hideNode("less",b),$("#"+a.rowInfo.layerId)[0].children[0].firstElementChild.scrollIntoView(),"function"==typeof b&&b())},constructLeft:function(){var a,d=[],e=zmsuite.getLeft("zm_notes"),h=e.getNodes();if("n"!==zmApp.selectedApp)return void zmsuite.deleteAppInfo(g.appid);var i={},j={},k={},l=c.getCountAndChildObject();j=l.childObject,k=l.countObject,i.fav={id:"fav",name:f.fav,SE:1,groupId:zmail.zuid},i.sharedtome={id:"sharedtome",name:f.left.sharedtome,SE:2,groupId:zmail.zuid},i[zmail.zuid]={id:zmail.zuid,name:f.myNotes,SE:3,groupId:zmail.zuid,HC:_.keys(j[zmail.zuid].CH).length,E:1};var m={dropdown:"min",id:"hviews",name:f.left.views},n=new ZMLayer,o={id:"id",name:"name",infoObject:"views",count:"c",parentId:"p",notBold:!0,sequence:"SE",hasChild:"HC",expChild:"E"},p={type:"1",mapObject:o,id:"nviews",isHeaderSel:!1,hasChild:!0,hasCountObject:!0,dataObject:{headerObject:m,listObject:i,childObject:j,countObject:k}};n.push(p),d.push(n),zNote.groupObj=zmCont.getGroup(),zNote.groupObj[zmail.zuid]={name:f.myNotes,id:zmail.zuid};var q=new ZMLayer,r=[],s={id:"hgroups",name:f.left.groups},t=$.extend(!0,{},zNote.groupObj);delete t[zmail.zuid],zmUtil.isNewGroupUser()&&(s.settingsOption=!0,s.settingsObject={className:"msi-manageGroup",onClick:function(){zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({groupManage:!0})})}},s.c="<i class='msi-plus'></i>",s.onAdd=function(){zmUtil.loadGroupManagement().then(function(){zmStreamsApp.GroupManageApp.init({createGroup:!0})})});var u={name:"name",id:"id",groupId:zmail.zuid,count:"c",parentId:"p",notBold:!0,infoObject:"c",sequence:"SE",hasChild:"HC",expChild:"E"},v=c.getFrameworkObject(),w=v.newObject,x=_.keys(w),y=v.countObject,z=1;r=_.omit(t,function(a,b,c){return _.indexOf(x,b)===-1}),_.each(zNote.noteGroupOrderAndCount,function(a,b){if(w[a.groupId]&&r[a.groupId]){7===z&&_.keys(w).length>7&&(r.more={showNode:!0,id:"more",name:f.left.more,SE:z++,rowTitle:f.tooltips.viewallgroups,txtNodeClass:"SC_thm"},y.more={},y.more.c=0,y.more.p="-1");var c=r[a.groupId];zNote.catCacheObj[a.groupId]&&zNote.catCacheObj[a.groupId].length?c.HC=_.keys(w[a.groupId].CH).length:c.HC=0,y[a.groupId]={},y[a.groupId].c="-"===a.count?0:a.count,y[a.groupId].p="-1",c.E=0,c.id=a.groupId,c.SE=z++,z>=8&&(c.hideNode=!0),r[a.groupId].shouldshow=r[a.groupId].hideNode}}),r.more&&(r.less={hideNode:!0,id:"less",name:f.left.less,SE:z++,rowTitle:f.tooltips.hidegroups,txtNodeClass:"SC_thm"},y.less={},y.less.c=0,y.less.p="-1");var A={type:"1",hasChild:!0,hasCountObject:!0,mapObject:u,showList:!0,id:"ngroups",isHeaderSel:!1,dataObject:{headerObject:s,listObject:r,childObject:w,countObject:y}};q.push(A),d.push(q);var B={dropdown:"min",id:"header2",name:f.left.tags,showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){$("div#zmCntxtMenu").remove(),zmlab.showCreateTagPopUp({mode:"new",accType:"default",callback:function(d,e,f){c.isValidLabel($("#zm_createlabelpopup").find("input").val(),"e")&&(a={fn:b.left.tagResult},znBox.sendNewLabReq(e,f,a),zmsDialog.remove())}})}},C=new ZMLayer,D=zmail.labInfo,E={name:"dispName",id:"id",count:"c",parentId:"p",color:"color",sequence:"se",infoObject:"l"},F={type:"2",mapObject:E,listId:"zmllabel",id:"zmllabelH",showList:!0,dataObject:{headerObject:B,listObject:D}};C.setHeaderObject(B),C.push(F),d.push(C);var G=c.getDisabledLayer(v);G&&d.push(G),h[0].push({layerArr:d}),e.render(),zmComponent.notifier.addHandler("streams",function(a,b){b.data.etype!==zNote.CONSTANTS.entityType||"true"!==b.data.grp||"30"!==b.data.ntype&&"37"!==b.data.ntype||c.promoteGroup(b.data)})},constructCenter:function(a){var b=zmsuite.getCenter(g.appid),d=b[0].getNodes();d[0].push(c.actIconObj2.list),d[0].setListener("click",c.actIconObj2.clk),c.actIconObj.list.left.centerAlign=!1,znNote.noteView=zNote.CONSTANTS.viewType[zmAdHocSettings.getNotes().listingType]||1,"list"===zNote.CONSTANTS.viewName[znNote.noteView]&&zmsuite.getCenter()[0].getNodes()[2].$el.addClass("zmLstvw"),d[1].push(c.actIconObj.list),znNote.listingDiv=zmsuite.getCenter(g.appid)[0].getNodes()[2].getListElem(),znNote.listingDiv.addClass("SC_notes"),"zm_notes"===zmTab.currentTab?zmsuite.renderCenter():zmsuite.renderCenter(zmsuite.getAppObj("zm_notes").centerObj),zmsuite.showApp(g.appid),zmsuite.getCenter(g.appid)[0].getNodes()[2].setListener("scroll",_.debounce(function(a){a.stopPropagation(),c.fillNotes()},1e3)),zmsuite.getCenter(g.appid)[0].getNodes()[2].setListener("scroll.noteHideMenu",znBox.hideMenu),zmsuite.getCenter(g.appid)[0].$el.find(".SC_frt").find("."+zNote.CONSTANTS.listTypeClass[znNote.noteView]).closest("b").addClass("SC_sel"),c.setChildToggle()},popup:function(a,b){if("options"===a){var c,d,e=[],f=b.length;for(d=0;d<f;d++)c=b[d]?["LI",{child:[["text",b[d]]]}]:["LI",{attrs:{"class":"SC_lne"}}],e.push(_zm.getDOM(c));return e}},isValidLabel:function(a,b){var c=$.trim(a.toLowerCase());if(zmUtil.hasSpecialChars(c,"labelName"))return zmUtil.succErrMsg("e",f.tagdata.errors.specialCharacters),!1;if(c.length>25)return zmUtil.succErrMsg("e",f.tagdata.errors.lengthExceeded),!1;if("info"===c||"important"===c||"follow-up"===c)return zmUtil.succErrMsg("e",f.tagdata.errors.retrictedWord),!1;if(!c)return zmUtil.succErrMsg("e",f.tagdata.errors.empty),!1;var d=zmUtil.getTagList("default");for(var e in d)if(("e"!==b||znNote.labelId!==e)&&d[e].label.toLowerCase()===c)return zmUtil.succErrMsg("e",f.tagdata.errors.exists),!1;return!0},cmenuActions:function(){var b,d,e;$("#znActionNewCategory[contentEditable='true']").length||$("#znLTMenu_Nc[contentEditable='true']").length?($("#znActionNewCategory[contentEditable='true']").length?(b=$("#znActionNewCategory").text(),d=c.currLayId?c.currLayId:zmail.zuid):(b=$("#znLTMenu_Nc").text(),d=c.currLayId),b=b.trim(),znBox.isValidCategory(b,d)&&(znBox.sendNewCatReq(b,e,d),$("#znLTMenu").hide(),$("#znCntxtMenu").remove()),znNote.currNoteId=""):$("#znLTMenu_Rc[contentEditable='true']").length&&(b=$("#znLTMenu_Rc").text(),d=c.currLayId,znBox.isValidCategory(b,d)&&(a.sendEditCatReq(b,c.rgtMenuId),$("#znLTMenu").hide(),$("#znCntxtMenu").remove()),znNote.currNoteId="")},dimUtility:function(a){for(var b=a.length,c=0;c<b;c++)"znLTMenu_Rc"===a[c]||"znLTMenu_Rl"===a[c]||"znLTMenu_Nc"===a[c]?$("#"+a[c]).parent().addClass("SC_op3"):$("#"+a[c]).addClass("SC_op3")},updateCountReact:function(a,b){"addNote"===b.mode?(c.updateCatCount(b.cat,"inc",b.namespaceId),c.updateCatCount(b.namespaceId,"inc",b.namespaceId)):"delNote"===b.mode?(c.updateCatCount(b.cat,"dec",b.groupId),c.updateCatCount(b.groupId,"dec",b.groupId)):"moveNote"===b.mode?(c.updateCatCount(b.pCatId,"dec",b.groupId),c.updateCatCount(b.catId,"inc",b.groupId)):"delCat"===b.mode&&c.updateCatCount(b.count,"bdec",b.namespaceId)},updateCatCount:function(a,b,d){if(zmsuite.isWorkspaceAvailable(g.appid)){var e,f,h=zNote.getNamefrmCatObj(a,d);"bdec"===b&&(e=d===zmail.zuid?"nviews":c.getGroupLayerName({groupId:d}),f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(e),f.updateCount(d,b,a)),"General"===h&&a!==d||(e=d===zmail.zuid?"nviews":c.getGroupLayerName({groupId:d}),f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(e),f.updateCount(a,b))}},showAdd:function(){var a,b,c=znNote.lstDetails();c&&"zn_catAll"!==c.fId&&"c"===c.type?(a=c.fId,b=znNote.groupId):"zn_catAll"===c.fId?(a=zNote.catIdGen[znNote.groupId],b=znNote.groupId):(a=zNote.catIdGen[zmail.zuid],b=zmail.zuid),znBox.checkForGroupDisabled({groupId:b})&&(a=zNote.catIdGen[zmail.zuid],b=zmail.zuid),zmail.showFeature?zNote.addNoteAutoSave({notes:{color:"0",notecont:"",catid:a},cntnt:{title:""},myact:{starred:!1},gnrl:{group:{id:b},by:zmail.zuid}}):zNote.addNote({catId:a,namespaceId:b})},fillNotes:function(){var b=znNote.listingDiv,d=b.scrollTop(),e=b.prop("scrollHeight")-b.height();if($("[data-drop='1']").removeAttr("data-drop"),znBox.hideMenu(),d&&Math.floor(d)>=.8*Math.floor(e)&&c.scrolling===!1){c.scrolling=!0;var f=znNote.noteListing.props.noteList.options.page;if(f&&"1"===f.showNextPage){var g=znNote.lstDetails(),h=f.end,i=g.fId,j=g.type,k={start:h},l={position:"absolute",width:"100%",top:znBox.pageDivTop+"px",left:"0px"},m=zNote.templates.scrollPaginationDiv({style:l});znNote.listingDiv.append(m),c.destroyLoadingDiv=zmComponent.loadingBand({container:$("#pgdiv")[0],type:"pagination"}),c.containerDiv=$("#pgdiv"),a.getNotes(j,i,k)}}},foldView:function(b,d){var e,f,h,i=b.rowInfo.info,j=!0;if("header"!==b.rowInfo.type&&i){if(zmTab.currentTab!==g.appid&&(zmsuite.showApp(g.appid),c.setChildToggle()),"c"===i){if(h=Object.keys(b.rowObject)[0],"more"===b.rowObject[h].id||"less"===b.rowObject[h].id)return void c.showMoreOrLess(b,d);void 0!==b.rowObject[h].HC?(e="zn_catAll",znNote.groupId=b.rowObject[h].id,f=b.rowObject[h].name,$.isEmptyObject(zNote.catCacheObj[znNote.groupId])&&(j=!1)):(e=b.rowObject[h].id,znNote.groupId=b.rowObject[h].groupId,f=b.rowObject[h].name)}else if("l"===i){for(var k in b.rowObject){e=b.rowObject[k].id,f=b.rowObject[k].dispName;break}znNote.groupId=zmail.zuid}else"views"===i&&(h=Object.keys(b.rowObject)[0],e=b.rowObject[h].id,znNote.groupId=b.rowObject[h].groupId,f=b.rowObject[h].name,"fav"===e||"sharedtome"===e||"trash"===e?i=e:(i="c",void 0!==b.rowObject[h].HC&&(e="zn_catAll")));c.currLayId=znNote.groupId,znNote.cacheObj={},znNote.noteObj={};var l='{"fId":"'+e+'","type":"'+i+'","groupId":"'+znNote.groupId+'"}';if(znNote.updateHeaderBand({name:f,mode:i,id:e,groupId:znNote.groupId}),c.updateRouter({type:i,folId:e,groupId:znNote.groupId}),notesRestore.saveState({type:i,folId:e,groupId:znNote.groupId}),j)znNote.listingDiv.attr("data-detail",l),a.getNotes(i,e);else{var m={};m.gid=znNote.groupId,m.fn=function(b,c){zNote.catCacheObj[c.id]=b,zNote.catIdGen[c.id]=b[0].catId,znNote.listingDiv.attr("data-detail",l),a.getNotes(i,e)},znBox.getGenCat(m)}}},updateRouter:function(a){var b=[];"c"===a.type?a.groupId===zmail.zuid?(b.push("views"),b.push("mynotes"),"zn_catAll"!==a.folId&&b.push(a.folId)):(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(a.groupId),"zn_catAll"!==a.folId&&b.push(a.folId)):"l"===a.type?(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(a.folId)):"fav"!==a.type&&"sharedtome"!==a.type||(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(zNote.CONSTANTS.hashUrl.folId[a.folId])),zNote.RouteHelper.setParams(b),zNote.RouteHelper.update()},FLUtility:function(a){var b,d=a.rowInfo.info;if(d){var f;if("c"===d||"views"===d&&"fav"!==a.rowObject[Object.keys(a.rowObject)[0]].id&&"sharedtome"!==a.rowObject[Object.keys(a.rowObject)[0]].id){if("header"===a.rowInfo.type)return;var g=zmCont.getGroup();f={clk:function(a,b){e.cmenuItemClick(b)},divId:"znCntxtMenu",conArr:c.nCMenuCatArr};var h=Object.keys(a.rowObject)[0];c.rgtMenuId=void 0===a.rowObject[h].HC?a.rowObject[h].id:void 0,c.currLayId=a.rowObject[h].groupId||a.rowObject[h].id,zmsuite.showContextMenu(a.eventInfo,f),c.rgtMenuId?(b=["znLTMenu_Nc"],c.dimUtility(b)):(b=["znLTMenu_Rc","znLTMenu_Dc"],c.dimUtility(b)),(znBox.checkForGroupDisabled({groupId:c.currLayId})||g[c.currLayId]&&!g[c.currLayId].isOwner)&&c.dimUtility(["znLTMenu_Rc","znLTMenu_Dc"])}else if("l"===d){if("header"===a.rowInfo.type)return;var i;for(var j in a.rowObject){c.rgtMenuId=a.rowObject[j].id;break}c.currLayId=a.rowInfo.layerId,znNote.labelId=c.rgtMenuId,i=c.rgtMenuId?c.nCMenuTagArr:c.nCMenuTagArr1,f={clk:function(a,b){e.cmenuItemClick(b)},divId:"znCntxtMenu",conArr:i},zmsuite.showContextMenu(a.eventInfo,f),c.rgtMenuId&&!zmUtil.isSystemLabel(znNote.labelId)||(b=["znLTMenu_Rl","znLTMenu_Dl"],c.dimUtility(b))}}},findScroll:function(){var b=znNote.listingDiv,d=znNote.lstDetails(),e=d.fId,f=d.type;setTimeout(function(){var d=b.get(0).scrollHeight>b.get(0).clientHeight,g=c.pageDetails(),h={start:g.end};d||"1"!==g.showNextPage||a.getNotes(f,e,h)},100)},renameLabel:function(a,b){var c=zmUtil.getTagList("default"),d=znNote.lstDetails(),e=d.fId;e===b.labId&&znNote.updateHeaderBand({name:c[znNote.labelId].dispName,mode:d.type,id:e,groupId:znNote.groupId})},deleteLabel:function(a,b){var d=znNote.lstDetails(),e=d.fId;if(e===b.labId)return void c.loadGroup()},deleteCat:function(a,b){var d=znNote.lstDetails(),e=d.fId;if(e===b)return void c.loadGroup()},loadGroup:function(){var b='{"fId":"zn_catAll","type":"c","groupId":"'+znNote.groupId+'"}';znNote.listingDiv.attr("data-detail",b),a.getNotes("c","zn_catAll");var d=znNote.groupId===zmail.zuid?"nviews":c.getGroupLayerName({groupId:znNote.groupId});zmsuite.getLeft("zm_notes").selRow(znNote.groupId,d),znNote.updateHeaderBand({name:zNote.groupObj[znNote.groupId].name,mode:"c",id:"zn_catAll",groupId:znNote.groupId})},renameCat:function(a,b){var c=znNote.lstDetails(),d=c.fId;d===b.catId&&znNote.updateHeaderBand({name:b.category,mode:c.type,id:d,groupId:znNote.groupId})},editGroup:function(a,b){var d,e,f;if(d=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(c.getGroupLayerName({groupId:b.id})),b.props.name)zNote.groupObj[b.id].name=b.props.name,e=d.getRowObjfromId(b.id),e[b.id].name=b.props.name,d.editNode(e,d.mapObject);else if(b.props.disabled===!0||b.props.disabled===!1){var g=b.props.disabled===!0?"ngroups":"dgroups";if(d=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(g),zNote.groupObj[b.id].disabled=b.props.disabled,e=d.getRowObjfromId(b.id),e[b.id].disabled=b.props.disabled,f=d.childObject[b.id],d.deleteNode(e),d=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(c.getGroupLayerName({groupId:b.id}))){if(d.getChildObject()[b.id]={CH:{}},e[b.id].HC=0,e[b.id].E=0,d.getListObject().less?(e[b.id].hideNode=d.getListObject().less.hideNode,e[b.id].shouldshow=!0,d.insertNodeBefore(e,d.mapObject,"less")):(e[b.id].hideNode=!1,e[b.id].shouldshow=!1,d.appendNode(e,d.mapObject)),!$.isEmptyObject(f.CH))for(var h in f.CH){var i={};i[h]=f.CH[h],d.appendNode(i,d.mapObject,b.id)}}else{var j=c.getFrameworkObject(),k=c.getDisabledLayer(j);zmsuite.getLeft("zm_notes").getNodes()[0].appendLayer("dgroups",k),zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("dgroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0})}}else if(b.props.hidden===!0)d=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("ngroups"),zNote.groupObj[b.id].hidden=b.props.hidden,e=d.getRowObjfromId(b.id),e[b.id].hidden=b.props.hidden,f=d.childObject[b.id],d.deleteNode(e);else if(b.props.hidden===!1){d=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("ngroups"),e={};var l=_.filter(zNote.noteGroupOrderAndCount,function(a){return a.groupId===b.id});zNote.groupObj[b.id].hidden=b.props.hidden,e[b.id]=zNote.groupObj[b.id],e[b.id].HC=0,e[b.id].E=0,d.countObject[b.id]={},d.countObject[b.id].c=l[0].count,d.countObject[b.id].p="-1",d.getListObject().less?(e[b.id].hideNode=d.getListObject().less.hideNode,e[b.id].shouldshow=!0,d.insertNodeBefore(e,d.mapObject,"less")):(e[b.id].hideNode=!1,e[b.id].shouldshow=!1,d.appendNode(e,d.mapObject));var m=$.extend(!0,{},zNote.catCacheObj),n={},o={},p=1;n[b.id]={};for(var q=0;q<m[b.id].length;q++)o=m[b.id][q],"General"!==o.category?(o.seq=p++,o.name=o.category,o.SE=o.seq,o.id=o.catId,o.groupId=b.id,n[b.id][o.catId]=o,d.countObject[o.catId]={},d.countObject[o.catId].c=o.count,d.countObject[o.catId].p=b.id):zNote.catIdGen[b.id]=o.catId;
if(!$.isEmptyObject(n[b.id]))for(var r in n[b.id]){var s={};s[r]=n[b.id][r],d.appendNode(s,d.mapObject,b.id)}}}},d={cacheObj:{},noteObj:{},noteView:1,iSSubscribed:!1,currNoteId:"",listingDiv:"",labelId:"",groupObj:{},groupId:"",lstDetails:function(){if(znNote.listingDiv){var a=znNote.listingDiv.attr("data-detail");return a=$.parseJSON(a),a?a:void 0}},getCatId:function(a,b){for(var c=zNote.catCacheObj[b],d=c.length,e=0;e<d;e++)if(c[e].category===a)return c[e].catId},hideRgt:function(){1!==znNote.noteView||$("#nonotes").length||setTimeout(function(){znBox.setTopLeft()},100)},removeNote:function(a){var b,d=$("#"+a),e=znNote.listingDiv;if(1===znNote.noteView){znNote.listingDiv.addClass("zn_note_animation");var f=d.attr("data-sno"),g=d.attr("data-cno");g=parseInt(g);var h=d.css("top");h=h.replace("px",""),b=e.get(0).scrollHeight>e.get(0).clientHeight,d.remove();var i={sno:f,cno:g,top:h};znBox.setTopLeft(i),setTimeout(function(){znNote.listingDiv.removeClass("zn_note_animation")},500)}else b=e.get(0).scrollHeight>e.get(0).clientHeight,d.remove();b&&c.findScroll()},getCurNoteParam:function(a){var b=$("#"+a+".zn_note");if(b.length){var c=parseInt(b.attr("data-sno"))+1,d=b.attr("data-cno");d=parseInt(d);var e=b.css("top");e=e.replace("px",""),e=b.outerHeight()+parseInt(e)+parseInt(19);var f={sno:c,cno:d,top:e};return f}},loadNoteData:function(){var a=$.Deferred();return znNote.groupId=zmail.zuid,$.isEmptyObject(zNote.catCacheObj)?znBox.getCat().done(function(b){zNote.catCacheObj[zmail.zuid]=b[1][0].Category,zNote.myNotesCount=b[1][0].noteCount,znBox.getGroupCat().done(function(b){znBox.setGrpCat(b[1]),c.constructLeft(),a.resolve()}).fail(function(){c.constructLeft(),a.resolve()})}):(c.constructLeft(),a.resolve()),a.promise()},toggleChild:function(a,b,c){var d=zmsuite.getLeft("zm_notes").getNodes()[0].getLayer(b),e=d.getChildObject()[a];if(e)if("show"===c){var f=$("#"+a);d.showChild(f.find(".msi-rarrow"),a,f)}else d.hideChild($("#"+a).find(".msi-rarrow"),a)},validateHashParams:function(a){if("l"===a.type){if(a.groupId&&a.fId&&a.groupId===zmail.zuid&&zmail.labInfo[a.fId])return!0}else if("c"===a.type){if(a.groupId&&a.fId&&zNote.groupObj[a.groupId]&&("zn_catAll"===a.fId||zNote.getNamefrmCatObj(a.fId,a.groupId)))return!0}else if(("sharedtome"===a.type||"fav"===a.type)&&a.groupId===zmail.zuid)return!0;return!1},deduceHashParams:function(a){var b,c,d;if(a&&a.data&&a.data.router&&a.hashParams&&a.hashParams.length){"tags"===a.hashParams[0]?(c=zmail.zuid,b=a.hashParams[1],d=zNote.CONSTANTS.hashUrl.typeCode[a.hashParams[0]]):"group"===a.hashParams[0]?(c=a.hashParams[1],b=a.hashParams[2]||"zn_catAll",d=zNote.CONSTANTS.hashUrl.typeCode[a.hashParams[0]]):"views"===a.hashParams[0]&&("mynotes"===a.hashParams[1]?(b=a.hashParams[2]||"zn_catAll",d="c"):b=d=zNote.CONSTANTS.hashUrl.folIdCode[a.hashParams[1]],c=zmail.zuid);var e=znNote.validateHashParams({fId:b,groupId:c,type:d});e||(c=zmail.zuid,b="zn_catAll",d="c")}else a&&a.data&&a.data.restore&&a.restoreParams?(c=a.restoreParams.groupId,b=a.restoreParams.folId,d=a.restoreParams.type):(c=zmail.zuid,b="zn_catAll",d="c");return{fId:b,groupId:c,type:d}},notesLoad:function(a){a=a||{},zmsuite.setAppInfo({appname:f.common.appName,appId:g.appid,appIcon:g.appicon,isCacheable:"yes",stateData:{type:"app",data:{}},faqKey:"notes",searchPlaceHolder:f.common.searchNotes,data:{LNodes:"2",CNodes:3,PNodes:2},handler:{create:c.showAdd},router:zNote.RouteHelper,shortcuts:zmshCut.note}),znNote.loadNoteData().done(function(){"n"===zmApp.selectedApp&&(c.constructCenter(),zmUtil.setAppBannerDOM(),znNote.handleHashUrl(a))}).always(function(){zmsuite.appLoadingBand.resolve()}),$(zmail.win).mousedown(function(){"n"===zmApp.currentApp&&znBox.hideMenu()}),znNote.isSubscribed||($.subscribe("/rename/noteslabel",c.renameLabel),$.subscribe("/delete/noteslabel",c.deleteLabel),$.subscribe("/rename/notescat",c.renameCat),$.subscribe("/delete/notescat",c.deleteCat),$.subscribe("note/updateCount",c.updateCountReact),$.subscribe("group/added",znNote.appendLeftLayer),$.subscribe("/note/catResponse",b.left.handleAddCategory),$.subscribe("/note/tagResponse",b.left.handleAddTag),zmUtil.isNewGroupUser()&&$.subscribe("CONTACT_BOOK_GROUP_CHANGED",c.editGroup),$.subscribe("/apps/tabSwitched",function(a,b){1===znNote.noteView&&b===g.appid&&znNote.listingDiv&&!znNote.listingDiv.find("#nonotes").length&&znBox.setTopLeft(!1,!0,znNote.listingDiv)}),$.subscribe("/integ/rhs",function(a,b){1===znNote.noteView&&zmsuite.getCurrentAppObjId()===g.appid&&znNote.listingDiv&&!znNote.listingDiv.find("#nonotes").length&&znBox.setTopLeft(!1,!0,znNote.listingDiv)}),znNote.isSubscribed=!0)},handleHashUrl:function(b){var d=znNote.deduceHashParams(b),e=d.fId,f=d.groupId,g=d.type;znNote.groupId=f;var i="",j='{"fId":"'+e+'","type":"'+g+'","groupId":"'+f+'"}';if(znNote.listingDiv.attr("data-detail",j),c.updateRouter({type:g,folId:e,groupId:f}),"c"===g){var k=f===zmail.zuid?"nviews":c.getGroupLayerName({groupId:f});if("zn_catAll"===e)i=znBox.getGroupName(f),zmsuite.getLeft("zm_notes").selRow(f,k);else{var l=zmsuite.getLeft("zm_notes").getNodes()[0];l.layerArr&&znNote.toggleChild(f,k,"show"),i=zNote.getNamefrmCatObj(e,f),zmsuite.getLeft("zm_notes").selRow(e,k)}}else"l"===g?(i=zmail.labInfo[e].dispName,zmsuite.getLeft("zm_notes").selRow(e,"zmllabelH")):"sharedtome"!==g&&"fav"!==g||(i=h[e],zmsuite.getLeft("zm_notes").selRow(e,"nviews"));znNote.updateHeaderBand({name:i,mode:g,id:e,groupId:f}),a.getNotes(g,e).done(function(){znNote.notesLoaded=!0})},showNotesApp:function(a){znNote.notesLoaded?(c.setChildToggle(),a&&a.data&&a.data.router&&znNote.handleHashUrl(a)):znNote.loadNoteData().done(function(){"n"===zmApp.selectedApp&&(c.constructCenter(),znNote.handleHashUrl(a))})},appendLeftLayer:function(a,b){var d=zmCont.getGroup()[b.groupID];zNote.groupObj[b.groupID]=d;var e=c.getGroupLayerName({groupId:b.groupID}),f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(e),g={};g[b.groupID]=d,g[b.groupID].HC=0,g[b.groupID].E=0,g[b.groupID].zerogroup=!0,f.getChildObject()[b.groupID]={CH:{}},f.getListObject().less?(g[b.groupID].hideNode=f.getListObject().less.hideNode,g[b.groupID].shouldshow=!0,f.insertNodeBefore(g,f.mapObject,"less")):f.appendNode(g,f.mapObject);var h={gid:b.groupID};h.fn=function(a,b){zNote.catCacheObj[b.id]=a,zNote.catIdGen[b.id]=a[0].catId},znBox.getGenCat(h)},updateHeaderBandWithObj:function(a){var b,d=String(a.zid);"byuser"===a.mode?zmail.ContactBook.get({zuid:d}).done(function(b){var d=b[0];c.actIconObj.list.left.leftHTML=_zm.escapeTags(znBox.getGroupName(a.groupId))+'<span class="sum unreadCount SC_folFil"><b>'+f.createdby+"</b>"+d.attrs.fn+'<i id="clrFilter" class="msi-close"></span>'}):"archive"===a.mode?c.actIconObj.list.left.leftHTML=_zm.escapeTags(znBox.getGroupName(a.groupId))+'<span class="sum unreadCount SC_folFil">'+f.common.archivedNotes+'<i id="clrFilter" class="msi-close"></span>':"modifieddatedesc"===a.mode?c.actIconObj.list.left.leftHTML=_zm.escapeTags(znBox.getGroupName(a.groupId))+'<span class="sum unreadCount SC_folFil"><b>'+f.common.sortmodified+"</b>"+f.common.descend+'<i id="clrFilter" class="msi-close"></span>':"modifieddateasc"===a.mode&&(c.actIconObj.list.left.leftHTML=_zm.escapeTags(znBox.getGroupName(a.groupId))+'<span class="sum unreadCount SC_folFil"><b>'+f.common.sortmodified+"</b>"+f.common.ascend+'<i id="clrFilter" class="msi-close"></span>'),b=zmsuite.getCenter()[0].getNodes()[1],b.push(c.actIconObj.list),b.paint(),b.$el.find("#clrFilter").length&&b.$el.find("#clrFilter").off("click").on("click",function(){znNote.leftSelectedId=zmsuite.getLeft("zm_notes").selId,$("#"+zmsuite.getLeft("zm_notes").selLayerId).find("#"+znNote.leftSelectedId).trigger("click")})},updateHeaderBand:function(b){var d,e,g,h,i=[];if($("#znDisabledGrp").remove(),"c"===b.mode){if(c.actIconObj.list.left.leftHTML='<div class="SCmb"><ul><li class="SCtxt"><b title="'+f.tooltips.changeGroup+'" id="notesGroupChange"><div class="SC_hd"></div><span>'+_zm.escapeTags(znBox.getGroupName(znNote.groupId))+' <i class="msi-barrow"></i></span></b></li></ul></div>',"zn_catAll"!==b.id&&(c.actIconObj.list.left.leftHTML+='<span class="SC_ldot">'+_zm.escapeTags(b.name)+"</span>"),b.groupId!==zmail.zuid&&(c.actIconObj.list.left.leftHTML+='<span id="ngroupmembers" class="SC_lnk">'+zNote.groupObj[znNote.groupId].members.length+" members</span>"),znBox.checkForGroupDisabled({groupId:b.groupId})){var j=zNote.templates.getDisabledMsg({disabledMsg:zNote.notei18n.msg.disabledGroupMsg});zmsuite.getCenter("zm_notes")[0].$el.find(".SCmb").after(j)}}else c.actIconObj.list.left.leftHTML=_zm.escapeTags(b.name);d=zmsuite.getCenter()[0].getNodes()[1],d.push(c.actIconObj.list),d.paint();var k=zmsuite.getCenter()[0].getNodes(),l=k[0];"c"!==b.mode?(l.hideGroup("filter"),l.hideGroup("sort")):(l.showGroup("filter"),l.showGroup("sort")),e=function(b){b.dialog.remove();var c="byuser";a.getNotes("byuser",b.zid);var d='{"fId":"'+b.zid+'","type":"'+c+'","groupId":"'+znNote.groupId+'"}';znNote.listingDiv.attr("data-detail",d),znNote.updateHeaderBandWithObj({groupId:znNote.groupId,mode:"byuser",zid:b.zid})},h=zmail.ContactBook.get({zuid:zmail.zuid,promise:!1}),zmail.zuid!==b.groupId&&i.push({id:zmail.zuid,name:zNote.notei18n.myNotes,photo:h[0].get("photo")}),_.each(zNote.noteGroupOrderAndCount,function(a){g=a.groupId,zNote.groupObj[g]&&g!==b.groupId&&i.push({name:zNote.groupObj[g].name,id:zNote.groupObj[g].id,photo:zNote.groupObj[g].photo})}),d.$el.find("#notesGroupChange").off("click").on("click",function(){var a=zmUtil.createFLComp("groups",{data:i,search:"name",display:"name",displayAs:"dropdown",onSelect:function(b){znNote.groupId=b.id,a.hide(),c.loadGroup()},showCheckbox:!1,showCreate:!1,parentDOM:$("#notesGroupChange")[0],removehandler:!0,showUnread:!1});$("#notesGroupChange").addClass("SC_ddn"),$.publish("/mail/menuCreated",{menuHandler:function(){$(".SC_ddn").removeClass("SC_ddn")}}),a.show()}),d.$el.find("#ngroupmembers").length&&d.$el.find("#ngroupmembers").off("click").on("click",function(){zmAppLoader.load("streamsGroup").done(function(){zmStreamsApp.GroupApp.showMemberDialog({gid:znNote.groupId,title:f.tooltips.viewNoteByCreator,callback:e})})})},deleteNotesReq:function(a,b){var c={entityId:a.id,mode:"delNote",groupId:a.groupId,streamsView:"Notes",actionType:"delEntity",entityType:zNote.CONSTANTS.entityType},d={id:a.id,mode:"delNote"},e=function(a,d){b&&b(d),$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("note/deleteNote",[{pid:c.entityId,gid:c.groupId}]),$.publish("note/updateCount",c)};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:e,p:c,ep:d})},navigateListing:function(a){znNote.noteListing.navigateListing(a)},znLeftClbk:function(a){var b,d=a.zmsData;"clbk"in a&&(b=a.clbk);var e;e=d.rowInfo.info,"click"===d.type?e&&2===d.colInfo.column&&c.foldView(d,b):"contextmenu"===d.type&&c.FLUtility(d)},createInlineNotes:c.showAdd,getNotes:a.getNotes,tagResult:b.left.tagResult,cateResult:b.left.cateResult,updateRouter:c.updateRouter}}();
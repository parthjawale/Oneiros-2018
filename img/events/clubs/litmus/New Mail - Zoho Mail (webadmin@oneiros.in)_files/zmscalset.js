_defineSettingsModule("Categories",function(exports,require){"use strict";var CATEGORY_ID="calendar",I18N={title:"Calendar"},PlatformComponents=require("Platform.Components"),CategoryManager=PlatformComponents.CategoryManager,Category=CategoryManager.create(CATEGORY_ID,{props:{title:I18N.title}});exports.Calendar=Category},"MailSuite"),_defineSettingsModule("Pages",function(exports,require){"use strict";var PAGE_ID="calendar-generals",PlatformComponents=require("Platform.Components"),SystemEntities=require("Platform.Entities"),I18N={title:"Calendar Preferences"},SettingPageManager=PlatformComponents.SettingPageManager,SettingPage=SystemEntities.SettingPage,PageTypes=SettingPage.Types,Page=SettingPageManager.create(PAGE_ID,{props:{title:I18N.title},attributes:{card:PAGE_ID,category:"calendar",type:PageTypes.Title,pageCSSClass:"calendar-generals-page",appContainer:!0}});exports.CalendarGenerals=Page},"MailSuite"),_defineSettingsModule("Cards",function(exports,require){"use strict";var CARD_ID="calendar-generals",CATEGORY_ID="calendar",PAGE_ID="calendar-generals",I18N={cardTitle:"Calendar Preferences"},PlatformComponents=require("Platform.Components"),SettingCardManager=PlatformComponents.SettingCardManager,Card=SettingCardManager.create(CARD_ID,{props:{openable:!0,addToSearch:!1,title:I18N.cardTitle},state:{hidden:!1},attributes:{category:CATEGORY_ID},openAction:SettingCardManager.CardActions.OpenPageAction(PAGE_ID)});exports.CalendarGenerals=Card},"MailSuite"),_defineSettingsModule("CalendarGeneralView",function(exports){"use strict";var _initialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},_uninitialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()};exports.initialize=_initialize,exports.uninitialize=_uninitialize;var tOPT={};exports._getGeneralView=function(){var $fragment=$(document.createDocumentFragment()),opt=zcal.cdata.opt;0==zcal.timezones.length&&ZCL_uXHR("/cal/timez.do",function(res){zcal.timezones=ZCL_Evl(1,res.responseText)});var txt="",mailLI=$("<li class='SC_setbox zcl_setbox'></li>"),mailUL=$("<ul></ul>");txt+="<li><h3 style='position:relative'><span>"+zcal.i18n.timezone+"<span><span id='load' style='display:none;position: absolute'><span class='loader'></span></span></h3><div class='startup'><p><span class='SC_select zcl_Stz' >"+setTz1()+"</span></p></div></li>",txt+="<li><h3 style='position:relative'><span>"+zcal.i18n.dateformat+"</span><span id='load' style='display:none;position: absolute'><span class='loader'></span></span></h3><div class='section-content startup' ><div class='fontSettings mb' rel='"+opt.DF+"' >";for(var i in zcal.DATEFORMAT)txt+='<em value="'+opt.DF+'" id="zcl_DF" rel="'+i+'" class="'+(opt.DF==i?"sel":"")+'">'+zcal.DATEFORMAT[i]+"</em>";txt+="</div></div></li>",txt+="<li><h3 style='position:relative'><span>"+zcal.i18n.timeformat+"</span><span id='load' style='display:none;position: absolute'><span class='loader'></span></span></h3><div class='section-content startup'><div class='fontSettings mb' rel='"+opt.TF+"'>";for(var i in zcal.TIMEFORMAT)txt+='<em id="zcl_TF"  rel="'+i+'" class="'+(opt.TF==i?"sel":"")+'">'+zcal.TIMEFORMAT[i]+"</em>";txt+="</div></div></li>",txt+="<li><h3 style='position:relative'><span>"+zcal.i18n.defaultview+"</span><span id='load' style='display:none;position: absolute'><span class='loader'></span></span></h3><div class='section-content startup'><div class='fontSettings mb' rel='"+opt.DEF+"'>";for(var i in zcal.DEFAULTVIEW)txt+='<em id="zcl_DEF" rel="'+i+'" class="'+(opt.DEF==i?"sel":"")+'">'+zcal.DEFAULTVIEW[i]+"</em>";txt+="</div></div></li>",txt+="<li><h3 style='position:relative'><span>"+zcal.i18n.firdayofthwk+"</span><span id='load' style='display:none;position: absolute'><span class='loader'></span></span></h3><div class='section-content startup'><div class='fontSettings mb' rel='"+opt.WK+"'>";for(var i in Date.WEEK_DAYS[0])txt+='<em id="zcl_WK"  rel="'+i+'" class="'+(opt.WK==i?"sel":"")+'">'+Date.WEEK_DAYS[0][i]+"</em>";txt+="</div></div></li>",txt+="<li><h3 style='position:relative'><span>"+zcal.i18n.workweek+"</span><span id='load' style='display:none;position: absolute'><span class='loader'></span></span></h3>",txt+="<div class='section-content startup'><div class='fontSettings' rel='"+opt.WS+"'><span>"+zcal.i18n.from+"</span>";for(var i in Date.WEEK_DAYS[0])txt+='<em id="zcl_WS" rel="'+i+'" class="'+(opt.WS==i?"sel":"")+'">'+Date.WEEK_DAYS[0][i]+"</em>";txt+="</div></div>",txt+="<div class='section-content startup'><div class='fontSettings' rel='"+opt.WE+"'><span>"+zcal.i18n.to+"</span>";for(var i in Date.WEEK_DAYS[0])txt+='<em id="zcl_WE" rel="'+i+'" class="'+(opt.WE==i?"sel":"")+'">'+Date.WEEK_DAYS[0][i]+"</em>";txt+="</div></div>",txt+="</li>",txt+="<li><h3 style='position:relative'><span>"+zcal.i18n.workinghours+"</span><span id='load' style='display:none;position: absolute'><span class='loader'></span></span></h3><div class='startup'><p><span>"+zcal.i18n.from+"</span><span class='SC_select zcl_Sdf'><input value='"+zcal.HOURS[opt.HS]+"' type='text' id='zcl_HS' rel="+opt.HS+" readonly=''></span><span>"+zcal.i18n.to+"</span><span class='SC_select zcl_Sdf'><input value='"+zcal.HOURS[opt.HE]+"' type='text' id='zcl_HE' rel="+opt.HE+" readonly=''></span></p></div></li>";var _SIE=opt.SIE,_DDE=opt.DDE,_REM=opt.REM,_NWTB=opt.NWTB;txt+="<li><h3>"+zcal.i18n.outsideworkingtime_busy+"<div class='onoffButton' id='zcl_nonWHr' data-marker='nonworkingHour'><div class='"+(1==_NWTB?"sdiv":"sdiv sadiv")+"' rel='"+(1==_NWTB?"on":"off")+"' data-on='"+zcal.i18n.on+"' data-off='"+zcal.i18n.off+"'></div></div></h3><div class='startup help zcl_mt'><em><img src="+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+" class='info-message'></em><span>	Show your non-working time as busy.</span></div></li>",txt+="<li><h3 style='position:relative'><span>"+zcal.i18n.automatic_addinv+"<span><span id='load' style='display:none;position: absolute'><span class='loader'></span></span></h3><div class='section-content startup'><div class='fontSettings mb' rel='"+_SIE+"'>",txt+='<em id="zcl_autoInv"  rel="0" class="'+("0"==_SIE?"sel":"")+'">'+zcal.i18n.allow+"</em>",txt+='<em id="zcl_autoInv"  rel="2" class="'+("2"==_SIE?"sel":"")+'">'+zcal.i18n.allowiffree+"</em>",txt+='<em id="zcl_autoInv"  rel="1" class="'+("1"==_SIE?"sel":"")+'">'+zcal.i18n.dontallow+"</em>",txt+="</div></div></li>",txt+="<li><h3>"+zcal.i18n.denied_events+"<div class='onoffButton' id='zcl_showDE' data-marker='deniedEvents'><div class='"+(1==_DDE?"sdiv":"sdiv sadiv")+"' rel='"+(1==_DDE?"on":"off")+"' data-on='"+zcal.i18n.on+"' data-off='"+zcal.i18n.off+"'></div></div></h3><div class='startup help zcl_mt'><em><img src="+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+" class='info-message'></em><span>"+zcal.i18n.disdenied_eventsmsg+"</span></div></li>",txt+="<li><h3>"+zcal.i18n.reminder_notification+"<div class='onoffButton' id='zcl_remNotify' data-marker='reminderNotify'><div class='"+(1==_REM?"sdiv":"sdiv sadiv")+"' rel='"+(1==_REM?"on":"off")+"' data-on='"+zcal.i18n.on+"' data-off='"+zcal.i18n.off+"'></div></div></h3><div class='startup help zcl_mt'><em><img src="+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+" class='info-message'></em><span>"+zcal.i18n.rem_notifymsg+"</span></div></li>",mailUL.append($(txt)),mailLI.append(mailUL),$fragment.append(mailLI),mailLI.find("#zcl_DF").on("click",function(e){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),_saveGeneralSettings(e)}),mailLI.find("#zcl_TF").on("click",function(e){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),_saveGeneralSettings(e)}),mailLI.find("#zcl_DEF").on("click",function(e){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),_saveGeneralSettings(e)}),mailLI.find("#zcl_WK").on("click",function(e){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),_saveGeneralSettings(e)}),mailLI.find("#zcl_WS").on("click",function(e){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),_saveGeneralSettings(e)}),mailLI.find("#zcl_WE").on("click",function(e){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),_saveGeneralSettings(e)}),mailLI.find("#zcl_autoInv").on("click",function(e){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),_saveGeneralSettings(e)}),mailLI.on("click",function(e){if("INPUT"==e.target.tagName&&"zcl_HS"==e.target.id){var HSarr=[];for(var i in zcal.HOURS){var obj={};obj.value=i,obj.text=zcal.HOURS[i],HSarr.push(obj)}var that=e.target;_showMenu({menuItems:HSarr,par:e.target,parWidth:!0}).then(function(data){that.value=data.text,that.setAttribute("rel",data.value),_saveGeneralSettings(e),zmUtil.hideMenu(e)})}if("INPUT"==e.target.tagName&&"zcl_HE"==e.target.id){var HEarr=[];for(var i in zcal.HOURS){var obj={};obj.value=i,obj.text=zcal.HOURS[i],HEarr.push(obj)}var that=e.target;_showMenu({menuItems:HEarr,par:e.target,parWidth:!0}).then(function(data){that.value=data.text,that.setAttribute("rel",data.value),_saveGeneralSettings(e),zmUtil.hideMenu()})}}),mailLI.find("#zcl_TZ").on("hover",function(){zmComponent.tooltip({elm:$("#zcl_TZ")[0],text:$("#zcl_TZ")[0].value,arrow:"top"})}),mailLI.find("#zcl_TZ").on("click",function(ev){var tzArr=zcal.timezones,tArr=[];for(var i in tzArr)for(var j in tzArr[i]){var obj={};obj.id=j,obj.name=tzArr[i][j]+" ("+j+")",obj.display_text=tzArr[i][j]+" ("+j+")",tArr.push(obj)}var component,config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.parWidth=!1,config.onSelect=function(id,selectObj){setGroupValue(that,id,selectObj),_saveGeneralSettings(ev),component.hide()},config.dataCallback=function(){return tArr},component=zmUtil.createFLComp("generic",config),component.show()});var setGroupValue=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("rel",id)},showallTimezoneDOM=mailLI.find("[data-marker=showallTimezone]").removeAttr("data-marker");showallTimezoneDOM.on("click",function(){_showallTimezone(),$(this).remove()});var showallTimezone1=mailLI.find("[data-marker=showallTimezone1]").removeAttr("data-marker");showallTimezone1.on("click",function(){zcal.timezones.length>0?setTz1():ZCL_uXHR("/cal/timez.do",function(res){zcal.timezones=ZCL_Evl(1,res.responseText)}),$(this).remove()});var nonworkingHourDOM=mailLI.find("[data-marker=nonworkingHour]");nonworkingHourDOM&&nonworkingHourDOM.on("click",function(){var $ele=$(this);"sdiv"==$ele.find("div")[0].className?($ele.find("div").removeClass("sdiv").addClass("sdiv sadiv"),$ele.find("div")[0].setAttribute("rel","off")):($ele.find("div").removeClass("sdiv sadiv").addClass("sdiv"),$ele.find("div")[0].setAttribute("rel","on")),_saveGeneralSettings()});var automaticInvitation=mailLI.find("[data-marker=automaticInvitation]");automaticInvitation.on("click",function(){var $ele=$(this);$ele.parent().find("i").removeClass("msi-option").addClass("msi-unoption"),$ele.find("i").removeClass("msi-unoption").addClass("msi-option"),_saveGeneralSettings(e)});var deniedEvents=mailLI.find("[data-marker=deniedEvents]");deniedEvents.on("click",function(){var $ele=$(this);"sdiv"==$ele.find("div")[0].className?($ele.find("div").removeClass("sdiv").addClass("sdiv sadiv"),$ele.find("div")[0].setAttribute("rel","off")):($ele.find("div").removeClass("sdiv sadiv").addClass("sdiv"),$ele.find("div")[0].setAttribute("rel","on")),_saveGeneralSettings()});var reminderNotify=mailLI.find("[data-marker=reminderNotify]");reminderNotify.on("click",function(){var $ele=$(this);"sdiv"==$ele.find("div")[0].className?($ele.find("div").removeClass("sdiv").addClass("sdiv sadiv"),$ele.find("div")[0].setAttribute("rel","off")):($ele.find("div").removeClass("sdiv sadiv").addClass("sdiv"),$ele.find("div")[0].setAttribute("rel","on")),_saveGeneralSettings()});var saveGeneral=mailLI.find("[data-marker=saveGeneral]");return saveGeneral.on("click",function(){_saveGeneralSettings()}),$fragment};var _showallTimezone=function(){zcal.timezones.length>0?setAllTZ():ZCL_getTZ({mode:"mypref",callback:function(){setAllTZ()}})},ZCL_getTZ=function(obj){ZCL_XHR("/cal/timez.do",function(res){zcal.timezones=ZCL_Evl(1,res.responseText),obj.callback&&obj.callback()})},setAllTZ=function(){var tzStr="<select>";for(var i in zcal.timezones)for(var j in zcal.timezones[i]){var s=zcal.cdata.opt.TIM==j?"selected":"";tzStr+="<option "+s+" value="+j+' id="zc_tzOp">'+unescape(zcal.timezones[i][j])+" ("+j+")</option>"}return tzStr+="</select>"},setTz1=function(){var tzStr1='<input value="'+unescape(zcal.cdata.opt.CTIM)+'" type="text"  rel='+zcal.cdata.opt.TIM+' readonly="" id="zcl_TZ">';return tzStr1},_saveGeneralSettings=function(e){hasValidChange()&&updateGeneralSettings(e)},hasValidChange=function(){var _Odet,_SIE,_DDE,_REM,_NWTB,opt=zcal.cdata.opt;if($("#zcl_TZ")){var tzz=$("#zcl_TZ")[0].getAttribute("rel");if(tzz&&tzz!=opt.TIM)return!0}for(var _Odet=["DF","TF","DEF","WK","WS","WE"],i=0;i<_Odet.length;i++)if(opt[_Odet[i]]!=parseInt($("#zcl_"+_Odet[i]).parent()[0].getAttribute("rel"),10))return!0;for(var _o=["HS","HE"],i=0;i<_o.length;i++)if(opt[_o[i]]!=parseInt($("#zcl_"+_o[i])[0].getAttribute("rel"),10))return!0;_NWTB=1==$("#zcl_nonWHr").find("[rel=on]").length?1:0;{var ind,_autoInv=$("#zcl_autoInv");$("#zcl_showDE"),$("#zcl_remNotify")}return ind=_autoInv.parent()[0].getAttribute("rel"),_SIE=ind,_DDE=1==$("#zcl_showDE").find("[rel=on]").length?1:0,_REM=1==$("#zcl_remNotify").find("[rel=on]").length?1:0,opt.DDE!=_DDE||opt.SIE!=_SIE||opt.REM!=_REM||opt.NWTB!=_NWTB?!0:!1},validateGeneralSettings=function(){var opt=zcal.cdata.opt;tOPT={};var _Odet,HS,HE;if(_Odet=[["DF",3],["TF",1],["DEF",4],["WK",6],["WS",6],["WE",6]],HS=parseInt($("#zcl_HS")[0].getAttribute("rel"),10),HE=parseInt($("#zcl_HE")[0].getAttribute("rel"),10),HS>=HE)return _zm.succErrMsg("e",zcal.i18n.wkhretgrwkhrst),!1;tOPT.HS=HS,tOPT.HE=HE;var tzz=$("#zcl_TZ")?$("#zcl_TZ")[0].getAttribute("rel"):null;tzz&&tzz!=zcal.cdata.opt.TIM?(tOPT.TIM=tzz,tOPT.CTIM=$("#zcl_TZ")[0].value):tOPT.TIM=zcal.cdata.opt.TIM;for(var i=0;i<_Odet.length;i++){var _pa=_Odet[i][0],tmp=parseInt($("#zcl_"+_pa).parent()[0].getAttribute("rel"),10);tOPT[_pa]=tmp>=0&&tmp<=_Odet[i][1]?tmp:opt[_pa]}{var ind,_autoInv=$("#zcl_autoInv");$("#zcl_showDE"),$("#zcl_remNotify")}return ind=ind=_autoInv.parent()[0].getAttribute("rel"),tOPT.SIE=ind,tOPT.DDE=1==$("#zcl_showDE").find("[rel=on]").length?1:0,tOPT.REM=1==$("#zcl_remNotify").find("[rel=on]").length?1:0,tOPT.NWTB=1==$("#zcl_nonWHr").find("[rel=on]").length?1:0,!0},updateGeneralSettings=function(e){var opt=zcal.cdata.opt;validateGeneralSettings()&&(e&&("zcl_TZ"==e.target.id||"zcl_HS"==e.target.id||"zcl_HE"==e.target.id?e.target.parentNode.parentNode.parentNode.parentNode.querySelector("#load").style.display="":e.target.parentNode.parentNode.parentNode.querySelector("#load").style.display=""),ZCL_XHR("/cal/set.do?type=gen&obj="+encodeURIComponent('{"DF":'+tOPT.DF+',"TF":'+tOPT.TF+',"DEF":'+tOPT.DEF+',"WK":'+tOPT.WK+',"WS":'+tOPT.WS+',"WE":'+tOPT.WE+',"HS":'+tOPT.HS+',"HE":'+tOPT.HE+',"MTO":'+opt.MTO+', "TH":'+opt.TH+',"FS":'+opt.FS+',"TIM":"'+tOPT.TIM+'", "DDE":'+tOPT.DDE+', "SIE":'+tOPT.SIE+',"REM":'+tOPT.REM+',"NWTB":'+tOPT.NWTB+"}"),_processGChanges))},_processGChanges=function(res){var obj=ZCL_Evl(1,res.responseText);if("success"==obj.status){var opt=zcal.cdata.opt;obj.TZLBL&&(opt.TZLBL=obj.TZLBL,opt.DATE=obj.DATE.toString(),opt.TZ_OFFSET=obj.TZ_OFFSET,zcal.cdate=ZCL_parseDateTimeStr(obj.DATE_STR).getTime(),zcal.timezoneupdated=!0);for(var i in tOPT)opt[i]=tOPT[i];setTimeout(function(){for(var l=document.querySelectorAll("#load"),i=0;i<l.length;i++)l[i].style.display="none"},1e3)}},_showMenu=function(obj){var menus=[],menuItems=obj.menuItems||[];menuItems.forEach(function(menuItem){var value=menuItem.value,text=menuItem.text;menus.push({htm:"<div>"+text+"</div>",data:{value:value,text:text}})});var deferred=$.Deferred();return obj.list=menus,obj.clk=function(data,element,event){deferred.resolve(data,element.parentNode,event)},obj.onHide=function(){deferred.reject()},menus.length?zmsuite.showMenu(obj):deferred.reject(),deferred.fail(zmUtil.hideMenu),deferred.promise()}},"MailSuite.Apps.CalendarGenerals"),_defineSettingsModule("CalendarGenerals",function(exports,require){"use strict";var App,Components=require("Platform.Components"),SettingAppManager=Components.SettingAppManager,SystemUtils=require("Platform.System.Utils"),APP_ID="calendar-generals",PAGE_ID="calendar-generals",CalendarView="MailSuite.Apps.CalendarGenerals.CalendarGeneralView",_calendarview=function(){return require(CalendarView)},loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},_initializeApp=function(){var progress=($.Deferred(),SystemUtils.makeDeferred());return"undefined"==typeof zcal?loadCalendarData().done(function(){_calendarview().initialize({process:progress})}).fail(progress.reject):_calendarview().initialize({process:progress}),progress.promise()},_uninitializeApp=function(){var progress=SystemUtils.makeDeferred();return _calendarview().uninitialize({process:progress}),progress.promise()},_getAppView=function(){var CalendarGeneralView=_calendarview();return CalendarGeneralView._getGeneralView()},_handleContainerEvent=function(){return null},_createApp=function(){App=SettingAppManager.create(APP_ID,{attributes:{page:PAGE_ID,isReactApp:!1},initialize:_initializeApp,uninitialize:_uninitializeApp,getView:_getAppView,handleContainerEvent:_handleContainerEvent})},initialize=function(){_createApp(),exports.App=App};initialize()},"MailSuite.Apps"),function(require){"use strict";var CARD_ID="calendar-generals",PAGE_ID="calendar-generals",CARD_ITEMS={TIME_ZONE:"time-zone",DATE_FORMAT:"date-format",TIME_FORMAT:"time-format",DEFAULT_VIEW:"default-view",AUTOMATIC_INVI:"automatic-invi",REMINDER_NOTIFI:"reminder-notifi"},I18N={timezone:{cardItem:{title:"Time Zone"}},dateformat:{cardItem:{title:"Date Format"}},timeformat:{cardItem:{title:"Time Format"}},defaultview:{cardItem:{title:"Defaut View"}},automaticinvi:{cardItem:{title:"Automatic invitation"}},remindernotifi:{cardItem:{title:"Reminder notification"}}},PlatformComponents=require("Platform.Components"),PlatformEntities=require("Platform.Entities"),SettingCardItemManager=(require("Platform.System.Utils"),PlatformComponents.SettingCardItemManager),SettingCardItem=PlatformEntities.SettingCardItem,CardItemTypes=SettingCardItem.Types,_initialize=(SettingCardItemManager.create(CARD_ITEMS.TIME_ZONE,{props:{title:I18N.timezone.cardItem.title,value:""},attributes:{type:CardItemTypes.LabelValue,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.TIME_ZONE})}),SettingCardItemManager.create(CARD_ITEMS.DATE_FORMAT,{props:{title:I18N.dateformat.cardItem.title,value:""},attributes:{type:CardItemTypes.LabelValue,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.DATE_FORMAT})}),SettingCardItemManager.create(CARD_ITEMS.TIME_FORMAT,{props:{title:I18N.timeformat.cardItem.title,value:""},attributes:{type:CardItemTypes.LabelValue,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.TIME_FORMAT})}),SettingCardItemManager.create(CARD_ITEMS.DEFAULT_VIEW,{props:{title:I18N.defaultview.cardItem.title,value:""},attributes:{type:CardItemTypes.LabelValue,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.DEFAULT_VIEW})}),SettingCardItemManager.create(CARD_ITEMS.AUTOMATIC_INVI,{props:{title:I18N.automaticinvi.cardItem.title,value:""},attributes:{type:CardItemTypes.LabelValue,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.AUTOMATIC_INVI})}),SettingCardItemManager.create(CARD_ITEMS.REMINDER_NOTIFI,{props:{title:I18N.remindernotifi.cardItem.title,value:""},attributes:{type:CardItemTypes.LabelValue,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.REMINDER_NOTIFI})}),function(){});_initialize()}(zmail.Settings.Modules.import),_defineSettingsModule("Pages",function(exports,require){"use strict";var PAGE_ID="email-notify",PlatformComponents=require("Platform.Components"),SystemEntities=require("Platform.Entities"),I18N={title:"Email Notification"},SettingPageManager=PlatformComponents.SettingPageManager,SettingPage=SystemEntities.SettingPage,PageTypes=SettingPage.Types,Page=SettingPageManager.create(PAGE_ID,{props:{title:I18N.title},attributes:{card:PAGE_ID,category:"calendar",type:PageTypes.Title,pageCSSClass:"email-notify-page",appContainer:!0}});exports.CalendarEmailNotify=Page},"MailSuite"),_defineSettingsModule("Cards",function(exports,require){"use strict";var CARD_ID="email-notify",CATEGORY_ID="calendar",PAGE_ID="email-notify",I18N={cardTitle:"Email Notification"},PlatformComponents=require("Platform.Components"),SettingCardManager=PlatformComponents.SettingCardManager,Card=SettingCardManager.create(CARD_ID,{props:{openable:!0,addToSearch:!1,title:I18N.cardTitle},state:{hidden:!1},attributes:{category:CATEGORY_ID},openAction:SettingCardManager.CardActions.OpenPageAction(PAGE_ID)});exports.CalendarEmailNotify=Card},"MailSuite"),_defineSettingsModule("EmailNotifyView",function(exports,require){"use strict";var _initialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},_uninitialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},mailLI=(require("MailSuite.Apps.CalendarGenerals.CalendarGeneralView"),$(document.createDocumentFragment()),$('<li class="SC_setbox zcl_setbox"></li>')),tOPT={},_getEmailNotifyView=function(){var mailUL=$("<ul></ul>"),opt=zcal.cdata.opt,txt="",_MT=opt.MT,_MTO=opt.MTO;if(opt.CMAIL&&""!=opt.CMAIL)txt+='<li><div class="startup help zcl_mb">',txt+="<p>"+ZCL_replaceString(zcal.i18n.revertmsg1,['<a class="SC_lnk">'+opt.CMAIL+"</a>",'<a class=" link SC_lnk" data-marker="resendEmail">',"</a>"])+" </p><p>"+ZCL_replaceString(zcal.i18n.revertmsg2,['<a class=" link SC_lnk">'+_MTO+"</a>"])+"</p></div></div></li>",txt+='<li><div><div class="zm_comp"><span data-marker="reverttoPrevious">'+zcal.i18n.rebutton+"</span></div></li>";else{if(txt+='<li class="SC_cal_prefer">',"1"==zcal.emlNfy){{opt.REMID.split(",")}txt+="<h3>"+zcal.i18n.emailaddress+'</h3><div class="startup"><p><span  class="SC_select"><input type="text" value='+_MTO+" rel="+_MTO+' readonly="" id="zcl_MTO"></span></p></div><div class="startup help zcl_mb"> <em><img src='+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+' class="info-message"></em><span>'+zcal.i18n.emailaddress_msg2+"</span></div>"}else txt+="<h3>"+zcal.i18n.notify_emailaddress+'</h3><div id="zcl_emailD"><div class="startup zcl_mb"><p><span>'+_MTO,"0"!=zcal.emlNfy&&"1"!=zcal.emlNfy&&(txt+='<a class="link SC_lnk" data-marker="changeEmailNotify">'+zcal.i18n.change+"</a>"),txt+='</span></p></div></div><div class="startup help zcl_mb"> <em><img src='+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+' class="info-message"></em><span>'+zcal.i18n.emailaddress_msg1+"</span></div>";if(txt+="<h3>"+zcal.i18n.email_format+"</h3>",txt+='<div class="section-content startup" ><div class="fontSettings" rel='+opt.MT+'> <em id="enotifyType" rel=0 class="'+(0==_MT?"sel":"")+'">'+zcal.i18n.sendhtml+'</em><em id="enotifyType" rel=1 class="'+(1==_MT?"sel":"")+'">'+zcal.i18n.sendplaintext+"</em></div></div>",txt+="</li>",0==_MT){txt+="<li><h3>"+zcal.i18n.agenda_notify+"</h3><div class='section-content startup'><div class='fontSettings mb' rel='"+opt.AI+"'>";for(var i in zcal.AGENDA_INTERVAL)txt+='<em id="zcl_AI" rel="'+i+'" class="'+(opt.AI==i?"sel":"")+'">'+zcal.AGENDA_INTERVAL[i]+"</em>";txt+="</div></div></li>"}}mailUL.append($(txt)),mailUL.find("#enotifyType").on("click",function(){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),toggleAgendaNotify($ele.index()),saveEmailNotify()}),mailUL.find("#zcl_AI").on("click",function(){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),saveEmailNotify()});var agendaNotify=mailUL.find("[data-marker=agendaNotify]").removeAttr("data-marker");agendaNotify.length&&agendaNotify.on("click",function(ev){var AIarr=[];for(var i in zcal.AGENDA_INTERVAL){var obj={};obj.value=i,obj.text=zcal.AGENDA_INTERVAL[i],AIarr.push(obj)}var that=ev.target;_showMenu({menuItems:AIarr,par:ev.target,parWidth:!0}).then(function(data){that.value=data.text,that.setAttribute("rel",data.value),zmUtil.hideMenu()})});var emailidDom=mailUL.find("#zcl_MTO");emailidDom.length&&emailidDom.on("click",function(ev){var emailIds=opt.REMID.split(","),Emailarr=[];for(var i in emailIds){var obj={};obj.value=i,obj.text=emailIds[i],Emailarr.push(obj)}var that=ev.target;_showMenu({menuItems:Emailarr,par:ev.target,parWidth:!0}).then(function(data){that.value=data.text,that.setAttribute("rel",data.value),zmUtil.hideMenu()})});var notifyTypeDOM=mailUL.find("[data-marker=notifyType]").removeAttr("data-marker");notifyTypeDOM.length&&notifyTypeDOM.on("click",function(){var $ele=$(this);$ele.parent().find("i").removeClass("msi-option").addClass("msi-unoption"),$ele.find("i").removeClass("msi-unoption").addClass("msi-option"),toggleAgendaNotify($ele.index())});var resendEmailDOM=mailUL.find("[data-marker=resendEmail]").removeAttr("data-marker");resendEmailDOM.length&&resendEmailDOM.on("click",function(){ZCL_XHR("/cal/set.do?type=resendemail",_resendEmailSts)});var reverttoPreviousDOM=mailUL.find("[data-marker=reverttoPrevious]").removeAttr("data-marker");reverttoPreviousDOM.length&&reverttoPreviousDOM.on("click",function(){ZCL_XHR("/cal/set.do?type=revert",_revertEmailId)});var changeEmailNotifyDOM=mailUL.find("[data-marker=changeEmailNotify]").removeAttr("data-marker");changeEmailNotifyDOM.length&&changeEmailNotifyDOM.on("click",function(){changeEmailNotify()});var saveENotifyDOM=mailUL.find("[data-marker=saveENotify]").removeAttr("data-marker");return saveENotifyDOM.length&&saveENotifyDOM.on("click",function(){saveEmailNotify()}),mailLI.empty().append(mailUL),mailLI},hasChangeInENotify=function(){var opt=zcal.cdata.opt,enotifyDOM=$("#enotifyType");if($("#zcl_MTO")[0]){var _newEmailId=$("#zcl_MTO")[0].value;if(!ZCL_isEmail(_newEmailId))return _zm.succErrMsg("e",zcal.i18n.entervalidemailid),$("#zcl_MTO").focus(),!1;if(_newEmailId!=opt.MTO)return!0}if(enotifyDOM.length){var _MT=parseInt($("#enotifyType").parent()[0].getAttribute("rel"));if(opt.MT!=_MT)return!0;var _AI=-1;if(0===_MT&&(_AI=$("#zcl_AI").parent()[0].getAttribute("rel")),_AI!=opt.AI)return!0}return!1},saveEmailNotify=function(){if(hasChangeInENotify()){var opt=zcal.cdata.opt,enotifyDOM=$("#enotifyType");tOPT={},tOPT.MTO=$("#zcl_MTO")[0]?$("#zcl_MTO")[0].value:opt.MTO,tOPT.MT=enotifyDOM.length?$("#enotifyType").parent()[0].getAttribute("rel"):opt.MT,tOPT.AI=0==tOPT.MT?$("#zcl_AI").parent()[0].getAttribute("rel"):-1,ZCL_XHR("/cal/set.do?type=notify&mailto="+tOPT.MTO.zcalescape()+"&as="+tOPT.MT+"&agenda_notify="+tOPT.AI,_updateENotifySts)}},_updateENotifySts=function(res){var obj=ZCL_Evl(1,res.responseText);"success"==obj.status&&(_zm.succErrMsg("s",zcal.i18n.successedit),zcal.cdata.opt.MTO=obj.MTO,zcal.cdata.opt.MT=obj.MT,zcal.cdata.opt.AI=obj.AI)},changeEmailNotify=function(){var mailUL=$("<li></li>"),txt="";txt+='<div class="startup"><p><span class="mtb"><span class="SC_select zcl_Sem fn"><input class="inputShadow" id="zcl_MTO" value="'+zcal.cdata.opt.MTO+'" placeholder="" type="text"></span></span></p></div><div class="zcl_senmr">',txt+='<div class="SC_PUbtm"><span data-marker="confirmEmail">'+zcal.i18n.confirm+'</span><span data-marker="cancelEmail" data-val="Cancel">'+zcal.i18n.cancel+"</span></div></div>",mailUL.append($(txt));var confirmDOM=mailUL.find("[data-marker=confirmEmail]").removeAttr("data-marker");confirmDOM&&confirmDOM.on("click",function(){sendConfirmation()});var cancelDOM=mailUL.find("[data-marker=cancelEmail]").removeAttr("data-marker");return cancelDOM&&cancelDOM.on("click",function(){_getEmailNotifyView()}),mailLI.find("#zcl_emailD").empty().append(mailUL),mailLI},sendConfirmation=function(){var opt=zcal.cdata.opt,_newEmailId=$("#zcl_MTO")[0].value.trim();if(opt.CMAIL&&""!=opt.CMAIL&&_newEmailId!=opt.CMAIL||void 0==opt.CMAIL||""==opt.CMAIL&&_newEmailId!=opt.MTO){if(!ZCL_isEmail(_newEmailId))return _zm.succErrMsg("e",zcal.i18n.entervalidemail),$("#zcl_MTO").focus(),!1;opt.CMAIL=_newEmailId,ZCL_XHR("/cal/set.do?type=changeemail&mailto="+_newEmailId.zcalescape(),_confirmEmailSts)}else _getEmailNotifyView()},_confirmEmailSts=function(res){var obj=($.Deferred(),ZCL_Evl(1,res.responseText));""!=obj.MTO&&""==obj.CMAIL?(zcal.cdata.opt.MTO=obj.MTO,zcal.cdata.opt.CMAIL=obj.CMAIL,void 0!=obj.MSG?"INVALID_ID"==obj.MSG?_zm.succErrMsg("e",zcal.i18n.nonregisteredemailid):"NOPERM"==obj.MSG&&_zm.succErrMsg("e",zcal.i18n.nonregisteredemailid):_zm.succErrMsg("s",zcal.i18n.mailconfirmed)):(zcal.cdata.opt.CMAIL=obj.CMAIL,_zm.succErrMsg("s",zcal.i18n.verifymailsend)),_getEmailNotifyView()},ZCL_isEmail=function(email){email=email.trim();var re=/^[\w]([\w\-\.\+\'\/]*)@([\w\-\.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/i;return re.test(email)},toggleAgendaNotify=function(mType){if(0===mType){var opt=zcal.cdata.opt;if(0==$("#zcl_AI").length){var $anotify=$("<li></li>"),txt="";txt+="<h3>"+zcal.i18n.agendanotification+"</h3><div class='section-content startup'><div class='fontSettings mb' rel='"+opt.AI+"'>";for(var i in zcal.AGENDA_INTERVAL)txt+='<em id="zcl_AI" rel="'+i+'" class="'+(opt.AI==i?"sel":"")+'">'+zcal.AGENDA_INTERVAL[i]+"</em>";txt+="</div></div>",$anotify.append($(txt)),$anotify.find("#zcl_AI").on("click",function(){var $ele=$(this);$ele.parent().find("em").removeClass("sel").addClass(""),$ele.removeClass("").addClass("sel"),$ele.parent()[0].setAttribute("rel",$ele[0].getAttribute("rel")),saveEmailNotify()}),$(".SC_cal_prefer").after($anotify)}}else $("#zcl_AI").length>0&&$("#zcl_AI").parents("LI")[0].remove()},_resendEmailSts=function(res){var obj=ZCL_Evl(1,res.responseText);zcal.cdata.opt.CMAIL=obj.CMAIL,_zm.succErrMsg("s",zcal.i18n.mailsendsuccess)},_revertEmailId=function(res){var obj=ZCL_Evl(1,res.responseText);zcal.cdata.opt.CMAIL=obj.CMAIL,_getEmailNotifyView()},ZCL_replaceString=function(str,params){return str.replace(/\{[0-9]\}/g,function(_1){return _1=_1.replace(/[\{\}]/g,""),params[parseInt(_1)]})},_showMenu=function(obj){var menus=[],menuItems=obj.menuItems||[];menuItems.forEach(function(menuItem){var value=menuItem.value,text=menuItem.text;menus.push({htm:"<div>"+text+"</div>",data:{value:value,text:text}})});var deferred=$.Deferred();return obj.list=menus,obj.clk=function(data,element,event){deferred.resolve(data,element.parentNode,event)},obj.onHide=function(){deferred.reject()},menus.length?zmsuite.showMenu(obj):deferred.reject(),deferred.fail(zmUtil.hideMenu),deferred.promise()};exports.initialize=_initialize,exports.uninitialize=_uninitialize,exports.getEmailNotifyView=_getEmailNotifyView},"MailSuite.Apps.CalendarEmailNotify"),_defineSettingsModule("EmailNotify",function(exports,require){"use strict";var App,Components=require("Platform.Components"),SettingAppManager=Components.SettingAppManager,SystemUtils=require("Platform.System.Utils"),APP_ID="email-notify",PAGE_ID="email-notify",EmailNotifyView="MailSuite.Apps.CalendarEmailNotify.EmailNotifyView",_emailnotifyview=function(){return require(EmailNotifyView)},loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},_initializeApp=function(){var progress=($.Deferred(),SystemUtils.makeDeferred());return"undefined"==typeof zcal?loadCalendarData().done(function(){_emailnotifyview().initialize({process:progress})}).fail(progress.reject):_emailnotifyview().initialize({process:progress}),progress.promise()},_uninitializeApp=function(){var progress=SystemUtils.makeDeferred();return _emailnotifyview.uninitialize({process:progress}),progress.promise()},_getAppView=function(){var EmailNotifyView=_emailnotifyview();return EmailNotifyView.getEmailNotifyView()},_handleContainerEvent=function(){return null},_createApp=function(){App=SettingAppManager.create(APP_ID,{attributes:{page:PAGE_ID,isReactApp:!1},initialize:_initializeApp,uninitialize:_uninitializeApp,getView:_getAppView,handleContainerEvent:_handleContainerEvent})},initialize=function(){_createApp(),exports.App=App};initialize()},"MailSuite.Apps"),function(require){"use strict";var CARD_ID="email-notify",PAGE_ID="email-notify",CARD_ITEMS={EMAIL_ADDRESS:"email-address",AGENDA_NOTIFY:"agenda-notify"},I18N={emailaddress:{cardItem:{title:"Email Address"}},agendanotify:{cardItem:{title:"Agenda notification"}}},PlatformComponents=require("Platform.Components"),PlatformEntities=require("Platform.Entities"),SettingCardItemManager=(require("MailSuite.Settings.Calendar"),require("Platform.System.Utils"),PlatformComponents.SettingCardItemManager),SettingCardItem=PlatformEntities.SettingCardItem,CardItemTypes=SettingCardItem.Types,_initialize=(SettingCardItemManager.create(CARD_ITEMS.EMAIL_ADDRESS,{props:{title:I18N.emailaddress.cardItem.title,value:""},attributes:{type:CardItemTypes.LabelAction,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.EMAIL_ADDRESS})}),SettingCardItemManager.create(CARD_ITEMS.AGENDA_NOTIFY,{props:{title:I18N.agendanotify.cardItem.title,value:""},attributes:{type:CardItemTypes.LabelAction,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.AGENDA_NOTIFY})}),function(){});_initialize()}(zmail.Settings.Modules.import),_defineSettingsModule("Pages",function(exports,require){"use strict";var PAGE_ID="calendar-import",PlatformComponents=require("Platform.Components"),SystemEntities=require("Platform.Entities"),I18N={title:"Import"},SettingPageManager=PlatformComponents.SettingPageManager,SettingPage=SystemEntities.SettingPage,PageTypes=SettingPage.Types,Page=SettingPageManager.create(PAGE_ID,{props:{title:I18N.title},attributes:{card:PAGE_ID,category:"calendar",type:PageTypes.Title,pageCSSClass:"calendar-import-page",appContainer:!0}});exports.CalendarImport=Page},"MailSuite"),_defineSettingsModule("Cards",function(exports,require){"use strict";var CARD_ID="calendar-import",CATEGORY_ID="calendar",PAGE_ID="calendar-import",I18N={cardTitle:"Import"},PlatformComponents=require("Platform.Components"),SettingCardManager=PlatformComponents.SettingCardManager,Card=SettingCardManager.create(CARD_ID,{props:{openable:!0,title:I18N.cardTitle,addToSearch:!1},state:{hidden:!1},attributes:{category:CATEGORY_ID},openAction:SettingCardManager.CardActions.OpenPageAction(PAGE_ID)});exports.CalendarImport=Card},"MailSuite"),_defineSettingsModule("ImportView",function(exports){"use strict";var _initialize=function(opts){opts=opts||{};var process=opts.process;process.resolve(),_subscribe()},_uninitialize=function(opts){opts=opts||{};var process=opts.process;process.resolve(),_unsubscribe()},_getImportView=function(){var $fragment=$(document.createDocumentFragment()),txt=(zcal.cdata.opt,zcal.cdata.calOrdArr,""),mailLI=$("<li class='SC_setbox zcl_setbox'></li>"),mailUL=$("<ul></ul>");txt+="<li>",txt+="<h3>"+zcal.i18n.importfromfile+'</h3><div class="zm_impexp pb40">',txt+='<iframe name="zcl_imp" id="zcl_imp" style="display:none"></iframe><form action="/mail/cal/import.do" method="post" enctype="multipart/form-data" target="zcl_imp" onSubmit="return false;" id="zcl_impEve" name="zcl_impEve">',txt+='<input id="zcl_impCkey" value="0" name="zcl_impCkey" type="hidden"/>',txt+='<input id="zcl_owrEvent" value="false" name="zcl_owrEvent" type="hidden"/>',txt+='<input id="zcl_incAtt" value="false" name="zcl_incAtt" type="hidden"/>',txt+='<input id="zcl_incRem" value="false" name="zcl_incRem" type="hidden"/>',txt+='<input id="zcl_mkPvt" value="false" name="zcl_mkPvt" type="hidden"/>',txt+='<div id="importDiv" style="display:;"> <div class="zm_impexpDragdiv"><div id="choose1" data-marker="calimport"><span> <b>'+zcal.i18n.selfiletoimport+'</b> or Drag files here to upload</span></div></div></div><input type="file" id="zcl_impFil" name="zcl_impFil" style="display:none"/>',txt+="</form>",txt+='<div class="SC_select default">'+calSelect()+"</div>",txt+='<div class="zcl_mb">',txt+='<ul class="zcl_Sckls" id="zcl_impMoreOpt" class="moreOptions">',txt+='<li id="zcl_impOvr"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.overrideevent+"</span></div></li>",txt+='<li id="zcl_impAtt"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.includeattendees+"</span></div></li>",txt+='<li id="zcl_impRem"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.includereminder+"</span></div></li>",txt+='<li id="zcl_impPvt"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.markallasprivate+"</span></div></li>",txt+="</ul></div>",txt+="</div></div>",txt+='<div class="zm_comp"><span data-marker="calImportfile">'+zcal.i18n.import+"</span></div>",txt+="</li>",txt+="<li>",txt+="<h3>"+zcal.i18n.importfromurl+'</h3><div class="zm_impexp pb40"><div class="zcl_mb"><div class="startup zcl_mb"><p><span class="mtb">'+zcal.i18n.providecalurl+'<span class="SC_select zcl_Sem fn"><input class="inputShadow" id="zcl_impUrl" placeholder="" type="text"/></span></span></p><div class="SC_select default">'+calSelect1()+"</div></div></div>",txt+='<div class="zcl_mb">',txt+='<ul class="zcl_Sckls"  id="zcl_impMoreOpt1" class="moreOptions">',txt+='<li id="zcl_impOvr"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.overrideevent+"</span></div></li>",txt+='<li id="zcl_impAtt"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.includeattendees+"</span></div></li>",txt+='<li id="zcl_impRem"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.includereminder+"</span></div></li>",txt+='<li id="zcl_impPvt"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.markallasprivate+"</span></div></li>",txt+="</ul></div></div>",txt+='<div class="startup help zcl_mb"><em><img src='+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+' class="info-message"></em><span>'+zcal.i18n.provide_icalurl+"</span></div>",txt+='<div class="zm_comp"><span data-marker="calImporturl">'+zcal.i18n.import+"</span></div>",txt+="</li>",mailUL.append($(txt)),mailUL.find("#zcl_impOvr").off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),mailUL.find("#zcl_impAtt").off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),mailUL.find("#zcl_impRem").off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),mailUL.find("#zcl_impPvt").off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),mailLI.append(mailUL);var calSelDOM=(mailLI.find("#zcl_impCal"),mailLI.find("select"));calSelDOM.length&&calSelDOM.change(function(){this.setAttribute("datachange","true");var selVal=this.value;0==selVal&&ZCL_createCal()});var calImportDOM=mailLI.find("[data-marker=calImportfile]").removeAttr("data-marker");calImportDOM.length&&calImportDOM.on("click",function(){fileImport()});var calImportDOM1=mailLI.find("[data-marker=calImporturl]").removeAttr("data-marker");calImportDOM1.length&&calImportDOM1.on("click",function(){urlImport()});var moreOpt=mailLI.find("#zcl_impMoreOptTxt");moreOpt.off("click").on("click",function(){tgleMoreOptions()});var moreOpt1=mailLI.find("#zcl_impMoreOptTxt1");return moreOpt1.off("click").on("click",function(){tgleMoreOptions1()}),mailLI.find("#choose1").on("click",function(e){var el=e.target||e.srcElement;"SC_icn"!=el.className&&"msi-close"!=el.className&&$("#zcl_impFil").click()}),mailLI.find("#zcl_impFil").on("change",function(e){var fileClass=zmUtil.fileTyp(e.target.files[0].name)[1];fileClass+=" zm-attIcn";var iSize=e.target.files[0].size/1024;iSize=Math.round(100*iSize)/100;var di=$("#choose1").find("span"),div=$('<div class="zmCAt" id="zcl_filediv"></div>'),txt1='<div class="zmL SC_Pbar"><div class="zmLst"><div class="zmDtl"><div class="zmSze"><span class="sum">'+iSize+'KB</span></div><div class="zmFrm"><span>'+ZCL_getHTML(e.target.files[0].name)+'</span></div><div class="zmImg"><i class="'+fileClass+'"></i></div><div class="SC_icn"><i class="msi-close"></i></div></div></div></div></div>';div[0].innerHTML=txt1,di[0].innerHTML="",div.find(".SC_icn").on("click",function(){$("#zcl_impFil")[0].value="",div[0].innerHTML="",di[0].innerHTML="<b>Choose the ICS file to import</b> or Drag files here to upload"}),di.append(div)}),$fragment.append(mailLI),$fragment},tgleMoreOptions=function(){{var $ovr,$incAtt,$incRem,$pvt,$moreOpt=$("#zcl_impMoreOpt");$("#zcl_impMoreOptTxt")}return $ovr=$('<li id="zcl_impOvr"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.overrideevent+"</span></div></li>"),$ovr.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt.append($ovr),$incAtt=$('<li id="zcl_impAtt"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.includeattendees+"</span></div></li>"),$incAtt.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt.append($incAtt),$incRem=$('<li id="zcl_impRem"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.includereminder+"</span></div></li>"),$incRem.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt.append($incRem),$pvt=$('<li id="zcl_impPvt"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.markallasprivate+"</span></div></li>"),$pvt.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt},tgleMoreOptions1=function(){var $moreOpt1=$("#zcl_impMoreOpt1"),$moreOptTxt1=$("#zcl_impMoreOptTxt1");if($moreOpt1.is(":visible"))$moreOpt1.html(""),$moreOptTxt1.text(zcal.i18n.moreoptions),$moreOpt1.hide();else{var $ovr,$incAtt,$incRem,$pvt;$ovr=$('<li id="zcl_impOvr"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.overrideevent+"</span></div></li>"),$ovr.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt1.append($ovr),$incAtt=$('<li id="zcl_impAtt"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.includeattendees+"</span></div></li>"),$incAtt.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt1.append($incAtt),$incRem=$('<li id="zcl_impRem"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.includereminder+"</span></div></li>"),$incRem.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt1.append($incRem),$pvt=$('<li id="zcl_impPvt"><div><i class="msi-uncheck"></i><span class="pl5">'+zcal.i18n.markallasprivate+"</span></div></li>"),$pvt.off("click").on("click",function(){var $chk,that=$(this);$chk=that.find("i"),chgChk($chk)}),$moreOpt1.append($pvt),$moreOptTxt1.text(zcal.i18n.hideoptions),$moreOpt1.show()}},chgChk=function($chk){$chk.hasClass("msi-check")?$chk.removeClass("msi-check").addClass("msi-uncheck"):$chk.removeClass("msi-uncheck").addClass("msi-check")},fileImport=function(){var calKey,fextn,owrEvent=!1,incAtt=!1,incRem=!1,mkPvt=!1,file=$("#zcl_impFil").val().trim(),$moreOpt=$("#zcl_impMoreOpt");if(fextn=file.substr(file.lastIndexOf(".")),".ics"!=fextn)return zmUtil.succErrMsg("e",zcal.i18n.sel_validicsfile),!1;if($moreOpt.is(":visible")){var impOvr=$("#zcl_impOvr").find("i"),impAtt=$("#zcl_impAtt").find("i"),impRem=$("#zcl_impRem").find("i"),impPvt=$("#zcl_impPvt").find("i");owrEvent=impOvr.hasClass("msi-check")?!0:!1,incAtt=impAtt.hasClass("msi-check")?!0:!1,incRem=impRem.hasClass("msi-check")?!0:!1,mkPvt=impPvt.hasClass("msi-check")?!0:!1}if(calKey=$("#zcl_impCal").val(),void 0==calKey)return zmUtil.succErrMsg("e",zcal.i18n.selvacalnam),!1;$("#zcl_impCkey").val(calKey);var csr=ZCL_getCookie("aprmjrnpkcrkks");document.zcl_impEve.appendChild(_zm.getDOM(["INPUT",{attrs:{type:"hidden",name:"mstpcrdhkur",value:csr}}])),$("#zcl_owrEvent").val(owrEvent),$("#zcl_incAtt").val(incAtt),$("#zcl_incRem").val(incRem),$("#zcl_mkPvt").val(mkPvt),document.zcl_impEve.submit()},_importStatus=function(val){if(""==val)zmUtil.succErrMsg("e",zcal.i18n.failimport);else{var robj=ZCL_Evl(1,val);if(0==robj.PCNT)zmUtil.succErrMsg("e",zcal.i18n.failimport);else{robj.TCNT>"10000"?zmUtil.succErrMsg("e",zcal.i18n.failimport+"<br/>Unable to import as it exceeds the limit of 10000 events."):(zmUtil.succErrMsg("s",zcal.i18n.successimport+". "+zcal.i18n.totallyprocessed+" : "+(void 0==robj.PCNT?0:robj.PCNT)+". "+zcal.i18n.actuallyimported+" : "+(void 0==robj.ACNT?0:robj.ACNT)),zcalEvents.loadMonthData()),ZCL_$("zcl_impFil").value="",ZCL_$("zcl_filediv").remove();var di=$("#choose1").find("span");di[0].innerHTML="<b>Choose the ICS file to import</b> or Drag files here to upload"}}},urlImport=function(){{var calKey,calId,rgx,url=$("#zcl_impUrl")[0].value.trim(),owrEvent=!1,incAtt=!1,incRem=!1,mkPvt=!1;$("#zcl_impMoreOpt1")}if(rgx=/^(http|https|webcal|webcals)\:\/\/[-.\w]*(\/?)([a-zA-Z0-9\-\.\?\,\:\'\/\\\+=&amp;%\$#_@]*)?$/i,!rgx.test(url))return zmUtil.succErrMsg("e",zcal.i18n.provide_httpurl),$("#zcl_impUrl")[0].value="",$("#zcl_impUrl")[0].focus(),!1;var impOvr=$("#zcl_impMoreOpt1").find("#zcl_impOvr").find("i"),impAtt=$("#zcl_impMoreOpt1").find("#zcl_impAtt").find("i"),impRem=$("#zcl_impMoreOpt1").find("#zcl_impRem").find("i"),impPvt=$("#zcl_impMoreOpt1").find("#zcl_impPvt").find("i");if(owrEvent=impOvr.hasClass("msi-check")?!0:!1,incAtt=impAtt.hasClass("msi-check")?!0:!1,incRem=impRem.hasClass("msi-check")?!0:!1,mkPvt=impPvt.hasClass("msi-check")?!0:!1,calKey=$("#zcl_impCal1").val(),void 0==calKey)return zmUtil.succErrMsg("e",zcal.i18n.selvacalnam),!1;calId=$("#zcl_impCal option:selected").data("cid");var f="/cal/impurl.do?url="+encodeURIComponent(url)+"&impCkey="+calKey+"&incAtt="+incAtt+"&owrEvent="+owrEvent+"&incRem="+incRem+"&mkPvt="+mkPvt+(calId?"&calId="+calId:"");ZCL_XHR(f,function(res){var _robj=ZCL_Evl(1,res.responseText);processUrlImportResp(_robj)})},processUrlImportResp=function(robj){""==robj?zmUtil.succErrMsg("e",zcal.i18n.failimport):0==robj.PCNT?zmUtil.succErrMsg("e",zcal.i18n.failimport):(robj.TCNT>"10000"?zmUtil.succErrMsg("e",zcal.i18n.importfailure_exceedlimit):(zmUtil.succErrMsg("s",zcal.i18n.cal_successimport+". "+zcal.i18n.numofeve_processed+" : "+(void 0==robj.PCNT?0:robj.PCNT)+". "+zcal.i18n.imported+" : "+(void 0==robj.ACNT?0:robj.ACNT)),zcalEvents.loadMonthData()),$("#zcl_impUrl")[0].value="")},calSelect=function(){var calStr='<select id="zcl_impCal" datachange = "false">';return calStr+=calSelOption(),calStr+="</select>"},calSelOption=function(selId){var calOrder=zcal.cdata.calOrdArr,calStr="";return calOrder.forEach(function(id){var calLst=zcal.cdata.calLst;"1"==calLst[id][8]&&(calStr+='<option value="'+calLst[id][9]+'" data-cid="'+id+'" '+(id==selId?"selected":"")+">"+ZCL_getHTML(calLst[id][0])+"</option>")}),calOrder.length<100&&(calStr+='<option value="0">'+zcal.i18n.newcal+"</option>"),calStr},_updCalSel=function(ev,data){var id=$("true"==$("#zcl_impCal")[0].getAttribute("datachange")?"#zcl_impCal":"#zcl_impCal1");id[0].setAttribute("datachange","false");{var optStr;$("#zcl_impCal")}optStr=data&&data.calid?calSelOption(data.calid):calSelOption(),""!=optStr&&(id.empty(),id.html(optStr))},calSelect1=function(){var calStr='<select id="zcl_impCal1" datachange = "false">';return calStr+=calSelOption1(),calStr+="</select>"},calSelOption1=function(selId){var calOrder=zcal.cdata.calOrdArr,calStr="";return calOrder.forEach(function(id){var calLst=zcal.cdata.calLst;"1"==calLst[id][8]&&(calStr+='<option value="'+calLst[id][9]+'" data-cid="'+id+'" '+(id==selId?"selected":"")+">"+ZCL_getHTML(calLst[id][0])+"</option>")}),calOrder.length<100&&(calStr+='<option value="0">'+zcal.i18n.newcal+"</option>"),calStr},_subscribe=function(){$.subscribe("/calendar/added",exports.updCalSel),$.subscribe("/calendar/updated",exports.updCalSel),$.subscribe("/calendar/deleted",exports.updCalSel),$.subscribe("/calendar/statusChanged",exports.updCalSel)},_unsubscribe=function(){$.unsubscribe("/calendar/added",exports.updCalSel),$.unsubscribe("/calendar/updated",exports.updCalSel),$.unsubscribe("/calendar/deleted",exports.updCalSel),$.unsubscribe("/calendar/statusChanged",exports.updCalSel)};exports.initialize=_initialize,exports.uninitialize=_uninitialize,exports.getImportView=_getImportView,exports.updCalSel=_updCalSel,exports.showImportStatus=_importStatus},"MailSuite.Apps.CalendarImport"),_defineSettingsModule("Import",function(exports,require){"use strict";var App,Components=require("Platform.Components"),SettingAppManager=Components.SettingAppManager,SystemUtils=require("Platform.System.Utils"),APP_ID="calendar-import",PAGE_ID="calendar-import",ImportView="MailSuite.Apps.CalendarImport.ImportView",_importview=function(){return require(ImportView)},loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},_initializeApp=function(){var progress=($.Deferred(),SystemUtils.makeDeferred());return"undefined"==typeof zcal?loadCalendarData().done(function(){_importview().initialize({process:progress})}).fail(progress.reject):_importview().initialize({process:progress}),progress.promise()},_uninitializeApp=function(){var progress=SystemUtils.makeDeferred();return _importview().uninitialize({process:progress}),progress.promise()},_getAppView=function(){var ImportView=_importview();return ImportView.getImportView()},_handleContainerEvent=function(){return null},_createApp=function(){App=SettingAppManager.create(APP_ID,{attributes:{page:PAGE_ID,isReactApp:!1},initialize:_initializeApp,uninitialize:_uninitializeApp,getView:_getAppView,handleContainerEvent:_handleContainerEvent})},initialize=function(){_createApp(),exports.App=App};initialize()},"MailSuite.Apps"),function(require){"use strict";{var CARD_ID="calendar-import",PAGE_ID="calendar-import",CARD_ITEMS={BY_FILE:"by-file",BY_URL:"by-url"},I18N={byfile:{cardItem:{title:"By File"}},byurl:{cardItem:{title:"By URL"}}},PlatformComponents=require("Platform.Components"),PlatformEntities=require("Platform.Entities"),SettingCardItemManager=(require("MailSuite.Settings.Calendar"),require("Platform.System.Utils"),PlatformComponents.SettingCardItemManager),SettingCardItem=PlatformEntities.SettingCardItem,CardItemTypes=SettingCardItem.Types;SettingCardItemManager.create(CARD_ITEMS.BY_FILE,{props:{title:I18N.byfile.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.BY_FILE})}),SettingCardItemManager.create(CARD_ITEMS.BY_URL,{props:{title:I18N.byurl.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.BY_URL})})}}(zmail.Settings.Modules.import),_defineSettingsModule("Pages",function(exports,require){"use strict";var PAGE_ID="calendar-subscribe",PlatformComponents=require("Platform.Components"),SystemEntities=require("Platform.Entities"),I18N={title:"Subscribe"},SettingPageManager=PlatformComponents.SettingPageManager,SettingPage=SystemEntities.SettingPage,PageTypes=SettingPage.Types,Page=SettingPageManager.create(PAGE_ID,{props:{title:I18N.title},attributes:{card:PAGE_ID,category:"calendar",type:PageTypes.Title,pageCSSClass:"calendar-subscribe-page",appContainer:!0}});exports.CalendarSubscribe=Page},"MailSuite"),_defineSettingsModule("Cards",function(exports,require){"use strict";var CARD_ID="calendar-subscribe",CATEGORY_ID="calendar",PAGE_ID="calendar-subscribe",I18N={cardTitle:"Subscribe"},PlatformComponents=require("Platform.Components"),SettingCardManager=PlatformComponents.SettingCardManager,Card=SettingCardManager.create(CARD_ID,{props:{openable:!0,title:I18N.cardTitle,addToSearch:!1},state:{hidden:!1},attributes:{category:CATEGORY_ID},openAction:SettingCardManager.CardActions.OpenPageAction(PAGE_ID)});exports.CalendarSubscribe=Card},"MailSuite"),_defineSettingsModule("SubscribeView",function(exports){"use strict";var div,mainG,_initialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},_uninitialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},FCAL_OBJ=[],HOLIDAYS_LIST=[],_getSubscribeView=function(){var $fragment=$(document.createDocumentFragment()),mailLI=$("<li class='SC_setbox zcl_setbox'></li>"),txt=(zcal.cdata.opt,""),mailUL=$("<ul></ul>");txt+="<li>",txt+="<h3>"+zcal.i18n.subscribe_weburl+'</h3><div class="startup zcl_mb"><p><span class="mtb">Enter URL :<span class="SC_select zcl_Sem fn"><input id="zcl_subLink" class="inputShadow" placeholder="" type="text"></span></span></p></div><div class="startup help zcl_mb"><em><img src='+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+' class="info-message"></em><span>'+zcal.i18n.provide_httpurl+'</span></div><div class="zm_comp"><span data-marker="subToCal">'+zcal.i18n.subscribe+"</span></div>",txt+="</li>",txt+="<li>",txt+="<h3>"+zcal.i18n.subsribe_contacts+'</h3><div class="startup zcl_mb"><p><span class="mtb">'+zcal.i18n.provide_contemail+'<span class="SC_select zcl_Sem fn"><input class="inputShadow" placeholder="" type="text" id="zcl_fEmailId"></span></span></p></div><div class="startup help zcl_mb"><em><img src='+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+' class="info-message"></em><span>'+zcal.i18n.friends_email_note+'</span></div><div class="zm_comp"><span data-marker="listFCal">'+zcal.i18n.subscribe+"</span></div>",txt+="</li>",txt+="<li>",txt+="<h3>"+zcal.i18n.subscribe_holiday+'</h3><div class="startup help zcl_mb"><em><img src='+(zmail.imgPath?zmail.imgPath+"settings/lightbulb-info.png":zmResource.get("image","settings/lightbulb-info.png"))+' class="info-message"></em><span>'+zcal.i18n.holiday_note+'</span></div><div class="zm_comp"><span data-marker="holidaylist">'+zcal.i18n.showavaicountry+"</span></div>",txt+="</li>",txt+="<li>",txt+="<h3>"+zcal.i18n.subscribe_group+"</h3>";var groupArr=getPerGroupForList();groupArr.length>0?(txt+='<div class="startup zcl_mb"><p><span>'+zcal.i18n.selgroupview+'</span><span class="SC_select" style=""><input data-marker="pergrouplist" type="text" value="select a group" id="zcl_gid" readonly=""></span></p></div>',txt+='<div class="zm_comp"><span data-marker="listGCal">'+zcal.i18n.ok+"</span></div>"):txt+='<div class="startup zcl_mb"><p><span>No groups availble</span></p></div>',txt+="</li>",mailUL.append($(txt)),mailLI.append(mailUL),$fragment.append(mailLI);var holiday=mailLI.find("[data-marker=holidaylist]").removeAttr("data-marker");holiday.length&&holiday.on("click",function(){requestHolidays()});var group=mailLI.find("[data-marker=pergrouplist]").removeAttr("data-marker");group.length&&group.on("click",function(){var component,groupArr=getPerGroupForList(),config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="popup",config.onSelect=function(id,selectObj){setGroupValue(that,id,selectObj),component.hide()},config.onHide=function(){_zm.remove(_zm("#","zm_dropDown"))},config.dataCallback=function(){return groupArr},component=zmUtil.createFLComp("generic",config),component.show()});var listFCalDOM=mailLI.find("[data-marker=listFCal]").removeAttr("data-marker");listFCalDOM.length&&listFCalDOM.on("click",function(){getFriendsCalendar()});var listGCalDOM=mailLI.find("[data-marker=listGCal]").removeAttr("data-marker");listGCalDOM.length&&listGCalDOM.on("click",function(){var gid=$("#zcl_gid")[0].getAttribute("data-gid");if(null!=gid){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return openGroupCalPopup(gid)}}).done(function(args){args.card.show()})}else _zm.succErrMsg("e","select a group")});var subToCalDOM=mailLI.find("[data-marker=subToCal]").removeAttr("data-marker");return subToCalDOM.length&&subToCalDOM.on("click",function(){var subURL=$("#zcl_subLink")[0].value.trim(),icalFormat=/^(http|webcal)(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\:\'\/\\\+=&amp;%\$\*\]\[#_@]*)?$/;return""==subURL?(_zm.succErrMsg("e",zcal.i18n.entervalidhttpurl),$("#zcl_subLink")[0].focus(),!1):void(icalFormat.test(subURL)?subscribeURL(subURL):(_zm.succErrMsg("e",zcal.i18n.entervalidhttpurl),$("#zcl_subLink")[0].value="",$("#zcl_subLink")[0].focus()))}),$fragment},_loadHolidays=function(res){var resObj=ZCL_Evl(1,res.responseText),mode=resObj.mode;if("list"==mode){HOLIDAYS_LIST=resObj.obj;var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return listHolidays()}}).done(function(args){args.card.show()})}},subscribeListDom=$('<div class="SC_Twpr zcl_Twpr zcl_Twpr_list"></div>'),listHolidays=function(){for(var hObj=HOLIDAYS_LIST,holLstDOM=$('<div class="editFilterParent ht100p"></div>'),subDiv=$('<div class="subDiv"></div>'),topDiv=$('<div class="SC_ptit"><div><div class="impExpHeading">'+zcal.i18n.holidays+"</div></div></div>"),bottomDiv=$('<div class="SC_filt_bottom SC_filt_bottomCustom"><div data-marker="loadingAnimation"></div></div>'),i=($('<div class="editFilterParent"></div>'),0);i<hObj.length;i++){var calDOM=$('<div class="zmL"></div>'),lStr="";lStr+="<ul><li><span>"+ZCL_getHTML(hObj[i][0])+"</span></li>",lStr+='<li><div class="SC_PUbtm">',lStr+=-1==zcal.cdata.calOUids.indexOf(hObj[i][1])?'<span data-val="Cancel"   data-marker="sub" id="sub">'+zcal.i18n.subscribe+"</span>":'<span class="sel" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</div></li>",lStr+="</ul>",calDOM.html(lStr);var subDOM=calDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&bindSubscribeHoliday(subDOM,hObj[i][1],hObj[i][0]);var unsubDOM=calDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&bindUnSubscribeHoliday(unsubDOM,hObj[i][1]),holLstDOM.append(calDOM)}return bottomDiv.append(holLstDOM),subDiv.append(topDiv),subDiv.append(bottomDiv),subscribeListDom.empty().append(subDiv),subscribeListDom},bindSubscribeHoliday=function(subDOM,hUid,hName){subDOM.on("click",{uid:hUid,name:hName},function(ev){subscribeHoliday(ev.data.uid,ev.data.name)})},subscribeHoliday=function(id,name){var flnam="/cal/subHoli.do?mode=sub&huid="+encodeURIComponent(id)+"&loc="+name;ZCL_XHR(flnam,function(res){_processSubscribeSts(res)})},bindUnSubscribeHoliday=function(unsubDOM,hUid){unsubDOM.on("click",{uid:hUid},function(ev){unsubscribeCal(ev.data.uid)})},unsubscribeCal=function(uid){ZCL_XHR("/cal/calAct.do?mode=delByUid&caluid="+encodeURIComponent(uid),function(res){_processUnsubscribeSts(res)})},requestHolidays=function(){if(0==HOLIDAYS_LIST.length){var flnam="/cal/subHoli.do?mode=list";ZCL_XHR(flnam,function(res){_loadHolidays(res)})}else{var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return listHolidays()}}).done(function(args){args.card.show()})}},getFriendsCalendar=function(){var fmailId=$("#zcl_fEmailId").val();return ZCL_isEmail(fmailId)?void ZCL_XHR("/cal/subCal.do?mode=pub-lst&mailId="+fmailId.zcalescape(),function(res){_listFriendsCalendar(res)}):(_zm.succErrMsg("e",zcal.i18n.entervalidemailid),ZCL_$("zcl_fEmailId").focus(),!1)},_listFriendsCalendar=function(res){var _robj=ZCL_Evl(1,res.responseText);if("pub-lst"==_robj.mode)if("du"==_robj.result){var obt=_robj.obj;FCAL_OBJ=[obt.pub,obt.pvt,_robj.mid],constFCalList()}else"su"==obj.result?_zm.succErrMsg("i",zcal.i18n.cannotsubtoowncal):"nonzoho"==obj.result?_zm.succErrMsg("i",ZCL_replaceComName(zcal.i18n.theuserdonthavezohoacc)):"np"==obj.result&&_zm.succErrMsg("e",zcal.i18n.cannotsubnonorgmemcal)},constFCalList=function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return friendsCalendarlistView()}}).done(function(args){args.card.show()})},subscribeFriendsDOM=$('<div class="SC_Twpr zcl_Twpr zcl_Twpr_list"></div>'),friendsCalendarlistView=function(){var _pubCal=FCAL_OBJ[0],_pvtCal=FCAL_OBJ[1];div=$('<div id="subDiv1"></div>');var topDiv=$('<div class="SC_ptit"><div class="impExpHeading">'+zcal.i18n.publiccal+"</div></div>"),bottomDiv=$('<div class="SC_filt_bottom SC_filt_bottomCustom"></div>'),b=$('<div class = "editFilterParent ht100p"></div>');if(ZCL_isEmpty(_pubCal)){var emptyStr='<div class="zmL"><ul><li><em>'+zcal.i18n.calnotfound+"</em></li></ul></div>";b.append(emptyStr)}else for(var i in _pubCal){var calDOM=$('<div class="zmL"></div>'),lStr="";lStr+="<ul><li><span>"+ZCL_getHTML(_pubCal[i][0])+"</span><em>"+(1==_pubCal[i][1]?zcal.i18n.viewonlyfreebusy:zcal.i18n.vieweventdetail)+"</em></li>",lStr+='<li><div class="SC_PUbtm">',lStr+=-1==zcal.cdata.calOUids.indexOf(_pubCal[i][2])?'<span  data-val="Cancel" data-marker="sub">'+zcal.i18n.subscribe+"</span>":'<span class="sel" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>",lStr+="</div></li>",lStr+="</ul>",calDOM.html(lStr);var subDOM=calDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",{id:i},function(ev){subscribePubSharedCal(ev.data.id)});var unsubDOM=calDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&unsubDOM.on("click",{uid:_pubCal[i][2]},function(ev){unsubscribeCal(ev.data.uid)}),b.append(calDOM)}if(!ZCL_isEmpty(_pvtCal));var _sendReqDOM=b.find("#zcl_pvtshreqlnk");return _sendReqDOM.length||(_sendReqDOM=$('<span class="SC_lnk" id="zcl_pvtshreqlnk"/>'),b.append(_sendReqDOM)),_sendReqDOM.html("&raquo;"+zcal.i18n.sendreqforindividualshare),_sendReqDOM.off("click").on("click",{eid:FCAL_OBJ[2]},function(ev){sendPvtShareReq(ev.data.eid)}),bottomDiv.append(b),div.append(topDiv),div.append(bottomDiv),subscribeFriendsDOM.empty().append(div),subscribeFriendsDOM},sendPvtShareReq=function(eid){var f="/cal/sentReq.do?mailId="+eid.zcalescape();ZCL_XHR(f,function(res){_processSendPvtShareReqSts(res)})},_processSendPvtShareReqSts=function(){_zm.succErrMsg("s",zcal.i18n.requestmailsent)},subscribePubSharedCal=function(id){var f="/cal/subCal.do?mode=sub-url&url="+encodeURIComponent(location.protocol+"//"+zcal.ZCAL+"/ical/"+id);ZCL_XHR(f,function(res){_processSubscribeSts(res)})},subscribeURL=function(subURL){var f="/cal/subCal.do?mode=sub-url&url="+encodeURIComponent(subURL);ZCL_XHR(f,function(res){_processSubscribeSts(res)})},_processSubscribeSts=function(res){if(200===res.status){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var obj=_robj.obj;zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,ZCL_updateAppCalList(obj.aclst),_zm.succErrMsg("s",zcal.i18n.calSubSuccess),$.publish("/calendar/subscribed"),div?friendsCalendarlistView():subscribeListDom&&listHolidays(),$("#zcl_subLink")[0].value=""}else _zm.succErrMsg("e",zcal.i18n[_robj.status]),$("#zcl_subLink")[0].value=""}else _zm.succErrMsg("e",zcal.i18n.errmsg),$("#zcl_subLink")[0].value=""},ZCL_updateAppCalList=function(appCalList){var _cobj;zcal.cdata.calALst={};for(var i in appCalList)_cobj=appCalList[i],"recruit"!=_cobj[14]&&(zcal.cdata.calALst[i]=ZCL_Evl(1,JSON.stringify(_cobj)))},_processUnsubscribeSts=function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var id=_robj.id;zcal.cdata.calLst[id]?(delete zcal.cdata.calLst[id],ZCL_remCalid(id),_zm.succErrMsg("s",zcal.i18n.caldeleted)):(zcal.cdata.calOLst[id]||zcal.cdata.calGLst[id]||zcal.cdata.calALst[id])&&(zcal.cdata.calGLst[id]?delete zcal.cdata.calGLst[id]:delete zcal.cdata.calOLst[id],ZCL_remOCalid(_robj.uid),_zm.succErrMsg("s",zcal.i18n.unsubscribesuc)),ZCL_gothro(id),div?friendsCalendarlistView():subscribeListDom&&listHolidays()}else _zm.succErrMsg("e",_robj.status)},ZCL_isEmpty=function(obj){for(var prop in obj)if(obj.hasOwnProperty(prop))return!1;return!0},updateGroupList=function(groupArr,groupList){for(var i=0;i<groupList.length;i++){var group=zcalGroup.getGroup(groupList[i]);group&&groupArr.push({id:groupList[i],name:group.name,display_text:group.name})}},getPerGroupForList=function(){var groupList,groupArr=[];return groupList=zcalGroup.getGroupList("personal"),updateGroupList(groupArr,groupList),groupList=zcalGroup.getGroupList("org"),updateGroupList(groupArr,groupList),groupArr},setGroupValue=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("data-gid",id)},GRP_CALLIST={},openGroupCalPopup=function(gid){mainG=$("<div class='SC_Twpr zcl_Twpr zcl_Twpr_list'></div>");for(var _tabDOM=$("<div class='SC_setTab'><div class='SC_setTabList' id='zcl_grpcallst_tabs'></div></div><div class='SC_filt_bottom SC_filt_bottomCustom'><div class='editFilterParent'  id='zcl_grpcallst'></div></div>"),defTab="def",_tabs=[{type:"def",text:zcal.i18n.available},{type:"sh",text:zcal.i18n.shared},{type:"sub",text:zcal.i18n.subscribed}],i=0;i<_tabs.length;i++){var tab=$('<span id="zcl_grpcal_'+_tabs[i].type+'">></span>');tab.addClass(_tabs[i].type==defTab?"sel":""),tab.text(_tabs[i].text),bindTabClickEvent(tab,_tabs[i].type),_tabDOM.find(".SC_setTabList").append(tab)}return $.when(fetchGroupCalList(gid)).then(function(){listGroupCal("def")}),mainG.append(_tabDOM),mainG},bindTabClickEvent=function(tab,tabType){tab.off("click").on("click",{type:tabType},function(ev){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),listGroupCal(ev.data.type)})},fetchGroupCalList=function(gid){var deferred=$.Deferred();return ZCL_XHR("/cal/grpDtl.do?mode=grp-callst&comid="+gid,function(res){GRP_CALLIST=ZCL_Evl(1,res.responseText),deferred.resolve(GRP_CALLIST)}),deferred},listGroupCal=function(type){var calList,_calDOM=$("#zcl_grpcallst");if(calList="sh"==type?GRP_CALLIST.shdcLst:"sub"==type?GRP_CALLIST.subcLst:GRP_CALLIST.owncLst,_calDOM.empty(),ZCL_isEmpty(calList)){if(_calDOM.is(":empty")){var liDOM=$('<div class="zmL"><li><em>'+zcal.i18n.no_sharecalendar+"</em></li></div>");_calDOM.append(liDOM)}}else for(var i in calList){var _cal=calList[i],liDOM=$('<div class="zmL"></div>'),lStr="";lStr+="<ul><li><span>"+_cal.CNAME+"</span></li>",lStr+='<li><div class="SC_PUbtm">',_cal.IS_OWN||1==_cal.IS_OWN||(lStr+=0==_cal.IS_SUB?'<span data-val="Cancel"   data-marker="sub" id="sub">'+zcal.i18n.subscribe+"</span>":'<span class="sel" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span>"),lStr+="</div></li>",lStr+="</ul>",liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",{uid:i,gid:GRP_CALLIST.comid},function(ev){subscribeCalGroup(ev.data.uid,ev.data.gid)});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&unsubDOM.on("click",{uid:i},function(ev){unsubscribeCalGroup(ev.data.uid)}),_calDOM.append(liDOM)}mainG.find("SC_filt_bottom SC_filt_bottomCustom").append(_calDOM)},subscribeCalGroup=function(calUId,gid){var f="/cal/subCal.do?mode=grpcal-sub&caluid="+encodeURIComponent(calUId)+"&grpid="+gid;ZCL_XHR(f,_processSubscribeGroupSts)},unsubscribeCalGroup=function(uid){ZCL_XHR("/cal/calAct.do?mode=delByUid&caluid="+encodeURIComponent(uid),_processUnsubscribeGroupSts)},_processSubscribeGroupSts=function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var _gtabDOM,_stab,obj=_robj.obj,uid=_robj.uid;zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,zcal.cdata.calByGrp=obj.gclstbygrp,ZCL_updateAppCalList(obj.aclst),_zm.succErrMsg("s",zcal.i18n.calSubSuccess),updateGrpCalLst(uid),_gtabDOM=$("#zcl_grpcallst_tabs"),_stab=_gtabDOM.find(".sel"),listGroupCal("zcl_grpcal_sh"==_stab[0].id?"sh":"zcl_grpcal_sub"==_stab[0].id?"sub":"def"),$.publish("/calendar/subscribed")}else"available"==_robj.status?_zm.succErrMsg("s",zcal.i18n.calSubSuccess):_zm.succErrMsg("e",_robj.status)},_processUnsubscribeGroupSts=function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var _gtabDOM,_stab,id=_robj.id,uid=_robj.uid;$.publish("/calendar/deleted",{calid:id,caluid:uid,mode:"unsubscribe"}),updateGrpCalLst(uid);var _gtabDOM=$("#zcl_grpcallst_tabs"),_stab=_gtabDOM.find(".sel");listGroupCal("zcl_grpcal_sh"==_stab[0].id?"sh":"zcl_grpcal_sub"==_stab[0].id?"sub":"def")}else _zm.succErrMsg("e",_robj.status)},updateGrpCalLst=function(uid){if(!ZCL_isEmpty(GRP_CALLIST)){if(GRP_CALLIST.owncLst&&GRP_CALLIST.owncLst[uid])return void(GRP_CALLIST.owncLst[uid].IS_SUB=0==GRP_CALLIST.owncLst[uid].IS_SUB?1:0);if(GRP_CALLIST.shdcLst&&GRP_CALLIST.shdcLst[uid])return void(GRP_CALLIST.shdcLst[uid].IS_SUB=0==GRP_CALLIST.shdcLst[uid].IS_SUB?1:0);GRP_CALLIST.subcLst&&GRP_CALLIST.subcLst[uid]&&(GRP_CALLIST.subcLst[uid].IS_SUB=0==GRP_CALLIST.subcLst[uid].IS_SUB?1:0)}};exports.initialize=_initialize,exports.uninitialize=_uninitialize,exports.getSubscribeView=_getSubscribeView},"MailSuite.Apps.CalendarSubscribe"),_defineSettingsModule("Subscribe",function(exports,require){"use strict";var App,Components=require("Platform.Components"),SettingAppManager=Components.SettingAppManager,SystemUtils=require("Platform.System.Utils"),APP_ID="calendar-subscribe",PAGE_ID="calendar-subscribe",SubscribeView="MailSuite.Apps.CalendarSubscribe.SubscribeView",_subscribeview=function(){return require(SubscribeView)},loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},_initializeApp=function(){{var progress=SystemUtils.makeDeferred();$.Deferred()}return"undefined"==typeof zcal?loadCalendarData().done(function(){_subscribeview().initialize({process:progress})}).fail(progress.reject):_subscribeview().initialize({process:progress}),progress.promise()},_uninitializeApp=function(){var progress=SystemUtils.makeDeferred();return _subscribeview.uninitialize({process:progress}),progress.promise()},_getAppView=function(){var Subscribeview=_subscribeview();return Subscribeview.getSubscribeView()},_handleContainerEvent=function(){return null},_createApp=function(){App=SettingAppManager.create(APP_ID,{attributes:{page:PAGE_ID,isReactApp:!1},initialize:_initializeApp,uninitialize:_uninitializeApp,getView:_getAppView,handleContainerEvent:_handleContainerEvent})},initialize=function(){_createApp(),exports.App=App};initialize()},"MailSuite.Apps"),function(require){"use strict";{var CARD_ID="calendar-subscribe",PAGE_ID="calendar-subscribe",CARD_ITEMS={WEB_URL:"web-url",FRIENDS_CALENDAR:"friends-calendar",HOLI_DAY:"holi-day",GROUPS:"groups"},I18N={weburl:{cardItem:{title:"Web URL"}},friendscalendar:{cardItem:{title:"Friends Calendar"}},holiday:{cardItem:{title:"HoliDays"}},groups:{cardItem:{title:"Groups"}}},PlatformComponents=require("Platform.Components"),PlatformEntities=require("Platform.Entities"),SettingCardItemManager=(require("MailSuite.Settings.Calendar"),require("Platform.System.Utils"),PlatformComponents.SettingCardItemManager),SettingCardItem=PlatformEntities.SettingCardItem,CardItemTypes=SettingCardItem.Types;SettingCardItemManager.create(CARD_ITEMS.WEB_URL,{props:{title:I18N.weburl.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.WEB_URL})}),SettingCardItemManager.create(CARD_ITEMS.FRIENDS_CALENDAR,{props:{title:I18N.friendscalendar.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.FRIENDS_CALENDAR})}),SettingCardItemManager.create(CARD_ITEMS.HOLI_DAY,{props:{title:I18N.holiday.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.HOLI_DAY})}),SettingCardItemManager.create(CARD_ITEMS.GROUPS,{props:{title:I18N.groups.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID,{showSection:CARD_ITEMS.GROUPS})})}}(zmail.Settings.Modules.import),_defineSettingsModule("Pages",function(exports,require){"use strict";var PAGE_ID="calendar-sync",PlatformComponents=require("Platform.Components"),SystemEntities=require("Platform.Entities"),I18N={title:"Sync"},SettingPageManager=PlatformComponents.SettingPageManager,SettingPage=SystemEntities.SettingPage,PageTypes=SettingPage.Types,Page=SettingPageManager.create(PAGE_ID,{props:{title:I18N.title},attributes:{card:PAGE_ID,category:"calendar",type:PageTypes.Title,pageCSSClass:"calendar-sync-page",appContainer:!0}});exports.CalendarSync=Page},"MailSuite"),_defineSettingsModule("Cards",function(exports,require){"use strict";var CARD_ID="calendar-sync",CATEGORY_ID="calendar",PAGE_ID="calendar-sync",I18N={cardTitle:"Synchronize"},PlatformComponents=require("Platform.Components"),SettingCardManager=PlatformComponents.SettingCardManager,Card=SettingCardManager.create(CARD_ID,{props:{openable:!0,title:I18N.cardTitle,addToSearch:!1},state:{hidden:!1},attributes:{category:CATEGORY_ID},openAction:SettingCardManager.CardActions.OpenPageAction(PAGE_ID)});exports.CalendarSync=Card},"MailSuite"),_defineSettingsModule("SyncView",function(exports){"use strict";var main,_initialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},_uninitialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},gCalObj=[],gCalSyncStatus=0,gCalWinTimeOut=null,_getSyncList=function(){var syncList={};return-1!=zcal.ZCAL.indexOf("zoho")&&-1==zcal.ZCAL.indexOf("zoho.com.cn")&&-1==zcal.ZCAL.indexOf("baihui")&&-1==zcal.ZCAL.indexOf("zoho.in")&&(syncList.outlook={text:zcal.i18n.outlook,msg:zcal.i18n.ms_subtitle,type:"outlook"}),-1==zcal.ZCAL.indexOf("zoho.com.cn")&&-1==zcal.ZCAL.indexOf("baihui")&&(syncList.gcal={text:zcal.i18n.gcal,msg:zcal.i18n.gcal_subtitle,type:"gcal"}),syncList.caldav={text:zcal.i18n.caldav,msg:ZCL_replaceProName(zcal.i18n.cald_subtitle),type:"caldav"},-1==zcal.ZCAL.indexOf("zoho.com.cn")&&-1==zcal.ZCAL.indexOf("baihui")&&-1!=zcal.ZCAL.indexOf("zoho")&&(syncList.zcalsync={text:ZCL_replaceComName(zcal.i18n.zcalsync),msg:ZCL_replaceProName(zcal.i18n.zcalsync_subnote),type:"zcalsync"}),syncList},_getSyncView=function(){var syncList=(zcal.cdata.opt,_getSyncList()),mailLI=$('<li class="SC_setbox zcl_setbox"></li>'),d1=$('<div class="SC_Twpr zcl_Twpr zcl_Twpr_list"></div>'),d2=$('<div class="SC_filt_bottom SC_filt_bottomCustom"></div>');for(var i in syncList){var sync=syncList[i],listDOM=$("<div class='zmL'></div>");listDOM.html("<ul><li><span>"+sync.text+"</span><em>"+sync.msg+"</em></li></ul>"),listDOM.on("click",{type:sync.type},function(ev){_openSyncCard(ev.data.type)}),d2.append(listDOM)}return d1.append(d2),mailLI.append(d1),mailLI},_openSyncCard=function(type){if("caldav"===type)_openCalDAVCard();else if("gcal"===type){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return _openGCalCard()}}).done(function(args){args.card.show()})}else if("outlook"===type){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return _openOutlookCard()}}).done(function(args){args.card.show()})}else"zcalsync"===type&&openZcalsynclink()},_openOutlookCard=function(){var main=$('<div class="SC_Twpr zcl_Twpr zcl_Twpr_list"></div>'),topDiv=$('<div class="SC_ptit"><div><div class="impExpHeading">'+ZCL_replaceProName(zcal.i18n.ms_title)+"</div></div></div>"),bottomDiv=$('<div id="zmsdialogcont_zcl_olpp" class="SC_PUcen" style="max-height: 337px;"></div>'),lStr="";return lStr+='<div id="zcl_olpp">',lStr+='<div class="SC_PUcen zcl_ovr" style="max-height: 551px;">',lStr+='<ul class="SC_cal_groups">',lStr+='<li><div id="zcl_olbtn" class="zm_comp"><a title='+ZCL_replaceComName(zcal.i18n.outlooktitle64)+" href= "+zcal.OUTLOOK64+' class="SC_lnk"><span>Download</span><span><i class="msi-download zcl_mt8"></i></span></a></div><span>'+ZCL_replaceComName(zcal.i18n.outlooktitle64)+"<s>Beta</s></span><em>("+ZCL_replaceProName(zcal.i18n.outlooksubtitle64)+")</em></li>",lStr+='<li><div id="zcl_olbtn" class="zm_comp"><a title='+ZCL_replaceComName(zcal.i18n.outlooktitle32)+" href= "+zcal.OUTLOOK32+' class="SC_lnk"><span>Download</span><span><i class="msi-download zcl_mt8"></i></span></a></div><span>'+ZCL_replaceComName(zcal.i18n.outlooktitle32)+"<s>Beta</s></span><em>("+ZCL_replaceProName(zcal.i18n.outlooksubtitle32)+")</em></li>",lStr+="</ul>",lStr+="<p>"+zcal.i18n.mssync_help_link+"</p>",lStr+="</div>",lStr+="</div>",bottomDiv.append($(lStr)),bottomDiv.find("a").addClass("SC_lnk"),main.append(topDiv),main.append(bottomDiv),main},_openGCalCard=function(){main=$('<div class="SC_Twpr zcl_Twpr zcl_Twpr_list"></div>');var topDiv=$('<div class="SC_PUtt"><div><div class="impExpHeading">'+zcal.i18n.gcal+"</div></div></div>"),bottomDiv=$('<div id="bt_div" class="SC_filt_bottom SC_filt_bottomCustom"></div>');return main.append(topDiv),main.append(bottomDiv),gCalObj&&gCalObj.length>0?_listGCal():ZCL_XHR("/cal/getGCal.do?mode=auth",function(res){gCalObj=ZCL_Evl(1,res.responseText),gCalObj?_listGCal():zcl_authCon(bottomDiv)}),main},zcl_authCon=function(bDiv){bDiv.append('<div style="padding: 30px 20px 0;">'+zcal.i18n.gcalauthmsg+'</div><div style="padding: 30px 20px 0;"><i class="msi-uncheck" id="term_pol"></i>'+ZCL_replaceString(zcal.i18n.gcaltermspolicy,["<a href='https://policies.google.com/terms' class='zcl_lk' target='_blank' style='vertical-align: top;font-size: 14px;text-decoration:  none;' rel='noreferrer'>","<a href='https://policies.google.com/privacy' class='zcl_lk' target='_blank' style='vertical-align: top;font-size: 14px;text-decoration:  none;' rel='noreferrer'>"])+'</div><div class="SC_PUbtm"><span data-marker="gcal">'+zcal.i18n.authenticategcal+"</span></div>"),bDiv.find(".msi-uncheck").on("click",function(ev){ev.target.className="msi-uncheck"==ev.target.className?"msi-check":"msi-uncheck"});var auDOM=bDiv.find("[data-marker=gcal]").removeAttr("data-marker");auDOM.on("click",function(){var ch=bDiv.find("#term_pol");"msi-uncheck"==ch[0].className?_zm.succErrMsg("e",zcal.i18n.autherrmsg):(window.newWindow=window.open("","","menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=no,width=700,height=500,left=110px,top=10px"),ZCL_XHR("/cal/getGCal.do?mode=auth",function(res){gCalObj=ZCL_Evl(1,res.responseText),_processGCalStatus()}))})},_listGCal=function(){var appM=main.find("#bt_div"),lStr="";if(appM.empty(),gCalObj&&gCalObj.length>0)for(var i=0;i<gCalObj.length;i++){var liDOM=$('<div class="editFilterParent" id="zcl_gcallst"></div>');gCalObj[i].gcalName=gCalObj[i].gcalName.replace("<","&lt;").replace(">","&gt;"),lStr+='<div class="zmL" i><ul><li>',lStr+='<span id="zcl_synccal">'+gCalObj[i].gcalName+"</span>",lStr+=-1==zcal.cdata.calOUids.indexOf("gCal_"+decodeURIComponent(gCalObj[i].gcalId))?'<li><div class="SC_PUbtm"><span data-val="Cancel" data-marker="sub">'+zcal.i18n.synchronize+"</span></div></li>":'<li><div class="SC_PUbtm"><span class="sel" data-marker="unsub">'+zcal.i18n.unsynchronize+"</span></div></li>",lStr+="</li></ul></div>",1===gCalSyncStatus&&(liDOM.addClass("zcl_disls"),lStr+='<s id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</s>"),liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&bindSyncButtonAction(subDOM,{gcalId:gCalObj[i].gcalId,gcalName:gCalObj[i].gcalName,authMail:gCalObj[i].authMail});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&bindUnSyncButtonAction(unsubDOM,{gcalId:gCalObj[i].gcalId,gcalName:gCalObj[i].gcalName,authMail:gCalObj[i].authMail})}else zcl_authCon(appM);appM.append(liDOM)},bindSyncButtonAction=function(subDOM,cobj){subDOM.off("click").on("click",{calid:cobj.gcalId,calname:cobj.gcalName,email:cobj.authMail},function(ev){setSyncStatus(),ZCL_XHR("/cal/getGCal.do?mode=sub&calId="+ev.data.calid+"&calName="+ev.data.calname+"&ownerMailID="+ev.data.email,_processGCalSubscribeSts)})},setSyncStatus=function(){var _calDOM=$("#zcl_gcallst");_setGCalSyncStatus(1);var statusEle,syncalEle=_calDOM.find(".zmL");0==_calDOM.find("#zcl_syncstatus").length&&syncalEle.append($('<li id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</li>")),statusEle=_calDOM.find("#zcl_syncstatus"),statusEle.parent().addClass("zcl_disls"),syncalEle.find("span.button").off("click")},_setGCalSyncStatus=function(sts){gCalSyncStatus=sts},_processGCalSubscribeSts=function(res){if(ZCL_clrStck(),200==res.status){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var obj=_robj.obj;zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,zcal.cdata.calALst=obj.aclst,ZCL_updateAppCalList(obj.aclst),$.publish("/calendar/subscribed")}}},bindUnSyncButtonAction=function(unsubDOM,cobj){unsubDOM.off("click").on("click",{calid:cobj.gcalId,calname:cobj.gcalName},function(ev){ZCL_XHR("/cal/getGCal.do?mode=unsub&calId="+ev.data.calid+"&calName="+ev.data.calname,function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(gCalSyncStatus=0,gCalObj=null,$.publish("/calendar/deleted",{calid:_robj.id,caluid:_robj.uid,mode:"delete"}),_listGCal())})})},_processGCalStatus=function(){if(gCalObj)_listGCal();else{var zcalOrigin=document.location.protocol+"//"+zcal.ZCAL,handleMessage=function(event){var origin=event.origin||event.originalEvent.origin;origin===zcalOrigin&&(_requestGCalList(),event.source.close(),window.addEventListener?window.removeEventListener("message",handleMessage,!1):window.detachEvent("onmessage",handleMessage))};window.addEventListener?window.addEventListener("message",handleMessage,!1):window.attachEvent("onmessage",handleMessage);var winName=((document.body.offsetHeight-500)/2,(document.body.offsetWidth-700)/2,"GoogleAuthenticationWindow_"+location.hostname.split(".")[0]);newWindow.location.href=zcal.GCALSYNC,newWindow.name=winName,window.newWindow.onfocus()}},_requestGCalList=function(){gCalWinTimeOut&&clearTimeout(gCalWinTimeOut),ZCL_XHR("/cal/getGCal.do?mode=list",function(res){gCalObj=ZCL_Evl(1,res.responseText),_processGCalStatus()})},_openCalDAVCard=function(){ZCL_XHR("/cal/caldavCalLst.do?mode=callist",function(res){var _robj=ZCL_Evl(1,res.responseText),AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return listCalendar(_robj)}}).done(function(args){args.card.show()})})},listCalendar=function(calList){var main=$('<div class="SC_Twpr zcl_Twpr zcl_Twpr_list"></div>'),calDavURL=-1!=zcal.ZCAL.indexOf("skydesk.jp")?zcal.i18n.caldav_help:zcal.i18n.caldav+'&nbsp;<a class="SC_lnk" href="https://'+zcal.ZOHOSTATIC+'/help/caldav-sync-zoho-calendar.html#CalDAV" target="_blank">(?)</a>',topDiv=$('<div class="SC_PUtt"><div><div class="impExpHeading">'+calDavURL+"</div></div></div>"),bottomDiv=$('<div id="zmsdialogcont_zcl_caldav_pp" class="SC_PUcen"></div>'),calDOM=$('<div id="zcl_caldav_pp"><div><div class="SC_filt_bottom zcl_cdavovr" style="display: block;"><div class="SC_cal_groups"><ul></ul></div></div></div></div>');for(var i in calList){var obj=calList[i],calName=ZCL_getHTML(obj.NAME),isVisible=1==obj.SHOWHIDE?!0:!1,calId=obj.CALID,isDefault=1==obj.ISDEF?!0:!1,isSynced=1==obj.SYNC?!0:!1,cbxDOM=$('<li id="'+(isDefault?"ownCal":"othCal")+'" class="'+(isVisible?"":"disable")+'">'+(isDefault?"":'<i class="'+(isSynced?"msi-check":"msi-uncheck")+'"></i>')+"<span>"+calName+"</span></li>");isDefault||cbxDOM.off("click").on("click",{calid:calId},function(ev){var $sts,sts,calid=ev.data.calid,$ele=$(this);$sts=$ele.find("i"),"msi-uncheck"==$sts[0].className?$sts.removeClass("msi-uncheck").addClass("msi-check"):$sts.removeClass("msi-check").addClass("msi-uncheck"),sts="msi-check"==$sts[0].className?"enable":"disable",ZCL_XHR("/cal/enablecaldav.do?mode="+sts+"&calid="+calid,function(res){ZCL_Evl(1,res.responseText)})}),calDOM.find("ul").append(cbxDOM)}return bottomDiv.append(calDOM),main.append(topDiv),main.append(bottomDiv),main},openZcalsynclink=function(){var url="https://"+zcal.ZOHOSTATIC+"/help/zoho-calsync-android.html";window.open(url,"_blank")};exports.initialize=_initialize,exports.uninitialize=_uninitialize,exports.getSyncView=_getSyncView,exports.openOutlookCard=_openOutlookCard,exports.openCalDAVCard=_openCalDAVCard,exports.openGCalCard=_openGCalCard,exports.setGCalSyncStatus=_setGCalSyncStatus,exports.listGCal=_listGCal},"MailSuite.Apps.CalendarSync"),_defineSettingsModule("Sync",function(exports,require){"use strict";var App,Components=require("Platform.Components"),SettingAppManager=Components.SettingAppManager,SystemUtils=require("Platform.System.Utils"),APP_ID="calendar-sync",PAGE_ID="calendar-sync",SyncView="MailSuite.Apps.CalendarSync.SyncView",_syncview=function(){return require(SyncView)},loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},_initializeApp=function(){{var progress=SystemUtils.makeDeferred();$.Deferred()}return"undefined"==typeof zcal?loadCalendarData().done(function(){_syncview().initialize({process:progress})}).fail(progress.reject):_syncview().initialize({process:progress}),progress.promise()},_uninitializeApp=function(){var progress=SystemUtils.makeDeferred();return _syncview.uninitialize({process:progress}),progress.promise()},_getAppView=function(){var Syncview=_syncview();return Syncview.getSyncView()},_handleContainerEvent=function(){return null},_createApp=function(){App=SettingAppManager.create(APP_ID,{attributes:{page:PAGE_ID,isReactApp:!1},initialize:_initializeApp,uninitialize:_uninitializeApp,getView:_getAppView,handleContainerEvent:_handleContainerEvent})},initialize=function(){_createApp(),exports.App=App};initialize()},"MailSuite.Apps"),function(require){"use strict";var CARD_ID="calendar-sync",PAGE_ID="calendar-sync",CARD_ITEMS={MICROSOFT_OUTLOOK:"microsoft-outlook",GOOGLE_CALENDAR:"google-calendar",CAL_DAV:"cal-dav",ZOHO_CALSYNC:"zoho-calsync"},I18N={microsoftoutlook:{cardItem:{title:"Microsoft Outlook"}},googlecalendar:{cardItem:{title:"Google Calendar"}},caldav:{cardItem:{title:"CalDAV"}},zohocalsync:{cardItem:{title:"Zoho CalSync - Android"}}},PlatformComponents=require("Platform.Components"),PlatformEntities=require("Platform.Entities"),SettingCardItemManager=(require("MailSuite.Settings.Calendar"),require("Platform.System.Utils"),PlatformComponents.SettingCardItemManager),SettingCardItem=PlatformEntities.SettingCardItem,CardItemTypes=SettingCardItem.Types,_openURLInNewWindow=function(url){window.open(url,"_blank")},Actions={openGroupSettingsPage:function(){_openURLInNewWindow("https://"+zcal.ZOHOSTATIC+"/help/zoho-calsync-android.html")}};if(!zmail.isFuji&&!zmail.isBaihui&&-1==document.domain.indexOf("zoho.in")){SettingCardItemManager.create(CARD_ITEMS.MICROSOFT_OUTLOOK,{props:{title:I18N.microsoftoutlook.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID),zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var syncCal=zmail.Settings.MailSuite.Apps.CalendarSync.SyncView;AppFramework.requestPreviewCard({getView:function(){return syncCal.openOutlookCard()}}).done(function(args){args.card.show()})}).fail(function(){})})}})}if(!zmail.isBaihui){SettingCardItemManager.create(CARD_ITEMS.GOOGLE_CALENDAR,{props:{title:I18N.googlecalendar.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID),zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var syncCal=zmail.Settings.MailSuite.Apps.CalendarSync.SyncView;syncCal.openSyncCard("gcal")}).fail(function(){})})}})}SettingCardItemManager.create(CARD_ITEMS.CAL_DAV,{props:{title:I18N.caldav.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID),zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var syncCal=zmail.Settings.MailSuite.Apps.CalendarSync.SyncView;AppFramework.requestPreviewCard({getView:function(){return syncCal.openCalDAVCard()}}).done(function(args){args.card.show()})}).fail(function(){})})}});if(!zmail.isFuji&&!zmail.isBaihui){SettingCardItemManager.create(CARD_ITEMS.ZOHO_CALSYNC,{props:{title:I18N.zohocalsync.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){Actions.openGroupSettingsPage()}})}}(zmail.Settings.Modules.import),_defineSettingsModule("Pages",function(exports,require){"use strict";var PAGE_ID="calendar-zohoapp",PlatformComponents=require("Platform.Components"),SystemEntities=require("Platform.Entities"),I18N={title:"Zoho Apps"},SettingPageManager=PlatformComponents.SettingPageManager,SettingPage=SystemEntities.SettingPage,PageTypes=SettingPage.Types,Page=SettingPageManager.create(PAGE_ID,{props:{title:I18N.title},attributes:{card:PAGE_ID,category:"calendar",type:PageTypes.Title,pageCSSClass:"calendar-zohoapp-page",appContainer:!0}});exports.CalendarZohoApp=Page},"MailSuite"),_defineSettingsModule("Cards",function(exports,require){"use strict";var CARD_ID="calendar-zohoapp",CATEGORY_ID="calendar",PAGE_ID="calendar-zohoapp",I18N={cardTitle:"Zoho Apps"},PlatformComponents=require("Platform.Components"),SettingCardManager=PlatformComponents.SettingCardManager;if(!zmail.isRebranded)var Card=SettingCardManager.create(CARD_ID,{props:{openable:!0,title:I18N.cardTitle,addToSearch:!1},state:{hidden:!1},attributes:{category:CATEGORY_ID},openAction:SettingCardManager.CardActions.OpenPageAction(PAGE_ID)});exports.CalendarZohoApp=Card},"MailSuite"),_defineSettingsModule("ZohoappView",function(exports){"use strict";var crmSyncObj,taskSyncObj,zprojPortals,recruitSyncObj,portalObj,contObj,appMain,deferred,_initialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},_uninitialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},appStatus={},_getAppsList=function(){return{zcrm:{text:ZCL_replaceComName(zcal.i18n.zohocrmcal),msg:zcal.i18n.sync,type:"crm"},zrecruit:{text:ZCL_replaceComName(zcal.i18n.zohorecruitcal),msg:zcal.i18n.sync,type:"recruit"},ztask:{text:ZCL_replaceComName(zcal.i18n.zohotask),msg:zcal.i18n.sync,type:"task-sync"},zprojects:{text:ZCL_replaceComName(zcal.i18n.zohoprojects),msg:zcal.i18n.subscribe,type:"project"},zcontacts:{text:ZCL_replaceComName(zcal.i18n.zohocontactscal),msg:zcal.i18n.subscribe,type:"contacts"}}},_getZohoappView=function(){var zohoappList=(zcal.cdata.opt,_getAppsList()),mailLI=$('<li class="SC_setbox zcl_setbox"></li>'),d1=$('<div class="SC_Twpr zcl_Twpr zcl_Twpr_list"></div>'),d2=$('<div class="SC_filt_bottom SC_filt_bottomCustom"></div>');for(var i in zohoappList){var zohoapp=zohoappList[i];if("crm"==zohoapp.type&&""!=zcal.ZCRM||"recruit"==zohoapp.type&&""!=zcal.ZRECRUIT||"task-sync"==zohoapp.type&&""!=zcal.ZTSK||"project"==zohoapp.type||"contacts"==zohoapp.type){var listDOM=$("<div class='zmL'></div>");listDOM.html("<ul><li><span>"+zohoapp.text+"</span><em>"+zohoapp.msg+"</em></li></ul>"),listDOM.on("click",{type:zohoapp.type,txt:zohoapp.text},function(ev){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return _openAppCalCard(ev.data.type,ev.data.txt)}}).done(function(args){args.card.show()})}),d2.append(listDOM)}}return d1.append(d2),mailLI.append(d1),mailLI},_openAppCalCard=function(type,txt){appMain=$('<div class="SC_Twpr zcl_Twpr zcl_Twpr_list"></div>');var topDiv=$('<div class="SC_ptit"><div><div class="impExpHeading">'+txt+"</div></div></div>"),bottomDiv=$('<div class="SC_filt_bottom SC_filt_bottomCustom" id="btDiv"></div>');appMain.append(topDiv),appMain.append(bottomDiv);var req=!0;if("recruit"==type?recruitSyncObj&&(req=!1):"crm"==type?crmSyncObj&&(req=!1):"task-sync"==type?taskSyncObj&&(req=!1):"project"==type?portalObj&&(req=!1):"contacts"==type&&contObj&&(req=!1),req)deferred||(deferred=$.Deferred(),ZCL_uXHR("/cal/getPortal.do?mode="+type,function(res){deferred.resolve(res),_processAppRes(type,res)})),deferred.done(function(){deferred=""});else{var obj=recruitSyncObj||crmSyncObj||taskSyncObj||portalObj||contObj;_processAppRes(type,obj)}return appMain},_processAppRes=function(type,res){if("crm"==type)if(crmSyncObj=crmSyncObj?crmSyncObj:ZCL_Evl(1,res.getElementsByTagName("obj")[0].firstChild.nodeValue),"in-process"==crmSyncObj.status||"success"==crmSyncObj.status)listCrmCal();else{appStatus.crm="error";var _alrtMsg="503"==crmSyncObj.status?zcal.i18n.subscribeunavailable:ZCL_replaceComName("sync-noperm"==crmSyncObj.status?zcal.i18n.crmcal_noperm:zcal.i18n.noacc_inzohocrm);showErrorMsg(_alrtMsg)}else if("task-sync"==type)if(taskSyncObj=taskSyncObj?taskSyncObj:ZCL_Evl(1,res.getElementsByTagName("obj")[0].firstChild.nodeValue),"in-process"==taskSyncObj.status||"success"==taskSyncObj.status)listTaskCal();else{appStatus.task="error";var _alrtMsg="503"==taskSyncObj?zcal.i18n.subscribeunavailable:ZCL_replaceComName(zcal.i18n.noacc_inzohotask);showErrorMsg(_alrtMsg)}else if("project"==type)if(portalObj=portalObj?portalObj:res.getElementsByTagName("obj")[0].firstChild.nodeValue,"503"!=portalObj&&"Empty result set"!=portalObj&&"error"!=portalObj&&"Noportals"!=portalObj)zprojPortals=ZCL_Evl(1,portalObj),listProjectsCal();else{appStatus.project="error";var _alrtMsg="503"==portalObj?zcal.i18n.subscribeunavailable:ZCL_replaceComName(zcal.i18n.noacc_inzohopro);showErrorMsg(_alrtMsg)}else if("contacts"==type)if(contObj=contObj?contObj:res.getElementsByTagName("status")[0].firstChild.nodeValue,"ok"==contObj)listContactsCal();else{appStatus.contacts="error";var _alrtMsg="503"==contObj?zcal.i18n.subscribeunavailable:ZCL_replaceComName(zcal.i18n.noacc_inzohocont);showErrorMsg(_alrtMsg)}else if("recruit"==type){recruitSyncObj=recruitSyncObj?recruitSyncObj:ZCL_Evl(1,res.getElementsByTagName("obj")[0].firstChild.nodeValue);var version=recruitSyncObj.obj.VERSION;if("new"==version)if("in-process"==recruitSyncObj.status||"success"==recruitSyncObj.status)listRecruitCal();else{appStatus.recruit="error";var _alrtMsg="503"==recruitSyncObj.obj?zcal.i18n.subscribeunavailable:ZCL_replaceComName("sync-noperm"==recruitSyncObj.obj?zcal.i18n.recruitcal_noperm:zcal.i18n.noacc_inzohorecruit);showErrorMsg(_alrtMsg)}else if("503"!=recruitSyncObj.obj&&"error"!=recruitSyncObj.obj)listRecruitCal();else{appStatus.recruit="error";var _alrtMsg="503"==recruitSyncObj.obj?zcal.i18n.subscribeunavailable:ZCL_replaceComName(zcal.i18n.noacc_inzohorecruit);showErrorMsg(_alrtMsg)}}},setSyncStatus=function(main){var statusEle,syncalEle=main.find("#zcl_synccal");0==main.find("#zcl_syncstatus").length&&syncalEle.after($('<em id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</em>")),statusEle=main.find("#zcl_syncstatus"),statusEle.parent().addClass("zcl_disls"),syncalEle.find("span.button").off("click")},listCrmCal=function(){var main=appMain.find("#btDiv"),lStr="";main.empty();var liDOM=$('<div class="editFilterParent"></div>');lStr+='<div class="zmL"><ul><li><span id="zcl_synccal">'+ZCL_replaceComName(zcal.i18n.crmcal)+"<span></li>",lStr+=-1==zcal.cdata.calOUids.indexOf("zohoCrm_")?'<li><div class="SC_PUbtm"><span rel="enable" data-val="Cancel" data-marker="sub">'+zcal.i18n.synchronize+"</span></div></li>":'<li><div class="SC_PUbtm"><span rel="enable" data-val="sel" data-marker="unsub">'+zcal.i18n.unsynchronize+"</span></div></li>",lStr+="</ul></div>","in-process"==crmSyncObj.status&&(liDOM.addClass("zcl_disls"),lStr+='<s id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</s>"),liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.off("click").on("click",{soid:crmSyncObj.obj.ZSOID},function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),setSyncStatus(main),ZCL_XHR("/cal/subCal.do?mode=crm-sync&crmid="+ev.data.soid,_processCRMSubscribeSts))});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");if(unsubDOM.length){var s=zcal.cdata.calOUids.substring(zcal.cdata.calOUids.indexOf("zohoCrm_"));s=-1!=s.indexOf(",")?s.substring(0,s.indexOf(",")):s,unsubDOM.on("click",{uid:s,mode:"crm"},function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),unsubscribeCal(ev.data.uid,ev.data.mode))})}main.append(liDOM)},listRecruitCal=function(){var main=appMain.find("#btDiv"),recruitVersion=recruitSyncObj.obj.VERSION;main.empty();var liDOM=$('<div class="editFilterParent"></div>'),lStr="";lStr+='<div class="zmL"><ul><li><span id="zcl_synccal">'+ZCL_replaceComName(zcal.i18n.recruitcal)+"<span></li>",lStr+="new"==recruitVersion?-1==zcal.cdata.calOUids.indexOf("zohoRecruit4_")?'<li><div class="SC_PUbtm"><span rel="enable" data-val="Cancel" data-marker="sub">'+zcal.i18n.synchronize+"</span></div></li>":'<li><div class="SC_PUbtm"><span rel="enable" data-val="sel" data-marker="unsub">'+zcal.i18n.unsynchronize+"</span></div></li>":-1==zcal.cdata.calOUids.indexOf("zohoRecruit_")?'<li><div class="SC_PUbtm"><span rel="enable" data-val="Cancel" data-marker="sub">'+zcal.i18n.subscribe+"</span></div></li>":'<li><div class="SC_PUbtm"><span rel="enable" data-val="sel" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span></div></li>",lStr+="</ul></div>",liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.off("click").on("click",{soid:recruitSyncObj.obj.ZSOID},function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),ZCL_XHR("/cal/subCal.do?mode=recruitcal-sub&recid="+ev.data.soid,_processSubscribeSts))});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");if(unsubDOM.length){var s=zcal.cdata.calOUids.substring(zcal.cdata.calOUids.indexOf("zohoRecruit"));s=-1!=s.indexOf(",")?s.substring(0,s.indexOf(",")):s,unsubDOM.on("click",{uid:s,mode:"recruit"},function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),unsubscribeCal(ev.data.uid,ev.data.mode))})}main.append(liDOM)},listTaskCal=function(){var main=appMain.find("#btDiv"),lStr="";main.empty();var liDOM=$('<div class="editFilterParent"></div>');lStr+='<div class="zmL"><ul><li><span>'+ZCL_replaceComName(zcal.i18n.zohotask)+"<span></li>",lStr+=-1==zcal.cdata.calOUids.indexOf("zohoTask_")?'<li><div class="SC_PUbtm"><span rel="enable" data-val="Cancel" data-marker="sub">'+zcal.i18n.synchronize+"</span></div></li>":'<li><div class="SC_PUbtm"><span rel="enable" data-val="sel" data-marker="unsub">'+(taskSyncObj.isOldTaskSubscribed?zcal.i18n.unsubscribe:zcal.i18n.unsynchronize)+"</span></div></li>",lStr+="</ul></div>","in-process"==taskSyncObj.status&&(liDOM.addClass("zcl_disls"),lStr+='<s id="zcl_syncstatus">'+zcal.i18n.syncmsg+"</s>"),liDOM.html(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),ZCL_XHR("/cal/subCal.do?mode=task-sync",_processSubscribeSts))});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");if(unsubDOM.length){var s=zcal.cdata.calOUids.substring(zcal.cdata.calOUids.indexOf("zohoTask_"));s=-1!=s.indexOf(",")?s.substring(0,s.indexOf(",")):s,unsubDOM.on("click",{uid:s,mode:"task"},function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),unsubscribeCal(ev.data.uid,ev.data.mode))})}main.append(liDOM)},listContactsCal=function(){var main=appMain.find("#btDiv"),lStr="";main.empty();var liDOM=$('<div class="editFilterParent"></div>');lStr+='<div class="zmL"><ul><li><span>'+zcal.i18n.contactscal+"<span></li>",lStr+=-1==zcal.cdata.calOUids.indexOf("zohoContacts_")?'<li><div class="SC_PUbtm"><span rel="enable" data-val="Cancel" data-marker="sub">'+zcal.i18n.subscribe+"</span></div></li>":'<li><div class="SC_PUbtm"><span rel="enable" data-val="sel" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span></div></li>",lStr+="</ul></div>",liDOM.append(lStr);var subDOM=liDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),ZCL_XHR("/cal/subCal.do?mode=contactcal-sub",_processSubscribeSts))});var unsubDOM=liDOM.find("[data-marker=unsub]").removeAttr("data-marker");if(unsubDOM.length){var s=zcal.cdata.calOUids.substring(zcal.cdata.calOUids.indexOf("zohoContacts_"));s=-1!=s.indexOf(",")?s.substring(0,s.indexOf(",")):s,unsubDOM.on("click",{uid:s,mode:"contacts"},function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),unsubscribeCal(ev.data.uid,ev.data.mode))})}main.append(liDOM)},listProjectsCal=function(){var main=appMain.find("#btDiv"),portals=zprojPortals;main.empty();var liDOM=$('<div class="editFilterParent"></div>');for(var i in portals){var lStr,divDOM=$('<div class="zmL"/>');lStr="<ul><li><span>"+ZCL_getHTML(portals[i].portal)+"<span></li>",lStr+=-1==zcal.cdata.calOUids.indexOf("zohoProject_"+portals[i].portal_zoid)?'<li><div class="SC_PUbtm"><span rel="enable" data-val="Cancel" data-marker="sub" >'+zcal.i18n.subscribe+"</span></div></li>":'<li><div class="SC_PUbtm"><span rel="enable" data-val="sel" data-marker="unsub">'+zcal.i18n.unsubscribe+"</span></div></li>",lStr+="</ul>",divDOM.html(lStr);var subDOM=divDOM.find("[data-marker=sub]").removeAttr("data-marker");subDOM.length&&subDOM.on("click",{portal:portals[i].portal,portalid:portals[i].portal_zoid},function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),ZCL_XHR("/cal/subCal.do?mode=project-sub&portal="+ev.data.portal+"&portalId="+encodeURIComponent(ev.data.portalid),_processSubscribeSts))});var unsubDOM=divDOM.find("[data-marker=unsub]").removeAttr("data-marker");unsubDOM.length&&unsubDOM.on("click",{uid:"zohoProject_"+portals[i].portal_zoid,mode:"project"},function(ev){"enable"==ev.target.getAttribute("rel")&&(ev.target.setAttribute("rel","disabled"),unsubscribeCal(ev.data.uid,ev.data.mode))}),liDOM.append(divDOM)}main.append(liDOM)},showErrorMsg=function(msg){appMain.find("#btDiv").append("<div class='editFilterParent'><div class='zmL'><ul><li><span>"+msg+"</span></li></ul></div></div></div></div>")},_processCRMSubscribeSts=function(res){if(ZCL_clrStck(),200==res.status){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){if("sync-initiated"==_robj.sync_mode)"in-process"==_robj.sync_status?crmSyncObj.status=_robj.sync_status:(crmSyncObj.status="success",setTimeout(function(){_zm.succErrMsg("s",zcal.i18n.synccompmsg)},2e3));else if("success"==_robj.sync_status){crmSyncObj.status=_robj.sync_status;var obj=_robj.obj;zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,zcal.cdata.calALst=obj.aclst,ZCL_updateAppCalList(obj.aclst),setTimeout(function(){_zm.succErrMsg("s",zcal.i18n.synccompmsg)},2e3),zcalCRM.loadCRMUsers()}else"in-process"==_robj.sync_status?crmSyncObj.status=_robj.sync_status:setTimeout(function(){_zm.succErrMsg("e",ZCL_replaceComName(zcal.i18n.crmcal_syncfailed))},2e3);listCrmCal(),$.publish("/calendar/subscribed")}else setTimeout(function(){_zm.succErrMsg("e",ZCL_replaceComName(zcal.i18n.crmcal_syncfailed))},2e3)}},_processSubscribeSts=function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){{var obj=_robj.obj,mode=_robj.mode;_robj.uid}zcal.cdata.calOLst=obj.clst,zcal.cdata.calOUids=obj.Uids,zcal.cdata.calGLst=obj.gclst,zcal.cdata.calALst=obj.aclst,ZCL_updateAppCalList(obj.aclst),"contactcal-sub"===mode?(_zm.succErrMsg("s",zcal.i18n.calSubSuccess),listContactsCal()):"project-sub"===mode?(_zm.succErrMsg("s",zcal.i18n.calSubSuccess),listProjectsCal()):"task-sync"===mode?("completed"==_robj.sync_status?(taskSyncObj.status="success",_zm.succErrMsg("s",zcal.i18n.synccompmsg)):"in-process"==_robj.sync_status&&(taskSyncObj.status="in-process"),listTaskCal()):"recruitcal-sub"==mode&&(_zm.succErrMsg("s",zcal.i18n.calSubSuccess),listRecruitCal()),$.publish("/calendar/subscribed")}},unsubscribeCal=function(uid,type){ZCL_XHR("/cal/calAct.do?mode=delByUid&caluid="+encodeURIComponent(uid),function(res){_processUnsubscribeSts(res,type)})},_processUnsubscribeSts=function(res,type){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var id=_robj.id,uid=_robj.uid;$.publish("/calendar/deleted",{calid:id,caluid:uid,mode:"unsubscribe"}),"contacts"===type?listContactsCal():"project"===type?listProjectsCal():"task"===type?listTaskCal():"crm"===type?listCrmCal():"recruit"===type&&listRecruitCal()}else _zm.succErrMsg("e",_robj.status)};exports.initialize=_initialize,exports.uninitialize=_uninitialize,exports.getZohoappView=_getZohoappView,exports.openAppCalCard=_openAppCalCard},"MailSuite.Apps.CalendarZohoApp"),_defineSettingsModule("ZohoApps",function(exports,require){"use strict";var App,Components=require("Platform.Components"),SettingAppManager=Components.SettingAppManager,SystemUtils=require("Platform.System.Utils"),APP_ID="calendar-zohoapp",PAGE_ID="calendar-zohoapp",ZohoappView="MailSuite.Apps.CalendarZohoApp.ZohoappView",_zohoappview=function(){return require(ZohoappView)},loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},_initializeApp=function(){{var progress=SystemUtils.makeDeferred();$.Deferred()}return"undefined"==typeof zcal?loadCalendarData().done(function(){_zohoappview().initialize({process:progress})}).fail(progress.reject):_zohoappview().initialize({process:progress}),progress.promise()},_uninitializeApp=function(){var progress=SystemUtils.makeDeferred();return _zohoappview.uninitialize({process:progress}),progress.promise()},_getAppView=function(){var Zohoappview=_zohoappview();return Zohoappview.getZohoappView()},_handleContainerEvent=function(){return null},_createApp=function(){App=SettingAppManager.create(APP_ID,{attributes:{page:PAGE_ID,isReactApp:!1},initialize:_initializeApp,uninitialize:_uninitializeApp,getView:_getAppView,handleContainerEvent:_handleContainerEvent})},initialize=function(){_createApp(),exports.App=App};initialize()},"MailSuite.Apps"),function(require){"use strict";var CARD_ID="calendar-zohoapp",PAGE_ID="calendar-zohoapp",CARD_ITEMS={ZOHO_CRM:"zoho-crm",ZOHO_RECRUIT:"zoho-recruit",ZOHO_TASK:"zoho-task",ZOHO_PROJECTS:"zoho-projects",ZOHO_CONTACTS:"zoho-contacts"},I18N={zohocrm:{cardItem:{title:"Zoho CRM"}},zohorecruit:{cardItem:{title:"Zoho Recruit"}},zohotask:{cardItem:{title:"Zoho Task"}},zohoprojects:{cardItem:{title:"Zoho Projects"}},zohocontacts:{cardItem:{title:"Zoho Contacts"}}},PlatformComponents=require("Platform.Components"),PlatformEntities=require("Platform.Entities"),SettingCardItemManager=(require("MailSuite.Settings.Calendar"),require("Platform.System.Utils"),PlatformComponents.SettingCardItemManager),SettingCardItem=PlatformEntities.SettingCardItem,CardItemTypes=SettingCardItem.Types;if(!zmail.isRebranded){{SettingCardItemManager.create(CARD_ITEMS.ZOHO_CRM,{props:{title:I18N.zohocrm.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID),zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zaCal=zmail.Settings.MailSuite.Apps.CalendarZohoApp.ZohoappView;AppFramework.requestPreviewCard({getView:function(){return zaCal.openAppCalCard("crm","Zoho CRM Calendar")}}).done(function(args){args.card.show()})}).fail(function(){})})}})}if(!zmail.isFuji){SettingCardItemManager.create(CARD_ITEMS.ZOHO_RECRUIT,{props:{title:I18N.zohorecruit.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID),zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zaCal=zmail.Settings.MailSuite.Apps.CalendarZohoApp.ZohoappView;AppFramework.requestPreviewCard({getView:function(){return zaCal.openAppCalCard("recruit","Zoho Recruit Calendar")}}).done(function(args){args.card.show()})}).fail(function(){})})}})}{SettingCardItemManager.create(CARD_ITEMS.ZOHO_TASK,{props:{title:I18N.zohotask.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID),zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zaCal=zmail.Settings.MailSuite.Apps.CalendarZohoApp.ZohoappView;AppFramework.requestPreviewCard({getView:function(){return zaCal.openAppCalCard("task-sync","Zoho Task")}}).done(function(args){args.card.show()})}).fail(function(){})})}}),SettingCardItemManager.create(CARD_ITEMS.ZOHO_PROJECTS,{props:{title:I18N.zohoprojects.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID),zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zaCal=zmail.Settings.MailSuite.Apps.CalendarZohoApp.ZohoappView;AppFramework.requestPreviewCard({getView:function(){return zaCal.openAppCalCard("project","Zoho Projects")}}).done(function(args){args.card.show()})}).fail(function(){})})}}),SettingCardItemManager.create(CARD_ITEMS.ZOHO_CONTACTS,{props:{title:I18N.zohocontacts.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){SettingCardItemManager.CardItemActions.OpenPageAction(PAGE_ID),zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zaCal=zmail.Settings.MailSuite.Apps.CalendarZohoApp.ZohoappView;AppFramework.requestPreviewCard({getView:function(){return zaCal.openAppCalCard("contacts","Zoho Contacts (Birthday Calendar)")}}).done(function(args){args.card.show()})}).fail(function(){})})}})}}}(zmail.Settings.Modules.import),_defineSettingsModule("Pages",function(exports,require){"use strict";var PAGE_ID="calendar-mgaocalendars",PlatformComponents=require("Platform.Components"),SystemEntities=require("Platform.Entities"),I18N={title:"Calendars"},SettingPageManager=PlatformComponents.SettingPageManager,SettingPage=SystemEntities.SettingPage,PageTypes=SettingPage.Types,Page=SettingPageManager.create(PAGE_ID,{props:{title:I18N.title},attributes:{card:PAGE_ID,category:"calendar",type:PageTypes.Title,pageCSSClass:"calendar-mgaocalendars-page",appContainer:!0}});exports.CalendarMGAOCalendars=Page}),_defineSettingsModule("Cards",function(exports,require){"use strict";var CARD_ID="calendar-mgaocalendars",CATEGORY_ID="calendar",PAGE_ID="calendar-mgaocalendars",I18N={cardTitle:"Calendars"},PlatformComponents=require("Platform.Components"),SettingCardManager=PlatformComponents.SettingCardManager,Card=SettingCardManager.create(CARD_ID,{props:{openable:!0,title:I18N.cardTitle,addToSearch:!1},state:{hidden:!1},attributes:{category:CATEGORY_ID},openAction:SettingCardManager.CardActions.OpenPageAction(PAGE_ID)});exports.CalendarMGAOCalendars=Card},"MailSuite"),_defineSettingsModule("MGAOCalendarsView",function(exports){"use strict";var calOrder,calLst,_initialize=function(opts){opts=opts||{};var process=opts.process;process.resolve(),_subscribe()},_uninitialize=function(opts){opts=opts||{};var process=opts.process;process.resolve()},_delCal=function(ev,data){var calid=data.calid,$ele=mailLI.find("[data-id="+calid+"]");$ele.length&&$ele.remove(),_updList(data.type)},mailLI=$('<div data-reactroot class="SC_setbox zcl_setbox zcl_setboxgpls"></div>'),_getMGAOCalendarsView=function(){for(var calTab=$('<div class="filterTopMenu"><ul class="SCS_tab"><li class="stSel" id="myCal">'+zcal.i18n.mycalendars+'</li><li id="grpCal">'+zcal.i18n.groupcalendars+'</li><li id="appCal">'+zcal.i18n.appcalendars+'</li><li id="othCal">'+zcal.i18n.othercalendars+"</li></ul></div>"),headDiv=$('<div><div class="zcl_Twpr_Callist"><div class="SC_filt_bottom SC_filt_bottomCustom"  id="topB"><div class="zmL SC_filt_bld"><ul class="bld"><li></li><li>Calendar Name</li><li>Actions</li> <li class="conditions">Status</li></ul></div></div><div class="SC_Twpr zcl_Twpr_Callist zcl_setsrl"> <div class="SC_filt_bottom SC_filt_bottomCustom" id="listCal"></div></div></div></div>');mailLI[0].firstChild;)mailLI[0].removeChild(mailLI[0].firstChild);return mailLI.append(calTab),mailLI.append(headDiv),calOrder=zcal.cdata.calOrdArr,calLst=zcal.cdata.calLst,calOrder.forEach(function(id){calLst[id]&&listCalendar(id,calLst[id])}),calTab.find("#grpCal").on("click",function(ev){var gCal=_groupCalendarView(ev);mailLI.append(gCal)}),calTab.find("#myCal").on("click",function(){var $ele=$(this);$ele.parent().find("li").removeClass("stSel"),$ele.addClass("stSel");_getMGAOCalendarsView()}),calTab.find("#appCal").on("click",function(){var aCal=_appCalendarView();mailLI.append(aCal)}),calTab.find("#othCal").on("click",function(){var oCal=_otherCalendarView();mailLI.append(oCal)}),mailLI},_updList=function(ty){if("groups"==ty){if(0==mailLI.find("#listCal")[0].childNodes.length){var $clkLnk;mailLI.find("#listCal").html('<div class="startup help zcl_mb">No calendars found, <a class="SC_lnk">click here</a> to subscribe.</div>'),$clkLnk=mailLI.find("#listCal").find("a"),$("#topB").empty(),$clkLnk.off("click").on("click",function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage("calendar-subscribe",{}).done(function(){}).fail(function(){})})}}else if("apps"==ty){if(0==mailLI.find("#listCal")[0].childNodes.length){var $clkLnk;mailLI.find("#listCal").html('<div class="startup help zcl_mb">'+zcal.i18n.noappcal+"</div>"),$("#topB").empty()}}else if("other"==ty&&0==mailLI.find("#listCal")[0].childNodes.length){var $clkLnk;mailLI.find("#listCal").html('<div class="startup help zcl_mb">No calendars found, <a class="SC_lnk">click here</a> to subscribe.</div>'),$("#topB").empty(),$clkLnk=mailLI.find("#listCal").find("a"),$clkLnk.off("click").on("click",function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage("calendar-subscribe",{}).done(function(){}).fail(function(){})})}},ZCL_ChgCalSts=function(calId){var cObj,isEnabled;cObj=zcal.getCalObj(calId),isEnabled=1==cObj[2]?!1:!0,ZCL_sendChgCalStsReq(calId,isEnabled,cObj)},ZCL_sendChgCalStsReq=function(calId,isEnabled,cObj){var fname="/cal/calAct.do?mode=en-dis&calid="+calId+"&isen="+isEnabled;ZCL_XHR(fname,function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[2]=isEnabled?"1":"0",$.publish("/calendar/statusChanged",{calid:calId,sts:cObj[2]}))})},_ZCL_icsDown=function(ckey){var pwd=$("#zcl_pwd")[0].value,repwd=$("#zcl_repwd")[0].value;""==pwd&&""==repwd?($("#zcl_pwd_er")[0].style.display="",$("#zcl_repwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwdcon")[0].style.display="none"):pwd==repwd?($("#zcl_repeqwd_er")[0].style.display="none",$("#zcl_repwd")[0].className="SC_tiput",ZCL_formSubmit({ckey:ckey,password:pwd,resformat:"zip",mode:"pwdcalexp"},"/cal/export.do","GET"),zmsDialog.remove()):($("#zcl_repeqwd_er")[0].style.display="",$("#zcl_repwd")[0].className="SC_tiput zcl_cl_ad_er",$("#zcl_pwdcon")[0].style.display="none")},listCalendar=function(id,cObj){var $share,$exp,$empty,$del,$sts,act,type="my",calDOM=$('<div id="d" class="zmL '+(1==cObj[8]?"":"disableFilter")+'" data-id="'+id+'"><ul></ul></div>'),color=ZCL_getCalColor(cObj[1])[1],cname=ZCL_getHTML(cObj[0]),cbxDOM=$('<li><div style="background-color:'+color+'" class="SClbl"><i class="'+(1==cObj[2]?"msi-tick":"")+'"></i></div></li>');$sts=cbxDOM.find(".SClbl"),$sts.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_ChgCalSts(calid)}),calDOM.find("ul").append(cbxDOM);var nmDOM=$('<li><strong class="filterControl">'+cname+"</strong></li>");bindClickEvent(nmDOM,id,cObj,type),calDOM.find("ul").append(nmDOM);var actDOM=$('<li class="filterControl"><b></b></li>');act=actDOM.find("b"),("0"!=zcal.shrCal||"0"!=zcal.pvtUrl)&&($share=$('<span data-id="sh">'+zcal.i18n.share+"</span>"),$share.off("click").on("click",{calid:id,cobj:cObj},function(ev){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return _openShare(ev.data.calid,ev.data.cobj,type)}}).done(function(args){args.card.show()})}),act.append($share)),"0"!=zcal.impExp&&1==cObj[13][2]&&($exp=$('<span data-id="exp">'+zcal.i18n.exports+"</span>"),$exp.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var temp=!1;temp=zmAdHocSettings&&zmAdHocSettings.getSecuredownload&&"1"===zmAdHocSettings.getSecuredownload()?!0:!1,temp?ZCL_secureDow("export",ev.data.ckey):ZCL_formSubmit({ckey:ev.data.ckey,mode:"calexp"},"/cal/export.do","GET")}),act.append($exp)),1==cObj[13][3]&&($empty=$('<span data-id="emp">'+zcal.i18n.empty+"</span>"),$empty.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_empCal(calid)}),act.append($empty)),1==cObj[13][4]&&($del=$('<span data-id="del">'+zcal.i18n.del+"</span>"),$del.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_delCal(calid,!1,type)}),act.append($del)),calDOM.find("ul").append(actDOM);var stsDOM=$('<li><div class="onoffButton" style="background-color: transparent !important;"></div></li>');if("false"==cObj[3]){var bar=$("<div data-on="+zcal.i18n.on+" data-off="+zcal.i18n.off+">");bar.addClass(0==cObj[8]?"sdiv sadiv":"sdiv"),bar.off("click").on("click",{calid:id},function(ev){var $ele=$(this),$parEle=$ele.parents(".zmL"),calid=ev.data.calid;ZCL_XHR("/cal/calAct.do?mode=sh-hde&calid="+calid+"&isshow="+($ele.hasClass("sadiv")?!0:!1),function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[8]=_robj.isshow?1:0,$ele.removeAttr("class").addClass(_robj.isshow?"sdiv inctop":"sdiv sadiv"),$parEle.removeAttr("class").addClass(_robj.isshow?"zmL":"zmL disableFilter"),$.publish("/calendar/visibilityChanged",{calid:calid,visibility:_robj.isshow}),_robj.isshow?zmUtil.succErrMsg("s",zcal.i18n.on_msg):zmUtil.succErrMsg("s",zcal.i18n.off_msg))})}),stsDOM.find(".onoffButton").append(bar)}calDOM.find("ul").append(stsDOM),mailLI.find("#listCal").append(calDOM)},bindClickEvent=function(nmDOM,id,cObj,type){nmDOM.on("click",{calid:id,cobj:cObj,ty:type},function(ev){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return _openDetail(ev.data.calid,ev.data.cobj,ev.data.ty)}}).done(function(args){args.card.show()})})},mainGrp=$("<div class='SC_Twpr zcl_Twpr zcl_Twpr_list'  id='zcl_callist'></div>"),_openGrpMem=function(id,cObj,ty){var sh,setTab=$("<div class='SC_setTab'><div class='SC_setTabList'><span  id='det'>"+zcal.i18n.edit+"</span><span id='em'>"+zcal.i18n.embed+"</span><span class='sel' id='grpmem'>Members</span></div></div>");"apps"==ty||"groups"==ty?(0!=cObj[13][0]||0!=cObj[13][7])&&(sh="<span id='sh'>"+zcal.i18n.share+"</span>",$(sh).insertBefore(setTab.find(".SC_setTabList")[0].childNodes[1])):"my"==ty?("0"!=zcal.shrCal||"0"!=zcal.pvtUrl)&&(sh="<span id='sh'>"+zcal.i18n.share+"</span>",$(sh).insertBefore(setTab.find(".SC_setTabList")[0].childNodes[1])):"other"==ty&&0!=cObj[13][0]&&"0"!=zcal.shrCal&&(sh="<span id='sh'>"+zcal.i18n.share+"</span>",$(sh).insertBefore(setTab.find(".SC_setTabList")[0].childNodes[1]));var cDetail,gMem,cShare,cEmbed,calId=($(this),id),cobj=cObj;return setTab.find("#grpmem").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainGrp[0].removeChild(mainGrp[0].childNodes[1]),zcalGrpMemView(calId,mainGrp)}),setTab.find("#det").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainGrp[0].removeChild(mainGrp[0].childNodes[1]);var gid;for(var i in zcal.cdata.calByGrp)for(var j in zcal.cdata.calByGrp[i])j==id&&(gid=i);cDetail=zcalDetailsView.render(calId,cobj,gid,ty),mainGrp.append(cDetail)}),setTab.find("#sh").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainGrp[0].removeChild(mainGrp[0].childNodes[1]),cShare=zcalShareView.render(calId,cobj),mainGrp.append(cShare)}),setTab.find("#em").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainGrp[0].removeChild(mainGrp[0].childNodes[1]),cEmbed=zcalEmbedView.render(calId,cobj),mainGrp.append(cEmbed)}),mainGrp.empty(),mainGrp.append(setTab),gMem=zcalGrpMemView(calId),mainGrp},zcalGrpMemView=function(calId,dom){var $grpmemPaneWrapper=$('<div id="calgrp" class="SC_Twpr zcl_Twpr" style="top:46px"><div class="SC_filt_bottom SC_filt_bottomCustom" id="zcl_gpmem"></div></div>');dom?dom.append($grpmemPaneWrapper):mainGrp.append($grpmemPaneWrapper);var grp_id,gmobj,gcalStr,loadingBand=zmComponent.loadingBand({container:mainGrp.find("#zcl_gpmem")[0]||dom.find("#zcl_gpmem")[0],type:"pagination"});for(var i in zcal.cdata.calByGrp)for(var j in zcal.cdata.calByGrp[i])j==calId&&(grp_id=i);var owner_arr=[],mode_arr=[],mem_arr=[],owner=!1;ZCL_uXHR("/cal/groups/"+grp_id+"/getMembers",function(res){var res_obj=ZCL_Evl(1,res.responseText);if("success"==res_obj.status){var mem=res_obj.members;for(var i in mem)(mem[i].isOwner||mem[i].isModerator)&&zmail.zuid==mem[i].zid&&(owner=!0);for(var j in mem)mem[j].isOwner?owner_arr.push(mem[j]):mem[j].isModerator?mode_arr.push(mem[j]):mem_arr.push(mem[j])}gmobj={grpId:grp_id,members:mem_arr,owner:owner_arr,moderator:mode_arr,is_owner:owner};var memcount=gmobj.members.length+gmobj.owner.length+gmobj.moderator.length;gcalStr+='<div class="editFilterParent zcl_stfrm"  style="height:'+($("#calgrp")[0].offsetHeight-20)+'px; overflow: auto;">',gcalStr+="<div>",gcalStr+='<input type="hidden" id="zcl_calid" value="'+(calId?calId:"")+'">',gcalStr+='<input type="hidden" id="zcl_calgid" value="'+(gmobj.grpId?gmobj.grpId:"")+'">',gmobj.is_owner&&(gcalStr+='<div class="zcl_addcaltx"><b>Members</b><span id="zcl_ad_att_er" style="color:#ff4e67;display:none;margin-left:10px">Add only org members</span></div>',gcalStr+='<div class="SC_sch" style="margin-bottom: 20px;position: relative;width:500px;" id="zcl_addsrhdiv"><i class="msi-search"></i>',gcalStr+='<input type="text" placeholder="Add for members by name or email" id="zcl_addsrhmem" style="width: 225px;">',gcalStr+="</div>"),gcalStr+='<div id="zcl_addmem_di" class="SC_PUcen"></div>',gcalStr+='<h4 id="isMem" style="">'+(1==memcount?"1 Person":memcount+" Members")+"</h4>",gcalStr+='<div id="zcl_memdiv" class="SC_PUcen" style="min-height: 50px;width: 500px;">',gcalStr+='<ul class="SC_P2r P2rBlkGery viewMem SC_PhrTxt" id="zcl_memView" style="">';for(var i in gmobj.owner)gcalStr+='<li data-id="'+gmobj.owner[i].zid+'" class="zm_mem_post loadPost" id='+gmobj.owner[i].email+">",gcalStr+='<div class="SC_avtr">',gcalStr+='<img src="'+gmobj.owner[i].photo+'">',gcalStr+="</div>",gcalStr+='<div><strong style="word-wrap:break-word;display: inline-block;max-width: 140px;white-space: normal;">'+ZCL_getHTML(gmobj.owner[i].fname)+'</strong><i class="SC_Otxt">'+(gmobj.owner[i].isOwner?"Owner":gmobj.owner[i].isModerator?"Moderator":"")+"</i><span>"+gmobj.owner[i].email+"</span>",gcalStr+="</div>",gcalStr+="</li>";for(var i in gmobj.moderator)gcalStr+='<li data-id="'+gmobj.moderator[i].zid+'" class="zm_mem_post loadPost" id='+gmobj.moderator[i].email+">",gcalStr+='<div class="SC_avtr">',gcalStr+='<img src="'+gmobj.moderator[i].photo+'">',gcalStr+="</div>",gcalStr+='<div><strong  style="word-wrap:break-word;display: inline-block;max-width: 140px;white-space: normal;">'+ZCL_getHTML(gmobj.moderator[i].fname)+'</strong><i class="SC_Otxt">'+(gmobj.moderator[i].isOwner?"Owner":gmobj.moderator[i].isModerator?"Moderator":"")+"</i><span>"+gmobj.moderator[i].email+"</span>",gcalStr+="</div>",gmobj.is_owner&&gmobj.moderator[i].zid!=zmail.zuid&&(gcalStr+='<div><div class="SCmb" onclick="ZCL_memper(event,\''+gmobj.moderator[i].zid+'\')"><ul class="zm_action" data-tooltip="More actions"><li class=""><b><i class="msi-action"></i><div class="SC_hd"></div></b></li></ul></div></div>'),gcalStr+="</li>";for(var i in gmobj.members)gcalStr+='<li data-id="'+gmobj.members[i].zid+'" class="zm_mem_post loadPost" id='+gmobj.members[i].email+">",gcalStr+='<div class="SC_avtr">',gcalStr+='<img src="'+gmobj.members[i].photo+'">',gcalStr+="</div>",gcalStr+="<div><strong>"+ZCL_getHTML(gmobj.members[i].fname)+'</strong><i class="SC_Otxt">'+(gmobj.members[i].isOwner?"Owner":gmobj.members[i].isModerator?"Moderator":"")+"</i><span>"+gmobj.members[i].email+"</span>",gcalStr+="</div>",gmobj.is_owner&&(gcalStr+='<div><div class="SCmb" onclick="ZCL_memper(event,\''+gmobj.members[i].zid+'\')"><ul class="zm_action" data-tooltip="More actions"><li class=""><b><i class="msi-action"></i><div class="SC_hd"></div></b></li></ul></div></div>'),gcalStr+="</li>";gcalStr+="</ul></div>";var calobj=zcal.cdata.calGLst[calId];2==calobj[13][4]&&(gcalStr+='<div class="zmMSgEdt"><div class="zm_grpAction zm_CA"><div class="zm_CATxt"><div class="zm_CATitle">Delete this Group</div><p style="margin-top: 10px;">On deleting this group, all group information will be removed, and it cannot be recovered.</p></div><div class="zm_CABtn"><span class="SC_thmBBtn SC_lnk deleteButton" id="zcl_delgrp">Delete group</span></div></div></div>'),gcalStr+="</div></li>",$grpmemPaneWrapper.find("#zcl_gpmem").append($(gcalStr)),zcl_setheight(),loadingBand(),$grpmemPaneWrapper.find("#zcl_addsrhmem")[0].focus(),zmAppLoader.load("zmContactsAutoComplete").done(function(){zmContactsAutoComplete.autoComplete({input:$grpmemPaneWrapper.find("#zcl_addsrhmem")[0],excludeMe:!0,contactType:["org","personal"],exclude:function(){var email=[];if($grpmemPaneWrapper.find("#zcl_memView")[0].childNodes)for(var i in $grpmemPaneWrapper.find("#zcl_memView")[0].childNodes){var attl=$grpmemPaneWrapper.find("#zcl_memView")[0].childNodes[i].id;attl&&email.push(attl)}return email},onSelect:function(event,data){var data=data.item.attributes;zcl_addmem(data),$grpmemPaneWrapper.find("#zcl_addsrhmem").val("")}}),$grpmemPaneWrapper.find("#zcl_delgrp").on("click",function(){var gid;for(var i in zcal.cdata.calByGrp)for(var j in zcal.cdata.calByGrp[i])j==calId&&(gid=i);_ZCL_grpdelCal(gid,calobj[0])})})}),window.onresize=function(){$(".zmMSgEdt")[0]&&zcl_setheight()}},zcl_setheight=function(){var addcal=$(".zcl_addcaltx")[0]?$(".zcl_addcaltx")[0].offsetHeight:0,addsrh=$("#zcl_addsrhdiv")[0]?$("#zcl_addsrhdiv")[0].offsetHeight:0,addmem=$("#zcl_addmem_di")[0]?$("#zcl_addmem_di")[0].offsetHeight:0,ismem=$("#isMem")[0]?$("#isMem")[0].offsetHeight:0,del=$(".zmMSgEdt")[0]?$(".zmMSgEdt")[0].offsetHeight:0;$("#zcl_memdiv")[0].style.height=$("#calgrp")[0].offsetHeight-(addcal+addsrh+addmem+ismem+del+117.2)+"px",$("#zcl_memdiv")[0].style.height=$("#zcl_memdiv")[0].style.height<"10px"?"10px":$("#zcl_memdiv")[0].style.height},zcl_addmem=function(data){var loadingBand=zmComponent.loadingBand({container:$("#zcl_addsrhdiv")[0],type:"pagination"});$("#zcl_addsrhmem")[0].setAttribute("placeholder","Adding member..");var grp_id=$("#zcl_calgid")[0].value,mem_id=data.zid;ZCL_XHR("/cal/groups/"+grp_id+"/addMember/"+mem_id,function(res){var res_obj=ZCL_Evl(1,res.responseText);if("success"==res_obj.status){var di=document.createElement("li");di.setAttribute("data-id",data.zid),di.id=data.email;var txt='<div class="SC_avtr">';txt+='<img src="'+data.internalData.attrs.photo+'">',txt+="</div>",txt+="<div>",txt+="<strong>"+data.firstName+"</strong>",txt+='<i class="SC_Otxt"></i>',txt+="<span>"+data.email+"</span>",txt+="</div>",txt+="<div>",txt+='<div class="SCmb" onclick="ZCL_memper(event, \''+mem_id+"')\">",txt+='<ul class="zm_action"><li class=""><b><i class="msi-action"></i><div class="SC_hd"></div></b></li></ul>',txt+="</div>",txt+="</div>",di.innerHTML=txt,$("#zcl_memView")[0].appendChild(di);var memC=$("#isMem"),memV=$("#zcl_memView");memC[0].innerHTML=memV[0].childNodes.length-1+1+" Members",zmUtil.succErrMsg("s",zcal.i18n.addmember_msg),loadingBand(),$("#zcl_addsrhmem")[0].setAttribute("placeholder","Add for members by name or email")}})},_openDetail=function(id,cObj,ty){var sh,mainDet=$("<div class='SC_Twpr zcl_Twpr zcl_Twpr_list'  id='zcl_callist'></div>"),setTab=$("<div class='SC_setTab'><div class='SC_setTabList'><span class='sel' id='det'>"+zcal.i18n.edit+"</span><span id='em'>"+zcal.i18n.embed+"</span></div></div>");"apps"==ty||"groups"==ty?(0!=cObj[13][0]||0!=cObj[13][7])&&(sh="<span id='sh'>"+zcal.i18n.share+"</span>",$(sh).insertBefore(setTab.find(".SC_setTabList")[0].childNodes[1])):"my"==ty?("0"!=zcal.shrCal||"0"!=zcal.pvtUrl)&&(sh="<span id='sh'>"+zcal.i18n.share+"</span>",$(sh).insertBefore(setTab.find(".SC_setTabList")[0].childNodes[1])):"other"==ty&&0!=cObj[13][0]&&"0"!=zcal.shrCal&&(sh="<span id='sh'>"+zcal.i18n.share+"</span>",$(sh).insertBefore(setTab.find(".SC_setTabList")[0].childNodes[1])),"groups"==ty&&(sh="<span id='grpmem'>Members</span>",setTab.find(".SC_setTabList").append($(sh)));var gid;for(var i in zcal.cdata.calByGrp)for(var j in zcal.cdata.calByGrp[i])j==id&&(gid=i);var cDetail,cShare,cEmbed,calId=($(this),id),cobj=cObj;return cDetail=zcalDetailsView.render(calId,cobj,gid,ty),setTab.find("#det").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainDet[0].removeChild(mainDet[0].childNodes[1]),cDetail=zcalDetailsView.render(calId,cobj,gid,ty),mainDet.append(cDetail)}),setTab.find("#sh").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainDet[0].removeChild(mainDet[0].childNodes[1]),cShare=zcalShareView.render(calId,cobj),mainDet.append(cShare)}),setTab.find("#em").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainDet[0].removeChild(mainDet[0].childNodes[1]),cEmbed=zcalEmbedView.render(calId,cobj),mainDet.append(cEmbed)}),setTab.find("#grpmem").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainDet[0].removeChild(mainDet[0].childNodes[1]),zcalGrpMemView(calId,mainDet)}),mainDet.append(setTab),mainDet.append(cDetail),mainDet},_openEmbed=function(calid,cobj,ty){var sh,cDetail,cShare,mainSh=$("<div class='SC_Twpr zcl_Twpr zcl_Twpr_list'  id='zcl_callist'></div>"),setTab=$("<div class='SC_setTab'><div class='SC_setTabList'><span id='det'>"+zcal.i18n.edit+"</span><span id='sh'>"+zcal.i18n.share+"</span><span class='sel' id='em'>"+zcal.i18n.embed+"</span></div></div>"),cEmbed=zcalEmbedView.render(calid,cobj);return"groups"==ty&&(sh="<span id='grpmem'>Members</span>",setTab.find(".SC_setTabList").append($(sh))),setTab.find("#det").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainSh[0].removeChild(mainSh[0].childNodes[1]);var gid;for(var i in zcal.cdata.calByGrp)for(var j in zcal.cdata.calByGrp[i])j==id&&(gid=calid);cDetail=zcalDetailsView.render(calid,cobj,gid,ty),mainSh.append(cDetail)}),setTab.find("#sh").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainSh[0].removeChild(mainSh[0].childNodes[1]),cShare=zcalShareView.render(calid,cobj),mainSh.append(cShare)}),setTab.find("#em").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainSh[0].removeChild(mainSh[0].childNodes[1]),cEmbed=zcalEmbedView.render(calid,cobj),mainSh.append(cEmbed)}),setTab.find("#grpmem").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainSh[0].removeChild(mainSh[0].childNodes[1]),zcalGrpMemView(calid,mainSh)}),mainSh.append(setTab),mainSh.append(cEmbed),mainSh},_openShare=function(calid,cobj,ty){var cDetail,cEmbed,mainSh=$("<div class='SC_Twpr zcl_Twpr zcl_Twpr_list'  id='zcl_callist'></div>"),setTab=$("<div class='SC_setTab'><div class='SC_setTabList'><span id='det'>"+zcal.i18n.edit+"</span><span class='sel' id='sh'>"+zcal.i18n.share+"</span><span id='em'>"+zcal.i18n.embed+"</span></div></div>"),cShare=zcalShareView.render(calid,cobj);if("groups"==ty){var sh="<span id='grpmem'>Members</span>";setTab.find(".SC_setTabList").append($(sh))}return setTab.find("#det").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainSh[0].removeChild(mainSh[0].childNodes[1]);var gid;for(var i in zcal.cdata.calByGrp)for(var j in zcal.cdata.calByGrp[i])j==calid&&(gid=i);cDetail=zcalDetailsView.render(calid,cobj,gid,ty),mainSh.append(cDetail)}),setTab.find("#sh").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainSh[0].removeChild(mainSh[0].childNodes[1]),cShare=zcalShareView.render(calid,cobj),mainSh.append(cShare)}),setTab.find("#em").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainSh[0].removeChild(mainSh[0].childNodes[1]),cEmbed=zcalEmbedView.render(calid,cobj),mainSh.append(cEmbed)}),setTab.find("#grpmem").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("sel"),$ele.addClass("sel"),mainSh[0].removeChild(mainSh[0].childNodes[1]),zcalGrpMemView(calid,mainSh)}),mainSh.append(setTab),mainSh.append(cShare),mainSh},_groupCalendarView=function(){var type="groups",calOdr=zcal.cdata.gcalOdrArr;mailLI[0].removeChild(mailLI[0].childNodes[1]);var tDiv=$('<div><div class="zcl_Twpr_Callist"><div class="SC_filt_bottom SC_filt_bottomCustom"  id="topB"><div class="zmL SC_filt_bld"><ul class="bld"><li></li><li>Calendar Name</li><li>Actions</li> <li class="conditions">Status</li></ul></div></div><div class="SC_Twpr zcl_Twpr_Callist zcl_setsrl"> <div class="SC_filt_bottom SC_filt_bottomCustom" id="listCal"></div></div></div></div>'),gL=mailLI.find("#grpCal");gL.parent().find("li").removeClass("stSel"),gL.addClass("stSel"),mailLI.append(tDiv);for(var i in calOdr){var calId=calOdr[i],calLst=zcal.cdata.calGLst;listGroupCalendar(calId,calLst[calId])}_updList(type)},listGroupCalendar=function(id,cObj){var $share,$unsub,$sts,act,type="groups",calDOM=$('<div class="zmL '+(1==cObj[8]?"":"disableFilter")+'" data-id="'+id+'"><ul></ul></div>'),color=ZCL_getCalColor(cObj[1])[1],cname=ZCL_getHTML(cObj[0]),cbxDOM=$('<li><div style="background-color:'+color+'" class="SClbl"><i class="'+(1==cObj[2]?"msi-tick":"")+'"></i></div></li>');$sts=cbxDOM.find(".SClbl"),$sts.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_ChgCalSts(calid)}),calDOM.find("ul").append(cbxDOM);var nmDOM=$('<li><strong class="filterControl">'+cname+"</strong></li>");bindClickEvent(nmDOM,id,cObj,type),calDOM.find("ul").append(nmDOM);var actDOM=$('<li class="filterControl"><b></b></li>');act=actDOM.find("b"),(0!=cObj[13][0]||0!=cObj[13][7])&&($share=$('<span data-id="sh">'+zcal.i18n.share+"</span>"),$share.off("click").on("click",{calid:id,cobj:cObj},function(ev){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return _openShare(ev.data.calid,ev.data.cobj,type)}}).done(function(args){args.card.show()})}),act.append($share)),1==cObj[13][5]&&($unsub=$('<span data-id="del">'+zcal.i18n.unsubscribe+"</span>"),$unsub.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;_ZCL_delCal(calid,!0,type)}),act.append($unsub)),calDOM.find("ul").append(actDOM);var stsDOM=$('<li><div class="onoffButton" style="background-color: transparent !important;"></li>');if("false"==cObj[3]){var bar=$("<div data-on="+zcal.i18n.on+" data-off="+zcal.i18n.off+"></div>");bar.addClass(0==cObj[8]?"sdiv sadiv":"sdiv"),bar.off("click").on("click",{calid:id},function(ev){var $ele=$(this),$parEle=$ele.parents(".zmL"),calid=ev.data.calid;ZCL_XHR("/cal/calAct.do?mode=sh-hde&calid="+calid+"&isshow="+($ele.hasClass("sadiv")?!0:!1),function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[8]=_robj.isshow?1:0,$ele.removeAttr("class").addClass(_robj.isshow?"sdiv inctop":"sdiv sadiv"),$parEle.removeAttr("class").addClass(_robj.isshow?"zmL":"zmL disableFilter"),$.publish("/calendar/visibilityChanged",{calid:calid,visibility:_robj.isshow}))})}),stsDOM.find(".onoffButton").append(bar)}calDOM.find("ul").append(stsDOM),mailLI.find("#listCal").append(calDOM)},_appCalendarView=function(){var type="apps",tDiv=$('<div><div class="zcl_Twpr_Callist"><div class="SC_filt_bottom SC_filt_bottomCustom"  id="topB"><div class="zmL SC_filt_bld"><ul class="bld"><li></li><li>Calendar Name</li><li>Actions</li> <li class="conditions">Status</li></ul></div></div><div class="SC_Twpr zcl_Twpr_Callist zcl_setsrl"> <div class="SC_filt_bottom SC_filt_bottomCustom" id="listCal"></div></div></div></div>');mailLI[0].removeChild(mailLI[0].childNodes[1]),mailLI.append(tDiv);var gL=mailLI.find("#appCal");gL.parent().find("li").removeClass("stSel"),gL.addClass("stSel"),calLst=zcal.cdata.calALst;for(var i in calLst)listAppCalendar(i,calLst[i]);_updList(type)},listAppCalendar=function(id,cObj){var $share,$unsub,$sts,$update,act,type="apps",calDOM=$('<div class="zmL '+(1==cObj[8]?"":"disableFilter")+'" data-id="'+id+'"><ul></ul></div>'),color=ZCL_getCalColor(cObj[1])[1],cname=ZCL_getHTML(cObj[0]),cbxDOM=$('<li><div style="background-color:'+color+'" class="SClbl"><i class="'+(1==cObj[2]?"msi-tick":"")+'"></i></div></li>');$sts=cbxDOM.find(".SClbl"),$sts.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_ChgCalSts(calid)}),calDOM.find("ul").append(cbxDOM);var nmDOM=$('<li><strong class="filterControl">'+cname+"</strong></li>");bindClickEvent(nmDOM,id,cObj,type),calDOM.find("ul").append(nmDOM);var actDOM=$('<li class="filterControl"><b></b></li>');act=actDOM.find("b"),(0!=cObj[13][0]||0!=cObj[13][7])&&($share=$('<span data-id="sh">'+zcal.i18n.share+"</span>"),$share.off("click").on("click",{calid:id,cobj:cObj},function(ev){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return _openShare(ev.data.calid,ev.data.cobj,type)}}).done(function(args){args.card.show()})}),act.append($share)),1==cObj[13][5]&&($unsub=$('<span data-id="del">'+zcal.i18n.unsubscribe+"</span>"),$unsub.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;_ZCL_delCal(calid,!0,type)}),act.append($unsub)),(2==cObj[5]||5==cObj[5]&&("zcontacts"==cObj[14]||"zprojects"==cObj[14]))&&($update=$('<span data-id="upd">'+zcal.i18n.update+"</span>"),$update.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_mUpd(calid)}),act.append($update)),calDOM.find("ul").append(actDOM);var stsDOM=$('<li><div class="onoffButton" style="background-color: transparent !important;"></div></li>');if("false"==cObj[3]){var bar=$("<div data-on="+zcal.i18n.on+" data-off="+zcal.i18n.off+"></div>");bar.addClass(0==cObj[8]?"sdiv sadiv":"sdiv"),bar.off("click").on("click",{calid:id},function(ev){var $ele=$(this),$parEle=$ele.parents(".zmL"),calid=ev.data.calid;ZCL_XHR("/cal/calAct.do?mode=sh-hde&calid="+calid+"&isshow="+($ele.hasClass("sadiv")?!0:!1),function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[8]=_robj.isshow?1:0,$ele.removeAttr("class").addClass(_robj.isshow?"sdiv inctop":"sdiv sadiv"),$parEle.removeAttr("class").addClass(_robj.isshow?"zmL":"zmL disableFilter"),$.publish("/calendar/visibilityChanged",{calid:calid,visibility:_robj.isshow}))})}),stsDOM.find(".onoffButton").append(bar)}calDOM.find("ul").append(stsDOM),mailLI.find("#listCal").append(calDOM)},_otherCalendarView=function(){var tDiv=$('<div><div class="zcl_Twpr_Callist"><div class="SC_filt_bottom SC_filt_bottomCustom"  id="topB"><div class="zmL SC_filt_bld"><ul class="bld"><li></li><li>Calendar Name</li><li>Actions</li> <li class="conditions">Status</li></ul></div></div><div class="SC_Twpr zcl_Twpr_Callist zcl_setsrl"> <div class="SC_filt_bottom SC_filt_bottomCustom" id="listCal"></div></div></div></div>');mailLI[0].removeChild(mailLI[0].childNodes[1]),mailLI.append(tDiv);var gL=mailLI.find("#othCal");gL.parent().find("li").removeClass("stSel"),gL.addClass("stSel"),calLst=zcal.cdata.calOLst;for(var i in calLst)listOtherCalendar(i,calLst[i]);_updList("other")},listOtherCalendar=function(id,cObj){var $share,$unsub,$sts,$update,act,type="other",calDOM=$('<div class="zmL '+(1==cObj[8]?"":"disableFilter")+'" data-id="'+id+'"><ul></ul></div>'),color=ZCL_getCalColor(cObj[1])[1],cname=ZCL_getHTML(cObj[0]),cbxDOM=$('<li><div style="background-color:'+color+'" class="SClbl"><i class="'+(1==cObj[2]?"msi-tick":"")+'"></i></div></li>');$sts=cbxDOM.find(".SClbl"),$sts.off("click").on("click",{calid:id},function(ev){var calid=ev.data.calid;ZCL_ChgCalSts(calid)}),calDOM.find("ul").append(cbxDOM);var nmDOM=$('<li><strong class="filterControl">'+cname+"</strong></li>");bindClickEvent(nmDOM,id,cObj,type),calDOM.find("ul").append(nmDOM);var actDOM=$('<li class="filterControl"><b></b></li>');act=actDOM.find("b"),0!=cObj[13][0]&&"0"!=zcal.shrCal&&($share=$('<span data-id="sh">'+zcal.i18n.share+"</span>"),$share.off("click").on("click",{calid:id,cobj:cObj},function(ev){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard({getView:function(){return _openShare(ev.data.calid,ev.data.cobj,type)}}).done(function(args){args.card.show()})}),act.append($share)),1==cObj[13][5]&&($unsub=$('<span data-id="del">'+zcal.i18n.unsubscribe+"</span>"),$unsub.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;_ZCL_delCal(calid,!0,type)}),act.append($unsub)),2==cObj[5]&&($update=$('<span data-id="upd">'+zcal.i18n.update+"</span>"),$update.off("click").on("click",{calid:id,ckey:cObj[9]},function(ev){var calid=ev.data.calid;ZCL_mUpd(calid)}),act.append($update)),calDOM.find("ul").append(actDOM);var stsDOM=$('<li><div class="onoffButton" style="background-color: transparent !important;"></div></li>');if("false"==cObj[3]){var bar=$("<div data-on="+zcal.i18n.on+" data-off="+zcal.i18n.off+">");bar.addClass(0==cObj[8]?"sdiv sadiv":"sdiv"),bar.off("click").on("click",{calid:id},function(ev){var $ele=$(this),$parEle=$ele.parents(".zmL"),calid=ev.data.calid;ZCL_XHR("/cal/calAct.do?mode=sh-hde&calid="+calid+"&isshow="+($ele.hasClass("sadiv")?!0:!1),function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&(cObj[8]=_robj.isshow?1:0,$ele.removeAttr("class").addClass(_robj.isshow?"sdiv inctop":"sdiv sadiv"),$parEle.removeAttr("class").addClass(_robj.isshow?"zmL":"zmL disableFilter"),$.publish("/calendar/visibilityChanged",{calid:calid,visibility:_robj.isshow}))})}),stsDOM.find(".onoffButton").append(bar)}calDOM.find("ul").append(stsDOM),mailLI.find("#listCal").append(calDOM)},_ZCL_grpdelCal=function(grpId,grpName){var confirmMsg=zcal.i18n.deletegroup+" "+grpName,delhtml="<div>"+zcal.i18n.deletemsg+"</div>",option={title:confirmMsg,mask:!0,style:{width:"500px"},buttons:[{txt:zcal.i18n.del,callback:function(e){e.target.innerHTML="Deleting",ZCL_XHR("/cal/groups/"+grpId+"?mode=delete",function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"==_robj.status){var grpObj=zcal.cdata.calByGrp[_robj.groupId],calId=Object.keys(grpObj)[0],caluid=grpObj[calId][10][2];$.publish("/calendar/deleted",{calid:calId,caluid:caluid,grpid:_robj.groupId,mode:"grpdelete"});var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard().done(function(opts){opts.close()}).fail(function(){});var mgao=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;mgao.groupCalendarView(),zmsDialog.remove()}else zmUtil.succErrMsg("e",_robj.status),zmsDialog.remove()})}},{isCancel:!0,txt:zcal.i18n.cancel,callback:function(){zmsDialog.remove()}}]};ZCL_$("zcl_grpdel")||$("body").append('<div id="zcl_grpdel" class="zcl_addcalcn"></div>'),$("#zcl_grpdel").html(delhtml),zmsDialog.create("zcl_grpdel",option)},_ZCL_delCal=function(calId,unSub,ty){var cObj,confirmMsg=unSub?zcal.i18n.areyousureunsub:zcal.i18n.deletecalendar;zmsDialog.confirm(confirmMsg,{onOk:function(){cObj=zcal.getCalObj(calId),ZCL_XHR("/cal/calAct.do?mode=del&calid="+calId+"&calencpt="+cObj[9],function(res){var _robj=ZCL_Evl(1,res.responseText);"success"==_robj.status&&$.publish("/calendar/deleted",{calid:calId,caluid:_robj.uid,mode:"delete",type:ty})})}})},ZCL_mUpd=function(c){var f=1==zcal.CALMODE?"/cal/gsubCal.do?&grpid="+ZCL_ZGID+"&mode=userUpd&calid="+c:"/cal/subCal.do?mode=userUpd&calid="+c;ZCL_XHR(f,function(){ZCL_setCalendars(),zcalEvents.loadMonthData(),zmUtil.succErrMsg("s",zcal.i18n.updatedsuccessfully)})},_updCalSts=function(ev,data){{var $ele,calid=data.calid;data.sts}$ele=mailLI.find("[data-id="+calid+"]"),$ele.find("i").length>0&&$ele.find("i").removeAttr("class").addClass(1==data.sts?"msi-tick":"")},_subscribe=function(){$.subscribe("/calendar/added",_getMGAOCalendarsView),$.subscribe("/calendar/updated",_getMGAOCalendarsView),$.subscribe("/calendar/deleted",exports.delCal),$.subscribe("/calendar/statusChanged",exports.updCalSts)};exports.initialize=_initialize,exports.uninitialize=_uninitialize,exports.delCal=_delCal,exports.updCalSts=_updCalSts,exports.getMGAOCalendarsView=_getMGAOCalendarsView,exports.openShare=_openShare,exports.openEmbed=_openEmbed,exports.groupCalendarView=_groupCalendarView,exports.appCalendarView=_appCalendarView,exports.otherCalendarView=_otherCalendarView,exports.ZCL_delCal=_ZCL_delCal,exports.ZCL_icsDown=_ZCL_icsDown,exports.openDetail=_openDetail,exports.openGrpMem=_openGrpMem},"MailSuite.Apps.CalendarMGAOCalendars");var zcalDetailsView=function(caldetailsView){caldetailsView=caldetailsView||{};var $detailPaneWrapper,calId,calObj,calKey,$reminder,$fb,$save,$cancel,_clearPaneTrace=function(ty){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard().done(function(opts){opts.close()});var mgao=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;"apps"==ty?mgao.appCalendarView():"groups"==ty?mgao.groupCalendarView():"other"==ty&&mgao.otherCalendarView()},_updCalDetails=function(ty){var alarm,qryStr,markasBusy=$fb&&$fb.find(".msi-check").length>0?"1":"0",_cname=$("#zcl_calname")[0].value,_cdesc=$("#zcl_caldesc")[0]?$("#zcl_caldesc")[0].getElementsByTagName("TEXTAREA").length>0?$("#zcl_caldesc")[0].getElementsByTagName("TEXTAREA")[0].value.trim().replace(zcal.REG,"").zcalescape():$("#zcl_cedesc")[0].innerHTML.trim().replace(zcal.REG,"").zcalescape():"",divArr=ZCL_$("zcl_calcol").getElementsByTagName("li"),_ccol=0;for(var i in divArr){var _tck=divArr[i].getElementsByTagName("i");if(_tck.length>0&&"msi-tick"==_tck[0].className){_ccol=divArr[i].getAttribute("rel");break}}var col=$("#zcl_txtcol")[0].getElementsByTagName("i"),txtcol=1;"msi-option"==col[0].className&&(txtcol=0);{var grp_id=$("#zcl_calgid")[0].value;$("#zcl_calid")[0].value}if("groups"==ty){var grpObj={calname:_cname,caldesc:_cdesc,calcol:_ccol,txtcol:txtcol};ZCL_XHR("/cal/groups/"+grp_id+"/update?groupData="+JSON.stringify(grpObj),function(res){var resObj=ZCL_Evl(1,res.responseText);if("success"==resObj.status){zmUtil.succErrMsg("s",zcal.i18n.updatedsuccessfully);var obj=resObj.obj,cobj=zcal.getCalObj(resObj.calid);cobj[0]=obj[0],cobj[1]=obj[1],cobj[4]=obj[4],$.publish("/calendar/updated"),_clearPaneTrace(ty)}else zmUtil.succErrMsg("e",resObj.error)})}else alarm=ZCL_getAlarmObj($reminder[0].childNodes)[0],alarm.ACTYPE||alarm.ACTYPE==calObj[6].ACTYPE&&void 0!=alarm.ACTYPE?(alarm.ACTYPE!=calObj[6].ACTYPE||alarm.REMTIME!=calObj[6].REMTIME||alarm.REMTYPE!=calObj[6].REMTYPE||markasBusy!=calObj[16])&&(qryStr="&remt="+alarm.REMTIME+"&remty="+alarm.REMTYPE+"&actty="+alarm.ACTYPE+"&busy="+markasBusy):qryStr="&remt=&remty=&actty=&busy="+markasBusy,qryStr&&ZCL_XHR("/cal/calAct.do?mode=edit-adv&caluid="+calKey+"&calid="+calId+qryStr+"&calcol="+_ccol+"&txtcol="+txtcol+"&caldesc="+_cdesc+"&calname="+_cname,function(res){var _robj=ZCL_Evl(1,res.responseText);if("success"===_robj.status){calObj[6]=_robj.obj.REM,calObj[16]=_robj.obj.BUSY,zmUtil.succErrMsg("s",zcal.i18n.updatedsuccessfully);var cobj=zcal.getCalObj(_robj.id);cobj[0]=_robj.calobj[0],cobj[1]=_robj.calobj[1],cobj[4]=_robj.calobj[4],$.publish("/calendar/updated"),_clearPaneTrace(ty)}})},calColorSel=function(sel){sel=sel?sel:"0";for(var _ccol="<ul >",matched=!1,i=0;i<zcal.calcolor.length;i++)matched=sel==i||zcal.calcolor[i][1].toLowerCase()==sel.toLowerCase()?!0:matched,_ccol+='<li id="selCo" style="background-color:'+zcal.calcolor[i][1]+';" rel="'+i+'">',_ccol+=sel==i||zcal.calcolor[i][1].toLowerCase()==sel.toLowerCase()?'<i class="msi-tick"></i>':"",_ccol+=9==i?"</ul><ul>":"";return _ccol+="</ul>",matched||(_ccol+='<ul><li id="selCo" style="background-color:'+sel+'" rel="'+sel+'"><i class="msi-tick"></i></li>',_ccol+="<li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>"),_ccol};return caldetailsView.render=function(id,cObj,gid,ty){calId=id,calObj=cObj,calKey=calObj[9];var calName=ZCL_getHTML(cObj[0]),calCol=calObj[1].split(":")[0],txtCol=calObj[1].split(":")[1];$detailPaneWrapper=$('<div id="caldetails" class="SC_Twpr zcl_Twpr" style="top:46px"><div class="SC_filt_bottom SC_filt_bottomCustom" id="SC_detail"></div></div>');var $detail='<div class="editFilterParent zcl_stfrm">';if($detail+='<div class="zmL noPad">',$detail+='<div class="SC_srch shw">',$detail+='<table class="condition">',$detail+="<tbody>","group"==calObj[14]&&1!=calObj[13][8]?($detail+='<tr><td class="gbld">'+zcal.i18n.calname+"</td></tr>",$detail+='<tr><td><table><tbody><tr><td><ul class="zcl_frmrw"><input id="zcl_calname" placeholder="" value="'+calName+'" type="text" disabled></ul></td></tr></tbody></table></td></tr>'):($detail+='<tr><td class="gbld">'+zcal.i18n.calname+"</td></tr>",$detail+='<tr><td><table><tbody><tr><td><div class="SC_select SC_selectnoneArw newFltr"><input id="zcl_calname" placeholder="" value="'+calName+'" type="text"></div></td></tr></tbody></table></td></tr>'),$detail+="</tbody>",$detail+="</table>",$detail+=cObj[4]&&""!=cObj[4]?"group"==cObj[14]&&1!=cObj[13][8]?'<div class=""  id="zcl_caldesc"><div class="SC_srch shw"><div class="gbld">Description</div><div class="zcl_vwdes" id="zcl_cedesc" style="max-width: 400px;">'+cObj[4]+"</div></div></div>":'<div class="zmL"  id="zcl_caldesc"><div class="SC_srch shw"><table class="condition"><tbody><tr><td class="gbld">Description</td></tr><tr><td><textarea class="SC_tiput" >'+cObj[4]+"</textarea></td></tr></tbody></table></div></div>":"group"==cObj[14]&&1!=cObj[13][8]?"":'<span class="zcl_grey zcl_cp" id="zcl_opencaldesc">+'+zcal.i18n.addnote+'</span><div class="zmL" style="display:none"  id="zcl_caldesc"><div class="SC_srch shw"><table class="condition"><tbody><tr><td class="gbld">'+zcal.i18n.description+'</td></tr><tr><td><textarea class="SC_tiput"></textarea></td></tr></tbody></table></div></div>',$detail+="</div>",$detail+="</div>",$detail+='<div class="zcl_sczml"><div class="SC_srch shw"><div class="gbld">Calendar Color</div></div>',$detail+='<div class="zcl_calcol" id="zcl_calcol">'+calColorSel(calCol)+"</div>",$detail+='<input type="hidden" id="zcl_calid" value="'+(id?id:"")+'">',$detail+='<input type="hidden" id="zcl_calgid" value="'+(gid?gid:"")+'">',$detail+='<div class="zcl_addcaltx zcl_sczml">',$detail+='<div class="SC_srch shw">',$detail+='<div class="gbld">Text color</div>',$detail+="</div>",$detail+='<u data-marker ="textColor" id="zcl_txtcol"><i class="'+(0==txtCol?"msi-option":"msi-unoption")+'"></i><u class="">White</u></u><u data-marker ="textColor"><i class="'+(1==txtCol?"msi-option":"msi-unoption")+'"></i><u class="">Black</u></u>',$detail+="</div>",$detail+='<div class="zmL">',$detail+='<div class="SC_srch shw">',$detail+='<table class="condition">',$detail+="<tbody>",$detail+='<tr><td class="gbld">'+zcal.i18n.calendarid+"</td></tr>",$detail+='<tr><td><p class="zcl_Calid">'+calKey+"</p></td></tr>",$detail+="</tbody>",$detail+="</table>",$detail+="</div>",$detail+="</div>",$detail+='<div class="zmL">',$detail+='<div class="SC_srch shw">',$detail+='<table class="condition">',$detail+="<tbody>",$detail+='<tr><td class="gbld">'+zcal.i18n.reminder+"</td></tr>",$detail+="</tbody>",$detail+="</table>",$detail+="</div>",$detail+='<ul id="zcl_addrem" class="zcl_rem">',$detail+='<li data-marker="calReminder">',$detail+='<span><i class="msi-add"></i>Add Reminder</span>',$detail+="</li>",$detail+="</ul>",$detail+="</div>",$detail+='<div class="zmL">',$detail+='<div class="SC_srch shw">',$detail+='<p class="match" data-marker="markAsBusy">',$detail+='<em><i class="msi-check"></i>',$detail+='<span class="fn ml5">'+zcal.i18n.markasbusy_cal+"</span>",$detail+="</em>",$detail+="</p>",$detail+="</div>",$detail+="</div>",$detail+='<div class="SC_PUbtm">',$detail+='<span class="sel" data-marker="detailSave">'+zcal.i18n.save+"</span>",$detail+='<span data-val="Cancel">'+zcal.i18n.cancel+"</span>",$detail+="</div>",$detail+="</div>",$detailPaneWrapper.find("#SC_detail").append($($detail)),$reminder=$detailPaneWrapper.find("[data-marker=calReminder]").removeAttr("data-marker"),$reminder.html(ZCL_putCalAlarm(calObj[6])),$reminder.find(".msi-close").off("click").on("click",function(){$(this).closest("ul").remove(),$reminder.find("#zcl_addrem").length||ZCL_AppendRemAddLnk($reminder[0])}),$fb=$detailPaneWrapper.find("[data-marker=markAsBusy]").removeAttr("data-marker"),void 0!=calObj[16]&&""!=calObj[16]){var $fbChkBox=$fb.find("i");$fbChkBox.length>0&&($fbChkBox.removeAttr("class").addClass("1"==calObj[16]?"msi-check":"msi-uncheck"),$fbChkBox.off("click").on("click",function(){this.className="msi-check"==this.className?"msi-uncheck":"msi-check"}))}else $fb.remove();$detailPaneWrapper.find("#zcl_opencaldesc").off("click").on("click",function(){ZCL_$("zcl_caldesc").style.display="",this.style.display="none"});var textColorDOM=$detailPaneWrapper.find("[data-marker=textColor]").removeAttr("data-marker");textColorDOM.on("click",function(){var $ele=$(this);$ele.parent().find("i").removeClass("msi-option").addClass("msi-unoption"),$ele.find("i").removeClass("msi-unoption").addClass("msi-option")});var calColDOM=$detailPaneWrapper.find("#selCo");return calColDOM.on("click",function(ev){var divArr=zcal.$("zcl_calcol").getElementsByTagName("li");for(var i in divArr)divArr[i].innerHTML="";ev.target.innerHTML='<i class="msi-tick"></i>'}),$save=$detailPaneWrapper.find("[data-marker=detailSave]").removeAttr("data-marker"),$save.off("click").on("click",function(){_updCalDetails(ty)}),$cancel=$detailPaneWrapper.find("[data-val=Cancel]"),$cancel.off("click").on("click",_clearPaneTrace),$detailPaneWrapper},caldetailsView.close=_clearPaneTrace,caldetailsView}(zcalDetailsView||{}),zcalShareView=function(calshareView){calshareView=calshareView||{};var $sharePaneWrapper,calId,calObj,calKey,$cancel,$pubShare,$pvtAddress,$indShare,$shareType,$shareTo,$sharePerm,autofillId,$sharedList,groupList,sharedMemberList,shObj={};calshareView.render=function(id,cObj){calId=id,calObj=cObj,calKey=calObj[9],groupList=ZCL_Evl(1,JSON.stringify(zcal.cdata.grpLst)),$sharePaneWrapper=$('<div id="zcl_calshare" class="SC_Twpr zcl_Twpr" style="top:46px"><div class="SC_filt_bottom SC_filt_bottomCustom" id="SC_detail"></div></div>');var $shStr='<div class="editFilterParent zcl_stfrm">';$shStr+='<div data-marker="publicShare" class="zmL"></div>',$shStr+='<div data-marker="privateAddress" class="zmL"></div>',$shStr+='<div data-marker="indShare" class="zmL"></div>',$shStr+='<div class="zcl_Sshlst" data-marker="sharedList"></div>',$shStr+='<div class="SC_PUbtm"><span data-val="Cancel">'+zcal.i18n.cancel+"</span></div>",$shStr+="</div>";var $share=$($shStr);return 0!=calObj[13][0]||1==calObj[13][7]?($pubShare=$share.find("[data-marker=publicShare]").removeAttr("data-marker"),$pvtAddress=$share.find("[data-marker=privateAddress]").removeAttr("data-marker"),$indShare=$share.find("[data-marker=indShare]").removeAttr("data-marker"),$sharedList=$share.find("[data-marker=sharedList]").removeAttr("data-marker"),0==calObj[13][0]&&1==calObj[13][7]?0!=zcal.pvtUrl&&(3==calObj[5]?_reqCalPubPvtInfo():_setPvtAddress()):1==calObj[13][0]&&0==calObj[13][7]?0!=zcal.shrCal&&1!=zcal.shrCal&&(3==calObj[5]?_reqCalPubPvtInfo():_setPubShare()):1==calObj[13][0]&&1==calObj[13][7]?0==zcal.shrCal&&0!=zcal.pvtUrl?3==calObj[5]?_reqCalPubPvtInfo():_setPvtAddress():0!=zcal.shrCal&&1!=zcal.shrCal&&0==zcal.pvtUrl?3==calObj[5]?_reqCalPubPvtInfo():_setPubShare():0!=zcal.shrCal&&1!=zcal.shrCal&&0!=zcal.pvtUrl&&(3==calObj[5]?_reqCalPubPvtInfo():(_setPubShare(),_setPvtAddress())):0==zcal.shrCal&&0!=zcal.pvtUrl?($pubShare&&($pubShare.remove(),$pubShare=void 0),$indShare&&($indShare.remove(),$indShare=void 0),$sharedList&&($sharedList.remove(),$sharedList=void 0),_setPvtAddress()):1==zcal.shrCal&&0==zcal.pvtUrl?($pubShare&&($pubShare.remove(),$pubShare=void 0),$pvtAddress&&($pvtAddress.remove(),$pvtAddress=void 0),zcal.cdata.calLst[calId]?_reqSharedMemberList():_reqCalShareInfo()):1==zcal.shrCal&&0!=zcal.pvtUrl?($pubShare&&($pubShare.remove(),$pubShare=void 0),zcal.cdata.calLst[calId]?(_setPvtAddress(),_reqSharedMemberList()):_reqCalShareInfo()):2==zcal.shrCal&&0==zcal.pvtUrl?($pvtAddress&&($pvtAddress.remove(),$pvtAddress=void 0),zcal.cdata.calLst[calId]?(_setPubShare(),_reqSharedMemberList()):_reqCalShareInfo()):zcal.cdata.calLst[calId]?(_setPubShare(),_setPvtAddress(),_reqSharedMemberList()):_reqCalShareInfo(),$cancel=$share.find("[data-val=Cancel]"),$cancel.off("click").on("click",_clearPaneTrace),$sharePaneWrapper.find("#SC_detail").html($share),$sharePaneWrapper):($sharePaneWrapper=void 0,void $sharePaneWrapper.remove())};var ereqObj,$ereqCode,_reqCalPubPvtInfo=function(){var url="/cal/shareCal.do?mode=cal-pubpvtinfo&caluid="+calObj[9]+"&calid="+calId+"&calmode=0";ZCL_XHR(url,function(res){var _robj=ZCL_Evl(1,res.responseText);_robj.obj&&(calObj[10]=_robj.obj),_setPubShare()})},_reqCalShareInfo=function(){var url="/cal/shareCal.do?mode=sh-calinfo&caluid="+calObj[9]+"&calid="+calId+"&calmode=0";ZCL_XHR(url,function(res){var _robj=ZCL_Evl(1,res.responseText);_robj.calinfo&&(calObj[10]=_robj.calInfo[10],calObj[11]=_robj.calInfo[11],calObj[12]=_robj.calInfo[12]),_robj.pvtLst&&(sharedMemberList=_robj.pvtLst,_setSharedList()),_robj.grpInfo&&(groupList.grp=_robj.grpInfo),_setPubShare()})},_reqSharedMemberList=function(){var url="/cal/shareCal.do?mode=priv-shlst&calid="+calId+"&calmode=0";ZCL_XHR(url,function(res){var _robj=ZCL_Evl(1,res.responseText);_robj.obj&&(sharedMemberList=_robj.obj,_setSharedList())})},_showMenu=function(obj){var menus=[],menuItems=obj.menuItems||[];menuItems.forEach(function(menuItem){var value=menuItem.value,text=menuItem.text;menus.push({htm:"<div>"+text+"</div>",data:{value:value,text:text}})});var deferred=$.Deferred();return obj.list=menus,obj.clk=function(data,element,event){deferred.resolve(data,element,event)},obj.onHide=function(){deferred.reject()},menus.length?zmsuite.showMenu(obj):deferred.reject(),deferred.fail(zmUtil.hideMenu),deferred.promise()},_setSharedList=function(){var optStr='<div class="SC_srch shw">';optStr+='<table class="condition">',optStr+="<tbody>",optStr+='<tr><td class="gbld">Share with individuals or groups</td></tr>',optStr+="</tbody>",optStr+="</table>",optStr+="</div>",optStr+='<div class="SC_srch shw">',optStr+='<table class="condition">',optStr+="<tbody>",optStr+="<tr><td><table><tbody><tr>",optStr+='<td width="60px"><div class="SC_select first zcl_w60" data-marker="shareType"><i class="msi-invitee"></i></div></td>',optStr+='<td width="43%" class="zcl_Calshemail"><div class="SC_select SC_selectnoneArw" ><input placeholder="'+zcal.i18n.typeaemailid+'" value="" class="zm_sgst" type="text" data-marker="shareTo"></div></td>',optStr+='<td width="29%"><div class="SC_select"><input class="disabled" readonly="" value="'+zcal.i18n.private_shperm_viewevent+'" type="text"   data-marker="sharePerm"></div></td>',optStr+='<td class="tRht"><span><i class="msi-plus"></i></span></td>',optStr+="</tr></tbody></table></td></tr>",optStr+="</tbody>",optStr+="</table>",optStr+="</div>",$indShare.html(optStr),$shareType=$indShare.find("[data-marker=shareType]").removeAttr("data-marker"),$shareTo=$indShare.find("[data-marker=shareTo]").removeAttr("data-marker"),$sharePerm=$indShare.find("[data-marker=sharePerm]").removeAttr("data-marker");var addIcon=$indShare.find(".msi-plus");addIcon.off("click").on("click",function(){if(1==shObj.type){var grpid=$shareTo.attr("data-gid");if(null==grpid)return!1;shObj.grpid=grpid}else{var email=$shareTo[0].value;if(!ZCL_isEmail(email))return zmUtil.succErrMsg("e",zcal.i18n.entervalidemail),$shareTo[0].focus(),!1;shObj.email=email}_shareCal(shObj)}),_changeShareOption({value:0}),_updateShdList()},_updateShdList=function(){var $shlst=$("<table></table>");for(var user in sharedMemberList[0]){var $row,$inp,$del,menuItems=_getSharePermList(0),perm=menuItems[sharedMemberList[0][user]].text;$row=$('<tr><td><i class="msi-invitee"></i></td><td width="43%"><span>'+ZCL_getHTML(user)+'</span></td><td width="29%"><div class="SC_select"><input type="text" class="disabled" readonly value="'+perm+'"></div></td><td><i class="msi-close"></i></td></tr>'),$inp=$row.find("input"),$inp.off("click").on("click",{menuItems:menuItems,email:user},function(ev){_showMenu({menuItems:ev.data.menuItems,par:this,parWidth:!0}).then(function(data){_shareCal({type:0,email:ev.data.email,perm:data.value}),zmUtil.hideMenu()})}),$del=$row.find(".msi-close"),$del.off("click").on("click",{email:user},function(ev){_delCalSharing({email:ev.data.email,mode:0})}),$shlst.append($row)}for(var group in sharedMemberList[1]){var gO=groupList.pgrp[group]||groupList.ogrp[group];if(gO){var $row,$inp,$del,menuItems=_getSharePermList(1),perm=menuItems[sharedMemberList[1][group]].text;$row=$('<tr><td width="5%"><i class="msi-group"></i></td><td width="43%"><span>'+ZCL_getHTML(gO.GNAME)+'</span></td><td width="29%"><div class="SC_select"><input type="text" class="disabled" readonly value="'+perm+'"></div></td><td><i class="msi-close"></i></td></tr>'),$inp=$row.find("input"),$inp.off("click").on("click",{menuItems:menuItems,grpid:group},function(ev){_showMenu({menuItems:ev.data.menuItems,par:this,parWidth:!0}).then(function(data){_shareCal({type:1,grpid:ev.data.grpid,perm:data.value}),zmUtil.hideMenu()})}),$del=$row.find(".msi-close"),$del.off("click").on("click",{grpid:group},function(ev){_delCalSharing({grpid:ev.data.grpid,mode:1})}),$shlst.append($row)}}$sharedList.html($shlst)},_delCalSharing=function(obj){var ty=obj.mode,url="/cal/shareCal.do?&calid="+calId+"&caluid="+calObj[9]+"&calmode=0";url+=0==ty?"&mode=priv-sh-del&shuser="+obj.email.zcalescape():"&mode=grp-sh-del&grpid="+obj.grpid,ZCL_XHR(url,function(res){var mode,obj,_robj=ZCL_Evl(1,res.responseText);mode=_robj.mode,obj=_robj.obj,"grp-sh-del"==mode?delete sharedMemberList[1][obj[0]]:delete sharedMemberList[0][obj[0]],zmUtil.succErrMsg("s","Calendar sharing removed successfully"),_updateShdList()})},_shareCal=function(obj){var url="/cal/shareCal.do?calid="+calId+"&perm="+obj.perm+"&caluid="+calKey+"&calmode=0";url+=1==obj.type?"&mode=grp-sh&grpid="+obj.grpid:"&mode=priv-sh&shuser="+obj.email.zcalescape(),ZCL_XHR(url,function(res){var shobj,_robj=ZCL_Evl(1,res.responseText);return"success"!=_robj.status?void("maxLmtReached"==_robj.status?zmUtil.succErrMsg("e",ZCL_replaceString(zcal.i18n.maxLmtReached,[60])):"noPermission"==_robj.status?zmUtil.succErrMsg("e",zcal.i18n.NoPermission):"WaitForApprvl"==_robj.status?zmUtil.succErrMsg("e",zcal.i18n.waitforapprovalcalmsg):zmUtil.succErrMsg("e",zcal.i18n[_robj.status])):(zmUtil.succErrMsg("s",zcal.i18n.sharedsuccessfully),shobj=_robj.obj,"grp-sh"===_robj.mode?sharedMemberList[1][shobj[0]]=shobj[1]:sharedMemberList[0][shobj[0]]=shobj[1],_setSharedList(),void 0)})},_changeShareOption=function(obj){var isgrp=ZCL_isEmpty(groupList.pgrp)&&ZCL_isEmpty(groupList.ogrp)?!1:!0,ty=obj.value,shPermMenu=_getSharePermList(ty);if(shObj.type=ty,shObj.perm=shPermMenu[1].value,$shareType&&($shareType.html('<i class="'+(1==ty?"msi-group":"msi-invitee")+'"></i>'),$shareType.off("click").on("click",{isgrp:isgrp},function(ev){var shTypeMenu=[{value:0,text:zcal.i18n.individuals}];ev.data.isgrp&&shTypeMenu.push({value:1,text:zcal.i18n.groups}),_showMenu({menuItems:shTypeMenu,par:this,parWidth:!1}).then(function(data){_changeShareOption(data),zmUtil.hideMenu()})})),autofillId&&zmAutoFill.removeAutoFill(autofillId),$shareTo)if($shareTo.off("click"),$shareTo.val(""),1==ty){$shareTo.attr("placeholder",zcal.i18n.selectagroup);var groupArr=getGroupForList();$shareTo.off("click").on("click",function(){var component,config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.onSelect=function(id,selectObj){setGroupValue(that,id,selectObj),component.hide()},config.dataCallback=function(){return groupArr},component=zmUtil.createFLComp("generic",config),component.show()})}else{$shareTo.attr("placeholder",zcal.i18n.typeaemailid);var afObj=zmSearch.getAFObj(0,function(obj){$shareTo[0].value=obj.eid,shObj.email=obj.eid});autofillId=zmAutoFill.setAutofill(afObj,$shareTo)}$sharePerm&&$sharePerm.off("click").on("click",function(){var that=this;_showMenu({menuItems:shPermMenu,par:this,parWidth:!0}).then(function(data){that.value=data.text,shObj.perm=data.value,zmUtil.hideMenu()})})},setGroupValue=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("data-gid",id)},updateGroupList=function(groupArr,groupList){for(var i=0;i<groupList.length;i++){var group=zcalGroup.getGroup(groupList[i]);group&&groupArr.push({id:groupList[i],name:group.name,display_text:group.name})}},getGroupForList=function(){var groupList,groupArr=[];return groupList=zcalGroup.getGroupList("personal"),updateGroupList(groupArr,groupList),groupList=zcalGroup.getGroupList("org"),updateGroupList(groupArr,groupList),groupArr},_getSharePermList=function(ty){var shPermMenu=[{value:0,text:zcal.i18n.private_shperm_freebusy},{value:1,text:zcal.i18n.private_shperm_viewevent}];return 0==ty&&(shPermMenu.push({value:2,text:zcal.i18n.private_shperm_editevent}),shPermMenu.push({value:3,text:zcal.i18n.private_shperm_delegate})),shPermMenu},_setPubShare=function(){var $pubEle,$chgPermEle,$icalEle,$htmlEle,$wapiEle,$ereqEle,pubStr='<div class="SC_srch shw">';pubStr+='<table class="condition">',pubStr+="<tbody>",pubStr+='<tr><td class="gbld">'+zcal.i18n.public_share+"</td></tr>",pubStr+="</tbody>",pubStr+="</table>",pubStr+="</div>",pubStr+="<div>",pubStr+='<table class="condition">',pubStr+="<tbody>",pubStr+="<tr><td>",pubStr+='<div><span data-marker="makePublic">',pubStr+='<i class="'+(0!=calObj[10][1]?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.makethiscalpub+"</span>",pubStr+="</span></div>",0!=calObj[10][1]&&(pubStr+='<div class="zcl_Sshp zcl_Sshpu">',pubStr+="<div>",pubStr+='<span data-marker="chgPubPerm" rel="fb">',pubStr+='<i class="'+(1==calObj[10][1]||4==calObj[10][1]?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.public_shperm_freebusy+"</span>",pubStr+="</span>",pubStr+='<span data-marker="chgPubPerm" rel="vd">',pubStr+='<i class="'+(2==calObj[10][1]||3==calObj[10][1]?"msi-option":"msi-unoption")+'"></i><span class="pl5">'+zcal.i18n.public_shperm_viewevent+"</span>",pubStr+="</span>",1==calObj[13][1]&&(pubStr+="<div>",pubStr+='<span data-marker="allowER"><i class="'+(3==calObj[10][1]||4==calObj[10][1]?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.allow_requisition+"</span></span>",pubStr+=3==calObj[10][1]||4==calObj[10][1]?'<ul><li><span class="zcl_lk" data-marker="webAPI">'+zcal.i18n.webapiforevent+'</span></li><li><span class="zcl_lk" data-marker="eventReq">'+zcal.i18n.calpubevtreq+"</span></li></ul>":"",pubStr+="</div>"),pubStr+="</div>",pubStr+="<div>",pubStr+='<span class="zcl_lk" data-marker="pubICAL">'+zcal.i18n.ical+"</span>",pubStr+='<span class="zcl_sp"></span><span class="zcl_lk" data-marker="pubHTML">'+zcal.i18n.html+"</span>",(""==calObj[14]||"gcal"==calObj[14])&&(pubStr+='<span class="zcl_sp"></span><span class="zcl_lk" data-marker="mailto">Mail to</span>',pubStr+='<span class="zcl_sp"></span><span class="zcl_lk" data-marker="linkto">Link to</span>'),pubStr+="</div>",pubStr+="</div>"),pubStr+="</td></tr>",pubStr+="</tbody>",pubStr+="</table>",pubStr+="</div>",$pubShare.html(pubStr),$pubEle=$pubShare.find("[data-marker=makePublic]").removeAttr("data-marker"),$pubEle.off("click").on("click",function(){var pubPerm,chk=$(this).find("i");chk.hasClass("msi-check")?(chk.removeClass("msi-check").addClass("msi-uncheck"),pubPerm=0):(chk.removeClass("msi-uncheck").addClass("msi-check"),pubPerm=1),_updateCalPubPerm({perm:pubPerm,mode:"enable/disable"})}),$chgPermEle=$pubShare.find("[data-marker=chgPubPerm]").removeAttr("data-marker"),$chgPermEle.off("click").on("click",function(){var pubPerm,$ele=$(this),parEle=$ele.parent();pubPerm="vd"===$(this).attr("rel")?2:1,pubPerm=calObj[10][1]>=3?1==pubPerm?4:3:pubPerm,parEle.find(".msi-option").removeClass().addClass("msi-unoption"),$ele.find("i").addClass("msi-option"),_updateCalPubPerm({perm:pubPerm,mode:"change"})}),$ereqEle=$pubShare.find("[data-marker=allowER]").removeAttr("data-marker"),$ereqEle.off("click").on("click",function(){var ereq,chk=$(this).find("i");chk.hasClass("msi-check")?(chk.removeClass("msi-check").addClass("msi-uncheck"),ereq=0):(chk.removeClass("msi-uncheck").addClass("msi-check"),ereq=1),_updateCalEventReqPerm(ereq)}),$icalEle=$pubShare.find("[data-marker=pubICAL]").removeAttr("data-marker"),$icalEle.off("click").on("click",function(){openCalPubURL("ical")}),$htmlEle=$pubShare.find("[data-marker=pubHTML]").removeAttr("data-marker"),$htmlEle.off("click").on("click",function(){openCalPubURL("embed")}),$icalEle=$pubShare.find("[data-marker=mailto]").removeAttr("data-marker"),$icalEle.off("click").on("click",function(){openMailTo()}),$icalEle=$pubShare.find("[data-marker=linkto]").removeAttr("data-marker"),$icalEle.off("click").on("click",function(){openLinkTo()}),$wapiEle=$pubShare.find("[data-marker=webAPI]").removeAttr("data-marker"),$wapiEle.off("click").on("click",function(){openCalWebAPI()}),$ereqEle=$pubShare.find("[data-marker=eventReq]").removeAttr("data-marker"),$ereqEle.off("click").on("click",function(){openCalEventReq()})},_updateCalPubPerm=function(obj){var pubPerm=obj.perm,req="/cal/shareCal.do?pubshare="+pubPerm+"&mode=pub-sh&calid="+calId+"&caluid="+calObj[9]+"&calmode=0";ZCL_XHR(req,function(res){var stsMsg,_robj=ZCL_Evl(1,res.responseText);"success"===_robj.status&&(calObj[10][1]=_robj.pub,stsMsg="change"===obj.mode?zcal.i18n.publicsharechanged:0==pubPerm?zcal.i18n.publicshare_disabled:zcal.i18n.publicshare_enabled,zmUtil.succErrMsg("s",stsMsg)),_setPubShare()})},_updateCalEventReqPerm=function(ereq){var req,pubPerm=calObj[10][1];pubPerm=1==ereq?2==pubPerm?3:4:4==pubPerm?1:2,req="/cal/shareCal.do?pubshare="+pubPerm+"&mode=pub-sh&calid="+calId+"&caluid="+calObj[9]+"&calmode=0",ZCL_XHR(req,function(res){var stsMsg,_robj=ZCL_Evl(1,res.responseText);"success"===_robj.status&&(calObj[10][1]=_robj.pub,stsMsg=0==ereq?zcal.i18n.allow_requisition_disabled:zcal.i18n.allow_requisition_enabled,zmUtil.succErrMsg("s",stsMsg)),_setPubShare()})},openCalPubURL=function(type){$("#zcl_calpubaddress").length||$("body").append("<div id='zcl_calpubaddress' class='zcl_ovr'/>");var pubStr,calpubEle=$("#zcl_calpubaddress");pubStr='<div class="SC_set">',pubStr+='<textarea type="text" class="zcl_Stxt">'+location.protocol+"//"+zcal.ZCAL+"/"+(""==calObj[14]||"gcal"==calObj[14]?"":calObj[14]+"/")+type+"/"+calObj[9]+"</textarea>",pubStr+='<span class="">'+zcal.i18n.calurlmsg+"</span>",pubStr+="</div>",calpubEle.html(pubStr);var options={title:zcal.i18n.publicaddress,mask:!0,pos:"center",closeaction:function(){calpubEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop"};zmsDialog.create("zcl_calpubaddress",options)},openCalWebAPI=function(){$("#zcl_calwebapi").length||$("body").append("<div id='zcl_calwebapi' class='zcl_ovr'/>");var wapiStr,calwapiEle=$("#zcl_calwebapi");wapiStr='<div class="SC_set SC_filt_bottom">',wapiStr+='<div class="zmL">',wapiStr+='<div class="SC_srch shw"><table class="condition">',wapiStr+='<tr><td class="gbld">'+zcal.i18n.calwebapimsg+"</td></tr>",wapiStr+='<tr><td><textarea type="text" class="zcl_Stxt">'+location.protocol+"//"+zcal.ZCAL+"/eventreq/"+calObj[9]+"?name=[name]&mailId=[EmailId]&date=[MM/dd/yyyy]&time=[13:00]&reason=[Reason for Appointment]</textarea></td></tr>",wapiStr+="</table></div>",wapiStr+="</div>",wapiStr+="</div>",calwapiEle.html(wapiStr);var options={title:zcal.i18n.apiforeventreq,mask:!0,pos:"center",closeaction:function(){calwapiEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop"};zmsDialog.create("zcl_calwebapi",options)},openMailTo=function(){$("#zcl_calmailto").length||$("body").append("<div id='zcl_calmailto' class='zcl_ovr' style='width: 600px;'/>");var mailStr,mailtoEle=$("#zcl_calmailto");mailStr='<div class="SC_set">',mailStr+='<div class="zcl_ad_gr_m" style="max-height: 200px;overflow-y: auto;min-height:50px" ><input style="width:100%" id="zcl_emailgrp" type="text"  placeholder="Enter the email address" value=""><ul id="zcl_emUl" style="white-space:normal"></ul></div>',mailStr+='<span class="">By mailing the calendar to individuals/groups, they can subscribe to it.</span>',mailStr+="</div>",mailtoEle.html(mailStr);var options={title:"Mail To",mask:!0,pos:"center",closeaction:function(){mailtoEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop",buttons:[{txt:zcal.i18n.send,callback:function(){var emailId="";if(""!=$("#zcl_emailgrp")[0].value){var em=$("#zcl_emailgrp")[0].value;ZCL_isEmail(em)?emailId+=""!=emailId.trim()?","+em:em:($("#zcl_emailgrp")[0].value="",$("#zcl_emailgrp")[0].focus(),zmUtil.succErrMsg("e",zcal.i18n.entervalidemail))}if($("#zcl_emUl")[0].childNodes)for(var i in $("#zcl_emUl")[0].childNodes)if($("#zcl_emUl")[0].childNodes[i].id){var emid=$("#zcl_emUl")[0].childNodes[i].id;emailId+=""!=emailId.trim()?","+emid:emid}if(emailId){var ckey=calObj[9];ZCL_XHR("/cal/mailTo.do?ckey="+ckey+"&mailids="+emailId.ZCL_calescape(),function(res){var obj=ZCL_Evl(1,res.responseText);"success"==obj.status&&zmUtil.succErrMsg("s",zcal.i18n.mailsendsuccess)}),zmsDialog.remove()}}}]};zmsDialog.create("zcl_calmailto",options),setTimeout(function(){$("#zcl_emailgrp")[0].focus()},500),$("#zcl_emailgrp").on("keydown",function(event){if(13==event.keyCode&&"zcl_emailgrp"==this.id){for(var attArr=this.value.split(","),z=0;z<attArr.length;z++){var _emlid=attArr[z].trim(),idx1=_emlid.indexOf("<"),idx2=_emlid.indexOf(">");idx1>-1&&idx2>-1&&(_emlid=_emlid.substring(idx1+1,idx2)),_emlid=_emlid.replace(/,/g,"")}if(ZCL_isEmail(_emlid)){var data={};data.id=_emlid;var li=document.createElement("li");li.setAttribute("id",data.id),li.innerHTML=(data.profileImage?"<img src="+data.profileImage+">":"<img src="+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+">")+"<span>"+data.id+'</span><i class="msi-close"></i>',$("#zcl_emUl").append(li),$("#zcl_emailgrp")[0].value="",$("#zcl_emUl").find(".msi-close").on("click",function(ev){ev.target.parentNode.remove()}),$("#zcl_emailgrp").val("")}}}),zmAppLoader.load("zmContactsAutoComplete").done(function(){zmContactsAutoComplete.autoComplete({input:$("#zcl_emailgrp")[0],excludeMe:!0,contactType:["org","crm","personal"],exclude:function(){var email=[];if($("#zcl_emUl")[0].childNodes){var attl=$("#zcl_emUl")[0].childNodes;for(var i in attl)email.push(attl[i].id)}return email},onSelect:function(event,data){var data=data.item.attributes,li=document.createElement("li");li.setAttribute("data-zid",data.zid),li.setAttribute("id",data.id),li.innerHTML=(data.profileImage?"<img src="+data.profileImage+">":"<img src="+(zmail.defaultPhoto?zmail.defaultPhoto:zmResource.get("image","SC-Photo.png"))+">")+"<span>"+data.firstName+'</span><i class="msi-close"></i>',$("#zcl_emUl").append(li),$("#zcl_emailgrp")[0].value="",$("#zcl_emUl").find(".msi-close").on("click",function(ev){ev.target.parentNode.remove()})}})})},openLinkTo=function(){$("#zcl_linkto").length||$("body").append("<div id='zcl_linkto' class='zcl_ovr'/>");var linkStr,linktoEle=$("#zcl_linkto");linkStr='<div class="SC_set">',linkStr+='<textarea type="text" readonly class="zcl_Stxt"><a href="'+location.protocol+"//"+zcal.ZCAL+"/"+(""==calObj[14]||"gcal"==calObj[14]?"":calObj[14]+"/")+"ical/"+calObj[9]+'/mailto" style="background-image:url('+location.protocol+zcal.imgPath+"zoho/zcl_add_to_calendar.png?"+zcal.TSTAMP+');background-color:transparent;display:block;height:35px;width:111px;" target="_blank" alt='+ZCL_replaceProName(zcal.i18n.mailtotooltipmsg)+" title="+ZCL_replaceProName(zcal.i18n.mailtotooltipmsg)+"></a></textarea>",linkStr+='<span class="">'+zcal.i18n.tolinkthiscalwebsite+"</span>",linkStr+="</div>",linktoEle.html(linkStr);var options={title:"Link To",mask:!0,pos:"center",closeaction:function(){linktoEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop"};zmsDialog.create("zcl_linkto",options)},_getLangSelection=function(){var langArr=zcalEmbed.languages(),selStr='<select class="select">';for(var val in langArr)selStr+='<option value="'+val+'">'+langArr[val]+"</option>";return selStr+="</select>"},ereq=function(obj){this.theme=obj&&obj.theme||0,this.language=obj&&obj.lang||"en",this.calKey=obj&&obj.ckey};ereq.prototype={setTheme:function(theme){this.theme=theme},setLanguage:function(language){this.language=language},getURL:function(){var _url='<iframe src="'+location.protocol+"//"+zcal.ZCAL+"/eventreqForm/"+this.calKey+"?theme="+this.theme+"&l="+this.language+"&tz="+zcal.cdata.opt.TZLBL+'" frameborder="0" scrolling="no" marginWidth="0" border="0px" marginHeight="0" height="300px" width="432px" allowTransparency="true" align="center"></iframe>';return _url}};var updateEReqURL=function(){$ereqCode&&$ereqCode.html('<textarea class="zcl_Stxt">'+ereqObj.getURL()+"</textarea>")},openCalEventReq=function(){$("#zcl_calereq").length||$("body").append("<div id='zcl_calereq' class='zcl_ovr'/>");var ereqStr,ereqCol,calereqEle=$("#zcl_calereq");ereqObj=new ereq({lang:"en",theme:0,ckey:calObj[9]}),ereqCol=["#D5E4F7","#899AFF","#6FC252","#D4D4D4","#FF8F8F","#FF8FC1","#C9CE46","#FFAE00","#6F0DC2","#C81515"],ereqStr='<div class="SC_set SC_filt_bottom">',ereqStr+='<div class="conditionDiv">',ereqStr+="<table><tr><td>",ereqStr+='<div><div class="zmL">',ereqStr+='<div class="SC_srch shw">',ereqStr+='<table class="condition">',ereqStr+='<tr><td class="gbld">'+zcal.i18n.chooseyourclolor+"</td></tr>",ereqStr+='<tr><td><ul class="zcl_cecolr" id="zcl_ereqTheme">';for(var i=0;i<ereqCol.length;i++)ereqStr+='<li style="background-color:'+ereqCol[i]+'" class='+(i===ereqObj.theme?"zcl_sl":"")+'><i class="msi-tick"></i></li>';ereqStr+="</ul></td></tr>",ereqStr+="</table>",ereqStr+="</div>",ereqStr+="</div></div>",ereqStr+="</td>",ereqStr+="<td>",ereqStr+='<div><div class="zmL">',ereqStr+='<div class="SC_srch shw">',ereqStr+='<table class="condition">',ereqStr+='<tr><td class="gbld">'+zcal.i18n.language+"</td></tr>",ereqStr+='<tr><td><table><tr><td><div class="SC_select" data-marker="languageSel"></div></td></tr></table></td></tr>',ereqStr+="</table>",ereqStr+="</div>",ereqStr+="</div></div>",ereqStr+="</td></tr></table>",ereqStr+="</div>",ereqStr+='<div class="zmL">',ereqStr+='<div class="SC_srch shw"><table class="condition">',ereqStr+='<tr><td class="gbld">'+zcal.i18n.calwebapimsg+"</td></tr>",ereqStr+='<tr><td data-marker="ereqCode"><textarea class="zcl_Stxt">'+ereqObj.getURL()+"</textarea></td></tr>",ereqStr+="</table></div>",ereqStr+="</div>",ereqStr+="</div>",calereqEle.html(ereqStr),$ereqCode=calereqEle.find("[data-marker=ereqCode]").removeAttr("data-marker");var $themeDOM=calereqEle.find("#zcl_ereqTheme");$themeDOM.find("li").off("click").on("click",function(){var $ele=$(this);$ele.parent().find("li").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),ereqObj.setTheme($ele.index()),updateEReqURL()});var $langDOM=calereqEle.find("[data-marker=languageSel]").removeAttr("data-marker"),langStr=_getLangSelection();$langDOM.html(langStr),$langDOM.find("select").off("change").on("change",function(){ereqObj.setLanguage(this.value),updateEReqURL()});var options={title:zcal.i18n.calpubevtreq,mask:!0,pos:"center",closeaction:function(){calereqEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop",buttons:[{txt:zcal.i18n.preview,callback:function(){var txt,previewWindow=window.open();previewWindow.document.open(),txt=ereqObj.getURL().replace(/&lt;/gi,"<").replace(/&gt;/gi,">"),previewWindow.document.write("<html><body>"+txt+"</body></html>"),previewWindow.document.close()}}]};zmsDialog.create("zcl_calereq",options)},_setPvtAddress=function(){var $pvtEle,$icalEle,$htmlEle,pvtStr='<div class="SC_srch shw">';pvtStr+='<table class="condition">',pvtStr+="<tbody>",pvtStr+='<tr><td class="gbld">'+zcal.i18n.privateaddress+"</td></tr>",pvtStr+="</tbody>",pvtStr+="</table>",pvtStr+="</div>",pvtStr+="<div>",pvtStr+='<table class="condition">',pvtStr+="<tbody>",pvtStr+="<tr><td>",pvtStr+='<span data-marker="enablePvtURL"><i class="'+(calObj[10][0]?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.endableprivateadd+"</span></span>",calObj[10][0]&&(pvtStr+='<div class="zcl_Sshp"><div><span class="zcl_lk" data-marker="pvtICAL">'+zcal.i18n.ical+'</span><span class="zcl_sp"></span><span class="zcl_lk" data-marker="pvtHTML">'+zcal.i18n.html+"</span>",pvtStr+='<span class="SC_button zcl_ovr" data-marker="pvtReset">'+zcal.i18n.reseturl+"</span></div></div>"),pvtStr+="</td></tr>",pvtStr+="</tbody>",pvtStr+="</table>",pvtStr+="</div>",$pvtAddress.html(pvtStr),$pvtEle=$pvtAddress.find("[data-marker=enablePvtURL]").removeAttr("data-marker"),$pvtEle.off("click").on("click",function(){var mode,chk=$(this).find("i");chk.hasClass("msi-check")?(chk.removeClass("msi-check").addClass("msi-uncheck"),mode="priv-dis"):(mode="priv-reset",chk.removeClass("msi-uncheck").addClass("msi-check")),_updateCalPvtAddress({mode:mode,msg:"enable/disable"})}),$icalEle=$pvtAddress.find("[data-marker=pvtICAL]").removeAttr("data-marker"),$icalEle.off("click").on("click",function(){openCalPvtURL("ical")}),$htmlEle=$pvtAddress.find("[data-marker=pvtHTML]").removeAttr("data-marker"),$htmlEle.off("click").on("click",function(){openCalPvtURL("embed")}),$pvtReset=$pvtAddress.find("[data-marker=pvtReset]").removeAttr("data-marker"),$pvtReset.off("click").on("click",function(){_updateCalPvtAddress({mode:"priv-reset",msg:"reset"})})},_updateCalPvtAddress=function(pObj){var req,ckey=calObj[9],mode=pObj.mode;req="/cal/shareCal.do?calid="+calId+"&caluid="+ckey+"&mode="+mode+"&calmode=0",ZCL_XHR(req,function(res){var _robj=ZCL_Evl(1,res.responseText);"priv-reset"===mode?(calObj[10][0]=_robj.pvtId,zmUtil.succErrMsg("s","reset"==pObj.msg?zcal.i18n.privateurlchanged:zcal.i18n.privateshare_enabled)):(calObj[10][0]=null,zmUtil.succErrMsg("s",zcal.i18n.privateshare_disabled)),_setPvtAddress()})},openCalPvtURL=function(type){var calpvtEle;$("#zcl_calpvtaddress").length||$("body").append("<div id='zcl_calpvtaddress' class='zcl_ovr'/>"),calpvtEle=$("#zcl_calpvtaddress");var pvtStr='<div class="SC_set">';pvtStr+='<textarea type="text" class="zcl_Stxt">'+location.protocol+"//"+zcal.ZCAL+"/"+(""==calObj[14]?"":calObj[14]+"/")+type+"/"+calObj[9]+"/pvt_"+calObj[10][0]+"</textarea>",pvtStr+='<span class="">'+zcal.i18n.calurlmsg+"</span>",pvtStr+="</div>",calpvtEle.html(pvtStr);var options={title:zcal.i18n.privateaddress,mask:!0,pos:"center",closeaction:function(){calpvtEle.remove(),zmsDialog.remove()},customClass:"SC_SetPop"};zmsDialog.create("zcl_calpvtaddress",options)},_clearPaneTrace=function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestPreviewCard().done(function(opts){opts.close()})};return calshareView.close=_clearPaneTrace,calshareView}(zcalShareView||{}),zcalEmbedView=function(calembedView){calembedView=calembedView||{};var $embedPaneWrapper,calId,calObj,embedObj,$embedTplImg,$embedTitleSec,$embedTZSec,$embedCode,sizeObj=[{w:"600",h:"500",c:-1,v:0},{w:"300",h:"500",c:0,v:-1},{w:"350",h:"500",c:10,v:-1},{w:"300",h:"500",c:0,v:-1},{w:"400",h:"400",c:-1,v:-1},{w:"700",h:"270",c:0,v:-1},{w:"300",h:"400",c:-1,v:-1},{w:"350",h:"500",c:1,v:-1},{w:"300",h:"500",c:7,v:-1},{w:"300",h:"500",c:0,v:-1}],_getEmbedColors=function(){return[zcal.i18n.blue,zcal.i18n.green,zcal.i18n.red,zcal.i18n.pink,zcal.i18n.violet,zcal.i18n.rosybrown,zcal.i18n.purple,zcal.i18n.grey,zcal.i18n.orange,zcal.i18n.brown,zcal.i18n.yellow]},_getEmbedLanguages=function(){return-1!=zcal.ZCAL.indexOf(".baihui.com")?{zh:zcal.i18n.chines,en:zcal.i18n.english}:{en:zcal.i18n.english,da:zcal.i18n.danish,de:zcal.i18n.german,es:zcal.i18n.spanish,fr:zcal.i18n.french,hu:zcal.i18n.hungarian,it:zcal.i18n.italian,ja:zcal.i18n.japanes,nl:zcal.i18n.dutch,pl:zcal.i18n.polish,pt:zcal.i18n.portuguese,ru:zcal.i18n.russian,sv:zcal.i18n.swedish,tr:zcal.i18n.turkish,zh:zcal.i18n.chines}},embed=function(obj){this.template=obj&&obj.type||0,this.title=obj&&obj.title,this.defaultCal=obj&&obj.dcal,this.selectedCal=[],this.view=sizeObj[this.template].v,this.color=sizeObj[this.template].c,this.language=obj&&obj.lang||"en",this.width=sizeObj[this.template].w,this.height=sizeObj[this.template].h,this.timezone=obj&&obj.tz,this.showTitle=!0,this.showTimezone=!0,this.detailview=!1};embed.prototype={setTemplate:function(template){this.template=parseInt(template),this.view=sizeObj[this.template].v,this.color=sizeObj[this.template].c,this.width=sizeObj[this.template].w,this.height=sizeObj[this.template].h},setTitle:function(title){this.title=title},setCalendars:function(calKey){this.selectedCal=""!=calKey?calKey.split(","):[]},setView:function(view){this.view=parseInt(view)},setColor:function(color){this.color=parseInt(color)},setLanguage:function(language){this.language=language},setWidth:function(width){this.width=parseInt(width)},setHeight:function(height){this.height=parseInt(height)},setTimezone:function(timezone){this.timezone=timezone},setShowTitle:function(showTitle){this.showTitle=showTitle},setShowTimezone:function(showTimezone){this.showTimezone=showTimezone},setDetailview:function(detailview){this.detailview=detailview},getURL:function(){var _url='<iframe src="'+location.protocol+"//"+zcal.ZCAL+(""===calObj[14]||"gcal"===calObj[14]?"":"/"+calObj[14])+"/embed/"+this.defaultCal+"?";if(zcal.cdata.calLst[calId]){var noofCal=this.selectedCal.length,calStr="";if(0!=noofCal)for(var i=0;noofCal>i;i++)calStr+=(0==i?"":",")+this.selectedCal[i];_url+=""!=calStr?"cal="+calStr+"&":""}return _url+="title="+ZCL_getHTML(this.title).replace("&#39;",""),_url+="&type="+(this.template+1),_url+="&l="+this.language,_url+="&tz="+this.timezone,_url+="&shtitle="+(this.showTitle?1:0),_url+="&shtz="+(this.showTimezone?1:0),_url+="&shdv="+(this.detailview?1:0),_url+=-1!=this.color?"&c="+this.color:"",_url+=-1!=this.view?"&v="+this.view:"",_url+='" width="'+this.width+'" height="'+this.height+'" frameborder="0" scrolling="no"></iframe>'}};var constEmbed=function(){0==zcal.timezones.length&&ZCL_uXHR("/cal/timez.do",function(res){zcal.timezones=ZCL_Evl(1,res.responseText)}),_constImgSec(),_constTitleSec(),_constTZSec(),updateEmbedURL()},_constImgSec=function(){$embedTplImg&&$embedTplImg.html('<div><div class="zcl_emb'+(embedObj.template+1)+'"></div></div>')},_constTitleSec=function(){var $titleDOM,$calSelDOM,$colViewDOM,emStr;if($embedTitleSec){emStr='<div class="zmL">',emStr+='<div class="SC_srch shw">',emStr+='<table class="condition">',emStr+="<tbody><tr>",emStr+='<td class="gbld">'+zcal.i18n.title+"</td>",emStr+="</tr><tr>",emStr+='<td><div class="SC_select SC_selectnoneArw first"><input placeholder="Untitled"  class="SC_tiput"  value="'+ZCL_getHTML(embedObj.title)+'" type="text"></div></td>',emStr+="</tr></tbody>",emStr+="</table>",emStr+="</div>",emStr+="</div>",zcal.cdata.calLst[calId]&&(emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw">',emStr+='<table class="condition">',emStr+="<tbody><tr>",emStr+='<td class="gbld">'+zcal.i18n.select_calendar+'</td></tr><tr><td><select style="width:100%" size="4" multiple="multiple"/></td>',emStr+="</tr></tbody>",emStr+="</table>",emStr+="</div>",emStr+="</div>"),(-1!=embedObj.color||-1!=embedObj.view)&&(emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw">',emStr+='<table class="condition">',emStr+="<tbody>",emStr+='<tr><td class="gbld">'+(-1!=embedObj.view?zcal.i18n.chooseyourview:zcal.i18n.chooseacolor)+"</td></tr>",emStr+='<tr><td><table><tbody><tr><td><div class="SC_select first" data-marker="viewColorSel"><input type="text" id="color" class="disabled"  readonly value='+zcal.i18n.vday+"></div></td></tr></tbody></table></td></tr>",emStr+="</tbody>",emStr+="</table>",emStr+="</div>",emStr+="</div>"),$embedTitleSec.html(emStr),$titleDOM=$embedTitleSec.find("input.SC_tiput"),$titleDOM.off("change").on("change",function(){embedObj.setTitle(this.value),updateEmbedURL()}),$calSelDOM=$embedTitleSec.find("select");var calSelStr=_getCalSelOption();if($calSelDOM.html(calSelStr),$calSelDOM.off("click").on("click",function(){var $sel=$(this),selCal=[];$.each($sel.find("option:selected"),function(){var ckey=$(this).val();ckey!=embedObj.defaultCal&&selCal.push(ckey)}),embedObj.setCalendars(selCal.join(",")),updateEmbedURL()}),$colViewDOM=$embedTitleSec.find("[data-marker=viewColorSel]").removeAttr("data-marker")){if(-1!=embedObj.color){for(var colorArr=_getEmbedColors(),coArr=[],i=0;i<colorArr.length;i++){$("#color")[0].value=colorArr[embedObj.color];var obj={text:colorArr[i],value:i};coArr.push(obj)}$colViewDOM.on("click",function(ev){var that=ev.target;_showMenu({menuItems:coArr,par:this,parWidth:!0}).then(function(data){that.value=data.text,embedObj.setColor(data.value),updateEmbedURL(),zmUtil.hideMenu()})})}else if(-1!=embedObj.view){var viewArr=[{text:zcal.i18n.vday,value:0},{text:zcal.i18n.week,value:1},{text:zcal.i18n.month,value:2}];$colViewDOM.on("click",function(ev){var that=ev.target;_showMenu({menuItems:viewArr,par:this,parWidth:!0}).then(function(data){that.value=data.text,embedObj.setView(data.value),updateEmbedURL(),zmUtil.hideMenu()})})}}}},_constTZSec=function(){var $langDOM,$hgtDOM,emStr;if($embedTZSec){emStr='<div class="zmL">',emStr+='<div class="SC_srch shw">',emStr+='<table class="condition">',emStr+="<tbody>",emStr+='<tr><td class="gbld">'+zcal.i18n.language+"</td></tr>",emStr+='<tr><td><table><tbody><tr><td><div class="SC_select first" data-marker="languageSel"><input type="text" id="lan" class="disabled"  readonly value="English"></div></td></tr></tbody></table></td></tr>',emStr+="</tbody>",emStr+="</table>",emStr+="</div>",emStr+="</div>",emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw">',emStr+="<table>",emStr+="<tbody><tr>",emStr+='<td><table class="condition"><tbody><tr><td class="gbld">'+zcal.i18n.width+'</td></tr><tr><td><table><tbody><tr><td><div class="SC_select SC_selectnoneArw first"><input id="zcl_embedWdt" value="'+embedObj.width+'px" type="text"></div></td></tr></tbody></table></td></tr></tbody></table></td>',emStr+='<td><table class="condition"><tbody><tr><td class="gbld">'+zcal.i18n.height+'</td></tr><tr><td><table><tbody><tr><td><div class="SC_select SC_selectnoneArw"><input id="zcl_embedHgt" value="'+embedObj.height+'px" type="text"></div></td></tr></tbody></table></td></tr></tbody></table></td>',emStr+="</tr></tbody>",emStr+="</table>",emStr+="</div>",emStr+="</div>",emStr+='<div class="zmL">',emStr+='<div class="SC_srch shw">',emStr+='<table class="condition">',emStr+="<tbody>",emStr+="<tr><td><table><tbody><tr>",emStr+='<td><span class="mLnone mr20" id="zcl_embedShowTitle"><i  class="'+(embedObj.showTitle?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.title+"</span></span></td>",emStr+='<td><span class="mLnone" id="zcl_embedShowTz"><i  class="'+(embedObj.showTimezone?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.timezone+"</span></span></td>",emStr+="</tr></tbody></table></td></tr>",0==embedObj.template&&(emStr+='<tr><td><span class="mLnone" id="zcl_embedDview"><i class="'+(embedObj.detailview?"msi-check":"msi-uncheck")+'"></i><span class="pl5">'+zcal.i18n.detailsview+"</span></span></td></tr>"),emStr+="</tbody>",emStr+="</table>",emStr+="</div>",emStr+="</div>",$embedTZSec.html(emStr),$langDOM=$embedTZSec.find("[data-marker=languageSel]").removeAttr("data-marker");var langArr=_getEmbedLanguages(),lArr=[];for(var val in langArr){var obj={text:langArr[val],value:val};lArr.push(obj)}$langDOM.on("click",function(ev){var that=ev.target;_showMenu({menuItems:lArr,par:this,parWidth:!0}).then(function(data){that.value=data.text,embedObj.setLanguage(data.value),updateEmbedURL(),zmUtil.hideMenu()})}),$wdtDOM=$embedTZSec.find("#zcl_embedWdt"),$wdtDOM.off("change").on("change",function(){var wdt=this.value;""!=wdt&&(wdt=wdt.replace(/\D/g,""),embedObj.setWidth(wdt),updateEmbedURL())}),$hgtDOM=$embedTZSec.find("#zcl_embedHgt"),$hgtDOM.off("change").on("change",function(){var hgt=this.value;""!=hgt&&(hgt=hgt.replace(/\D/g,""),embedObj.setHeight(hgt),updateEmbedURL())});var $showTitDOM=$embedTZSec.find("#zcl_embedShowTitle");$showTitDOM.off("click").on("click",function(){var css,$chkbox,val,$ele=$(this);$chkbox=$ele.find("i"),css=$chkbox.hasClass("msi-check")?"msi-uncheck":"msi-check",val="msi-check"===css?!0:!1,$chkbox.attr("class",css),embedObj.setShowTitle(val),updateEmbedURL()});var $showTzDOM=$embedTZSec.find("#zcl_embedShowTz");$showTzDOM.off("click").on("click",function(){var css,$chkbox,val,$ele=$(this);$chkbox=$ele.find("i"),css=$chkbox.hasClass("msi-check")?"msi-uncheck":"msi-check",val="msi-check"===css?!0:!1,$chkbox.attr("class",css),embedObj.setShowTimezone(val),updateEmbedURL()});var $dviewDOM=$embedTZSec.find("#zcl_embedDview");$dviewDOM.off("click").on("click",function(){var css,$chkbox,val,$ele=$(this);$chkbox=$ele.find("i"),css=$chkbox.hasClass("msi-check")?"msi-uncheck":"msi-check",val="msi-check"===css?!0:!1,$chkbox.attr("class",css),embedObj.setDetailview(val),updateEmbedURL()})}},setAllTZ=function(){var tzStr="<select>";for(var i in zcal.timezones)for(var j in zcal.timezones[i]){var s=zcal.cdata.opt.TIM==j?"selected":"";tzStr+="<option "+s+" value="+j+">"+unescape(zcal.timezones[i][j])+" ("+j+")</option>"}tzStr+="</select>",$("#zcl_embedTZ").html(tzStr);var $tzDOM=$embedTZSec.find("#zcl_embedTZ select");$tzDOM.off("change").on("change",function(){embedObj.setTimezone(this.value),updateEmbedURL()})},setTZ=function(){var tzStr1='<input value="'+unescape(zcal.cdata.opt.CTIM)+'" type="text"  rel='+zcal.cdata.opt.TIM+' readonly="" id="zcl_emTZ">';return tzStr1},_getCalSelOption=function(){var calOrder=zcal.cdata.calOrdArr,calStr="";return calOrder.forEach(function(id){var calLst=zcal.cdata.calLst,sel=calLst[id][9]==embedObj.defaultCal||-1!=embedObj.selectedCal.indexOf(calLst[id][9])?"selected":"";calStr+='<option value="'+calLst[id][9]+'" '+sel+">"+ZCL_getHTML(calLst[id][0])+"</option>"}),calStr},_showCalEmbed=function(id,cObj){calId=id,calObj=cObj,embedObj=new embed({title:calObj[0],dcal:calObj[9],tz:zcal.cdata.opt.TIM,lang:zcal.cdata.opt.LANG});var $tmpEle,tmpStr="";$embedPaneWrapper=$('<div id="calembed" class="SC_Twpr zcl_Twpr" style="top:46px"><div class="SC_filt_bottom SC_filt_bottomCustom" id="SC_embed"></div>');var $embed='<div class="editFilterParent zcl_stfrm">';$embed+='<div class="zcl_Semdtmp" data-marker="embedTpl">',$embed+="</div>",$embed+='<div class="conditionDiv">',$embed+='<table class="zcl_Semdsp">',$embed+="<tbody>",$embed+="<tr>",$embed+='<td data-marker="embedTplImg"></td>',$embed+='<td><div data-marker="embedTitleSec"></div></td>',$embed+='<td><div data-marker="embedTZSec"></div></td>',$embed+="</tr>",$embed+="</tbody>",$embed+="</table>",$embed+="</div>",$embed+='<div class="zmL">',$embed+='<div class="SC_srch shw">',$embed+='<table class="condition">',$embed+='<tbody><tr><td class="gbld">'+zcal.i18n.timezone+'</td></tr><tr><td><table><tbody><tr><td><div style="width: 380px!important" class="SC_select first" id="zcl_embedTZ">'+setTZ()+"</div></td></tr></tbody></table></td></tr></tbody>",$embed+="</table>",$embed+="</div>",$embed+="</div>",$embed+='<div class="zmL">',$embed+='<div class="SC_srch shw">',$embed+='<table class="condition">',$embed+="<tbody>",$embed+='<tr><td class="gbld">'+zcal.i18n.embed_instruction+"</td></tr>",$embed+='<tr><td><table class="zcl_w100pc">',$embed+='<tbody><tr><td data-marker="embedCode"></td></tr></tbody>',$embed+="</table></td></tr>",$embed+="</tbody>",$embed+="</table>",$embed+="</div>",$embed+="</div>",$embed+='<div class="SC_PUbtm">',$embed+='<span class="sel" id="pre">'+zcal.i18n.preview+"</span>",$embed+='<span data-val="Cancel" id="ref">'+zcal.i18n.refresh+"</span>",$embed+="</div>",$embed+="</div>",$embedPaneWrapper.find("#SC_embed").append($embed),$tmpEle=$embedPaneWrapper.find("[data-marker=embedTpl]").removeAttr("data-marker");for(var i=0;10>i;i++)tmpStr+="<span "+(i==embedObj.template?'class="zcl_sl"':"")+">"+(i+1)+"</span>";$tmpEle.html(tmpStr),$tmpEle.find("span").off("click").on("click",function(){var $ele=$(this);$ele.parent().find("span").removeClass("zcl_sl"),$ele.addClass("zcl_sl"),embedObj.setTemplate($ele.index()),constEmbed()}),$embedPaneWrapper.find("#zcl_emTZ").on("click",function(){var tzArr=zcal.timezones,tArr=[];for(var i in tzArr)for(var j in tzArr[i]){var obj={};obj.id=j,obj.name=tzArr[i][j]+" ("+j+")",obj.display_text=tzArr[i][j]+" ("+j+")",tArr.push(obj)}var component,config={},that=$(this);config.parentDOM=that.parent(),config.displayAs="dropdown",config.parWidth=!0,config.onSelect=function(id,selectObj){setGroupValue(that,id,selectObj),component.hide()},config.dataCallback=function(){return tArr},component=zmUtil.createFLComp("generic",config),component.show()});var setGroupValue=function($ele,id,selectObj){$ele.val(selectObj.display_text),$ele.attr("rel",id),embedObj.setTimezone(id),updateEmbedURL()},$showTzDOM=$embedPaneWrapper.find("#zcl_embedShowTz");return $showTzDOM.off("click").on("click",function(){var css,$chkbox,val,$ele=$(this);$chkbox=$ele.find("i"),css=$chkbox.hasClass("msi-check")?"msi-uncheck":"msi-check",val="msi-check"===css?!0:!1,$chkbox.attr("class",css),embedObj.setShowTimezone(val),updateEmbedURL()}),$embedPaneWrapper.find("#pre").on("click",function(){var txt,previewWindow=window.open();previewWindow.document.open(),txt=embedObj.getURL().replace(/&lt;/gi,"<").replace(/&gt;/gi,">"),previewWindow.document.write("<html><body>"+txt+"</body></html>"),previewWindow.document.close()}),$embedPaneWrapper.find("#ref").on("click",function(){embedObj=new embed({title:calObj[0],dcal:calObj[9],tz:zcal.cdata.opt.TIM,lang:zcal.cdata.opt.LANG,type:embedObj.template}),constEmbed()}),$embedTplImg=$embedPaneWrapper.find("[data-marker=embedTplImg]").removeAttr("data-marker"),$embedTitleSec=$embedPaneWrapper.find("[data-marker=embedTitleSec]").removeAttr("data-marker"),$embedTZSec=$embedPaneWrapper.find("[data-marker=embedTZSec]").removeAttr("data-marker"),$embedCode=$embedPaneWrapper.find("[data-marker=embedCode]").removeAttr("data-marker"),constEmbed(),$embedPaneWrapper},_showMenu=function(obj){var menus=[],menuItems=obj.menuItems||[];menuItems.forEach(function(menuItem){var value=menuItem.value,text=menuItem.text;menus.push({htm:"<div>"+text+"</div>",data:{value:value,text:text}})});var deferred=$.Deferred();return obj.list=menus,obj.clk=function(data,element,event){deferred.resolve(data,element,event)},obj.onHide=function(){deferred.reject()},menus.length?zmsuite.showMenu(obj):deferred.reject(),deferred.fail(zmUtil.hideMenu),deferred.promise()},updateEmbedURL=function(){$embedCode&&$embedCode.html('<textarea class="zcl_Stxt">'+embedObj.getURL()+"</textarea>")};return calembedView.render=_showCalEmbed,calembedView.showAllTimezone=setAllTZ,calembedView}(zcalEmbedView||{});_defineSettingsModule("MGAOCalendars",function(exports,require){"use strict";var App,Components=require("Platform.Components"),SettingAppManager=Components.SettingAppManager,SystemUtils=require("Platform.System.Utils"),APP_ID="calendar-mgaocalendars",PAGE_ID="calendar-mgaocalendars",MGAOCalendarsView="MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView",_mgaocalendarsview=function(){return require(MGAOCalendarsView)},loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},_initializeApp=function(){{var progress=SystemUtils.makeDeferred();$.Deferred()}return"undefined"==typeof zcal?loadCalendarData().done(function(){_mgaocalendarsview().initialize({process:progress})}).fail(progress.reject):_mgaocalendarsview().initialize({process:progress}),progress.promise()},_uninitializeApp=function(){var progress=SystemUtils.makeDeferred();return _mgaocalendarsview.uninitialize({process:progress}),progress.promise()},_getAppView=function(){var MGAOCalendarsView=_mgaocalendarsview();return MGAOCalendarsView.getMGAOCalendarsView()},_handleContainerEvent=function(){return null},_createApp=function(){App=SettingAppManager.create(APP_ID,{attributes:{page:PAGE_ID,isReactApp:!1},initialize:_initializeApp,uninitialize:_uninitializeApp,getView:_getAppView,handleContainerEvent:_handleContainerEvent})},initialize=function(){_createApp(),exports.App=App};initialize()},"MailSuite.Apps"),function(require){"use strict";{var CARD_ID="calendar-mgaocalendars",PAGE_ID="calendar-mgaocalendars",CARD_ITEMS={MY_CALENDARS:"my-calendars",GROUP_CALENDARS:"group-calendars",APP_CALENDARS:"app-calendars",OTHER_CALENDARS:"other-calendars"},I18N={mycalendars:{cardItem:{title:"My Calendars"}},groupcalendars:{cardItem:{title:"Group Calendars"}},appcalendars:{cardItem:{title:"App. Calendars"}},othercalendars:{cardItem:{title:"Other Calendars"}}},PlatformComponents=require("Platform.Components"),PlatformEntities=require("Platform.Entities"),SettingCardItemManager=(require("MailSuite.Settings.Calendar"),require("Platform.System.Utils"),PlatformComponents.SettingCardItemManager),SettingCardItem=PlatformEntities.SettingCardItem,CardItemTypes=SettingCardItem.Types;SettingCardItemManager.create(CARD_ITEMS.MY_CALENDARS,{props:{title:I18N.mycalendars.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zCal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;zCal.getMGAOCalendarsView()}).fail(function(){})})}}),SettingCardItemManager.create(CARD_ITEMS.GROUP_CALENDARS,{props:{title:I18N.groupcalendars.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zCal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;zCal.groupCalendarView()}).fail(function(){})})}}),SettingCardItemManager.create(CARD_ITEMS.APP_CALENDARS,{props:{title:I18N.appcalendars.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zCal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;zCal.appCalendarView()}).fail(function(){})})}}),SettingCardItemManager.create(CARD_ITEMS.OTHER_CALENDARS,{props:{title:I18N.othercalendars.cardItem.title},attributes:{type:CardItemTypes.Action,card:CARD_ID},primaryAction:function(){zmail.Settings.MailSuite.App.openApp().done(function(){var AppFramework=zmail.Settings.MailSuite.App.Core.Framework;AppFramework.requestShowPage(PAGE_ID).done(function(){var zCal=zmail.Settings.MailSuite.Apps.CalendarMGAOCalendars.MGAOCalendarsView;zCal.otherCalendarView()}).fail(function(){})})}})}}(zmail.Settings.Modules.import),_defineSettingsModule("ZCAL_Setinit",function(){"use strict";var loadCalendarData=function(){var deferred=$.Deferred();return zmApp.loadCalendar("/calendar/settings",deferred),deferred.promise()},initialize=function(){var progress=$.Deferred();return $.subscribe("/zm-settings/mailsuite-app/opened",function(){loadCalendarData().done(function(){{var AIarr=[zcal.i18n.allow,zcal.i18n.dontallow,zcal.i18n.allowiffree],REMarr=[zcal.i18n.off,zcal.i18n.on],SettingCardItemManager=zmail.Settings.Platform.Components.SettingCardItemManager,SettingCardManager=zmail.Settings.Platform.Components.SettingCardManager,CategoryManager=zmail.Settings.Platform.Components.CategoryManager,SettingPageManager=zmail.Settings.Platform.Components.SettingPageManager;CategoryManager.get("calendar").setProp("title",zcal.i18n.calendar),SettingCardManager.get("calendar-generals").setProp("title",zcal.i18n.calendarpreferences),SettingCardManager.get("email-notify").setProp("title",zcal.i18n.emailnotification),SettingCardManager.get("calendar-import").setProp("title",zcal.i18n.import),SettingCardManager.get("calendar-subscribe").setProp("title",zcal.i18n.subscribe),SettingCardManager.get("calendar-sync").setProp("title",zcal.i18n.synchronize)}if(!zmail.isRebranded){{SettingCardManager.get("calendar-zohoapp").setProp("title",ZCL_replaceComName(zcal.i18n.zohoapps)),SettingPageManager.get("calendar-zohoapp").setProp("title",ZCL_replaceComName(zcal.i18n.zohoapps)),SettingCardItemManager.get("zoho-crm").setProp("title",ZCL_replaceComName(zcal.i18n.zohocrm))}if(!zmail.isFuji){SettingCardItemManager.get("zoho-recruit").setProp("title",ZCL_replaceComName(zcal.i18n.zohorecruit))}{SettingCardItemManager.get("zoho-task").setProp("title",ZCL_replaceComName(zcal.i18n.zohotask)),SettingCardItemManager.get("zoho-projects").setProp("title",ZCL_replaceComName(zcal.i18n.zohoprojects)),SettingCardItemManager.get("zoho-contacts").setProp("title",ZCL_replaceComName(zcal.i18n.zohocontacts))}}SettingCardManager.get("calendar-mgaocalendars").setProp("title",zcal.i18n.calendars),SettingPageManager.get("calendar-generals").setProp("title",zcal.i18n.calendarpreferences),SettingPageManager.get("email-notify").setProp("title",zcal.i18n.emailnotification),SettingPageManager.get("calendar-import").setProp("title",zcal.i18n.import),SettingPageManager.get("calendar-subscribe").setProp("title",zcal.i18n.subscribe),SettingPageManager.get("calendar-sync").setProp("title",zcal.i18n.synchronize),SettingCardItemManager.get("time-zone").setProp("title",zcal.i18n.timezone),SettingCardItemManager.get("date-format").setProp("title",zcal.i18n.dateformat),SettingCardItemManager.get("time-format").setProp("title",zcal.i18n.timeformat),SettingCardItemManager.get("default-view").setProp("title",zcal.i18n.defaultview),SettingCardItemManager.get("automatic-invi").setProp("title",zcal.i18n.automatic_inv),SettingCardItemManager.get("reminder-notifi").setProp("title",zcal.i18n.reminder_notification),SettingCardItemManager.get("email-address").setProp("title",zcal.i18n.emailaddress),SettingCardItemManager.get("agenda-notify").setProp("title",zcal.i18n.agendanotification),SettingCardItemManager.get("by-file").setProp("title",zcal.i18n.file),SettingCardItemManager.get("by-url").setProp("title",zcal.i18n.url),SettingCardItemManager.get("web-url").setProp("title",zcal.i18n.weburl),SettingCardItemManager.get("friends-calendar").setProp("title",zcal.i18n.friendscalendar),SettingCardItemManager.get("holi-day").setProp("title",zcal.i18n.holiday),SettingCardItemManager.get("groups").setProp("title",zcal.i18n.groups);if(!zmail.isFuji&&!zmail.isBaihui&&-1==document.domain.indexOf("zoho.in")){SettingCardItemManager.get("microsoft-outlook").setProp("title",zcal.i18n.outlook)}if(!zmail.isFuji&&!zmail.isBaihui){SettingCardItemManager.get("zoho-calsync").setProp("title",ZCL_replaceComName(zcal.i18n.zcalsync))}if(!zmail.isBaihui){SettingCardItemManager.get("google-calendar").setProp("title",zcal.i18n.gcal)}SettingCardItemManager.get("cal-dav").setProp("title",zcal.i18n.caldav),SettingCardItemManager.get("my-calendars").setProp("title",zcal.i18n.mycalendars),SettingCardItemManager.get("group-calendars").setProp("title",zcal.i18n.groupcalendars),SettingCardItemManager.get("app-calendars").setProp("title",zcal.i18n.appcalendars),SettingCardItemManager.get("other-calendars").setProp("title",zcal.i18n.othercalendars),SettingCardItemManager.get("time-zone").setProp("value",zcal.cdata.opt.TIM),SettingCardItemManager.get("date-format").setProp("value",zcal.DATEFORMAT[zcal.cdata.opt.DF]),SettingCardItemManager.get("time-format").setProp("value",zcal.TIMEFORMAT[zcal.cdata.opt.TF]),SettingCardItemManager.get("default-view").setProp("value",zcal.DEFAULTVIEW[zcal.cdata.opt.DEF]),SettingCardItemManager.get("automatic-invi").setProp("value",AIarr[zcal.cdata.opt.SIE]),SettingCardItemManager.get("reminder-notifi").setProp("value",REMarr[zcal.cdata.opt.REM]);if("undefined"==typeof zcal.cdata.opt.CMAIL){SettingCardItemManager.get("email-address").setProp("value",zcal.cdata.opt.MTO)}else{SettingCardItemManager.get("email-address").setProp("value",zcal.cdata.opt.CMAIL)}SettingCardItemManager.get("agenda-notify").setProp("value",zcal.AGENDA_INTERVAL[zcal.cdata.opt.AI]);progress.resolve()}).fail(function(){SystemUtils.debugLog("Module load failed !!!"),progress.reject()})}),progress.promise()};initialize()},"MailSuite.Apps.ZCAL_Setinit");
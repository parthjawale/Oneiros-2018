"use strict";define([],function(a){var b=a("zmail").leftOrder||[],c=a("zmail.Core.Namespaces").create("ZMLeft.ZMLayerReOrder"),d=zmail.Utils.DOM,e=function(){function c(a){babelHelpers.classCallCheck(this,c),a=a||{},this.__instance=a.__instance,this.$el=d.element(a.$el),this.$dragHelper=this.getDragHelperDom(),this.$dragHelper.hide(),this.layerStateInfo=this.layerStateInfo||{},this.selector=a.selector||{left:".SClm",header:".SC_ltl",list:".SC_ldt",layer:".SC_lbx"}}return babelHelpers.createClass(c,[{key:"restoreLayers",value:function(){var a=this.__instance,b=this.selector.list;this.$dragHelper.hide(),this.$dragHelper.remove(),this.$el.removeClass("zmTreeOrderOn"),this.draggedLayerId&&this.$el.find("#"+this.draggedLayerId).find(this.selector.header).show(),a.layerArr.forEach(function(c){"object"===("undefined"==typeof c?"undefined":babelHelpers["typeof"](c))&&c.isLayerExpanded&&c.isLayerExpanded()&&a.el.find("#"+c.id).find(b).show()}),this.layerStateInfo={},this.draggedLayerId=""}},{key:"getDragHelperDom",value:function(){return d.element(zdom("div",{className:"zmDragHelper"}))}},{key:"setStateInfo",value:function(){var a=this;this.$el.find(a.selector.list).each(function(b){var c=d.element(this).closest(a.selector.layer).attr("id");c&&(a.layerStateInfo[c]=a.layerStateInfo[c]||d.element(this).is(":visible"))})}},{key:"dragStartHandler",value:function(){var a=this;return function(b){a.draggedLayerId=a.curId=d.element(b.currentTarget).closest(a.selector.layer).attr("id")||a.draggedLayerId,b.originalEvent.effectAllowed="move",b.originalEvent.dataTransfer.setData("draggedLayerId",a.draggedLayerId),setTimeout(function(){a.setStateInfo(),a.$el.find(a.selector.list).hide(),a.$el.addClass("zmTreeOrderOn"),d.element(document.body).has(a.$dragHelper).length||a.bindDragNDropEvents(!0),a.$el.find("#"+a.draggedLayerId).find(a.selector.header).hide(),d.mountAfter(a.$dragHelper,a.$el.find("#"+a.draggedLayerId)),a.$dragHelper.show(),a.layerPositionToDragHelper=a.draggedLayerId})}}},{key:"dragLeaveHandler",value:function(){return function(a){return!0}}},{key:"dragEnterHandler",value:function(){return function(a){return!0}}},{key:"dragOverHandler",value:function(){var a=this;return function(b){if(b.preventDefault(),a.draggedLayerId){var c=d.element(this).closest(a.selector.layer);c[0]?a.curId=c.attr("id")||a.curId:c=d.selector("#"+a.curId);var e=c[0].getBoundingClientRect();a.direction=e.top+e.height/2>b.originalEvent.y?"before":"after","before"===a.direction&&a.curId!==a.draggedLayerId?d.mountBefore(a.$dragHelper,a.$el.find("#"+a.curId)):a.$el.find("#"+a.curId).next().attr("id")===a.draggedLayerId?d.mountAfter(a.$dragHelper,a.$el.find("#"+a.draggedLayerId)):d.mountAfter(a.$dragHelper,a.$el.find("#"+a.curId)),a.$dragHelper.show()}return!1}}},{key:"dragEndHandler",value:function(){var a=this;return function(b){a.layerPositionToDragHelper="",a.restoreLayers()}}},{key:"dropHandler",value:function(){var c=this,e=c.__instance.layerArr;return function(f){if(c.draggedLayerId){if(c.curId=d.element(this).closest(c.selector.layer).attr("id")||c.curId,c.curId&&c.curId!==c.draggedLayerId){var g=b.indexOf(c.curId),h=b.indexOf(c.draggedLayerId);b.splice(g,0,b.splice(h,1)[0]);var i=e.splice(h,1)[0];i&&e.splice(g,0,i),a("zmAdHocSettings").setLeftOrder(b.join(",")),"after"===c.direction?d.mountAfter(d.selector("#"+c.draggedLayerId),d.selector("#"+c.curId)):d.mountBefore(d.selector("#"+c.draggedLayerId),d.selector("#"+c.curId)),c.layerPositionToDragHelper=""}c.restoreLayers()}return!1}}},{key:"getEvents",value:function(){return[{name:"dragstart",handler:this.dragStartHandler()},{name:"dragover",handler:this.dragOverHandler()},{name:"dragend",handler:this.dragEndHandler()},{name:"drop",handler:this.dropHandler()}]}},{key:"bindDragNDropEvents",value:function(a){var b=this.$el,c=this.$dragHelper,d=this.$el.find(this.selector.header);d.attr("draggable","true"),this.getEvents().forEach(function(e){a?c.off(e.name).on(e.name,e.handler):(d.off(e.name).on(e.name,e.handler),c.off(e.name).on(e.name,e.handler),b.off(e.name).on(e.name,e.handler))})}},{key:"unbindDragNDropEvents",value:function(){var a=this.$el,b=this.$dragHelper,c=this.$el.find(this.selector.header);c.removeAttr("draggable"),this.getEvents().forEach(function(d){c.off(d.name),b.off(d.name),a.off(d.name)})}}]),c}(),f=function(a){a=a||{};var b=new e(a);return b.bindDragNDropEvents(),b};return c.init=f,c});
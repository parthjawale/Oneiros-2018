"use strict";define([],function(a){var b,c,d,e,f,g,h,i=a("zmText"),j=a("zmTask"),k=a("zmUtil"),l=a("zmAppLoader"),m=a("zmCenterListing"),n=a("zmsDialog"),o=a("zmTaskRestore"),p=a("zmComponent"),q=a("zmAutoFill"),r=a("zmTab"),s=a("zmMention"),t=a("zmsTemplates"),u=j.template,v=i.get("taskUtil"),w=500,x=!0,y={},z={},A=!1,B={printSelectList:[],selectedTask:{},pWinCount:0,printListLimit:100,model:{imperror:v.errorMsg.impfile},getUniqueWindowName:function(){return B.pWinCount++,"zmtask"+B.pWinCount+"_blank"},getPrintDOM:function(){var a=$("#"+zmsuite.getLeft().selId).find("span.zmTreTxt").text(),b=$(u.getTaskListPrintHeader(a));return p.loadingBand({container:b[0],type:"pagination"}),b},generateTaskListPrintTemp:function(){var c=window.open("",B.getUniqueWindowName(),"status=yes,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=yes,titlebar=yes");c&&c.opener&&(c.opener=void 0);var f=a("zmAjq"),g=$("<div/>");g.append(u.getTaskListPrintFooter()),g.append(B.getPrintDOM()),zmail.Printer.print({printWindow:c,title:v.common.printTaskList,content:g[0],js:["task/taskprint.js"]});var h={};h.groupObj=e,h.projObj=d,h.zmail=zmail;var i=zmail.ContactBook.getActiveOrg();if(h.orgContacts=[],$.each(i,function(a,b){var c=b.attrs;h.orgContacts[c.zid]=c}),h.printListLimit=B.printListLimit,B.printSelectList.length){var j={},k=b;j.order=B.printSelectList,j.list=y.listObj,h.selectList=j,h.ep={taction:k.taction}}else h.zmcsr=f.getCookie("zmcsr"),h.sendParam=B.getSelectedListingParams({limit:B.printListLimit,printTask:!0},{});c.prms=h},getSelectedListingParams:function(a,c){var d=zmsuite.getLeft().selId,e=zmsuite.getLeft().selLayerId,f={actionType:"appView",isPrev:!1,streamsView:!0,entityType:3};$.extend(a,f);var g=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer(e),h=g.getRowObj(d),i=b;if(A)$.extend(a,i),$.extend(c,i);else if(h){var k=h[d];a.taction=c.taction=k.type,a.groupId=c.groupId=zmail.zuid,c.headerObj=c.headerObj?c.headerObj:{},"getTasksByDueDate"===k.type?a.mode=c.mode=k.mode:"getGroupTasks"===k.type?(a.groupId=c.groupId=d,c.headerObj.showGroupDropdown=c.headerObj.showMemberCount=!0,c.enableQuickTask=!j.Util.isDisabledGroup(c.groupId)):"getTasksByCategory"===k.type?(a.groupId=c.groupId=k.p,a.categoryId=c.categoryId=d,c.headerObj.showGroupDropdown=c.headerObj.showMemberCount=!0,c.enableQuickTask=!j.Util.isDisabledGroup(c.groupId)):"zmllabelH"===e?(a.taction=c.taction="getTasksByLabel",a.labelId=c.labelId=d):"getMyTasks"===k.type?c.headerObj.showGroupDropdown=c.enableQuickTask=!0:"getPersonalTasks"===k.type&&d!==zmail.zuid&&(a.categoryId=c.categoryId=d)}return{param:a,eprm:c}},isGroup:function(a){return!!j.Util.Groups(a)},isPermitted:function(a,b){if(j.Util.isDisabledGroup(a.NMSPID))return!1;if("delete"===b){if(a.OWNERID===zmail.zuid||B.isGroup(a.NMSPID)&&j.Util.isGroupOwner(a.NMSPID))return!0}else if("complete"===b){if(a.OWNERID===zmail.zuid||a.ATTENDEEIDS===zmail.zuid||a.ISSUBTASK&&a.PARENTTASK.ATTENDEEIDS===zmail.zuid)return!0}else if("addsub"===b){if(!a.ISSUBTASK&&!j.Util.isPrivateTask(a.NMSPID))return!0}else if("changeCategory"===b&&(a.assignee===zmail.zuid||a.owner===zmail.zuid))return!0;return!1},singleListObj:function(a,b){b.entityId=a.tasks.id,b.summary=a.cntnt.summary,b.title=a.cntnt.title,b.priority=a.tasks.priority,b.assignee=a.tasks.attendees,b.newformat=a.tasks.newformat,b.subtaskCount=a.tasks.subtask?a.tasks.subtask.length:0,b.subtaskIds=[],b.subtasks=[];for(var c=0;c<b.subtaskCount;c++)b.subtaskIds.push(a.tasks.subtask[c].tasks.id),b.subtasks.push(this.singleListObj(a.tasks.subtask[c],{pTaskId:b.entityId,groupId:b.groupId}));return b.email=a.tasks.email,this.generateListObj(b)},generateListObj:function(a){var b={};return b.SUMMARY=a.summary,b.DUEDATE=a.dueDate&&"-1"!==a.dueDate?a.dueDate:"-",b.ATTENDEEIDS=a.assignee||(a.groupId!==zmail.zuid?"-1":""),b.PRIORITY=a.priority,b.NMSPID=a.groupId,b.STATUS=a.status?a.status:2,b.CATID=a.categoryId||a.cid||"",b.OWNERID=zmail.zuid,b.TASKID=a.entityId,b.TITLE=a.title,b.REMINDERDATE=a.reminderDate?a.reminderDate:"-",a.pTaskId&&(b.PARENTTASK={},b.PARENTTASK.TASKID=a.pTaskId),b.newformat=a.newformat,b.email=$.isEmptyObject(a.email)?void 0:a.email,a.pTaskId&&"-1"!==a.pTaskId||(b.SUBTASKIDS=a.subtaskIds||[],b.SUBTASKCOUNT=a.subtaskCount||0,b.SUBTASKS=a.subtasks||[]),b},iscurrentView:function(a,c){return c=c||b,a.labelId===c.labelId&&"getTasksByLabel"===c.taction||(String(a.groupId)===String(c.groupId)&&"tag"!==a.mode&&("getGroupTasks"===c.taction||"getPersonalTasks"===c.taction)||(!(!a.categoryId||a.categoryId!==c.categoryId)||(a.assignee===zmail.zuid&&"getMyTasks"===c.taction||a.groupId===zmail.zuid&&"tag"!==a.mode&&"getTasksByMe"===c.taction)))},extendListing:function(a,b){return $.each(b,function(c,d){a[c]?$.extend(a[c],b[c]):a[c]=b[c]}),a},doLabelAction:function(a,b){var c,d=y;if(b.pTaskId){var e=d._centerObj[b.groupId][b.pTaskId]||d._centerObj[b.groupId][b.entityId];c=e.sublistingObj?e.sublistingObj[b.groupId][b.entityId]:e}else c=d._centerObj[b.groupId][b.entityId];var f=c.listObj.TAGS;if("addLabel"===b.actionType){var g=$("#"+b.entityId).find(".zm_lbl"),h=g.find(".zmLblGrp");if(h.length>0){var i=t.constructTagListHTML([b.labelId],!1,4,"default");h.append(i)}else{var j=t.constructTagListHTML([b.labelId],!1,4,"default",{constructOuterDiv:!0});g.append(j)}c.listObj.TAGS.push(b.labelId)}else{var k=$("#"+b.entityId+" div.zmLblGrp");k.find("[data-mid='"+b.labelId+"']").remove(),0===k.find("[data-mid]").length&&k.remove(),f.splice(f.indexOf(b.labelId),1)}$.publish("/zm/task/"+b.actionType,[a,b])},hideMenu:function(){$("#zmCntxtMenu").remove(),$("#zm_dropDown").remove(),zmsuite.getCenterOuter().$el.find(".SC_ddn").removeClass("SC_ddn"),B.selectedTask={},B.printSelectList.length=0},closePreview:function(){var a=zmsuite.getCenter();a[1].close(),a[0].$el.find(".zmL").removeClass("zmSLst")},toggleGroup:function(a,b){var c=zmsuite.getLeft().getNodes()[0].getLayer("groups"),d=c.getChildObject()[a];if(d)if("show"===b){var e=$("#"+a);c.showChild(e.find(".msi-rarrow"),a,e)}else c.hideChild($("#"+a).find(".msi-rarrow"),a)},getCenterObj:function(a,b){var c,d=a||0;b=b||"zm_task";try{c="Search"===r.getTabObject().appname?f?1===d?f.preview.getNodes():f.listing.getNodes():zmsuite.getCenter()[d].getNodes():zmsuite.getCenter(b)[d].getNodes()}catch(e){c=zmsuite.getCenter()[0].getNodes()}return c},loadingDiv:function(a,b){b=b?b:B.getCenterObj()[2].$el[0],c=p.loadingBand({container:b,type:a})},list:function(){var a={list:{left:{chkBox:!1,leftHTML:"Task"},right:[]},clk:function(){}};return a},getSelectedListingInfo:function(){var a=zmsuite.getLeft().selId,b=zmsuite.getLeft().selLayerId,c=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer(b),d=c?c.getRowObj(a):void 0,e={};if(d){var f=d[a];e.taction=f.type,e.mode="tome"===f.mode?"mytasks":f.mode,e.name=f.name,"zmllabelH"===b&&(e.taction="getTasksByLabel")}return e},imTask:function(a){var c={},d={};c.groupId=b.groupId,c.actionType="addEntity",c.entityType="3",c.taction="importTask",c.fP=a.fP,c.sN=a.sN,B.hideMenu(),j.Util.Req.addEditTask(c,d,function(a){k.succErrMsg("s",a.msg)})},updateFilterURL:function(a){A=!0;var b=zmsuite.getLeft(),c=b.selLayerId,d=b.selId,e=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer(c);if(e){var f=e.getRowObj(d)[d],g=zmsuite.getAppRouter("zm_task"),h=[];if("getMyTasks"===f.type?h.push("views","tome"):"getTasksByMe"===f.type?h.push("views","byme"):"getGroupTasks"===f.type?h.push(d):"getTasksByCategory"===f.type?h.push(f.p,"category",d):"getPersonalTasks"===f.type&&h.push("mytask"),a&&a.indexOf("t")!==-1){var i=g._hashParams;return i.push.apply(i,a),void g.update()}a&&h.push.apply(h,a),g.setParams(h),g.update()}}};return h=function(a,c,d){var e=function(){this.listObj=a,this.listInfo=c,this.type=d,this.subtaskloaded=!1,this.constructor(),this.subscribeme()};return e.prototype={constructor:function(){this.listingEl=this.getRowHTML(this.listObj)},getRowHTML:function(a){var c,d,e=this.type||"task";if("-"!==a.DUEDATE&&this.listInfo&&this.listInfo.showDateColour){var f=new Date,g=new Date(f.getFullYear(),f.getMonth(),f.getDate()),h=new Date(Number(a.DUEDATEINMILLISECONDS)),i=new Date(h.getFullYear(),h.getMonth(),h.getDate());i<g?c="SC_red":"Today"===a.DUEDATE&&(c="SC_green")}if(a&&a.TAGS){var k;k="string"==typeof a.TAGS?JSON.parse(a.TAGS):a.TAGS,a.TAGS=k}var l={id:"TASKID",showcomplete:"showcomplete",pri:"PRIORITY",count:"SUBTASKCOUNT",date:"DUEDATE",status:"STATUS",from:"TITLESUMMARY",sub:"SUB",subicon:"showsub",issubtask:"ISSUBTASK",tagLst:"TAGS",dateColor:"dateColor",comment:"comment",assignee:"assignee"},n={pri:{5:"SC_blue",4:"SC_blue",2:"SC_red",1:"SC_red"},att:{1:"zm_atch"},status:{3:"SC_Sthro"}},o=m.create({type:e,mapObj:l,classObj:n}),p=this.listInfo||b;a=this.listObj||a,"-"===a.DUEDATE&&(a.DUEDATE="");var q="";a.PARENTTASK&&a.PARENTTASK.TASKID&&(a.ISSUBTASK=!0),d=a.SUMMARY.trim()?zdom("span",null,j.Util.unescapeSpecialChar(a.TITLE),zdom("span",{className:"sum"})):zdom("span",null," ",j.Util.unescapeSpecialChar(a.TITLE)," "),a.TITLESUMMARY=d;var r,s="",t="",u="",w=zdom("div",null),x=zdom("div",null),y="",z="",A="";if(a.NMSPID!==zmail.zuid?("-1"!==a.ATTENDEEIDS?(r=j.Util.getContact(a.ATTENDEEIDS),s=r?r.get("fn"):""):j.Util.isDisabledGroup(a.NMSPID)||(s=zdom("span",{className:"SC_cs SC_np SC_assignee ztUAss"},zdom("span",{className:"assigneeName",contentEditable:"true",placeHolder:v.common.assignPlaceHolder}))),a.CATID&&(z=j.Util.getProjectName(a.NMSPID,a.CATID),""!==z&&(t=zdom("span",null,z))),j.Util.Groups(a.NMSPID)&&(u=zdom("span",null,j.Util.getGroupName(a.NMSPID))),"getGroupTasks"===p.taction?(t&&(w.appendChild(t),A="SC_ldot"),"string"==typeof s?(y=zdom("span",{className:A},s),x.appendChild(y)):(y=zdom("span",{className:A},s),y.appendChild(s),x.appendChild(y))):"getTasksByCategory"===p.taction?"string"==typeof s?(y=zdom("span",null,s),x.appendChild(y)):(y=zdom("span",null),y.appendChild(s),x.appendChild(y)):(u&&w.appendChild(u),u&&t&&w.appendChild(zdom("i",{className:"msi-rarrow"})),t&&w.appendChild(t),w&&(A="SC_ldot"),"string"==typeof s?(y=zdom("span",{className:A},s),x.appendChild(y)):(y=zdom("span",{className:A}),y.appendChild(s),x.appendChild(y))),u?a.SUB=$(w.innerHTML):a.SUB="",x?a.assignee=$(x.innerHTML):a.assignee=""):(a.CATID&&(z=j.Util.getProjectName(a.NMSPID,a.CATID),""!==z&&(t=zdom("span",null,z))),"getMyTasks"===p.taction?(u=zdom("span",null,j.Util.getGroupName(a.NMSPID)),w.appendChild(u),u&&t&&w.appendChild(zdom("i",{className:"msi-rarrow"})),t&&w.appendChild(t)):t&&w.appendChild(t),a.SUB=$(w.innerHTML),"-1"!==a.ATTENDEEIDS&&a.ATTENDEEIDS!==zmail.zuid&&(r=j.Util.getContact(a.ATTENDEEIDS),q=r?r.get("fn"):"",A=u||t?"SC_ldot":""),y=zdom("span",{className:A},q),x.appendChild(y),a.assignee=$(x.innerHTML),a.SUB||(a.SUB="")),a.iconArr=[],a.actionIcons=[],this.listInfo&&"getTasksInTrash"===this.listInfo.taction)a.iconArr.push("msi-trash"),a.iconArr.push("msi-restoreTrash");else{if(B.isPermitted(a,"delete")){if("task"===e){var C=a.isArchived?"msi-unarchive":"msi-archive";a.actionIcons.push(C)}a.iconArr.push("msi-trash")}a.showcomplete=B.isPermitted(a,"complete"),a.subicon=B.isPermitted(a,"addsub"),a.email&&(a.email.accid===zmail.accId||a.email.isShared)&&a.actionIcons.push("msi-mail"),a.actionIcons.push("msi-link"),a.actionIcons.push("msi-nmore")}c&&(a.dateColor=c),a.COMMENTCOUNT>0&&(a.comment=a.COMMENTCOUNT),o.setDataObj(a);var D=$(o.getHTML()),E={id:this.listObj.TASKID,groupId:this.listObj.NMSPID,type:e,assignee:a.ATTENDEEIDS,owner:a.OWNERID};this.listObj.PARENTTASK&&(E.pTaskId=this.listObj.PARENTTASK.TASKID),D.data(E),j.Util.showToolTip(D);var F=D.find("span.assigneeName");return F.length&&(F.data(E),j.Util.bindAssignEvents(F,F.closest(".SC_assignee"))),D.find("span.sum").length&&D.find("span.sum").text(" - "+j.Util.unescapeSpecialChar(a.SUMMARY)),D},getSublistArrIndex:function(a){if(this.sublistArr)return a.newformat?this.sublistArr.indexOf(a.groupId+"#"+a.entityId):this.sublistArr.indexOf(a.entityId)},addSubTask:function(){var a=this.listObj;k.requireTaskModule("taskCreate").done(function(){j.Create({pTaskId:a.TASKID,groupId:a.NMSPID,categoryId:a.CATID,pTaskObj:a})})},markasComp:function(){var a={},b={},c=this.listObj,d=3===c.STATUS?2:3;a.entityId=b.entityId=c.TASKID,a.groupId=b.groupId=c.NMSPID,b.categoryId=c.CATID,a.taction=b.taction="changeStatus",a.actionType=b.actionType="changeEntity",a.status=b.status=d,b.pTaskId=c.PARENTTASK?c.PARENTTASK.TASKID:void 0,j.Util.Req.addEditTask(a,b,function(a,b){$.publish("/zm/task/changeStatus",[a,b])})},deleteTask:function(a){var b={},c={},d=this.listObj;b.entityId=c.entityId=d.TASKID,b.groupId=c.groupId=d.NMSPID,b.forceDelete=!0,c.categoryId=d.CATID,c.newformat=d.newformat,b.actionType=c.actionType="delEntity",b.taction=c.taction=a.action,c.pTaskId=d.PARENTTASK?d.PARENTTASK.TASKID:void 0,c.subTaskIds=d.SUBTASKIDS,j.Util.Req.addEditTask(b,c,function(a,b){$.publish("/zm/task/deleteTask",[a,b])})},archiveUnarchiveTask:function(a){a="msi-archive"===a?"archiveTask":"unArchiveTask";var b=this.listObj,c={},d={};c.entityId=d.entityId=b.TASKID,c.taction=d.taction=a,c.groupId=d.groupId=b.NMSPID,j.Util.Req.send({param:c,eparam:d,callBack:function(b,c){$.publish("/zm/task/"+a,[b,c])},writeReq:!0})},getSubTasks:function(a){var b=this.listObj;this.subtaskloaded?a(this):!this.subtaskloaded&&b.SUBTASKIDS&&b.SUBTASKIDS.length===b.SUBTASKCOUNT?this.constructSubtaskListing(a):this.loadSubtask(a)},getsubTaskArea:function(a){return $("<div />").attr({"class":"zmTV",id:"tv"+a,style:"display: block;"})},constructSubtaskListing:function(a){var b=this;b.sublistingObj={},b.sublistArr=[],b.sublistEl=b.getsubTaskArea(b.listObj.TASKID);for(var c=0;c<b.listObj.SUBTASKS.length;c++)if(b.listObj.SUBTASKS[c]){b.listObj.SUBTASKS[c].PARENTTASK={TITLE:b.listObj.TITLE,TASKID:b.listObj.TASKID};var d=new h(b.listObj.SUBTASKS[c],b.listInfo,"sublist");b.sublistingObj[b.listObj.SUBTASKS[c].NMSPID]||(b.sublistingObj[b.listObj.SUBTASKS[c].NMSPID]={}),b.sublistingObj[b.listObj.SUBTASKS[c].NMSPID][b.listObj.SUBTASKS[c].TASKID]=d;var e={id:b.listObj.SUBTASKS[c].TASKID,groupId:b.listObj.NMSPID,type:"sublist",pTaskId:b.listObj.TASKID};d.listingEl.data(e),b.sublistEl.append(d.listingEl);var f=b.listObj.newformat?b.listObj.NMSPID+"#"+b.listObj.SUBTASKS[c].TASKID:b.listObj.SUBTASKS[c].TASKID;b.sublistArr.push(f)}b.subtaskloaded=!0,"function"==typeof a&&a(b)},loadSubtask:function(a){var b=this,c=function(c){b.subtaskloaded||(b.listObj.SUBTASKIDS=[],b.listObj.SUBTASKCOUNT=0,b.listObj.SUBTASKS=[],$.each(c.order,function(a,d){c.list[d]&&(b.listObj.SUBTASKS.push(c.list[d]),b.listObj.SUBTASKIDS.push(c.list[d].TASKID),b.listObj.SUBTASKCOUNT++)}),b.constructSubtaskListing(a))},d={entityId:b.listObj.TASKID,groupId:b.listObj.NMSPID};j.Util.Req.fetchSubtasks(d,c)},callback:function(a,b,c){var d,e=this;if(e.listObj.TASKID===c.entityId)d=e.listObj;else if(!this.subtaskloaded&&this.listObj.TASKID===c.pTaskId)for(var f=0,g=e.listObj.SUBTASKS.length;f<g;f++)e.listObj.SUBTASKS[f].TASKID===c.entityId&&(d=e.listObj.SUBTASKS[f]);if(d)if("changeCategory"===c.taction&&(d.CATID=c.categoryId,e.updateListView(c)),"changeAssignee"===c.taction)d.ATTENDEEIDS=c.assignee,e.updateListView(c);else if("changeTitle"===c.taction)d.TITLE=j.Util.escapeSpecialChar(c.title),e.updateListView(c);else if("changePriority"===c.taction)d.PRIORITY=c.priority,e.updateListView(c);else if("changeSummary"===c.taction)d.SUMMARY=j.Util.escapeSpecialChar(c.summary),e.updateListView(c);else if("setDueDate"===c.taction)d.DUEDATE=c.dueDate,e.updateListView(c,d);else if("addLabel"===c.actionType){d.TAGS=d.TAGS||[];var h=$("#"+c.entityId).find(".zm_lbl"),i=h.find(".zmLblGrp");if(i.length>0){var k=t.constructTagListHTML([c.labelId],!1,4,"default");i.append(k)}else{var l=t.constructTagListHTML([c.labelId],!1,4,"default",{constructOuterDiv:!0});h.append(l)}d.TAGS.push(c.labelId)}else if("deleteLabel"===c.actionType){var m=d.TAGS.indexOf(c.labelId);d.TAGS.splice(m,1);var n=$("#"+c.entityId+" div.zmLblGrp");n.find("[data-mid='"+c.labelId+"']").remove(),0===n.find("[data-mid]").length&&n.remove()}},statusCallback:function(a,b,c){if(this.listObj.TASKID===c.entityId)this.listObj.STATUS=c.status,this.updateListView(c);else if(this.listObj.PARENTTASK&&this.listObj.PARENTTASK.TASKID===c.entityId)3===c.status&&(this.listObj.STATUS=c.status,this.updateListView(c));else if(this.listObj.TASKID&&this.listObj.TASKID===c.pTaskId&&!this.subtaskloaded)for(var d=0,e=this.listObj.SUBTASKS.length;d<e;d++)this.listObj.SUBTASKS[d].TASKID===c.entityId&&(this.listObj.SUBTASKS[d].STATUS=c.status)},addSubTaskCallback:function(a,b,c){if(c.pTaskId===this.listObj.TASKID){var d=b.data;if(this.subtaskloaded){var e={},f=d.tasks.newformat?d.gnrl.group.id+"#"+d.tasks.id:d.tasks.id;this.sublistArr.push(f),e[f]=B.singleListObj(b.data,c);var g=new h(e[f],this.listInfo,"sublist");this.sublistingObj[d.gnrl.group.id]||(this.sublistingObj[d.gnrl.group.id]={}),this.sublistingObj[d.gnrl.group.id][d.tasks.id]=g,this.sublistEl.append(g.listingEl)}this.listObj.SUBTASKCOUNT+=1,"moveSubtask"!==c.taction&&(this.listObj.SUBTASKS||(this.listObj.SUBTASKS=[],this.listObj.SUBTASKIDS=[]),d.tasks.newformat?this.listObj.SUBTASKIDS.push(d.gnrl.group.id+"#"+b.data.tasks.id):this.listObj.SUBTASKIDS.push(b.data.tasks.id),this.listObj.SUBTASKS.push(B.singleListObj(b.data,c))),this.updateListView(c),"moveSubtask"===c.taction&&j.Util.highlight($("#"+c.pTaskId))}},deleteTaskCallback:function(a,b,c){if(!b.msg)if("deleteCategory"===c.taction&&this.listObj.CATID===c.categoryId||this.listObj.TASKID===c.entityId||this.listObj.PARENTTASK&&this.listObj.PARENTTASK.TASKID===c.entityId)this.unsubscribeme(),this.listingEl.remove(),this.sublistEl&&this.sublistEl.remove();else if(this.listObj.TASKID===c.pTaskId){var d=this,e=function(){var a=d.getSublistArrIndex(c);d.sublistArr.splice(a,1);var b=d.sublistingObj[c.groupId][c.entityId];b.listingEl.remove(),delete d.sublistingObj[c.groupId][c.entityId],d.updateSubtaskCount(d.listingEl,d.sublistArr.length),d.listObj.SUBTASKIDS.splice(a,1),d.listObj.SUBTASKS.splice(a,1),d.listObj.SUBTASKCOUNT-=1};"undefined"==typeof this.sublistArr?this.loadSubtask(e):e()}},updateSubtaskCount:function(a,b){0===b?(a.find(".zmtCt").remove(),a.find(".zm_td").remove()):a.find(".zmtCt").text(b)},labelCallback:function(a,b,c){this.listObj.TASKID===c.entityId&&B.iscurrentView(c,this.listInfo)&&(this.unsubscribeme(),this.listingEl.remove())},updateListView:function(a){var b,c=this.listingEl;if("addLabel"===a.actionType){for(var d=$("#"+a.entityId).find(".zmLblGrp").children(),e="[",f=0;f<d.length;f++)e+=String($(d[f]).attr("data-mid"))+",";e+=a.labelId+"]",b={TAGS:e},this.listObj.TAGS.push(a.labelId)}var g=zmsuite.getLeft().selId;if(B.iscurrentView(a,this.listInfo)||"changeCategory"!==a.taction||"sublist"===this.type||void 0===g){b=b||this.listObj,"setDueDate"===a.taction&&(b.DUEDATE=a.dueDate,b.DUEDATEINMILLISECONDS=new Date(a.dueDate).getTime());var h=c.hasClass("zmTLst"),i=c.hasClass("zmSLst");this.listingEl=this.getRowHTML(b),c.replaceWith(this.listingEl),h&&0!==this.listObj.SUBTASKCOUNT?this.listingEl.addClass("zmTLst"):h&&0===this.listObj.SUBTASKCOUNT&&this.sublistEl&&this.sublistEl.addClass("SC_dyn"),i&&this.listingEl.addClass("zmSLst")}else if(this.listingEl.remove(),this.unsubscribeme(),this.subtaskloaded){for(var j=0;j<this.sublistArr.length;j++)this.sublistingObj[this.sublistArr[j]].unsubscribeme();this.sublistEl&&this.sublistEl.remove()}},subscribeme:function(){this.subscriptions=_zm.bindFn(this.callback,this),this.deletesubscription=_zm.bindFn(this.deleteTaskCallback,this),this.addsubscription=_zm.bindFn(this.addSubTaskCallback,this),this.statussubscription=_zm.bindFn(this.statusCallback,this),this.labelsubscription=_zm.bindFn(this.labelCallback,this),$.subscribe("/zm/task/deleteLabel",this.labelsubscription),$.subscribe("/zm/task/changeStatus",this.statussubscription),$.subscribe("/zm/task/deleteTask",this.deletesubscription),$.subscribe("/zm/task/deleteCategory",this.deletesubscription),$.subscribe("/zm/task/addTask",this.addsubscription)},unsubscribeme:function(){$.unsubscribe("/zm/task/deleteLabel",this.labelsubscription),$.unsubscribe("/zm/task/changeStatus",this.statussubscription),$.unsubscribe("/zm/task/deleteTask",this.deletesubscription),$.unsubscribe("/zm/task/deleteCategory",this.deletesubscription),$.unsubscribe("/zm/task/addTask",this.addsubscription)}},new e},z.constructList=function(b,d,e){var f=a("zmList"),g=function(){var a;a=b.order.length>20?b.order.slice(0,b.order.length-1):b.order.slice(0,b.order.length),this.count=a.length,this.appId=e||"zm_task",this.nextPage=b.page&&"1"===b.page.showNextPage?b.page.endTime:"",this.sDueDate=b.page&&"1"===b.page.showNextPage?b.page.endDate:-1,this.listObj=b.list,this.listArr=a,this._centerObj={},this.listInfo=d,this.forceScroll=b.forceScroll||!1,!d||"getGroupTasks"!==d.taction&&"getMyTasksAndCategory"!==d.taction&&"getMyTasks"!==d.taction&&"getTasksByMe"!==d.taction&&"getTasksByCategory"!==d.taction&&"getTasksSortedByDueDate"!==d.taction||(this.listInfo.showDateColour=!0),this.constructor(),this.openTaskId=void 0,this.scroll=!1};return g.prototype={constructor:function(){var a=this;a.listArrFull=$("<div></div>"),$.each(a.listArr,function(b,c){var d=new h(a.listObj[c],a.listInfo);a._centerObj[a.listObj[c].NMSPID]||(a._centerObj[a.listObj[c].NMSPID]={}),a._centerObj[a.listObj[c].NMSPID][a.listObj[c].TASKID]=d,a.listArrFull.append(d.listingEl)}),this.subscribeme()},deleteSubscribers:function(){var a=this;$.each(a._centerObj,function(a,b){$.each(b,function(a,b){b.unsubscribeme()})}),a.unsubscribeme()},getListObjValue:function(a){return this.listObj[a.groupId+"#"+a.entityId]||this.listObj[a.entityId]},getListArrIndex:function(a){return a.newformat?this.listArr.indexOf(a.groupId+"#"+a.entityId):this.listArr.indexOf(a.entityId)},moreActions:function(a){$(a.target).closest("div.zmFdr").off("mouseout");var b,c=$(a.target),d=c.closest(".zmL"),e=d.data("id"),f=d.data("groupId"),g=d.data("pTaskId"),h=d.data("type");if(d.length){if("task"===h)b=this._centerObj[f][e];else if("sublist"===h){var i=this._centerObj[f][g];b=i.sublistingObj[f][e]}b.listingEl.addClass("sel"),f=b.listObj.NMSPID;var m=[{htm:v.common.postnew,data:{action:"copy"}}];"sublist"!==h&&B.isPermitted(b.listObj,"delete")&&m.push({htm:v.common.moveTask,data:{action:"move"}}),m.push({htm:v.common.opentab,data:{action:"opentab"}}),"search"===this.listInfo.taction&&(m=[{htm:v.common.opentab,data:{action:"opentab"}}]);var n={par:a.target,showArrow:!0,list:m,direction:"bottom",clk:function(a,c){if(b.listingEl.removeClass("sel"),k.hideMenu(),"copy"===a.action)j.Util.moveTask(b.listObj,!0);else if("opentab"===a.action){var d={groupId:f,entityId:e,pTaskId:g,opentype:"tab"};l.load("taskPreview").done(function(){j.Preview(d)})}else"move"===a.action&&j.Util.moveTask(b.listObj,!1)}};zmsuite.showMenu(n)}},listClickHandler:function(a){var b=$(a.target),c=b.attr("class"),d=b.closest(".zmL"),e="zm_lbl"===c;if(d.length){var g,h,i,k={},l=d.data("id"),m=d.data("groupId"),o=d.data("pTaskId"),q=d.data("type"),r={};if("task"===q)g=this._centerObj[m][l],h=this.getListArrIndex({groupId:m,entityId:l,newformat:g.listObj.newformat}),i=this.listArr;else if("sublist"===q){var s=this._centerObj[m][o];g=s.sublistingObj[m][l],h=s.getSublistArrIndex({groupId:m,entityId:l,newformat:s.listObj.newformat}),i=s.sublistArr}if(r.prev=0===h,r.next=h===i.length-1,"zmtCt"===c){this.loadSubtask(g);var t=b[0].previousSibling;$(t).toggleClass("SC_dyn")}else if("msi-markcomplete"===c)g.markasComp();else if("msi-subtask"===c)g.addSubTask();else if("msi-trash"===c)n.confirm(v.common.deleteTask,{onOk:function(){g.deleteTask({action:"deleteTask"}),l===this.openTaskId&&B.closePreview(),g.listingEl.removeClass("zmTLst"),g.sublistEl&&g.sublistEl.addClass("SC_dyn")}});else if("msi-restoreTrash"===c)g.deleteTask({action:"restoreTask"});else if("msi-unarchive"===c||"msi-archive"===c)g.archiveUnarchiveTask(c),l===this.openTaskId&&B.closePreview(),g.listingEl.removeClass("zmTLst"),g.sublistEl&&g.sublistEl.addClass("SC_dyn");else if("msi-nmore"===c)this.moreActions(a);else if("msi-link"===c){var u=window.location.protocol+"//"+window.location.hostname+zmail.conPath+"/#stream/tab/"+m+"/"+l+"/3/viewGroupEntity";p.clipBoardAPI.setData(u,{type:"text"})}else if("msi-uncheck"===c)d.hasClass("SC_check")?(d.removeClass("SC_check"),delete B.selectedTask[l],B.printSelectList.splice(B.printSelectList.indexOf(m+"#"+l),1)):(d.addClass("SC_check"),B.selectedTask[l]=m,B.printSelectList.push(m+"#"+l));else if("msi-mail"===c){var w={},x=g.listObj;x.email.accid!==zmail.accId&&(w={actionType:"viewGroupMailEntity",entityId:x.email.msgid,entityType:"1",streamsView:"true",groupId:x.email.mailOwner,accId:x.email.accid,streams:!0}),f.getMailData({msgId:x.email.msgid,opentype:2,type:"lt",src:"external",eprm:w})}else{if("SPAN"===a.target.nodeName&&c&&c.indexOf("assigneeName")!==-1)return!1;if(e||b.closest("div.zmLblGrp").length>0)k={ele:$("div#"+l).find("div.zm_lbl"),lbls:g.listObj.TAGS,entityId:l,groupId:m,pTaskId:o,cdate:g.listObj.CREATEUUID,type:q},this.showLabelPopup(k,g.listObj.TAGS);else if("undefined"!==this.openTaskId&&this.openTaskId!==l){var y=["t"];o&&(y.push(o),y.push("s")),y.push(l),A?B.updateFilterURL([m].concat(y)):j.Util.handleURLChange(y,m),this.openTaskinListing(g,r)}}}},showLabelPopup:function(a,b){var c={};c.parentDOM=$(a.ele),c.displayAs="popup",c.accType="default",c.labelState={labelList:b},c.onStateChange=function(b,c){var d={};d.entityId=a.entityId,d.groupId=a.groupId,d.pTaskId=a.pTaskId,d.cdate=a.cdate,d.checked=c,d.labelId=b,j.Util.Req.addDeleteLabelReq(d,B.doLabelAction)};var d=k.createFLComp("label",c);d.show()},openTaskinListing:function(a,b){if(a){B.getCenterObj(0,this.appId)[2].$el.find(".zmSLst").removeClass("zmSLst"),a.listingEl.addClass("zmSLst");var c={groupId:a.listObj.NMSPID,newformat:a.listObj.newformat,entityId:a.listObj.TASKID,readOnly:a.listInfo&&"getTasksInTrash"===a.listInfo.taction};c.pTaskId=a.listObj.PARENTTASK?a.listObj.PARENTTASK.TASKID:void 0,c.pTaskTitle=a.listObj.PARENTTASK?a.listObj.PARENTTASK.TITLE:void 0,c.taction=a.listInfo?a.listInfo.taction:"",c.entityId=a.listObj.TASKID,c.opentype="preview",this.viewTask(c,a)}},closeTask:function(a,b){B.closePreview(),this.openTaskId===b&&(this.openTaskId=void 0,$.unsubscribe("/zm/task/closeTask",this.closesubscription))},viewTask:function(a,b){var c=this,d=b.listingEl,e=d.data("type");this.openTaskId=a.entityId;var f,g;if("sublist"===e){var h=this._centerObj[a.groupId][a.pTaskId].sublistingObj[a.groupId][a.entityId];f=h.listingEl[0].previousSibling,g=h.listingEl[0].nextSibling}else f=this._centerObj[a.groupId][a.entityId].listingEl[0].previousSibling,g=this._centerObj[a.groupId][a.entityId].listingEl[0].nextSibling;$(f).is("div#quickAdd")&&(f=null),null!==g?(a.nextClick=function(b){c.prevNxtMail(b,a,e)},a.nxtAvl=!0):a.nxtAvl=!1,null!==f?(a.prevClick=function(b){c.prevNxtMail(b,a,e)},a.prevAvl=!0):a.prevAvl=!1,a.onMount=function(a){if(b.listObj.SUBTASKCOUNT>0&&!b.subtaskloaded){b.listObj.SUBTASKIDS=[],b.listObj.SUBTASKCOUNT=0,b.listObj.SUBTASKS=[];var c=a.task.data.subtask||[];$.each(c,function(a,c){if(c&&c.tasks){var d=c.tasks;d.pTaskId=d.parentTask.id,d.groupId=c.gnrl.group.id,d.entityId=d.id;var e=B.generateListObj(d);e.TAGS=c.myact.label||[],b.listObj.SUBTASKS.push(e),b.listObj.SUBTASKIDS.push(d.id),b.listObj.SUBTASKCOUNT++}}),b.constructSubtaskListing(),b.subtaskloaded=!1}},a.closeCallback=function(b){c.closeTask(b,a.entityId)},k.requireTaskModule("taskPreview").done(function(){j.Preview(a)})},prevNxtMail:function(a,b,c){var d,e,f,g,h,i,j,l,m,n={};"task"===c?(g=this.getListArrIndex(b),i=this._centerObj,j=this.listArr):"sublist"===c&&(l=this._centerObj[b.groupId][b.pTaskId],g=l.getSublistArrIndex(b),i=l.sublistingObj,j=l.sublistArr),"prev"===a?(h=g-1,d=j[h]):(h=g+1,d=j[h]);var o=this.listObj[d];e="task"===c?o.TASKID:l.listObj.SUBTASKS[h].TASKID,f="task"===c?o.NMSPID:l.listObj.SUBTASKS[h].NMSPID,m=j.indexOf(d),n.prev=0===m,n.next=m===j.length-1,i[f][e]&&(this.openTaskinListing(i[f][e],n),k.initScroll(B.getCenterObj()[2].$el,i[f][e].listingEl,i[b.groupId][b.entityId].listingEl,a,!0))},loadSubtask:function(a){a.subtaskloaded?(a.listingEl.toggleClass("zmTLst"),a.sublistEl.toggleClass("SC_dyn")):a.getSubTasks(_zm.bindFn(this.showSubtask,this))},showSubtask:function(a){a.listingEl.after(a.sublistEl),a.listingEl.addClass("zmTLst")},changeCategoryCallback:function(a,b,c){this.editCallback(a,b,c),this.deleteTaskCallback(a,b,c)},copyCallback:function(a,b,c){if(c.copy&&c.toGroupId===c.groupId)this.addTaskCallback(a,b,c);else if(!c.copy){this.openTaskId===c.entityId&&B.closePreview();var d=this.listArr.indexOf(c.entityId);if(this.listArr.splice(d,1),this._centerObj&&this._centerObj[c.groupId]){var e=this._centerObj[c.groupId][c.entityId];e.listingEl[0].remove()}delete this._centerObj[c.groupId][c.entityId]}},bulkDeleteCallback:function(a,b,c){if(c.entityIds&&this._centerObj&&this._centerObj[c.groupId]){var d=this,e=c.entityIds.split(",");_.each(e,function(a){var b=d._centerObj[c.groupId][a];b&&b.listingEl[0]&&(b.listingEl[0].remove(),delete d._centerObj[c.groupId][a])})}},subscribeme:function(){this.deletesubscription=_zm.bindFn(this.deleteTaskCallback,this),$.subscribe("/zm/task/deleteTask",this.deletesubscription),this.addsubscription=_zm.bindFn(this.addTaskCallback,this),$.subscribe("/zm/task/addTask",this.addsubscription),$.subscribe("/zm/task/label/rename",this.updateTags),$.subscribe("/zm/task/label/delete",this.deleteTags),this.changecategorysubscription=_zm.bindFn(this.changeCategoryCallback,this),$.subscribe("/zm/task/changeCategory",this.changecategorysubscription),$.subscribe("/zm/task/deleteLabel",this.changecategorysubscription),this.changesubscription=_zm.bindFn(this.editCallback,this),$.subscribe("/zm/task/changeTitle",this.changesubscription),$.subscribe("/zm/task/changeSummary",this.changesubscription),$.subscribe("/zm/task/changeAssignee",this.changesubscription),$.subscribe("/zm/task/changePriority",this.changesubscription),$.subscribe("/zm/task/addLabel",this.changesubscription),$.subscribe("/zm/task/setDueDate",this.changesubscription),$.subscribe("/zm/task/archiveTask",this.deletesubscription),$.subscribe("/zm/task/unArchiveTask",this.deletesubscription),this.copysubscription=_zm.bindFn(this.copyCallback,this),$.subscribe("/zm/task/copyTask",this.copysubscription),this.bulkDelete=_zm.bindFn(this.bulkDeleteCallback,this),$.subscribe("/zm/task/bulkdelete",this.bulkDelete)},unsubscribeme:function(){$.unsubscribe("/zm/task/deleteTask",this.deletesubscription),$.unsubscribe("/zm/task/addTask",this.addsubscription),$.unsubscribe("/zm/task/label/rename"),$.unsubscribe("/zm/task/label/delete"),$.unsubscribe("/zm/task/changeTitle",this.changesubscription),$.unsubscribe("/zm/task/changeSummary",this.changesubscription),$.unsubscribe("/zm/task/changeAssignee",this.changesubscription),$.unsubscribe("/zm/task/changePriority",this.changesubscription),$.unsubscribe("/zm/task/addLabel",this.changesubscription),$.unsubscribe("/zm/task/setDueDate",this.changesubscription),$.unsubscribe("/zm/task/changeCategory",this.changecategorysubscription),$.unsubscribe("/zm/task/deleteLabel",this.changecategorysubscription),$.unsubscribe("/zm/task/archiveTask",this.deletesubscription),$.unsubscribe("/zm/task/unArchiveTask",this.deletesubscription),$.unsubscribe("/zm/task/copyTask",this.copysubscription),$.unsubscribe("/zm/task/bulkdelete",this.bulkDelete)},checkSourceView:function(a){var b=a.taction||a.actionType,c=zmsuite.getLeft().selId,d=zmsuite.getLeft().selLayerId,e=!0;switch(b){case"deleteLabel":("zmllabelH"===d||A)&&(e=!1);break;case"changeCategory":("groups"===d||"views"===d||void 0===c||A)&&(e=!0)}return e},deleteTaskCallback:function(a,b,c){if(!b.msg){var d=this.listArr.indexOf(c.groupId+"#"+c.entityId),e=d!==-1?d:this.listArr.indexOf(c.entityId),f="changeCategory"===c.taction&&(this.listArr.indexOf(c.entityId)!==-1||d!==-1)&&!B.iscurrentView(c,this.listInfo),g="deleteTask"===c.taction&&(this.openTaskId===c.entityId||c.subTaskIds&&c.subTaskIds.indexOf(this.openTaskId)!==-1),h="deleteLabel"===c.actionType&&d!==-1&&B.iscurrentView(c,this.listInfo);
if(f||g||h){var i=this.getListObjValue(c);(this.openTaskId===c.entityId||i.SUBTASKIDS.indexOf(this.openTaskId)!==-1||c.newformat&&i.SUBTASKIDS.indexOf(c.groupId+"#"+this.openTaskId)!==-1)&&(B.hideMenu(),$.publish("/zm/task/closeTask",[c.entityId])),delete this.getListObjValue(c)}if(!this.checkSourceView(c)){if("deleteTask"===c.taction&&c.pTaskId){var k=this._centerObj[c.groupId]&&this._centerObj[c.groupId][c.pTaskId]?this._centerObj[c.groupId][c.pTaskId]:void 0;k&&this.setCountinListView(k.listObj.SUBTASKCOUNT,c.pTaskId)}var l=this;if(e>=0){this.listArr.splice(e,1);var m=this._centerObj[c.groupId][c.entityId];m&&m.listingEl[0].remove(),delete this._centerObj[c.groupId][c.entityId],this.listArr.length<=15&&""!==this.nextPage&&(c.taction=B.getSelectedListingInfo().taction,l.scrollList(c))}if(this.listArr.length<=0){var n=this.listArrFull.find("#notask");0===n.length&&(this.listArrFull.append(u.emptyTask()),j.Util.addTaskPopup(this.listArrFull))}}}},setCountinListView:function(a,b){var c=$("#"+b);0===a?(c.find(".zmtCt").remove(),c.find(".zm_td").remove()):c.find(".zmtCt").text(a)},appendScrollList:function(a){"function"==typeof c&&c();var b,d=a.list,e=a.order;b=e.length>20?e.slice(0,e.length-1):e.slice(0,e.length),this.scroll=!1,this.nextPage=a.page&&"1"===a.page.showNextPage?a.page.endTime:"",this.sDueDate=a.page&&"1"===a.page.showNextPage?a.page.endDate:-1,this.forceScroll=a.forceScroll,this.count+=b.length,this.listArr=this.listArr.concat(b),$.extend(this.listObj,d);var f=this;$.each(b,function(a,b){var c=new h(d[b],f.listInfo);f._centerObj[d[b].NMSPID]||(f._centerObj[d[b].NMSPID]={}),f._centerObj[d[b].NMSPID][d[b].TASKID]=c,f.listArrFull.append(c.listingEl)})},addTaskCallback:function(a,b,c){if(B.iscurrentView(c,this.listInfo)&&!c.pTaskId){var d=b.data,e={},f=d.tasks.newformat?d.gnrl.group.id+"#"+d.tasks.id:d.tasks.id;d.tasks.newformat?(this.listArr.unshift(f),e[f]=B.singleListObj(b.data,c)):(this.listArr.unshift(f),e[f]=B.singleListObj(b.data,c)),$.extend(this.listObj,e);var g=new h(this.listObj[f],this.listInfo);this._centerObj[d.gnrl.group.id]?this._centerObj[d.gnrl.group.id][d.tasks.id]=g:(this._centerObj[d.gnrl.group.id]={},this._centerObj[d.gnrl.group.id][d.tasks.id]=g),this.listArrFull.find("#notask").remove(),this.appendTaskToListing(g.listingEl[0]),c.actionSrc&&(g.listingEl.addClass("highlightClass"),setTimeout(function(){g.listingEl.removeClass("highlightClass")},3e3))}},appendTaskToListing:function(a){if(this.listArrFull.find("#quickAdd").length>0){var b=this.listArrFull.find("#quickAdd")[0];$(b).after(a)}else this.listArrFull.prepend(a)},updateTags:function(a,b){var c=y.listArrFull,d=c[0].childNodes;$.each(d,function(a,c){for(var d=$(c).find(".zmLblGrp div"),e=0;e<d.length;e++)$(d[e]).attr("data-mid")===b.id&&$(d[e]).attr("title",b.n)})},deleteTags:function(a,b){var c=y.listArrFull,d=c[0].childNodes;$.each(d,function(a,c){for(var d=$(c).find(".zmLblGrp div"),e=0;e<d.length;e++)$(d[e]).attr("data-mid")===b.id&&$(d[e]).remove()})},editCallback:function(a,b,c){var d,e=this.listObj[c.groupId+"#"+c.entityId];if(e)d=this._centerObj[e.NMSPID][e.TASKID],d&&d.callback(a,b,c);else if(c.pTaskId&&(e=this.listObj[c.groupId+"#"+c.pTaskId],e&&(d=this._centerObj[e.NMSPID][e.TASKID],d.subtaskloaded))){for(var f=0,g=e.SUBTASKS.length;f<g;f++)if(e.SUBTASKS[f].TASKID===c.entityId){d=d.sublistingObj[c.groupId][c.entityId];break}d&&d.callback(a,b,c)}}},new g},g=function(g,h,m,p){var t=a("zmStreamsApp"),C=function(){b=h,e=j.Util.Groups(),d=j.Util.Categories(),this.render(),_.keys(g).length>0&&(g.order&&g.list?this.responseListConstruct(g,h):(j.Util.handleURLChange(m),this.paramsListConstruct(g,h)))};return C.prototype={render:function(){var a=B.getCenterObj(),b=this.dropdown();a[0].push(b.list);var d=B.list();a[1].push(d.list),a[1].setListener("click",d.clk),zmsuite.renderCenter();var e=this,f=a[0].$el.find(".SC_flt");if(f.on("click",function(a){var c="B"===a.target.tagName?$(a.target).find("i").attr("class"):a.target.className;b.clk(a,c)}),"search"!==h.fromAction){var g=a[0].$el.find(".SC_frt"),i=u.printLink();g.append(i);var j=u.cheatSheetLink();g.append(j),g.on("click",function(a){"printlink"===$(a.target).closest("li").attr("id")?B.generateTaskListPrintTemp():"cheatlink"===$(a.target).closest("li").attr("id")&&e.showCheatSheet()}),this.bindEvents()}"function"==typeof c&&c()},bindEvents:function(){var a=function(a){return a&&(a.indexOf("by")!==-1||a.indexOf("today")!==-1||a.indexOf("week")!==-1||a.indexOf("month")!==-1||a.indexOf("delayed")!==-1||a.indexOf("upcoming")!==-1)||j.Util.isDisabledGroup(a)},b=function(a){return B.isGroup(a)},c=v.errorMsg.invalidCategoryChange;B.getCenterObj()[2].setDragDrop({onDrop:function(a,b,d){var e,f;for(f in d)e=f;var g,h,i=$(b[0]).data();if("task"===i.type)g=y._centerObj[i.groupId][i.id].listObj;else if("sublist"===i.type){if("getTasksByCategory"===d[e].type)return!1;g=y._centerObj[i.groupId][i.pTaskId].listObj,h=y._centerObj[i.groupId][i.pTaskId].listObj}if(d[e]&&"getTasksByCategory"===d[e].type){if(d[e].p){var l=d[e].p,m=g.NMSPID;if(String(m)!==String(l))return k.succErrMsg("e",c),!1;j.Util.Req.changeCategoryReq({categoryId:e,groupId:g.NMSPID,entityId:i.id})}}else if(d[e]&&d[e].label){var n=!1;if(g.TAGS.length>0&&g.TAGS.indexOf(e)===-1?n=!0:g.TAGS.length||(n=!0),n){var o={};o.entityId=g.TASKID,o.groupId=g.NMSPID,o.pTaskId=i.pTaskId,o.cdate=g.CREATEUUID,o.checked=!0,o.labelId=e,j.Util.Req.addDeleteLabelReq(o,B.doLabelAction)}}else if(("task"===d.type||"sublist"===d.type)&&d.groupId===i.groupId&&d.id!==i.pTaskId&&"task"!==i.type){var p={groupId:i.groupId,entityId:i.id};p.toParentId="sublist"===d.type?d.pTaskId:d.id,j.Util.Req.sendMoveSubtaskReq(p),b.remove(),y.setCountinListView(--h.SUBTASKCOUNT,i.pTaskId)}},allowDrag:function(b){var c;if(c=zmsuite.getLeft().selId,a(c))return!1;var d=b.data();return!(!B.isPermitted(d,"changeCategory")||b.hasClass(".zt_quickAdd"))},allowDrop:function(c,d,e){var f,g;for(f in d)g=f;return!!d[g]&&("inside"===e&&(!a(g)&&(!b(g)||(B.toggleGroup(g,"show"),!1))))},dragStart:function(a,b){var c={};return b.length>1?(c.count=2,c.text="Tasks selected"):(c.text=j.Util.escapeSpecialChar($(b.find("div.zmFrm span")[0]).text()),c.text.length>50&&(c.text=c.text.substring(0,49)+"...")),c},allowedParents:"#zmtTree,#zmllabelH,#zmTasksApp"})},paramsListConstruct:function(a,b){var c=this;j.Util.Req.getTaskList(a,b,function(a,b){c.construct(a,b),"object"===("undefined"==typeof p?"undefined":babelHelpers["typeof"](p))&&p.resolve(c)})},getArchivedInPersonal:function(){var a={start:0,limit:20,archive:!0,ascending:!1,action:"getTasks",labelId:"personaltasks"};b.categoryId&&(a.categoryId=b.categoryId),j.Util.Req.taskGet(a,a,this.construct)},loadPreview:function(a,b){if(b.indexOf("t")!==-1){var c,d,e;b.indexOf("s")!==-1?(c=b[b.indexOf("t")+1],d=b[b.indexOf("s")+1]):d=b[b.indexOf("t")+1];var f={groupId:a,entityId:d,pTaskId:c},g=b.indexOf("tab");if(g!==-1){if(zmsuite.isWorkspaceAvailable("zm_task"+d))return!1}else{var h=y._centerObj;h&&h[a]&&(c&&h[a][c]?e=h[a][c]:h[a][d]&&(e=h[a][d]))}f.opentype=e?"preview":"tab",k.requireTaskModule("taskPreview").done(function(){j.Preview(f),j.Util.handleURLChange(b)})}},construct:function(a,b){"t"===zmApp.selectedApp&&(this.responseListConstruct(a,b),x=a.migrated)},currentListObj:function(){return y},responseListConstruct:function(a,d){var e=this;d=d||b,"function"==typeof c&&c(),B.closePreview();var g,h=b,i=[];B.printSelectList=[],B.selectedTask={},f=d.centerObj;var l=B.getCenterObj();if(this.container="search"===d.fromAction?f.listing.centerArr[2]:l[2],d.headerObj&&this.updateHeaderBand(d.headerObj),"leftClick"===d.fromAction&&(A=!1),l[0].hideGroup("zpFilter"),"leftClick"!==d.fromAction&&"dropdown"!==d.fromAction&&"restore"!==d.fromAction&&"search"!==d.fromAction&&"sort"!==d.fromAction||(y.deleteSubscribers&&y.deleteSubscribers(),y=z.constructList(a,h)),i=y.listArrFull,g=this.container.getListElem(),"leftClick"!==d.fromAction&&"dropdown"!==d.fromAction&&"restore"!==d.fromAction&&"sort"!==d.fromAction||g.html(i),"search"===d.fromAction&&(g.append(i),d.taskListing&&(y._centerObj=B.extendListing(d.taskListing._centerObj,y._centerObj))),e.enableQuickTask(d,h,i,l),_.isEmpty(a.list)){var m=$("#notask");if($("div#quickAdd").is(":visible"))m.hide();else if(0===m.length)if("getTasksByDueDate"===h.taction||"getTasksByLabel"===h.taction||"getArchivedTasks"===h.taction||j.Util.isDisabledGroup(h.groupId)){var n=u.noTaskTemplate(h.mode);i.append(n)}else i.append(u.emptyTask()),j.Util.addTaskPopup(i,h)}this.container.setListener("click",_zm.bindFn(y.listClickHandler,y)),this.container.setListener("contextmenu",_zm.bindFn(y.moreActions,y,d.fromAction)),"search"!==d.fromAction&&l[2].setListener("scroll",function(){if(k.hideMenu(),d.taction!==b.taction)return!1;var a=g.scrollTop(),c=g.prop("scrollHeight")-g.height(),f="";f=y.nextPage,Math.floor(a)>=.8*Math.floor(c)&&""!==f&&!y.scroll&&(B.loadingDiv("pagination",$(this)[0]),e.scrollList(d)),$("div.SC_tip").hide()}),g.addClass("zmTasksApp"),g.attr("id","zmTasksApp")},scrollList:function(a){var b=this,c=y.nextPage;y.scroll=!0;var d={},e={};d.taction=e.taction=a.taction,a.categoryId&&(d.categoryId=e.categoryId=a.categoryId),a.labelId&&(d.labelId=e.labelId=a.labelId),a.userId&&(d.userId=e.userId=a.userId),a.status?d.status=e.status=a.status:a.priority?d.priority=e.priority=a.priority:a.mode&&"me"!==a.mode&&(d.mode=e.mode=a.mode),d.groupId=e.groupId=a.groupId,d.start=c,d.next=y.count,"sort"===a.fromAction?(d.labelId=a.labelId,d.isPrev=a.isPrev,d.mode=a.mode,d.startDueDate=y.sDueDate,j.Util.Req.sendSortReq(d,e,function(a){y.appendScrollList(a)})):a.assigneeId?(d.assigneeId=e.assigneeId=a.assigneeId,j.Util.Req.sendAssigneeFilterReq(d,e,function(a){y.appendScrollList(a)})):(e.fromAction="scrollList",j.Util.Req.getTaskList(d,e,function(a){if("PAGINATION_ERROR"===a.code){y.nextPage="";var c=_.omit(d,"start","next");j.Util.Req.getTaskList(c,e,b.responseListConstruct)}else y.appendScrollList(a)}))},clearFilterLoad:function(){var a=this,c=$("#"+zmsuite.getLeft().selId).find("span.zmTreTxt").text();B.loadingDiv("listing");var d=function(c,d){$("span.sum.unreadCount").remove(),b=d,y={},a.responseListConstruct(c,d)};A=!1,a.renderSelectedListing({limit:20},{fromAction:"leftClick",headerObj:{name:c,showMemberCount:!0,filterData:void 0}},d),B.updateFilterURL()},renderSelectedListing:function(a,b,c){var d=B.getSelectedListingParams(a,b);j.Util.Req.send({param:d.param,eparam:d.eprm,callBack:c,writeReq:!1})},updateHeaderBand:function(a){if(a.name){$("#ztDisabledGrp").remove();var c=B.list().list,d=B.getCenterObj(),e=d[0],f=$(e.getDOMNode()[0]).find("div.SC_flt i.msi-action").closest("li"),g=e.iconObjArr.filter(function(a){return a.isHidden===!0}).length;g>=3?f.removeClass("SC_lbr"):f.addClass("SC_lbr");var h="",i=b.groupId;if(a.showMemberCount&&i!==zmail.zuid&&(h=_zm.getDOM(["SPAN",{attrs:{id:"ngroupmembers","class":"SC_lnk"},child:[["text",j.Util.getGroupMembers(i).length+" members"]]}]).outerHTML),a.filterData&&(h=a.filterData),j.Util.isDisabledGroup(i)){var l=_zm.getDOM(["DIV",{attrs:{"class":"SC_simg js-spam-trash-band zmWarnMs",id:"ztDisabledGrp"},child:[["SPAN",{attrs:{"class":"SC_ldot"},child:[["text",v.common.msg.disabledGroupMsg]]}]]}]);e.$el.after(l)}if(a.showGroupDropdown){var m=_zm.getDOM(["DIV",{attrs:{"class":"SCmb"},child:[["UL",{child:[["LI",{attrs:{"class":"SCtxt"},child:[["B",{attrs:{title:"Change group",id:"groupChangeTask"},child:[["DIV",{attrs:{"class":"SC_hd"}}],["SPAN",{child:[["text",a.name],["I",{attrs:{"class":"msi-barrow"}}]]}]]}]]}]]}]]}]).outerHTML;c.left.leftHTML=m+h}else c.left.leftHTML=_.escape(a.name)+h;x===!1&&(c.left.leftHTML+="<span id='mtask' class='SC_lnk'>"+v.center.migrateTask+"</span>");var n=this,p=d[1];if(p.push(c),p.paint(),p.$el.find("#mtask").off("click").on("click",j.Util.Req.migrateTask),p.$el.find("#ngroupmembers").length&&p.$el.find("#ngroupmembers").off("click").on("click",function(){n.showGroupMemberList(i)}),p.$el.find("#clrFilter").off("click").on("click",function(){n.clearFilterLoad()}),a.filterType){var q=p.$el.find(".zmAssigneeFilter"),r=p.$el.find(".SC_tskToggle"),s={fromAction:"dropdown",headerObj:$.extend(a,b.headerObj)};q.length&&(q.data({assignee:String(r.data("zuid")),groupId:String(i)}),j.Util.bindAssignEvents(q,q,function(b,c){if(q.data("assignee")===b.zid)return"-1"===b.zid&&q.text("Unassigned"),void c.hide();if(i===zmail.zuid&&"-1"!==b.zid)return void q.text("");if("assignee"===a.filterType){var d={assigneeId:b.zid,groupId:i,status:"2"};r.hasClass("SC_rwWrite")&&(d.status="3"),j.Util.Req.sendAssigneeFilterReq(d,$.extend(s,d),function(a,c){delete c.headerObj,n.responseListConstruct(a,c),r.data("zuid",b.zid),B.updateFilterURL(["assignee",b.zid])})}else if("createdby"===a.filterType){var e={userId:b.zid,groupId:i,taction:"getGroupTasks"};j.Util.Req.sendCreatedByFilterReq(e,$.extend(s,e),function(a,c){delete c.headerObj,n.responseListConstruct(a,c),B.updateFilterURL(["createdby",b.zid])})}q.data("assignee",b.zid),q.text(b.fn),c.hide()}))}else p.$el.find(".zmAssigneeFilter").attr("contentEditable",!1);var t=[],u=j.Util.getContact(zmail.zuid);zmail.zuid!==i&&t.push({id:zmail.zuid,name:"My Tasks",photo:u.get("photo")});var w=j.Util.Groups();_.each(w,function(a,b){a&&b!==i&&t.push({name:a.attrs.name,id:b,photo:a.attrs.photo})}),p.$el.find("#groupChangeTask").off("click").on("click",function(){var a=k.createFLComp("groups",{data:t,search:"name",display:"name",displayAs:"dropdown",onSelect:function(b){a.hide(),$("#"+b.id).trigger("click")},showCheckbox:!1,showCreate:!1,parentDOM:$("#groupChangeTask")[0],removehandler:!0,showUnread:!1});$("#groupChangeTask").addClass("SC_ddn"),$.publish("/mail/menuCreated",{menuHandler:function(){$(".SC_ddn").removeClass("SC_ddn")}}),a.show()}),p.$el.find(".SC_tskToggle").on("click",this.assigneeTaskStatusToggle.bind(this)),o.store("listing","headerObj",a)}},assigneeTaskStatusToggle:function(a){$(a.target).unbind("click");var c=b,d="3",e=this;$(a.target).hasClass("SC_rwWrite")&&(d="2"),$(a.target).toggleClass("SC_rwWrite"),B.loadingDiv("listing");var f={assigneeId:$(a.target).data("zuid"),groupId:c.groupId,status:d};f.categoryId=c.categoryId,"getPersonalTasks"===c.taction?f.taction=c.taction:f.taction=f.categoryId?"getTasksByCategoryStatus":"getGroupTasks";var g={fromAction:"dropdown"};j.Util.Req.sendAssigneeFilterReq(f,$.extend(g,f),function(b,c){e.responseListConstruct(b,c),$(a.target).bind("click",e.assigneeTaskStatusToggle.bind(e))})},showGroupMemberList:function(a){var b=this,c={gid:a};c.callback=function(a){var c=a.zid,d=a.dialog;if("zm_task"===r.currentTab){if("groups"===zmsuite.getLeft().selLayerId){var e=zmsuite.getLeft().selId;if(e!==String(a.gid))return;var f=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("groups").getRowObjfromId(e),g=f[e].name,h={taction:"getGroupTasks",groupId:e,userId:c},i=e===zmail.zuid,k={taction:"getGroupTasks",groupId:e,headerObj:{name:g,migrate:i},fromAction:"dropdown",selId:e,userId:c,enableQuickTask:!1};f[e].HC===!1&&(h.groupId=k.groupId=f[e].p);var l=j.Util.getContact(c),m=l?l.get("fn"):"";k.headerObj.filterType="createdby",k.headerObj.filterData=j.Util.getFilterHeader(v.common.createdBy,m),b.paramsListConstruct(h,k),B.updateFilterURL(["createdby",c])}d.remove()}},l.load("streamsGroup").done(function(){t.GroupApp.showMemberDialog(c)})},sortOptions:function(){var a=this,b=B.getSelectedListingInfo(),c=[{htm:v.preview.tooltip.duedate+" <i class='msi-rarrow'></i>",data:{key:"datesort"},childCls:"SC_tin",child:function(){return a.dateSort()}}];"getTasksByDueDate"!==b.taction&&c.push({htm:v.center.modifiedDate+" <i class='msi-rarrow'></i>",data:{key:"moddatesort"},childCls:"SC_tin",child:function(){return a.dateSort("modified")}});var d={};return d.list=c,d.divId="zt_sortlist",d.clk=function(b){a.popupActionHandler(b)},d},dateSort:function(a){var b=this,c=[{htm:v.center.sortAscending,data:{key:"asc"}},{htm:v.center.sortDescending,data:{key:"desc"}}],d={};return d.list=c,d.divId="zt_ddlist",d.clk=function(c){B.loadingDiv("listing"),k.hideMenu(),b.fetchSortedList(c.key,!1,a)},d},fetchSortedList:function(a,c,d){var e="asc"===a,f=b,g={groupId:f.groupId,isPrev:e},h={fromAction:"sort",isPrev:e,groupId:f.groupId};"getMyTasks"===f.taction?g.labelId=h.labelId="mytasks":"getPersonalTasks"===f.taction?g.labelId=h.labelId="personaltasks":"getTasksByMe"===f.taction&&(g.labelId=h.labelId="createdbyme"),f.categoryId&&(g.categoryId=h.categoryId=f.categoryId);var i=zmsuite.getLeft().selId,k=$("#"+i).find("span.zmTreTxt").text();if(c)h.isPrev=g.isPrev=!0,g.mode=h.mode="delayed",h.headerObj={name:k,filterData:j.Util.getFilterHeader(v.common.app_name,v.common.delayed)};else{var l="modified"===d?v.center.sortByModifiedDate:v.center.SortDueDate;h.headerObj={name:k,filterData:j.Util.getFilterHeader(l,e?v.center.sortAscending:v.center.sortDescending)}}g.taction=h.taction=d&&"modified"===d?"getTasksSortedByModifiedDate":"getTasksSortedByDueDate","getTasksByDueDate"===f.taction&&(g.taction=h.taction="getTasksByDueDate"),f.mode&&"getTasksByDueDate"===f.taction&&(g.mode=h.mode=f.mode),b=h,j.Util.Req.sendSortReq(g,h,this.responseListConstruct.bind(this))},filterOptions:function(){var a=this,c=b,d=[];"getGroupTasks"!==c.taction&&"getTasksByCategory"!==c.taction||d.push({htm:v.center.assignee+"<i class='msi-rarrow'></i>",data:{key:"assignee"},childCls:"SC_tin",child:function(){return a.assigneeFilter()}}),"getGroupTasks"===c.taction&&d.push({htm:v.center.createdby+"<i class='msi-rarrow'></i>",data:{key:"createdby"},childCls:"SC_tin",child:function(){return a.createdByFilter()}}),"getPersonalTasks"===c.taction&&d.push({htm:v.center.assignee+"<i class='msi-rarrow'></i>",data:{key:"assignee"},childCls:"SC_tin",child:function(){return a.assigneeFilter()}}),d.push({htm:v.center.status+"<i class='msi-rarrow'></i>",data:{key:"status"},childCls:"SC_tin",child:function(){return a.statusOptions()}},{htm:v.center.priority+"<i class='msi-rarrow'></i>",data:{key:"priority"},childCls:"SC_tin",child:function(){return a.priorityOptions()}}),"getMyTasksAndCategory"!==c.taction&&"getGroupTasks"!==c.taction&&"getTasksByCategory"!==c.taction&&"getPersonalTasks"!==c.taction||d.push({htm:"Tag<i class='msi-rarrow'></i>",data:{key:"priority"},childCls:"SC_tin",child:function(){return a.showTagList()}}),d.push({htm:v.left.delayedtask,data:{type:"overdueTask"},childCls:"SC_tin"}),("getPersonalTasks"!==c.taction||zmail.showFeature&&"getPersonalTasks"===c.taction)&&d.push({htm:"Archived Tasks",data:{type:"archivedtasks"},childCls:"SC_tin"});var e={};return e.list=d,e.divId="zt_filterlist",e},showTagList:function(){var a=this,b=zmail.labInfo,c=[],d={},e=0;for(var f in b)d={},d.labelId=b[f].id,d.lA="add",d.disp=b[f].dispName,d.type="label",c[e]={htm:b[f].dispName,data:d},e++;var g={};return g.list=c,g.divId="zt_tagslist",g.clk=function(b){B.loadingDiv("listing"),a.popupActionHandler(b)},g},createdByFilter:function(){var a=this,c=b,d=[];zmail.ContactBook.get({groupid:c.groupId}).done(function(a){$.each(a,function(a,b){var c=zdom("div",null,zdom("div",{title:b.attrs.eid},b.attrs.fn,zdom("span",null,b.attrs.eid)),zdom("div",{className:"SC_avtr avtrBg2"},zdom("img",{alt:"SL",ref:"photo",src:b.attrs.photo})));d.push({htm:c.innerHTML,data:b.attrs})})});var e={};return e.list=d,e.divId="zt_createdbylist",e.clk=function(b){B.loadingDiv("listing");var d={userId:b.zid,groupId:c.groupId,taction:"getGroupTasks"},e=i.applyArgs(v.common.createdBy,{filter:v.center.createdby}),f={filterData:j.Util.getFilterHeader(e,b.fn)};f.filterType="createdby";var g={fromAction:"dropdown",taction:"getGroupTasks",selId:c.groupId,userId:b.zid,headerObj:j.Util.copyNewProps(f,c.headerObj)};j.Util.Req.sendCreatedByFilterReq(d,$.extend(g,d),a.responseListConstruct.bind(a)),k.hideMenu(),B.updateFilterURL(["createdby",b.zid])},e},assigneeFilter:function(){var a=this,c=b,d=[],e=function(a){var b=zdom("div",null,zdom("div",{title:a.attrs.eid},a.attrs.fn,zdom("span",null,a.attrs.eid)),zdom("div",{className:"SC_avtr avtrBg2"},zdom("img",{alt:"SL",ref:"photo",src:a.attrs.photo})));return b},f=[];if(c.groupId===zmail.zuid){var g={zuid:zmail.zuid,promise:!1};g.type=zmail.isOrg?"org":void 0;var h=$.extend({attrs:{fn:"Me"}},zmail.ContactBook.get(g)[0]);f.push(h)}else f=zmail.ContactBook.get({groupid:c.groupId,promise:!1});$.each(f,function(a,b){var c=e(b);d.push({htm:c.innerHTML,data:b.attrs})});var l={};l.list=d,l.divId="zt_assigneelist";var m={groupId:c.groupId,categoryId:c.categoryId,status:"2"};return m.taction="getTasksByCategory"===c.taction?"getTasksByCategoryStatus":c.taction,l.clk=function(b){B.loadingDiv("listing"),m.assigneeId=b.zid,B.updateFilterURL(["assignee",b.zid]);var d=i.applyArgs(v.center.filterBy,{filter:v.center.assignee}),e={filterData:j.Util.getFilterHeader(d,b.fn,b.zid)};e.filterType="assignee";var f={fromAction:"dropdown",headerObj:j.Util.copyNewProps(e,c.headerObj)};j.Util.Req.sendAssigneeFilterReq(m,$.extend(f,m),a.responseListConstruct.bind(a)),k.hideMenu()},l},statusOptions:function(){var a=this,b=[{htm:v.center.inprogress,data:{type:"status",key:"inprogress"}},{htm:v.center.completed,data:{type:"status",key:"completed"}}],c={};return c.list=b,c.divId="zt_statuslist",c.clk=function(b){B.loadingDiv("listing"),a.popupActionHandler(b)},c},priorityOptions:function(){var a=this,b=[{htm:v.center.high,data:{type:"priority",key:"high"}},{htm:v.center.medium,data:{type:"priority",key:"medium"}},{htm:v.center.low,data:{type:"priority",key:"low"}}],c={};return c.list=b,c.divId="zt_prioritylist",c.clk=function(b){B.loadingDiv("listing"),a.popupActionHandler(b)},c},popupActionHandler:function(a){var c=b,d=this,e={},f={};e.groupId=f.groupId=c.groupId,f.fromAction="dropdown";var g,h=[];switch(a.type){case"status":e.taction=f.taction="getTasksByStatus","getPersonalTasks"===c.taction?(e.taction=f.taction=c.taction,c.categoryId&&(e.categoryId=f.categoryId=c.categoryId)):c.categoryId&&(e.taction=f.taction="getTasksByCategoryStatus",e.categoryId=f.categoryId=c.categoryId),"inprogress"===a.key?e.status=f.status=2:"completed"===a.key&&(e.status=f.status=3),g=j.Util.getHeaderBandValues(f),"getTasksByMe"===c.taction&&(e.labelId="createdbyme",g.headerValue=v.left.createdbyme),f.headerObj={name:g.headerValue,migrate:!1,filterData:g.filterData},b=f,d.paramsListConstruct(e,f),h.push(a.type,e.status);break;case"priority":e.taction=f.taction="getTasksByPriority","getPersonalTasks"===c.taction?(e.taction=f.taction=c.taction,c.categoryId&&(e.categoryId=f.categoryId=c.categoryId)):c.categoryId&&(e.categoryId=f.categoryId=c.categoryId),"high"===a.key?e.priority=f.priority=2:"medium"===a.key?e.priority=f.priority=3:"low"===a.key&&(e.priority=f.priority=4),f.searchAction=!0,b=f,g=j.Util.getHeaderBandValues(f),"getTasksByMe"===c.taction&&(e.labelId="createdbyme",g.headerValue=v.left.createdbyme),f.headerObj={name:g.headerValue,migrate:!1,filterData:g.filterData},d.paramsListConstruct(e,f),h.push(a.type,e.priority);break;case"exportTask":d.exportTask();break;case"importTask":d.importTask();break;case"viewall":var i=B.getSelectedListingInfo();d.paramsListConstruct(i,i);break;case"label":e.taction=f.taction="getTasksByLabel",e.labelId=f.labelId=a.labelId,e.groupId=f.groupId=c.groupId,e.categoryId=f.categoryId=c.categoryId,f.fromAction="leftClick",f.selId=zmsuite.getLeft().selId,f.labelName=a.disp,b=f,g=j.Util.getHeaderBandValues(f),f.headerObj={name:g.headerValue,migrate:!1,filterData:g.filterData},d.paramsListConstruct(e,f),h.push("tags",a.labelId);break;case"overdueTask":d.fetchSortedList(!0,!0),h.push("delayed");break;case"archivedtasks":if(e={},f={},"getPersonalTasks"===b.taction){d.getArchivedInPersonal();break}var l=B.getSelectedListingInfo();e.taction=f.taction="getArchivedTasks",e.labelId=f.labelId=l.mode,e.groupId=f.groupId=c.groupId,e.categoryId=f.categoryId="getTasksByCategory"===c.taction?c.categoryId:void 0,f.fromAction="leftClick",b=e,g=j.Util.getHeaderBandValues(e),f.headerObj={name:l.name,migrate:!1,filterData:g.filterData},d.paramsListConstruct(e,f),h.push("archived");break;case"bulkarchive":case"bulkunarchive":d.bulkArchive(a.type)}B.updateFilterURL(h),k.hideMenu()},bulkArchive:function(a){var c={},d={},e=this,f="bulkarchive"===a?v.common.bulkarchivemsg:v.common.bulkunarchivemsg;c.streamsView=d.streamsView=!0,c.taction=d.taction="bulkActions",c.mode=d.mode="bulkarchive"===a?"archiveTask":"unArchiveTask",c.groupId=d.groupId=b.groupId,c.categoryId=d.categoryId=b.categoryId,c.entityIds=d.entityIds=_.keys(B.selectedTask).join(","),j.Util.Req.send({param:c,eparam:d,callBack:function(a,b){$.publish("/zm/task/bulkdelete",[a,b]),e.removeSelection(),k.succErrMsg("s",f)},fallback:function(a,b){e.removeSelection(),k.succErrMsg("e",a.msg)},writeReq:!0})},openPreviousTask:function(){var a,b=0,c=y,d={};if(d.next=!1,!c.openTaskId)return d.prev=!0,void this.openFirstTask(c,d);var e=$("#"+c.openTaskId),f=e.data();if(b=c.listArr.indexOf(f.groupId+"#"+c.openTaskId),0!==b){var g,h,i,j,l,m;if(a=c._centerObj[f.groupId][c.openTaskId],"task"===f.type)m=this.getPrevParent(a.listingEl[0]),g=m.attr("id"),f=m.data(),i=f.groupId,a=c._centerObj[i][g],a.subtaskloaded&&(j=a.sublistingObj,l=a.sublistArr,h=l[l.length-1].replace(i+"#",""),a=j[i][h]);else if("sublist"===f.type){var n=c._centerObj[f.groupId][f.pTaskId];j=n.sublistingObj,l=n.sublistArr,b=l.indexOf(f.groupId+"#"+c.openTaskId),l[b-1]?(h=l[b-1].replace(f.groupId+"#",""),a=j[f.groupId][h],d.prev=!1):0===c.listArr.indexOf(f.groupId+"#"+f.pTaskId)?d.prev=!0:(a=n,d.prev=!1)}y.openTaskinListing(a,d),null!==a.listingEl[0].previousSibling&&k.initScroll(B.getCenterObj()[2].$el,$(a.listingEl[0].previousSibling),a.listingEl,"prev",!0)}},openFirstTask:function(a,b){var c=a.listArr[0].split("#"),d=c[0],e=c[1],f=a._centerObj[d][e];a.openTaskinListing(f,b)},getPrevParent:function(a){var b=a.previousSibling,c=$(b).attr("id");return c.indexOf("tv")!==-1&&(b=b.previousSibling),$(b)},getNextParent:function(a){var b=a.nextSibling,c=$(b).attr("id");return c.indexOf("tv")!==-1&&(b=b.nextSibling),$(b)},openNextTask:function(){var a,b=0,c=y,d={};if(d.next=!1,!c.openTaskId)return d.prev=!0,void this.openFirstTask(c,d);var e=$("#"+c.openTaskId),f=e.data();if(b=c.listArr.indexOf(f.groupId+"#"+c.openTaskId),b!==c.listArr.length-1){var g,h,i,j,l,m;if(a=c._centerObj[f.groupId][c.openTaskId],"task"===f.type)a.subtaskloaded?(j=a.sublistingObj,l=a.sublistArr,h=l[0].replace(f.groupId+"#",""),a=j[f.groupId][h],d.prev=!1):(m=this.getNextParent(a.listingEl[0]),g=m.attr("id"),f=m.data(),i=f.groupId,a=c._centerObj[i][g],d.prev=!1);else if("sublist"===f.type){var n=c._centerObj[f.groupId][f.pTaskId];j=n.sublistingObj,l=n.sublistArr,b=l.indexOf(f.groupId+"#"+c.openTaskId),l[b+1]?(h=l[b+1].replace(f.groupId+"#",""),a=j[f.groupId][h],d.prev=!1):c.listArr.indexOf(f.groupId+"#"+f.pTaskId)===c.listArr.length-1?d.next=!0:(m=this.getNextParent(n.listingEl[0]),g=m.attr("id"),f=m.data(),i=f.groupId,a=c._centerObj[i][g],d.next=!1)}y.openTaskinListing(a,d),null!==a.listingEl[0].previousSibling&&k.initScroll(B.getCenterObj()[2].$el,a.listingEl,$(a.listingEl[0].previousSibling),"next",!0)}},bindCreatedByFilter:function(){var a=b,c=this;$("#zm_dropDown").find("li:eq(1)").on("mouseover",function(b){var d=$("#zt_createdbylist"),e=$("<div/>",{"data-disableshortcuts":!0}),f=$("<span/>",{"class":"SC_ddSch"}),g=$("<i/>",{"class":"msi-search"});g.appendTo(f);var h=$("<input/>",{type:"text",placeholder:v.common.createdByPlaceHolder});h.appendTo(f),f.appendTo(e),d.prepend(e);var l=d.find("ul");l.addClass("SC_P2r zmTsdd");var m=l.closest("div");m.css("max-height",.4*screen.height+"px"),m.addClass("zmDDScroll"),h.off("keyup").on("keyup",function(b){var d=l.find("li.sel");if(d.length>0){if(40===b.keyCode)return d.removeClass("sel"),d.next("li").addClass("sel"),!1;if(38===b.keyCode)return d.removeClass("sel"),d.prev("li").addClass("sel"),!1}else if(38===b.keyCode||40===b.keyCode)return $(l.find("li")[0]).addClass("sel"),!1;if(13===b.keyCode){var e=d.data();B.loadingDiv("listing");var f={assigneeId:e.zid,groupId:a.groupId,status:"2"},g=i.applyArgs(v.common.createdBy,{filter:v.center.createdby}),h={filterData:j.Util.getFilterHeader(g,e.fn,e.zid)};h.filterType="createdby";var n={fromAction:"dropdown",headerObj:j.Util.copyNewProps(h,a.headerObj)};return j.Util.Req.sendCreatedByFilterReq(f,$.extend(n,f),c.responseListConstruct.bind(c)),B.updateFilterURL(["createdby",e.zid]),k.hideMenu(),!1}var o={type:"org"},p=[],q=$(this).val().trim();o.str=q,m.css("height",""),zmail.ContactBook.get(o).done(function(a){p=p.concat(a),l.empty(),$.each(p,function(a,b){var c=$("<li/>");c.data(b.attrs);var d=$("<div/>",{title:b.attrs.eid}).text(b.attrs.fn).append($("<span/>").text(b.attrs.eid));c.append(d);var e=$("<div/>",{"class":"SC_avtr avtrBg2"}).append($("<img/>",{alt:"SL",ref:"photo",src:b.attrs.photo}));c.append(e),l.append(c)})})})})},bindAssigneeFilter:function(){var a=b,c=this,d={groupId:a.groupId,status:"2"},e={fromAction:"dropdown"};e.taction=d.taction="getTasksByCategory"===a.taction?"getTasksByCategoryStatus":a.taction,e.categoryId=d.categoryId=a.categoryId;var f=i.applyArgs(v.center.filterBy,{filter:v.center.assignee});$("#zm_dropDown").find("li:eq(0)").on("mouseover",function(b){var g=$("#zt_assigneelist"),h=u.unAssignedTask();g.prepend(h),$(h).on("click",function(b){d.assigneeId="-1",B.updateFilterURL(["assignee","-1"]);var g={filterData:j.Util.getFilterHeader(f,v.center.unassigned,"-1")};g.filterType="assignee",e.headerObj=j.Util.copyNewProps(g,a.headerObj),j.Util.Req.sendAssigneeFilterReq(d,$.extend(e,d),c.responseListConstruct.bind(c)),k.hideMenu()});var i=$("<div/>",{"data-disableshortcuts":!0}),l=$("<span/>",{"class":"SC_ddSch"}),m=$("<i/>",{"class":"msi-search"});m.appendTo(l);var n=$("<input/>",{type:"text",placeholder:v.common.assigneeFilterPlaceholder});n.appendTo(l),l.appendTo(i),g.prepend(i);var o=$(g.find("ul")[1]);o.addClass("SC_P2r zmTsdd");var p=o.closest("div");p.css("max-height",.4*screen.height+"px"),p.addClass("zmDDScroll"),n.off("keyup").on("keyup",function(b){var g=o.find("li.sel");if(g.length>0){if(40===b.keyCode)return g.removeClass("sel"),g.next("li").addClass("sel"),!1;if(38===b.keyCode)return g.removeClass("sel"),g.prev("li").addClass("sel"),!1}else if(38===b.keyCode||40===b.keyCode)return $(o.find("li")[0]).addClass("sel"),!1;if(13===b.keyCode){var h=g.data();if(h){B.loadingDiv("listing"),d.assigneeId=h.zid,B.updateFilterURL(["assignee",h.zid]);var i={filterData:j.Util.getFilterHeader(f,h.fn,h.zid)};i.filterType="assignee",e.headerObj=j.Util.copyNewProps(i,a.headerObj),j.Util.Req.sendAssigneeFilterReq(d,$.extend(e,d),c.responseListConstruct.bind(c)),k.hideMenu()}return!1}var l={type:"org"},m=[],n=$(this).val().trim();l.str=n,p.css("height",""),zmail.ContactBook.get(l).done(function(a){m=m.concat(a),o.empty(),$.each(m,function(a,b){var c=$("<li/>");c.data(b.attrs);var d=$("<div/>",{title:b.attrs.eid}).text(b.attrs.fn).append($("<span/>").text(b.attrs.eid));c.append(d);var e=$("<div/>",{"class":"SC_avtr avtrBg2"}).append($("<img/>",{alt:"SL",ref:"photo",src:b.attrs.photo}));c.append(e),o.append(c)})})})})},getActionIcons:function(){var a=[],c=b.taction;switch(c){case"getMyTasks":case"getTasksByCategory":case"getGroupTasks":case"getTasksByMe":case"getTasksByStatus":case"getTasksByCategoryStatus":case"getTasksByPriority":case"getArchivedTasks":case"getTasksSortedByDueDate":case"getPersonalTasks":a=[{groupId:"taskfilter",actionArr:[{iconList:["msi-filter"],dropAction:!0}]},{groupId:"sort",actionArr:[{iconList:["msi-sort"],tooltip:v.common.sortBy,dropAction:!0}]},{groupId:"action",actionArr:[{iconList:["msi-action"],dropAction:!0,separator:!0}]}];break;case"getTasksByDueDate":"today"!==b.mode&&(a=[{groupId:"sort",actionArr:[{iconList:["msi-sort"],tooltip:v.common.sortBy,dropAction:!0}]}])}return a},canListArchive:function(){var a=b.taction;if(j.Util.isGroupOwner(b.groupId)||j.Util.isGroupModerator(b.groupId))switch(a){case"getGroupTasks":case"getTasksByCategory":case"getPersonalTasks":return{htm:v.center.archiveTask,
data:{type:"bulkarchive"}};case"getArchivedTasks":return{htm:v.center.unarchiveTask,data:{type:"bulkunarchive"}}}return!1},moreActionDropDown:function(){var a=[];if(Object.keys(B.selectedTask).length){a.push({htm:v.center.exportTask,data:{type:"exportTask"}});var b=this.canListArchive();b&&a.push(b)}else a.push({htm:"<div id='importtask' style='display:inline;'>"+v.center.importTask+"</div>",data:{type:"importTask"}});return a},dropdown:function(){var a=this,b=this.getActionIcons(),c={list:b,clk:function(b,c){var d;$(b.target).closest("li").find("b").addClass("SC_ddn"),"msi-action"===c?d=a.moreActionDropDown():"msi-sort"===c?d=a.sortOptions().list:"msi-filter"===c&&(d=a.filterOptions().list),zmsuite.showMenu({par:$(b.target).closest("li"),list:d,align:"pleft",clk:function(b){"overdueTask"!==b.type&&"archivedtasks"!==b.type||B.loadingDiv("listing"),a.popupActionHandler(b)}}),$("#zm_dropDown").find("div#importtask").on("mouseover",function(){$("#zt_statuslist").hide(),$("#zt_filterlist").hide(),$("#zt_prioritylist").hide()}),"msi-filter"===c&&(a.bindAssigneeFilter(),a.bindCreatedByFilter())}};return c},enableQuickTask:function(a,b,c,d){a.enableQuickTask?(this.quickTask(c[0],a),d[0].$el.addClass("noBdr")):d[0].$el.removeClass("noBdr")},quickTask:function(){var a,b,c,d,e,f=function(){$(b).val(""),$(b).focus();var a=$(d).find("b")[0];a&&(a.remove(),q.mentionData(b).from[0]=0)},g=function(a){a?($(c).show(),$(b).attr("disabled","disabled"),$(b).css("cursor","pointer")):($(c).hide(),$(b).removeAttr("disabled","disabled"),$(b).css("cursor","text"),f())},h=function(a,b){y.addTaskCallback(null,a,b),g(!1)},i=function(a){a&&(k.succErrMsg("e",a.msg),g(!1))},l=function(a){var b=$(a).val().trim(),c=s.getMentions(a);if(void 0!==c&&c.length){var d=q.mentionData(a);b=b.substring(0,d.from[0])}return b.length<=0?(k.succErrMsg("e",v.errorMsg.enterTitle),!1):!(b.length>w)||(k.succErrMsg("e",v.errorMsg.titleLen),!1)},m=function(){j.Util.bindMention({titleEl:b,groupId:e.groupId,keypress:!0}),d=$(a).find("div.zm_mention")[0],$(d).css("overflow","hidden"),$(b).off("keypress").on("keypress",function(a){var b=13!==a.keyCode||l(this);if(!b)return!1;if(13===a.keyCode&&b){var c,d=s.getUserText(this),f=s.getMentions(this);if(void 0!==f&&f.length){var k=q.mentionData(this);c=k.text[0],d=d.substring(0,k.from[0])}var m={title:d},n={};return m.taction=n.taction="addTaskSubtask",m.actionType="addEntity",n.fromAction="leftClick",m.groupId=n.groupId=e.groupId,m.categoryId=n.categoryId=e.categoryId,n.type="ptask",m.lockinvites=!1,m.assignee=c,m.invitees=n.invitees=m.groupId===zmail.zuid?m.assignee:void 0,m.actionSrc=n.actionSrc="quicktask",j.Util.Req.taskReq(m,n,h,!0,i),g(!0),!1}})},n=function(){b=$(a).find("textarea"),$(a).off("focus click contextmenu").on("focus click contextmenu",function(a){$(this).addClass("focus"),$(b).focus(),a.stopPropagation()}),$(a).off("focusout").on("focusout",function(a){$(this).removeClass("focus")}),c=$(a).find("span.js-loading"),m()};return function(b,c){e=c,a=$(u.quickTask()),$(b).prepend(a),n()}}(),exportTask:function(){var a=this;k.secureDownloader().then(function(c){var d={};switch(d.entityId=_.keys(B.selectedTask).join(","),b.taction){case"getTasksByDueDate":case"getTasksByMe":case"getTasksByLabel":case"getMyTasks":d.groupIds=_.values(B.selectedTask).join(",");break;default:d.groupId=b.groupId}d.taction="exportTask",c.password&&(d.password=c.password),B.hideMenu(),j.Util.Req.getAllProjects(d,void 0,function(b){a.removeSelection(),k.succErrMsg("s",v.center.exportTaskNotif)},function(b){a.removeSelection(),k.succErrMsg("e",b.msg)})})},removeSelection:function(){zmsuite.getCenter()[0].$el.find(".zmL.SC_check").removeClass("SC_check")},importTask:function(){if(B.model.attachRef)B.model.attachRef.init();else{var a={componentId:"task",attachFrom:["desktop"],isNewImp:!0,actionMode:1,autoLaunch:!0,desktop:{multiple:!1,allowedType:{type:".csv",error:B.model.imperror},uploadCallBack:B.imTask}};k.initAttachComponent(a,function(a){B.model.attachRef=a})}},showCheatSheet:function(){var a=new Date,b=a.getDate(),c=a.toLocaleString("en",{month:"short"}),d=a.getFullYear(),e=zmail.cmpdata.DEFFRM_ADDR.split("@"),f={userid:e[0],dname:e[1],d:b,m:c,fy:d,ny:d+1},g=function(){$("#cheatsheet").remove(),n.remove()},h=u.cheatSheet(f),i={title:v.cheatsheet.cheatsheet,mask:!0,style:{"max-width":"1080px",top:"44.33px"},heightPercent:100,closeaction:function(){g()}};if(!$("#cheatsheet").length){var j=$("<div />",{id:"cheatsheet"});$("body").append(j)}var l=document.getElementById("cheatsheet");l.appendChild(h),n.create("cheatsheet",i),$(l).find("span.SC_lnk").on("click",function(a){var b=$(a.target),c=b.text(),d={TO:c};if(b.closest("span#groupmail").length>0){var e=b.closest("span#groupmail").find("span.SC_lnk");d.TO=$(e[0]).text()}k.compose(d),n.remove()})},getCurrentList:function(){return y}},new C},window.zmTask=window.zmTask||{},window.zmTask.TaskList=g,g}),define([],function(a){var b,c=a("zmText"),d=a("zmTask"),e=a("zmUtil"),f=a("zmComponent"),g=a("zmTaskRestore"),h=c.get("taskUtil"),i=!0,j={},k={},l={getCenterObj:function(a,b){var c,d=a||0;b=b||"zm_task";try{c=zmsuite.getCenter(b)[d].getNodes()}catch(e){c=zmsuite.getCenter()[0].getNodes()}return c},loadingDiv:function(a,c){c=c?c:l.getCenterObj()[2].$el[0],b=f.loadingBand({container:c,type:a})},list:function(){var a={list:{left:{chkBox:!1,leftHTML:"Task"},right:[]},clk:function(){}};return a}},m=function(f,m,n,o){var p=function(){this.projectId=f.portalId,this.render(),this.listInit()};return p.prototype={render:function(){var a=l.getCenterObj();k=c.get("projectsinteg");var d=this.dropdown();a[0].push(d.list);var e=l.list();a[1].push(e.list),a[1].setListener("click",e.clk),zmsuite.renderCenter();var f=a[0].$el.find(".SC_flt");f.on("click",function(a){var b="B"===a.target.tagName?$(a.target).find("i").attr("class"):a.target.className;d.clk(a,b)}),"function"==typeof b&&b()},listInit:function(){if(zmail.projectsInteg.portalsData[this.projectId].projects)this.loadProjectDetails(zmail.projectsInteg.portalsData[this.projectId].projects[0],o);else{var a=this;this.initProjectPortals().done(function(){"object"===("undefined"==typeof o?"undefined":babelHelpers["typeof"](o))&&o.resolve(a)})}},updateHeaderBand:function(a){var b=this;$("#ztDisabledGrp").remove(),g.store("listing","headerObj",a);var c=l.list().list,f=m,j=f.portalId,k=zmail.projectsInteg.portalsData[j];c.left.leftHTML=k.name,f.currentProject&&(c.left.leftHTML+='<span class="sum" id="projDD">'+_zm.escapeTags(f.currentProject.name)+'<i class="msi-barrow"></i></span>'),a&&(c.left.leftHTML+='<span class="sum">'+a+"</span>"),i===!1&&(c.left.leftHTML+="<span id='mtask' class='SC_lnk'>"+h.center.migrateTask+"</span>");var n=zmsuite.getCenter()[0].getNodes()[1];n.push(c),n.paint(),n.$el.find("#mtask").off("click").on("click",d.Util.Req.migrateTask);var o=zmail.projectsInteg.util.getAutofillArray({obj:k.projects,tab:"tasks"});n.$el.find(".msi-barrow").off("click").on("click",function(){var a={};a.parentDOM=n.$el.find("#projDD"),a.displayAs="dropdown",a.dataCallback=function(){return o};var c=e.createFLComp("projectList",a);a.onSelect=function(a,d){f.currentProject.id_string!==a&&(b.loadProjectDetails(d.obj),l.loadingDiv("listing")),c.hide()},c.show()})},loadPreview:function(a){if(Array.isArray(a)&&a.indexOf("t")!==-1){var b=a[a.length-1],c=j.centerListingObj[b];c?j.openTaskinListing(c):(e.succErrMsg("e",h.errorMsg.entityDoNotExist),d.Util.handleCloseTask())}},initProjectPortals:function(){var a=this;g.store("listing","param",f),g.store("listing","eparam",f);var d=$.Deferred(),e=function(b){zmail.projectsInteg.util.fetchAllProjects(b).done(function(){a.loadProjectDetails(zmail.projectsInteg.portalsData[a.projectId].projects[0],d)})},h=function(){a.updateHeaderBand();var d="//projects."+zmail.zohoUrl+"/portal/"+zmail.projectsInteg.portalsData[m.portalId].name+"#allprojects";l.getCenterObj()[2].getListElem().html("<center style='height:50px; padding-top:25px;'>"+c.applyArgs(c.get("preUtils").integration.projects.noActiveProjects,{portalName:zmail.projectsInteg.portalsData[a.projectId].name,link:"<a class='SC_link' target='_blank' href='"+d+"'>",closeLink:"</a>",companyName:zmail.globalI18N.companyName})+"</center>"),b()},i=function(b,c){200===c.status&&(zmail.projectsInteg.portalsData[a.projectId]=b.portals[0],b.portals[0].project_count&&b.portals[0].project_count.active?e(zmail.projectsInteg.portalsData[a.projectId]):(zmail.projectsInteg.portalsData[a.projectId].project_count={active:0},h()))};return zmail.projectsInteg.portalsData[this.projectId].project_count?zmail.projectsInteg.portalsData[this.projectId].project_count.active?e(zmail.projectsInteg.portalsData[this.projectId]):h():zmail.projectsInteg._core.getPortalDetails({portalId:this.projectId,cFn:i}),d.promise()},loadProjectDetails:function(a,b){var c=this;m.currentProject=a,this.updateHeaderBand(),l.getCenterObj()[0].showGroup("zpFilter");var d=$.Deferred();$.isEmptyObject(a.users)?zmail.projectsInteg.util.fetchAllUsers(a).done(function(){a.userIds=zmail.projectsInteg.util.getIdsArr(a.users),d.resolve()}):d.resolve(),$.isEmptyObject(a.tasklists)&&zmail.projectsInteg.util.fetchAllTasklists(a);var e=function(d){c.construct(zmail.projectsInteg.util.constructList(d,a)),"object"===("undefined"==typeof b?"undefined":babelHelpers["typeof"](b))&&b.resolve(c)};d.done(function(){zmail.projectsInteg._core.getTasks({u:a.link.task.url,cFn:e})})},construct:function(a){"t"===zmApp.selectedApp&&(this.constructList(a),i=a.migrated)},constructList:function(c){var d=m,e=l.getCenterObj();this.container=e[2];var f=a("zpTaskList");j.deleteSubscribers&&j.deleteSubscribers(),j=f.constructList(c,d),this.listArr=j.listArrFull,this.taskListElem=this.container.getListElem(),this.taskListElem.html(this.listArr),this.container.setListener("click",function(a,b){j.listClickHandler(a,b)});var g=this;this.container.setListener("scroll",function(){var a=g.taskListElem.scrollTop(),c=g.taskListElem.prop("scrollHeight")-g.taskListElem.height();if(Math.floor(a)>=.8*Math.floor(c)&&j.nextPage){j.nextPage=!1;var e={};e.index=j.count+1,e.status=d.status,e.priority=d.priority,l.loadingDiv("pagination",$(this)[0]);var f=function(a){b(),j.appendScrollList(zmail.projectsInteg.util.constructList(a,d.currentProject))};zmail.projectsInteg._core.getTasks({u:d.currentProject.link.task.url,p:e,cFn:f})}})},projectsOptions:function(){var a=this,b=[],c=m,f=zmail.projectsInteg.portalsData[c.portalId].projects,g=c.currentProject.id_string;f.forEach(function(a){var c={},e={};c.htm=(g===a.id_string?"<i class='msi-tick'></i>":"")+d.Util.escapeSpecialChar(a.name),e.project=a,e.type="projects",e.key=d.Util.escapeSpecialChar(a.name),c.data=e,b.push(c)});var h={};return h.list=b,h.divId="zt_projectslist",h.clk=function(b,c,d){!b||$(d.target).hasClass("msi-tick")||$($(d.target).find(".msi-tick")).hasClass("msi-tick")||(a.loadProjectDetails(b.project),l.loadingDiv("listing")),e.hideMenu()},h},filterOptions:function(){var a=this,b=[{htm:k.projects+"<i class='msi-rarrow'></i>",data:{key:"projects"},childCls:"SC_tin",child:function(){return a.projectsOptions()}},{htm:h.center.status+"<i class='msi-rarrow'></i>",data:{key:"status"},childCls:"SC_tin",child:function(){return a.statusOptions()}},{htm:h.center.priority+"<i class='msi-rarrow'></i>",data:{key:"priority"},childCls:"SC_tin",child:function(){return a.priorityOptions()}}],c={};return c.list=b,c.divId="zt_filterlist",c},statusOptions:function(){var a=this,b=[{htm:h.center.inprogress,data:{type:"status",key:"inprogress"}},{htm:h.center.completed,data:{type:"status",key:"completed"}},{htm:"Both",data:{type:"status",key:"all"}}],c={};return c.list=b,c.divId="zt_statuslist",c.clk=function(b){l.loadingDiv("listing"),a.popupActionHandler(b)},c},priorityOptions:function(){var a=this,b=[{htm:h.center.high,data:{type:"priority",key:"high"}},{htm:h.center.medium,data:{type:"priority",key:"medium"}},{htm:h.center.low,data:{type:"priority",key:"low"}},{htm:k.tasks.none,data:{type:"priority",key:"none"}},{htm:"All",data:{type:"priority",key:"all"}}],c={};return c.list=b,c.divId="zt_prioritylist",c.clk=function(b){l.loadingDiv("listing"),a.popupActionHandler(b)},c},popupActionHandler:function(a){var b,c=m,d=this,f={},g=function(a){d.construct(zmail.projectsInteg.util.constructList(a,c.currentProject),c)};switch(a.type){case"status":f={},f.status=a.key,"inprogress"===a.key?(b=k.tasks.inprogress,f.status="notcompleted"):b="completed"===a.key?k.tasks.completed:k.tasks.all,f.status="inprogress"===a.key?"notcompleted":a.key,delete c.priority,c.status=f.status,zmail.projectsInteg._core.getTasks({u:c.currentProject.link.task.url,p:f,cFn:g}),l.loadingDiv("listing"),d.updateHeaderBand(b);break;case"priority":f={},f.priority=a.key,b="all"!==a.key&&"none"!==a.key?"Tasks with "+a.key+" priority":"all"===a.key?k.tasks.all:"No Priority Tasks",delete c.status,c.priority=f.priority,zmail.projectsInteg._core.getTasks({u:c.currentProject.link.task.url,p:f,cFn:g}),l.loadingDiv("listing"),d.updateHeaderBand(b);break;case"viewall":d.loadProjectDetails(c.projects[0])}e.hideMenu()},dropdown:function(){var a=this,b=[{groupId:"zpFilter",actionArr:[{iconList:["msi-filter"],dropAction:!0}]}],c={list:b,clk:function(b,c){var d;"msi-filter"===c&&(d=a.filterOptions().list),zmsuite.showMenu({par:$(b.target).closest("li"),list:d,align:"pleft",clk:function(b){a.popupActionHandler(b)}})}};return c},getCurrentList:function(){return j}},new p};return window.zmTask=window.zmTask||{},window.zmTask.ProjectList=m,m}),function(){var a={INTENTIONAL_SPACE:"&nbsp;"},b=zmCenterListing.getMappedClass,c=function(){var c,d,e,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c=f.propertyMap,d=f.classMap,e=f.data;var g="",h="",i="",j="",k=e[c.sub]||e.sub||"",l=e[c.issubtask]||e.issubtask||!1,m=e[c.subicon]||e.subicon||!1,n=e[c.count]||e.count||"",o=e[c.size]||e.size||"",p=e[c.id]||e.id||"",q=e[c.from]||e.from||a.INTENTIONAL_SPACE,r=e[c.date]||e.date||"",s=e[c.showcomplete]||e.showcomplete||!1,t=e[c.tagLst]||e.tagLst||"",u=e[c.actionIcons]||e.actionIcons||"",v=e[c.iconArr]||e.iconArr||"",w=v.length,x=e[c.comment]||e.comment||!1,y=e[c.dateColor]||e.dateColor||"",z=e[c.assignee]||e.assignee||!1;g=b(c,d,e,"status"),h=b(c,d,e,"att"),i=b(c,d,e,"pri"),j=b(c,d,e,"subIcon");var A="";t.length&&(A=zmsTemplates.constructTagListHTML(t,!1,4,"default",{constructOuterDiv:!0}),A=$(A)[0]),e[c.projectsinteg]&&(k=_zm.escapeTags(k));var B=zdom("div",{className:"zmL "+g,id:p}),C=zdom("div",{className:"zmLst"}),D=zdom("div",{className:"zmFlt"}),E=zdom("div",{className:"zmDtl"}),F=zdom("div",{className:"zmFrt"});D.appendChild(zdom("i",{className:"msi-uncheck"})),s&&D.appendChild(zdom("i",{className:"msi-markcomplete"})),D.appendChild(zdom("i",{className:h})),D.appendChild(zdom("div",{className:"zm_td SC_dyn"},zdom("div",{className:"zm_tlb"}))),n&&D.appendChild(zdom("div",{className:"zmtCt"},n)),!l&&m&&D.appendChild(zdom("i",{className:"msi-subtask"})),C.appendChild(D),E.appendChild(zdom("div",{className:"zmSze"},zdom("span",null," ",o)));var G=zdom("div",{className:"zmFrm"});if(i&&G.appendChild(zdom("i",{className:"msi-priority "+i})),x){var H=zdom("div",{className:"zmInfo"},zdom("span",{className:"zmThmClr zmCmntCt"},x,zdom("i",{className:"msi-lcmnt"})));G.appendChild(H)}var I=zdom("span",null);I.appendChild(q),G.appendChild(I),E.appendChild(G),E.appendChild(zdom("div",{className:"zmDate "+y},zdom("span",null," ",r)));for(var J=zdom("div",{className:"zmFdr zmFdrIcon"}),K=zdom("span",null),L=0;L<u.length;L++)K.appendChild(zdom("i",{className:u[L]}));J.appendChild(K),E.appendChild(J);var M=zdom("div",{className:"zmSub"});if(j&&M.appendChild(zdom("i",{className:j})),k){var N=zdom("span",{className:"zm_grp SC_ldot"});$(N).append(k),M.appendChild(N)}else{var O=zdom("span",{className:"zm_grp SC_ldot SC_dyn"});M.appendChild(O)}z&&$(M).append(z),E.appendChild(M);for(var P=zdom("div",{className:"SC_icn"}),Q=0;Q<w;Q++)P.appendChild(zdom("i",{className:v[Q]}));E.appendChild(P);var R=zdom("div",{className:"zm_lbl"});return A&&R.appendChild(A),E.appendChild(R),C.appendChild(E),C.appendChild(F),B.appendChild(C),B},d=function(){zmCenterListing.registerListItemTemplate({type:"task",generator:c})};d()}(),function(){var a=zmCenterListing.getMappedClass,b=function(){var b,c,d,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b=e.propertyMap,c=e.classMap,d=e.data;var f="",g="",h="",i="",j="",k=d[b.id]||d.id||"",l=d[b.date]||d.date||"",m=d[b.size]||d.size||"",n=d[b.from]||d.from||"&nbsp;",o=d[b.actionIcons]||d.actionIcons||"",p=d[b.tagLst]||d.tagLst||"",q=d[b.iconArr]||d.iconArr||[],r=d[b.comment]||d.comment||!1;f=a(b,c,d,"status"),h=a(b,c,d,"flag"),g=a(b,c,d,"att"),i=a(b,c,d,"pri"),j=a(b,c,d,"subIcon"),f&&(f=" "+f),i&&(i=" "+i);var s="";p.length&&(s=zmsTemplates.constructTagListHTML(p,!1,4,"default",{constructOuterDiv:!0}),s=$(s)[0]);var t=zdom("div",{className:"zmL"+f,id:k}),u=zdom("div",{className:"zmLst"}),v=zdom("div",{className:"zmFlt"},zdom("i",{className:"msi-uncheck"}),zdom("div",{className:"zm_td"},zdom("div",{className:"zm_tlt"}),zdom("div",{className:"zm_tlb"}),zdom("div",{className:"zm_tls"})),zdom("div",{className:h}));u.appendChild(v);for(var w=zdom("div",{className:"zmDtl"},zdom("div",{className:"zmDate"},zdom("span",null,l))),x=zdom("div",{className:"zmFrt"}),y=zdom("div",{className:"zmFdr zmFdrIcon"}),z=zdom("span",null),A=0;A<o.length;A++)z.appendChild(zdom("i",{className:o[A]}));y.appendChild(z),w.appendChild(y),w.appendChild(zdom("div",{className:"zmSze"},zdom("span",null,m)));var B=zdom("div",{className:"zmFrm"});r&&B.appendChild(zdom("div",{className:"zmInfo"},zdom("span",{className:"zmThmClr zmCmntCt"},r," ",zdom("i",{className:"msi-lcmnt"})))),i&&B.appendChild(zdom("i",{className:"msi-priority"+i})),j&&B.appendChild(zdom("i",{className:j})),B.appendChild(zdom("i",{className:"msi-markcomplete"})),g&&B.appendChild(zdom("i",{className:g})),B.appendChild(zdom("span",null,n)),w.appendChild(B);for(var C=zdom("div",{className:"SC_icn"}),D=0,E=q.length;D<E;D++)C.appendChild(zdom("i",{className:q[D]}));if(w.appendChild(C),s){var F=zdom("div",{className:"zm_lbl"});F.appendChild(s),w.appendChild(F)}return u.appendChild(w),u.appendChild(x),t.appendChild(u),t},c=function(){zmCenterListing.registerListItemTemplate({type:"subtask",generator:b}),zmCenterListing.registerListItemTemplate({type:"sublist",generator:b})};c()}(),window.zpTaskList=function(){var a,b;return b=function(){},a=function(){},b.currentList={},b.centerObj=function(a,b){var c,d=a||0;b=b||"zm_task";try{c=zmsuite.getCenter(b)[d].getNodes()}catch(e){c=zmsuite.getCenter()[0].getNodes()}return c},a.constructList=function(a,c){var d=function(){this.nextPage=20===a.order.length,this.appId="zm_task",this.centerListingObj={},this.listArr=a.order,this.listObj=a.list,this.count=a.order.length,this.listInfo=c,this.constructor()};return d.prototype={constructor:function(){var a=this;a.listArrFull=$("<div></div>"),a.listArr.forEach(function(c){var d=b.getRow(a.listObj[c],a.listInfo);a.centerListingObj[c]=d,a.listArrFull.append(d.listingEl)}),a.listArr.length||(a.listArrFull.append(zmTask.template.emptyTask()),zmTask.Util.addTaskPopup(a.listArrFull,c)),this.subscribeme()},deleteSubscribers:function(){var a=this;$.each(a.centerListingObj,function(a,b){b.unsubscribeme()}),a.unsubscribeme()},listClickHandler:function(a){var b=$(a.target),c=b.attr("class"),d=b.closest(".zmL");if(d.length){var e,f=d.data("id"),g={};e=this.centerListingObj[f];var h=this.listArr.indexOf(f),i=this.listArr;g.prev=0===h,g.next=h===i.length-1,"msi-markcomplete"===c?e.markasComp():"msi-trash"===c?e.deleteTask():(zmTask.Util.handleURLChange(["t",f]),zmTaskRestore.store("preview","param",{entityId:f}),this.openTaskinListing(e,g))}},openTaskinListing:function(a,c){if(a){var d=this,e=b.centerObj(0,this.appId)[2];e.$el.find(".zmSLst").removeClass("zmSLst"),a.listingEl.addClass("zmSLst"),d.viewProjectsTask(a,c)}},viewProjectsTask:function(a,c){var d=this;this.openTaskId=a.listObj.id_string;var e=b.centerObj(1,this.appId);e[0].push(zmTask.template.previewtaskHeader({projectsView:!0})),e[1].push(zmail.projectsInteg.view.taskPreview(a).$el),zmsuite.getCenter()[1].show(),c&&c.next&&e[0].$el.find(".msi-next").parents("b").addClass("SC_opy3"),c&&c.prev&&e[0].$el.find(".msi-prev").parents("b").addClass("SC_opy3"),e[0].setListener("click",function(b){"msi-close"===b?(zmsuite.getCenter()[1].close(),zmsuite.getCenter()[0].$el.find(".zmL").removeClass("zmSLst"),zmTask.Util.handleCloseTask()):"msi-prev"!==b||c.prev?"msi-next"!==b||c.next||d.prevNxtTask("next",a):d.prevNxtTask("prev",a)})},prevNxtTask:function(a,c){var d=this.listArr.indexOf(c.listObj.id_string),e={},f=this.listArr["prev"===a?d-1:d+1],g=this.listArr.indexOf(f);e.prev=!g,e.next=g===this.listArr.length-1,this.openTaskinListing(this.centerListingObj[f],e);var h=this.centerListingObj[f].listingEl,i=this.centerListingObj[c.listObj.id_string].listingEl;zmUtil.initScroll(b.centerObj()[2].$el,h,i,a,!0)},subscribeme:function(){this.deletesubscription=_zm.bindFn(this.deleteTaskCallback,this),$.subscribe("/zm/zptask/deleteTask",this.deletesubscription),this.addzpsubscription=_zm.bindFn(this.addZPTaskCallback,this),$.subscribe("/zm/zptask/addZPTask",this.addzpsubscription)},unsubscribeme:function(){$.unsubscribe("/zm/zptask/deleteTask",this.deletesubscription),$.unsubscribe("/zm/zptask/addZPTask",this.addzpsubscription)},deleteTaskCallback:function(a,c){if(this.listArr.indexOf(c)!==-1){var d=this.listArr.indexOf(c);this.openTaskId===c&&(zmTask.hideMenu(),this.openTaskId=""),delete this.listObj[c],this.listArr.length<=20&&$(b.centerObj()[2].$el).scroll(),this.listArr.splice(d,1),this.count-=1,delete this.centerListingObj[c],this.listArr.length||(this.listArrFull.append(zmTask.template.emptyTask()),zmTask.Util.addTaskPopup(this.listArrFull))}},appendScrollList:function(a){this.nextPage=20===a.order.length,this.count+=a.order.length,this.listArr=this.listArr.concat(a.order),$.extend(this.listObj,a.list);var c=this;a.order.forEach(function(d){var e=b.getRow(a.list[d],c.listInfo);c.centerListingObj[d]=e,c.listArrFull.append(e.listingEl)})},addZPTaskCallback:function(a,c){var d={},e=c.order[0];this.count+=1,this.listArr.unshift(e),d[e]=c.list[e],$.extend(this.listObj,d);var f=b.getRow(this.listObj[e],this.listInfo);this.centerListingObj[e]=f,this.listArrFull.find("#notask").remove(),this.listArrFull.prepend(f.listingEl)}},new d},b.getRow=function(a,b){var c=function(){this.listObj=a,this.listInfo=b,this.listingEl=this.getRowHTML(),this.subscribeme()};return c.prototype={getRowHTML:function(){var a="task",b=this.listObj,c={id:"id_string",showcomplete:"showcomplete",pri:"priority",count:"subtaskCount",date:"end_date",status:"completed",from:"title",sub:"ownersName",projectsinteg:"projectsinteg"},d={pri:{High:"SC_red",Medium:"SC_blue",Low:"SC_black"},status:{"true":"SC_Sthro"}},e=zmCenterListing.create({type:a,mapObj:c,classObj:d}),f=zdom("span",null,zmTask.Util.escapeSpecialChar(b.name));b.title=f,b.iconArr=[];var g=this.listInfo.currentProject.role;zmail.projectsInteg.util.hasEditPermission(g,b.ownersId)&&(b.canEdit=!0,b.iconArr.push("msi-trash"),b.showcomplete=!0),b.projectsinteg=!0,e.setDataObj(b);var h=$(e.getHTML());return h.data("id",this.listObj.id_string),h.data("type",a),zmTask.Util.showToolTip(h),h.find("i.msi-uncheck").remove(),h},markasComp:function(){var a={},b=this.listObj,c=this,d=zmText.get("projectsinteg");a.percent_complete=100===b.percent_complete?0:100,zmail.projectsInteg.util.getUnchangedFields(b,a);var e=function(e,f){if(200===f.status){b.completed=!b.completed,b.percent_complete=a.percent_complete;var g=c.listingEl;c.listingEl=c.getRowHTML(),g.replaceWith(c.listingEl),g.hasClass("zmSLst")&&(c.listingEl.addClass("zmSLst"),c.listingEl.click()),zmUtil.succErrMsg("s",d.successMsg.taskUpdated)}else zmUtil.succErrMsg("e",d.errorMsg.taskUpdateFail)},f=function(){zmUtil.succErrMsg("e",d.errorMsg.taskUpdateFail)},g={u:b.link.self.url,p:a,cFn:e,fFn:f};zmail.projectsInteg._core.addOrUpdateTask(g)},deleteTask:function(){var a=this.listObj,b=function(){$.publish("/zm/zptask/deleteTask",[a.id_string])};zmail.projectsInteg._core.deleteTask({u:a.link.self.url,cFn:b})},deleteTaskCallback:function(a,b){this.listObj.id_string===b&&(this.unsubscribeme(),this.listingEl.remove())},subscribeme:function(){this.deletesubscription=_zm.bindFn(this.deleteTaskCallback,this),$.subscribe("/zm/zptask/deleteTask",this.deletesubscription)},unsubscribeme:function(){$.unsubscribe("/zm/zptask/deleteTask",this.deletesubscription)}},new c},{constructList:a.constructList,getRow:b.getRow}}(),define([],function(a){var b,c,d,e,f=a("zmText"),g=a("zmTask"),h=a("zmUtil"),i=a("zmAppLoader"),j=a("ZMLayer"),k=a("zmsDialog"),l=a("zmlab"),m=a("zmTaskRestore"),n=a("zmComponent"),o=a("zmAutoFill"),p=g.template,q=f.get("taskUtil"),r={};try{d=["41","58","63","64","65","66","67","68","69"]}catch(s){}var t={selectedTask:{},model:{imperror:q.errorMsg.impfile},getSelectedListingParams:function(a,b){var c=zmsuite.getLeft().selId,d=zmsuite.getLeft().selLayerId,f={actionType:"appView",isPrev:!1,streamsView:!0,entityType:3};$.extend(a,f);var h=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer(d),i=h.getRowObj(c),j=e;if(r.filterView)$.extend(a,j),$.extend(b,j);else if(i){var k=i[c];a.taction=b.taction=k.type,a.groupId=b.groupId=zmail.zuid,b.headerObj=b.headerObj?b.headerObj:{},"getTasksByDueDate"===k.type?a.mode=b.mode=k.mode:"getGroupTasks"===k.type?(a.groupId=b.groupId=c,b.headerObj.showGroupDropdown=b.headerObj.showMemberCount=!0,b.enableQuickTask=!g.Util.isDisabledGroup(b.groupId)):"getTasksByCategory"===k.type?(a.groupId=b.groupId=k.p,a.categoryId=b.categoryId=c,b.headerObj.showGroupDropdown=b.headerObj.showMemberCount=!0,b.enableQuickTask=!g.Util.isDisabledGroup(b.groupId)):"zmllabelH"===d?(a.taction=b.taction="getTasksByLabel",a.labelId=b.labelId=c):"getMyTasks"===k.type&&(b.headerObj.showGroupDropdown=b.enableQuickTask=!0)}return{param:a,eprm:b}},isGroup:function(a){return!!g.Util.Groups(a)},isPermitted:function(a,b){if(g.Util.isDisabledGroup(a.NMSPID))return!1;if("delete"===b){if(a.OWNERID===zmail.zuid||this.isGroup(a.NMSPID)&&g.Util.isGroupOwner(a.NMSPID))return!0}else if("complete"===b){if(a.OWNERID===zmail.zuid||a.ATTENDEEIDS===zmail.zuid||a.ISSUBTASK&&a.PARENTTASK.ATTENDEEIDS===zmail.zuid)return!0}else if("addsub"===b){if(!a.ISSUBTASK&&!g.Util.isPrivateTask(a.NMSPID))return!0}else if("changeCategory"===b&&(a.assignee===zmail.zuid||a.owner===zmail.zuid))return!0;return!1},hideMenu:function(){$("#zmCntxtMenu").remove(),$("#zm_dropDown").remove(),zmsuite.getCenterOuter().$el.find(".SC_ddn").removeClass("SC_ddn"),this.selectedTask={}},defaultListing:function(){var a={taction:"getMyTasks"},b={fromAction:"leftClick",headerValue:q.left.assignedtome,selRow:"tome"+zmail.zuid,taction:"getMyTasks",enableQuickTask:!0,layerId:"views"};e=b,g.Util.handleURLChange(["views","tome"]),r.listingObj=new g.TaskList(a,b)},isValidProject:function(a,b){var c=a;if(c=c.trim(),h.hasSpecialChars(c))return h.succErrMsg("e",q.errorMsg.splChar),!1;if("null"===c||""===c)return h.succErrMsg("e",q.errorMsg.nullChar),!1;for(var d=g.Util.Categories()[b],e=0,f=d.length;e<f;e++)if(d[e].categoryName===c)return h.succErrMsg("e",q.errorMsg.nameExits),!1;return!0},toggleGroup:function(a,b){var c=zmsuite.getLeft().getNodes()[0].getLayer("groups"),d=c.getChildObject()[a];if(d)if("show"===b){var e=$("#"+a);c.showChild(e.find(".msi-rarrow"),a,e)}else c.hideChild($("#"+a).find(".msi-rarrow"),a)},promoteGroup:function(a){var b=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("groups"),c=b.getRowObj(a);if(b&&c&&c[a]){c[a].hideNode=!1,b.moveNode(c);var d=$(b.el).find("#more");if(d.is(":visible")&&d.index()>5){var e=$(b.el).find("#more").prev().attr("id");c=b.getRowObj(e),b.moveNode(c,void 0,"more"),b.hideNode(e)}}},getCenterObj:function(a){var b,c=a||0;try{b=zmsuite.getCenter("zm_task")[c].getNodes()}catch(d){b=zmsuite.getCenter()[0].getNodes()}return b},loadingDiv:function(a,b){b=b?b:t.getCenterObj()[2].$el[0],n.loadingBand({container:b,type:a})}},u=function(s){var u,v=a("zmStreamsApp"),w=[],x=[],y=[],z=f.get("mail").leftTree.tagCreateEdit,A=zmsuite.getLeft("zm_task").getNodes()[0],B=function(){e=s,this.deferred=$.Deferred()};return B.prototype={leftLoad:function(){var a=this;return b=g.Util.Categories(),c=g.Util.Groups(),this.initGroupKeys(),this.render().done(function(){a.selectLayer(),zmsuite.showApp("zm_task"),a.setChildToggle(),a.subscribeActions(),a.deferred.resolve()}),this.deferred.promise()},selectLayer:function(){s.layerId&&s.selRow&&zmsuite.getLeft().selRow(s.selRow,s.layerId)},setChildToggle:function(){_.each(["groups","views"],function(a){A.getLayer(a).setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0})})},initGroupKeys:function(){var a=g.Util.getGroupTaskOrder();u=a.count,a.order&&$.each(a.order,function(a,b){String(b)!==zmail.zuid&&g.Util.Groups(b)&&(g.Util.isDisabledGroup(b)?w.push(b):(x.push(b),g.Util.isHiddenGroup(b)&&y.push(b)))})},toggleGroupHeaders:function(a,b){var c=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("groups"),d=c.listObject;"more"===a?(Object.keys(d).forEach(function(a){g.Util.isHiddenGroup(a)||c.showNode(a,b)}),c.showNode("less",b),c.hideNode("more",b)):"less"===a&&(Object.keys(d).forEach(function(a){d[a].shouldshow?c.hideNode(a,b):c.showNode(a,b)}),c.showNode("more",b),c.hideNode("less",b),"function"==typeof b&&b())},leftClick:function(a){var b=zmsuite.getLeft().selId;zmsuite.isWorkspaceAvailable("zm_task")&&void 0===b&&(zmsuite.showWorkSpace("zm_task"),b=zmsuite.getLeft().selId);var c;if("clbk"in a&&(c=a.clbk),b!==r.openViewId){if("more"===b||"less"===b)return this.toggleGroupHeaders(b,c),void("function"==typeof c&&($("#"+a.zmsData.rowInfo.layerId)[0].children[1].firstElementChild.scrollIntoView(),c()));var d={},f=zmsuite.getCenter()[0].getNodes()[0];zmsuite.showExistingApp("zm_task"),f.hideGroup("zpFilter");var h=a.zmsData.rowObject[b];if(h){if(r.listingObj){var i={entityId:r.listingObj.getCurrentList().openTaskId};$.publish("/zm/task/deleteTask",[i,i])}var j=f.$el.find(".SC_frt").find("#printlink");if(j.show(),t.loadingDiv("listing"),"getPersonalTasks"===h.type&&!h.p||"getGroupTasks"===h.type)this.loadHeaderCategoryTasks(h);else if("getTasksInTrash"===h.type)this.loadTrashTasks(h);else if("getMyTasks"===h.type||"getTasksByMe"===h.type||"getTasksByDueDate"===h.type)this.loadViewTasks(h);else if("l"===a.zmsData.rowInfo.info){if("header"===a.zmsData.rowInfo.type)return;this.loadLabelTasks(a.zmsData.rowObject)}else if("p"===a.zmsData.rowInfo.info){if(j.hide(),"header"===a.zmsData.rowInfo.type)return;t.hideMenu(),zmsuite.getCenter()[0].getNodes()[0].hideGroup("action"),zmsuite.getCenter()[0].getNodes()[0].hideGroup("quickadd"),h=a.zmsData.rowObject[b],d={taction:"zpTasks",portalId:h.id},e=d,r.listingObj=new g.ProjectList({portalId:h.id},d),g.Util.handleURLChange(["projects",h.id]),m.store("listing","param",d),m.store("listing","eparam",d)}else if("getTasksByCategory"===h.type||"getPersonalTasks"===h.type&&h.p){var k=a.zmsData.rowObject[b];this.loadCategoryTasks(k)}r.openViewId=b,r.filterView=!1}}},projectAction:function(a,c){if("t"===zmApp.currentApp)if(a.msg)h.succErrMsg("e",a.msg);else{var d;if("object"===babelHelpers["typeof"](zmsuite.getAppObj().zm_task)){var f=c.groupId===zmail.zuid?"views":"groups";d=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer(f)}var i,j=c.groupId===zmail.zuid?"getPersonalTasks":"getTasksByCategory",k=c.groupId;if("addCategory"===c.taction){var l,m=a.categoryId;i={},i[m]={name:a.categoryName,id:m,HC:!1,E:!1,c:"0",p:c.groupId,type:j};var n=b[c.groupId].length;n>0&&(l=b[c.groupId][n-1].categoryId),"undefined"!=typeof d&&(l?d.insertNodeAfter(i,d.mapObject,l,k):d.appendNode(i,d.mapObject,k))}else if("editCategory"===c.taction){i=d.getRowObjfromId(c.categoryId),i[a.categoryId].name=a.categoryName,d.editNode(i,d.mapObject);
for(var o=g.Util.Categories()[c.groupId],p=0,q=o.length;p<q;p++)if(o[p].categoryId===a.categoryId){o[p].categoryName=a.categoryName;break}zmsuite.getLeft().selId===c.categoryId&&r.listingObj.updateHeaderBand({name:a.categoryName,showMemberCount:!0})}else if("deleteCategory"===c.taction){i=d.getRowObjfromId(c.categoryId),d.deleteNode(i,k);var s=e;c.categoryId===s.categoryId&&t.defaultListing()}this.editProjectValue(a,c),t.hideMenu()}},editProjectValue:function(a,c){if("addCategory"===c.taction){var d=!1;for(var e in b[c.groupId])if(b[c.groupId][e].categoryId===a.categoryId){d=!0;break}d||b[c.groupId].push(a)}else if("editCategory"===c.taction){for(var f in b[c.groupId])if(b[c.groupId][f].categoryId===a.categoryId){b[c.groupId][f]=a;break}}else if("deleteCategory"===c.taction)for(var g in b[c.groupId])if(b[c.groupId][g].categoryId===a.categoryId){b[c.groupId].splice(g,1);break}},getLHSGroupName:function(a){return g.Util.isDisabledGroup(a)?"dgroups":"groups"},addGroup:function(a,b){var d=b.groupID,e=b.group,f=d,h={};h[f]={type:"getGroupTasks",E:!1,name:e.name,HC:!1,c:"0",id:f};var i={rowObject:h},j="groups",k=A.getLayer(j),l=g.Util.getCategory(d)||[],m=l.length;k.getChildObject()[d]={CH:{}},i.rowObject[d].HC=!1,i.rowObject[d].E=!1,k.getListObject().less?(i.rowObject[d].hideNode=k.getListObject().less.hideNode,i.rowObject[d].shouldshow=!0,k.insertNodeBefore(i.rowObject,k.mapObject,"less")):(i.rowObject[d].hideNode=!1,i.rowObject[d].shouldshow=!1,k.appendNode(i.rowObject,k.mapObject));var n=zmail.ContactBook.getGroups(e.name);n.length>0&&_.each(n,function(a){a.attrs.id===d&&(c[d]=a)});for(var o=0;o<m;o++){var p={};p[l[o].catid]=i.childObject.CH[l[o].catid],k.appendNode(p,k.mapObject,d)}},deleteGroup:function(a,b){var c=A.getLayer(this.getLHSGroupName(b.id)),d=c.getRowObjfromId(b.id);c.deleteNode(d,"-1")},editGroup:function(a,b){var d,e,f;d=A.getLayer(this.getLHSGroupName(b.id));var g=c[b.id];if(b.props.name)g.attrs.name=b.props.name,e=d.getRowObjfromId(b.id),e[b.id].name=b.props.name,d.editNode(e,d.mapObject);else if(b.props.disabled===!0||b.props.disabled===!1){var h=b.props.disabled===!0?"groups":"dgroups";if(d=A.getLayer(h),g.attrs.disabled=b.props.disabled,e=d.getRowObjfromId(b.id),!e||!e[b.id])return;if(e[b.id].disabled=b.props.disabled,f=d.childObject[b.id],d.deleteNode(e),d=A.getLayer(this.getLHSGroupName(b.id))){if(d.getChildObject()[b.id]={CH:{}},d.getListObject().less?(e[b.id].hideNode=d.getListObject().less.hideNode,e[b.id].shouldshow=!0,d.insertNodeBefore(e,d.mapObject,"less")):(e[b.id].hideNode=!1,e[b.id].shouldshow=!1,d.appendNode(e,d.mapObject)),!$.isEmptyObject(f.CH))for(var i in f.CH){var j={};j[i]=f.CH[i],d.appendNode(j,d.mapObject,b.id)}}else{var k=this.getDisabledLayer(w,u);A.appendLayer("dgroups",k),A.getLayer("dgroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0})}}else if(b.props.disabled===!1){if(g.attrs.disabled=b.props.disabled,e=d.getRowObjfromId(b.id),e[b.id].disabled=b.props.disabled,f=d.childObject[b.id],d.deleteNode(e),d=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("groups"),d.getChildObject()[b.id]={CH:{}},d.getListObject().less?(e[b.id].hideNode=d.getListObject().less.hideNode,e[b.id].shouldshow=!0,d.insertNodeBefore(e,d.mapObject,"less")):(e[b.id].hideNode=!1,e[b.id].shouldshow=!1,d.appendNode(e,d.mapObject)),!$.isEmptyObject(f.CH))for(var l in f.CH){var m={};m[l]=f.CH[l],d.appendNode(m,d.mapObject,b.id)}}else b.props.hidden===!0?d.hideNode(b.id):b.props.hidden===!1&&d.showNode(b.id)},render:function(){if("t"!==zmApp.selectedApp)return void zmsuite.deleteAppInfo("zm_task");var a,d,e,m,n,o,p,r=zmsuite.getLeft(),s=r.getNodes(),t=$.Deferred(),z={id:"id",name:"name",count:"c",parentId:"p",hasChild:"HC",expChild:"E",sequence:"SE",notBold:!0},A=[],B=function(a,b){return{c:a||"0",p:b||"-1"}},C=function(a,b,c,d){var e=1,f={CH:{}};for(n=0;n<c.length;n++)o=c[n],p=o.categoryId,f.CH[p]={name:o.categoryName,id:p,HC:!1,E:!1,c:o.ucount,SE:e++,p:b,type:d},a.dataObject.countObject[p]=B(o.ucount,b);return f},D=new j,E=[];E.push({name:q.left.createdbyme,id:"by"+zmail.zuid,taction:"getTasksByMe",mode:"createdbyme"}),E.push({name:q.left.todaytask,id:"today"+zmail.zuid,taction:"getTasksByDueDate",mode:"today"}),E.push({name:q.left.delayedtask,id:"delayed"+zmail.zuid,taction:"getTasksByDueDate",mode:"delayed"}),E.push({name:q.left.upcomingtask,id:"upcoming"+zmail.zuid,taction:"getTasksByDueDate",mode:"upcoming"}),E.push({name:q.left.weektask,id:"week"+zmail.zuid,taction:"getTasksByDueDate",mode:"week"}),E.push({name:q.left.monthtask,id:"month"+zmail.zuid,taction:"getTasksByDueDate",mode:"month"}),E.push({name:q.left.assignedtome,id:"tome"+zmail.zuid,taction:"getMyTasks",mode:"tome"}),E.push({name:q.left.mytask,id:zmail.zuid,taction:"getPersonalTasks",mode:"mytasks"});var F={type:"1",listId:"zmtview",hasChild:!0,hasCountObject:!0,mapObject:z,id:"views",isHeaderSel:!1,dataObject:{headerObject:{id:"taskView",name:q.left.views,showList:!1},listObject:{},childObject:{},countObject:{}}};for(var G in E){var H=E[G];a={type:H.taction,mode:H.mode,id:H.id,name:H.name,c:"0",HC:!1,E:!1,SE:G+1},"getPersonalTasks"===H.taction&&b[H.id]&&(d=b[H.id],m=d?d.length:0,a.HC=d?d.length:0,e=C(F,H.id,d,"getPersonalTasks"),m&&(F.dataObject.childObject[H.id]=e),c[H.id].attrs.categories=d),F.dataObject.listObject[H.id]=a,F.dataObject.countObject[H.id]="getPersonalTasks"===H.taction?B():B(u[H.id])}D.push(F),A.push(D);var I=new j,J={id:"groups",name:q.left.groups,showList:!0},K={type:"1",listId:"zmtTree",hasChild:!0,hasCountObject:!0,mapObject:z,isHeaderSel:!1,id:"groups",dataObject:{headerObject:J,listObject:{},childObject:{},countObject:{}}};h.isNewGroupUser()&&(J.settingsOption=!0,J.settingsObject={className:"msi-manageGroup",onClick:function(){i.load("streamsGroupManagement").done(function(){v.GroupManageApp.init({groupManage:!0})})}},J.c="<i class='msi-plus'></i>",J.onAdd=function(){i.load("streamsGroupManagement").done(function(){v.GroupManageApp.init({createGroup:!0})})});var L=1,M=x.length;_.each(x,function(g,h){if(c[g]){d=b[g];var i=d?d.length:0;if(a={type:"getGroupTasks",id:g,name:c[g].attrs.name,c:"0",HC:i,E:!1,SE:L++,hideNode:y.indexOf(g)!==-1},K.dataObject.listObject[g]=a,K.dataObject.countObject[g]=B(u[g]),6===L&&M>6){var j=f.applyArgs(q.left.more,{len:M-L});a={id:"more",name:j,c:"0",HC:!1,E:!1,SE:L++,txtNodeClass:"SC_thm"},K.dataObject.listObject.more=a,K.dataObject.countObject.more=B()}L>7&&(K.dataObject.listObject[g].hideNode=!0),m=i,e=C(K,g,d,"getTasksByCategory"),m&&(K.dataObject.childObject[g]=e),c[g].attrs.categories=d,K.dataObject.listObject[g].shouldshow=K.dataObject.listObject[g].hideNode}}),K.dataObject.listObject.more&&(a={id:"less",name:q.left.less,c:"0",HC:!1,E:!1,txtNodeClass:"SC_thm",hideNode:!0,SE:L++},K.dataObject.listObject.less=a,K.dataObject.countObject.less=B()),I.push(K),A.push(I);var N,O,P,Q;if(I.setDragDrop({allowedParents:"#zmtTree",onDrop:function(a,b,c,d){if(Q===N)return!1;var e=b[Q].p;g.Util.Req.sendCategoryReorderReq({groupId:e,categoryId:Q,prevCategoryId:N},{},function(a){if(a.categoryId){var b=I.getRowObj(a.categoryId);I.moveNode(b,I.mapObject,N,b[a.categoryId].p)}})},allowDrag:function(a){for(O in a)N=O;return"getTasksByCategory"===a[N].type},allowDrop:function(a,b,c){for(O in b)N=O;for(P in a)Q=P;return"next"===c&&(Q!==N&&a[Q].p===b[N].p)},dragStart:function(a,b){var c={};for(O in b)N=O;return c.text=b[N].name,c}}),zmail.showFeature){var R=new j,S={type:"1",listId:"zmtTree",hasChild:!0,hasCountObject:!0,mapObject:z,isHeaderSel:!1,id:"trash",dataObject:{headerObject:{id:"trash",name:q.left.trash,showList:!1},listObject:{},childObject:{},countObject:{}}};R.push(S),A.push(R)}var T=new j,U={dropdown:"min",id:"zmllabelH",name:q.left.tags.toUpperCase(),showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){$("div#zmCntxtMenu").remove(),l.showCreateTagPopUp({mode:"new",accType:"default",callback:function(a,b,c){return h.hasSpecialChars(b,"labelName")?(h.succErrMsg("e",f.get("zmTags","tags").errors.specialCharacters),!1):(g.Util.Req.sendNewLabReq(b,c),void k.remove())}})}},V=h.getTagList("default"),W={name:"dispName",id:"id",count:"c",parentId:"p",color:"color",infoObject:"l"},X={type:"2",listId:"zmllabel",id:"zmllabelH",isHeaderSel:!1,mapObject:W,dataObject:{headerObject:U,listObject:V}};return T.push(X),A.push(T),$.isEmptyObject(w)||A.push(this.getDisabledLayer(w)),h.isZohoAccount(zmail.accId)&&zmAdHocSettings.getProjectInteg().enabled!==!1?h.loadProjects(function(){var b={};b.cFn=function(b,c){if(200===c.status){$.extend(q,f.get("projectsinteg"));var d={name:"name",id:"id",link:"link",infoObject:"p"},e=new j,g={type:"1",listId:"zmProject",hasChild:!0,mapObject:d,isHeaderSel:!1,id:"projects",dataObject:{headerObject:{id:"projectsView",name:f.applyArgs(q.left.zohoprojects,{companyname:zmail.globalI18N.companyName}),showList:!0},listObject:{},childObject:{},countObject:{}}},h=0;b.portals.forEach(function(b){a={id:b.id_string,name:b.name,c:"0",HC:!1,E:!1,SE:h+1},h++,g.dataObject.listObject[b.id_string]=a,zmail.projectsInteg.portalsData[b.id_string]||(zmail.projectsInteg.portalsData[b.id_string]=b),b["default"]&&(zmail.projectsInteg.portalsData.defaultPortalId=b.id_string)}),1===b.portals.length&&(zmail.projectsInteg.portalsData.defaultPortalId=b.portals[0].id_string),e.push(g),A.push(e),s[0].push({layerArr:A}),r.render()}t.resolve()},b.fFn=function(){s[0].push({layerArr:A}),r.render(),t.resolve()},zmail.projectsInteg._core.getPortalsList(b)}):t.resolve(),s[0].push({layerArr:A}),r.render(),r.setListener("click",this.leftClick.bind(this)),r.setListener("contextmenu",this.leftTreeContextMenu.bind(this),!1),t.promise()},leftTreeContextMenu:function(a){var b,c=this;for(var d in a.zmsData.rowObject){b=a.zmsData.rowObject[d];break}var e=function(a){for(var b=$("#zmCntxtMenu li"),c=0,d=a.length;c<d;c++)$(b[a[c]]).addClass("SC_op3")},f=a.zmsData.rowInfo.type,h=a.zmsData.rowInfo.layerId,i=a.zmsData.rowInfo.layerId;if("header"===f||"views"===h&&"getPersonalTasks"!==b.type||"dgroups"===h)return!1;var j=p.leftTreeContextMenu,k={conArr:j};if(("getGroupTasks"===b.type||"getPersonalTasks"===b.type&&!b.p)&&(i=b.id,zmsuite.showContextMenu(a.zmsData.eventInfo,k),e([2,3])),"getTasksByCategory"===b.type||"getPersonalTasks"===b.type&&b.p){var l=b.p;i=l,zmsuite.showContextMenu(a.zmsData.eventInfo,k),e([0]),g.Util.isGroupOwner(l)||e([2,3])}"zmllabelH"===h&&"header"!==f&&(i=b.id,this.enableTagContextMenu(a.zmsData.eventInfo,i)),k.clk=function(a,d){d.rowObj=b,d.wsId=i,c.actionHandler(a,d)}},addEditProject:function(a,b,c){var d={},e={};"deleteCategory"===b?(d={groupId:a.wsId,taction:b,actionType:"deleteCommonLabel"},e={taction:b,groupId:a.wsId},d.categoryId=e.categoryId=a.rowObj.id,g.Util.Req.addEditProjReq(d,e)):t.isValidProject(c,a.wsId,b)&&(d={groupId:a.wsId,categoryName:c,taction:b,actionType:"addCommonLabel"},e={taction:b,groupId:a.wsId,categoryName:c},"editCategory"===b&&(d.categoryId=e.categoryId=a.rowObj.id,d.actionType="editCommonLabel"),g.Util.Req.addEditProjReq(d,e))},actionHandler:function(a,b){var c,d,e="",f=b.action,g=$("#zmCntxtMenu"),i=this;if("createProj"===f)d=g.find("#zt_create_proj"),e="addCategory","SC_op3"!==d.attr("class")&&h.setEditable({ele:d,target:$("#"+b.rowObj.id),callback:function(){i.addEditProject(b,e,d.text().trim())},allowCondition:function(){return!0},parentdiv:g});else if("editProj"===b.action)d=g.find("#zt_rename_proj"),e="editCategory",c=b.rowObj.categoryId,"SC_op3"!==d.attr("class")&&h.setEditable({ele:d,target:$("#"+c),initialize:!0,callback:function(){i.addEditProject(b,e,d.text().trim())},allowCondition:function(){return!0},parentdiv:g});else if("deleteProj"===b.action){t.hideMenu(),e="deleteCategory",c=b.rowObj.categoryId;var j={};j.onOk=function(){i.addEditProject(b,e)},j.stopPropagation=!0,k.confirm(q.common.delete_confirm,j)}},enableTagContextMenu:function(a,b){var c=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("zmllabelH");if(zmail.zohoAccLabInfo=$.extend({},c.listObject),zmail.accId===zmail.defAccId&&(zmail.labInfo=c.listObject),l.labelId=b,!h.isSystemLabel(b)){var d={clk:function(a,c){if("zmLTMenu_Dl"===c.action){$("#zmCntxtMenu").remove();var d={};d.onOk=function(){var a={fn:g.Util.Req.tagResponse};g.Util.Req.sendDeleteLabReq(b,a),t.defaultListing()},d.stopPropagation=!0,k.confirm(q.common.deltagdialogmsg,d)}else"zmLTMenu_El"===c.action&&l.isValidLabel("zmLTMenu_El","rename")&&($("#zmCntxtMenu").remove(),l.showCreateTagPopUp({mode:"rename",accType:"default",callback:function(){var a=$("#zm_createlabelpopup").find("input");if(h.hasSpecialChars($(a[0]).val(),"labelName"))return h.succErrMsg("e",f.get("zmTags","tags").errors.specialCharacters),!1;var b={fn:g.Util.Req.tagResponse};g.Util.Req.sendEditLabReq(a,b),k.remove()}}))},conArr:[{htm:z.edittag,id:"zmLTMenu_El",cEdit:!0,data:{action:"zmLTMenu_El"}},{htm:z.deltag,id:"zmLTMenu_Dl",cEdit:!1,data:{action:"zmLTMenu_Dl"}}]};zmsuite.showContextMenu(a,d),h.stopEvents(a)}},getDisabledLayer:function(){var a,d,e,f,g,h=function(a,b){return{c:a||"0",p:b||"-1"}},i={id:"id",name:"name",count:"c",parentId:"p",hasChild:"HC",expChild:"E",sequence:"SE",notBold:!0},k=new j,l={type:"1",listId:"zmtTree",hasChild:!0,hasCountObject:!0,mapObject:i,isHeaderSel:!1,id:"dgroups",dataObject:{headerObject:{id:"dgroups",name:q.left.disabledGroup,showList:!0},listObject:{},childObject:{},countObject:{}}},m=1;return _.each(w,function(i,j){d=i,e=b[i];var k=e?e.length:0;f={type:"getGroupTasks",id:d,name:c[i].attrs.name,c:"0",HC:k,E:!1,SE:m++},l.dataObject.listObject[d]=f,l.dataObject.countObject[d]=h(u[i]),g={CH:{}};var n=1;a=k,_.each(e,function(a,b){g.CH[a.categoryId]={name:a.categoryName,id:a.categoryId,HC:!1,E:!1,c:a.ucount,SE:n++,p:d,type:"getTasksByCategory"},l.dataObject.countObject[a.categoryId]=h(a.ucount,d)}),a&&(l.dataObject.childObject[d]=g),c[i].attrs.categories=e}),k.push(l),k},updateCatCount:function(a,b,c){if(zmsuite.isWorkspaceAvailable("zm_task")&&c!==zmail.zuid){var d=g.Util.getProjectName(c,a),e=zmsuite.getAppObj().zm_task.left.getNodes()[0].getLayer("groups"),f=e.childObject[c],h=f?f.CH[a]:void 0;if(h&&d.length){var i=h.c;"dec"===b?i--:i++,e.updateCount(a,"upd",i,!0)}}},callback:function(a,b,c){"changeCategory"===c.taction?(this.updateCatCount(c.prevCatId,"dec",c.groupId),this.updateCatCount(c.categoryId,"inc",c.groupId)):"changeStatus"===c.taction?3===c.status?this.updateCatCount(c.categoryId,"dec",c.groupId):2===c.status&&this.updateCatCount(c.categoryId,"inc",c.groupId):"addTaskSubtask"===c.taction||"addTaskasNew"===c.taction?this.updateCatCount(c.categoryId,"inc",c.groupId):"deleteTask"===c.taction&&2===c.status&&this.updateCatCount(c.categoryId,"dec",c.groupId)},subscribeActions:function(){function a(a,c,d){b.projectAction(c,d)}var b=this;$.subscribe("/zm/task/addCategory",a),$.subscribe("/zm/task/editCategory",a),$.subscribe("/zm/task/deleteCategory",a),$.subscribe("/zm/task/changeCategory",this.callback.bind(this)),$.subscribe("/zm/task/changeStatus",this.callback.bind(this)),$.subscribe("/zm/task/addTask",this.callback.bind(this)),$.subscribe("/zm/task/deleteTask",this.callback.bind(this)),n.notifier.addHandler("streams",function(a,b){var c=b.data,e=c.ntype,f=c.shgroup||c.group;d.indexOf(e)!==-1&&c.nby!==zmail.zuid&&t.promoteGroup(f.id)}),h.isNewGroupUser()&&($.subscribe("CONTACT_BOOK_GROUP_CHANGED",this.editGroup.bind(this)),$.subscribe("CONTACT_BOOK_GROUP_ADDED",this.addGroup.bind(this)),$.subscribe("CONTACT_BOOK_GROUP_REMOVED",this.deleteGroup.bind(this)))},getCurrentListInfo:function(){return e},getCurrentListing:function(){return r.listingObj},loadViewTasks:function(a){var b={},c={headerObj:{name:a.name,migrate:!1,filterData:!1,show:{action:"action"},hide:{sort:"sort",taskfilter:"taskfilter"}}},d=a.id.split(zmail.zuid)[0],f=d,h=["views"];"by"!==d&&"tome"!==d||(d="by"===d?"me":d,f=void 0,c.searchAction=void 0),h[1]="tome"===d?d:"by"+d,b.mode=c.mode=f,b.taction=c.taction=a.type,b.groupId=c.groupId=zmail.zuid,c.fromAction="leftClick",c.selId=zmsuite.getLeft().selId,e=c,r.listingObj=new g.TaskList(b,c,h)},loadLabelTasks:function(a){var b={},c={};b.taction=c.taction="getTasksByLabel";var d,f;for(var h in a){d=a[h].id,f=a[h].dispName;break}b.labelId=c.labelId=d,b.groupId=c.groupId=zmail.zuid,c.fromAction="leftClick",c.selId=zmsuite.getLeft().selId,c.headerObj={name:f,migrate:!1,filterData:!1,show:{action:"action"},hide:{taskfilter:"taskfilter",sort:"sort"}},e=c,r.listingObj=new g.TaskList(b,c,["tags",d])},loadTrashTasks:function(a){var b={},c={};b.taction=c.taction=a.type,b.groupId=c.groupId=zmail.zuid,c.fromAction="leftClick",c.selId=zmsuite.getLeft().selId,c.headerObj={name:a.name},e=c,r.listingObj=new g.TaskList(b,c)},loadCategoryTasks:function(a,b){var c={},d={},f=a.p;c.taction=d.taction=a.type,c.categoryId=d.categoryId=a.id,c.groupId=d.groupId=f,d.fromAction="leftClick";var h=a.name?a.name:g.Util.getProjectName(f,a.id);if(d.headerObj={name:h},d.selId=zmsuite.getLeft().selId,e=d,d.headerObj.showMemberCount=d.headerObj.showGroupDropdown=!0,d.enableQuickTask=!g.Util.isDisabledGroup(f),r.listingObj=new g.TaskList(c,d,[c.groupId,"category",a.id]),$("div#quickAdd").length>0){var i=$("div#quickAdd"),j=i.find("textarea");if($(j).data("store")){$(j).data("gid",f);var k=$(j).data("store"),l=o._dataStore.storeData();l[k].data.groupId=f,o.updateArray(j)}}},loadHeaderCategoryTasks:function(a){var b=a.id,d=a.id===zmail.zuid?"mytask":b,f={},h={};f.taction=h.taction=a.type,f.groupId=h.groupId=b;var i=f.groupId===zmail.zuid;h.fromAction="leftClick";var j=a.name?a.name:c[b].name;if(h.headerObj={name:j,migrate:i},h.selId=a.selId||zmsuite.getLeft().selId,h.headerObj.showMemberCount=a.id!==zmail.zuid,e=h,h.headerObj.showGroupDropdown=!0,h.enableQuickTask=!g.Util.isDisabledGroup(b),r.listingObj=new g.TaskList(f,h,[d]),$("div#quickAdd").length>0){var k=$("div#quickAdd"),l=k.find("textarea");if(b=b===zmail.zuid?"org":b,$(l).data("store")){$(l).data("gid",b);var m=$(l).data("store"),n=o._dataStore.storeData();n[m].data.groupId=b,o.updateArray(l)}}}},new B},v=function(a,b,c,d){var e=new u(b);return e.leftLoad().done(function(){b.portalId?r.listingObj=new g.ProjectList(a,b,c,d):r.listingObj=new g.TaskList(a,b,c,d)}),e};return window.zmTask=window.zmTask||{},window.zmTask.LeftListing=v,v});
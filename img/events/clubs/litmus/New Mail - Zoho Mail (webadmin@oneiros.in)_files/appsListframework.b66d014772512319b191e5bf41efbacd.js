"use strict";define([],function(a){var b=a("zmAdHocSettings"),c=a("zmail.Utils.FeatureUtil"),d=a("zmail.Utils.DOM"),e=function f(a,b){this.appList=f.util.getSortedAppList(a),this.popAccList=b,this.appObj={},this.accListObj={},this.$el=d.element(zdom("div",{className:"zm_apps"}))};return e.prototype={set:function(a){this.appList=a},setPopAccArr:function(a){this.popAccList=a},constructDOM:function(a){var b,f,g,h;for(h=d.element(zdom("ul",{className:"zmApps"})),f=this.appList.length,c.isHidden("topbar:apps")&&"true"===zmail.hasCustomLogo&&h.addClass("zmRBAcc"),b=0;b<f;b+=1)g=new e.appIcon(this.appList[b]),this.appObj[this.appList[b].id]=g,this.appList[b].dataName&&d.setData(this.appObj[this.appList[b].id].$el,"name",this.appList[b].dataName),d.mount(g.getDOM(),h);return a||d.mount(h,this.$el),h},constructAccountsDOM:function(a){return 0!==this.popAccList.length&&void e.accountsIcon.init({container:zmsuite.$el.lhs.find("#zm_mailLeft")})},getDOM:function(){return this.$el},removeAndInsertBefore:function(a,b){if(this.appObj[a]&&this.appObj[a].$el){this.appObj[a].$el.remove();var c=this.appObj[a].getDOM();this.appObj[b]&&this.appObj[b].$el?d.mountBefore(c,this.appObj[b].$el):d.mount(c,this.$el)}},removeAndInsertAfter:function(a,b){if(this.appObj[a]&&this.appObj[a].$el){this.appObj[a].$el.remove();var c=this.appObj[a].getDOM();this.appObj[b]&&this.appObj[b].$el?d.mountAfter(c,this.appObj[b].$el):d.mount(c,this.$el)}},reRender:function(){var c=a("zmApp");this.$el.empty(),zmail.leftAppOrder=b.getAppOrder(),this.appList=e.util.getSortedAppList(this.appList),this.constructDOM(),this.constructAccountsDOM(),c.selectApp(c.currentApp)},reRenderAppArea:function(){this.$el.find("ul").eq(0).remove(),zmail.leftAppOrder=b.getAppOrder(),this.appList=e.util.getSortedAppList(this.appList);var a=this.constructDOM(!0);d.mountAtStart(a,this.$el)},reRenderAccArea:function(){this.constructAccountsDOM(!0)},removeAppSelection:function(){var a=this.$el.find("ul").eq(0);a.find("li").removeClass("sel")},removeAccountSelection:function(){var a=this.$el.find("ul").eq(1);a.find("li").removeClass("sel")}},window.zmAppList=e,e}),define([],function(a){var b,c=a("$"),d=a("zmail.Utils.DOM"),e=!1,f={},g=function(){return zdom("div",{id:"jszmAccSwitch",className:"zmAccSwitch"},zdom("div",{className:"zmAccSwitchWra"},zdom("div",{className:"zmAccSwitchBox",id:"jszmAccSwitchBox"},zdom("i",{className:"msi-barrow zmFR"}),zdom("span",{className:"",id:"jszmPopUpdate"}),zdom("div",{className:"zmAccSwitchInfo"},zdom("i",null),zdom("span",null),zdom("font",null))),zdom("div",{className:"zmPopAcc zmHideD"},zdom("ul",null))))},h=function(a){return zdom("li",{className:"SC_tre"},zdom("span",{className:"SC_ct"}),zdom("div",{className:"zmTreWra"},zdom("span",{className:"zmTreTxt"},zdom("i",{className:"msi-otherac zmThmClr"}),zdom("font",null))))},i=function(a){var b="msi-otherac";return a.indexOf("@gmail")>0?b="msi-gmail":a.indexOf("@yahoo")>0||a.indexOf("@ymail")>0?b="msi-yahoo":a.indexOf("@outlook")>0&&(b="msi-outlook"),b+=" zmThmClr"},j=function(){f.htmlContainer.on("click",function(){var a=d.selector(".zmPopAcc",this);if(a.toggleClass("zmHideD"),f.htmlContainer.find("#jszmAccSwitchBox span").removeClass("zmPopUpdate"),0===d.selector(".zmHideD",this).length){f.htmlContainer.css("height","auto");var b=f.htmlContainer.outerHeight();f.htmlContainer.css("height","42px"),setTimeout(function(){f.htmlContainer.css("height",b)},100),d.setStyle(d.selector("#zm_lftree"),{bottom:b})}else d.setStyle(d.selector("#jszmAccSwitch"),{height:"42px"}),d.setStyle(d.selector("#zm_lftree"),{bottom:"42px"})}),f.moreAccountContainer.on("click",function(a){a.stopPropagation();var b=d.element(a.target).closest("li"),e=b.data("accID");f.htmlContainer.find(".zmPopAcc").addClass("zmHideD"),zmUtil.switchAccount(e),c.publish("/mail/accountSwitch",{status:"started",accountID:e}),e=zmail.accId})},k=function(a,b,c,e){return e!==zmail.accId&&void(f.htmlContainer.find(a).length>0&&(a.find(".SC_ct").addClass("SC_new"),f.updateHighLighter.hasClass("zmPopUpdate")||f.updateHighLighter.addClass("zmPopUpdate"),d.setText(d.selector(".SC_ct",a),b)))},l=function(a){var b=a.mailId,c=i(b);f.accountInfo.find("i").attr("class",c),f.accountInfo.find("font").text(b)},m=function(){var a=zmail.aInfo[zmail.accId];l(a)},n=function(a){return a=parseInt(a),a<=0?a="":a>99&&(a="99+"),a},o=function(a){f.htmlContainer&&f.htmlContainer.remove(),f.htmlContainer=d.element(g()),zmsuite.$el.popAccContainer=f.htmlContainer,f.accountInfo=f.htmlContainer.find(".zmAccSwitchInfo"),f.updateHighLighter=f.htmlContainer.find("#jszmPopUpdate"),d.mountAtStart(f.htmlContainer,a.container),f.moreAccountContainer=f.htmlContainer.find("ul")},p=function(a,b){f.moreAccountContainer.children().remove();for(var c=0;c<a.length;c++){var g=a[c],j=zmail.aInfo[g];if(j.accId!==b){var l=d.element(h());l.attr("id","zm-ac-"+j.accId).data("accID",j.accId),l.find("font").text(j.mailId),l.find("i").attr("class",i(j.mailId));var m=n(j.c);l.find(".SC_ct").text(m),""===m||f.updateHighLighter.hasClass("zmPopUpdate")||e!==!1||f.updateHighLighter.addClass("zmPopUpdate"),d.mount(l,f.moreAccountContainer),zmail.appList.accListObj[j.accId]={},zmail.appList.accListObj[j.accId].$el=l,zmail.appList.accListObj[j.accId].updateCount=k}}},q=function(a,c){if(c=c||{},"success"===c.status||"failed"===c.status){var e=zmail.accId;p(Object.keys(zmail.aInfo),e),m(zmail.aInfo[e]),f.htmlContainer.find("#jszmAccSwitchBox span").removeClass("zmPopUpdate"),f.htmlContainer.find(".zmPopAcc").removeClass("zmHideD"),f.htmlContainer.css("height","auto");var g=f.htmlContainer.outerHeight();f.htmlContainer.css("height",g),d.setStyle(d.selector("#zm_lftree"),{bottom:g}),zmail.fromOtherService||(b||(b=zmsuite.$el.appBar.find(".zmApps")),b&&(b.children().removeClass("sel"),b.find(".msi-mailApp").parent().addClass("sel")))}},r={set:function(a){this.accInfo=a},init:function(a){o(a),p(Object.keys(zmail.aInfo),zmail.accId),m(zmail.aInfo[zmail.accId]),j(),e===!1&&(c.subscribe("/mail/accountSwitch",q),e=!0)}};return window.zmAppList=window.zmAppList||{},window.zmAppList.accountsIcon=r,r}),define([],function(a){var b=a("zmail.Utils.DOM"),c=function(a){this.appData=a,this.$el=b.element(zdom("li",null))};return c.prototype={set:function(a){this.appData=a},constructDOM:function(){var a=this;b.clearHTML(this.$el),b.mount(zdom("i",{className:this.appData.icon}),this.$el),b.mount(zdom("span",{className:"lAppLbl"},this.appData.tooltip),this.$el),this.$el.off("click").click(function(){a.selectApp(),a.appData.clk()})},selectApp:function(){this.$el.parent().find("li").removeClass("sel"),zmail.appList.removeAccountSelection(),this.$el.addClass("sel")},getDOM:function(){return this.constructDOM(),this.$el}},window.zmAppList=window.zmAppList||{},window.zmAppList.appIcon=c,c}),define([],function(a){var b=a("_"),c={};return c.getSortedAppList=function(a){if(zmail.leftAppOrder instanceof Array||(zmail.leftAppOrder=zmail.leftAppOrder?zmail.leftAppOrder.split(","):[]),a&&a.length)return b.sortBy(a,function(a){var b=zmail.leftAppOrder.indexOf(a.id);return b>-1?b:100})},window.zmAppList=window.zmAppList||{},window.zmAppList.util=c,c});
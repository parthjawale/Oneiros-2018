"use strict";window.zmPreviewTemplate=function(){var a,b={},c="",d=ZMail.lConstants,e=d.cls,f=zmText.get("preview"),g=function(){a=zmUtil.isChildWindow()?zmWindow:zmPrev},h=function(a){1===a?(zmPreviewTemplate.currentWorkSpace=1,b=$.parseJSON($("#zmWindowWrapper").attr("data-detail")),c="W"):(b=0===zmTab.currentTab.indexOf("zm_srch")?zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),0===a||4===a?b&&"search"===b.view?(c="S",zmPreviewTemplate.currentWorkSpace=zmail.mailOpt.isPopup):(b=zmInit.getListingDetObj(),c="P",zmPreviewTemplate.currentWorkSpace=a):2===a?(c="T",zmPreviewTemplate.currentWorkSpace=2):3===a&&(c="N"))},i=function(a){var b=!1,c=zmConUtil.parseContacts(a);return 1===c.length&&c[0].invalid!==!0&&(a=a.toLowerCase(),a.indexOf("undisclosed-recipients")!==-1&&(b=!0)),b},j=function(a,b){try{if(!a)return"";a=a||"";var c,d=zmConUtil.splitncheck(a,"object")||[],e=[];return d.forEach(function(a,b){c=a.eid||"",c=c.trim(),e.push(c)}),b?", "+e.join(", "):e.join(", ")}catch(f){return zmUtil.debugLog(f),""}},k=function(a,b){b=b||{};var c,d,e,f,g,h,i,j=[],k=$("<div>"),l=" ";a=a||"";var m=zmConUtil.splitncheck(a,"object")||[];for(c in m)d=m[c],g=d.eid||"",g=g.trim(),i=$("<span>"),i.addClass("zm_eadd"),g&&(b.hideEmail&&i.attr("title",g),e=(d.fn||"").trim(),e=zmUtil.replaceHTMLEntities(e),e=e||g,f=(d.nn||"").trim(),f=zmUtil.replaceHTMLEntities(f),e===f&&(f=""),f=f?l+"("+f+")":"",e+=f,b.hideEmail||(e='"'+e+'"'),i.attr("data-eid",g),g="<"+g+">",h=e,b.hideEmail||(h+=l+g),i.text(h.trim()),k.html("").append(i),j.push(k.html()));return j.join(", ")},l=function(a,b){var c=b.find(".SC_pct").length;(c>1||b.find(".SCS-post").length)&&(b.find(".SC_pct").removeClass("SC_Tfcs"),$(a).closest(".SC_pct").addClass("SC_Tfcs"),zmUtil.isChildWindow()&&zmWindow.updateHeaderIcons())},m=function(a){var b,c,d,e=$(a).closest(".zmPCon"),f="";b=e[0].id,b&&(d=b.substring(3),b=d.substring(1),c=zmContentCache.isCached(b)?zmContentCache.get(b):"",c&&c.SHRINKED&&c.BLCKCON&&c.CONTENT.length<c.BLCKCON.length&&(f=$("#vfc"+d).parent())),$(a).next().is(":visible")?($(a).next().hide(),f&&f.hide()):($(a).next().show(),f&&f.show()),zmUtil.applyLBDots(f)},n=function(b){var c=$(b),d=c.parents(".SC_Twpr").find(".SC_pct");d.length>1&&(d.removeClass("SC_Tfcs"),c.parents(".SC_pct").addClass("SC_Tfcs")),b.hasClass(e.blueflag)||b.hasClass(e.redflag)||b.hasClass(e.greenflag)?a.flagMail(c,"0"):a.flagMail(c,"2")},o=function(a){if(zmail.folTree[0][a])return zmail.folTree[0][a].FN;var b,c=zmail.folTree[1];for(var d in c)if(b=c[d].CH,b[a])return b[a].FN;return""},p=function(a){var b;return b=zdom("span",{className:"SC_ldot zm_folname js-fnHolder"},a).outerHTML},q=function(a,b){var c="";return a=parseInt(a),c=1===a?"<div class='"+e.blueflag+"'></div>":2===a?"<div class='"+e.redflag+"'></div>":3===a?"<div class='"+e.greenflag+"'></div>":"s"===b?"":"<div class='"+e.noflag+"'></div>"},r=function(){var a=zmAdHocSettings.getMailViewSettings();return a.headerState},s=function(){var a=zmAdHocSettings.getMailViewSettings();a.headerState="c"===a.headerState?"e":"c",zmAdHocSettings.setMailViewSettings(a)},t=function(a,b,c){var d,e,f=$(a),g=f.attr("data-mid");b&&_zm.stopEvents(b);var h=c||r();if(f.hasClass("zm_tm")&&(h="c"),"e"===h){e="msi-zmPle";var i=zmContentCache.get(g);if(zmContentCache.isCached(g)&&i)if(f.length){var j=f.closest(".SC_Twpr");d=!j.length||i.streams||zmUtil.isZohoAccount(zmail.accId)?i.RDT:i.SENTTIME||""}else d=i.RDT;f.addClass("zms")}else if("c"===h){e="msi-zmPme";var k=zmUtil.getMailObj(g);k&&(d=k.DT),f.removeClass("zms")}f.find(".msi-zmPme, .msi-zmPle").attr("class",e),d&&f.find(".sum").html(d)},u=function(a){var b,c="",d=[],e={reply:f.contextmenu.reply,replyall:f.contextmenu.replyall,fwdi:f.contextmenu.forward,eanew:f.contextmenu.editasnew,outbox:f.contextmenu.edit,sharemail:f.contextmenu.shareMail,shareConversation:f.contextmenu.shareConversation},g=["reply","replyall","fwdi","eanew"];if(zmUtil.hideCommentBox()&&zmUtil.isZohoAccount(zmail.accId)){var h=zmInit.getListingDetObj()?zmInit.getListingDetObj().fId:"";zmfolAction.isMutualFolder(h)||zmUtil.isSharedFolder(h)||g.push("sharemail")}var i=["outbox"];return b=zmUtil.getMailObj(a).FD===zmail.folId.oId?i:g,b.forEach(function(a){d.push('<span data-type="'+a+'">'+e[a]+"</span>")}),d=d.join(""),c=['<div class="zm_ry"'+(zmUtil.hasInlineDraft(a)?' style="display: none"':"")+">",d,"</div>"].join("")},v=function(a){var b=[zmail.folId.oId,zmail.folId.dId,zmail.folId.spId,zmail.folId.tId,zmail.folId.teId],c=zmUtil.getMailObj(a)||{};return!(!a||b.indexOf(c.FD)>=0||!zmUtil.isZohoAccount(zmail.accId)||zmUtil.isSharedFolder(c.FD)||c.streams)},w=function(a,c){var d,e,g,h,l=a.elemId,m=a.msgId,n="",r="",s=[],u=a.showLimitedData,w=zmUtil.getMailObj(m),x=a.elemObj;if(x&&$(x.prevElem).find("#zmHdr"+l).length&&!$(x.prevElem).find("#zmC"+l).length||"print"!==a.rFrom&&!x&&$("#zmHdr"+l).length&&!$("#zmC"+l).length){var y="",z="",A="";if(d=x?$(x.prevElem).find("#zmHdr"+l):$("#zmHdr"+l),d.removeClass("zm_tm"),w.S||d.find(".zmPT").addClass("zm_urd"),d.find(".sum").html(w.DT),""!==a.isReadable&&void 0!==a.isReadable&&d.find(".sum").after("<span class='SC_ldot'>"+a.isReadable+"</span>"),4!==c)e="<span>",a.to&&!i(a.to)&&s.push(k(a.to,{hideEmail:!0})),a.cc&&s.push(k(a.cc,{hideEmail:!0})),a.bcc&&s.push(k(a.bcc,{hideEmail:!0})),e+=s.join(", "),e+="</span>",d.find(".zmpr").eq(1).find("font:first").after(e);else{var B=j(a.to)+j(a.cc,!0)+j(a.bcc,!0),C=B;B.length>70&&(B=B.substring(0,70)+"...");var D=d.find(".zmBPVtoCc");D.append(zdom("span",{"class":"greyText"},f.contentOptions.To)),D.append(zdom("span",{title:C},B))}a.to&&!i(a.to)&&(d.find("#zmTO"+a.elemId).remove(),y='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em title='+f.contentOptions.to+">"+f.contentOptions.to+"</em> "+k(a.to)+"</span></div></div></div>"),a.cc&&(z='<div id="zmCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+f.contentOptions.cc+"</em> "+k(a.cc)+"</span></div></div></div>"),a.bcc&&(A='<div id="zmBCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+f.contentOptions.bcc+"</em> "+k(a.bcc)+"</span></div></div></div>"),a.to||a.cc||a.bcc||d.find("#zmTO"+a.elemId).length||(y='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+f.contentOptions.to+"</em></span></div></div></div>"),g=zmPreviewTemplate._rPath(a,"via"),h=zmPreviewTemplate._rPath(a);var E=d.find("#zmLBL"+a.elemId);return E.length?E.before(y+z+A):d.find(".zmPT").append(y+z+A),h._str&&d.find(".zmPT")&&(d.find(".zmPT").find('div[data-zmvia="less"]').append(g._str),d.find(".zmPT").append(h._str)),t(d),d[0].outerHTML}var F,G,H="",I=w.FD||"",J=!0,K="zmPHdr",L={},M=a.isSharedDraft||!1,N=a.isDraftEditable||!1,O=zmUtil.isSharedFolder(I),P="";w.streams&&(P="default"),a.sm||(a.sm=""),a.thd&&(K+=" zm_tm",I===zmail.folId.sId&&w&&w.TH&&(K+=" zmsnt")),n+='<div id="zmHdr'+a.elemId+'" class="'+K+'" data-elmId="'+a.elemId+'" data-mid="'+m+'">',n+=u||0!==w.S||w.FD===zmail.folId.oId?'<div class="zmPT">':'<div class="zmPT zm_urd">',n+='<div class="zmpr"><div class="SCmb"><div class="SC_frt">',(3===a.opentype||M&&!N)&&(J=!1);var Q=!1;if(zmUtil.isChildWindow()){if(w&&w.RMOBJ&&!$.isEmptyObject(w.RMOBJ)){var R=w.RMOBJ.WT;1!==R&&2!==R&&3!==R||(Q=!0)}zmail.folId.dId!==w.FD&&zmail.folId.spId!==w.FD&&zmail.folId.tId!==w.FD&&zmail.folId.teId!==w.FD||(Q=!1)}else Q=zmList.isRMOBJ(m);zmUtil.isZohoAccount(zmail.accId)||(Q=!1);var S=!1;if(zmUtil.isChildWindow()||u||!Q&&!v(m)||(n+='<ul id="zmprv_header_'+m+'_remind" title="',n+=Q?f.contextmenu.updReminder:f.contextmenu.setReminder,n+='"><li><b><i class="msi-mailReminder',n+=(Q?' SC_thm"':'"')+' data-detail="prvHdr"></i></b></li></ul>',S=!0),!u&&J)if(w.FD===zmail.folId.oId)n+=['<ul class="SC_ldot"><li><b>','<i class="msi-edit" data-detail="prvHdr"></i>',"</b></li></ul>"].join("");else if(w.FD===zmail.folId.dId)n+=['<ul class="SC_ldot"><li><b>','<div class="SC_hd"></div>','<span><i class="msi-edit" data-detail="prvHdr"></i><i class="msi-barrow"></i></span>',"</b></li></ul>"].join("");else if(N)n+=['<ul class="SC_ldot"><li><b>','<i class="msi-edit" data-detail="prvHdr"></i></b></li></ul>'].join("");else{var T=zmUtil.isSharedFolder(I,"R")?"":['<ul><li title="'+f.contextmenu.reply+'"',S?' class="SC_lbr"':"",'><b><div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-reply"></i></span>',"</b></li>",'<li title="'+f.contextmenu.replyall+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-replyall"></i></span>',"</b></li>",'<li title="'+f.contextmenu.forward+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-forward"></i></span>',"</b></li></ul>"].join(""),U=["<ul><li",""!==T?' class="SC_lbr"':"",' title="'+f.iconTooltip.moreact+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-barrow"></i></span>',"</b></li></ul>"].join("");n+=T+U}n+="</div></div>",n+='<ul class="SC_pvul"><li><img src=""></img>';var V=a.frm,W=w.SN||a.sender;try{w.F===zmail.aInfo[zmail.accId].mailId&&(W="Me")}catch(X){}L["data-eid"]=V,F={attr:L,name:W,img:!1,eid:V};var Y=w.PR;if(1===Y||2===Y?n+="<i class='msi-priority SC_red'></i>":4!==Y&&5!==Y||(n+="<i class='msi-priority SC_blue'></i>"),G=zmConUtil.bubbleUtil(F),n+=G,g=zmPreviewTemplate._rPath(a,"less"),g._str&&(n+=g._str),c&&4===c){var Z=j(a.to)+j(a.cc,!0)+j(a.bcc,!0);if(Z.length){var _=Z;Z.length>70&&(Z=Z.substring(0,70)+"..."),n+='<div class="SC_cs zmBPVtoCc"><span class="greyText">'+f.contentOptions.To+'</span><span title="'+_+'">'+Z+"</span></div>"}else n+='<div class="SC_cs zmBPVtoCc"></div>'}if(n+='<span class="SC_lnk SC_ldot zm_unsub" style="display:none;">'+f.newsletter.unsubscribe+"</span>",zmUtil.isZohoAccount(zmail.accId)&&zmail.isSmartFilterEnabled&&w.SFT&&!zmUtil.isSharedFolder(w.FD)&&(!zmUtil.isChildWindow()||zmUtil.isChildWindow()&&opener)&&(n+='<span class="SC_lnk SC_ldot zm_exclude" title="'+f.smartfilter.exclude_tip+'">'+f.contentOptions.exclude+"</span>"),n+="<div>",1===a.hasAtt&&(n+='<i class="msi-attachicon"></i>'),u||w.FD===zmail.folId.spId||w.FD===zmail.folId.oId||w.FD===zmail.folId.dId||(!w.streams||w.groupId!==zmail.zuid||"0"===w.NFG)&&w.streams||(n+=q(a.flag)),w.DT||(w.DT=a.date),n+='<span class="sum">'+w.DT+"</span>",!a.label&&w.TAG&&(a.label=w.TAG),O||u||(a.label&&a.label.length?w.FD!==zmail.folId.spId&&w.FD!==zmail.folId.dId&&(H=zmsTemplates.constructTagListHTML(a.label,!1,"",P,{constructOuterDiv:!0,customClass:"zmViewAllLbl"}),H+='<i class="msi-plus zmst_lbl"></i>'):H='<i class="msi-label"></i>',n+='<div class="SC_ldot zm_lbl">'+H+"</div>"),w.streams&&!zmUtil.isChildWindow()){var aa;aa=w.isFav?'<i class="msi-fav SC_fav"></i>':'<i class="msi-fav"></i>',n+='<div class="SC_ldot">'+aa+"</div>"}if(""!==a.isReadable&&void 0!==a.isReadable&&(n+='<span class="SC_ldot">'+a.isReadable+"</span>"),u||(r=o(I),r&&w.AR&&(r+=" ("+f.contentOptions.archived+")"),0!==a.opentype&&4!==a.opentype||b&&"search"===b.view?n+=p(r):!b||b.fId&&1!==w.TH||(n+=p(r))),n+="</div></li></ul>",n+='<i class="msi-zmPme"></i>',n+='<i style="display:none;" class="msi-share js-shareicon"></i>',n+="</div>",e="<font>"+a.sm+"</font>",a.thd||(e+="<span>",a.to&&!i(a.to)&&s.push(k(a.to,{hideEmail:!0})),a.cc&&s.push(k(a.cc,{hideEmail:!0})),a.bcc&&s.push(k(a.bcc,{hideEmail:!0})),e+=s.join(", "),e+="</span>"),n+='<div class="zmpr zmpsrt">',n+=e+"</div>",a.to&&!i(a.to)&&(n+='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em title='+f.contentOptions.to+">"+f.contentOptions.to+"</em> "+k(a.to)+"</span></div></div></div>"),a.cc&&(n+='<div id="zmCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+f.contentOptions.cc+"</em> "+k(a.cc)+"</span></div></div></div>"),a.bcc&&(n+='<div id="zmBCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+f.contentOptions.bcc+"</em> "+k(a.bcc)+"</span></div></div></div>"),a.to||a.cc||a.bcc||(n+='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+f.contentOptions.to+"</em></span></div></div></div>"),O||(a.label&&a.label.length?w.FD!==zmail.folId.spId&&w.FD!==zmail.folId.dId&&(n+=['<div id="zmLBL'+a.elemId+'" class="zmpdtl"><div>','<div class="zmpr"><span><em title='+f.contentOptions.tags+">"+f.contentOptions.tags+'</em><div class="zm_lbl">',zmsTemplates.constructTagListHTML(a.label,!0,"",P,{constructOuterDiv:!0}),"</div></span></div></div></div>"].join("")):n+=['<div id="zmLBL'+a.elemId+'" class="zmpdtl"><div>','<div class="zmpr"><span><em title='+f.contentOptions.tags+">"+f.contentOptions.tags+'</em><div class="zm_lbl">','<i class="msi-label"></i></div></span></div></div></div>'].join("")),h=zmPreviewTemplate._rPath(a),n+=h._str,n+="</div>",n+='<div class="zmmre">',!u&&a.showIndex){var ba=w&&zmUtil.getListMap(w.T);if(w.TH&&ba){var ca,da;zmUtil.isChildWindow()?(da=ba.MO,ca=da.length):(da=zmList.getListForAllMailsView(b,w.T,!0),ca=da.length);var ea=da.indexOf(m);ea!==-1&&(ea+=1,n+='<span id="zm_readtitle">'+f.contentOptions.readingindex+"<em>"+ea+"</em>/<em>"+ca+"</em></span>")}}n+="</div></div>";var fa=$(n);return t(fa),fa[0].outerHTML},x=function(a,c){var d,e="",g=!1;"plainContent"===c.type&&(g=!0);var h=c.msgId||a.msgId||"",i=zmUtil.getMailObj(h),j=""!==a.SENDER?a.SENDER:a.FROM,k=i&&i.AT||c.att||0,l=i&&i.TAG||c.tg||null,m=i&&i.NFG||c.flg||null,n=i&&i.SM||c.sm||"",o=a.TO||"",p=a.CC||"",q=a.BCC||"",r=a.RDT||"",s=a.READSTATUS||"",t=a.CONTENT?a.CONTENT:"",v=c.opentype,x=a.DATECONTENT||"",y="";zmail.showFeature&&(y=a.readTime?a.readTime:zmUtil.textReadTime(t),a.readTime=y),_zm._isPrivilegedUser()&&!zmUtil.isChildWindow()&&x&&(t=dateParser.focusOnDate(t,x)||t);var z=$("<div>").html(t),A=z.find("#zmail_block");if(o=o.replace(/&lt;/gi,"<"),o=o.replace(/&gt;/gi,">"),p=p.replace(/&lt;/gi,"<"),p=p.replace(/&gt;/gi,">"),q=q.replace(/&lt;/gi,"<"),q=q.replace(/&gt;/gi,">"),a.BLCKCON)if(A.length){var B=document.createElement("i");B.className="msi-ellipsis zmDoubleIcon",A.append(B),A.after("<div style='display:none'>"+a.BLCKCON+"</div>"),t=z[0].innerHTML}else t+=z.text().trim().length?"<div><i class='msi-ellipsis zmDoubleIcon'></i></div><div style='display:none'>"+a.BLCKCON+"</div>":"<div>"+a.BLCKCON+"</div>";0===v||4===v?d=b&&"search"===b.view?"S"+h:"P"+h:2===v?d="T"+h:1===v?d="W"+h:3===v&&(d="N"+h),e+=i&&i.TH?!b||b.fId!==i.FD&&""!==b.fId?'<div class="SC_pct SC_Tfcs SC_Tfdr">':'<div class="SC_pct SC_Tfcs">':'<div class="SC_pct">';var C={msgId:h,frm:a.FROM,sender:j,hasAtt:k,to:o,cc:p,bcc:q,label:l,flag:m,date:r,sm:n,elemId:d,opentype:c.opentype,src:c.src,readsts:s,isSharedDraft:c.isDraftMail,isDraftEditable:c.isDraftEditable,isReadable:y,showIndex:c.showIndex,rFrom:c.rFrom,showLimitedData:g,elemObj:c.elemObj,via:a.SPAMDATA&&a.SPAMDATA.VIA,viaDomain:a.SPAMDATA&&a.SPAMDATA.VIA_DOMAIN};C.rPath=a.RETURNPATH,C.delegate=a.DELEGATE,e+=w(C,c.opentype),e+='<div id="zmCon'+d+'">';var D=g?"":'<div class="zmRdrIco"><i class="msi-readerView SC_thm" title ="'+f.contentOptions.reader+'"></i></div>';if(e+=D,e+='<div id="zmC'+d+'" class="zmPCon">',a.EXTIMG&&"none"!==a.EXTIMG.link){var E=zmText.applyArgs(f.contentOptions.alwaysshow,{emailid:i.F}),F=zmText.applyArgs(f.contentOptions.hideimage,{emailid:i.F});e+=['<div class="SC_simg" id="ImgDis'+d+'">','<a style="display:none;" href="javascript:void(0)" data-mode="temporary">',f.contentOptions.display,"</a>",'<a style="display:none;" href="javascript:void(0)" data-mode="whitelist">',E,"</a>",'<a style="display:none;" href="javascript:void(0)" data-mode="blacklist">',F,"</a>",'<span style="display:none;" data-mode="message">',f.contentOptions.imagehidden," </span></div>"].join("")}e+='<div class="zmPCnt"><table cellpadding="0" cellspacing="0" border="0"><tr><td class="jsConTent">'+t+"</td></tr></table></div>",a.SHRINKED&&!g&&(e+=a.BLCKCON&&a.CONTENT.length<a.BLCKCON.length?'<div class="SC_simg" id = "clippedMsg" style="display:none;"><font id="vfc'+d+'">'+f.contentOptions.viewfullcontent+"</font><span>[ "+f.contentOptions.truncated+" ]</span></div>":'<div class="SC_simg" id = "clippedMsg"><font id="vfc'+d+'">'+f.contentOptions.viewfullcontent+"</font><span>[ "+f.contentOptions.truncated+" ]</span></div>"),e+="</div>";var G=i&&i.FD;return 3===v||c.isDraftMail||g||zmUtil.isSharedFolder(G,"R")||(e+=u(h)),e+="</div>"},y=function(a,b){if(a){var c=!zmUtil.isChildWindow(),d=zmUtil.getMailObj(a);d.TAG=d.TAG||[];var g,h=d.TAG,i="";d.streams&&(i="default");var j=zmsTemplates.constructTagListHTML(h,!0,"",i,{constructOuterDiv:!0}),k=zmsTemplates.constructTagListHTML(h,!1,"",i,{constructOuterDiv:!0}),l="",m="";c&&(l=ZMail.lView.constTemplate("labels",{tagLst:h}));var n=k;j.length&&h.length||(j='<i class="msi-label"></i>'),b&&b.length&&(g=b[0].id,g.indexOf("t")||(g=g.substring(1)));var o=["","t","zmHdrP","zmHdrT","zmHdrW","zmHdrS","zmHdrN"];for(var p in o){var q;q="1"===p&&g?$("[id="+o[p]+g+"]"):$("[id="+o[p]+a+"]"),!c||"0"!==p&&"1"!==p?m="zm_lbl":(n=l&&l.outerHTML,m="jsLabel");for(var r=0;r<q.length;r++){var s,t=q.eq(r),u=t.find("."+m);switch(u.remove(),o[p]){case"":c?"0"===zmAdHocSettings.getCustomizeMailListing().label&&t.find("."+e.labelDQA).prepend(zdom("div",{"class":m})):t.find("."+e.labelDQA).after(zdom("div",{"class":m}));break;case"t":c?"0"===zmAdHocSettings.getCustomizeMailListing().label&&t.find("."+e.labelDQA).prepend(zdom("div",{"class":m})):t.find("."+e.labelDQA).after(zdom("div",{"class":m}));var v=g&&zmUtil.getMailObj(g);v&&(v.TTAGS=v.TTAGS||[],h=v.TTAGS||h,n=c?ZMail.lView.constTemplate("labels",{tagLst:h,ty:"string"}):zmsTemplates.constructTagListHTML(h,!1,4,i,{constructOuterDiv:!0}));break;case"zmHdrP":s="zmLBLP"+a;break;case"zmHdrT":s="zmLBLT"+a;break;case"zmHdrW":s="zmLBLW"+a;break;case"zmHdrS":s="zmLBLS"+a;break;case"zmHdrN":s="zmLBLN"+a}if(s){n=h.length?k+'<i class="msi-plus zmst_lbl"></i>':'<i class="msi-label zmst_lbl"></i>',$("#"+s).remove();var w='<div id="'+s+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+f.contentOptions.tags+"</em></span></div></div></div>";t.find(".zmvia").length?$(w).insertBefore(t.find(".zmvia").eq(0)):t.find(".zmPT").append(w),$("#"+s).find("span").append("<div class='zm_lbl'></div>"),t.find(".zmpr").eq(0).find(".sum").after("<div class='SC_ldot zm_lbl'></div>")}u=t.find("."+m),u.length&&(2===u.length?(u.eq(0).html(n),u.eq(1).html(j)):1===u.length?u.html(n):u.html(j))}"t"===o[p]&&(h=d.TAG,n=zmsTemplates.constructTagListHTML(h,!1,"",i,{constructOuterDiv:!0,customClass:"zmViewAllLbl"}))}}},z=function(a){var b=zmUtil.getMailObj(a);if(b&&b.FD===zmail.folId.sId){var c,d=["","t","zmHdrP","zmHdrT","zmHdrW","zmHdrS"];d.forEach(function(b){c=$(String("[id="+b)+a+"]"),c.each(function(a,b){$(b).removeClass("zmsnt"),$(b).hasClass("zm_tm")&&$(b).addClass("zmsnt")})})}},A=function(a,b){var c,d=[],e=[];"t"===a.charAt(0)?(a=a.substring(1),e.push(a)):d.push(a);var f="",g=zmUtil.getMailObj(a);g&&g.streams&&(f="default");var h=zmUtil.getTagList(f),i={};i.parentDOM=$(b),i.displayAs="popup",i.accType=f,i.labelState={mailList:[{id:a,ttag:Boolean(e.length)}]},i.onStateChange=function(a,b){zmUtil.isChildWindow()?zmWindow.applyActions("label","click",{msgId:d,thd:e,lA:b?"add":"delete",lId:a,accType:f,disp:h[a].dispName}):zmail.MailAction.Initializer.applyActions("label","click",{msgId:d,thd:e,lA:b?"add":"delete",lId:a,accType:f,disp:h[a].dispName})},i.onCreate=function(a,b){zmlab.isValidName(a,"",f)&&zmlab.labelCreate(a,f,{reqDoneClbk:function(a,b){a&&(i.onStateChange(b,!0,function(){}),c.hide())},color:b})},c=zmUtil.createFLComp("label",i),c.show()},B=function(a){var b=zmUtil.getMailObj(a),c=b.FD;if(!b)return!1;var d={accId:zmail.accId,msgId:a,folId:c,split:!0,summary:!0,vfc:!0};return 0===b.S&&(d.markread=!0),b.AR&&(d.archiveStatus=!0),c&&zmUtil.isSharedFolder(c)&&(d.shId=zmUtil.getShareId(c),d.isSh=!0,d.shareId=d.shId,d.groupId=zmail.shrTree[0][c].OZUID),b.streams&&(d.accId=b.accId,delete d.folId,d.actionType=b.actionType,d.streamsView="true",d.groupId=b.groupId,d.entityId=a,d.entityType=b.entityType),d},C=function(a){if(a.readTime)return!1;var b=zmUtil.textReadTime(a.CONTENT);return a.readTime=b,!0},D=function(a,b){var c=a&&zmContentCache.get(a);c&&zmAppLoader.load("zmReader").then(function(){var d,e=function(){var c={},e=function(){var d;c.currMsgId=a,b=b?$(b).closest(".SC_Twpr"):zmsuite.getCenter()[1].$el.find(".SC_Twpr"),b.length&&b.find(".SC_pct").length>1?(d=zmUtil.getMailObj(a).T,c.mList=d&&zmUtil.getListMap(d,"MO")||[a]):c.mList=[a],c.index=c.mList.indexOf(c.currMsgId)};return e(),{hasNext:function(){return c.index<c.mList.length-1},hasPrev:function(){return c.index>0},fetchMail:function(a,b){var e,f={};if("prev"===a)c.index-=1,c.index=Math.max(c.index,0),e=c.mList[c.index];else{if("next"!==a)return;c.index+=1,c.index=Math.min(c.index,c.mList.length-1),e=c.mList[c.index]}if(c.currMsgId=e,zmContentCache.isCached(e))f=zmContentCache.get(e),0===zmUtil.getMailObj(e).S&&zmail.MailAction.Initializer.applyActions("read","click",{msgId:[e],thd:[]}),C(f),b.resolve(d(e,f));else{var g=B(e),h=function(a){if(C(a),"success"===a.READSTATUS){var c=zmUtil.isChildWindow()?zmWindow.rapplyActions:zmail.MailAction.Initializer.rapplyActions;c({result:"success"},{mailId:[e],thd:[],action:"read"})}b.resolve(d(e,a))};zmUtil.isChildWindow()?zmWindow.sendMailDataReq(g,{},h):zmList.sendMailDataReq(g,{},h)}},isConversation:function(){return 1!==c.mList.length},convCount:function(){return c.mList.length},currIndex:function(){return c.index+1}}}();d=function(a,b){var c=zmUtil.getMailObj(a);return{title:c.SB,date:c.DT,mailId:c.F,content:b&&b.CONTENT,handler:e,readTime:b&&b.readTime,attList:b.NEWATT||[]}},C(c),zmReader.load(d(a,c))})},E=function(b,d,g){var h,i=b.target||b.srcElement,j="",k="",o="";i=$(i),j=$(i).closest(".SC_pct").children(":first").attr("data-mid"),k=$(i).closest(".SC_pct").children(":first").attr("data-elmId")||(zmPreviewTemplate.getPrefixOnCurrentab()||c)+j,h=$(i).attr("class")||"";var p=zmUtil.getMailObj(j);if(h.indexOf(e.flag)!==-1?h="zmflg":h.indexOf("zm_unsub")!==-1?h="zm_unsub":h.indexOf("msi-fav")!==-1?h="msi-fav":h.indexOf("zm_exclude")!==-1?h="zm_exclude":h.indexOf("msi-ellipsis")!==-1&&(h="msi-ellipsis"),h||!i.parent().hasClass("SC_cs")||i.closest(".SC_pct").hasClass("SC_Drft")||(i=i.parent(),h=i.attr("class")),(i.hasClass("msi-label")||i.hasClass("zmst_lbl")||i.closest(".zmLbl").length)&&(h="zm_lbl"),"IMG"===i[0].tagName){var q=[/(?:https?:\/\/)?[^.\s]+\.youtube\.[^.\/]+\/[^\s]*watch\?[^\s]*v=([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?[^.\s]+\.youtube\.[^.\/]+\/v\/([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?youtu\.be\/([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g];if("A"===i.parent()[0].tagName){var r,u,v,w,x,y=q.length,z=i.parent()[0].href,B="",C="//www.youtube.com/embed/{{videoID}}{{extraParams}}",E=/(?:([0-9]*)h)*(?:([0-9]*)m)*(?:([0-9]*)s)*/gi;for(r=0;r<y;r++)if(u=q[r],null!==(v=u.exec(z))&&v[1]){w=v[1],x=v[2]||"",h="youtubeurl";break}if(w){if(B=C.replace(/\{\{videoID\}\}/,w),x){E=C.timeParseRegex,E.lastIndex=0;var F=E.exec(x);F[1]=parseInt(F[1])||0,F[2]=parseInt(F[2])||0,F[3]=parseInt(F[3])||0;var G=3600*F[1]+60*F[2]+F[3];B=B.replace(/\{\{extraParams\}\}/,"?start="+G)}else B=B.replace(/\{\{extraParams\}\}/,"");o=B}}else h="slidez"}switch(h||"prvHdr"!==i.find("i").attr("data-detail")||(i=i.find("i"),h=i.attr("class")),h=h.replace("SC_ldot","").trim(),h=h.replace("SC_thm","").trim(),h=h.replace("msi-share","").replace("shd","").trim()){case"msi-readerView":D(j,i);break;case"msi-zmPme":case"msi-zmPle":s(),t(d.find("#zmHdr"+k),b);break;case"msi-reply":case"msi-replyall":case"msi-forward":var H={"msi-reply":"reply","msi-replyall":"replyall","msi-forward":"forward"};"prvHdr"===i.attr("data-detail")&&(l(i,d),a.bindAction({action:H[h]},i,{containerDOM:$(i).closest(".SC_pct").parent()})),_zm.stopEvents(b);break;case"msi-mailReminder":zmWatch.showWatch({msgId:j,elem:i,openWatch:"preview_header",loadType:"popup"}),_zm.stopEvents(b);break;case"msi-download":a.show("zm_dldLst",i);break;case"msi-barrow":l(i,d),i.parents("ul").attr("cmprid")?a.show("zm_prvRepLst",i):"prvHdr"===i.attr("data-detail")?a.show("zm_preaLst",i,{containerDOM:$(i).closest(".SC_pct").parent()}):i.prev().hasClass("msi-edit")?a.show("zm_preaLst",i):i.prev().hasClass("msi-download")&&a.show("zm_dldLst",i);break;case"msi-attachicon":a.posAView(k,d),_zm.stopEvents(b);break;case"msi-ellipsis":i.toggleClass("sel"),m(i.parent());break;case"zmflg":if(zmUtil.isReadOnlyMail(j))return void _zm.stopEvents(b);n(i),_zm.stopEvents(b);break;case"msi-edit":zmUtil.isChildWindow()||"prvHdr"!==i.attr("data-detail")||zmUtil.invokeComposer({mode:"outbox",msgId:j});break;case"SC_cs":case"zm_eadd":var I=[{htm:f.contactbubble.addcontact,id:"zms_add",clk:zmConUtil.handleAddToContact}];zmUtil.isChildWindow()||(I=I.concat([{htm:f.contactbubble.sendmail,clk:zmConUtil.loadCompose},{htm:f.contactbubble.listmails,clk:zmConUtil.listMails},{htm:f.contactbubble.listattachments,clk:zmConUtil.listAttachment}]));var J={dom:i,items:I,event:b,source:"mail"};J.displayName="SC_cs"===h&&p&&zmUtil.decodeHTMLEntities(p.SN)||void 0,zmUtil.isChildWindow()&&(J.source="popmail"),zmConUtil.showContactCard(J).done(function(a){var b=zmContentCache.isCached(j)&&zmContentCache.get(j),c=parseInt(b.SPAMDATA.ALERT_TYPE);"SC_cs"===h&&1===c&&a.replaceAvatar(zdom("div",{"class":"SC_avtr"},zdom("span",null,zdom("i",{"class":"msi-spamAvatar"}))))});break;case"youtubeurl":var K=[],L={ft:103,fn:"file.mp4",src:o,showInFrame:!0,hideFileName:!0,hideShareOption:!0};K.push(L),zmUtil.initAttSlideShow(K,0,!0),_zm.stopEvents(b);break;case"slidez":zmPreviewTemplate.slideZImages(i);break;case"zm_lbl":if(p&&p.streams)$(i).addClass("zmst_lbl"),zmStreamsApp.util.bindEntityElements({entityId:j,entityElem:i,entityType:1});else{var M=p&&p.FD;if(zmUtil.isSharedFolder(M))return;var N=i.closest(".zmLbl");N=N.length?N[0]:i,A(j,N)}break;case"msi-fav":zmStreamsApp.util.bindEntityElements({entityId:j,entityElem:i,entityType:1,data:p});break;case"zm_draft":var O=i.closest(".SC_pct").children().eq(1);zmPreviewTemplate.loadInlineCompose(j,O);break;case"SC_plnk":var P=i.attr("data-detail");"downloadall"===P&&a.bindAction({action:P,msgId:j},i);break;case"js-shareicon":case"js-shareicon sld":var Q=$(i).parents(".zmPHdr").parents(".SC_pct").parent()[0];$.publish("/mail/preview/updateshare",{mailID:j,containerDOM:$(Q)[0],elm:i[0]});break;case"zm_unsub":zmPreviewTemplate.processUnsubscription(j,d);break;case"zm_exclude":var R,S;if(p){R=p.F||"",S=p.SFT;var T={5:f.smartfilter.notification,6:f.smartfilter.newsletter,7:f.smartfilter.group};if(R&&S){var U=zmText.applyArgs(f.smartfilter.confirm_msg,{email_address:R,smart_filter_name:T[S]});zmsDialog.confirm(U,{onOk:function(){zmPreviewTemplate.classifySmartFilter(j,S,!1,$(i).closest(".SC_pct"))}})}}break;case"zm_inLnk":var V=zmContentCache.isCached(j)&&zmContentCache.get(j),W=i.attr("data-value");if(!V||!W)return;W=W.replace(/ /,"T");var X={par:i,title:V.SUBJECT,desc:"",ts:W};dateParser.loadQuickAdder(X);break;default:var Y,Z;if(zmUtil.isChildWindow()||zmTab.currentTab.indexOf("zm_srch")===-1||(Z=zmSearchUtil.getSearchViewDetails()),Z&&"search"===Z.view&&zmSearchUtil.isWorkspaceAvailable()&&(Y="zm_srch1"),i.attr("id")&&i.attr("id").indexOf("vfc")!==-1){l(i,d);var _={msgId:j,type:"lt",opentype:void 0!==g?g:zmPreviewTemplate.currentWorkSpace,vfc:!0};zmUtil.isChildWindow()?zmWindow.getMail(_):(_.tabId=Y,zmList.getMailData(_)),i.parent().hide()}else{var aa=i.closest(".zmPHdr");if(!aa.length)return;if(!aa.hasClass("zm_tm")&&aa.hasClass("zms")){var ba=aa.children(".zmPT:first").children(".zmpr:first")[0];if(i[0]!==ba&&!$.contains(ba,i[0]||"zmmre"===h))return}var ca=p.FD===zmail.folId.dId;if(aa.length&&(!ca&&d.find(".SC_pct").length>1&&(l(i,d),aa.toggleClass("zm_tm"),aa.removeClass("zmsnt"),p.FD===zmail.folId.sId&&aa.hasClass("zm_tm")&&aa.addClass("zmsnt")),a.toggleMailContentViewMode(aa,g,Y),!aa.hasClass("zm_tm")))if(zmUtil.isChildWindow())zmUtil.setPreviewScroll(aa.closest(".SC_pct"),d);else{var da=aa.closest(".SC_pct");zmUtil.setPreviewScroll(da,da.parent())}}}},F=function(a,b){var c,d=a.target||a.srcElement,e="",g=zmUtil.getCmpViewType();c=$(d).attr("data-type"),e=$(d).closest(".SC_pct").find(".zmPHdr").attr("data-mid"),l(d,b),g.mode=c,g.msgId=e;var h=zmUtil.getMailObj(e);switch(h&&h.streams&&(g.groupId=h.groupId,g.streamsView=!0),c){case"outbox":zmUtil.invokeComposer(g);break;case"eanew":zmUtil.invokeComposer(g);break;case"reply":case"replyall":case"fwdi":"fwdi"!==c||zmUtil.isChildWindow()||$.publish("/mail/forwardmail",{mailID:e,workspaceID:zmTab&&zmTab.currentTab,containerDOM:$(d).closest(".SC_pct").parent(),mode:"forward"}),zmUtil.isInlineCompose()&&h&&h.DMID&&zmComp.getCmpObjId(e).cmpId?(d=b.find("#zmCon"+g.viewType+h.DMID),l(d,b)):zmUtil.getMailContent(e).then(function(a){g.prevElem=$(d).closest(".SC_Twpr"),zmContentCache.isCached(e)&&(g.draftCont=a),zmUtil.invokeComposer(g)}).fail(function(){_zm.succErrMsg(f.inlinecompose.error)});break;case"sharemail":$.publish("/mail/view/focuscommentbox",{mailID:e,containerDOM:$(d).closest(".SC_Twpr"),showCommentBox:!0})}},G=function(a){a=$(a);var b=a.hasClass("SCS_postMail")||a.parent(".SCS_postMail").length>0||"zmncenter"===zmTab.currentTab,c="zmStreamsApp"===zmTab.currentTab,d=zmsuite.getCenter()[0].$el.hasClass("zms_streams"),e=0!==a.find(".SCS_cmnt").length;return b||c||d||e},H=function(a,b,c,d){try{var e,f,g,h,i=[],j=[];d||(d=$(c).closest(".SC_pct"),b=b||d.find(".zmPHdr").attr("data-mid"));var k={id:"externalLink",url:"externalURL"},l={id:"extBackImgId",url:"extBackImgURL"},m={id:"extListBackImgId",url:"extListBackImgURL"},n={id:"extStyleImgId",url:"extStyleImgURL"},o=zmContentCache.get(b);if(e=zmContentCache.isCached(b)&&o.EXTIMG,!e)return;var p,q=$("<div/>");q.html(o.CONTENT),o.BLCKCON&&(p=$("<div/>"),p.html(o.BLCKCON));var r=function(a,b){i=e[a.url],j=e[a.id],f=i.length;var c;for(h=0;h<f;h++)if(g=i[h].replace(/&amp;/gi,"&"),c=d.find("#"+j[h]).length?"#"+j[h]:"[data-extimg_id="+j[h]+"]","extbg"===b)d.find(c).css("background-image","url("+g+")"),q.find(c).css("background-image","url("+g+")"),p&&p.find(c).css("background-image","url("+g+")");else if("ext"===b)d.find(c).attr("src",g),q.find(c).attr("src",g),p&&p.find(c).attr("src",g);else if("listBG"===b)d.find(c)[0].style.listStyleImage="url("+g+")",q.find(c)[0].style.listStyleImage="url("+g+")",p&&(p.find(c)[0].style.listStyleImage="url("+g+")");else if("extStyle"===b){var k=d.find(c)[0],l=j[h].split("_"),m=["cursor","styleurl"];if(l[1]===m[0]&&l[2]===m[1]){var n,o=k.style.cursor;o.indexOf('url("")')>=0&&(n=o.replace('url("")',""),k.style.cursor='url("'+g+'")'+n)}}};e.externalURL&&e.externalURL.length&&r(k,"ext"),e.extBackImgURL&&e.extBackImgURL.length&&r(l,"extbg"),e.extListBackImgURL&&e.extListBackImgURL.length&&r(m,"listBG"),e.extStyleImgId&&e.extStyleImgURL.length&&r(n,"extStyle"),c&&$(c.parentElement).hide(),o.EXTIMG.link="none",o.CONTENT=q.html(),p&&(o.BLCKCON=p.html())}catch(s){zmUtil.debugLog(s)}},I=function(a,b){var c={t:"POST",u:zmail.conPath+"/readreceipt.do",p:{mode:b,msgId:a,accId:zmail.accId,folType:"p"}};zmAjq.XHR(c),zmUtil.updateMailData("RR",0,a)},J=function(a,b){var c="";return c+=b?'<div class="SC_pct">':'<div class="SC_pct SC_Tfdr">',c+=zmPreviewTemplate.getTemplate("header",a),c+="</div>"},K=function(){$.subscribe("/mail/draftsaved",function(a,b){b=b||{};var c=b.draftId,d=b.msgId;if(c&&d){var e="[id$="+d+"New]",f=$(e);f.each(function(a,b){b=$(b),b.attr("data-mid",c);var e=b.attr("id");b.attr("id",e.replace(d+"New",c))})}})},L=function(a){if(a=a||{},a.containerDOM&&a.mailID&&a.hasOwnProperty("state")){var b=a.containerDOM,c=a.mailID,d=a.state,e=a.tooltip||"",f=$(b).find("[data-mid="+c+"]").find(".js-shareicon");switch(f.attr("title",e),d){case 1:f.addClass("shd").show();break;case 0:f.removeClass("shd").show().data("shared",!1);break;case-1:f.removeClass("shd").hide();break;default:f.hide()}}},M=function(){$.subscribe("/mail/collab/updateshareicon",function(a,b){b=b||{},L(b)})},N=function(a){var b,c=zmUtil.getListMap(a);return c&&(b=c.MO.length),b},O={currentWorkSpace:"",showOrgList:[],
getTemplate:function(a,b){var c=void 0!==b.opentype?b.opentype:b.prms.opentype;b.prms&&"plainContent"===b.prms.type||(h(c),g());var d="";switch(a){case"content":d=x(b.data,b.prms);break;case"header":d=w(b,c)}return d},attPrevInr:function(a){var b,c=zmUtil.fileTyp(a.fn,a.attType);return b=a.thn?"<img src='"+a.thn+"'>":"<i class='"+c[1]+" zm-attIcn'></i>"},getSubjectToPreview:function(a){var b=f.common.noSubject;return zmail.showFeature?a:(a&&(b=_zm.unescapeTags(a),b.length>1e3?(b=b.substring(0,1e3)+"...",b=_zm.escapeTags(b)):b=a),b)},consFlagContextMenu:function(a){var b,c,d,g;return b=a.target||a.srcElement,c=$(b),c.hasClass(e.flag)&&(d={clk:function(a,b){zmUtil.isChildWindow()?zmWindow.flagMail(c,b):zmPrev.changeFlag(c,b)},conArr:[{htm:"<i class='"+e.blueflag+"'></i>"+f.flagmenu.infoflag,data:{flag:"1"}},{htm:"<i class='"+e.redflag+"'></i>"+f.flagmenu.important,data:{flag:"2"}},{htm:"<i class='"+e.greenflag+"'></i>"+f.flagmenu.followup,data:{flag:"3"}},{sep:!0},{htm:"<i class='"+e.noflag+"'></i>"+f.flagmenu.clearflag,data:{flag:"0"}}]},zmUtil.isChildWindow()?(g=new zmContextMenu,g.setMenuObj(d),g.paint(a)):g=zmsuite.showContextMenu(a,d),_zm.stopEvents(a)),!1},bindPreviewEvents:function(a,b){var c;zmUtil.addSelectMenu({applyDOM:[a.find(".zmPCon")[0]]}),$(a).find("."+e.flag).each(function(){$(this).unbind("contextmenu").contextmenu(function(a){zmPreviewTemplate.consFlagContextMenu(a,this)})}),3!==b?(c=$(a).find(".SC_Twpr"),$(a).find(".SC_Twpr").scroll(function(){zmUtil.hideMenu()}),$(a).keydown(function(a){38!==a.keycode&&40!==a.keycode||zmUtil.hideMenu()})):c=$(a).find(".SCS_postMail"),c.off("click.mailView").on("click.mailView","div.SC_pct",function(c){zmAttach.util.removeMAct(),E(c,a,b);var d=c.target||c.srcElement;if($(d).hasClass("zm_ry")||$(d).parent().hasClass("zm_ry")){var e=$(d).closest(".SC_pct").find(".zmPHdr").attr("data-mid");if(zmPreviewTemplate.isTruncatedMail(e)){var f={mId:e,toHideVfcMsg:!0};zmPreviewTemplate.FCLoader(f,function(){F(c,a)})}else F(c,a)}zmUtil.isChildWindow()||!zmList.listingFocused||0!==zmPreviewTemplate.currentWorkSpace&&4!==zmPreviewTemplate.currentWorkSpace||(zmList.listingFocused=!1,$(d).hasClass("msi-ellipsis")&&(zmList.listingFocused=!0))}),3===b&&$(a).find(".SC_ptit .popOut").off("click").on("click",function(){var b={msgId:$(a).attr("msgId"),gid:$(a).attr("groupId"),opentype:2,isMail:!0,pid:$(a).attr("pid"),thId:$(a).attr("thId"),invokedFrom:"notification-popout",actionType:$(a).attr("actionType"),etype:"1"};if($.publish("zmstreamsapp/closeDialog",{}),!zmsuite.isMaxLimitReached()){var c=$(this).data("shared"),d=$(this).data("reminder");if(c||d){var e;b.isSharedMail=!0,b.groupId!==zmail.zuid&&(e={viewDetails:{view:"zmncenter"}},b.tabId="zmncenter"),zmList.getMailData(b,e)}else zmStreamsApp.events.openPostInTab(b)}zmUtil.hideMenu()})},showImageDisplayElem:function(a,b,d){d=d||{};var e,f,g=(d.prefix||c)+a;if(e=zmContentCache.get(a).EXTIMG?zmContentCache.get(a).EXTIMG.link:"",e&&"none"!==e){var h={MESSAGE:3,SHOW_NOW:0,WHITELIST:1,BLACKLIST:2},i=b&&b.find("#ImgDis"+g)||$("#ImgDis"+g);f=i.children(),"display"===e&&(f.eq(h.MESSAGE).show(),f.eq(h.SHOW_NOW).show()),f.eq(h.SHOW_NOW).unbind("click").click(function(){l(this,b),H("",a,this)}),zmUtil.applyLBDots($("#ImgDis"+g)),d.isvfc&&"none"===d.imgStatus?f.eq(h.SHOW_NOW).click():d.isvfc&&"display"===d.imgStatus&&i.show(),d={}}},saveHTMLFile:function(a){zmUtil.secureDownloader().then(function(b){var c,d=b.password,e="",f=zmUtil.getMailObj(a.mId)||"",g={};zmUtil.isSharedFolder(f.FD)&&(c=zmUtil.getShareId(f.FD)),e=zmail.conPath+"/FileDownload?mode=msg",g={fName:"msg"+a.mId,entityId:a.mId,entityType:1},f.streams?(g.groupId=f.groupId,g.streamsView=!0,g.actionType="viewGroupEntity"):g.accId=zmail.accId,c&&e.length&&(g.shId=c),d&&(g.password=d),zmAjq.formSubmit(g,e)},function(){})},showOrgMsg:function(a){var b,c="",d=a.mId,e=zmUtil.getMailObj(d),f="h";b="/showOriginal.do",c=zmail.conPath+b+"?m="+d+"&sc="+f,e?(e.FD&&zmUtil.isSharedFolder(e.FD)&&(c+="&shId="+zmUtil.getShareId(e.FD)),c+=e.streams?"&accId="+e.accId+"&groupId="+e.groupId+"&streamsView=true&actionType=viewGroupMailEntity&entityType=1&entityId="+d:"&accId="+zmail.accId):c+="&accId="+zmail.accId,zmUtil.openWindow(c,"60","60")},garbMsg:function(a){var b="",c=a.mId,d=zmUtil.getMailObj(c);b=zmail.conPath+"/gmsg.do?m="+c,d&&(d.FD&&zmUtil.isSharedFolder(d.FD)&&(b+="&shId="+zmUtil.getShareId(d.FD)),b+=d.streams?"&accId="+d.accId+"&groupId="+d.groupId+"&streamsView=true&actionType=viewGroupMailEntity&entityType=1&entityId="+c:"&accId="+zmail.accId);var e=window.open(b,"_blank");e.focus()},printMsg:function(a){var b=function(a){var b=zmContentCache.isCached(a)&&zmContentCache.get(a).EXTIMG;return!b||"none"===b.link},c=function(){var b=Dialog["new"]({title:f.print.warningTitle,ignoreMouseDown:!1,$content:"<span>"+f.print.warningMsg+"</span>",buttons:[{name:f.common.ok,callback:function(){b.remove(),mailPrinter.print(a)}},{name:f.common.cancel,callback:function(){b.remove()}}]})};zmAppLoader.load("mailPrinter").then(function(){b(a.mId)?mailPrinter.print(a):c(a)})},showProfilePhoto:function(a,b,c){try{var d,e=function(a,b){var c,d=zmail.aInfo[zmUtil.getZohoAccId()];return c=d.mailId===a?d.disName:b},f=c||zmContentCache.isCached(a.msgId)&&zmContentCache.get(a.msgId)||"",g=zmUtil.getMailObj(a.msgId);if("lt"===a.type&&!g.T||"th"===a.type){var h=f.FROM||g.F,i=f.SENDER||g.SN,j=$(b).find(".zmPHdr");$(j).length||(j=$(b)),i||(i=h),"Me"===i&&(i=e(h,i)),zmail.ContactBook.get({str:h}).then(function(a){if(d=j.find(".unAuthSender").length,!d){var c,e=a[0];c=e?e.avatar():zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(h),avatarBgColor:zmail.ContactBook.Utils.colorClasses()}),$(j).find(".SC_pvul li img").remove(),$(j).find(".SC_pvul li").prepend(c),zmail.wmsAPI.showPresence(h,$(b).find(".SC_pvul .SC_avtr"))}})}else g.T&&$(b).find(".zmPHdr").each(function(){var a=$(this).attr("data-mid"),b=$(this).find(".SC_pvul li"),c=$(this).find(".SC_pvul img"),f=zmUtil.getMailObj(a),g=f.F,h=f.SN;h||(h=g),"Me"===h&&(h=e(g,h)),c.length&&g&&zmail.ContactBook.get({eid:g}).then(function(a){if(d=b.find(".unAuthSender").length,!d){var c,e=a[0];c=e?e.avatar():zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(g),avatarBgColor:zmail.ContactBook.Utils.colorClasses()}),$(b).find("div img").length||($(b).find("img").remove(),$(b).prepend(c),zmail.wmsAPI.showPresence(g,$(b).find(".SC_avtr")))}})})}catch(k){zmUtil.debugLog(k)}},processReadReceipt:function(a){var b=f.common.readreceiptmsg,c=zmUtil.getMailObj(a);if(!c||!c.streams){var d=1===c.RR,e=zmail.mailOpt?zmail.mailOpt.askReceipt:1;if(d){if(c.FD===zmail.folId.spId)return;1===e?zmsDialog.confirm(b,{onOk:function(){I(a,"yes")},onCancel:function(){I(a,"no")}}):0===e?I(a,"yes"):I(a,"no")}}},showFullContent:function(a,b){var d,e,f,g=a.mdata.CONTENT?a.mdata.CONTENT:"",h=!1,i=b.prefix||c,j=b.msgId,k=$("#zmCon"+i+j);e=k.closest(".SC_Twpr"),f=e.scrollTop(),d=k.find(".msi-ellipsis"),d.parent().next().is(":visible")&&(h=!0),a.mdata.BLCKCON&&(g+="lt"===b.type&&zmUtil.getMailObj(j).TC>=0||"content"===b.type?["<div><i class = 'msi-ellipsis zmDoubleIcon'></i>","</div><div style='display:none'>"+a.mdata.BLCKCON+"</div>"].join(""):a.mdata.BLCKCON),g&&k.find(".zmPCnt").html(g),d=k.find(".msi-ellipsis"),d.length&&h&&(d.toggleClass("sel"),m(d.parent())),e.scrollTop(f)},addMailsInView:function(a){var b,c,d,e,f,g,h=a.list||[],i=a.opentype,j=h.length,k=0,l="",m="",n="",o="";if(0!==j){for(a.contElem?(b=a.contElem,o=a.elemPrefix,d=a.viewDetails,i=a.opentype):0===i||4===i?(d=zmInit.getListingDetObj(),n="zm_Container",o="P",b=zmsuite.getCenter(n)[1].getNodes()[1].$el):2===i&&(n="zm_tabt"+zmUtil.getMailObj(h[0]).T,d=zmsuite.getCenterOuter(n).$el.data("data-detail"),o="T",b=zmsuite.getCenter(n)[1].getNodes()[1].$el),g=b.find("div.SC_pct").length,k=0;k<j;k++)c=zmUtil.getMailObj(h[k]),f={msgId:c.M,thd:!0,opentype:i,frm:c.F,sender:c.SN,hasAtt:c.AT,sm:c.SM,label:c.TAG,flag:c.NFG,date:c.DT,elemId:o+c.M,hdrId:"zmHdr"},!c.streams&&zmUtil.getMLConversionValue()&&(f.showIndex=!0),zmUtil.isChildWindow()||(e=c.FD===d.fId||!zmail.folCount[d.fId]),m=J(f,e),l=zmail.convSortOrder?m.concat(l):l.concat(m);for(l.length&&(1===zmail.convSortOrder||"showmore"===a.mode?$(l).insertAfter(b.find("div.SC_pct:last")):b.prepend($(l)),b.parent().addClass("tmail"),a.setscroll&&(1===zmail.convSortOrder?zmUtil.setPreviewScroll(b.find("div.SC_pct").eq(g),b):zmUtil.setPreviewScroll(b.find("div.SC_pct:first"),b))),k=0;k<j;k++)zmPreviewTemplate.showProfilePhoto({msgId:h[k],type:"th"},$("#zmHdr"+o+h[k]))}},discardMsgPreview:function(a){a&&(zmUtil.isChildWindow()?$("#zmHdrW"+a).parent().remove():($("#zmHdrP"+a).parent().remove(),$("#zmHdrT"+a).parent().remove(),$("#zmHdrS"+a).parent().remove()))},showNotifBand:function(a){var b=a.targetElem,c=a.thdId,d=[],e=a.opentype;0===e||4===e?d=zmPreviewTemplate.getMissingMailList(c,"P"):2===e&&(d=zmPreviewTemplate.getMissingMailList(c,"T")),zmPreviewTemplate.removeNotifBand(b);var g=_zm.getDOM(["DIV",{attrs:{"class":"SC_new_activity",style:"opacity:1;",id:"zms_newmail"},child:[["text"," "+f.common.notificationmsg+" "]]}]);$(b).append(g),$(g).off("click").on("click",function(c){zmPreviewTemplate.removeNotifBand(b),$.publish("/mail/updatemailview",[{list:d,opentype:a.opentype,setscroll:!0}]),_zm.stopEvents(c)})},removeNotifBand:function(a){$(a).find(".SC_new_activity").remove()},refreshLabelsForMail:y,updateMailHeaderView:z,toggleHeaderState:s,applyHeaderState:t,getRecipientCount:function(a){if(zmContentCache.isCached(a)){var b=zmContentCache.get(a),c=zmConUtil.splitncheck(b.TO||"","object").length;return c+=zmConUtil.splitncheck(b.CC||"","object").length,c+=zmConUtil.splitncheck(b.BCC||"","object").length}throw new Error(f.common.error)},alignMailTopToPreview:function(a){if(zmUtil.isMailOpenInPreview(a,zmTab.currentTab)){var b;"zm_Container"===zmTab.currentTab?b=$("#zmHdrP"+a):0===zmTab.currentTab.indexOf("zm_srch")&&(b=$("#zmHdrS"+a));var c=b.parent()[0],d=$(c).parent(".SC_Twpr")[0];d.scrollTop=c.offsetTop,$(c).removeClass("js-scrolltop")}},setPreviewHeaderHeight:function(a,b,c){b=b||zmTab.currentTab,a||(a={},a.prevElem=zmsuite.getCenter(b)[1].$el[0]);var d;if(a.prevElem){if(4!==c||"zm_Container"!==b&&b.indexOf("zm_srch")){var e=$(a.prevElem).find(".SC_ptit");d=e[0].clientHeight}else d="0";var f=$(a.prevElem).find(".SC_Twpr");d&&f.css({top:d+"px"})}},addDraftsToView:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=0,p=0;if(!(b.length&&b.find(".SC_Drft").length>0)){var q=zmUtil.getListMap(a);q&&(d=q.MO||[],o=d.length);var r=0;d=d||[],d.forEach(function(a,b){e=zmUtil.getMailObj(a)||{},e.DMID&&r++}),0!==r&&(e=void 0,zmUtil.requireComposeModule().then(function(){for(p=0;p<o;p++)e=zmUtil.getMailObj(d[p]),k="",e&&e.DMID&&(j=c+e.DMID,g=e.M,f=b.find("#zmHdr"+c+g).closest(".SC_pct"),"undefined"!=typeof zmComp&&(l=zmComp.getCmpObjId(g),k=l.cmpId,m=l.composerType||"inline"),k?(n=b.find("#zmCon"+c+e.DMID),n.length||(h=zmUtil.getCmpContainerTemplate(j,e.DMID),$(h).insertAfter(f),n=b.find("#zmCon"+j)),zmPreviewTemplate.showDraftedBand({draftId:e.DMID,msgId:g,composeId:k,elemPrefix:c,prevDOM:n,composerType:m})):(h=zmUtil.getCmpContainerTemplate(j,e.DMID),f.length&&($(h).insertAfter(f),i={mode:"draft",msgId:g,draftId:e.DMID,prevElem:b,draftCont:zmContentCache.get(e.DMID),loadType:"drafted",disableScrollIntoView:r>1},zmUtil.invokeComposer(i)))),zmUtil.setInlineCmpScope(!0)}))}},showDraftedBand:function(a){var b,c,d,e,g,h,i,j,k,l,m="inline";b=a.draftId,c=a.msgId,d=a.composeId,e=a.elemPrefix,k=a.prevDOM,g=k.closest(".SC_Twpr"),m=a.composerType;var n;j=g.find("#zmHdr"+e+c).closest(".SC_pct"),"tab"===m?(l=f.inlinecompose.editdraftintab,n=f.inlinecompose.editingmsg):(l=f.inlinecompose.edithere,n=f.inlinecompose.hasdraft),k.length||(k=g.find(".SC_Drft").find("[data-mid='"+c+"']")),!k.length&&j.length&&b&&(h=["DIV",{attrs:{"class":"SC_pct SC_Drft"},child:[["DIV",{attrs:{id:"zmHdr"+e+b,"class":"zmPHdr","data-mid":b}}],["DIV",{attrs:{id:"zmCon"+e+b},child:[["DIV",{attrs:{"class":"SC_simg"},child:[["FONT",{attrs:{"composer-type":m,"data-cmpid":d,"class":"zm_draft"},child:[["text",l]]}],["SPAN",{child:[["text",n]]}]]}]]}]]}],i=_zm.getDOM(h),$(i).insertAfter(j));var o,p=$("[data-mid="+b+"]").parents(".SC_pct.SC_Drft"),q=p.find("[id^=zmCon]"),r=["DIV",{attrs:{"class":"SC_simg"},child:[["FONT",{attrs:{"composer-type":m,"data-cmpid":d,"class":"zm_draft"},child:[["text",l]]}],["SPAN",{child:[["text",n]]}]]}];q.each(function(b,c){c=$(c),o=_zm.getDOM(r),c.find(".zm_cmp").length&&"replace_draft"!==a.actionType||c.html(o)}),k.length&&(o=_zm.getDOM(r),k.find(".zm_cmp").length&&"replace_draft"!==a.actionType||k.html(o)),zmUtil.applyLBDots($(document.body).find(".zm_draft").parent(".SC_simg"))},loadInlineCompose:function(a,b,c){if(a){var d,e,f,g,h=zmUtil.getMailObj(a),i={};if(h&&h.FD===zmail.folId.dId?d=h.PA:(d=a,a=h.DMID),i=zmComp.getCmpObjId(d),e=i.cmpId,g=i.composerType||"inline",f={mode:"draft",msgId:d,draftId:a,prevElem:b.closest(".SC_Twpr"),draftCont:zmContentCache.get(a),loadType:"drafted",reopen:!0,cmpId:e},c&&(f.loadMode=c),"tab"!==g)if(b.find(".zm_draft").length)b.html("");else if(b.find(".zm_cmp").length){var j=b.find(".zm_cmp").offset().top;f.prevElem.scrollTop(j)}zmUtil.invokeComposer(f),zmUtil.setInlineCmpScope(!0)}},setSlideShow:function(a,b,c){for(var d,e,f=a.length,g=[],h="",i=0;i<f;i++)d=a[i],h=d.e,e=zmUtil.getMailObj(h),d.gId=e&&e.streams?e.groupId:zmail.zuid,g.push(d);zmUtil.cacheImageForPreview(a)},getAddToMenu:function(b){var c=function(){var a=zmail.smartFilterStatus;return!!(zmail.isSmartFilterEnabled&&a&&a.Group|a.NewsLetter|a.Notification)},d=[],e={},g=zmUtil.getMailObj(b);e.align="pleft",e.clk=function(c,d){c.msgId=b,a.bindAction(c,d)},e.divId="zm_dropaddto";var h=zmUtil.isSharedFolder(g.FD);return g&&g.FD!==zmail.folId.sId&&g.FD!==zmail.folId.spId&&(d=[{htm:f.contextmenu.filters,data:{action:"addfilter",msgId:b}}]),!zmUtil.isZohoAccount(zmail.accId)||zmUtil.isChildWindow()||h||d.push({htm:f.contextmenu.tasks,data:{action:"addtotasks"}}),zmUtil.isZohoAccount(zmail.accId)&&zmUtil.isNoteReactUser()&&!zmUtil.isChildWindow()&&!h&&d.push({htm:f.contextmenu.notes,data:{action:"addtonotes"}}),!zmUtil.isZohoAccount(zmail.accId)||zmUtil.isChildWindow()||h||d.push({htm:f.contextmenu.events,data:{action:"addtoevents"}}),zmUtil.isZohoAccount(zmail.accId)&&!h&&zmAdHocSettings.getProjectInteg().enabled!==!1&&d.push({htm:f.contextmenu.projects,data:{action:"addtoprojects"}}),zmUtil.isZohoAccount(zmail.accId)&&c()&&g&&g.FD!==zmail.folId.sId&&g.FD!==zmail.folId.spId&&!h&&(d=d.concat({htm:"<i class='msi-larrow'></i>"+f.contentOptions.include,data:{action:"smartfiltermenu",msgId:b,menuDirection:"left"},child:function(){return zmPreviewTemplate.getSmartFilterMenu(b)}})),e.list=d,e},getSmartFilterMenu:function(b){var c=[],d={};d.align="pleft",d.clk=function(c,d){c.msgId=b,a.bindAction(c,d)},d.divId="zm_dropsmartfilter";var e,g,h,i=zmail.smartFilterStatus;g=[function(){return!!i.Notification&&(e={htm:f.smartfilter.notification,data:{action:"addsmartfilter",filtervalue:5,msgId:b}})},function(){return!!i.NewsLetter&&(e={htm:f.smartfilter.newsletter,data:{action:"addsmartfilter",filtervalue:6,msgId:b}})},function(){return!!i.Group&&(e={htm:f.smartfilter.group,data:{action:"addsmartfilter",filtervalue:7,msgId:b}})}];var j;for(h in g)j=g[h](),j&&c.push(j);return d.list=c,d},createNewFilter:function(a){var b,c=a.msgId,d="",e="",f="",g="",h=[],i={};if(c&&(b=zmContentCache.isCached(c)?zmContentCache.get(c):zmUtil.getMailObj(c))){e=b.SUBJECT||b.SB||"",g=b.FROM||b.F||"",f=b.TO||b.TOADDR||"",d=g.substring(0,g.indexOf("@")),f?b.CC&&"NOT PROVIDED"!==b.CC.toUpperCase()&&(f=f+","+b.CC):b.CC&&"NOT PROVIDED"!==b.CC.toUpperCase()&&(f=b.CC),f?(f=f.replace(/&lt;/gi,"<"),f=f.replace(/&gt;/gi,">"),f=f.replace(/&quot;/gi,'"'),h=f.split(",")):h="";var j=h.length,k=0,l=[],m="",n={};for(l.push({rhs:e,operator:"contains",lhs:"subject"}),l.push({rhs:g,operator:"contains",lhs:"sender"}),k=0;k<j;k++)m=h[k],m.indexOf("<")!==-1&&(m=m.substring(m.lastIndexOf("<")+1,m.lastIndexOf(">"))),m=m.trim(),h[k]=m,n={rhs:m,operator:"contains",lhs:"to/cc"},l.push(n);i.criterias=l,i.name=d,i.actionSrc=a.actionSrc,$.publish("FILTER_SUGGESTION",i)}},editFilter:function(){},loadPrevMail:function(){var a,c,f,g,h=zmTab.currentTab,i=zmPrev.prevDetails(),j=[],k=zmUtil.getMLConversionValue(),l=zmUtil.getSelectedMails(),m=l[0][0]||l[1][0];if(i.msgId||m){var n,o,p,q,r,s,t,u={};if(m=i.msgId,t=zmUtil.getMailObj(m),c=i.type,a=4===zmail.mailOpt.isPopup?4:0,"zm_Container"===h&&"zmStreamTree"!==zmail.mailLeft.selLayerId)zmList.listingFocused=!0,u=zmInit.getListingDetObj(),u.fId!==zmail.folId.sId&&u.fId!==zmail.folId.tId||(k=0),"lt"===c?(s=0!==k&&t&&t.TH?"t"+m:m,f=zmUtil.getFolId(),j=zmUtil.getListMap(f,"MO")||[],n=j.indexOf(m),o=zmCenterListing.mailObjectAPI.getViewObject(m),o&&(p=o.$element,p.length||(o=zmList.getElemObj(h),p=o.find("#"+s))),p.length?(q=p.prev(),q.is(":visible")||(q=q.prev()),q.hasClass(e.thdChild)?(r=q.find("."+e.mRow+":last"),g=r.attr("id"),c="th"):q.hasClass(d.cls.mRow)&&(g=q.attr("id"),c="lt")):g=j[n-1]):"th"===c&&(f=t?t.T:"",f&&zmUtil.getListMap(f)&&(j=zmList.getViewBasedMsgList(f,u)),n=j.indexOf(m),0===n?(o=zmCenterListing.mailObjectAPI.getViewParentOf("c"+m),o&&(p=o.$element,p.length||(o=zmList.getElemObj(h),p=o.find("#"+m).closest("."+e.thdChild).prev())),p.length&&(q=p.prev(),q.is(":visible")||(q=q.prev()),q.hasClass(e.thdChild)?(r=q.find("."+e.mRow+":last"),g=r.attr("id"),c="th",s=m):q.hasClass(d.cls.mRow)&&(g=q.attr("id"),s=g,c="lt"))):(s=m,g=j[n-1])),g&&zmPrev.updateListOnNavigation(m,b);else if("zm_srch1"===h)zmList.listingFocused=!0,b=zmSearchUtil.getSearchViewDetails(),j=zmSearchUtil.getSearchList()||[],n=j.indexOf(m),g=j[n-1],s=m;else if(!h.indexOf("zm_tab")){b=zmsuite.getCenterOuter().$el.data("data-detail"),i=zmsuite.getCenterOuter().$el.data("row-detail");var v=i.msgId;v.indexOf("t")||(v=v.substring(1)),c=i.type,f=zmUtil.getFolId(b),b.fId!==zmail.folId.sId&&b.fId!==zmail.folId.tId&&"search"!==b.view||(k=0),0!==k&&t&&t.TH?(s="t"+t.T,v=zmList.getDupThdRowId(m,f)):s=m,m.indexOf("t")||(m=m.substring(1)),"search"===f?j=zmSearchUtil.getSearchList():zmUtil.getListMap(f)&&(j=zmUtil.getListMap(f,"MO")||[]),n=j.indexOf(v);var w=zmUtil.getFolId();if(n===-1&&f===w){for(var x=zmsuite.getCenterOuter().$el.data("data-maillist"),y=x.indexOf(v),z=x[y-1];z&&j.indexOf(z)===-1;)y-=1,z=x[y-1];n=j.indexOf(z)+1}g=j[n-1],a=2,g&&zmPrev.updateListOnNavigation(v,b)}g?$.when(zmPrev.cmpClose()).then(function(d){d&&(zmList.getMailData({msgId:g,type:c,opentype:a,from:s}),"zm_Container"!==h&&"zm_srch1"!==h||!zmsuite.isWorkspaceAvailable(h)||("unread"!==b.view?zmUtil.initScroll(zmsuite.getCenter(h)[0].getNodes()[2].$el,g,s,"prev",!1,4===a):zmList.setScrollUnreadView(zmsuite.getCenter(h)[0].getNodes()[2].$el,g)),zmContentCache.remove(m))}):zmUtil.disableNavigation(h,"prev")}else{if(a=4===zmail.mailOpt.isPopup?4:0,c="lt","zm_Container"===h&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(f=zmUtil.getFolId(),g=zmUtil.getListMap(f,"MO")[0],!g)return}else{if("zm_srch1"!==h)return;if(g=zmSearchUtil.getSearchList()[0],!g)return}g&&zmList.getMailData({msgId:g,type:c,opentype:a})}},loadNextMail:function(){var a,b,c,f,g=zmTab.currentTab,h=zmPrev.prevDetails(),i=[],j=zmUtil.getMLConversionValue(),k=zmUtil.getSelectedMails(),l=k[0][0]||k[1][0];if(h.msgId||l){var m,n,o,p,q,r,s,t={};if(l||(l=h.msgId),s=zmUtil.getMailObj(l),b=h.type,a=4===zmail.mailOpt.isPopup?4:0,"zm_Container"===g&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(zmList.listingFocused=!0,t=zmInit.getListingDetObj(),t.fId!==zmail.folId.sId&&t.fId!==zmail.folId.tId||(j=0),"lt"===b)if(r=0!==j&&s&&s.TH?"t"+l:l,c=zmUtil.getFolId(),i=zmUtil.getListMap(c,"MO")||[],m=i.indexOf(l),m===-1&&s&&s.TH&&(l=h.msgId,r=r.indexOf("t")?l:"t"+l),m=i.indexOf(l),o=[],n=zmCenterListing.mailObjectAPI.getViewObject(l),n&&(o=n.$element||[],o.length||(n=zmList.getElemObj(g),o=n.find("#"+r))),o.length){if(p=o.next(),p.is(":visible")||(p=p.next()),p.hasClass(e.thdChild))q=p.find("."+d.cls.mRow).eq(1),f=q.attr("id"),b="th",r=l;else if(p.hasClass(d.cls.mRow)){var u=p.next();u.hasClass(e.thdChild)&&u.is(":visible")?(f=u.find("."+e.mRow+":first").attr("id"),b="th"):(f=p.attr("id"),b="lt")}}else f=i[m+1];else if("th"===b)if(c=s?s.T:"",c&&zmUtil.getListMap(c)&&(i=zmList.getViewBasedMsgList(c,t)),m=i.indexOf(l),r=l,m===i.length-1){var v;if(n=zmCenterListing.mailObjectAPI.getViewParentOf("c"+l),n&&(o=n.$element,o.length||(n=zmList.getElemObj(g),o=n.find("#"+l).closest("."+e.thdChild).prev()),v=o.next().next()),v.length){f=v.attr("id");var w=zmUtil.getMailObj(f);w&&w.TH?(p=v.next(),p.hasClass(e.thdChild)&&p.is(":visible")||(p=p.prev()),p.hasClass(e.thdChild)?(q=p.find("."+e.mRow+":first"),f=q.attr("id"),b="th"):p.hasClass(d.cls.mRow)&&(f=p.attr("id"),b="lt")):b="lt"}}else f=i[m+1];f&&zmPrev.updateListOnNavigation(l,t)}else if("zm_srch1"===g)zmList.listingFocused=!0,t=zmSearchUtil.getSearchViewDetails(),i=zmSearchUtil.getSearchList()||[],m=i.indexOf(l),f=i[m+1],r=l;else if(!g.indexOf("zm_tab")){t=zmsuite.getCenterOuter().$el.data("data-detail"),h=zmsuite.getCenterOuter().$el.data("row-detail");var x=h.msgId;x.indexOf("t")||(x=x.substring(1)),b=h.type,c=zmUtil.getFolId(t),t.fId!==zmail.folId.sId&&t.fId!==zmail.folId.tId&&"search"!==t.view||(j=0),0!==j&&s&&s.TH?(r="t"+s.T,x=zmList.getDupThdRowId(l,c)):r=l,l.indexOf("t")||(l=l.substring(1)),"search"===c?i=zmSearchUtil.getSearchList():zmUtil.getListMap(c)&&(i=zmUtil.getListMap(c,"MO")||[]),m=i.indexOf(x);var y=zmUtil.getFolId();if(m===-1&&c===y){for(var z=zmsuite.getCenterOuter().$el.data("data-maillist"),A=z.indexOf(x),B=z[A+1];B&&i.indexOf(B)===-1;)A+=1,B=z[A+1];m=i.indexOf(B)-1}f=i[m+1],a=2,f&&zmPrev.updateListOnNavigation(x,t)}f?($.when(zmPrev.cmpClose()).then(function(c){c&&(zmList.getMailData({msgId:f,type:b,opentype:a,from:r}),"zm_Container"!==g&&"zm_srch1"!==g||!zmsuite.isWorkspaceAvailable(g)||("unread"!==t.view?zmUtil.initScroll(zmsuite.getCenter(g)[0].getNodes()[2].$el,f,r,"next",!1,4===a):zmList.setScrollUnreadView(zmsuite.getCenter(g)[0].getNodes()[2].$el,f)))}),zmContentCache.remove(l)):zmUtil.disableNavigation(g,"next")}else{if(a=4===zmail.mailOpt.isPopup?4:0,b="lt","zm_Container"===g&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(c=zmUtil.getFolId(),f=zmUtil.getListMap(c,"MO")[0],!f)return}else{if("zm_srch1"!==g)return;if(f=zmSearchUtil.getSearchList()[0],!f)return}f&&zmList.getMailData({msgId:f,type:b,opentype:a})}},showUnsubscribe:function(a,b){if(zmContentCache.isCached(a)){var c=zmContentCache.get(a);c.USOBJ&&!$.isEmptyObject(c.USOBJ)&&($(b).find("[data-mid='"+a+"'] .zm_unsub").show(),c.USOBJ.USA===!0&&$(b).find("[data-mid='"+a+"'] .zm_unsub").text(f.newsletter.unsubscribed).removeClass("SC_lnk"))}},processUnsubscription:function(a,b){var c=function(c,d){"success"===c.status?(b&&$(b).length&&($(b).find("[data-mid='"+a+"'] .zm_unsub").text(f.newsletter.unsubscribed).removeClass("SC_lnk"),zmUtil.isChildWindow()||zmPreviewTemplate.updateUnsubscribeStatus(a)),zmContentCache.isCached(d.msgId)&&(zmContentCache.get(d.msgId).USOBJ.USA=!0),_zm.succErrMsg("s",f.newsletter.unsub_success),$.publish("spam/unsubscribed")):_zm.succErrMsg("e",f.newsletter.unsub_failure)},d=function(b,d,e){e=e||c,zmContentCache.get(a).USOBJ.USA||zmAjq.XHR({u:zmail.conPath+"/unsubscribe.do",t:"POST",fn:e,p:b,ep:d,csr:"s"})},e=function(){var b,c,e=zmContentCache.get(a).USOBJ;b={accId:zmail.accId,mode:"add",msgId:a},c={msgId:a},e.USL?b.link=e.USL:e.USM&&(b.send=!0,b.mailto=e.USM,b.from=zmail.aInfo[zmail.accId].mailId,e.USS&&(b.subject=e.USS),e.USC&&(b.content=e.USC)),zmsDialog.confirm(f.newsletter.confirm_link,{onOk:function(){zmsDialog.remove(),d(b,c)}})},g=function(){if(!$("#unsubscribepopup").length){var b=["DIV",{attrs:{id:"unsubscribepopup",style:""},child:[["H4",{child:[["text",f.newsletter.confirm_mail],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-option",value:"true"}}],["SPAN",{child:[["text",f.newsletter.confirm_mail_unsubscribe]]}]]}],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-unoption",value:"false"}}],["SPAN",{child:[["text",f.newsletter.confirm_mail_markspam]]}]]}]]}]]}],c=_zm.getDOM(b);$("body").append(c);var e=$("div.mail_opt",c),g=$("i",e);e.on("click",function(){g.removeClass().addClass("msi-unoption"),$(this).closest("div").find("i").removeClass().addClass("msi-option")});var h=function(){var b,c,f,g=zmContentCache.get(a).USOBJ;b={accId:zmail.accId,mode:"add",msgId:a},c={msgId:a},g.USM&&(f=$("i.msi-option",e).attr("value"),b.mailto=g.USM,b.from=zmail.aInfo[zmail.accId].mailId,g.USS&&(b.subject=g.USS),g.USC&&(b.content=g.USC),"true"===f&&(b.send=!0),zmsDialog.remove(),d(b,c))},i={title:f.newsletter.unsubscribe,style:{width:"500px"},buttons:[{txt:f.common.ok,selected:!0,callback:h},{isCancel:!0,txt:f.common.cancel,callback:function(){zmsDialog.remove(),$("#unsubscribepopup").remove()}}],drag:!0,mask:!0,hideclose:!1,pos:"center"};zmsDialog.create("unsubscribepopup",i)}},h=function(a){"success"===a.status&&(a.valid?e():g())};if(zmContentCache.isCached(a)){var i,j=zmContentCache.get(a),k={},l={},m={};if(i=j.USOBJ,!i||i.USA===!0)return;i.USL?(m.link=i.USL,l={msgId:a,selector:b},h({status:"success",valid:!0},l)):i.USM&&(k={accId:zmail.accId,mode:"check",msgId:a},l={msgId:a,selector:b},d(k,l,h))}},updateUnsubscribeStatus:function(a){if(a){var b,c,d,e=zmTab.tabArr;for(b=0;b<e.length;b++)d=e[b].appId,zmsuite.isWorkspaceAvailable(d)&&zmsuite.getCenter(d)[1]&&(c=zmsuite.getCenter(d)[1].getNodes()[1].$el,c.find("[data-mid='"+a+"'] .zm_unsub").text(f.newsletter.unsubscribed))}},updateRSVPSchema:function(a,b){var c=zmUtil.getMailObj(a);if(c&&(!c||c.SCOBJ)){var d=c.SCOBJ[0];if(c&&d&&"RSVPACTION"===d.SCATYPE&&("RSVPACTION"!==d.SCATYPE||!d.ASTATUS||d.RSVPSTUS!==b)){var e=["yes","no","disable:0","disable:1"];if(d.SHOWMB&&e.push("maybe","disable:2"),e.indexOf(b)!==-1){var g={msgId:a,accountId:zmail.accId,actName:d.SCATYPE,updCal:!1},h=$.extend({},g);switch(b){case"yes":case"disable:1":g.rsvpStatus=f.calendar.yes.toLowerCase(),h.rsvpStatus=f.calendar.yes;break;case"no":case"disable:2":g.rsvpStatus=f.calendar.no.toLowerCase(),h.rsvpStatus=f.calendar.no;break;case"maybe":case"disable:3":g.rsvpStatus=f.calendar.maybe.toLowerCase(),h.rsvpStatus=f.calendar.maybe}if(g.rsvpStatus!==d.RSVPSTUS){var i=function(b,c){if("SUCCESS"===b.ASTATUS){d.ASTATUS=!0,d.RSVPSTUS=c.rsvpStatus.toLowerCase();var e={msgId:a,actName:"RSVPACTION",suppress:!0,rsvpStatus:c.rsvpStatus};zmUtil.isChildWindow()&&window.opener?window.opener.$.publish("/mail/updateSchema",e):$.publish("/mail/updateSchema",e)}},j=function(a){zmUtil.debugLog("Error while updating RSVP schema"+a.msg)},k={u:zmail.conPath+"/executeActSchema.do",t:"POST",fn:i,onerror:j,p:g,ep:h};zmAjq.XHR(k)}}}}},addShowMoreMailsLink:function(a,b){if(a.contElem.length){var c='<div class="SC_simg"><font class="zm_shwconv">'+f.contentOptions.showmore+"</font></div>";$(c).insertAfter(a.contElem.find("div.SC_pct:last")),a.contElem.find(".zm_shwconv").off("click").on("click",function(){$(this).parent().remove(),zmPreviewTemplate.fetchMoreMails(a.contElem.parent(),b)})}},fetchMoreMails:function(a,b){var d,e=$(a).find("div.SC_pct:first").parent(),f=e.data("msg_params"),g={accId:zmail.accId,summary:!0},h=f.msgId;h.indexOf("t")!==-1&&(h=h.substring(1));var i=zmUtil.getMailObj(h);if(d=i?i.T:""){var j=!1;zmUtil.isChildWindow()&&(j=!0),g.thId=d,f.shId&&zmUtil.getFolderIdwithShId(f.shId)&&(g.shId=f.shId),f.streamsShowMail&&(g.accId=i.accId||zmail.accId,g.streamsView=!0),f.entityType&&(g.entityType=f.entityType),f.actionType&&(g.actionType=f.actionType),f.groupId&&(g.groupId=f.groupId),f.entityId&&(g.entityId=d);var k=function(a,b){var d,g=b.thId,h=zmUtil.getListMap(g),i=h.MO;if(a.tdata=a.tdata||[],d=j?zmWindow.addinList(g,a.tdata):zmCache.dolistObj(g,a.tdata),b.streamsView){var k,l,m,n=d.MO,o=n.length;for(k=0;k<o;k++)l=n[k],m=l&&zmUtil.getMailObj(l),m&&(m.accId=b.accId,m.actionType=b.actionType,m.entityType=b.entityType,m.groupId=b.groupId,m.S=1,m.streams=!0)}h.showNextPage=0;var p=0,q=d.MO.length;for(p=0;p<q;p++)i.indexOf(d.MO[p])===-1&&i.push(d.MO[p]);void 0!==d.showNextPage&&(h.showNextPage=d.showNextPage),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(g);var r=zmPreviewTemplate.getMissingMailList(g,c);zmPreviewTemplate.addMailsInView({list:r,contElem:e,elemPrefix:c,viewDetails:f.elemObj.viewDetails,opentype:f.opentype,mode:"showmore"}),1===h.showNextPage&&zmPreviewTemplate.addShowMoreMailsLink({contElem:e})},l=N(d);l&&(g.thdindex=l);var m=$.extend({},g);m.from="tIcon",m.opentype=b,m.contElem=e,j?(m.fetchMoreMails=!0,zmWindow.sendMailDataReq(g,m,k)):zmList.sendMailDataReq(g,m,k)}},getMissingMailList:function(a,b){var c,d,e=[],f=zmUtil.getListMap(a,"MO").slice(),g=f.length;c="zmHdr"+b,1===zmail.convSortOrder&&f.reverse();var h;for(d=0;d<g;d++)h=zmUtil.getMailObj(f[d]),zmUtil.isInlineCompose()&&h&&(h.FD===zmail.folId.dId||h.FD===zmail.folId.tId)||$("#"+c+f[d]).length||e.push(f[d]);return e},_rPath:function P(a,b){var c,d={},e="",g="",h="",i="",j="",k="",l=a.delegate,m=[],n=[],o="",p="",P="";if(a.frm&&(o=a.frm),l&&a.rPath){var q=a.rPath;for(q=q.replace(/</gi,""),q=q.replace(/>/gi,""),n=q.split(","),n=_.uniq(n),c=0;c<=n.length;c++)g=n[c],g&&(h=g.indexOf("@"),h!==-1&&(p+="<b>"+g.substr(h+1)+"</b>"),g.indexOf("zmgrbounces")===-1&&g.toLowerCase()!==o.toLowerCase()||(n.splice(c,1),c--))}if(n.length){for(c=0;c<=n.length;c++)g=n[c],g&&(h=g.indexOf("@"),h!==-1&&m.push(g.substr(h+1)));var r=o;if(r){r=r.replace(/</gi,""),r=r.replace(/>/gi,"");var s=r.indexOf("@");s!==-1&&(r=r.substr(s+1))}p=m.join(","),P=n.join(","),P=P.replace(/</gi,""),P=P.replace(/>/gi,""),j="redtxt",i="Sent by",k="via",1===m.length&&r===m[0]&&(j="ylwtxt"),l&&(j="bluetxt",i="Sent by",k="delegate")}if(a.via&&(n.push(a.via),P=a.via,p=a.viaDomain,j="redtxt",i="Sent by",k="via"),"less"===b){var t=$("<div/>");t.attr("data-zmvia","less"),t.attr("title",o),t.attr("class","SC_cs"),t.attr("data-eid",o);var u=$("<span/>");if(u.text(zmUtil.replaceHTMLEntities(o)),t.append(u),n.length){var v=$("<span/>");v.attr("class",j),v.text(f.contentOptions.via),t.append(v);var w=$("<span/>");w.text(p),t.append(w)}if(e=t[0].outerHTML,"delegate"===k){var x=$("<div/>");x.attr("class","SC_cs"),x.attr("data-eid",o);var y=$("<span/>");if(y.text(o),x.append(y),n.length){var z=$("<span/>");z.attr("class",j),z.text(f.contentOptions.delegateVia),x.append(z);var A=$("<span/>");A.text(p),x.append(A)}e=x[0].outerHTML}}else"via"===b?e='<span class="'+j+'">via</span><span>'+p+"</span>":n.length&&(e='<div id="zmRPATH'+a.elemId+'" class="zmpdtl zmvia">',e+='<div><div class="zmpr">',e+="delegate"===k?'<span><em class="'+j+'" title="'+i+'">'+i+"</em><span>"+P+"</span></span>":'<span><em class="'+j+'" title="'+i+'">'+i+"</em><span>"+P+"</span></span>",e+="</div></div></div>");return d._viaType=k,d._str=e,d},classifySmartFilter:function(a,b,c,d){if(a&&b&&void 0!==c){var e;e=zmUtil.isChildWindow()?opener.zmail.Settings:zmail.Settings,e.Apps.Filter.categoriseMail({msgId:a,filType:b,include:c}).then(function(){c?(zmUtil.updateMailData("SFT",b,a),_zm.succErrMsg("s",f.smartfilter.include)):(zmUtil.updateMailData("SFT",0,a),d.find(".zm_exclude").remove(),_zm.succErrMsg("s",f.smartfilter.exclude))})}},showEvents:function(a){var b=a.msgId,c=a.mailContElem||$("#zmCon"+zmPreviewTemplate.getPrefixOnCurrentab()+b),d=b&&zmUtil.getMailObj(b);if(d&&d.MSGREL&&d.MSGREL.indexOf("1")>-1){var e;if(c.length){e=c.find(".zm_mail_events"),e.length?e.find(".multiAppInfo").empty():(e=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_events multiAppData"},child:[["DIV",{attrs:{"class":"multiAppInfo"}}]]}])),e.insertAfter(c.find(".zmPCon")));var g=e.find(".multiAppInfo"),h=$(_zm.getDOM(["DIV",{attrs:{"class":"multiAppHead"},child:[["SPAN",{child:[["text",f.contextmenu.events]]}]]}]));g.append(h),zmUtil.loadEvents(function(){zmail.eventInteg.util.listEvents(b,g)})}}},showNotes:function(a){
var b,c=a.msgId,d=a.mailContElem;if(c){var e=zmUtil.getMailObj(c);e&&e.MA?b=e.MA:zmContentCache.isCached(c)&&(b=zmContentCache.get(c).MA)}if(b&&zmUtil.isZohoAccount(zmail.accId)&&zmUtil.isNoteReactUser()){var f={};if((64|b)!==b)return;var g;d.length&&(g=d.find(".zm_mail_note"),g.length||(g=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_note"}}])),g.insertAfter(d.find(".zmPCon")),a.vfc||a.streamsShowMail||(f={mailId:c,mountingElem:g,preCallback:function(){},postCallback:function(){},listParam:{showHeader:!0}},zmail.Listing.Handlers.Integrations.notesAssociates(c,f))))}},showTasks:function(a){var b,c=a.msgId,d=a.mailContElem;if(c){var e=zmUtil.getMailObj(c);e&&e.MA?b=e.MA:zmContentCache.isCached(c)&&(b=zmContentCache.get(c).MA)}if(b&&zmUtil.isZohoAccount(zmail.accId)){var f={};if((32|b)!==b)return;var g;d.length&&(g=d.find(".zm_mail_task"),g.length||(g=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_task"}}])),g.insertAfter(d.find(".zmPCon")))),a.vfc||a.streamsShowMail||(f={mailId:c,mountingElem:g,preCallBk:function(){},postCallBk:function(){zmUtil.requireTaskModule("taskMail").done(function(){var a=zmTask.Integrations.Mail;a.unsubscribeTaskListeners(),a.subscribeDeleteListener(c,g)})},listParam:{showHeader:!0}},zmail.Listing.Handlers.Integrations.taskAssociates(c,f))}},showProjectsEntities:function(a){var b,c=a.msgId,d=a.mailContElem||$("#zmCon"+zmPreviewTemplate.getPrefixOnCurrentab()+c);if(c){var e=zmUtil.getMailObj(c);e&&e.MA?b=e.MA:zmContentCache.isCached(c)&&(b=zmContentCache.get(c).MA)}if(b){if((4|b)!==b)return;var g;if(d.length){g=d.find(".zm_mail_projects"),g.length?g.find(".multiAppInfo").empty():(g=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_projects multiAppData"},child:[["DIV",{attrs:{"class":"multiAppInfo"}}]]}])),g.insertAfter(d.find(".zmPCon")));var h=g.find(".multiAppInfo"),i=$(_zm.getDOM(["DIV",{attrs:{"class":"multiAppHead"},child:[["SPAN",{child:[["text",zmText.applyArgs(f.common.zohoProj,{companyName:zmail.globalI18N.companyName})]]}]]}]));h.append(i),zmUtil.loadProjects(function(){zmail.projectsInteg.util.listProjectsEntities(c,h)})}}},unsubscribeNotesTasks:function(a){if($(a).length){var b=$(a).find(".zm_mail_note");b.each(function(a,b){ReactDOM.unmountComponentAtNode(b)})}},updateNoteComponent:function(a){if(a&&zmUtil.getMailObj(a)){var b=["zmConP","zmConT","zmConW","zmConS"];for(var c in b){var d;d=$("[id="+b[c]+a+"]");for(var e=0;e<d.length;e++){var f=d.eq(e);zmPreviewTemplate.showNotes({msgId:a,mailContElem:f})}}}},updateTaskComponent:function(a){if(a&&zmUtil.getMailObj(a)){var b=["zmConP","zmConT","zmConW","zmConS"];for(var c in b){var d;d=$("[id="+b[c]+a+"]");for(var e=0;e<d.length;e++){var f=d.eq(e);zmPreviewTemplate.showTasks({msgId:a,mailContElem:f})}}}},postSaveDraftAction:function(a,b,c){$.isEmptyObject(c)||$.publish("/mail/draftsaved",c);var d=zmUtil.getMailObj(b.M);d&&(b.TC=d.TC,b.PA=d.PA),zmUtil.addMailData(b,b.M),d=zmUtil.getMailObj(b.M),d.PA||(d.PA=a),$.publish("/maction/newm",[[b]])},slideZImages:function(a){if(a.length&&a[0].src){var b,c,d,e=[],f=0;c=a.closest(".zmPCnt"),b=c.find("img"),b.each(function(b,c){c.src&&(e.push({ft:101,fn:"image.png",src:c.src}),c.src===a[0].src&&(f=e.length-1))}),d={startIndex:f,attObjList:e,hideAllOptions:!0,ignoreThumb:!0},zmUtil.initAttSlideShow(d)}},isTruncatedMail:function(a){return zmContentCache.isCached(a)&&zmContentCache.get(a).SHRINKED},getPrefixOnCurrentab:function(){var a;if(zmUtil.isChildWindow())return a="W";var b=zmTab.currentTab;return"zm_Container"===b||"zmncenter"===b||"zmStreamsApp"===b?a="P":"zm_srch1"===b?a="S":b.indexOf("zm_tab")||(a="T"),a},FCLoader:function(a,b){var c=$.Deferred(),d={msgId:a.mId,type:"lt",opentype:zmPreviewTemplate.currentWorkSpace,vfc:!0,tabId:void 0};$.when(c).then(function(a){b(a)}),zmUtil.isChildWindow()?zmWindow.getMail(d,c):zmList.getMailData(d,void 0,c),a.toHideVfcMsg&&$("#zmCon"+zmPreviewTemplate.getPrefixOnCurrentab()+a.mId+" #clippedMsg").hide()},shortCutHandler:function(a,b){if("openReader"===a){if(!zmPrev.prevDetails().msgId)return;D(b.mId)}else"printMail"===a&&zmPreviewTemplate.printMsg({mId:b.mId})},isMailOpenedViaStreams:G,addFocusOnclick:l,constructContent:x,loadImages:H};return K(),M(),O}();
"use strict";!function(a){var b,c=function(){var a={};return $.extend(a,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),a}();!function(){var a=Boolean(window.chrome)&&Boolean(window.chrome.webstore),d=Boolean(window.opr)&&Boolean(window.opr.addons)||Boolean(window.opera)||navigator.userAgent.indexOf(" OPR/")>=0,e=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;b=a||d||e?zmText.applyArgs(c.desktopMsg,{command:"ctrl+v"}):c.desktopMsgWithoutPaste}(),a.templates=a.templates||{};var d="write",e="SC_rwToggle attToggTemp",f={display:"none",height:"100%",width:"100%",left:"0px",top:"0px",position:"absolute"},g={backgroundColor:"#ce232c"};return $.extend(a.templates,{docsOption:function(){return zdom("div",{className:"SC_frt"},c.label.insertAs,zdom("div",{"data-readval":d,"data-read":c.button.asAttach,"data-write":c.button.asLink,className:e}))},dragdropArea:function(){return zdom("div",{className:"SC_drop SC_dropW100"},zdom("div",{className:"SC_drag wht",style:{height:"100%",top:"0"}},zdom("span",null,b)))},dropMsgTemplate:function(){return zdom("div",{style:f},zdom("div",{className:"SC_drag",style:{height:"70%"}},zdom("span",null,c.dropMsg)))},browseInputEle:function(a,b){var c={visibility:"hidden",width:"1px",height:"1px"};return zdom("input",{type:"file",id:a,name:b,style:c})},colorPallete:function(){var a={display:"none"},b={paddingLeft:"10px",marginTop:"-5px !important"},c={padding:"0"};return zdom("div",{id:"zmAnnonate_Color",className:"SC_dd shw",style:a},zdom("div",null,zdom("ul",{className:"SC_cp",style:b},zdom("li",{style:c},zdom("div",{style:{backgroundColor:"#e5e5e5"}}),zdom("div",{style:{backgroundColor:"#f9baab"}}),zdom("div",{style:{backgroundColor:"#f9d3a2"}}),zdom("div",{style:{backgroundColor:"#fef86a"}}),zdom("div",{style:{backgroundColor:"#d7f3b0"}}),zdom("div",{style:{backgroundColor:"#c8e5fb"}}),zdom("div",{style:{backgroundColor:"#e0ceef"}}),zdom("div",{style:{backgroundColor:"#f6d0e6"}}),zdom("div",{style:{backgroundColor:"#c4c4c4"}}),zdom("div",{style:{backgroundColor:"#e07861"}}),zdom("div",{style:{backgroundColor:"#ecb772"}}),zdom("div",{style:{backgroundColor:"#f6e565"}}),zdom("div",{style:{backgroundColor:"#badf88"}}),zdom("div",{style:{backgroundColor:"#96ccf5"}}),zdom("div",{style:{backgroundColor:"#b99fce"}}),zdom("div",{style:{backgroundColor:"#e099c2"}}),zdom("div",{style:{backgroundColor:"#808080"}}),zdom("div",{id:"zmAnnotate_selColor",className:"sel",style:g}),zdom("div",{style:{backgroundColor:"#dd902f"}}),zdom("div",{style:{backgroundColor:"#d0c04b"}}),zdom("div",{style:{backgroundColor:"#90ca40"}}),zdom("div",{style:{backgroundColor:"#70abec"}}),zdom("div",{style:{backgroundColor:"#a97ac6"}}),zdom("div",{style:{backgroundColor:"#c26a9d"}}),zdom("div",{style:{backgroundColor:"#000000"}}),zdom("div",{style:{backgroundColor:"#9d1812"}}),zdom("div",{style:{backgroundColor:"#a56016"}}),zdom("div",{style:{backgroundColor:"#a69646"}}),zdom("div",{style:{backgroundColor:"#5b8828"}}),zdom("div",{style:{backgroundColor:"#4c76a2"}}),zdom("div",{style:{backgroundColor:"#8343a0"}}),zdom("div",{style:{backgroundColor:"#ba3682"}})))))},dragtheme:zdom("div",{style:{height:"3px"},className:"dragtheme"}),desktopListTemplate:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return zdom("div",{className:"zmL zmAch SC_mlst"},zdom("div",{className:"zmLst"},zdom("div",{draggable:"true",className:"zmFlt"},zdom("i",{className:"msi-drag"})),zdom("div",{className:"zmDtl"},zdom("div",{className:"zmDate"},zdom("span",null)),zdom("div",{className:"zmImg"},a.image),zdom("div",{className:"zmFdr"},zdom("span",null)),zdom("div",{className:"zmFrm"},zdom("span",{contentEditable:"true",id:"listView"},zmUtil.getSubString(60,a.name))),zdom("div",{className:"zmSze"},zdom("span",{className:"sum Sc_lnk"},a.size)),zdom("div",{className:"zmSub"},zdom("span",{id:"zmSubView",className:"sum SC_ldot SC_thm"},c.attachTemplateText.view),zdom("span",{id:"zmSubAnnotate",className:"sum SC_ldot SC_thm"},c.attachTemplateText.annotate),zdom("span",{id:"zmSubDownload",className:"sum SC_ldot SC_thm"},c.attachTemplateText.download),zdom("span",{id:"zmSubRemove",className:"sum SC_ldot SC_thm"},c.attachTemplateText.remove),zdom("span",{id:"zmWrnMsg",className:"sum"})),zdom("div",{className:"SC_icn"}),zdom("div",{className:"zm_lbl"})),zdom("div",{className:"zmFrt"})))},annonateBox:function(){var a=c.annotatebox.title,b="zmCanvas",d={position:"absolute",top:"0px",left:"0px"},e="zmtempCanvas";return zdom("div",{id:"zmAnnonateBox",className:"SC_Pop blk SC_cent tempAttPop"},zdom("div",{className:"SC_pe"},zdom("div",{id:"sand",className:"SC_oh"},zdom("div",{id:"zmCanvasCont",style:{overflow:"auto",position:"relative"}},zdom("canvas",{id:b}),zdom("canvas",{id:e,style:d})),zdom("div",{className:"SC_PUbtm",id:"gpcrt",style:{display:"none"}},zdom("span",{id:"zmImgEditDone",className:"sel"},c.button.done),zdom("span",{id:"zmImgEditCancel",className:"sel","data-val":"Cancel"},c.button.cancel))),zdom("div",{id:"lightnav"},zdom("div",{className:"At_nme"}))),zdom("div",{className:"SC_tool",style:{left:"-40px"}},zdom("ul",null,zdom("li",{className:"sc_tb_hd"}),zdom("li",{id:"zmAttUndo",title:a.undo},zdom("i",{className:"msi-undo"})),zdom("li",{id:"zmAttRedo",title:a.redo},zdom("i",{className:"msi-redo"}))),zdom("ul",null,zdom("li",{id:"zmAttSquare",title:a.square},zdom("i",{className:"msi-box"})),zdom("li",{id:"zmAttHide",title:a.mask},zdom("i",{className:"msi-mask"}))),zdom("ul",null,zdom("li",{id:"zmAttCircle",title:a.circle},zdom("i",{className:"msi-ellipse"})),zdom("li",{id:"zmAttLine",title:a.line},zdom("i",{className:"msi-line"})),zdom("li",{id:"zmAttPen",title:a.pen},zdom("i",{className:"msi-pen"}))),zdom("ul",null,zdom("li",{id:"zmRotateACW",title:a.rotateacw},zdom("i",{className:"msi-rotateACW"})),zdom("li",{id:"zmRotateCW",title:a.rotatecw},zdom("i",{className:"msi-rotateCW"}))),zdom("ul",null,zdom("li",{id:"zmAttCrop",title:a.crop},zdom("i",{className:"msi-crop"})),zdom("li",{id:"zmAttText",title:a.text},zdom("i",{className:"msi-text"})),zdom("li",{id:"zmAttColor",title:a.color},zdom("i",{className:"msi-colorPalette"})),zdom("li",{className:"sc_tb_hd"}))))},cloudAttTempLoadingBox:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.image||zdom("i",{className:"msi-attothers zm-attIcn"});return a.name=a.name||"",zdom("div",{className:"zmL SC_Pbar",id:"attloading",title:a.name},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmSze"},zdom("span",{className:"sum"},"Â ")),zdom("div",{className:"zmSub"},zdom("span",{"data-name":"rename"},c.UserMsg.rename),zdom("span",{"data-name":"download"},c.UserMsg.download),zdom("i",{className:"msi-action",title:c.UserMsg.more,"data-name":"showMore"})),zdom("div",{className:"zmFrm"},zdom("span",{"data-name":"filename"},zmUtil.getSubString(20,a.name))),zdom("div",{className:"zmImg"},b),zdom("div",{className:"SC_icn"},zdom("i",{className:"msi-close"})),zdom("div",{className:"zm_lbl zmProgBar"},zdom("div",{id:"progressbar",style:{width:"0%"}})))))},insertImageMaskBtn:function(){return zdom("div",{id:"blkMaskWthBtn",className:"blkMask",style:{opacity:"0",display:"none"}},zdom("div",{className:"blkMaskBtn",style:{left:"38%"}},c.attachTemplateText.annotate),zdom("div",{className:"blkMaskBtn",style:{left:"48%"}},c.attachTemplateText.remove))},blackMask:function(){return zdom("div",{id:"uploadMask",style:{display:"none"},className:"blkMask"},zdom("div",{className:"upldProgBar"},zdom("div",{id:"progressIndicator"})))},selectedFile:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.name=a.name||"",zdom("span",{className:"SC_fileSel",title:a.name,"data-attid":a.attId},zdom("span",{"data-name":"filename"},zmUtil.getSubString(10,a.name)),zdom("i",{className:"msi-close"}))},hugeAttachmentTemplate:function(a){var b=a.fn,d=zmUtil.getSubString(20,b),e=a.cls+" zm-attIcn",f="filename",g="attachTitle";return zdom("div",{className:"zmL SC_Pbar noHvr zmAch attachment"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmSze zmOpt showOpt SC_dyn"},zdom("div",{className:"SCmb"},zdom("ul",null,zdom("li",{className:"SCtxt"},zdom("b",null,zdom("span",{className:"sum fileSize"}))),zdom("li",{className:"SCtxt SC_ldot optParent"},zdom("b",{className:"zmcDrpDwnOpn selOpt","data-val":"private"},zdom("div",{className:"SC_hd"}),zdom("span",{className:"sum SC_thm changeOpt"},c.hugeAttach.hugeOpts.recOpt)))))),zdom("div",{className:"zmFrm"},zdom("span",{"data-name":f,className:g,"data-tooltip":b},d)),zdom("div",{className:"zmImg"},zdom("i",{className:e})),zdom("div",{className:"SC_icn closeIcon"},zdom("i",{className:"msi-close"})),zdom("div",{className:"zm_lbl zmProgBar"},zdom("div",{id:"progressbar"})))))},mailHugeTemplate:function(a){return zdom("div",{className:"SC_tp10"},zdom("div",{id:"optHeader"},zdom("b",null,zdom("span",{className:"hugeHeader"},a))))},mailListTemplate:function(a){var b=zmUtil.getSubString(20,a.fn),d=zmUtil.isChildWindow()?"":zdom("i",{"data-tooltip":c.UserMsg.more,className:"msi-action moreAction"});return zdom("div",{className:"zmL zmAch"},zdom("div",{className:"zmLst"},zdom("div",{className:"zmDtl"},zdom("div",{className:"zmImg"},zdom("i",{className:a.cls+" zm-attIcn"})),zdom("div",{className:"zmFrm"},zdom("span",{"data-tooltip":a.fn,className:"attachTitle"},b)),zdom("div",{className:"zmSze"},zdom("span",{className:"sum fileSize"},a.size)),zdom("div",{className:"zmSub"},zdom("span",{className:"download"},c.attachTemplateText.download),zdom("span",{className:"copyLink"},c.attachTemplateText.copylink),d))))},constructPermission:function(a,b){var d=c.hugeAttach.permissionDialog,e=[],f=[],g=[],h=[],i=zmAttachUtility.constants;return g.push(zdom("div",{className:"zmRadioEle permElem publicElm","data-val":i.share_public},zdom("input",{type:"radio"}),zdom("label",null,zdom("i",{className:"msi-tick"}),d.publicHeader),zdom("div",null,zdom("p",{className:"sum"},d.publicDesc)))),f.push(zdom("div",{className:"zmRadioEle permElem pvtElm"},zdom("input",{type:"radio",checked:""}),zdom("label",null,zdom("i",{className:"msi-tick"}),d.pvtHeader),zdom("div",null,zdom("p",{className:"sum"},d.pvtDesc)))),a&&h.push(zdom("div",{className:"zmRadioEle permElem orgElm","data-val":i.share_org},zdom("input",{type:"radio"}),zdom("label",null,zdom("i",{className:"msi-tick"}),d.orgHeader),zdom("div",null,zdom("p",{className:"sum"},d.orgDesc)))),e.push(zdom("div",{className:"zmRadioBlock zmBdrRadio permissionDialog"},f,h,g)),e},showCopyLink:function(a){var b=[];return b.push(zdom("div",null,zdom("br",null),zdom("div",null,zdom("input",{type:"text",value:a,className:"SC_tiput",readOnly:"readonly"})))),b}},!0),a}(window.zmAttachment=window.zmAttachment||{}),function(a){a.utility=a.utility||{};var b=function(){var a={};return $.extend(a,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),a}();return a.utility.setDragDrop=function(){function a(a){this.$centerEle=a.$centerEle,this.$dropMsgEle=a.$dropMsgEle,this.onDrop=a.onDrop,this.onDragover=a.onDragover,this.onDragLeave=a.onDragLeave,this.isDragOver=!1,this.eventIdentifier="",a.eventIdentifier&&(this.eventIdentifier="."+a.eventIdentifier),a.preventDefaultErrorHandler&&(this.preventDefaultErrorHandler=!0)}function c(a){var c,d,e;if(Array.isArray(a)){e=a.length,1===e?(c=a[0],d=zdom("div",{className:"SC_PUmsg"},zmText.applyArgs(b.desktop.folderDropErr1,{folderName:c}))):d=2===e?zdom("div",{className:"SC_PUmsg"},zmText.applyArgs(b.desktop.folderDropErr2,{folderName1:a[0],folderName2:a[1]})):zdom("div",{className:"SC_PUmsg"},zmText.applyArgs(b.desktop.folderDropErrN,{folderName1:a[0],number:e-1}));var f={title:b.desktop.folderDropDialogTitle,$content:d,buttons:[{name:b.button.ok,callback:function(a){a.remove()}}]};Dialog["new"](f)}}return a.prototype.init=function(){this.bindDropListener(),this.bindDragOver(),this.bindDragLeave()},a.prototype.getFiles=function(a){var b,c,d,e=[],f=[];if(a)if(b=a.items)if(c=b.length,c&&"function"==typeof b[0].webkitGetAsEntry)for(d=0;d<c;d++)b[d].webkitGetAsEntry().isFile?e.push(b[d].getAsFile()):f.push(b[d].getAsFile().name);else a.files&&(e=a.files);else a.files&&(e=a.files);return{files:e,directories:f}},a.prototype.bindDropListener=function(){var a=this;this.$centerEle.on("drop"+this.eventIdentifier,function(b){var d,e,f;return b.preventDefault(),a.isDragOver=!1,zmUtil.isNettyUploadEnabled()&&zmUtil.validateAttachKey(),d=b.originalEvent.dataTransfer,f=d&&d.files,e=a.getFiles(d),f=e.files,!a.preventDefaultErrorHandler&&e.directories.length&&c(e.directories),f&&f.length?a.onDrop(f,a.$centerEle):"function"==typeof a.onDragLeave&&a.onDragLeave(),!1})},a.prototype.bindDragOver=function(){var a=this;this.$centerEle.on("dragover"+this.eventIdentifier+" dragenter"+this.eventIdentifier,function(b){var c=b.originalEvent.dataTransfer;if(b.preventDefault(),!a.isDragOver)return b&&"dragover"===b.type&&(a.isDragOver=!0),(null!==c.types||c.files&&c.files.length>0)&&(c.files&&c.files.length>0||(c.types.indexOf?c.types.indexOf("Files")!==-1:c.types.contains("application/x-moz-file"))||c.types.length&&"Files"===c.types[0])&&(c.dropEffect="copy","function"==typeof a.onDragover?a.onDragover():a.$dropMsgEle.hasClass("SC_dropW100")||a.$dropMsgEle.addClass("SC_dropW100").attr("centerover",!0)),!1})},a.prototype.bindDragLeave=function(){var a=this;this.$dropMsgEle.on("dragleave"+this.eventIdentifier,function(b){return b.preventDefault(),"function"==typeof a.onDragLeave&&a.isDragOver&&(a.isDragOver=!1,a.onDragLeave()),!1})},function(b){var c=new a(b);c.init()}}(),a.utility.createObjectURL=function(b,c){var d;if(window.URL=window.URL||window.webkitURL,window.URL&&b)return d=window.URL.createObjectURL(b),c&&window.setTimeout(function(){a.utility.revokeObjectURL(d)},c),d},a.utility.revokeObjectURL=function(a){window.URL=window.URL||window.webkitURL,window.URL&&a&&window.URL.revokeObjectURL(a)},a.utility.isFunction=function(a){return"function"==typeof a},a.utility.isChrome=function(){return Boolean(window.chrome)&&Boolean(window.chrome.webstore)},a.utility.isOpera=function(){return Boolean(window.opr)&&Boolean(window.opr.addons)||Boolean(window.opera)||navigator.userAgent.indexOf(" OPR/")>=0},a.utility.isFirefox=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},a.utility.filterMyAttachmentKey=function(a){var b={};return b.e=a.e,b.et=a.et,b.Id=a.Id,b.ft=a.ft,a.n&&(b.n=a.n),a.sid?b.groupId=a.sid:a.gId&&(b.groupId=a.gId),a.shId&&(b.shId=a.shId),(a.sid||a.gId&&a.gId!==zmail.zuid)&&(b.streamsView=!0),b},a.utility.renameHelper=function(){function b(b){var c=this.config;60===b.which||62===b.which?b.preventDefault():13===b.which&&(b.preventDefault(),c.$ele.trigger("blur")),a.utility.isFunction(c.onKeypress)&&c.onKeypress(b)}function c(b){var c,d=this.config,e=d.$ele,f=e.closest("."+d.parentClass),g=d.orginalFileName,h=g.lastIndexOf(".");27===b.which?(b.preventDefault(),c=h!==-1?g.substring(0,h):g,e.text(c),e.blur()):c=e.text(),c&&c.length&&(h!==-1&&(c+=g.substring(h,g.length)),f.attr("title",c),a.utility.isFunction(d.onChange)&&d.onChange.call(d.context||null,c,d.handbackData)),a.utility.isFunction(d.onKeyup)&&d.onKeyup(b)}function d(b){var c,d=this.config,e=d.$ele,f=d.orginalFileName,g=f.lastIndexOf(".");"true"===e.attr("contenteditable")&&(c=e.text(),c&&c.length?g!==-1&&(c+=f.substring(g,f.length)):c=f,e.text(zmUtil.getSubString(20,c)).attr("contenteditable",!1),this.config.orginalFileName=c,a.utility.isFunction(d.onBlur)&&d.onBlur(b))}function e(){var a=this.config.$ele;a.on("keypress",b.bind(this)),a.on("keyup",c.bind(this)),a.blur(d.bind(this))}function f(a,b){"true"!==a.attr("contenteditable")&&(a.attr("contenteditable",!0),window.setTimeout(function(){var c,d,e,f;a.focus(),e=b.attr("title"),f=e.lastIndexOf("."),f!==-1&&a.text(e.substring(0,f)),document.createRange?(c=document.createRange(),c.selectNodeContents(a[0]),c.collapse(!1),d=window.getSelection(),d.removeAllRanges(),d.addRange(c)):document.selection&&(c=document.body.createTextRange(),c.moveToElementText(a[0]),c.collapse(!1),c.select())},10))}function g(a){a&&a.constructor===Object?(this.config=a,e.call(this)):zmUtil.debugLog("Rename attachment: Invalid config")}return{init:function(a){return new g(a)},onRenameAction:f}}(),a}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){function b(){var a={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){R()}]}],scope:"imageAnnotate"};N=zmComponent.keybindings.getScope(),zmComponent.keybindings.registerAll(a),zmComponent.keybindings.setScope("imageAnnotate")}function c(a,b,c,d,e,f){for(var g=b.split("\n"),h=0,i=g.length;h<i;h++){for(var j="",k=g[h].split(" "),l=0,m=k.length;l<m;l++){var n=j+k[l]+" ",o=a.measureText(n),p=o.width;p>e?(a.fillText(j,c,d),j=k[l]+" ",d+=f):j=n}a.fillText(j,c,d),d+=f}}function d(a,b){var c=b.offset(),d=b.position(),e=a.clientX,f=a.clientY,g=e-c.left+d.left,h=f-c.top+d.top,i=$("#zmAnnonateBox #zmCanvasCont");return g+=i.scrollLeft(),h+=i.scrollTop(),{realX:g,realY:h}}function e(){P.undoList.length?$("#zmAttUndo").addClass("sel"):$("#zmAttUndo").removeClass("sel"),P.redoList.length?$("#zmAttRedo").addClass("sel"):$("#zmAttRedo").removeClass("sel")}function f(a){var b=document.createElement("canvas"),c=$("#zmCanvas")[0];b.height=c.height,b.width=c.width,b.getContext("2d").drawImage(c,0,0),a.push(b),e()}function g(a,b){a.getContext("2d").drawImage(b,0,0),b.getContext("2d").clearRect(0,0,b.width,b.height)}function h(a){P.isDragging=!1;var b=$("#zmtempCanvas"),c=$("#zmCanvas")[0];b.off("mousemove.zmAttWidget"),b.off("mouseup.zmAttWidget"),b.off("mouseleave.zmAttWidget"),f(P.undoList),a&&a(),g(c,b[0])}function i(a){var b=$("#zmCanvas")[0],c=b.getContext("2d"),d=$("#zmtempCanvas")[0],e=d.getContext("2d");c.beginPath(),c.clearRect(0,0,b.width,b.height),b.width=a.width,b.height=a.height,e.clearRect(0,0,d.width,d.height),d.width=a.width,d.height=a.height,c.drawImage(a,0,0)}function j(){if(P.undoList.length){var a=P.undoList[P.undoList.length-1];f(P.redoList),i(a),P.undoList.pop(),e()}}function k(){if(P.redoList.length){var a=P.redoList[P.redoList.length-1];f(P.undoList),i(a),P.redoList.pop(),e()}}function l(a,b){var e,f,g,i,j=d(a,b),k=j.realY,l=j.realX,m=$("#zmAnnonateBox"),n=m.find("#zmtempCanvas"),o=n.height(),p=n.width(),q="bold 14px sans-serif";o>=60&&k+50>o&&(k=o-60),p>=210&&l+200>p&&(l=p-210),f=p-l-20,g=o-k-20;var r=function(a){var b=n[0],d=b.getContext("2d"),g=parseFloat(e.css("left")),i=parseFloat(e.css("top"))+15;d.beginPath(),d.fillStyle=P.selectedColor,d.font=q,d.textBaseline="bottom",c(d,a,g,i,f,16),d.closePath(),h()};$("#zmCanvTxtArea").length?(e=$("#zmCanvTxtArea"),i=e.val(),i.length&&r(i),$("#zmCanvTxtArea").remove()):(e=$("<textarea style='width: 200px; position: absolute;'></textarea>"),e.attr("id","zmCanvTxtArea").css({top:k,left:l}),e.css({"max-width":f,"max-height":g,border:"none",color:P.selectedColor,font:q}),m.find("#zmCanvasCont").append(e),e.focus(),e.on("change keyup",function(){zmail.Utils.TextAreaResizer.resize(this,{maxHeight:g,maxWidth:f})}))}function m(a){a.find("#zmAnnonate_Color").hide()}function n(a,b){b.find(".SC_tool").find("li").removeClass("sel"),a.addClass("sel")}function o(a){var b=$("#zmAnnonateBox"),c=b.find("#zmtempCanvas");a.cursorType&&c.css("cursor",a.cursorType),a.offEvents&&c.off(a.offEvents),a.onEvents&&c.on(a.onEvents,function(c){c.preventDefault(),m(b),a.onCallback&&a.onCallback(c,$(this))})}function p(a){P.startX=a.realX,P.startY=a.realY,P.stopX=P.startX,P.stopY=P.startY,P.isDragging=!0}function q(a){P.stopX=a.realX,P.stopY=a.realY}function r(a){var b=$("#zmtempCanvas"),c=b[0].getContext("2d"),d=P.stopX-P.startX,e=P.stopY-P.startY,f=5;c.clearRect(0,0,b[0].width,b[0].height),c.beginPath(),c.rect(P.startX,P.startY,d,e),c.lineWidth=f,a?(a.lineWidth&&(c.lineWidth=a.lineWidth),a.strokeStyle&&(c.strokeStyle=a.strokeStyle),a.fillStyle&&(c.fillStyle=a.fillStyle,c.fill()),a.setLineDash&&c.setLineDash&&(c.setLineDash(a.setLineDash),c.lineDashOffset=2)):c.strokeStyle=P.selectedColor,c.stroke()}function s(a,b){a.preventDefault(),P.isDragging&&(q(d(a,b)),r())}function t(a){var b={};b.strokeStyle=a,b.fillStyle=a,r(b)}function u(a,b){P.isDragging&&(q(d(a,b)),t(P.selectedColor))}function v(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),s(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),h()}),c=d(a,b),p(c),r()}function w(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),u(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),h()}),c=d(a,b),p(c),t(P.selectedColor)}function x(){var a,b,c,d,e=$("#zmtempCanvas"),f=e[0].getContext("2d"),g=Math.abs(P.stopX-P.startX),h=Math.abs(P.stopY-P.startY);f.clearRect(0,0,e[0].width,e[0].height),f.beginPath(),f.ellipse?f.ellipse(P.stopX,P.stopY,g,h,0,0,2*Math.PI):(b=Math.max(g,h),c=g/b,d=h/b,a=g>h?g:h,f.save(),f.translate(P.stopX,P.stopY),f.scale(c,d),f.beginPath(),f.arc(0,0,a,0,2*Math.PI,!1),f.restore()),f.lineWidth=5,f.strokeStyle=P.selectedColor,f.stroke()}function y(a,b){P.isDragging&&(q(d(a,b)),x())}function z(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),y(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),h()}),c=d(a,b),p(c),x()}function A(){var a=$("#zmtempCanvas")[0];if(a.getContext){var b=a.getContext("2d");b.beginPath(),b.strokeStyle=P.selectedColor,b.clearRect(0,0,a.width,a.height),b.moveTo(Math.floor(P.startX),Math.floor(P.startY)),b.lineTo(Math.floor(P.stopX),Math.floor(P.stopY)),b.lineWidth=5,b.lineJoin="round",b.lineCap="round",b.fillStyle=P.selectedColor,b.stroke(),b.closePath()}}function B(a,b){P.isDragging&&(q(d(a,b)),A())}function C(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),B(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),h()}),c=d(a,b),p(c),A()}function D(a,b){if(P.isDragging){var c=$("#zmtempCanvas"),e=c[0].getContext("2d"),f=d(a,b);f.realY+=O,q(f),e.lineTo(P.stopX,P.stopY),e.stroke()}}function E(a,b){var c,e=$("#zmtempCanvas"),f=e[0].getContext("2d");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),D(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),f.closePath(),h()}),c=d(a,b),c.realY+=O,f.beginPath(),f.lineWidth=2,f.shadowBlur=1,f.strokeStyle=P.selectedColor,p(c),f.moveTo(P.startX,P.startY)}function F(){var a=$("#zmtempCanvas"),b=a[0].getContext("2d"),c={},d={};P.startX<P.stopX?(c.startX=P.startX,c.stopX=P.stopX):(c.startX=P.stopX,c.stopX=P.startX),P.startY<P.stopY?(d.startY=P.startY,d.stopY=P.stopY):(d.startY=P.stopY,d.stopY=P.startX),b.clearRect(0,0,a[0].width,a[0].height),a[0].width=Math.abs(P.startX-P.stopX),a[0].height=Math.abs(P.startY-P.stopY),b.drawImage($("#zmCanvas")[0],c.startX,d.startY,Math.abs(c.startX-c.stopX),Math.abs(d.startY-d.stopY),0,0,Math.abs(c.startX-c.stopX),Math.abs(d.startY-d.stopY))}function G(a,b){P.isDragging&&(q(d(a,b)),r({setLineDash:[2,5],strokeStyle:"Black",lineWidth:2}))}function H(a,b){var c,e=$("#zmtempCanvas");e.on("mousemove.zmAttWidget",function(a){a.preventDefault(),G(a,$(this))}),e.on("mouseup.zmAttWidget mouseleave.zmAttWidget",function(a){a.preventDefault(),Math.abs(P.startX-P.stopX)?(F(),h(function(){$("#zmCanvas")[0].getContext("2d").clearRect(0,0,$("#zmCanvas")[0].width,$("#zmCanvas")[0].height),$("#zmCanvas")[0].width=Math.abs(P.startX-P.stopX),$("#zmCanvas")[0].height=Math.abs(P.startY-P.stopY)})):(e.off("mousemove.zmAttWidget"),e.off("mouseup.zmAttWidget"),e.off("mouseleave.zmAttWidget"))}),c=d(a,b),p(c),r({setLineDash:[2,5],strokeStyle:"Black",lineWidth:2})}function I(a){var b=$("#zmtempCanvas")[0],c=b.getContext("2d"),d=$("#zmCanvas")[0];a=a||270,c.clearRect(0,0,b.width,b.height),90===a||270===a?(b.width=d.height,b.height=d.width,c.save(),c.translate(d.height/2,d.width/2)):(b.width=d.width,b.height=d.height,c.save(),c.translate(d.width/2,d.height/2)),c.rotate(a*Math.PI/180),c.drawImage(d,-d.width/2,-d.height/2),f(P.undoList),d.height=b.height,d.width=b.width,d.getContext("2d").clearRect(0,0,d.width,d.height),d.getContext("2d").drawImage(b,0,0),c.restore(),c.clearRect(0,0,b.width,b.height)}function J(a){var b=a.target||a.srcElement,c=b.className,d=$("#zmAnnonateBox"),f=$(b),g=f.parent(),h={cursorType:"crosshair",offEvents:"mousedown click",onEvents:"mousedown"},i="annotate/";switch(c){case"msi-undo":j();break;case"msi-redo":k();break;case"msi-box":n(g,d),h.onCallback=v,h.cursorType="url("+zmResource.get("image",i+"rectangle.png")+"), crosshair",o(h);break;case"msi-mask":n(g,d),h.onCallback=w,h.cursorType="url("+zmResource.get("image",i+"blackout.png")+"), crosshair",o(h);break;case"msi-ellipse":n(g,d),h.onCallback=z,h.cursorType="url("+zmResource.get("image",i+"circle.png")+"), crosshair",o(h);break;case"msi-line":n(g,d),h.onCallback=C,h.cursorType="url("+zmResource.get("image",i+"line.png")+"), crosshair",o(h);break;case"msi-pen":n(g,d),h.onCallback=E,h.cursorType="url("+zmResource.get("image",i+"pen.png")+"), auto",o(h);break;case"msi-crop":n(g,d),h.onCallback=H,h.cursorType="url("+zmResource.get("image",i+"crop.png")+"), crosshair",o(h);break;case"msi-text":n(g,d),h.onCallback=l,h.offEvents="mousedown mousemove mouseup",h.onEvents="click",h.cursorType="auto",o(h);break;case"msi-colorPalette":var m=d.find("#zmAnnonate_Color"),p=f.offset().top-m.outerHeight()/2;m.show().css("top",p);break;case"msi-rotateACW":I(270);break;case"msi-rotateCW":I(90);break;default:n($("#zmAttSquare"),d),h.onCallback=v,h.cursorType="url("+zmResource.get("image",i+"rectangle.png")+"), crosshair",o(h)}e()}function K(a){var b=a.find(".SC_tool");P.selectedColor=a.find("#zmAnnotate_selColor")[0].style.backgroundColor,b.on("click",J),a.find("#zmAnnonate_Color .SC_cp").find("div").on("click",function(){a.find("#zmAnnotate_selColor").removeAttr("id").removeClass("sel"),$(this).addClass("sel").attr("id","zmAnnotate_selColor"),P.selectedColor=$(this)[0].style.backgroundColor}),b.click()}function L(b){window.URL=window.URL||window.webkitURL;var c,d=new Image,e=$("#zmAnnonateBox"),f=e.find("#zmCanvasCont");$(d).css({visibility:"hidden"}),$("body").append(d),c=b.source?b.source:a.utility.createObjectURL(b),d.onload=function(){T(d),e.find(".SC_PUbtm").show(),f.find(".At_load").remove(),a.utility.revokeObjectURL(c)},f.append(zmAttachment.templates.loadingTemplate()),d.src=c}function M(){var a=$("#zmAnnonateBox");a.find("#zmCanvasCont, .SC_pe").css({"max-height":a.height()-5,"max-width":a.width()-5})}var N,O=15,P={startX:0,startY:0,stopX:0,stopY:0,isDragging:!1,undoList:[],redoList:[],selectedColor:"#ce232c"},Q={};a.imageEditTool={},a.utility=a.utility||{},a.utility.dataURItoBlob=function(a){var b,c,d,e;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new window.Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})};var R=function(){$("#zmAnnonateBox").remove(),P.undoList=[],P.redoList=[],Q.onClose&&Q.onClose(),N&&zmComponent.keybindings.setScope(N)},S=function(){$("#zmAnnonateBox").on("mousedown mouseup",function(a){zmUtil.stopEvents(a,!0)})},T=function(a){var b=$("#zmCanvasCont"),c=b.find("#zmCanvas")[0],d=b.find("#zmtempCanvas")[0],e=$(a).height(),f=$(a).width(),g=c.getContext("2d");b.css("overflow","auto"),c.width=f,c.height=e,d.height=e,d.width=f,g.clearRect(0,0,f,e),g.drawImage(a,0,0,f,e),$(a).remove()};a.imageEditTool.init=function(c){var d,e=c.file,f=c.handBckObj;Q=c,$("body").append(zmAttachment.templates.annonateBox()),d=$("#zmAnnonateBox"),d.append(zmAttachment.templates.colorPallete()),b(),S(),M(),c.file?e=c.file:c.source&&(e={source:c.source}),d.find(".At_nme").text(e.name||" "),d.find(".At_cls,#zmImgEditCancel").off("click").on("click",function(){R()}),d.find("#zmImgEditDone").off("click").on("click",function(){var b,e,g;P.undoList[0]||!Q.file?(b=d.find("#zmCanvas"),e=b[0].toDataURL(),g=a.utility.dataURItoBlob(e)):g=Q.file,d.remove(),c.onAttach&&c.onAttach({blob:g,handBckObj:f}),P.undoList=[],P.redoList=[]}),$(zmail.win).resize(function(){$("#zmAnnonateBox").length&&M()}),K($("#zmAnnonateBox")),L(e)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){function b(a){var b={};a.sN&&(b.aId=this.accId,b.sN=a.sN,b.fP=window.encodeURIComponent(a.fP),b.mode="d",zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",p:b}))}function c(){return zmail.isBaihui}function d(){return"false"!==zmail.isCloudServiceEnabled}function e(){return!zmUtil.isZohoAccount(zmail.accId)}function f(){return zmUtil.isNettyUploadEnabled()}function g(){document.body.addEventListener("paste",na)}function h(){document.body.removeEventListener("paste",na)}function i(a){return a.accId||zmUtil.getZohoAccId()}function j(a,b){var c,d={streams:"p",notes:"n",task:"t",bookmark:"l",mail:"m"},e=a.indexOf("zmEdi_")>=0;if("number"==typeof oa[a])return void("function"==typeof b&&b(oa[a]));if(e&&"number"==typeof oa.mail)return void("function"==typeof b&&b(oa.mail));if(d[a])c=d[a];else{if(!e)return;c="m"}$.ajax({url:zmail.conPath+"/attach.do",type:"POST",success:function(c){c=JSON.parse(c),"number"==typeof c.maxsize&&(e?oa.mail=c.maxsize:oa[a]=c.maxsize,"function"==typeof b&&b(c.maxsize))},data:{entity:c,mode:"maxsize",zmrcsr:zmAjq.getCookie("zmcsr")}})}function k(){return"mail"===this.componentId||this.componentId.indexOf("zmEdi_")>=0}function l(){var a;this.desktopAttachedSize=void 0,this.dialog=void 0,this.selectedattachUtilectsArr=[],this.desktopObj=[],this.desktop.hugeFileCount=0,this.filenameCountMap={},this.attachUtil&&(a=this.attachUtil.cache,"object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))&&a.flushExcept(this.attachUtil.appName,["l"+zmail.zuid+"all0 ","t"+zmail.zuid+"all0 "]),this.attachUtil=null)}function m(a,b){return a.filter(function(a){return a!==b})}function n(){this.isUploadCompleted()&&(this.attachTempArr.tempLocation=m(this.attachTempArr.tempLocation,void 0))}function o(a,b,c){"function"==typeof this.onAddAttachment&&this.onAddAttachment(a,b,c)}function p(a){"function"==typeof this.onRemoveAttachment&&this.onRemoveAttachment(a)}function q(a){"function"==typeof this.updateAttachment&&this.updateAttachment(a)}function r(a){"function"==typeof this.updateVirus&&this.updateVirus(a)}function s(a){var b;!function c(){var d,e=a.find("#progressbar")[0];if(e){if(d=parseInt(a.find("#progressbar")[0].style.width),b&&window.clearTimeout(b),d>=90)return;a.find("#progressbar")[0].style.width=d+10+"%",b=window.setTimeout(c,1e3)}}()}function t(a,b){var c=Math.round(100*b.loaded/b.total);a.find("#progressbar").width(c+"%")}function u(a,b,c,d){var e,f=zmUtil.isPreviewAvailable(a.fn||a.name);if(f.isPrev&&("myAttachment"===c?a.src=zmUtil.getTheSrc(f.apiName,a):a.src=zmUtil.getSrcForTempAtt(a,this.accId)),e=this.orderedListOfAttachedFile.length,b>e)for(;e<b;)this.orderedListOfAttachedFile[e]=void 0,e++;this.orderedListOfAttachedFile.splice(b,1,a),o.call(this,a,d,c)}function v(a){var b,c=[],d=[];d=m(this.orderedListOfAttachedFile,void 0),b=d.indexOf(_.findWhere(this.orderedListOfAttachedFile,a)),d.forEach(function(a){var b="msi-attimg"===zmUtil.fileTyp(a.fn||a.name)[1]?101:103;c.push({ft:b,fn:a.n||a.fn||a.name,src:a.src})}),zmUtil.initAttSlideShow({startIndex:b||0,attObjList:c,hideAllOptions:!0,ignoreEMLParsing:!0})}function w(a){var b,c=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,a));return c>=0&&(this.slideListCount--,b=this.orderedListOfAttachedFile[c],this.orderedListOfAttachedFile.splice(c,1),p.call(this,b)),c}function x(){var a,b,f,g=this;b=function(){a=g.configJSON.attachFrom.indexOf("otherCloud"),a>=0&&g.configJSON.attachFrom.splice(a,1)},f=function(){a=g.configJSON.attachFrom.indexOf("zDocs"),a>=0&&g.configJSON.attachFrom.splice(a,1);
},d()&&!c()||b(),zmAttachUtility.isDocsCompAllowed()||f(),e()&&(a=this.configJSON.attachFrom.indexOf("myAttachchment"),a>=0&&this.configJSON.attachFrom.splice(a,1))}function y(){var a=this.attachUtil,b=!1;this.dialog.$el.find(".zm_attFltr").removeClass("shw"),this.dialog.$el.find(".SC_frt").find("b").removeClass("SC_sel"),this.dialog.$el.find(".msi-thumbview").closest("b").addClass("SC_sel"),a.restoreOptions(this.dialog.$el)," "!==a.prvFltr.lblId&&(b=a.prvFltr),a.getAttLst({groupId:a.groupId,dType:"t",st:1,eType:a.entity,fType:a.fileType,prvFltr:a.prvFltr,isNew:"y",lstngObj:b})}function z(){var a=this.attachUtil,b=!1;this.dialog.$el.find(".zm_attFltr").removeClass("shw"),this.dialog.$el.find(".SC_frt").find("b").removeClass("SC_sel"),this.dialog.$el.find(".msi-listview").closest("b").addClass("SC_sel"),a.restoreOptions(this.dialog.$el)," "!==a.prvFltr.lblId&&(b=a.prvFltr),a.getAttLst({groupId:a.groupId,dType:"l",st:1,eType:a.entity,fType:a.fileType,prvFltr:a.prvFltr,isNew:"y",lstngObj:b})}function A(){this.dialog.$el.find(".zm_attFltr").toggleClass("shw"),this.attachUtil.restoreOptions(this.dialog.$el)}function B(){var a,b,c,d=this.attachUtil;if(d){if(a=d.prvFltr.lblId,"undefined"==typeof this.dialog||"myAttachment"!==this.dialog.currentTab())return;if(d.groupId===zmail.zuid&&"all"===d.entity&&0===d.fileType&&" "===a)this.dialog.$el.find("#zmMyAttachments").hide();else{if(d.groupId===zmail.zuid)c=ra.menuText.me;else{var e=zmail.ContactBook.getGroups(d.groupId)[0];c=e?e.attrs.name:""}b="f"===a?ra.menuText.favourites:" "===a?ra.menuText.notags:zmail.labInfo[a].dispName,this.dialog.$el.find("#zmMyAttachments").show(),this.dialog.$el.find("#zmMyAttachments").find("b").text(" "+c+" - "+zmAttachUtility.entDrpTxtChange(d.entity)+" - "+ra.fType[d.fileType]+" - "+b+" "),this.dialog.$el.find(".msi-filter").closest("b").addClass("SC_sel")}}}function C(b){var c=this,d=function(){var a=[];return a.push({iconClass:"msi-filter",onClk:function(){A.call(c)}},{iconClass:"msi-thumbview",selected:!0,onClk:function(){y.call(c)}},{iconClass:"msi-listview",onClk:function(){z.call(c)}}),a};return{id:"myAttachments",text:ra.common.me,selected:b,tabName:"myAttachment",onClk:function(b,d,e){e?B.call(c):(c.attachUtil=new zmAttachUtility.AttachmentListing({appName:"attComp",listElem:b.getCenterElem().find(".SC_mclst"),headerElem:b.$el,thumbWidth:95,onFilterAction:B.bind(c),onListingUpdate:a.myAttachment.onListingUpdate.bind(c),cache:_zm._isPrivilegedUser()}),c.attachUtil.initAttachViewComp()),b.$el.find(".SC_PUsel_files").show()},forceCall:!0,listingArea:{id:"zmattView",classes:"SC_mclst",styles:{"overflow-y":"scroll"},parEle:$(zdom("div",{className:"SCmc SC_attachviewer"}))},icons:d(),buttons:[{text:ra.button.attach,onClk:function(){a.myAttachment.onAttachHandler.call(c)}}]}}function D(b){var c,d,e=this;return c=zmail.isRebranded?ra.cloudServiceName.docs:ra.cloudServiceName.zDocs,d={id:"attachFromDocs",text:c,tabName:"zDocs",selected:b,onClk:function(b,c,d){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),d||a.zDocs.invokeZDocsComponent.call(e,b.getCenterElem())},forceCall:!0,listingArea:{id:"zmMyDocs",classes:"SCmc SC_attachviewer"},buttons:[]},this.configJSON.showZDocsAsLinkOption?d.buttons.push({text:ra.button.insert,onClk:function(){a.zDocs.attachZDocsDocument.call(e)}}):d.buttons.push({text:ra.button.attach,onClk:function(){a.zDocs.attachZDocsDocument.call(e)}}),d}function E(b){var c=this;return{id:"attachFromCloud",text:ra.cloudServiceName.otherCloud,tabName:"oCloud",selected:b,onClk:function(b,d,e){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),e||a.gagets.invokeGadgetComponent.call(c,b)},forceCall:!0,listingArea:{classes:"SCmc SC_attachviewer"},hideButtons:!0}}function F(b){var c=this;return{id:"zmDesktop",text:ra.cloudServiceName.desktop,tabName:"zDesktop",selected:b,onClk:function(b){b.$el.find("#zmMyAttachments").hide(),b.$el.find(".SC_PUsel_files").hide(),"undefined"==typeof c.dialog&&0===c.configJSON.attachFrom.indexOf("desktop")||a.desktop.onTabSelection.call(c)},forceCall:!0,listingArea:{classes:"SC_mclst SC_ren",parEle:$(zdom("div",{className:"SCmc SC_attachviewer"}))},buttons:[{text:ra.button.attach,onClk:function(){a.desktop.attachButtonHandler.call(c)}}]}}function G(b){return a.insertImage.getTabConfig.call(this,b)}function H(a,b){return"myAttachchment"===a?C.call(this,b):"zDocs"===a?D.call(this,b):"otherCloud"===a?E.call(this,b):"desktop"===a?F.call(this,b):"insertImage"===a?G.call(this,b):void 0}function I(a){var b=[],c=this,d=a.find("#zmAttGrp"),e=a.find("#zmAttLbl"),f=a.find("#zmAttEntity"),g=a.find("#zmAttFilTyp");e.text(ra.menuText.none).data({dataIndex:"all"}),d.text(ra.menuText.me).data({dataIndex:zmail.zuid}),f.text(ra.menuText.all).data({dataIndex:"all"}),g.text(ra.menuText.all).data({dataIndex:0}),a.find(".SC_frt").find(".msi-thumbview").closest("b").addClass("SC_sel"),a.find("#zmAttGrp").off("click").on("click",function(){zmAttachUtility.attDropDown("grp",d)}),a.find("#zmAttEntity").on("click",function(){zmAttachUtility.attDropDown("ent",f)}),a.find("#zmAttFilTyp").on("click",function(){zmAttachUtility.attDropDown("tfil",g)}),a.find("#zmAttLbl").on("click",function(){zmAttachUtility.attDropDown("lbl",e)}),a.find("#zmDfltAttView").off("click").on("click",function(){var b=c.attachUtil;a.find(".msi-filter").closest("b").removeClass("SC_sel"),a.find(".zm_attFltr").removeClass("shw"),b.prvFltr.lblId=" ",b.getAttLst({groupId:zmail.zuid,dType:b.dType,st:1,eType:"all",fType:0,prvFltr:b.prvFltr,isNew:"y",lstngObj:!0})}),a.find("#attFilter").on("click",function(){var h=d.data().dataIndex,i=f.data().dataIndex,j=g.data().dataIndex,k=e.data().dataIndex,l=c.attachUtil;if("all"===k&&(k=" "),a.find(".zm_attFltr").removeClass("shw"),l.groupId!==h||l.fileType!==j||l.entity!==i||l.prvFltr.lblId!==k){if(" "===k)return b.mthd=" ",b.lblId=" ",void l.getAttLst({groupId:h,dType:l.dType,st:1,eType:i,fType:j,prvFltr:l.prvFltr,isNew:"y",lstngObj:!0});"f"===k?(b.mthd="listFavourite",b.lblId=k):(b.mthd="labelListing",b.lblId=k),l.getAttLst({groupId:h,dType:l.dType,st:1,eType:i,fType:j,prvFltr:l.prvFltr,isNew:"y",lstngObj:b})}}),a.find("#filterCncl").on("click",function(){var b=c.attachUtil;a.find(".zm_attFltr").removeClass("shw"),b.restoreOptions(a)})}function J(b){var c=this;b.getCenterElem("myAttachment").on("click",".zmAch",function(b){a.myAttachment.toggleSelectedStatus.call(c,b,this)}),I.call(this,b.$el)}function K(b){function c(c){var d=b.getCenterElem("zDesktop").find(".SC_drop");d.removeClass("SC_dropW100");for(var f=function(b){a.desktop.validateFile.call(e,b,b.name,function(c){c.status&&a.desktop.addAttachmentInDesktopTab.call(e,{file:b,isHuge:c.isHuge,isDocs:c.isDocs})})},g=0;g<c.length;g++)f(c[g]);0===e.desktopObj.length&&d.addClass("SC_dropW100")}function d(){e.desktopObj.length&&b.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100").removeAttr("centerover")}var e=this;b.getCenterElem("zDesktop").find(".SC_drop").click(function(){a.desktop.attachFromDesktopTab.call(e)}),a.utility.setDragDrop({onDrop:c,onDragLeave:d,$centerEle:b.getCenterElem("zDesktop"),$dropMsgEle:b.getCenterElem("zDesktop").find(".SC_drop")})}function L(b){var c=this,d=b.$el;a.utility.setDragDrop({onDrop:function(){c.desktopObj.length&&b.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100")},onDragover:function(){"zDesktop"===b.currentTab()&&b.getCenterElem("zDesktop").find(".SC_drop").addClass("SC_dropW100")},onDragLeave:function(){var a=b.getCenterElem("zDesktop").find(".SC_drop");c.desktopObj.length&&!a.attr("centerover")&&a.removeClass("SC_dropW100")},$centerEle:d,$dropMsgEle:d,eventIdentifier:"zmAttComp",preventDefaultErrorHandler:!0})}function M(b){var c=this.configJSON.attachFrom.indexOf("desktop"),d=this.configJSON.attachFrom.indexOf("insertImage");this.configJSON.attachFrom.indexOf("myAttachchment")>=0&&J.call(this,b),(c>=0||d>=0)&&g(),c>=0&&K.call(this,b),d>=0&&a.insertImage.bindEventsToTab.call(this,b),L.call(this,b)}function N(b){var c,d,e=this,f={maxHeight:"1px",maxWidth:"1px"};$("body").append(zdom("div",{style:f,id:"zmpastefirefox",contentEditable:"true"})),c=new window.MutationObserver(function(c){c.forEach(function(c){"childList"===c.type&&c.addedNodes&&c.addedNodes.length&&Array.prototype.forEach.call(c.addedNodes,function(c){if("IMG"===c.tagName){var f=$(c),g=a.utility.dataURItoBlob(f.attr("src"));d="ScreenShot_"+(new Date).getMilliseconds()+".png",f.remove(),a.desktop.validateFile.call(e,g,d,function(c){c.status&&("zDesktop"===b.currentTab()?a.desktop.addAttachmentInDesktopTab.call(e,{file:g,name:d,isHuge:c.isHuge}):"insertImage"===b.currentTab()&&a.insertImage.pasteHandler(g,b))})}})})}),c.observe($("#zmpastefirefox")[0],{childList:!0})}function O(a){a&&(this.dialog=a)}function P(b){var c,d=this,e=b.$el.find("."+b.contentClass),f=this.configJSON.attachFrom,g="none",h=f.indexOf("desktop");this.dialog=b,(window.ActiveXObject||"ActiveXObject"in window)&&b.$el.find("."+b.contentWrapperClass).css({opacity:1}),h>=0&&b.getCenterElem("zDesktop").append(zmAttachment.templates.dragdropArea());var i={display:"none",position:"absolute",marginTop:"-17px",paddingLeft:"10px"};if(f.indexOf("myAttachchment")>=0&&(b.$el.find("."+b.headerClass).after(zdom("div",{id:"zmMyAttachments",style:i},ra.filterMenu.filterBy+":",zdom("b",null),zdom("font",{className:"SC_lnk",id:"zmDfltAttView"},"("+ra.common.clearFilter+")"))),"myAttachment"===b.currentTab()&&(g="block"),b.$el.find("."+b.contentClass).after(zdom("div",{style:{display:g},className:"SC_PUsel_files"},zdom("label",null,ra.common.selectedfiles))),b.getCenterElem("myAttachment").append(zmAttachUtility.getFilterDropTemplate())),b.$el.find("."+b.contentClass).css({overflow:"hidden",width:""}),b.$el.find(".SCmc.SC_attachviewer").css({"max-height":e.css("max-height"),"max-width":e.css("max-width")}),this.configJSON.showZDocsAsLinkOption&&f.indexOf("zDocs")>=0){var j;b.getButtonContainer("zDocs").append(zmAttachment.templates.docsOption()),j=b.getButtonContainer("zDocs").find(".SC_frt div"),j.click(function(){var a=$(this);a.hasClass("SC_rwWrite")?(d.asLink=!1,ATTACHDIALOG.asAttachment(),b.hideSuccErrMsg("zDocs")):(d.asLink=!0,ATTACHDIALOG.asLink(),b.showSuccErrMsg("w",ra.zohoDocs.aslinkwmsg,"zDocs")),a.toggleClass("SC_rwWrite")})}f.indexOf("insertImage")>=0&&a.insertImage.dialogDidMount(b),c=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,na=function(e){d.dialog&&(c?$("#zmpastefirefox").html("").focus():(e.preventDefault(),"zDesktop"===d.dialog.currentTab()?a.desktop.onPaste.call(d,e):"insertImage"===d.dialog.currentTab()&&a.insertImage.pasteHandler(e,b)))},c&&N.call(this,b),M.call(this,b),h>=0&&a.desktop.dialogDidMount.call(this,b,h)}function Q(){if(f()){var a=_zm.isWSActive()&&_zm._isPrivilegedUser();return"https://"+zmail.urls.uploadurl+"/uploadTemp?checkOffline="+a+"&isRebrandUser="+zmail.isRebranded}return"/zm/attach.do?mode=temp"}function R(){return f()?{}:{type:"f",accId:this.accId,tSize:0}}function S(){return pa}function T(){return qa}function U(){return{extension:["ade","adp","bat","chm","cmd","com","cpl","exe","hta","ins","isp","jar","jse","lib","lnk","mde","msc","msp","mst","pif","scr","sct","shb","sys","vb","vbe","vbs","vxd","wsc","wsf","wsh"]}}function V(){var a={},b=this.configJSON.desktop;return a.hugeFileCount=0,b?(a.uploadAPI=b.uploadAPI||Q(),a.requireParamToUpload=b.requireParamToUpload||R.call(this),a.uploadCallBack=b.uploadCallBack,a.autoBrowse=b.autoBrowse,b.allowedType&&(a.allowedFileType=b.allowedType.type,a.fileTypeErr=b.allowedType.error||ra.desktop.invalidFormat),"boolean"==typeof b.multiple?a.multiple=b.multiple:a.multiple="true",b.excludeType instanceof Object?a.excludeType=b.excludeType:a.excludeType=U(),a):(a.uploadAPI=Q(),a.requireParamToUpload=R.call(this),a.multiple="true",a.excludeType=U(),a)}function W(a){return!(!a||a.constructor!==Object||"string"!=typeof a.url||!a.params||a.params.constructor!==Object)}function X(a){return a instanceof $?a:$("#"+a)}function Y(){void 0!==this.$ele&&this.$ele.length||(this.$ele=X(this.configJSON.eleId))}function Z(a,b){var c,d,e={},f={},g=b.from,h=b.uuid;if("temp"===g)c=this.attachTempArr.tempLocation,f=e={fP:h};else{if("myAttachment"!==g)return;c=this.attachTempArr.myAttachment,e={uniqueId:h},f={uuid:h}}d=c.indexOf(_.findWhere(c,e)),d>=0&&(c[d].n=a),d=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,f)),d>=0&&(this.orderedListOfAttachedFile[d].n=a),"function"==typeof q&&q.call(this,c[d])}function aa(a,b){var c;if(b)c=b;else for(var d=this.$ele,e=$(d).find("div:data(uniqueId)"),f=0,g=e.length;f<g;f++)if($(e[f]).data("uniqueId")===a){c=e[f];break}if(c){$(c).addClass("zmVirusFile"),$(c).find(".zmSub").remove();var h=$(c).find(".zmSze span");$(h).addClass("SC_red").text(ra.common.virusDetected);var i=$(zdom("i",{className:"msi-fail zmDoubleIcon"}));$(h).before(i)}}function ba(a){var b=this.attachTempArr.tempLocation,c={fP:a.FILEPATH},d=b.indexOf(_.findWhere(b,c));d>=0&&(b[d].virusFree=a.STATUS,a.STATUS===!1&&aa.call(this,a.FILEPATH)),"function"==typeof r&&r.call(this,{fp:a.FILEPATH,value:a.STATUS})}function ca(){var a=this;$.subscribe("attachment/cloudUpload",function b(c,d,e,f){$.unsubscribe("attachment/cloudUpload",b),a.cloudUpload(d,e,f)}),$.subscribe("attachment/cloudClose",function c(){$.unsubscribe("attachment/cloudClose",c),a.closeThisAppView()})}function da(){var a={},b=this.configJSON.attachFrom,c=!1;a.id="zmAttachCompWhtPopup",a.tabs=[];for(var d=0,e=b.length;d<e;d++)c=0===d,a.tabs.push(H.call(this,b[d],c));a.onClose=this.closeThisAppView.bind(this,!0),a.dialogDidMount=P.bind(this),a.dialogWillMount=O.bind(this),a.onMouseDown=function(){$("#zm_flpopup, #zmAtt_dropDown").remove()},a.classes="SC_add",this.dialog=zmsDialog.createTabPopupDialog(a)}function ea(b){var c,d,e,f,g,h,i,j=b.success,k=j.length;Y.call(this),g=this.$ele;for(var l=0;l<k;l++)f=void 0,d=zmUtil.getDummyFilename(j[l].name),e=zmUtil.isPreviewAvailable(d),i=zmUtil.fileTyp(j[l].name)[1],"msi-attimg"===i&&(j[l].src?f=j[l].src:(f=zmail.conPath+"/"+e.apiName,f+="?mode=tmpview&entityType=1&accId="+this.accId+"&fpath="+j[l].fP+"&fstorename="+j[l].sN)),c=$(zmAttachment.templates.attListingTemplate({size:zmUtil.sizeConv(j[l].size),name:j[l].name,image:zmAttachment.templates.attPrevInr({fn:j[l].name,thn:f})})),this.configJSON.renameSupport?"msi-attimg"!==i&&c.find('.zmSub i[data-name="showMore"]').remove():(h=c.find('.zmSub span[data-name="rename"]'),"msi-attimg"===i?h.attr("data-name","showMore").text(ra.attachTemplateText.annotate):h.remove(),c.find('.zmSub i[data-name="showMore"]').remove()),g.append(c),j[l].virusFree===!1&&zmUtil.isNettyUploadEnabled()&&a.virusAttachmentUpdate.call(this,"",c),a.core.storeTempAttachments.call(this,j[l],c,this.fromDesktopCount++,this.slideListCount++);a.core.resolveDeferred.call(this),a.core.onAppend.call(this)}function fa(a){var b,c,d,e=this.attachTempArr.tempLocation,f=e.length;for(b=0;b<f&&(c=e[b],d=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,{fP:c.fP})),!(d>a));b++);return b<f?b:-1}function ga(a){var b=this.attachTempArr.tempLocation,c=b.length,d=c-1;if(!(a<0||a>c))for(d=c-1;d>=a;d--)b[d+1]=b[d]}function ha(b,c,d,e){function f(f){var g=f.blob,i=f.handBckObj;g.name=b.attr("title"),h.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(c.fs||c.size||0),a.desktop.fileUpload.call(h,{file:g,name:g.name,$replaceEle:b,dIndex:i.attachTempArrIndex,sIndex:i.slideArrIndex,from:i.from,onerror:function(a){a.replaceWith(b),h.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(c.fs||c.size||0),ha.call(h,b,c,d,e)},onsuccess:function(){if("temp"!==d){var a=h.attachTempArr.myAttachment,b=a.indexOf(_.findWhere(a,{uniqueId:c.uuid}));b>=0&&(a[b]&&a[b].streamsView&&h.streaViewCount--,a.splice(b,1))}},beforeStoreTempUpdate:function(){if(i.from&&"temp"!==i.from){var a=fa.call(h,i.slideArrIndex);if(a>=0)return ga.call(h,a),a}}})}function g(){var b,c,e,g="";c=h.orderedListOfAttachedFile.indexOf(_.findWhere(h.orderedListOfAttachedFile,i)),e=h.orderedListOfAttachedFile[c],"temp"===d?(g=zmUtil.getSrcForTempAtt(e),b=h.attachTempArr.tempLocation.indexOf(_.findWhere(h.attachTempArr.tempLocation,i))):g=zmUtil.getTheSrc("FileDownload",e),a.imageEditTool.init({source:g,handBckObj:{attObj:e,from:d,attachTempArrIndex:b,slideArrIndex:c,searchObj:i},onAttach:f})}var h=this,i={},j=b.find(".zmFrm span"),k=c.name||c.fn;"temp"===d?(e=c.fP,i={fP:e}):"myAttachment"===d&&e&&(i={uuid:e}),b.on("click",function(b){var c,e,f,j=$(b.target||b.srcElement),l=zmUtil.isPreviewAvailable(k);if("filename"===j.attr("data-name")&&h.configJSON.renameSupport)a.utility.renameHelper.onRenameAction(j,j.closest(".zmL"));else if(j.hasClass("zmFrm")&&h.configJSON.renameSupport)j=j.find("span"),a.utility.renameHelper.onRenameAction(j,j.closest(".zmL"));else if("rename"===j.attr("data-name")&&h.configJSON.renameSupport)j=j.closest(".zmL").find(".zmFrm span"),a.utility.renameHelper.onRenameAction(j,j.closest(".zmL"));else if("download"!==j.attr("data-name")&&l.isPrev)if("showMore"===j.attr("data-name"))if("SPAN"===j[0].nodeName)g();else{var m={par:j,parWidth:!0},n=[{htm:ra.attachTemplateText.annotate,data:{action:"annotate"}}];j.find("b").addClass("SC_ddn"),j.closest(".zmL").addClass("sel"),m.list=n,m.divId="zmAtt_dropDown",m.clk=function(a){"annotate"===a.action&&(zmUtil.hideMenu(),g())},m.onHide=function(){j.find("b").removeClass("SC_ddn"),j.closest(".zmL").removeClass("sel")},m.showArrow=!0,zmUtil.isChildWindow()?(e=new zmDropDownMenu,e.setDropObj(m),e.paint()):zmsuite.showMenu(m)}else a.utility.initSlideshow.call(h,i);else c=h.orderedListOfAttachedFile.indexOf(_.findWhere(h.orderedListOfAttachedFile,i)),c>=0&&(f=h.orderedListOfAttachedFile[c],"temp"===d?zmUtil.downloadTempAttachment({accId:h.accId,fP:f.fP,sN:f.sN,name:f.n||f.name}):zmUtil.downloadAttachment(f))}),a.utility.renameHelper.init({context:this,$ele:j,onChange:Z,handbackData:{from:d,uuid:e||c.fP},orginalFileName:k,parentClass:"zmL"})}function ia(){this.asLink=!1}function ja(){var a=this.configJSON;this.actionMode=a.actionMode||0,a.$actionEle&&(this.$actionEle=a.$actionEle),a.classToRemove&&(this.classToRemove=a.classToRemove),a.classToAdd&&(this.classToAdd=a.classToAdd),"function"==typeof a.onRemoveAttachment&&(this.onRemoveAttachment=a.onRemoveAttachment),"function"==typeof a.onAddAttachment&&(this.onAddAttachment=a.onAddAttachment),"function"==typeof a.onRemoveElement&&(this.onRemoveElement=a.onRemoveElement),"function"==typeof a.onAddElement&&(this.onAddElement=a.onAddElement),"function"==typeof a.updateAttachment&&(this.updateAttachment=a.updateAttachment),"function"==typeof a.updateVirus&&(this.updateVirus=a.updateVirus),a.$dropCenter&&(this.$dropCenter=a.$dropCenter),a.insertImage&&a.insertImage.constructor===Object&&(this.insertImage=a.insertImage),W(a.myAttachment)&&(this.myAttachment=a.myAttachment),void 0===a.maxAttachedSize&&(this.configJSON.maxAttachedSize=S(),j(a.componentId,function(a){this.configJSON.maxAttachedSize=a}.bind(this))),void 0===a.currentAttachedSize&&(this.configJSON.currentAttachedSize=T()),this.isHugeAttachmentUploadEnabled()&&(this.hugeAttachment={attachedFiles:[],isHugeUploadInProgress:0})}function ka(){var a,b,c=this.attachTempArr.tempLocation,d=c.length,e={fP:!0,sN:!0,size:!0,n:!0},f={},g=[];for(a=0;a<d;a++){if(f={},zmUtil.isNettyUploadEnabled()&&c[a]){if(c[a].virusFree===!1){g={error:!0,errorCode:11};break}if("pending"===c[a].virusFree){g={error:!0,errorCode:12};break}}for(b in c[a])e[b]?f[b]=c[a][b]:"name"!==b||c[a].n||(f.n=c[a][b]);$.isEmptyObject(f)||g.push(f)}return g}function la(){var a,b,c=this.attachTempArr.myAttachment,d=c.length,e={},f=[];for(a=0;a<d;a++){e={};for(b in c[a])"uniqueId"!==b&&(e[b]=c[a][b]);f.push(e)}return f}function ma(a){this.dialog=void 0,this.isAttachingCount=0,this.fromDesktopCount=0,this.slideListCount=0,this.attachTempArr={tempLocation:[],myAttachment:[]},this.attachUtil=null,this.selectedattachUtilectsArr=[],this.asLink=!1,this.orderedListOfAttachedFile=[],this.streaViewCount=0,this.desktopObj=[],this.filenameCountMap={},this.updateConfig(a)}var na=function(){},oa={},pa=10485760,qa=0,ra=function(){var a={};return $.extend(a,zmText.get("attachmentUtility"),zmText.get("attachComponent"),!0),a}();a.core={},a.utility=a.utility||{},a.virusCheckStatus={},a.utility.isAttachmentSelected=function(a){return!!a||(zmUtil.succErrMsg("e",ra.selectAttach),!1)};var sa={initDragDropArea:function(){var b=$(zmAttachment.templates.dropMsgTemplate()),c=this;if(this.$dropCenter instanceof $){var d=function(d){var e,f;if(c.isUploadAllowed()&&(f=function(b){a.desktop.validateFile.call(c,b,b.name,function(d){d.status&&a.desktop.uploadFiles.call(c,[{file:b,fileName:d.name,isHuge:d.isHuge,isDocs:d.isDocs}])})},b.hide(),d))for(e=0;e<d.length;e++)f(d[e])};this.$dropCenter.append(b),a.utility.setDragDrop({onDrop:d,onDragLeave:function(){return c.isUploadAllowed()&&b.hide(),!1},onDragover:function(){c.isUploadAllowed()&&b.show()},$centerEle:this.$dropCenter,$dropMsgEle:b})}},createActionMenu:function(){var a=this.$actionEle,b=this;if(this.desktop.autoBrowse)this.browseDesktop();else{var c,d=a,e={par:d,parWidth:!0},f=75,g=[{htm:ra.attachDropMenu.quickAttach,data:{action:"desktop"}},{htm:ra.attachDropMenu.compAttach,data:{action:"cloud"}}];d.find("b").addClass("SC_ddn"),e.list=g,e.divId="zmAtt_dropDown",e.clk=function(a){zmUtil.hideMenu(),"desktop"===a.action?b.browseDesktop():b.init()},c=$("body").height()-a.offset().top>=f?"up":"bottom",e.align="pleft",e.direction=c,zmsuite.showMenu(e)}},bindClickEventToActionEle:function(){var a=this;this.$actionEle.click(function(b){var c=b.target||b.srcElement;a.isUploadAllowed()&&(0!==a.actionMode||zmail.isInternalOrgUser?1===a.actionMode?a.browseDesktop():a.init():"msi-barrow"===c.className?sa.createActionMenu.call(a):a.browseDesktop())})},addTempLocationAttachment:function(a){ea.call(this,{success:[a]})},appendPreAttachedFile:function(b){b.fP?sa.addTempLocationAttachment.call(this,b):a.myAttachment.appendAttachment.call(this,b)},processPreAttachedFile:function(a){var b=a||this.configJSON.preAttachedFile;b instanceof Array&&b.forEach(function(a){sa.appendPreAttachedFile.call(this,a)},this)},doInitialAction:function(){this.$dropCenter instanceof $&&sa.initDragDropArea.call(this),this.autoLaunch?this.init():this.$actionEle instanceof $?sa.bindClickEventToActionEle.call(this):1===this.actionMode&&this.browseDesktop(),this.configJSON.preAttachedFile&&sa.processPreAttachedFile.call(this)}};a.core.onAllUploadFinish=function(){var a,b,c=this.configJSON.onAllUploadFinish;this.isUploadCompleted()&&"object"===("undefined"==typeof c?"undefined":babelHelpers["typeof"](c))&&"function"==typeof c.handler&&(a=this.attachTempArr,b=$.extend(!0,{},a),c.resetData&&this.clearStoreAttachments(),c.removeAttachDOM&&this.$ele.find(".zmL.SC_Pbar").remove(),Array.isArray(b.myAttachment)&&b.myAttachment.filter(function(a){return delete a.uniqueId}),c.handler(b))},a.core.incrementAttachCount=function(){this.isAttachingCount++},a.core.decrementAttachCount=function(){this.isAttachingCount>0&&this.isAttachingCount--},a.core.addRemoveClassToParentDom=function(){var a=this.attachTempArr.myAttachment,b=this.attachTempArr.tempLocation;this.isAttachingCount||b.length||a.length?(this.classToAdd&&this.$ele.addClass(this.classToAdd),this.classToRemove&&this.$ele.removeClass(this.classToRemove)):this.classToRemove&&this.$ele.addClass(this.classToRemove)},a.core.onAppend=function(){"function"==typeof this.onAddElement&&this.onAddElement()},a.core.onRemove=function(){"function"==typeof this.onRemoveElement&&this.onRemoveElement()},a.core.resolveDeferred=function(){var a=this.deferred;a&&this.isUploadCompleted()&&this.isDeferredUploadEnable()&&this.getStoreAttachments().done(function(b){a.resolve(b)})},a.core.storeTempAttachments=function(c,d,e,g){var h=this,i=this.attachTempArr.tempLocation,j=i.length;if(e>j)for(;j<e;)i[j]=void 0,j++;this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(c.size||0),i.splice(e,1,c);var k=function(){if(!h.deferred){var e,g=h.attachTempArr.tempLocation,i=g.indexOf(_.findWhere(g,{fP:c.fP}))||0;i>=0&&(f&&delete a.virusCheckStatus[c.fP],d.remove(),e=g[i],h.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(c.size),g.splice(i,1),h.fromDesktopCount--,a.core.addRemoveClassToParentDom.call(h),b.call(h,e),a.core.onRemove.call(h)),a.utility.modifySlideshowArray.call(h,{fP:c.fP})}};d.data({uniqueId:c.fP}),d.find(".SC_icn").off("click").on("click",k),ha.call(this,d,c,"temp"),a.utility.storeAttListForSlideshow.call(this,c,g,"tempAttachment",d)},ma.prototype={init:function(){(f()||this.isHugeAttachmentUploadEnabled())&&zmUtil.validateAttachKey(),1===this.actionMode?this.browseDesktop():(x.call(this),ia.call(this),da.call(this),ca.call(this))},updateConfig:function(a){var b;null!==a&&"object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))&&("object"===babelHelpers["typeof"](this.configJSON)?(b=this.configJSON.componentId,$.extend(!0,this.configJSON,a)):this.configJSON=a,Array.isArray(a.attachFrom)&&(this.configJSON.attachFrom=a.attachFrom),a.componentId&&b&&a.componentId!==b&&(this.configJSON.maxAttachedSize=void 0),this.componentId=this.configJSON.componentId,this.autoLaunch="undefined"==typeof this.configJSON.autoLaunch||this.configJSON.autoLaunch,this.$ele=X(this.configJSON.eleId),this.accId=i(this.configJSON),this.desktop=V.call(this),ja.call(this))},isHugeAttachmentUploadEnabled:function(){return zmUtil.isHugeAttachmentUploadEnabled()&&k.call(this)},browseDesktop:function(){this.isUploadAllowed()&&a.desktop.browseDesktop.call(this)},uploadFiles:function(b){var c,d,e=this;if(this.isUploadAllowed()){(zmUtil.isNettyUploadEnabled()||this.isHugeAttachmentUploadEnabled())&&zmUtil.validateAttachKey();var f=function(b){a.desktop.validateFile.call(e,b,b.name,function(c){c.status&&a.desktop.uploadFiles.call(e,[{file:b,fileName:c.name,isHuge:c.isHuge,isDocs:c.isDocs}])})};if(b instanceof window.File)f(b);else if(b.length)for(c=0,d=b.length;c<d;c++)f(b[c])}},addFiles:function(a){this.isUploadAllowed()&&a instanceof Array&&a.length&&sa.processPreAttachedFile.call(this,a)},isStreamView:function(){return this.streaViewCount>0},closeThisAppView:function(b){this.dialog&&(b||this.dialog.close(),$.unsubscribe("attachment/cloudClose"),$.unsubscribe("attachment/cloudUpload"),h(),l.call(this),this.configJSON.onClose&&this.configJSON.onClose(),a.insertImage.clear(),$("#zmpastefirefox").remove())},cloudUpload:function(b,c,d,e){var f,g,h,i,j=this;h=$(zmAttachment.templates.cloudAttTempLoadingBox()),h.find(".zmSub").html(""),this.closeThisAppView(),a.core.incrementAttachCount.call(this),Y.call(this),i=function(b){if(h.remove(),a.core.decrementAttachCount.call(j),b.success&&b.success.length){var c,d,e,f=j.configJSON.maxAttachedSize,g=j.configJSON.currentAttachedSize,i=ra;for(c=0,d=b.success.length;c<d;c++)if(g+=zmAttachUtility.parseToNumber(b.success[c].size||0),g>f){b.success=b.success.splice(0,c);var k=f/1048576,l=d-c;e=zmText.applyArgs(i.maxsizeerr,{size:k+"MB",leftfiles:l}),zmUtil.succErrMsg("e",e);break}if(b.failure&&b.failure.length){var m=b.failure,n=m.length,o="";for(e=ra.ajaxErr,c=0;c<n;c++)o+=0===c?m[0].fileName:","+m[0].fileName;_zm.succErrMsg("e",e.attFromCloudPartialErr1+" "+o+" "+e.attFromCloudPartialErr2),j.onUploadError()}ea.call(j,b)}else b.failure&&b.failure.length&&("object"===babelHelpers["typeof"](b.failure[0])&&"string"==typeof b.failure[0].msg?_zm.succErrMsg("e",b.failure[0].msg):_zm.succErrMsg("e",ra.ajaxErr.attFromCloud),a.core.onRemove.call(j),j.onUploadError());a.core.onAllUploadFinish.call(j)},h.find(".msi-close").on("click",function(){j.deferred||(f.abort(),a.core.decrementAttachCount.call(j),a.core.addRemoveClassToParentDom.call(j),a.core.onRemove.call(j))}),e="z"!==e?ra.cloudServiceName.otherCloud:ra.cloudServiceName.zDocs,g=zmText.applyArgs(ra.attachingfrom,{filecount:c,servicename:e}),h.find(".zmFrm span").text(g),this.$ele.append(h),a.core.addRemoveClassToParentDom.call(this),a.core.onAppend.call(this);var k={docs:b,method:"attachFromCloud",groupId:zmail.zuid,entityType:1,accId:j.accId},l={u:zmail.conPath+"/postAttach.do",t:"POST",fn:i,p:k,csr:"s",efn:function(b,c,d){h.remove(),a.core.onRemove.call(j),"abort"!==d.statusText&&_zm.succErrMsg("e",ra.ajaxErr.attFromCloud)}};"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){f=zmAjq.XHR(l),s(h)}):(f=zmAjq.XHR(l),s(h))},rejectDeferredOnError:function(){var a;this.deferred&&(a=this.deferred,this.deferred=void 0,a.reject({error:!0,handBckObj:this.configJSON.handBckObj}))},onUploadError:function(){this.rejectDeferredOnError()},isUploadAllowed:function(){return!this.deferred},isDeferredUploadEnable:function(){return this.configJSON.deferredUpload},isUploadCompleted:function(){return 0===this.isAttachingCount},isUploadInProgress:function(){return!this.isUploadCompleted()},isHugeFileUploadInProgress:function(){return 1===this.hugeAttachment.isHugeUploadInProgress},getStoreAttachments:function(a){var b=$.Deferred(),c={};if(this.isUploadCompleted()||a){if(n.call(this),c.tempLocation=ka.call(this),c.myAttachment=la.call(this),this.hugeAttachment&&Array.isArray(this.hugeAttachment.attachedFiles)&&this.hugeAttachment.attachedFiles.length&&(c.hugeAttachment=this.hugeAttachment.attachedFiles),!this.isDeferredUploadEnable())return c;this.deferred=void 0,b.resolve(c)}else this.isDeferredUploadEnable()&&(this.deferred=b);return!!this.isDeferredUploadEnable()&&b.promise()},getAllAttachedList:function(){var a=m(this.orderedListOfAttachedFile,void 0);return a},clearStoreAttachments:function(){this.attachTempArr.tempLocation=[],this.attachTempArr.myAttachment=[],this.orderedListOfAttachedFile=[],this.configJSON.currentAttachedSize=0,this.fromDesktopCount=0,this.slideListCount=0,this.streaViewCount=0}},a.init=function(a,b){var c;return c=b?b:new ma(a),sa.doInitialAction.call(c),c},a.cloudUpload=function(a,b,c){$.publish("attachment/cloudUpload",[a,b,c])},a.closeThisAppView=function(a){$.publish("attachment/cloudClose",[a])},a.core.bindTempListedAttachment=ha,a.core.checkAppendElePresence=Y,a.core.showDummyProgress=s,a.core.showProgressReq=t,a.core.isNettyUploadEnabled=f,a.core.isComposeApp=k,a.getAttachComponent=ma,a._i18N=ra,a.virusCheckStatusUpdate=ba,a.virusAttachmentUpdate=aa,a.getDefaultUploadAPIPath=Q,a.utility.getElementReference=X,a.utility.initSlideshow=v,a.utility.modifySlideshowArray=w,a.utility.storeAttListForSlideshow=u}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){function b(a,b){var c,d,e=this.desktopObj;a<b?e.splice(b,0,e.splice(a,1)[0]):a>b&&(0===b?(c=e.splice(a,1),this.desktopObj=c.concat(e)):(c=e.splice(0,b),d=e.splice(a-b,1),this.desktopObj=c.concat(d.concat(e))))}var c,d={},e=!1;a.utility=a.utility||{},a.utility.fileReorder={},a.utility.fileReorder.handleDragStart=function(a){var b=a.target||a.srcElement,f=$(b).closest(".zmL"),g=this.desktopObj[f.index()].fileName;if(g=zmUtil.getSubString(20,g),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&a.originalEvent.dataTransfer.setData("text/plain",g),"function"==typeof a.originalEvent.dataTransfer.setDragImage){$("#zacdummydrag").remove();var h={top:"0px",left:"-1000px"},i=zdom("div",{id:"zacdummydrag",className:"SC_dg",style:h},g);document.body.appendChild(i),a.originalEvent.dataTransfer.setDragImage(i,0,0)}e=!0,c=this.dialog.$el,d.dragElement=f,d.dragElementIndex=f.index()},a.utility.fileReorder.handleDragOver=function(a){var b,f;e&&(b=a.target||a.srcElement,f=$(b).closest(".zmL"),c.find(".dragtheme").remove(),d.dragOverElement=f,d.dragOverElementIndex=f.index(),d.dragElementIndex<d.dragOverElementIndex?f.after(zmAttachment.templates.dragtheme):d.dragElementIndex>d.dragOverElementIndex&&f.before(zmAttachment.templates.dragtheme))},a.utility.fileReorder.handleDragEnd=function(){var a;c.find(".dragtheme").remove(),d.dragElementIndex<d.dragOverElementIndex?(a=d.dragElement.detach(),
d.dragOverElement.after(a),b.call(this,d.dragElementIndex,d.dragOverElementIndex)):d.dragElementIndex>d.dragOverElementIndex&&(a=d.dragElement.detach(),d.dragOverElement.before(a),b.call(this,d.dragElementIndex,d.dragOverElementIndex))}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){function b(b){var c=a.utility.createObjectURL(b.file,5e3),d=zdom("a",{href:c,download:b.fileName});document.body.appendChild(d),d.click(),$(d).remove()}function c(b,c){var d={startIndex:c||0,attObjList:[],hideAllOptions:!0,ignoreThumb:!0,ignoreEMLParsing:!0,isDataURL:!0};d.onCancel=function(){d.attObjList.forEach(function(b){b.src&&a.utility.revokeObjectURL(b.src)})},Array.isArray(b)&&b.forEach(function(b,c){var e,f=b.file,g=zmUtil.fileTyp(f.name),h={pdf:1,html:1,htm:1},i=zmUtil.isPreviewAvailable(f.name);return i.isPrev&&"FileDownload"===i.apiName?(h[g[2]]||"text/plain"===f.type||"msi-attimg"===g[1]||(f=new Blob([f],{type:"text/plain"})),e=a.utility.createObjectURL(f),void d.attObjList.push({ft:"msi-attimg"===g[1]?101:103,fn:b.fileName,src:e})):void(c<=d.startIndex&&(d.startIndex-=1))}),zmUtil.initAttSlideShow(d)}function d(b,c){var d=a.utility.createObjectURL(c,4e3);b.find(".zmImg img").attr("src",d)}function e(b){function c(a){var c=a.blob;c.name=b.find("#listView").text(),g.desktopObj[b.index()]={file:c,fileName:e.fileName},d(b,c)}var e=this.desktopObj[b.index()],f=e.file,g=this;a.imageEditTool.init({file:f,handBckObj:e,onAttach:c})}function f(a){var b=this.dialog.getCenterElem("zDesktop").find(".SC_mclst"),c=a.index(),d=this.desktopObj[c];this.desktopAttachedSize-=zmAttachUtility.parseToNumber(this.desktopObj[c].file.size||0),d.isHuge&&this.desktop.hugeFileCount--,this.desktopObj.splice(c,1),1===b.children().length?this.dialog.getCenterElem("zDesktop").find(".SC_drop").addClass("SC_dropW100"):0===c&&a.next().find(".zmFrm").find("span").addClass("sel"),a.remove()}function g(a){var b,c,d=0,e=this.filenameCountMap,f=a.lastIndexOf(".");return e[a]?(d=e[a],e[a]+=1):e[a]=1,d>0&&(c=zmUtil.fileTyp(a)[2],b=f!==-1?a.substr(0,f):a,1===d?b+="_(copy)":b=b+"_(copy"+(d-1)+")",a=c.length?b+"."+c:b),a}function h(a,b,c){var d=u.desktop,e=a.text(),f=function(c,d){a.text(c),b.find(".zmSub").find("#zmWrnMsg").text(d),b.addClass("SC_renErr"),window.setTimeout(function(){b.removeClass("SC_renErr")},2e3)};e.indexOf(">")>=0||e.indexOf("<")>=0?f(c,u.desktop.charnotallowed):e.length?(e=g.call(this,e),a.text(e),this.desktopObj[b.index()].fileName=e):f(c,d.fileNameErr)}function i(a){var b,c,d,e=!1;return a&&a.name?(d=zmUtil.fileTyp(a.name)[2],this.desktop.allowedFileType&&(c=this.desktop.allowedFileType.split(",")),"undefined"!=typeof c?(b=a.type.substr(0,a.type.lastIndexOf("/")+1)+"*",c.indexOf(a.type)>=0||c.indexOf(b)>=0||c.indexOf("."+d)>=0?e=!0:zmUtil.succErrMsg("e",this.desktop.fileTypeErr)):this.desktop.excludeType&&(this.desktop.excludeType.extension.indexOf(d)<0?e=!0:zmUtil.succErrMsg("e",zmText.applyArgs(u.desktop.attachmentPolicyErr,{filename:a.name}))),e):(zmUtil.debugLog("File name empty"),!1)}function j(a){return w[zmUtil.fileTyp(a)[2]]}function k(a,b){var c=this.configJSON.currentAttachedSize,d=zmAttachUtility.parseToNumber(a.size||0);if(c+=d,a.size<=0)return b&&zmUtil.succErrMsg("e",zmText.applyArgs(u.desktop.zero_size,{name:a.name})),{status:!1};if(c>this.configJSON.maxAttachedSize){if(d>this.configJSON.maxAttachedSize&&d<=v&&this.isHugeAttachmentUploadEnabled())return{status:!0,isHuge:!0};if(b)if(this.isHugeAttachmentUploadEnabled()&&d>v){var e=zmText.applyArgs(u.hugeAttach.errMsg.sizeExceed,{size:zmUtil.sizeConv(v)});zmUtil.succErrMsg("e",e)}else zmUtil.succErrMsg("e",u.maxSizeErr1+" "+zmUtil.sizeConv(this.configJSON.maxAttachedSize));return{status:!1}}return{status:!0,isDocs:j(a.name)&&zmail.showFeature}}function l(b,c,d){var e=i.call(this,b),f=k.call(this,b,e),g={name:c,file:b,isHuge:f.isHuge};a.core.isComposeApp.call(this)&&(g.isDocs=f.isDocs),e&&f.status?(c=c.replace(/[<>]/g,""),g.status=!0,d(g)):(g.status=!1,g["continue"]=f.status,d(g))}function m(b,c){var d,e,f=b.target||b.srcElement,g=f.files,h=g.length,i=this;for("function"!=typeof c&&(c=a.desktop.addAttachmentInDesktopTab.bind(this)),e=function(b){a.desktop.validateFile.call(i,b,b.name,function(a){a.status&&c({file:a.file,name:a.name,isHuge:a.isHuge,isDocs:a.isDocs})})},d=0;d<h;d++)e(g[d])}function n(b){var c=this;b.find(".zmFlt").on("drag",function(a){zmUtil.stopEvents(a,!0)}),b.find(".zmFlt").on("dragstart",function(b){zmUtil.stopEvents(b,!0),a.utility.fileReorder.handleDragStart.call(c,b)}),b.on("dragover",function(b){zmUtil.stopEvents(b),a.utility.fileReorder.handleDragOver.call(c,b)}),b.on("dragend",function(b){zmUtil.stopEvents(b),a.utility.fileReorder.handleDragEnd.call(c,b)})}function o(){var a=this;$("body").off("mousedown.attCmp").on("mousedown.attCmp",function(){$("body").off("mousedown.attCmp"),a.dialog&&"none"===a.dialog.$el.css("display")&&a.closeThisAppView()})}function p(){try{return new window.XMLHttpRequest}catch(a){}}function q(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}function r(){return p()||q()}function s(){return window.FormData?new window.FormData:void zmUtil.succErrMsg("e",u.desktop.upload_unsupport_browser)}function t(a){return this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(a||0),!(this.configJSON.currentAttachedSize>this.configJSON.maxAttachedSize)||(zmUtil.succErrMsg("e",u.maxSizeErr1+" "+zmUtil.sizeConv(this.configJSON.maxAttachedSize)),this.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(a||0),!1)}var u=a._i18N;a.desktop={},a.utility=a.utility||{};var v=zmAttachUtility.constants.HUGE_ATT_UPER_LIMIT,w={doc:!0,docx:!0,rtf:!0,odt:!0,xls:!0,xlsx:!0,csv:!0,ods:!0,ppt:!0,pptx:!0,odp:!0};a.utility.createXHR=function(){return window.ActiveXObject?r():p()},a.desktop.dialogDidMount=function(b,c){this.desktop.autoBrowse&&(b.$el.hide(),a.desktop.attachFromDesktopTab.call(this,!0))},a.desktop.onTabSelection=function(){this.desktopObj.length||this.desktop.autoBrowse||a.desktop.attachFromDesktopTab.call(this)},a.desktop.onPaste=function(b){var c,d,e,f,g=b.clipboardData.items,h=this;for(f=function(b){a.desktop.validateFile.call(h,b,b.name,function(b){c="ScreenShot_"+(new Date).getMilliseconds()+".png",b.status&&a.desktop.addAttachmentInDesktopTab.call(h,{file:d,name:c,isHuge:b.isHuge})})},e=0;e<g.length;++e)"file"===g[e].kind&&g[e].type.indexOf("image/")!==-1&&(d=g[e].getAsFile(),d&&(d.name||(d.name="ScreenShot_"+(new Date).getMilliseconds()+".png"),f(d)))},a.desktop.getFormData=function(b){var c=this,d=s(),e=zmAjq.getCookie("zmcsr"),f=b.file,g=b.name||f.name,h=encodeURIComponent(g);d.append("attach",f,h),a.core.isNettyUploadEnabled()||(d.append("fileName",h),d.append("zmrcsr",e));for(var i in c.desktop.requireParamToUpload)d.append(i,this.desktop.requireParamToUpload[i]);return d},a.desktop.fileUpload=function(b){var c,d,e,f,g,h,i,j,k=a.utility.createXHR(),l=a.desktop.getFormData.call(this,b),m=b.file,n=m.size,o=b.name||m.name,p=encodeURIComponent(o),q=a.core.isNettyUploadEnabled(),r=!1,s=this,v=!1;if(q&&this.desktop.uploadAPI.indexOf("checkOffline")!==-1&&(j=_zm.isWSActive()&&_zm._isPrivilegedUser(),this.desktop.uploadAPI=zmAttachComponent.getDefaultUploadAPIPath()),"undefined"==typeof l)return!1;if(!t.call(this,n))return!1;a.core.incrementAttachCount.call(this),a.core.checkAppendElePresence.call(this),q&&(k.withCredentials=!0),s.configJSON.eleId&&(c=$(zmAttachment.templates.cloudAttTempLoadingBox({name:o,image:zmAttachment.templates.attPrevInr({fn:o,thn:d})})),e="number"==typeof b.dIndex?b.dIndex:this.fromDesktopCount++,f="number"==typeof b.sIndex?b.sIndex:this.slideListCount++,c.find(".SC_icn").on("click",function(){s.deferred||(k.abort(),s.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(n||0),a.core.decrementAttachCount.call(s),a.core.addRemoveClassToParentDom.call(s),c.remove(),a.core.onRemove.call(s))}),h=zmUtil.fileTyp(o)[1],"msi-attimg"===h&&(d=a.utility.createObjectURL(m,4e3)),s.configJSON.renameSupport?"msi-attimg"!==h&&c.find('.zmSub i[data-name="showMore"]').remove():(i=c.find('.zmSub span[data-name="rename"]'),"msi-attimg"===h?i.attr("data-name","showMore").text(u.attachTemplateText.annotate):i.remove(),c.find('.zmSub i[data-name="showMore"]').remove()),c.find(".zmSub").addClass("SC_vh"),q?k.onloadstart=function(){b.$replaceEle instanceof $?b.$replaceEle.replaceWith(c):s.$ele.append(c),a.core.addRemoveClassToParentDom.call(s),a.core.onAppend.call(s)}:k.upload.addEventListener("loadstart",function(){b.$replaceEle instanceof $?b.$replaceEle.replaceWith(c):s.$ele.append(c),a.core.addRemoveClassToParentDom.call(s),a.core.onAppend.call(s)},!1),k.upload.addEventListener("progress",function(b){a.core.showProgressReq(c,b)},!1));var w=function(d){var e,f;v||(v=!0,d=d||"",e=$.parseJSON(d),s.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(n||0),a.core.decrementAttachCount.call(s),e&&e.emsg&&(f=e.emsg),_zm.succErrMsg("e",f||u.ajaxErr.attFromCloudPartialErr1),"function"==typeof b.onerror?b.onerror.call(s,c):c.remove(),a.core.onRemove.call(s),a.core.onAllUploadFinish.call(s),s.onUploadError())};k.onreadystatechange=function(){if(4===k.readyState)if(200===k.status){var d=$.parseJSON(k.responseText);if(q&&(d=d[0].resData?d[0].resData[0]:d[0].errorCode),s.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(n||0),a.core.decrementAttachCount.call(s),d.fP||1===d[0]){if(s.configJSON.eleId){if(c.data({uniqueId:d.fP}),c.find("#progressbar").parent(".zm_lbl").remove(),c.find(".zmSub").removeClass("SC_vh"),c.find(".zmSze span").text(zmUtil.sizeConv(n)),q)if(j){var h=a.virusCheckStatus[d.fP]||{};"undefined"==typeof h.value?(d.virusFree="pending",a.virusCheckStatus[d.fP]={reference:s}):(d.virusFree=h.value,h.value===!1&&a.virusAttachmentUpdate.call(s,d.fP),delete a.virusCheckStatus[d.fP])}else d.virusFree=!0;"function"==typeof b.beforeStoreTempUpdate&&(g=b.beforeStoreTempUpdate(e,f),"number"==typeof g&&(e=g)),a.core.storeTempAttachments.call(s,d,c,e,f),a.core.resolveDeferred.call(s)}"function"==typeof b.onsuccess&&b.onsuccess.call(s),s.desktop.uploadCallBack&&s.desktop.uploadCallBack(d,c)}else{if(0===d[0])_zm.succErrMsg("e",u.ajaxErr.attFromCloudPartialErr1);else if(d.emsg&&"string"==typeof d.emsg)_zm.succErrMsg("e",d.emsg.replace(/\\x20/g," "));else if(q&&d){if(!(d!==zmAttachUtility.errorConstants.authFailed&&d!==zmAttachUtility.errorConstants.emptyTicket||r)){zmUtil.validateAttachKey(!0,d);var i=a.desktop.getFormData.call(s,b);return this.open("POST",s.desktop.uploadAPI,!0),k.setRequestHeader("x-filename",p),j&&zmail.isWSEnabled&&zmail._ws&&zmail._ws.getSessionId()&&k.setRequestHeader("sId",zmail._ws.getSessionId()),k.send(i),void(r=!0)}zmAttachUtility.errorMsgs[d]?_zm.succErrMsg("e",zmAttachUtility.errorMsgs[d]):_zm.succErrMsg("e",u.ajaxErr.attFromCloudPartialErr1)}"function"==typeof b.onerror?b.onerror.call(s,c):(c.remove(),a.core.onRemove.call(s)),s.onUploadError()}a.core.onAllUploadFinish.call(s)}else 500!==k.status&&400!==k.status||w(k.responseText)},k.onerror=function(){var a=arguments[0],b="";a&&a.target&&(b=a.responseText||""),w(b)},k.open("POST",this.desktop.uploadAPI,!0),q&&(k.setRequestHeader("x-filename",p),j&&zmail.isWSEnabled&&zmail._ws&&zmail._ws.getSessionId()&&k.setRequestHeader("sId",zmail._ws.getSessionId())),k.send(l)},a.desktop.attachFromDesktopTab=function(a){var b,c=this;$("#zmAttach_file_Desktop").remove(),$("body").append(zmAttachment.templates.browseInputEle("zmAttach_file_Desktop","zmAttach_Desktop")),b=$("#zmAttach_file_Desktop"),this.desktop.multiple&&b.attr("multiple","true"),this.desktop.allowedFileType&&b.attr("accept",this.desktop.allowedFileType),b.off("change").on("change",function(b){return m.call(c,b,a),c.desktopObj.length&&c.desktop.autoBrowse&&"boolean"==typeof a&&c.dialog.$el.show(),this.value="",!1}),this.desktop.autoBrowse&&o.call(this),b.click()},a.desktop.addAttachmentInDesktopTab=function(d){var i,j,k=this,l=d.file,m=d.name||l.name,o=zmAttachUtility.parseToNumber(l.size||0),p=zmUtil.isPreviewAvailable(m),q=zmUtil.fileTyp(m,d.isHuge?zmAttachUtility.fileType.hugeAttachment:""),r=this.dialog.getCenterElem("zDesktop").find(".SC_mclst"),s=this.configJSON.maxAttachedSize,t=function(){if(m=m.replace(/[<>]/g,""),m=g.call(this,m),this.desktopObj.push({file:l,fileName:m,isHuge:d.isHuge,userPreferenceForHA:d.isHuge,isDocs:d.isDocs}),l.type.indexOf("image/")!==-1){var o=a.utility.createObjectURL(l,4e3);i=zdom("img",{src:o})}else i=zdom("i",{className:q[1]+" zm-attIcn"});var s=$(zmAttachment.templates.desktopListTemplate({name:m,size:zmUtil.sizeConv(l.size),image:i}));r.append(s),n.call(this,s),1===r.children().length&&(s.find(".zmFrm").find("span").addClass("sel"),this.dialog.getCenterElem("zDesktop").find(".SC_drop").removeClass("SC_dropW100")),j=s.find(".zmSub").find("span"),p.isPrev&&"FileDownload"===p.apiName&&"html"!==q[2]&&"htm"!==q[2]||j.eq(0).remove(),"msi-attimg"!==zmUtil.fileTyp(m)[1]&&j.eq(1).remove(),a.utility.isChrome()||a.utility.isFirefox()||a.utility.isOpera()||j.eq(2).remove(),s.click(function(a){var d=a.target||a.srcElement,g=d.id;switch(g){case"zmSubDownload":b(k.desktopObj[s.index()]);break;case"zmSubView":c(k.desktopObj,s.index());break;case"zmSubAnnotate":e.call(k,s);break;case"zmSubRemove":f.call(k,s)}});var t,u,v=s.find("#listView");v.focus(function(){var a=$(this);t=a.text(),u=t.lastIndexOf("."),u!==-1&&a.text(t.substring(0,u)),a.addClass("sel")}),v.keypress(function(a){13===a.which&&(a.preventDefault(),$(this).blur())}),v.keyup(function(a){var b;27===a.which&&(a.preventDefault(),b=u!==-1?t.substring(0,t.lastIndexOf(".")):t,v.text(b),v.blur())}),v.blur(function(){var a=$(this);u!==-1&&a.text(a.text()+t.substring(u,t.length)),s.index()&&a.removeClass("sel"),t!==a.text()&&h.call(k,a,s,t)}),$(v).on("paste",function(a){a.stopPropagation()})};if(d.isHuge)this.desktop.hugeFileCount<a.hugeAttachment.getHugeFileUploadLimit()?(this.desktop.hugeFileCount++,a.hugeAttachment.showHugeAttachmentMsgDialog.call(this,{filename:m,maxSize:s}).done(t.bind(this)).fail(function(){k.desktop.hugeFileCount--})):a.hugeAttachment.showHugeUploadLimitMessage();else{if(void 0===this.desktopAttachedSize&&(this.desktopAttachedSize=this.configJSON.currentAttachedSize),this.desktopAttachedSize+=o,this.desktopAttachedSize>s)return zmUtil.succErrMsg("e",u.maxSizeErr1+" "+zmUtil.sizeConv(s)),this.desktopAttachedSize-=zmAttachUtility.parseToNumber(l.size||0),!0;t.call(this)}};var x=function(b,c){var d=b.file,e=b.fileName||d.name,f=this,g=function(){var c={file:d,name:e};b.isHuge?a.hugeAttachment.upload.call(f,c):b.isDocs?a.zDocs.FileUploader.call(f,c):a.desktop.fileUpload.call(f,c)};c||!b.isHuge?g():a.hugeAttachment.showHugeAttachmentMsgDialog.call(this,{filename:e,maxSize:f.configJSON.maxAttachedSize}).done(g).fail(function(){})};a.desktop.uploadFiles=function(a){var b,c,d,e=this,f=!0;if(a&&(f=!1),a=a||this.desktopObj,d=a.length)for(c=0;c<d;c++)window.FormData?(b=a[c],x.call(e,b,f)):zmUtil.succErrMsg("e",u.desktop.upload_unsupport_browser);else zmUtil.succErrMsg("e",u.desktop.pleaseattach)},a.desktop.browseDesktop=function(){var b=this;a.desktop.attachFromDesktopTab.call(this,function(c){"function"==typeof b.configJSON.beforeAttach&&1===b.actionMode?b.configJSON.beforeAttach(function(){a.desktop.uploadFiles.call(b,[c])}):a.desktop.uploadFiles.call(b,[c])})},a.desktop.attachButtonHandler=function(){var b=this;this.desktopObj&&this.desktopObj.length?"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){a.desktop.uploadFiles.call(b),b.closeThisAppView()}):(a.desktop.uploadFiles.call(this),this.closeThisAppView()):zmUtil.succErrMsg("e",u.desktop.pleaseattach)},a.desktop.validateFile=l,a.utility.createFormInstance=s}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){var b=a._i18N;a.myAttachment={};var c=function(){return"xxxxxxxx-xxxy-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.floor(16*Math.random());return"x"!==a&&(b=3&b|8),b.toString(16)})},d=function(b,d){var e=this,f=this.attachTempArr.myAttachment,g=a.utility.filterMyAttachmentKey(b);g.streamsView&&(g.streamsView=!0,this.streaViewCount++),b.uuid=g.uniqueId=c(),f.push(g),this.configJSON.currentAttachedSize+=zmAttachUtility.parseToNumber(b.fs);var h=function(){if(!e.deferred){var c=f.indexOf(_.findWhere(f,{uniqueId:g.uniqueId}))||0;c>=0&&(d.remove(),e.configJSON.currentAttachedSize-=zmAttachUtility.parseToNumber(b.fs),f.splice(c,1),g.streamsView&&e.streaViewCount--,a.core.addRemoveClassToParentDom.call(e),a.core.onRemove.call(e),a.utility.modifySlideshowArray.call(e,{uuid:g.uniqueId}))}};d.data({uniqueId:g.uniqueId}),d.find(".SC_icn").off("click").on("click",h),a.core.bindTempListedAttachment.call(this,d,b,"myAttachment",g.uniqueId),a.utility.storeAttListForSlideshow.call(this,b,this.slideListCount++,"myAttachment",d)},e=function(a,b){var c=b._self;"function"==typeof c.myAttachment.onUploadSuccess&&c.myAttachment.onUploadSuccess(a,b.templateList)},f=function(a,b){var c=b._self;b.templateList.forEach(function(a){a.remove()}),"function"==typeof c.myAttachment.onUploadFailure&&c.myAttachment.onUploadFailure.apply(c,arguments)},g=function(b,c){var d=[],g=this.myAttachment.params;b.forEach(function(b){d.push(a.utility.filterMyAttachmentKey(b))},this),g.attEntObj=d,zmAjq.XHR({u:this.myAttachment.url,t:"POST",fn:e,efn:f,p:g,ep:{_self:this,templateList:c}})},h=function(c){var e,f,h,i=c.length,j=0,k=[];for(a.core.checkAppendElePresence.call(this),f=this.$ele,j=0;j<i;j++)if(h=c[j],h.attType===zmAttachUtility.fileType.hugeAttachment)e=a.hugeAttachment.constructHugeAtt(h.fn,{isUpload:!1,shType:h.shT}),f.append(e),a.hugeAttachment.hugeUploadBindAndShow(e,{size:h.size||h.fs,self:this,resp:{digest:h.digest,shType:h.shT,fName:h.fn}});else{if(e=$(zmAttachment.templates.attListingTemplate({size:zmUtil.sizeConv(h.fs),name:h.n||h.fn,image:zmAttachment.templates.attPrevInr(h)})),this.configJSON.renameSupport)101!==h.ft&&e.find('.zmSub i[data-name="showMore"]').remove();else{var l=e.find('.zmSub span[data-name="rename"]');101===h.ft?l.attr("data-name","showMore").text(b.attachTemplateText.annotate):l.remove(),e.find('.zmSub i[data-name="showMore"]').remove()}f.append(e),d.call(this,h,e),this.myAttachment&&k.push(e)}this.myAttachment&&g.call(this,c,k),a.core.addRemoveClassToParentDom.call(this),a.core.onAppend.call(this),a.core.onAllUploadFinish.call(this)},i=function(a,b){var c,d=b.attachmentID;c=this.selectedattachUtilectsArr.indexOf(_.findWhere(this.selectedattachUtilectsArr,{uniqueId:d})),c>=0&&(this.selectedattachUtilectsArr[c].n=a),c=this.orderedListOfAttachedFile.indexOf(_.findWhere(this.orderedListOfAttachedFile,{uuid:d})),c>=0&&(this.orderedListOfAttachedFile[c].n=a)},j=function(b){var c=$(b.target||b.srcElement);c.hasClass("msi-close")?a.myAttachment.modifyCheckedAttachmentArray.call(this,c.closest(".SC_fileSel").attr("data-attid")):this.configJSON.renameSupport&&a.utility.renameHelper.onRenameAction(c,c.closest(".SC_fileSel"))},k=function(b){var c=this.attachUtil.attDet[b],d=c.fn,e=$(zmAttachment.templates.selectedFile({name:d,attId:b})),f=e.find('span[data-name="filename"]');this.dialog.$el.find(".SC_PUsel_files").append(e),e.click(j.bind(this)),a.utility.renameHelper.init({context:this,$ele:f,onChange:i,handbackData:{attachmentID:b},orginalFileName:d,parentClass:"SC_fileSel"})},l=function(a){var b=this.dialog.$el.find('.SC_PUsel_files span[data-attid="'+a+'"]');b.remove(),this.dialog.getCenterElem("myAttachment").find('.zmL[data-atid="'+a+'"]').removeClass("SC_check")},m=function(){var a,b,c,d;for(c=0,d=this.selectedattachUtilectsArr.length;c<d;c++)a=this.selectedattachUtilectsArr[c].uniqueId,b=this.dialog.$el.find("div[data-atid='"+a+"']"),b.length&&b.addClass("SC_check")};a.myAttachment.toggleSelectedStatus=function(b,c){var d,e=$(c),f=$(b.target||b.srcElement),g=!0,h=f.attr("id");"thumbView"!==h&&"listView"!==h||(g=!1),g?(e.toggleClass("SC_check"),this.dialog.$el.find(".zm_attFltr").removeClass("shw"),a.myAttachment.modifyCheckedAttachmentArray.call(this,e.attr("data-atid"))):(d=this.attachUtil.attDet[f.closest(".zmL").attr("data-atid")],d&&d.constructor===Object&&zmUtil.initAttSlideShow({attObjList:[d],startIndex:0,hideAllOptions:!0}))},a.myAttachment.appendAttachment=function(a){var b,c=this;b=Array.isArray(a)?a:[a],"function"==typeof this.configJSON.beforeAttach?this.configJSON.beforeAttach(function(){h.call(c,b)}):h.call(c,b)},a.myAttachment.modifyCheckedAttachmentArray=function(a){var b=a,c=this.selectedattachUtilectsArr.indexOf(_.findWhere(this.selectedattachUtilectsArr,{uniqueId:b}));c>=0?(this.selectedattachUtilectsArr.splice(c,1),l.call(this,b)):(this.selectedattachUtilectsArr.push(this.attachUtil.attDet[b]),k.call(this,b))},a.myAttachment.onAttachHandler=function(){var c,d,e,f,g,h,i,j;if(a.utility.isAttachmentSelected(this.selectedattachUtilectsArr.length)){c=this.selectedattachUtilectsArr,d=this.configJSON.maxAttachedSize,e=this.configJSON.currentAttachedSize,f=b;var k=zmUtil.isHugeAttachmentUploadEnabled()&&a.core.isComposeApp.call(this),l=!1;for(i=0,j=c.length;i<j;i++){if(k&&c[i].attType===zmAttachUtility.fileType.hugeAttachment&&!a.hugeAttachment.isNewHugeFileUploadAllowed.call(this)){a.hugeAttachment.showHugeUploadLimitMessage(),l=!0;break}if((!k||c[i].attType!==zmAttachUtility.fileType.hugeAttachment)&&(e+=zmAttachUtility.parseToNumber(c[i].fs||0),e>d)){e-=zmAttachUtility.parseToNumber(c[i].fs||0),c=c.splice(0,i),g=d/1048576,h=j-i,zmUtil.succErrMsg("e",f.maxSizeErr1+" "+g+" "+f.maxSizeErr2+" ,"+h+" "+f.maxSizeErr3,void 0,5e3),l=!0;break}}l||(this.closeThisAppView(),a.myAttachment.appendAttachment.call(this,c))}},a.myAttachment.onListingUpdate=function(){m.call(this)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){a.zDocs={},a.zDocs.invokeZDocsComponent=function(a){var b=a.attr("id"),c=zmComponent.loadingBand({container:a[0],type:"pagination"}),d={servicename:"zmail",docsURL:"//"+zmail.urls.docsURL,container_id:b,isnewui:!0};ZDDialog.closePopUp("zdattachcontainer"),d.height=a.height()+100,d.width=a.width();var e=new MutationObserver(function(a){c(),a.forEach(function(a){"childList"===a.type&&a.addedNodes&&a.addedNodes.length&&Array.prototype.forEach.call(a.addedNodes,function(a){"zdattachcontainer"===$(a).attr("id")&&($(a).find("#mainPanelforservicefiles").css("margin","0px"),e.disconnect())})})});e.observe(a[0],{childList:!0}),ATTACHDIALOG.showAttachFileDialog(d)},a.zDocs.attachZDocsDocument=function(){var b=ATTACHDIALOG.getSelectedDocs(),c=[],d={},e=b.length;if(a.utility.isAttachmentSelected(e)){ZDDialog.closePopUp("zdattachcontainer"),this.closeThisAppView();for(var f=0;f<e;f++){var g=b[f],h={};h.docId=g.docId,h.docName=g.docName,h.docType="zw"!==g.service?g.service:"writer",c.push(h)}if(d.zohodocs=c,d=JSON.stringify(d),this.asLink){var i={};i.docObj=d,i.eprm={cmpId:zmUtil.zmsubStr(this.configJSON.componentId,"zmEdi_"),tol:e},i.loadType="link",this.configJSON.insertDocsLink(i)}else this.cloudUpload(d,e,zmUtil.zmsubStr(this.configJSON.componentId,"zmEdi_"),"z")}}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){a.gagets={},a.gagets.invokeGadgetComponent=function(a){var b,c=a.getCenterElem(),d=location.protocol+"//"+window.location.hostname,e=d,f=d,g="Cmp1",h=zmComponent.loadingBand({container:c[0],type:"pagination"});if(zmail.fromOtherService&&document.referrer){var i=document.referrer.split("/"),j=i[0]+"//"+i[2];e=j+","+d}var k=[],l=zmail.IntegrationStatus;_zm.isCloudServiceIntegEnabled&&l?(l.gDrive&&k.push("gdrive"),l.dropBox&&k.push("dropbox"),l.oneDrive&&k.push("skydrive"),l.box&&k.push("box"),k=k.length?k.join(",")+",":"",k+="evernote"):k="gdrive,dropbox,skydrive,box,evernote",b=zmail.urls.gadURL+"/CloudPicker?sources="+k+"&purpose=mailView&zservice=zmail&disableSync="+k+"&serURL=",b+=d+zmail.conPath+"/jsp/cloudPicker.jsp?cmpId="+g+"&frameorigin="+e+"&originUrl="+f;var m=$(zmAttachment.templates.cloudFrame(b));m.on("load",function(){h()}),c.append(m)}}(window.zmAttachComponent=window.zmAttachComponent||{}),function(a){function b(a){var b,c,d=!1;return c=o.TYPE.split(","),b=a.type.substr(0,a.type.lastIndexOf("/")+1)+"*",(c.indexOf(a.type)>=0||c.indexOf(b)>=0||c.indexOf("."+zmUtil.fileTyp(a.name)[2])>=0)&&(d=!0),d}function c(a){return b(a)}function d(a){return a.size<=o.MAX_SIZE}function e(a){a.find("#blkMaskWthBtn").show(),a.on("mouseover",function(){a.find("#blkMaskWthBtn").css("opacity",1)}),a.on("mouseleave",function(){a.find("#blkMaskWthBtn").css("opacity",0)})}function f(a){a.off("mouseover mouseleave")}function g(b,c){var d,f,g=$(zdom("img",null)),h=a.utility.createObjectURL(b),i=15;n=b,d=c instanceof $?c:c.getCenterElem("insertImage"),f=d.find(".SC_mclst"),g[0].onload=function(){d.find(".SC_drop.SC_dropW100").hide(),e(d),a.utility.revokeObjectURL(h)},g.attr("src",h).css({maxWidth:f.width()-i,maxHeight:f.height()-i}).addClass("upldIMG"),f.append(g)}function h(a,b){var e;c(a)?d(a)?g(a,b):(e=p.maxSizeErr1+zmUtil.sizeConv(o.MAX_SIZE),zmUtil.succErrMsg("e",e)):(e=zmText.applyArgs(p.insertImage.typeerror,{ftype:"[JPG/JPEG/PNG/GIF]"}),zmUtil.succErrMsg("e",e))}function i(a,b){var c,d,e=a.clipboardData.items;for(d=0;d<e.length;++d)"file"===e[d].kind&&e[d].type.indexOf("image/")!==-1&&(c=e[d].getAsFile(),c&&(c.name||(c.name=o.filename+".png"),h(c,b)))}function j(a){var b;$("#zmAttach_file_Desktop").remove(),$("body").append(zmAttachment.templates.browseInputEle("zmAttach_file_Desktop","zmAttach_Desktop")),b=$("#zmAttach_file_Desktop"),b.attr("accept",o.TYPE),b.off("change").on("change",function(b){var c=b.target||b.srcElement;return h(c.files[0],a),this.value="",!1}),b.click()}function k(){var b=this;a.imageEditTool.init.call(this,{file:n,onAttach:function(a){var c=b.dialog.getCenterElem("insertImage");n=a.blob,n.name=o.filename+".png",c.find(".SC_mclst img").remove(),g(n,c)}})}function l(){var a=this.dialog.getCenterElem("insertImage");a.find(".SC_mclst img").remove(),a.find("#blkMaskWthBtn").hide(),a.find(".SC_drop.SC_dropW100").show(),f(a)}function m(){var b,c,d=this,g=a.utility.createXHR(),h=new window.FormData,i=zmAjq.getCookie("zmcsr"),j=o.filename+"."+zmUtil.fileTyp(n.name)[2],k=this.insertImage.requireParamToUpload||{};this.insertImage.ignoreFileNameParam||h.append(this.insertImage.fileNameParam||"fileName",encodeURIComponent(j)),h.append(this.insertImage.imgFileParamName||"attach",n,j),h.append("zmrcsr",i);for(c in k)k.hasOwnProperty(c)&&h.append(c,k[c]);b=function(){var a=d.dialog.getCenterElem("insertImage");a.find("#uploadMask").hide(),e(a)},g.upload.addEventListener("loadstart",function(){var a=d.dialog.getCenterElem("insertImage");q=!0,a.find("#uploadMask").show(),a.find("#progressIndicator").width("1%"),f(a)},!1),g.upload.addEventListener("progress",function(a){var b=Math.round(100*a.loaded/a.total);d.dialog.getCenterElem("insertImage").find("#progressIndicator").width(b+"%")},!1),g.onreadystatechange=function(){if(4===g.readyState){if(200===g.status){var a=$.parseJSON(g.responseText);q=!1,a.fP||a.storeName||1===a[0]?(d.insertImage.onUpload(a),d.closeThisAppView()):"string"==typeof a.emsg?(d.dialog.showSuccErrMsg("e",a.emsg.replace(/\\x20/g," ")),b()):(d.dialog.showSuccErrMsg("e",p.insertImage.inserterror),b())}}else 500!==g.status&&400!==g.status||(q=!1,d.dialog.showSuccErrMsg("e",p.insertImage.inserterror),b())},g.open("POST",this.insertImage.uploadAPI,!0),g.send(h)}a.insertImage={};var n,o={MAX_SIZE:3145728,TYPE:".png,.jpg,.jpeg,.gif",filename:"inline"},p=zmText.get("attachComponent"),q=!1;return a.insertImage.clear=function(){n=void 0,q=!1},a.insertImage.getTabConfig=function(a){var b=this,c={id:"insertImage",text:p.cloudServiceName.insertImage,tabName:"insertImage",selected:a,listingArea:{classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$(zdom("div",{className:"SCmc SC_attachviewer"}))},buttons:[{text:p.button.insert,onClk:function(){q||(n?m.call(b):zmUtil.succErrMsg("e",p.insertImage.pleaseattach))}}]};return c},a.insertImage.dialogDidMount=function(a){var b=a.getCenterElem("insertImage");b.append(zmAttachment.templates.dragdropArea()),b.find(".SC_mclst").append(zmAttachment.templates.insertImageMaskBtn(),zmAttachment.templates.blackMask())},a.insertImage.pasteHandler=function(){var a;arguments[0]instanceof window.Blob?(a=arguments[0],a.name||(a.name=o.filename+".png"),h(a,arguments[1])):i(arguments[0],arguments[1])},a.insertImage.bindEventsToTab=function(b){function c(a){var c=a[0];h(c,b)}var d,e=b.getCenterElem("insertImage");e.find(".SC_drop").click(function(){j(b)}),a.utility.setDragDrop({onDrop:c,onDragLeave:function(){},onDragover:function(){},$centerEle:b.getCenterElem("insertImage"),$dropMsgEle:b.getCenterElem("insertImage")}),d=e.find("#blkMaskWthBtn .blkMaskBtn"),d.eq(0).on("click",k.bind(this)),d.eq(1).on("click",l.bind(this)),this.insertImage.type&&(o.TYPE=this.insertImage.type),this.insertImage.maxSize&&(o.MAX_SIZE=this.insertImage.maxSize)},a.insertImage.isUploading=function(){return!0},a}(window.zmAttachComponent=window.zmAttachComponent||{}),define([],function(a){var b=a("zmAttachComponent._i18N"),c=a("_zm"),d=a("zmUtil"),e=a("zmAttachComponent.utility"),f=a("zmAttachComponent.core"),g=a("zmail.Core.Namespaces"),h=a("zmAdHocSettings"),i=g.create("zmAttachComponent.hugeAttachment"),j=1,k=function(b){return a("zmAttachUtility").parseToNumber(b||0)},l=function(a){return window.encodeURIComponent(a)},m=function(b){return a("zmAttachment").templates.hugeAttachmentTemplate(b)},n=function(){var b=function(a){a&&a.digest&&this.hugeAttachment.attachedFiles.push(a)},c=function(b){var c=this.hugeAttachment.attachedFiles.indexOf(a("_").findWhere(this.hugeAttachment.attachedFiles,{digest:b}));c>=0&&(this.hugeAttachment.attachedFiles.splice(c,1),f.addRemoveClassToParentDom.call(this),f.onRemove.call(this))},d=function(){return this.hugeAttachment.attachedFiles},e=function(b,c){var d=this.hugeAttachment.attachedFiles.indexOf(a("_").findWhere(this.hugeAttachment.attachedFiles,{digest:b}));d>=0&&(this.hugeAttachment.attachedFiles[d].shType=c)};return{push:b,"delete":c,get:d,updateShType:e}}(),o=function(a){var b,c=document.getElementById("zmhgdwnldfile");b=zmail.urls.downloadurl+"/download?digest=",c&&c.parentElement.removeChild(c),c=document.createElement("iframe"),c.id="zmhgdwnldfile",c.style.display="none",c.src="https://"+b+a+"&isRebrandUser="+zmail.isRebranded,$("body").append(c)},p=function(e,f,g,h){var i="&digest="+String(f),j=this;e&&(i="&attachId="+e);var k=new XMLHttpRequest;k.open("GET","https://"+zmail.urls.downloadurl+"/delete?isRebrandUser="+zmail.isRebranded+i,!0),k.withCredentials=!0,k.onreadystatechange=function(){if(k.readyState===XMLHttpRequest.DONE){var e=JSON.parse(k.responseText);if(e[0]&&e[0].errorCode){var i=a("zmAttachUtility"),l=e[0].errorCode;l!==i.errorConstants.authFailed&&l!==i.errorConstants.emptyTicket||d.handleNettyDownloadError(l);var m=i.errorMsgs[l];return c.succErrMsg("e",m?m:b.hugeAttach.errMsg.errSize),"error"}g&&(g.remove(),n["delete"].call(j,f)),h&&(h.fn("success",h.eprm),d.succErrMsg("s",b.hugeAttach.errMsg.delSucc))}},k.send()},q=function(c,d){var e=this,f={title:b.hugeAttach.permissionDialog.changePermission,$content:a("zmAttachment").templates.constructPermission(!1),buttons:[{name:b.button.ok,callback:function(a){var f=a.$els.$content,g="",h="",i=b.hugeAttach,j=f.find(".permElem"),k=j.find("input[checked]").parent();k.hasClass("publicElm")?(n.updateShType.call(e,c,1),g="public",h=i.hugeOpts.anyone):k.hasClass("pvtElm")&&(n.updateShType.call(e,c,0),g="private",h=i.hugeOpts.recOpt);var l=d.find(".changeOpt");l[0].childNodes[0].textContent=h,l.parents("b").data("val",g),a.remove()}},{name:b.button.cancel,isCancel:!0,callback:function(a){a.remove()}}],dialogDidMount:function(a){var b=a.$els.$content,c=d.find(".optParent").find("b"),e=c.data("val"),f=b.find(".permElem");f.find("input").removeAttr("checked"),"private"===e?b.find(".pvtElm > input").attr("checked",!0):"public"===e&&b.find(".publicElm > input").attr("checked",!0),f.bind("click",function(){f.find("input").removeAttr("checked");
var a=$(this);a.find("input").attr("checked",!0)})}};a("Dialog")["new"](f)},r=function(a){var b=this;a.find(".SC_icn").off("click"),a.off("click").on("click",function(a){var c=$(a.target),d=c.closest(".zmL"),e=d.data("digest");c.hasClass("msi-close")||c.hasClass("SC_icn")?p.call(b,d.data("attachId"),e,d):c.hasClass("selOpt")||c.parents().hasClass("selOpt")?q.call(b,e,d):o(e)})},s=function(a){var b=h.getAttachComp();b&&b.hugeAttPref!==a&&h.setAttachComp({hugeAttPref:a})},t=function(c,e){var g=d.fileTyp(c,a("zmAttachUtility").fileType.hugeAttachment),h=$(m({fn:c,cls:g[1]}));if(h.find(".closeIcon").on("click",function(){if(h.remove(),e.isUpload){var a=e.xhr,b=e.self;a.abort(),b.hugeAttachment.isHugeUploadInProgress--,f.decrementAttachCount.call(b),f.addRemoveClassToParentDom.call(b),f.onRemove.call(b)}}),1===e.shType){var i=h.find(".changeOpt");i[0].childNodes[0].textContent=b.hugeAttach.hugeOpts.anyone,i.parents("b").data("val","public")}return h},u=function(c){var e=c.resp,f=c.attObj;if(_.size(e)){var g={title:b.hugeAttach.permissionDialog.changePermission,$content:a("zmAttachment").templates.constructPermission(!0,e),buttons:[{name:b.button.ok,callback:function(a){var c=a.$els.$buttonContainer[0].childNodes[0];if(!$(c).hasClass("reqLock")){$(c).addClass("reqLock"),$(c).text("Changing...");for(var e,g=function(){d.succErrMsg("s","Permission changed successfully"),a.remove()},h=function(a){$(c).text(b.button.ok),$(c).removeClass("reqLock"),d.succErrMsg("e","Error occurred")},i=a.$els.$content,j=i.find("input"),k=0;k<j.length;k++)if($(j[k]).prop("checked")){e=$(j[k]).parent().data("val");break}zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",fn:g,p:{mode:"shr",entityType:11,attachId:f.Id,shType:e},efn:h})}}},{name:b.button.cancel,isCancel:!0,callback:function(a){a.remove()}}],dialogDidMount:function(b){var c=b.$els.$content,d=c.find(".permElem"),f=e.sharedUsers,g=e.sharedGroups,h=e.type,i=a("zmAttachUtility").constants;d.find("input").removeAttr("checked"),h===i.share_private||g||f?c.find(".pvtElm > input").attr("checked",!0):h===i.share_public?c.find(".publicElm > input").attr("checked",!0):h===i.share_org&&c.find(".orgElm > input").attr("checked",!0),d.bind("click",function(){d.find("input").removeAttr("checked");var a=$(this);a.find("input").attr("checked",!0)})}};a("Dialog")["new"](g)}},v=function(a){zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",fn:function(b){u({attObj:a,resp:b})},p:{mode:"getSharedUsers",attachId:a.Id}})},w=function(a,b){var c=b.size,e=b.self,f=b.resp;a.find(".zm_lbl").remove(),a.find(".fileSize").text(d.sizeConv(c)),a.find(".showOpt").removeClass("SC_dyn"),f&&a.data({digest:f.digest,attachId:f.attachId}),r.call(e,a),n.push.call(e,f),f.shType&&n.updateShType.call(e,f.digest,f.shType),e.onAddAttachment(e,f,a,"hugeAttachment")},x=function(g){var h,i=e.createXHR(),j=e.createFormInstance(),m=g.file,n=g.name||m.name,o=k(m.size),p=l(n),q=this,r=!1;this.hugeAttachment.isHugeUploadInProgress++,f.incrementAttachCount.call(this),f.checkAppendElePresence.call(this),j.append("attach",m,p),i.withCredentials=!0,this.configJSON.eleId&&(h=t(n,{isUpload:!0,xhr:i,self:q}),i.onloadstart=function(){g.$replaceEle instanceof $?g.$replaceEle.replaceWith(h):q.$ele.append(h),f.addRemoveClassToParentDom.call(q),f.onAppend.call(q)},i.upload.addEventListener("progress",function(a){f.showProgressReq(h,a)},!1));var s=function(e){var g,i;if(!r){if(r=!0,q.hugeAttachment.isHugeUploadInProgress--,e=e||"",g=$.parseJSON(e),f.decrementAttachCount.call(q),g&&g[0]&&g[0].errorCode){g=g[0];var j=a("zmAttachUtility").errorMsgs[g.errorCode];j?d.succErrMsg("e",j):d.succErrMsg("e",b.hugeAttach.errMsg.errSize)}else i=g&&g.emsg?g.emsg:b.ajaxErr.attFromCloudPartialErr1,c.succErrMsg("e",i);h.remove(),f.onRemove.call(q),q.onUploadError()}};i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var a=$.parseJSON(i.responseText);f.decrementAttachCount.call(q),q.hugeAttachment.isHugeUploadInProgress--,Array.isArray(a)&&Array.isArray(a[0].resData)?(a=a[0].resData[0],a.shType=0,q.configJSON.eleId&&(w(h,{size:o,resp:a,self:q}),a.fName=n,delete a.attachId)):(h.remove(),f.onRemove.call(q),q.onUploadError())}else 500!==i.status&&400!==i.status||s(i.responseText)},i.onerror=function(a){var b=arguments[0],c="";b&&b.target&&(c=b.responseText||""),s(c)},i.open("POST","https://"+zmail.urls.uploadurl+"/upload?isRebrandUser="+zmail.isRebranded,!0),i.send(j)};return i.showHugeUploadLimitMessage=function(){d.succErrMsg("e",b.hugeAttach.errMsg.oneHugeErr)},i.isNewHugeFileUploadAllowed=function(){return!!this.hugeAttachment&&!this.hugeAttachment.isHugeUploadInProgress},i.getHugeFileUploadLimit=function(){return j},i.showHugeAttachmentMsgDialog=function(c){var e=$.Deferred(),f=h.getAttachComp(),g=!1;if(i.isNewHugeFileUploadAllowed.call(this))if($.isEmptyObject(f)||!f.hugeAttPref||"askMe"===f.hugeAttPref)if(i.isPreferenceDialogOpen)i.queuePreferenceCallback.push(e);else{var j=b.hugeAttach.alertDialog,k=zmText.applyArgs(j.content,{filename:c.filename,size:d.sizeConv(c.maxSize)}),l=[];l.push(zdom("div",null,zdom("font",null,k+" "+j.contentTitle),zdom("br",null),zdom("br",null),zdom("div",null,zdom("i",{className:"msi-uncheck"}),j.remChoice))),$(l).find(".msi-uncheck").click(function(){var a=$(this);a.hasClass("msi-uncheck")?(a.attr("class","msi-check"),g=!0):(a.attr("class","msi-uncheck"),g=!1)});var m={title:j.header,$content:l,buttons:[{name:j.yes,callback:function(a){e.resolve(),i.queuePreferenceCallback.forEach(function(a){a.resolve()}),a.remove(),g&&s("yes")}},{name:j.no,isCancel:!0,callback:function(a){e.reject(),i.queuePreferenceCallback.forEach(function(a){a.reject()}),a.remove(),g&&s("no")}}],dialogDidMount:function(){i.isPreferenceDialogOpen=!0},closeAction:function(){i.isPreferenceDialogOpen=!1,i.queuePreferenceCallback=[],"pending"===e.state()&&e.reject(),i.queuePreferenceCallback.forEach(function(a){"pending"===a.state()&&a.reject()})}};i.queuePreferenceCallback=[],a("Dialog")["new"](m)}else if("yes"===f.hugeAttPref)e.resolve();else{e.reject();var n=zmText.applyArgs(b.hugeAttach.errMsg.settingSuggestion,{size:d.sizeConv(c.maxSize)});d.succErrMsg("e",n)}else i.showHugeUploadLimitMessage(),e.reject();return e.promise()},i.upload=function(a){return this.hugeAttachment&&!this.hugeAttachment.isHugeUploadInProgress?void x.call(this,a):void i.showHugeUploadLimitMessage()},i.showMoreOptions=function(a,c){var e,f=$(c),g=[];g.push({htm:b.UserMsg.attachToNewMail,data:{action:"attachToMail"}}),$(c).closest(".zmL, .zmAch").addClass("sel"),$(c).addClass("active");var h=function(b,c){var f=b.action;switch(e.remove(),f){case"attachToMail":d.openComposeWithAtt([a]),d.hideMenu()}},i={divId:"hugeAttachMenu",par:f,parWidth:!0,list:g,clk:function(a,b){h(a,b)},onHide:function(){$(c).parents(".zmL.zmAch").removeClass("sel"),$(c).removeClass("active")},showArrow:!0};if(d.isChildWindow()){var j=new zmDropDownMenu;j.setDropObj(i),j.paint(),e=j}else e=zmsuite.showMenu(i)},i.constructHugeAttHeader=function(c){var d=a("zmAttachment").templates.mailHugeTemplate(zmText.applyArgs(b.hugeAttach.hugeHeader,{num:c}));return d},i.constructHugeAttList=function(b){var e=b.name,f=b.digest,g=b.size,h=d.fileTyp(e,a("zmAttachUtility").fileType.hugeAttachment),j=a("zmAttachment").templates.mailListTemplate({fn:e,cls:h[1],size:d.sizeConv(g)});return $(j).unbind("click").bind("click",function(){i.downloadFile(f)}),$(j).find(".download").unbind("click").bind("click",function(a){a.stopPropagation(),i.downloadFile(f)}),$(j).find(".copyLink").unbind("click").bind("click",function(a){a.stopPropagation(),i.copyPermaLink(b.attObj)}),$(j).find(".moreAction").unbind("click").bind("click",function(a){c.stopEvents(a),i.showMoreOptions(b.attObj,$(this))}),j},i.copyPermaLink=function(c){var e="",f=b.hugeAttach.copyLink;if(c)e=c.digest;else{var g=n.get.call(this);e=g[0]?g[0].digest:""}var h="https://"+zmail.urls.downloadurl+"/download?digest="+e;if(zmComponent.clipBoardAPI.isSupported())zmComponent.clipBoardAPI.setData(h,{type:"text",onSuccess:function(){d.succErrMsg("s",f.succMsg)}});else{var i={title:f.title,$content:a("zmAttachment").templates.showCopyLink(h),dialogWillMount:function(a){setTimeout(function(){$(a.$els.$contentWrapper).find("input").select()},500),$(a.$els.$content).filter(".SC_PUcen").css({"font-size":"13px",color:"grey"})}};a("Dialog")["new"](i)}},i.downloadFile=o,i.constructHugeAtt=t,i.hugeUploadBindAndShow=w,i.deleteFile=p,i.getListAndEditPerm=v,i});
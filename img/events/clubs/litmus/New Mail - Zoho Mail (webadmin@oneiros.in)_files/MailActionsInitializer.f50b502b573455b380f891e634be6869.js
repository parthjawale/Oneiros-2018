"use strict";!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.MailAction.Initializer"),c=zmText.get("MailActionsInitializer"),d=ZMail.lConstants,e=d.cls;b.doActions=function(a,b,c){zmmailAct.doActions(a,b,c)},b.applyActions=function(a,b,c){zmmailAct.applyActions(a,b,c)},b.rapplyActions=function(a,b){zmmailAct.rapplyAction(a,b)},b.rdoActions=function(a,b){zmmailAct.rdoAction(a,b)},b.handleWMSEvents=function(a,c,d){var e,f,g,h,i,j,k;if(k=d.AID||c.AID,e=zmail.isWSEnabled?["MOVE_MAIL","MARK_FLAGGED"]:["moveMail","markFlagged"],e.indexOf(a)!==-1&&k===zmail.accId)if("moveMail"===a||"MOVE_MAIL"===a){var l=d.FD&&"null"!==d.FD?d.FD:"",m="move";if(g=d.MLIST||[],f=[],!g.length)return;var n=g[0].SFID;if(n&&!l&&(l=n,m="archive"),l===zmail.folId.tId&&""!==zmfolAction.getEmptyFolderStatus(n))return;for(h in g)i=g[h].M||"",j=zmList.getMailObj(i),i&&"null"!==i&&j&&("move"===m&&j.FD!==l||"archive"===m&&j.FD===l&&!j.AR)&&f.push(String(i));if(!f.length)return;b.rdoActions({result:"success"},{action:m,mailId:f,folId:l,from:"notifier"})}else if("markFlagged"===a||"MARK_FLAGGED"===a){g=d.MLIST,f=[];var o="1"===d.S?"read":"unread",p=d.S;if("string"==typeof g&&(g=g.split(",")),g=g||[],!g.length)return;for(h in g)i=g[h]||"",j=zmList.getMailObj(i),i&&"null"!==i&&j&&p!==String(j.S)&&f.push(String(g[h]));if(!f.length)return;b.rapplyActions({result:"success"},{action:o,mailId:f})}},b.mailShareTip=function(){var a={lbl_dontshow:c.sharemailtipdialog.dontshow,lbl_diagtitle:c.sharemailtipdialog.didyouknow,txt_tipmessage:c.sharemailtipdialog.tipmessage,lbl_dialog_ok:c.sharemailtipdialog.gotit},b="share-mail-tip-dialog",d=['<div id="'+b+'" style="">','<div class="paraDiv">','<span x-id="message">'+a.txt_tipmessage+"</span>","<div>",'<span x-id="checkbox-holder" style="margin-left: 5px; cursor: pointer;">','<i x-id="checkbox" class="msi-uncheck" style="margin-right: 5px;"></i>',a.lbl_dontshow,"</span>","</div>","</div>","</div>"].join(""),e=$(d),f=e.find("[x-id=checkbox]"),g=e.find("[x-id=checkbox-holder]");e.find("[x-id]").removeAttr("x-id");var h=!1,i=function(){f.toggleClass("msi-check").toggleClass("msi-uncheck"),h=f.hasClass("msi-check")},j=function(){zmsDialog.remove(),$("#"+b).remove()},k=function(){if(h){var a=zmAdHocSettings.getSuppressedMessagesState();a.mailShareTip="off",zmAdHocSettings.setSuppressedMessagesState(a),h=!1,f.removeClass("msi-check").addClass("msi-uncheck")}j()},l={style:{width:"500px"},buttons:[{txt:a.lbl_dialog_ok,callback:k,selected:!0}],mask:!0,hideclose:!1,pos:"center",title:a.lbl_diagtitle,closeaction:function(){$("#"+b).remove()}},m=function(){e.hide(),e.appendTo(document.body),zmsDialog.create(b,l),e.show(),g.off().on("click",i)};return{show:function(){zmUtil.isZohoAccount(zmail.accId)&&zmail.isOrg&&m()}}}(),b.notifyBulkAction=function(a){var b,d=a.bulk,e="",f="",g="",h=zmUtil.getFolId(),i="";if(d){zmInit.getFolderTreeCount(),d.indexOf("'")!==-1&&(d=d.replace(/'/gi,'"')),d=$.parseJSON(d);var j={SEARCH:{text:c.filterview.search,id:"search"},FOLDER:{text:zmInit.findFolName(d.fId)+" "+c.filterview.folder,id:d.fId},LABEL:{text:zmUtil.findTagName(d.label)+" "+c.filterview.tagview,id:d.label},UNREAD:{text:c.filterview.unreadview,id:"unread"},ALLMESSAGE:{text:c.filterview.allmsgview,id:"all"},FLAGED:{text:c.filterview.flagview,id:"flag"}};switch(b=d.action,f=d.view,g=j[f].text,i=j[f].id,"SEARCH"===f||zmPrev.prevDetails("zm_Container").msgId||h===i&&$.publish("/mail/listMails",{}),b){case"READ":e=zmText.applyArgs(c.bulkaction.view.readcomplete,{viewtype:g});break;case"UNREAD":e=zmText.applyArgs(c.bulkaction.view.unreadcomplete,{viewtype:g});break;case"MOVE_TO":var k=d.actionList,l=zmInit.findFolName(k);e=zmText.applyArgs(c.bulkaction.view.movecomplete,{destinationfolder:l,viewtype:g});break;case"SPAM":e=zmText.applyArgs(c.bulkaction.view.spamcomplete,{viewtype:g});break;case"NOTSPAM":e=zmText.applyArgs(c.bulkaction.view.notspamcomplete,{viewtype:g});break;case"LABEL":var m=d.actionList,n=zmUtil.findTagName(m);e=zmText.applyArgs(c.bulkaction.view.tagadded,{tagname:n,viewtype:g});break;case"UNLABEL":m=d.actionList,n=zmUtil.findTagName(m),e=zmText.applyArgs(c.bulkaction.view.tagremoved,{tagname:n,viewtype:g});break;case"FLAG":case"CLEAR_FLAG":var o=parseInt(d.actionList);switch(o){case 0:e=zmText.applyArgs(c.bulkaction.view.clearflag,{viewtype:g});break;case 1:e=zmText.applyArgs(c.bulkaction.view.infoflag,{viewtype:g});break;case 2:e=zmText.applyArgs(c.bulkaction.view.impflag,{viewtype:g});break;case 3:e=zmText.applyArgs(c.bulkaction.view.followupflag,{viewtype:g})}break;case"DELETE":case"DELETE_FROM_SPAM":case"DELETE_FROM_TEMPLATE":case"DELETE_FROM_DRAFT":case"DELETE_FROM_TRASH":e=zmText.applyArgs(c.bulkaction.view.deletecomplete,{viewtype:g});break;case"ARCHIVE":e=zmText.applyArgs(c.bulkaction.view.archivecomplete,{viewtype:g});break;case"UNARCHIVE":e=zmText.applyArgs(c.bulkaction.view.unarchivecomplete,{viewtype:g})}zmUtil.succErrMsg("s",e)}else if(a.sweep){switch(d=a.sweep,zmInit.getFolderTreeCount(),d.indexOf("'")!==-1&&(d=d.replace(/'/gi,'"')),d=$.parseJSON(d),b=d.action){case"DELETE":e=c.bulkaction.sweep.deletecomplete;break;case"ARCHIVE":e=c.bulkaction.sweep.archivecomplete}zmUtil.succErrMsg("s",e)}},b.flagMail=function(a,b){var c,e,f={};e=a.parents("."+d.cls.mRow),c=e[0].id,c.indexOf("t")!==-1?(f.thd=[zmInit.zmsubStr(c,"t")],f.msgId=[]):(f.msgId=[c],f.thd=[]),f.fVal=b,zmail.MailAction.Initializer.applyActions("flag","click",f)},b.setFlag=function(a,c){var d=c.flag;a.css("visibility",""),b.flagMail(a,d),zmUtil.hideMenu()},b.delMail=function(a){var b,c=a.parents("."+d.cls.mRow).attr("id");b=c.indexOf("t")?{msgId:[c],thd:[]}:{thd:[c.substring(1,c.length)],msgId:[]},zmail.MailAction.Initializer.doActions("delete","mail",b)},b.delMailFromContextMenu=function(a,b){var c;a&&""!==a&&(c=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},c.actionSrc=b,zmail.MailAction.Initializer.doActions("delete","mail",c))},b.markSpamFromContextMenu=function(a,b){var c;a&&""!==a&&(c=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},c.actionSrc=b,zmail.MailAction.Initializer.doActions("spam","mail",c))},b.markNotSpamFromContextMenu=function(a,b){var c;a&&""!==a&&(c=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},c.actionSrc=b,zmail.MailAction.Initializer.doActions("notspam","mail",c))},b.markAsReadUnread=function(a){var b,c={};a=a.parents("."+d.cls.mRow),b=$(a)[0].id,b.indexOf("t")!==-1?(c.thd=[zmInit.zmsubStr(b,"t")],c.msgId=[]):(c.msgId=[b],c.thd=[]),a.hasClass(e.unread)?zmail.MailAction.Initializer.applyActions("read","dropdown",c):zmail.MailAction.Initializer.applyActions("unread","dropdown",c)}}();
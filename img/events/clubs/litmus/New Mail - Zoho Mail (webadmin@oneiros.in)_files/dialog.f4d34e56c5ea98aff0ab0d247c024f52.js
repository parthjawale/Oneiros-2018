"use strict";define([],function(a){var b,c,d=a("zmail.Core.Namespaces"),e=a("_zm"),f=a("zmText"),g=d.create("zmsDialog"),h=new zmail.Navigator({onEscape:function(){g.remove()}}),i=function(a){a.$el&&a.$el.addClass("sel")},j=function(a){a.$el&&a.$el.removeClass("sel")},k=function(a){var b=h.dom;a=a||[],a.forEach(function(a,c){h.focused<0&&(h.focused=a.selected?c:-1),b.push({isArrowKeyAllowed:!0,$el:a.$el,onFocus:i,onBlur:j,onEnter:a.callback})}),h.setThisAsCurrentNavigator()},l={conBtn:function(a){var b,c,d,e=0;for(a&&(e=a.length),d=$("<div class='SC_PUbtm'/>"),b=0;b<e;b++)c=$("<span/>"),a[b].$el=c,c.html(a[b].txt),c.on("click",a[b].callback),a[b].selected?c.addClass("sel"):a[b].isCancel&&c.attr("data-val","Cancel"),d.append(c);return d},conPtr:function(a){var b=$("<div/>");return"top"===a?b.addClass("SC_arr SC_arrt"):"tleft"===a?b.addClass("SC_arr SC_arrtl"):"tright"===a?b.addClass("SC_arr SC_arrtr"):"bottom"===a?b.addClass("SC_arr SC_arrb"):"bleft"===a?b.addClass("SC_arr SC_arrbl"):"bright"===a&&b.addClass("SC_arr SC_arrbr"),b}},m={dragMove:function(a,d){var e,f,h,i,j=$("#zmsdialog_"+g.elemId);h=a.pageX,i=a.pageY,e=h-b,f=i-c,d(j,e,f,h,i),b=h,c=i},setDrag:function(a,d){a.on("mousedown",function(a){b=a.pageX,c=a.pageY,a.preventDefault(),$(document).mousemove(function(a){m.dragMove(a,d)}),$(document).mouseup(function(){$(document).off("mousemove")})})},movePopup:function(a,b,c){var d=$(document.body).width(),e=$(document.body).height(),f=a.width(),g=a.height(),h=a.offset();h.left+b<=0?a.css("left","0px"):h.left+f+b>=d?a.css("left",d-f+"px"):a.css("left",h.left+b+"px"),h.top+c<=0?a.css("top","0px"):h.top+g+c+13>=e?a.css("top",e-g-13+"px"):a.css("top",h.top+c+"px")},resPopup:function(a,b,c,d,e){var f=$(document.body).width(),g=$(document.body).height(),h=a.width(),i=a.height(),j=a.offset();d+b>=f?a.width(f-j.left):a.width(b+h),e>=g?a.height(g-j.top-13):a.height(c+i)}},n={elemId:null,create:function(b,c){var d,e,h,i,j,n,o,p,q,r,s,t,u,v,w="",x="",y="",z=0,A=void 0===c.defaultNavigator||c.defaultNavigator;if(this.elemId=b,this.closeaction=c.closeaction,this.options=c,t="SC_Pop ",$("#zmsdialog_zm_AlertText")&&$("#zmsdialog_zm_AlertText").remove(),c.customClass&&(t+=" "+c.customClass),c.style)for(var B in c.style)x+=B+":"+c.style[B]+";";if(c.posParent||(t+=" SC_cent"),$("#zmsdialog_"+b).length)return $("#zmsdialog_"+b).attr("style",x),void $("#zmsdialog_"+b).show();if(w+='<div class="'+t+'"><div class="SC_pe"><div id="zmsdialog_'+b+'" class="SC_PU">',w+='<div id="zmsdialogcont_'+b+'" class="SC_PUcen"></div></div></div></div>',$("#"+b).wrap(w),o=$("#zmsdialog_"+b),o.attr("style",x),c.posParent&&o.parents(".SC_Pop").css(c.posParent),c.stopPropagation&&o.on("mousedown",function(b){a("zmUtil").stopEvents(b)}),c.title){y+='<div class="SC_PUtt"><h3>';var C="hdr_actions",D=c[C];if(D)for(var E=0,F=D.length;E<F;E++)y+='<i class="SC_lnk">'+D[E].text+"</i>";else{var G=f.get("dialog").tooltip.close;y+='<div class="SCmb"><div class="SC_frt"><ul><li><b><div class="SC_hd"></div><span data-tooltip="'+G+'" class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div></div>'}y+=c.title,y+="</h3></div>",$("#zmsdialogcont_"+b).before(y)}if(c.buttons&&c.buttons.length&&(d=l.conBtn(c.buttons),$("#zmsdialogcont_"+b).after(d)),A&&k(c.buttons),c.hideButtons&&$("#zmsdialog_"+b).find(".SC_PUbtm").addClass("SC_vh"),c.bottom&&$("#zmsdialogcont_"+b).after("<div class='SC_PUbtm'>"+c.bottom+"</div>"),c.ptr&&$("#zmsdialogcont_"+b).after(l.conPtr(c.ptr)),c.res){var H=$("<div/>");H.css({position:"absolute",bottom:"0px",right:"0px",width:"10px",height:"10px",background:"grey"}),$("#zmsdialogcont_"+b).after(H),m.setDrag($("#zmsdialog_"+b+" div"),m.resPopup)}o.show(),$("#"+b).show(),setTimeout(function(){c.mask?o.parents(".SC_Pop").addClass("wht"):o.parents(".SC_Pop").addClass("tra"),c.afterDisplay&&setTimeout(function(){c.afterDisplay()},100)},500),n=$(document.body),p=n.height(),q=n.width(),r=o.height(),s=o.width(),c.pos&&("center"===c.pos?(e=p/2-r/2,h=q/2-s/2):"tleft"===c.pos?(e="10%",h="10%"):"tcenter"===c.pos?(e="10%",h=q/2-s/2):"tright"===c.pos?(e="10%",i="10%"):"mleft"===c.pos?(h="10%",e=p/2-r/2):"mright"===c.pos?(i="10%",e=p/2-r/2):"bleft"===c.pos?(h="10%",e=.9*(p-r)):"bcenter"===c.pos?(e=.9*(p-r),h=q/2-s/2):"bright"===c.pos?(e=.9*(p-r),i="10%"):"onevent"===c.pos&&(j=c.onelem.offset(),e=j.top+c.onelem.height()+3,h=j.left,e+r>p&&(e=p-r-20),h+s>q&&(h=q-s-20))),o.css("top",e),h?o.css("left",h):o.css("right",i),u=o.find(".SC_PUtt").height()||0,z&&(z=d.height()||0),p=$(document.body).height(),window.isFinite(c.heightPercent)&&(c.heightPercent=window.parseInt(c.heightPercent),p*=c.heightPercent/100),v=p-(u+z+100),c.notToSetMaxHeight||$("#zmsdialogcont_"+b).css("max-height",v+"px"),c.hideclose?$("#zmsdialog_"+b+" .SC_PUtt i.msi-close").hide():$("#zmsdialog_"+b+" .SC_PUtt i.msi-close").closest("span").click(function(){g.remove()}),c.drag&&m.setDrag($("#zmsdialog_"+b).children(":first"),m.movePopup),c.posParent&&$.publish("/mail/menuCreated",[{element:o.parents(".SC_Pop")[0],menuHandler:this.remove.bind(this)}])},remove:function(a){var b=this,c=$("#"+g.elemId);h.clearTrace(),c.parents(".SC_Pop").removeClass("wht tra"),setTimeout(function(){var c,d=g.elemId;$("#"+d).hide(),c=$("#zmsdialogcont_"+d).contents(),$("#zmsdialog_"+d).parents(".SC_Pop").replaceWith(c),$("#zmsMask").remove(),b.closeaction&&(a||b.closeaction(),b.closeaction=null),g.elemId=null,$.publish("zm/framework/dialogClosed",{id:d})},500)},hide:function(){var a=$("#"+g.elemId);a.parents(".SC_Pop").removeClass("wht tra"),setTimeout(function(){$("#zmsdialog_"+g.elemId).parents(".SC_Pop").hide(),$("#zmsMask").remove()},500)},succErrMsg:function(a,b,c){c=c||{},c.parElem=c.parElem||$("#"+g.elemId)[0],e.succErrMsg(a,b,c)},showButtons:function(){$("#zmsdialog_"+g.elemId).find(".SC_PUbtm").removeClass("SC_vh")},hideButtons:function(){$("#zmsdialog_"+g.elemId).find(".SC_PUbtm").addClass("SC_vh")},isOpen:function(){return null!==g.elemId},listenOnceDialogClose:function(a){if("function"==typeof a){var b=function c(){$.unsubscribe("zm/framework/dialogClosed",c),a()};$.subscribe("zm/framework/dialogClosed",b)}}};return $.extend(!0,g,n),g}),define([],function(a){var b=a("zmail.Core.Namespaces"),c=a("_zm"),d=a("zmText"),e=b.create("zmsDialog"),f="zm_AlertText",g=function(a,b){return b=b||{},b.buttons=b.buttons||[{txt:d.get("dialog","ok"),selected:!0}],b.mask=b.mask||!0,b.pos=b.pos||"center",b.closeaction=function(){c.remove(a)},b.buttons[0].callback=function(){e.remove(),b.onOk&&b.onOk()},b},h=function(a,b){return b=b||{},b.buttons=b.buttons||[{txt:d.get("dialog","ok"),selected:!0},{txt:d.get("dialog","cancel"),isCancel:!0}],b.mask=b.mask||!0,b.closeaction=function(){c.remove(a)},b.buttons[0].callback=function(){e.remove(),b.onOk&&b.onOk(),b.onHide&&b.onHide()},b.buttons[1].callback=function(){e.remove(),c.remove(a),b.onCancel&&b.onCancel(),b.onHide&&b.onHide()},b},i=function(b){var c=a("zmComponent").htmlizer(["h4",{attrs:{id:f},child:[["text",b]]}]);return document.body.appendChild(c),c};return e.confirm=function(a,b){e.create(f,h(i(a),b))},e.alert=function(a,b){e.create(f,g(i(a),b))},e}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=a("_"),e=a("zmail.Utils.DOM"),f=c.create("Dialog"),g={},h={center:"SC_cent"},i={black:"blk",white:"wht",none:"tra"},j={maskWrapper:function(a){var b=a.maskWrapperClass;return b+=" "+h[a.position],b+=" "+i[a.mask],e.element(zdom("div",{className:b}))},positionWrapper:function(a){return e.element(zdom("div",{className:a.positionWrapperClass}))},contentWrapper:function(a){return e.element(zdom("div",{className:a.contentWrapperClass}))},icon:function(a,b,c){var d=a.delimiter?c.iconDelimiterClass:"";return e.element(zdom("li",{className:d},zdom("b",{className:c.iconSelectorClass,"data-id":b},zdom("div",{className:"SC_hd"}),zdom("span",null,zdom("i",{className:a["class"]})))))},iconGroup:function(a,b,c,f){var g=e.element(zdom("ul",null)),h=this;return d.isArray(a)||(a=[a]),d(a).each(function(a,d){var i=b+"."+c+"."+d;a.dataTitle&&g.attr("data-tooltip",a.dataTitle),a.dataAttrib&&g.attr("data-attr",a.dataAttrib),e.mount(h.icon(a,i,f),g)}),g},iconGroupWrapper:function(){return e.element(zdom("div",{className:"SCmb"}))},closeIcon:function(a){a=a||{};var b=a.icons||{};if(b.closeIcon){var c=this.iconGroupWrapper();c.addClass("puClose");var d=e.element(zdom("ul",null));return e.mount(this.icon(b.closeIcon,"closeIcon",a),d),e.mount(d,c),c}},title:function(a){var b=e.element(zdom("h3",null));return b.text(a),b},leftHeader:function(a){var b,c=e.element(zdom("div",{className:"SC_flt"})),f=a.icons||{},g=this;return a.title&&e.mount(this.title(a.title),c),f.left&&(b=this.iconGroupWrapper(),d(f.left).each(function(c,d){e.mount(g.iconGroup(c,"left",d,a),b)}),e.mount(b,c)),c},rightHeader:function(a){var b,c=e.element(zdom("div",{className:"SC_frt"})),f=a.icons||{},g=this;return f.right&&(b=this.iconGroupWrapper(),d(f.right).each(function(c,d){e.mount(g.iconGroup(c,"right",d,a),b)}),e.mount(b,c)),c},header:function(a,b){a=a||{},b=b||{};var c=e.element(zdom("div",{className:a.headerClass}));return b.$leftHeader=this.leftHeader(a),e.mount(b.$leftHeader,c),b.$rightHeader=this.rightHeader(a),e.mount(b.$rightHeader,c),c},content:function(a){a=a||{};var b=e.element(zdom("div",{className:a.contentClass}));return e.setAttribute(b,"style",a.contentStyle||""),b},button:function(a,b,c){var d=a.isSelected?c.buttonSelectionClass:"",f=a.name;d+=" "+c.buttonSelectorClass;var g=e.element(zdom("span",{className:d,"data-id":b}));return a.isCancel&&e.setAttribute(g,"data-val","Cancel"),g.text(f),g},buttonContainer:function(a){var b=a.buttons,c=this;if(b&&b.length){var f=e.element(zdom("div",{className:a.buttonContainerClass}));return d(b).each(function(b,d){e.mount(c.button(b,d,a),f)}),f}return""}};return g.templates=j,d.extend(f,g),f}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=a("zmail.Utils.DOM"),e=c.create("Dialog"),f={},g=function(b,c){var e=a("_"),f=b.config,g=f.buttons,h=c.dom;if(g&&g.length){var i=function(a){a.$el&&a.$el.addClass(f.buttonSelectionClass)},j=function(a){a.$el&&a.$el.removeClass(f.buttonSelectionClass)},k=b.$els.$buttonContainer.children();e(g).each(function(a,e){c.focused<0&&(c.focused=a.isSelected?e:-1),h.push({isArrowKeyAllowed:!0,$el:d.element(k[e]),onFocus:i,onBlur:j,onEnter:function(){a.callback(b)}})})}},h=function(b){var c=a("zmail.Navigator"),d=new c({onEscape:function(){b.remove()}});return g(b,d),d};return f.getDefaultNavigator=h,a("_").extend(e,f),e}),define([],function(a){var b=a("zmail.Core.Namespaces"),c=a("_"),d=a("zmail.Utils.DOM"),e=b.create("Dialog"),f={},g=e.templates,h={getConfig:function(){return{maskWrapperClass:"SC_Pop",positionWrapperClass:"SC_pe",contentWrapperClass:"SC_PU",headerClass:"SC_PUtt",contentClass:"SC_PUcen",buttonContainerClass:"SC_PUbtm",buttonSelectionClass:"sel",buttonSelectorClass:"js-button-selector",iconSelectorClass:"js-icon-selector",iconDelimiterClass:"SC_lbr",position:"center",mask:"white",defaultCloseIcon:!0,ignoreMouseDown:!0,avoidDeepCleanOnRemoval:!1,defaultNavigator:!0}},getCloseIcon:function(){return{"class":"msi-close",callback:function(a){a.remove(),d.removeClass(document.body,"zmDialogOn")}}},extendDefaults:function(a){var b=h.getConfig();return c.extend(b,a),b.defaultCloseIcon&&(b.icons=b.icons||{},b.icons.closeIcon=h.getCloseIcon()),b}},i={build:function(a){var b=a.$els,c=a.config,e=a.templates||g;b.$maskWrapper=d.element(e.maskWrapper(c)),b.$positionWrapper=d.element(e.positionWrapper(c)),d.mount(b.$positionWrapper,b.$maskWrapper),b.$contentWrapper=d.element(e.contentWrapper(c)),d.mount(b.$contentWrapper,b.$positionWrapper),c.defaultCloseIcon&&(b.$closeIcon=d.element(e.closeIcon(c)),d.mount(b.$closeIcon,b.$contentWrapper)),(c.title||c.icons&&(c.icons.closeIcon||c.icons.left||c.icons.right))&&(b.$header=d.element(e.header(c,b)),d.mount(b.$header,b.$contentWrapper)),b.$content=d.element(e.content(c)),d.mount(b.$content,b.$contentWrapper),c.buttons&&c.buttons.length&&(b.$buttonContainer=d.element(e.buttonContainer(c)),d.mount(b.$buttonContainer,b.$contentWrapper))}},j={buttonsCallbackInvoker:function(a,b,c){var d=a.config.buttons,e=d[b];e&&e.callback&&e.callback(a,c)},iconsCallbackInvoker:function(b,c,d){var e=b.config.icons||{},f=a("_zm").getProperty(e,c);f&&f.callback&&f.callback(b,d)},bindEvents:function(a){var b=a.config;a.$els.$buttonContainer&&a.$els.$buttonContainer.on("click","."+b.buttonSelectorClass,function(c){var e=d.element(c.target).closest("."+b.buttonSelectorClass).data("id");j.buttonsCallbackInvoker(a,e,c)});var c=function(c){var e=d.element(c.target).closest("."+b.iconSelectorClass).data("id");j.iconsCallbackInvoker(a,e,c)};a.$els.$closeIcon&&a.$els.$closeIcon.on("click","."+b.iconSelectorClass,c),a.$els.$header&&a.$els.$header.on("click","."+b.iconSelectorClass,c),a.config.ignoreMouseDown&&a.$els.$maskWrapper.on("mousedown",function(a){a.stopPropagation()})}},k={show:function(){this.$els.$maskWrapper.show(),d.addClass(document.body,"zmDialogOn"),this.config.navigator&&this.config.navigator.setThisAsCurrentNavigator()},hide:function(){d.removeClass(document.body,"zmDialogOn"),this.$els.$maskWrapper.hide(),this.config.hideAction&&this.config.hideAction(this)},remove:function(){d.removeClass(document.body,"zmDialogOn"),this.config.closeAction&&this.config.closeAction(this),this.$els.$maskWrapper.remove(),this.$els.$maskWrapper.remove(),this.config.navigator&&this.config.navigator.clearTrace(),this.config.avoidDeepCleanOnRemoval||(delete this.$els,delete this.config),$.publish&&$.publish("zm/framework/dialogClosed",{})}},l={init:function(a){return i.build(a),j.bindEvents(a),c.extend(a,k),this},dialogWillMount:function(a){return a.config.dialogWillMount&&a.config.dialogWillMount.call(a,a),this},_configureNavigator:function(a){var b=a.config;!b.navigator&&b.defaultNavigator&&(b.navigator=e.getDefaultNavigator(a)),b.navigator&&b.navigator.setThisAsCurrentNavigator()},mountDialog:function(a){var b=a.$dialogParent?d.element(a.$dialogParent):d.element(document.body);if(d.mount(a.$els.$maskWrapper,b),a.config.$content){var c=a.config.$content;"string"==typeof c&&(c=d.__dangerouslyParseHTML(a.config.$content)),c=d.element(c),d.mount(c,a.$els.$content)}return d.addClass(document.body,"zmDialogOn"),this._configureNavigator(a),this},dialogDidMount:function(a){return a.config.dialogDidMount&&a.config.dialogDidMount.call(a,a),this}},m=function(a){var b={config:h.extendDefaults(a),$els:{}};return l.init(b).dialogWillMount(b).mountDialog(b).dialogDidMount(b),b};return f["new"]=m,c.extend(e,f),e}),define([],function(a){var b=a("zmail.Core.Namespaces"),c=a("zmText"),d=a("zmail.Utils.DOM"),e=b.create("Dialog"),f={},g=function(a,b,f){var g=function(a,c){b&&b(a,c),a.remove()};return f=f||{},f.title=a,f.buttons=[{name:f.okButtonName||c.get("dialog","ok"),callback:g}],f.dialogDidMount=function(){d.blur(document.activeElement)},e["new"](f)};return f.alert=g,a("_").extend(e,f),e}),define([],function(a){var b=a("zmail.Core.Namespaces"),c=a("zmText"),d=b.create("Dialog"),e={},f=function(a,b,e,f){var g=function(a,c){b&&b(a,c),a.remove()},h=function(a,b){e&&e(a,b),a.remove()};return f=f||{},f.title=a,f.buttons=[{name:f.okButtonName||c.get("dialog","ok"),isSelected:!0,callback:g},{name:f.cancelButtonName||c.get("dialog","cancel"),callback:h,isCancel:!0}],d["new"](f)};return e.confirm=f,a("_").extend(d,e),d});
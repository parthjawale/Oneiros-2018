"use strict";_defineSettingsModule("App",function(a,b,c){var d,e,f=b("Platform.Events.Base"),g=b("Platform.System.Utils"),h=b("Platform.System.Constants"),i=!1,j=!1,k={OPEN:"settings.mailsuite.app.opened",CLOSING:"settings.mailsuite.app.closing",CLOSE:"settings.mailsuite.app.closed",TAB_ACTIVE:"settings.mailsuite.app.tab.active",TAB_INACTIVE:"settings.mailsuite.app.tab.inactive",HASHURL_CHANGE:"settings.mailsuite.app.hashurl.changed"},l={appId:"zm-settings",appIcon:"msi-settings",appCenterCustomClass:"zm-settings",loaderId:"zm-settings-loading-bar"},m={appName:zmText.get("zm-settings-mailsuite-appshell","mailsuiteApp.shell.appName")},n=function(){var a=$("<div>");a.attr({id:l.loaderId}),a.css({"text-align":"center","margin-top":"200px"});var b=zmResource.get("image","loading1.gif"),c=$('<img src="'+b+'" />');return c.appendTo(a),{show:function(b){b&&(a.appendTo(b),a.show())},hide:function(b){return b=b||{},b.noRemove?void a.hide():void a.remove()}}}(),o=function(){var a={stopClosing:!1};return f.publishEvent(c,k.CLOSING,a),a.stopClosing===!1&&e(),!a.stopClosing},p={appId:l.appId,appname:m.appName,appIcon:l.appIcon,customCenterClass:l.appCenterCustomClass,data:{CNodes:3},onDelete:o,hashKey:"settings",hashChangeHandler:function(a){var b=this,e=null;i?j||zmsuite.showWorkSpace(l.appId):e=d();var h=function(){f.publishEvent(c,k.HASHURL_CHANGE,{params:a,router:b})};null!==e?e.done(h):h(),g.debugLog("settings hash-url updated",a)}};d=function(){var a,b,d;if(zmTab.currentTab===p.appId)return g.makeDeferred().resolve();var e=zmsuite.isWorkspaceAvailable(p.appId);e||(zmsuite.setWorkSpace(p),zmsuite.renderWorkSpace()),zmsuite.showWorkSpace(p.appId),a=zmsuite.getCenter(l.appId)[0].centerArr[2].$el[0],b=zmsuite.getCenter(l.appId)[1].$el[0],d=d=zmsuite.getCenter(l.appId)[0].$el[0],$(a).addClass("SC_set"),n.show(a);var h=g.makeDeferred();return f.publishEvent(c,k.OPEN,{appContainer:a,previewCard:b,appWrapper:d,process:h}),h.done(function(a){g.debugLog("App opened successfully !!",a)}).fail(function(a){g.debugLog("App opening failed !!",a)}),h.always(function(){n.hide()}),i=!0,h.promise()},e=function(){var a,b,d;a=zmsuite.getCenter(l.appId)[0].centerArr[2].$el[0],b=zmsuite.getCenter(l.appId)[1].$el[0],d=zmsuite.getCenter(l.appId)[0].$el[0];var e=g.makeDeferred();return f.publishEvent(c,k.CLOSE,{appWrapper:d,appContainer:a,previewCard:b,process:e}),e.done(function(a){g.debugLog("App closed successfully !!",a)}).fail(function(a){g.debugLog("App closing failed !!",a)}),i=!1,e.promise()};var q=function(){zmsuite.closeWorkspace(l.appId)},r=function(){return new Promise(function(a,b){zmAppLoader.load(h.ModuleList.MAILSUITE_APP_CORE).then(function(){a()},function(){b()})})},s=function(a,b,d){b===l.appId?(j=!0,f.publishEvent(c,k.TAB_ACTIVE,{}),g.debugLog("Settings App Tab - Gained focus")):d===l.appId&&(j=!1,f.publishEvent(c,k.TAB_INACTIVE,{}),g.debugLog("Settings App Tab - Lost focus"))},t=function(){$.subscribe("/apps/tabSwitched",s)},u=function(){c.Events=g.copyProperties(k,c.Events),c.Constants=g.copyProperties(l,c.Constants),t(),f.subscribeEvent(c,k.OPEN,function(a){a=a||{};var c=a.appContainer,d=a.previewCard,e=a.appWrapper,f=a.process;zmail.Settings.initializeSystem().done(function(){setTimeout(function(){r().then(function(a){g.debugLog("App core module loaded",a);var h=b("MailSuite.App.Core");h.openApp({appWrapper:e,appContainer:c,previewCard:d,process:f})},function(a){g.debugLog("App core module failed to load",a),f.reject(a)})},0)}).fail(function(a){g.debugLog("Settings system failed to initialize",a),f.reject(a)})}),f.subscribeEvent(c,k.CLOSE,function(a){a=a||{};var c=a.appContainer,d=a.appWrapper,e=a.previewCard,f=a.process;r().then(function(a){g.debugLog("App core module loaded",a);var h=b("MailSuite.App.Core");h.closeApp({appWrapper:d,appContainer:c,previewCard:e,process:f})},function(a){f.reject(a),g.debugLog("App core module failed to load",a)})})};u(),a.openApp=d,a.closeApp=e,a.triggerWorkspaceClose=q,a.Events=k,a.Constants=l},"MailSuite");
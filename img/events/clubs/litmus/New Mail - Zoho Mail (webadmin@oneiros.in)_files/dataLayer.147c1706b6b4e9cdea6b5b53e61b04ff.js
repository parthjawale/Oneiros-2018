"use strict";define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Utils"),c=b,d=Object.prototype.hasOwnProperty,e=Object.getPrototypeOf,f=d.toString,g=f.call(Object),h=function(a){var b,h;return!(!a||!c.isObject(a))&&(!(b=e(a))||(h=d.call(b,"constructor")&&b.constructor,"function"==typeof h&&f.call(h)===g))},i=function j(){var a,b,d,e,f,g,i=arguments[0]||{},k=1,l=arguments.length,m=!1;for("boolean"==typeof i&&(m=i,i=arguments[1]||{},k=2),"object"===("undefined"==typeof i?"undefined":babelHelpers["typeof"](i))||c.isFunction(i)||(i={}),l===k&&(i=this,--k);k<l;k++)if(null!==(a=arguments[k]))for(b in a)d=i[b],e=a[b],i!==e&&(m&&e&&(h(e)||(f=c.isArray(e)))?(f?(f=!1,g=d&&c.isArray(d)?d:[]):g=d&&h(d)?d:{},i[b]=j(m,g,e)):void 0!==e&&(i[b]=e));return i};return b.extend=i,b}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Utils"),c=b,d=function(a,b,d){return a=a||{},b=b||{},b=d===!0?c.extend(!0,b,a):c.extend(b,a)},e=function(){return _.extend.apply(null,arguments)},f=function(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c]);return a},g=function(a,b,c){c=c||Object.keys(b);var d,e,f=c.length;for(e=0;e<f;e++)d=c[e],a[d]=b[d]},h=function(a,b){return _.isEqual(a,b)},i=function(a){return _.clone(a)},j=function(a){return"object"!==("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))||Array.isArray(a)?0:Object.keys(a).length};return b.copyProperties=d,b.extendProperties=e,b.copyDefaults=f,b.applyMixin=g,b.clone=i,b.isEqual=h,b.size=j,b}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Utils"),c=b,d={},e=Object.prototype.toString,f=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Arguments","Error","Symbol","Map","WeakMap","Set","WeakSet"];f.forEach(function(a){b["is"+a]=function(b){return e.call(b)==="[object "+a+"]"},d["[object "+a+"]"]=a.toLowerCase()});var g=function(a){return d[e.call(a)]||"object"},h=function(a){return c.isObject(a)?Object.keys(a).length>0:c.isArray(a)?a.length>0:!c.isString(a)||""===a},i=function(a){return c.object(a)&&a.nodeType>0},j=function(a){return c.string(a)&&a===a.toUpperCase()},k=function(a){return c.string(a)&&a===a.toLowerCase()},l=function(a){return a&&c.isObject(a)&&"setInterval"in a};return b.getType=g,b.isEmpty=h,b.isDOMNode=i,b.isUpperCase=j,b.isLowerCase=k,b.isWindow=l,b}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Utils"),c=function(a){var b={};return b.u=a.url,b.t=a.type||"POST",b.efn=a.error,b.fn=a.success,b.p=a.data,b.ep=a.extraParamObj,b.h=!!a.header||"",b.noStringify=!!a.noStringify||"",b.setSessionId=a.setSessionId,b},d=function(a){return zmAjq.XHR(c(a))},e=function(a){return Number(""===a.trim()?NaN:String(a))},f=function(a,b,c){for(var d={},f=a.split(c),g=b.split(c),h=0;h<f.length;h++)d[g[h]]=e(f[h]);return d},g=function(a){return/^\d+$/.test(a)},h=function(){window.console.log("noop")},i=function(a,b){return _.isEqual(a,b)},j=function(a){return Boolean(a)},k=function(a,b){return _.sortBy(a,b)},l=function(){return new Promise(function(a,b){b()})},m=function(){return new Promise(function(a,b){a()})},n=_zm.getProperty;return b.sortBy=k,b.getAjaxMethod=d,b.noop=h,b.isEqual=i,b.hasValue=j,b.parseDate=f,b.isStringProperNumber=g,b.convertStringToNumber=e,b.getProperty=n,b.rejectedPromise=l,b.resolvedPromise=m,b}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Utils"),c=function(){return Math.floor(Date.now()/Math.random())};return b.getNextUUID=c,c}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Core"),c=function d(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,d),this.errorMsg=a.errorMsg,this.opts=a};return b.Exception=c,c}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Core"),c=function(){function a(b){babelHelpers.classCallCheck(this,a),this.eventName=b,this.handlers=[]}return babelHelpers.createClass(a,[{key:"register",value:function(a,b){this.handlers.push({fn:a,context:b})}},{key:"unregister",value:function(a,b){for(var c,d=this.handlers,e=d.length,f=0;f<e;f++)if(c=d[f],a===c.fn){if(b&&b!==c.context)continue;this.handlers.splice(f,1);break}}},{key:"unregisterAll",value:function(){for(var a=this.handlers,b=a.length,c=0;c<b;c++)delete a[c]}},{key:"emit",value:function(){var a=arguments,b=this.handlers.slice(0);b.forEach(function(b){b.fn.apply(b.context||null,a)})}}]),a}(),d={on:function(a,b,d){var e=this;this.events||(this.events={}),a.split(" ").forEach(function(a){var f=e.events[a];f||(f=new c(a),e.events[a]=f),f.register(b,d)})},off:function(a,b,c){var d=this;if(this.events||(this.events={}),a||b||c)a.split(" ").forEach(function(a){var e,f=d.events[a];f&&(e=f.unregister(b,c),e&&0===f.callbacks.length&&delete d.events[a])});else for(var e=Object.keys(this.events),f=e.length,g=void 0,h=void 0,i=0;i<f;i++)h=e[i],g=this.events[h],g.unregisterAll(),delete this.events[h]},trigger:function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var d=b[0];if(!d)return!1;this.events||(this.events={});var e=this.events[d],f=this.events.all;e&&e.emit.apply(e,b.slice(1)),f&&f.emit.apply(f,b.slice(0))},triggerOnce:function(){}};return b.Events=d,d}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer"),c=a.get("zmail.DataLayer.Utils"),d=function(){function a(b){babelHelpers.classCallCheck(this,a),this.collection=b,this.commands=[],this.condition="OR",this.useCase=!1}return babelHelpers.createClass(a,[{key:"useCase",value:function(){return this.useCase=!0,this}},{key:"and",value:function(){return this.condition="AND",this}},{key:"or",value:function(){return this.condition="OR",this}},{key:"select",value:function(){var a,b,c=[];for(a=0,b=this.collection.length;a<b;a++){var d=this.collection.models[a];this.evaluate(d.attributes)&&c.push(d)}return c}},{key:"evaluate",value:function(a){var b,c,d,e=this.commands.length,f=[];if(0===e)return!0;var g=this.commands[0];for(c=this.evaluateCommand(a,g),b=1;b<e;b++){if(g=this.commands[b],d=this.evaluateCommand(a,g),"OR"===g.condition)c=c||d;else if("AND"===g.condition&&(c=c&&d,!c))return!1;f.push(c)}return c}},{key:"evaluateCommand",value:function(a,b){var d=c.getProperty(a,b.attrName),e=b.operator,f=b.value;if(void 0!==d){if(this.useCase||c.isString(d)&&(d=d.toLowerCase(),f=f.toLowerCase()),"is"===e)return d===f;if("isNot"===e)return d!==f;if("startsWith"===e)return d.startsWith(f);if("endsWith"===e)return d.endsWith(f);if("contains"===e)return d.indexOf(f)!==-1;if("doesNotContain"===e)return d.indexOf(f)===-1;throw new Error("Invalid where Operator")}return!1}},{key:"count",value:function(){return this.select().length}},{key:"where",value:function(a,b,c){return this.commands.push({attrName:a,operator:b,value:c,condition:this.condition}),this.condition="OR",this}}]),a}();return b.DSSql=d,d}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Adapter"),c=function(){function a(){babelHelpers.classCallCheck(this,a)}return babelHelpers.createClass(a,[{key:"fetchRecord",value:function(){return!1}},{key:"findRecord",value:function(){return!1}},{key:"createRecord",value:function(){return!1}},{key:"updateRecord",value:function(){return!1}},{key:"deleteRecord",value:function(){return!1}},{key:"findAll",value:function(){return!1}},{key:"query",value:function(){return!1}},{key:"serialize",value:function(){}},{key:"normalize",value:function(){}},{key:"sync",value:function(a,b){arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}}}]),a}();return b.BaseAdapter=c,c}),define([],function(){var a=zmail.Core.Namespaces,b=a.get("zmail.DataLayer.Adapter"),c=a.get("zmail.DataLayer.Utils"),d=b.BaseAdapter,e=function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,b);var c=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.initialize(),c}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"initialize",value:function(){var a=this;a.REQUEST_METHOD=c.clone(a.getDefaultRequestMethods())}},{key:"getDefaultRequestMethods",value:function(){return{create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"}}},{key:"findRecord",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("read",a,b)}},{key:"createRecord",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("create",a,b)}},{key:"updateRecord",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("update",a,b)}},{key:"deleteRecord",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("delete",a,b)}},{key:"deleteRecords",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.sync("delete",a,b)}},{key:"findAll",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b.type="GET",this.sync("fetchAll",a,b)}},{key:"getUrl",value:function(){throw new Error("No url configured")}},{key:"getHeaders",value:function(){return{}}},{key:"serialize",value:function(a,b,c){return c}},{key:"normalize",value:function(a,b,c){return b}},{key:"sync",value:function(a,b){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=this;return new Promise(function(f,g){var h={},i=function(c){d.resp=c;var h=e.normalize(a,c,d);h.error?g({resp:c,opts:d,model:b}):f({resp:h,opts:d,model:b})},j=function(a){d.hideErrorMsg||("string"==typeof a?_zm.succErrMsg("e",a):"object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))&&a.msg&&"string"==typeof a.msg&&_zm.succErrMsg("e",a.msg)),g({resp:a,opts:d,model:b})};h.type=d.type||e.REQUEST_METHOD[a]||"POST",h.url=d.url||e.getUrl(),h.data=e.serialize(a,b,d),h.success=i,h.error=j,h.setSessionId=Boolean(d.setSessionId),c.getAjaxMethod(h)})}}]),b}(d);return b.HTTPAdapter=e,e}),define([],function(){var a=zmail.Core.Namespaces,b=a.get("zmail.DataLayer.Adapter"),c=b.BaseAdapter,d=function(a){function b(a){babelHelpers.classCallCheck(this,b);var c=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return window.console.log(a),c}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"findRecord",value:function(){}},{key:"createRecord",value:function(){}},{key:"serialize",value:function(a,b){return b}},{key:"normalize",value:function(a,b){}},{key:"sync",value:function(a,b){arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}}}]),b}(c);return b.LocalStorageAdapter=d,d}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Validator"),c=a.get("zmail.DataLayer.Utils"),d=function(){function a(b,c){babelHelpers.classCallCheck(this,a),this.init(b,c)}return babelHelpers.createClass(a,[{key:"init",value:function(a,b){var c=this;if("string"!=typeof a)throw new Error("Give a proper id for Validator");c.id=a,"object"!==babelHelpers["typeof"](b.errorCodes)&&c.throwError("Define Proper Error Codes for the validator"),"function"!=typeof b.validator&&c.throwError("Validator is not a function"),c.errorCodes=b.errorCodes,c.validator=b.validator}},{key:"validate",value:function(a,b){var d,e=this;b=b||{};var f=c.isFunction(b.isRequired)?b.isRequired.call(a):b.isRequired;if(!f)return{isValid:!0,isRequired:!1};if(c.hasValue(a))d=e.validator(a,b);else{if(b.acceptNullEmpty)return{isValid:!0,isAcceptNullEmpty:!0};d={isValid:!1,errorCode:"INVALID_INPUT"}}d||e.throwError(" result is invalid"),d.hasOwnProperty("isValid")||e.throwError("[validator] result is invalid. No [valid] property found");var g=d.isValid;g||d.hasOwnProperty("errorCode")||e.throwError("[validator] result is invalid. No [errCode] property found");var h;if(!g){h=d.errorCode;var i,j=e.errorCodes;i="function"==typeof j?j(h):j[h],d.message=i}return d}},{key:"throwError",value:function(a){throw new Error(this.id+" >>> "+a)}},{key:"setErrorCode",value:function(a,b){return a.isValid=!1,a.errorCode=b,a}},{key:"validateNThrowError",value:function(a,b){var c=this.validate(a,b);if(!c.isValid)throw new Error(c)}}]),a}();return d.extend=c["extends"],b.Validator=d,d}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Validator"),c=a.get("zmail.DataLayer.Utils"),d=b.Validator,e=function(){function a(){babelHelpers.classCallCheck(this,a),this.validators={}}return babelHelpers.createClass(a,[{key:"add",value:function(a,b){if(!(b instanceof d))throw new Error("Given validator is not a instance of Base Validator");this.validators[a]=b}},{key:"get",value:function(a){return this.validators[a]}},{key:"remove",value:function(){delete this.validators[name]}},{key:"create",value:function(a,b,e){var f=this,g=new d(a,{errorCodes:b.errorCodes,validator:b.validator});return e&&c.copyProperties(g.prototype,e),f.add(a,g),f.get(a)}}]),a}(),f=new e;return b.ValidatorCollection=f,f}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Validator"),c=b.ValidatorCollection,d=a.get("zmail.DataLayer.Utils");return c.create("range",{errorCodes:{LESS_THAN_MIN_VALUE:"{0} is less than the minimum value ({1})",GREATER_THAN_MAX_VALUE:"{0} is greater than the allowed maximum value ({1})",INVALID_INPUT:"Expected a Input Number"},validator:function(a,b){var c={isValid:!1,errorCode:"LESS_THAN_MIN_VALUE"};if(!d.isNumber(a)&&(a=Number(a),isNaN(a)))return c.errorCode="INVALID_INPUT",c;var e=-1,f=-1,g=b.range;return g?d.isArray(g)?(e=g[0],f=g[1]):this.throwError("Attributes Config Invalid.Range must an Array"):b.min||b.max?(b.min&&(e=b.min),b.max&&(f=b.max)):this.throwError("Attributes Config Invalid.No Range, min, max config found"),e!==-1&&a<e?c:f!==-1&&a>f?(c.errorCode="GREATER_THAN_MAX_VALUE",c):(delete c.errorCode,c.isValid=!0,c)}}),{}}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Validator"),c=b.ValidatorCollection,d=a.get("zmail.DataLayer.Utils");return c.create("type",{errorCodes:{INVALID_NUMBER:"{0} should be a number",INVALID_STRING:"{0} should be a string",INVALID_BOOLEAN:"{0} should be a Boolean value",INVALID_ARRAY:"{0} should be an Array",INVALID_DATE:"Invalid Date Specified",INVALID_DAY:"Invalid day is Specified",INVALID_MONTH:"Invalid month is Specified",INVALID_YEAR:"Invalid year is Specified",INVALID_INPUT:"Expected a Input Number",LESS_THAN_MIN_VALUE:"{0} is less than the minimum value ({1})",GREATER_THAN_MAX_VALUE:"{0} is greater than the allowed maximum value ({1})",LESS_THAN_MIN_LENGTH:"{0} is less than the minimum length ({1})",GREATER_THAN_MAX_LENGTH:"{0} is greater than the allowed maximum length ({1})",LESS_THAN_MIN_DAY:"{0} is less than the minimum allowed day ({1})",LESS_THAN_MIN_MONTH:"{0} is less than the minimum allowed month ({1})",LESS_THAN_MIN_YEAR:"{0} is less than the minimum allowed year ({1})",GREATER_THAN_MAX_DAY:"{0} is greater than the maximum allowed day ({1})",GREATER_THAN_MAX_MONTH:"{0} is greater than the maximum allowed month ({1})",GREATER_THAN_MAX_YEAR:"{0} is greater than the maximum allowed year ({1})",LESS_THAN_MIN_HOUR:"{0} is less than the minimum allowed hour ({1})",LESS_THAN_MIN_MINUTE:"{0} is less than the minimum allowed minute ({1})",LESS_THAN_MIN_SECOND:"{0} is less than the minimum allowed second ({1})",GREATER_THAN_MAX_HOUR:"{0} is greater than the maximum allowed hour ({1})",GREATER_THAN_MAX_MINUTE:"{0} is greater than the maximum allowed minute ({1})",GREATER_THAN_MAX_SECOND:"{0} is greater than the maximum allowed second ({1})"},validator:function(a,b){var c={isValid:!1,errorCode:"INVALID_TYPE"},e=this;if("string"===b.type){if(!d.isString(a))return e.setErrorCode(c,"INVALID_STRING");if(b.minLength&&a.length<b.minLength)return e.setErrorCode(c,"LESS_THAN_MIN_LENGTH");if(b.maxLength&&a.length>b.maxLength)return e.setErrorCode(c,"GREATER_THAN_MAX_LENGTH")}else if("number"===b.type){var f=a;if(!d.isNumber(a)&&(f=d.convertStringToNumber(a),isNaN(f)))return e.setErrorCode(c,"INVALID_NUMBER");if(b.minValue&&f<b.minValue)return e.setErrorCode(c,"LESS_THAN_MIN_VALUE");if(b.maxValue&&f>b.maxValue)return e.setErrorCode(c,"GREATER_THAN_MAX_VALUE")}else if("boolean"===b.type){if(!d.isBoolean(a))return e.setErrorCode(c,"INVALID_BOOLEAN")}else if("array"===b.type){if(!d.isArray(a))return e.setErrorCode(c,"INVALID_ARRAY")}else if("date"===b.type){var g=zmail.userDateFormat.toLowerCase(),h=d.parseDate(a,g,b.splitBy||"/"),i=h.dd,j=h.mm,k=h.yyyy;if(!i||isNaN(i)||i<1)return e.setErrorCode(c,"INVALID_DAY");if(!j||isNaN(j)||j<1||j>12)return e.setErrorCode(c,"INVALID_MONTH");if(!k||isNaN(k)||k<1)return e.setErrorCode(c,"INVALID_YEAR");var l=[31,28,31,30,31,30,31,31,30,31,30,31];if((1===j||j>2)&&i>l[j-1])return e.setErrorCode(c,"INVALID_DATE");if(2===j){var m=!1;if((k%4||!(k%100))&&k%400||(m=!0),m===!1&&i>=29)return e.setErrorCode(c,"INVALID_DATE");if(m===!0&&i>29)return e.setErrorCode(c,"INVALID_DATE")}if(b.minDay&&i<b.minDay)return e.setErrorCode(c,"LESS_THAN_MIN_DAY");if(b.maxDay&&i>b.maxDay)return e.setErrorCode(c,"GREATER_THAN_MAX_DAY");if(b.minMonth&&i<b.minMonth)return e.setErrorCode(c,"LESS_THAN_MIN_MONTH");if(b.maxMonth&&i>b.maxMonth)return e.setErrorCode(c,"GREATER_THAN_MAX_MONTH");if(b.minYear&&i<b.minYear)return e.setErrorCode(c,"LESS_THAN_MIN_YEAR");if(b.maxYear&&i>b.maxYear)return e.setErrorCode(c,"GREATER_THAN_MAX_YEAR")}else if("time"===b.type){var n="hh:mm:ss",o=d.parseTime(a,n,":"),p=o.hh,q=o.mm,r=o.ss;if(!p||isNaN(p)||p<0||p>23)return e.setErrorCode(c,"INVALID_HOUR");if(!q||isNaN(q)||q<0||q>59)return e.setErrorCode(c,"INVALID_MINUTE");if(!r||isNaN(r)||r<0||r>59)return e.setErrorCode(c,"INVALID_SECOND");if(b.minHour&&p<b.minHour)return e.setErrorCode(c,"LESS_THAN_MIN_HOUR");if(b.maxHour&&p>b.maxHour)return e.setErrorCode(c,"GREATER_THAN_MAX_HOUR");if(b.minMinute&&q<b.minMinute)return e.setErrorCode(c,"LESS_THAN_MIN_MINUTE");if(b.maxMinute&&q>b.maxMinute)return e.setErrorCode(c,"GREATER_THAN_MAX_MINUTE");if(b.minSecond&&r<b.minSecond)return e.setErrorCode(c,"LESS_THAN_MIN_SECOND");if(b.maxSecond&&r>b.maxSecond)return e.setErrorCode(c,"GREATER_THAN_MAX_SECOND")}return delete c.errorCode,c.isValid=!0,c}}),{}}),define([],function(){var a=function(){return{email:/^[\w]([\w-.+'=]*)@([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,22}$/,number:/^\d+$/,domain:/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,22}$/,url:/^(ht|f)tp(s?):\/\/[-.\w]*(\/?)([a-zA-Z0-9\-.?,:'\/\\+=&amp;%$#_@]*)?$/}};return zmail.patterns=Object.freeze(a()),a}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer.Validator"),c=b.ValidatorCollection,d=zmail.patterns;return c.create("pattern",{errorCodes:{PATTERN_NOT_MATCHED:"Invalid input is given."},validator:function(a,b){var c={isValid:!1,errorCode:"INVALID_TYPE"},e=this;if(b.pattern&&d[b.pattern]){if(!d[b.pattern].test(a))return e.setErrorCode(c,"PATTERN_NOT_MATCHED")}else if(b.regex){if(!b.regex.test(a))return e.setErrorCode(c,"PATTERN_NOT_MATCHED")}else this.throwError("No Pattern or regex configured!!");return delete c.errorCode,c.isValid=!0,c}}),{}}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer"),c=a.create("zmail.DataLayer.Utils"),d={deleted:{isDirty:!0,isDeleted:!0},loading:{isLoading:!0},loaded:{mode:"created",isLoaded:!0},created:{isDirty:!0,inFlight:!1,isNew:!0},updated:{isDirty:!0,inFlight:!1}},e={CREATED:"created",DELETED:"deleted",LOADED:"loaded"},f=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,a),this._initDefaults(),this.initProperties(b)}return babelHelpers.createClass(a,[{key:"_getDefaultStateObj",value:function(){return{isLoading:!1,isLoaded:!1,isDirty:!1,inFlight:!1,isSaving:!1,isDeleted:!1,isNew:!1,isValid:!0,isChanging:!1}}},{key:"_transitiontoState",value:function(a){var b=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},this),f=d[a];a===e.LOADED&&f.mode&&(f=d[f.mode]),c.extendProperties(b.stateObj,f)}},{key:"_initDefaults",value:function(){var a=this;a.currentState=e.LOADED,a.stateObj=a._getDefaultStateObj(),a._transitiontoState(e.LOADED)}},{key:"initProperties",value:function(a){var b=this;a.idAttrPresent&&(b.stateObj.isNew=!1)}},{key:"transitionTo",value:function(){var a=this;a.updateIsNew()}},{key:"isDirty",get:function(){return this.stateObj.isDirty},set:function(a){this.stateObj.isDirty=a}},{key:"isChanging",get:function(){return this.stateObj.isChanging},set:function(a){this.stateObj.isChanging=a}},{key:"isNew",get:function(){var a=this;return a.currentState===e.LOADED&&a.stateObj.isNew},set:function(a){this.currentState===e.LOADED&&(this.stateObj.isNew=Boolean(a))}},{key:"isDeleted",get:function(){return this.stateObj.isDeleted},set:function(a){this.stateObj.isDeleted=a}},{key:"isInvalid",get:function(){return this.stateObj.isInvalid},set:function(a){this.stateObj.isInvalid=a}},{key:"inFlight",get:function(){return this.stateObj.inFlight},set:function(a){this.stateObj.inFlight=a}}]),a}();return b.StateManager=f,f}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer"),c=a.get("zmail.DataLayer.Utils"),d=a.get("zmail.DataLayer.Validator"),e=a.get("zmail.DataLayer.Core"),f=b.StateManager,g=d.ValidatorCollection,h=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments[1];babelHelpers.classCallCheck(this,a);var d=this,e=b.attrs||void 0;this._collection=b.collection||null,this._store=b.store||null,this.modelName=c,d.relations={},d._initialize(),d._initializeAttributes(e,b),d.initialize&&d.initialize()}return babelHelpers.createClass(a,[{key:"_initialize",value:function(){var a=this,b=a.attrsConfig();a.attributes={},a.idAttribute=a.getIdAttribute(),a._attrsConfig=c.clone(b),a._stateManager=new f}},{key:"_initializeAttributes",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments[1],d=this,e=d.getDefaults();d._prevCommited={},"object"===("undefined"==typeof e?"undefined":babelHelpers["typeof"](e))&&c.copyDefaults(a,e),b.parse&&(a=d.parse(a)),d.set(a)}},{key:"toJSON",value:function(){return c.clone(this.attributes)}},{key:"attrsConfig",value:function(){return{}}},{key:"get",value:function(a){return this.attributes[a]}},{key:"set",value:function(a,b){var d,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=this,g={},h={},i=f.isChanging;"object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))?(g=a,e=b||{}):g[a]=b;var j=e.silent;i||(f.changed={},h=c.clone(f.attributes),f._prevChangedAttr=h),f.isChanging=!0;var k=f.changed;if(d=f.validate(g,e),!d.isValid)return!1;var l=[],m=f.attributes;for(var n in g){var o=g[n];c.isEqual(m[n],o)||(l.push(n),k[n]=o,m[n]=o)}return j||l.forEach(function(a){f.trigger("change:"+a,f,m[a])}),f.idAttribute in g&&(f.id=g[f.idAttribute],f.isNew=!1,f.isDirty=!1),i?f:(j||l.length>0&&f.trigger("change",f,e),f.isChanging=!1,f)}},{key:"getStoreRef",value:function(){var a,b=this;if(b._collection&&b._collection._store)a=b._collection._store;else{if(!b._store)throw Error("Not yet registered with any store, cant save");a=b._store}return a}},{key:"getIdAttribute",value:function(){return"id"}},{key:"getStoreKey",value:function(){var a,b=this;return b._collection&&b._collection._storeKey?a=b._collection._storeKey:b._storeKey&&(a=b._storeKey),a}},{key:"hasChanged",value:function(){return c.isEmpty(this.changed)}},{key:"changedAttributes",value:function(a){var b=this;if(!a)return!!b.hasChanged()&&c.clone(b.changed);var d,e={},f=b.attributes;for(var g in a)d=a[g],c.isEqual(f[g],d)||(e[g]=d);return!!c.size(e)&&e}},{key:"save",value:function(a,b){var d,e,f,g,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this,j={},k=h.setImmediate;if("object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))?(j=a,h=c.clone(b)||{}):a?j[a]=b:j=null,c.extendProperties({parse:!0,validate:!0},h),j)if(k){if(f=i.set(j,h),!f)return!1}else{var l=i.validate(j,h);if(!l.isValid)return!1}return h.method?d=h.method:i.isNew?d="create":(d="update",i.hasChanged()&&(h.changedAttributes=i.changedAttributes())),e=i.getStoreRef(),i.inFlight=!0,g=c.extendProperties({},i.attributes,j),h.attrs=c.clone(j),e._sync(d,i,h).then(function(a){var b=a.resp,d=h.parse?i.parse(b):b;if(j&&(k||(d=c.extendProperties({},g,d))),d){var e=i.set(d,h);if(!e)return!1}return i._prevCommitted=c.clone(i.attributes),i.trigger("sync",d),a}).then(function(a){return i.inFlight=!1,a},function(a){throw i.inFlight=!1,a})}},{key:"fetch",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=this,c=a.parse,d=void 0===c||c;return b.triggerAction("read",this,a).then(function(c){var e=c.resp;return d&&(e=b.parse(e)),b.set(e),b.trigger("sync",b,e,a),c})}},{key:"delete",value:function(){return this}},{key:"parse",value:function(a){return a}},{key:"getDirtyAttributes",value:function(){}},{key:"rollbackChanges",value:function(){}},{key:"isLoading",value:function(){return this.state.isLoading}},{key:"isLoaded",value:function(){return this.state.isLoaded}},{key:"destroy",value:function(){var a,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=this,d=b.success;return b.success=function(a){d&&d.call(b.context,c,a,b),c.isNew||c.trigger("sync",c,a,b)},c.isNew?Promise.resolve():(a=c.getStoreRef(),a._sync("delete",this,b).then(function(a){return c.trigger("destroy",c,c.collection,b),a}))}},{key:"validate",value:function(a){var b,c=this,d=c._attrsConfig,e=[{keys:["type"],id:"type"},{keys:["range","min","max"],id:"range"},{keys:["pattern","regex"],id:"pattern"},{keys:["validator"],id:"custom"}];if(d){var f=Object.keys(a);f.forEach(function(c){var f=d[c];f&&e.forEach(function(d){d.keys.forEach(function(e,h){if(e in f&&(b=g.get(d.id).validate(a[c],f),!b.isValid))return b})})})}return{isValid:!0}}},{key:"triggerAction",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=this,d=c.getStoreRef();return d._sync(a,c,b)}},{key:"getDefaults",value:function(){return{}}},{key:"reset",value:function(){this.attributes={},this.set(c.extend({},this.getDefaults()))}},{key:"normalize",value:function(a){return a}},{key:"isDirty",get:function(){return this._stateManager.isDirty},set:function(a){this._stateManager.isDirty=Boolean(a)}},{key:"isChanging",get:function(){return this._stateManager.isChanging},set:function(a){this._stateManager.isChanging=Boolean(a)}},{key:"isInvalid",get:function(){return this._stateManager.isInvalid},set:function(a){this._stateManager.isInvalid=a}},{key:"inFlight",get:function(){return this._stateManager.inFlight},set:function(a){this._stateManager.inFlight=a}},{key:"isNew",get:function(){return this._stateManager.isNew},set:function(a){this._stateManager.isNew=Boolean(a)}}],[{key:"cloneAndParseAttr",value:function(b,d){var e;return e=new a,e.idAttribute=b.idAttribute,d=b.parse(d),d=c.extendProperties({},b.attributes,d),e.set(d),e}}]),a}();return c.extendProperties(h.prototype,e.Events),c.extendProperties(h.prototype,{currentState:null}),h.extend=c["extends"],b.DSModel=h,h}),define([],function(){var a=zmail.Core.Namespaces,b=a.get("zmail.DataLayer.Utils"),c={find:function(a){return _.find(this.models,a,this)},where:function(a,b){var c=b?"find":"filter";return _[c](this.models,function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)}},d=["indexOf","lastIndexOf","every","some","forEach","map","filter","reduce","reduceRight"];return d.forEach(function(a){c[a]=function(){return this.models[a].apply(this.models,arguments)}}),c.each=c.forEach,b.CollectionUtils=c,c}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer"),c=a.get("zmail.DataLayer.Utils"),d=a.get("zmail.DataLayer.DSModel"),e=a.get("zmail.DataLayer.Core"),f=a.get("zmail.DataLayer.DSSql"),g=e.Exception,h=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,a);var c=this;c._store=b.store||null,c._storeKey=b.storeKey||null,c._initModels(b),c._initialize(b)}return babelHelpers.createClass(a,[{key:"_initModels",value:function(a){var b=this;a.model?b._model=a.model:(b._model=b.getBaseModelClass(),b._model.prototype instanceof d||(b._model=d))}},{key:"removeStoreReference",value:function(){var a=this;delete a._store,delete a._storeKey}},{key:"_initialize",value:function(a){var b=this;b.length=0,b.models=[],b._modelMap={},b.comparator=a.comparator,b._metaInfo=a.metaInfo||{},b._instanceCache=a.instanceCache}},{key:"getBaseModelClass",value:function(){return d}},{key:"_flushValues",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=this;b.length=0,b.models=[],b._modelMap={},a.flushMetaInfo&&(b._metaInfo=a.metaInfo||{}),b._isLoaded=!1}},{key:"_createModel",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=this;if(c._isModelInstance(a))return a._collection||(a._collection=c),b.store=c._store,a;b.store=c._store,b.collection=c,b.attrs=a;var d=new c._model(b);return!d.isInvalid&&d}},{key:"_isModelInstance",value:function(a){var b=this;return a instanceof b._model}},{key:"_getModelIdAttribute",value:function(){return this._model.prototype.getIdAttribute()}},{key:"get",value:function(a){var b,c,d=this;return"string"==typeof a?b=this._modelMap[a]:(c=d._getModelIdAttribute(),b=d._modelMap[a[c]],b||(b=a.uuid&&d._modelMap[a.uuid])),b}},{key:"create",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=b.sendImmediate,d=this._createModel(a,b);if(!d)return!1;c&&this.add(d,b);var e=this;return d.save(null,b).then(function(a){return c||e.add(d,a.opts),a},function(a){throw c||e.remove(d,a.opts),a})}},{key:"query",value:function(){return new f(this)}},{key:"fetchAll",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=this,c=b._store;return"undefined"==typeof a.parse&&(a.parse=!0),b.isLoaded=!1,c._sync("fetchAll",b,a).then(function(a){var c,d=a.resp;return Array.isArray(d)||"object"!==("undefined"==typeof d?"undefined":babelHelpers["typeof"](d))||(c=d.meta,d=d.data),b.set(d,a.opts),c&&b.setMetaInfo(c),b.isLoaded=!0,a},function(a){throw window.console.error("fetch all failed"),a})["catch"](function(){window.console.log("error during set")})}},{key:"add",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=this;return c.set(a,b)}},{key:"destroy",value:function(a){var b,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=this,f=e._store;c.isArray(a)||(a=[a]);var g,h=1===a.length,i=d.wait;return i||(g=this.remove(a,d)),h?(b=g[0],b.destroy(d).then(function(a,b){i&&e.remove(a,b)})):f.deleteMultiple(g,d).then(function(a,b){i&&g.forEach(function(a){e.remove(a,b)})}),g}},{key:"remove",value:function(a){var b,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=this,e=[];Array.isArray(a)||(a=[a]);for(var f=0;f<a.length;f++){b=a[f];var g;if(g=b instanceof d._model?b:d.get(b)){var h=d.models.indexOf(g);if(h!==-1){d.models.splice(h,1),d.length--;var i;i=g.isNew?g.uuid:g.id,null!==i&&delete d._modelMap[i],c.silent||(c.index=h,g.trigger("remove",g,d,c)),e.push(g),d._removeModelReference(g)}}}return e}},{key:"pluck",value:function(a){return this.models.map(function(b){return b.get(a)})}},{key:"pop",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=this.at(this.length-1);return this.remove(b,a),b}},{key:"push",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.add(a,c.extendProperties({at:this.length},b))}},{key:"shift",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=this.at(0);return this.remove(b,a),b}},{key:"unshift",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.add(a,c.extendProperties({at:0},b))}},{key:"set",value:function(a){var b,d,e,f,g,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this,j=[];
c.isArray(a)||(a=[a]);var k=h.at;k>this.length&&(k=this.length),k<0&&(k+=this.length+1),d=a.length;var l=!1,m=null,n=i.comparator&&"undefined"==typeof k&&h.sort!==!1;for("string"==typeof i.comparator&&(m=i.comparator),b=0;b<d;b++)if(f=a[b],e=i.get(f)){var o=f;i._isModelInstance(f)&&(o=f.attributes),h.parse&&(o=e.parse(o,h)),e.set(o,h),m&&!l&&n&&(l=e.hasChanged(m))}else f=i._createModel(f,h),j.push(f);if(j.length&&("undefined"==typeof k&&(k=i.length),n&&!l&&(l=!0),i._pushToCollection(k,j),i.length=i.models.length),l&&i.sort({silent:!0}),!h.silent)for(g=j.length,b=0;b<g;b++)j[b].trigger("add",j[b],i,h);return i}},{key:"sort",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=this;if(!b.comparator)throw new g("Cannot sort. No comparator found");return"string"==typeof b.comparator?b._sortBy(b.comparator):"function"==typeof b.comparator&&b.models.sort(b.comparator.bind(b)),a.silent||this.trigger("sort",this,a),this}},{key:"reset",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=this;b=b?c.clone(b):{};for(var e=0;e<d.length;e++)d._removeModelReference(d.models[e],b);return d._flushValues(b),a&&(a=this.add(a,c.extendProperties({silent:!0},b))),b.silent||d.trigger("reset",d,b),a}},{key:"_sortBy",value:function(a){var b,d=this;return b="function"===a?a:function(b){return b.get(a)},d.models=c.sortBy(d.models,b.bind(d)),d}},{key:"at",value:function(a){return this.models[a]}},{key:"triggerAction",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=this,d=c._store;return d._sync(a,c,b)}},{key:"_pushToCollection",value:function(a,b){var d=this;b.forEach(function(b,e){var f;if(b.isNew){for(f=c.getNextUUID();d._modelMap[f];)f=c.getNextUUID();b.uuid=f}else f=b.id;d._modelMap[f]=b,d.models.splice(a+e,0,b),d._addModelReference(b)})}},{key:"getStoreKey",value:function(){return this._storeKey}},{key:"_addModelReference",value:function(a){var b=this;a.on("all",b.onModelEvent,b)}},{key:"_removeModelReference",value:function(a){var b=this;a.collection===b&&delete a.collection,a.off("all",b.onModelEvent,b)}},{key:"toJSON",value:function(){var a=this;return a.map(function(a){return a.toJSON()})}},{key:"getModelId",value:function(a){var b=this,c=b.getBaseModelClass(),d=c.prototype.getIdAttribute();return a[d]}},{key:"getMetaInfo",value:function(a){var b=this;return a?"string"==typeof a?b._metaInfo[a]:void 0:b._metaInfo}},{key:"setMetaInfo",value:function(a,b){var d=this,e=d._metaInfo;"object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))?c.extendProperties(e,a):"string"==typeof a&&(e[a]=b)}},{key:"onModelEvent",value:function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var d=this,e=b[0],f=b[1];if(f&&("destroy"===e&&d.remove(f),"change"===e)){var g=d.getModelId(f._prevChangedAttr),h=f.id;g!==h&&(null!==g&&delete this._modelMap[g],null!==h&&(this._modelMap[h]=f))}d.trigger.apply(d,arguments)}},{key:"isLoaded",get:function(){return Boolean(this._isLoaded)},set:function(a){this._isLoaded=Boolean(a)}}]),a}();return c.extendProperties(h.prototype,e.Events),c.extendProperties(h.prototype,c.CollectionUtils),b.DSCollection=h,h}),define([],function(){var a=zmail.Core.Namespaces,b=a.get("zmail.DataLayer.Core"),c=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,a);var c=this;c._store=b.store,c.adapters={},c._initialize(b)}return babelHelpers.createClass(a,[{key:"_initialize",value:function(a){var b=this;b.adapterConfig=a.adapterConfig;var c=b.adapterConfig.adapters||[];a.offlineEnabled&&(b.isOfflineEnabled=!0);var d,e;c&&0===c.length&&(c=[{classObj:b._store.getDefaultAdapter(),id:"default",type:"default"}]),c.forEach(function(a,c){var f=new a.classObj;b.adapters[a.id]=f,0===c&&(d=f),"offline"===a.type&&(e=f),"default"===a.type&&(d=f)}),b.defaultAdapter=d,b.offlineAdapter=e}},{key:"getDefaultAdapterInstance",value:function(){return this.defaultAdapter}},{key:"getOfflineAdapter",value:function(){return this.offlineAdapter}},{key:"getAdapter",value:function(a){return this.adapters[a]||void 0}}]),a}();return b.InstanceCache=c,c}),define([],function(){var a=zmail.Core.Namespaces,b=a.create("zmail.DataLayer"),c=a.get("zmail.DataLayer.Core"),d=a.get("zmail.DataLayer.Adapter"),e=c.InstanceCache,f=c.Exception,g=d.HTTPAdapter,h=b.DSModel,i=b.DSCollection,j={NETWORK_STATUS_DOWN:"/network/offline",NETWORK_STATUS_UP:"/network/online"},k={read:"findRecord","delete":"deleteRecord",update:"updateRecord",create:"createRecord"},l=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,a);var c=this;c._initialize(b),c._initEvents()}return babelHelpers.createClass(a,[{key:"_initialize",value:function(a){var b=this;b._collectionKeyMap={},b._instanceCache={},b._modelKeyMap={}}},{key:"updateOfflineEvents",value:function(a,b){var c=this;c._offlineStatus=b}},{key:"isOffline",value:function(){return"offline"===this._offlineStatus}},{key:"_initEvents",value:function(){var a=this;$.subscribe(j.NETWORK_STATUS_DOWN,a.updateOfflineEvents.bind(this)),$.subscribe(j.NETWORK_STATUS_UP,a.updateOfflineEvents.bind(this))}},{key:"defineModel",value:function(a,b){return h.extend({})}},{key:"createModelInstance",value:function(a,b){var c,d=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},this);return!(!(b&&b.prototype instanceof h)||d.hasModel(a))&&c}},{key:"_registerAdapters",value:function(a,b){}},{key:"deleteInstance",value:function(a){var b=this,c=b.getInstance(a);c&&(c.removeStoreReference(),delete b._instanceCache[a],delete b._collectionKeyMap[a])}},{key:"createInstance",value:function(a,b){var c,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=this;if(!(b&&b.prototype instanceof i)||f.hasCollection(a))return!1;d.store=f,d.storeKey=a;var g=new e(d);return d._instanceCache=g,c=new b(d),f._instanceCache[a]=g,f._collectionKeyMap[a]=c,c}},{key:"registerModel",value:function(a,b){return this._createCollection(b)}},{key:"hasModel",value:function(a){return this._modelKeyMap[a]}},{key:"getInstance",value:function(a){return this._collectionKeyMap[a]}},{key:"hasCollection",value:function(a){return this._collectionKeyMap[a]}},{key:"createRecord",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=this,e=d.getInstance(a);return e.create(b,c)}},{key:"deleteRecord",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=this,e=d.getInstance(a);return e.destroy(b,c)}},{key:"deleteRecords",value:function(a,b){var c=this,d=c.getInstance(a);return d.remove(b)}},{key:"updateRecord",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=this,e=d.getInstance(a);return e.update(b,c)}},{key:"peekRecord",value:function(a,b){var c=this,d=c.getInstance(a);if(!d)throw new f("Invalid id. No instances registered with that name");return d.get(b)}},{key:"findRecord",value:function(a,b){var c=this,d=c.getInstance(a);if(!d)throw new f("Invalid id. No instances registered with that name")}},{key:"fetchAll",value:function(a){var b=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},this),c=b.getInstance(a);if(!c)throw new f("Invalid id. No instances registered with that name");return c.fetchAll()}},{key:"_deleteRecords",value:function(a,b){var c=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},this),d=b.getStoreKey(),e=c._instanceCache[d],f=e.getDefaultAdapterInstance();return f._deleteRecords()}},{key:"_localSync",value:function(a,b,c,d){var e,f=this,g=b.getStoreKey(),j=f._instanceCache[g],k=j.getOfflineAdapter();if(k)if("read"===a||"fetchAll"===a)if(b instanceof i)for(var l=b,m=l.getBaseModelClass(),n=m.prototype.getIdAttribute(),o=0,p=d.length;o<p;o++){var q=d[o];e=l.get(q[n]),e=e?h.cloneAndParseAttr(e,q):new l._model(q,c),c.attrs=q,k.updateRecord(e,c)}else e=h.cloneAndParseAttr(b,d),c.attrs=d,k.updateRecord(e,c);else"create"===a?(e=h.cloneAndParseAttr(b,d),k.createRecord(e,c)):"update"===a?k.updateRecord(e,c):"delete"===a&&k.deleteRecord(b,d)}},{key:"_sync",value:function(a,b,c){var d,e=this;b instanceof i&&(c.isCollectionAction=!0);var f,g,h=b.getStoreKey(),j=e._instanceCache[h],l=c.adapterId;if(l)g=j.getAdapter(l);else{var m=j.getDefaultAdapterInstance();g=m,f=e.isOffline(),f&&(g=j.getOfflineAdapter(),c.isOffline=!0),g||(g=m)}var n,o,p=k[a];return p?n=g[p]:(o=!0,n=g.sync),d=o?n.call(g,a,b,c):n.call(g,b,c),f||!j.isOfflineEnabled||l||setTimeout(function(){d.then(function(d){var f=d.resp;e._localSync(a,b,c,f),window.console.log("local Sync called")})}),d}},{key:"getDefaultAdapter",value:function(){return g}}]),a}();return b.DataStore=l,l}),define([],function(){var a,b=zmail.Core.Namespaces,c=b.get("zmail.DataLayer"),d=c.DataStore,e=function(){a=new d,window.ZMStore=a};return e(),a});
"use strict";!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.Compose.SuggestedContactsMenu"),c=zmail.Components.InputSuggestionMenu,d={headerLabel:"Often grouped with"},e={HEADER:["font-size: 11pt","font-weight: 600","padding: 10px","color: #0088cc"].join("; ")+";",HEADER_ICON:["color: #0088cc","padding: 0px","font-size: 15pt","margin-right: 10px","vertical-align: middle"].join("; ")+";",HEADER_LABEL:["display: inline-block","vertical-align: middle","margin-left: 5px"].join("; ")+";"},f={LIST:['<div class="SC_dd SC_zi900" ref="wrapper">','<div class="content-wrapper" ref="contentWrapper">','<div class="header" style="'+e.HEADER+'">','<i class="msi-contacts" style="'+e.HEADER_ICON+'"></i>','<span style="'+e.HEADER_LABEL+'">'+d.headerLabel+"</span>","</div>",'<ul class="SC_P2r" ref="listWrapper">',"</ul>","</div>","</div>"].join("")},g=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"getTemplate",value:function(){return f.LIST}}]),b}(c.BaseClass),h=function(a){var b=$.Deferred();return setTimeout(function(){zmAppLoader.load("autoComplete").done(function(){b.resolve(new g(a))})},0),b.promise()};b.createMenu=h,b.Events=c.Events}(),window.zmComp=function(){zmail.isComposeCreated=$.Deferred();var a=0,b={},c={},d=function(){var a=zmText.get("zmcompose");return a}(),e=function(a,b,d){var e={},f="",g="",h="",i=["draft","template","outbox","eanew","compose"];"reply"===b?f=d.REPLYTO:"replyall"===b?(f=d.REPLYTO,g=d.REPLYCC,c[a].groupEmailId&&(g?g+=","+c[a].groupEmailId:g=c[a].groupEmailId)):i.indexOf(b)!==-1&&(f=d.TO,g=d.CC,h=d.BCC),f=f||"",g=g||"";var j;zmComp.getFID(a)&&(j=zmComp.getFID(a));var k=!1;return"reply"!==b&&"replyall"!==b||(k=!0),j&&zmail.folId.sId===j&&d&&d.BCC&&k&&(h=d.BCC),h=h||"",e.TO=f,e.CC=g,e.BCC=h,e},f=function(a){c[a]&&c[a].data&&c[a].data.EXTIMG&&zmCUtil.loadExtImages(a,c[a].data.EXTIMG)},g=function(a){var b;c[a]&&c[a].data&&c[a].data.SHDOC&&(b=c[a].data.SHDOC);var d,e,f=[],g=[],h=[];if(b&&b.SHDOCID){var i=b.SHDOCID;i.indexOf(",")!==-1?g=i.split(","):g.push(i),g.length&&(d=zmComp.getEditor(a),e=d.doc,f=$(e).find('a[name="ZM_SHAREDOC"]'))}if(f.length)for(var j=f.length,k=0;k<j;k++){var l=f[k],m=l.href;if(m){var n=m.split("/");if(n.length){var o=n[n.length-1];$.inArray(o,g)>=0&&h.push({docId:o,docEle:l})}}}if(h.length){d=zmComp.getEditor(a),e=d.doc;var p=$(e.head).find('style[id="docHOVER_'+a+'"]');p.length||$(e.head).append(zmComp.docHover(a));for(var q=0;q<h.length;q++){var r={};r.docId=h[q].docId;var s=$(h[q].docEle).html();r.docName=s,$(h[q].docEle).closest("table").replaceWith($(zmComp._zdocTxt(a,r)))}}},h=function(a,b){var d={},e={},f={};d=zmComp.cmpGetAddr(a,"to"),e=zmComp.cmpGetAddr(a,"cc"),f=zmComp.cmpGetAddr(a,"bcc"),d.address&&(b.to=d.address),e.address&&(b.cc=e.address,b.isCC=!0),f.address&&(b.bcc=f.address,b.isBCC=!0);var g=c[a].mode;"compose"!==g&&"fwdi"!==g&&"fwdme"!==g||(b.isCC=!0),b.from=zmComp.getFromAddr(a),b.subject=zmComp.getSubject(a),b.replyto=zmComp.getReplyto(a),zmComp.getMymId(a)&&(b.msgId=zmComp.getMymId(a)),b.askreceipt=zmComp.getAskReceipt(a);var h=zmComp.getPriorityDom(a),i=h.elem;i&&i.is(":visible")&&(b.isPriority=!0)},i=function(a){var b=a.cmpId;if(zmComp.isModified(b)){a.action="sdraft",a.sendIm=!1;var c=a.viaType;c&&"adraft"===c&&(a.autosave=c),zmComp.sendMail(a)}},j=function(a){var b=setInterval(function(){var b={};b.cmpId=a,b.viaType="adraft",b.calleeType="interval",i(b)},6e4);zmComp.setInterVal(a,b)},k=function(a,b,e){var f=$("#zmRepLst_"+a).closest("li");$("#zmRepLst_"+a).off("click").on("click",function(){var b={},c=[{htm:d.reply,data:{action:"reply",msgId:e,par:f}},{htm:d.replyall,data:{action:"replyall",msgId:e,par:f}},{htm:d.forward,data:{action:"fwdi",msgId:e,par:f}}];b.align="pleft",b.list=c,b.clk=function(a){zmComp.chgReply(a.action,a.type,a.msgId,a.par),zmUtil.hideMenu()},b.par=f,$("#zmRepLst_"+a).closest("b").addClass("SC_ddn"),zmUtil.showMenu(b)});var g=b;c[a].inlineMode&&(g=c[a].inlineMode);var h="msi-reply";"replyall"===g?h="msi-replyall":"fwdi"===g?h="msi-forward":"eanew"===g&&(h="msi-edit"),$("#zmRepIcn_"+a).removeClass().addClass(h)},l=function(a){zmAutoFill.resizeInput(a)},m=function(a,b){var d="",e=!1,f=zmComp.getFromObj(),g=zmail.fromAddr;zmComp.getFromAddr(a)&&(g=zmComp.getFromAddr(a));var h=(f[g]||{}).FRM_SIGID;if(h&&"null"!==h){var i=zmComp.getSignObj();i[h]&&(d='<div id="Zm-_Id_-Sgn">'+i[h].SIG_CONT+"</div>",1===i[h].SIG_POS&&(e=!0))}var j=b;return c&&c[a]&&c[a].prm&&"note"===c[a].prm.entityType&&(e=!1),j=e?"<br><br>"+d+"<br>"+j:"<br><br>"+j+"<br>"+d},n=_.debounce(function(a){var b={};b.cmpId=a,i(b)},5e3),o=function(a,b,d){try{var e="zm"+b+"txt_"+a;d=zmUtil.replaceHTMLEntities(d),zmAutoFill.contactFill(d,$("#"+e),!0,[],{source:"compose",modifyDOM:function(a){a=a||{},zmComp.debugLog(a.contact),zmComp.debugLog(a.dom)}}),c[a]||$("#"+e).attr("disabled",!0)}catch(f){zmComp.debugLog(f)}},p=function(a,b){return b.getSmiley=function(a){var b=zmSmiley.getSmiley(a);return b},b.handleAutoFill=!0,b.getNewAutofillContacts=zmCUtil.getContacts,b.getDraftImageReplacedContent=function(a){a.cmpId=a.cmpId.split("_")[1];var b,d=c[a.cmpId].inlinemapObj;if(Object.keys(d).length>=1){var e=Object.keys(d),f=e.length,g=document.createDocumentFragment();g.appendChild(document.createElement("div")),g.firstChild.innerHTML=a.content;for(var h=g.firstChild.getElementsByTagName("img"),i=h.length,j=0;j<f;j++)for(var k=0;k<i;k++)h[k].getAttribute("src")===e[j].replace(/&amp;/g,"&")&&(h[k].src=d[e[j]].replace(/&amp;/g,"&"));return b=g.firstChild.innerHTML}},b.triggerOnMention=function(b){try{if(c[a]&&!c[a]._atMentionObj&&(c[a]._atMentionObj=[]),c[a]._atMentionObj&&c[a]._atMentionObj.indexOf(b.eid)===-1){c[a]._atMentionObj.push(b.eid);var d=b.fn+" <"+b.eid+">";o(a,"to",d)}}catch(e){zmComp.debugLog(e)}},b},q=function(b,e){return e.handlePasteImages=!0,e.mouseUpActionTriggered=function(a){$.publish("mail/composeKeyAction",a)},e.processPastedFile=function(e,f,g,h,i,j){e.dataURI&&(e.file=zmCUtil.dataURItoBlob(e.dataURI));var k;"file"===j?zmAttachComponent.imageEditTool.init({file:e.file,onAttach:function(a){e.file=a.blob,k()},onClose:function(){},handBckObj:function(){}}):"source"===j&&zmAttachComponent.imageEditTool.init({source:e,onAttach:function(a){e={},e.file=a.blob,k()},onClose:function(){},handBckObj:function(){}}),k=function(){if(e.file){var f,j=a,k="pastImg_"+b+"_uId"+j,l=(new Date).getTime()+".png",m=0;if(e&&e.file){if(e.file&&(f=e.file,e.file.name&&(l=e.file.name)),l.lastIndexOf(".")!==-1){var n=l.substr(l.lastIndexOf("."));"png"!==n&&(l+=".png")}else l+=".png";e.file.size&&(m=e.file.size)}var o=3145728;if(m>o){var p=d.imageupload_size_exceeds,q="<h4>"+p+"</h4>",r=$("<div/>");r.attr("id","zmcmp_pasteupload_"+b),r.html(q);var s={};return s.cmpId=b,s.$content=r,s.ignoreMouseDown=!1,s.dialogDidMount=function(a){$("#zmcmp_pasteupload_"+b)[0].zmcmp_pasteupload_dialog_ele=a;var c=a.$els.$maskWrapper;c.on("mousedown",function(b){var c=b.target||b.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):a.remove()})},s.defaultNavigator=!1,s.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_pasteupload_"+b)[0].zmcmp_pasteupload_dialog_ele.remove()}}),s.buttons=[{name:d.ok,callback:function(a){a.remove(),e.file&&(e.file.name||(e.file.name="Screenshot_"+(new Date).getTime()+".png"),zmComp.getAttRef(b).uploadFiles([e.file]))}},{name:d.cancel,isCancel:!0,callback:function(a){a.remove()}}],void Dialog["new"](s)}var t=new XMLHttpRequest;c[b].imagepending++,t.upload.addEventListener("loadstart",function(){g(k)},!1);var u=new FormData,v=zmAjq.getCookie("zmcsr");u.append("aId",zmail.accId),u.append("frm","c"),u.append("uploadMode","drop"),u.append("mode","composeSet"),u.append("zmrcsr",v),u.append("img_file",f,l),t.onreadystatechange=function(){if(4===t.readyState)if(c[b].imagepending--,200===t.status){var a,d=$.parseJSON(t.responseText),e=d.fileName,f=d.aId,g=d.storeName,j=d.frm;e&&f&&g&&j?(a="/mail/ImageSignature?fileName="+e,a+="&accountId="+f+"&storeName="+g,"c"===j&&(a+="&frm=c"),h(a,k)):i(k)}else i(500===t.status||400===t.status?k:k)},t.open("POST",zmail.conPath+"/zeUploadImage.do",!0),t.send(u),a++}}},e},r=function(a){var b=zmComp.getZDocLoc(a);if(b.length&&"plaintext"===zmComp.getEditor(a).mode&&(c[a].plaindoclink=b),c[a].newsave){var d={};d.cmpId=a,d.calleeType="afterEditorLoad",i(d)}c[a].aftersave&&zmComp.afterSave(a,"close_false",c[a].aftersave);var e=c[a].editor;f(a),g(a);var h=!0;c[a].type&&"p"===c[a].type&&(h=!1);var j=e.doc.body;"plaintext"===e.mode&&(j=e._textarea),h&&j.setAttribute("data-enableShortcuts","true"),zmComponent.keybindings.listener.add(e.doc),zmComponent.bind({ev:"click",fn:zmUtil.hideMenu,args:[!0,!1],elm:e.doc,capture:!0}),navigator.userAgent.indexOf("Safari")!==-1?e.doc.addEventListener("mousedown",function(b){zmComp.showTrimmed(a,b)},!0):e.doc.attachEvent?e.doc.attachEvent("onmousedown",function(b){zmComp.showTrimmed(a,b)}):e.doc.addEventListener&&e.doc.addEventListener("mousedown",function(b){zmComp.showTrimmed(a,b)},!0),ZE_Init.inlineImage=zmWUtil.editorInlineImage,zmComp.setLastModified(a,0),zmComp.setPrevModified(a,0),"undefined"!=typeof zmail.isComposeCreated&&zmail.isComposeCreated.resolve()},s=function(a,b,c,d,e){var f=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==f&&(ZE_Init.defaultFontFamily=f);var g=zmCUtil.getfontSize();g&&(ZE_Init.defaultFontSize=g+"pt");var h=zmCUtil.getfontColor();h&&(ZE_Init.defaultFontColor=h);var i="";"compose"===d||"fwdi"===d||"fwdme"===d?ZE_Init.needEditorFocus=!1:ZE_Init.needEditorFocus=!0,ZE_Init.fileUpload=zmComp.editorDropUpload,e&&"inline"===e?ZE_Init.toolbarOrder=zmCUtil.getInlineToolbar():ZE_Init.toolbarOrder=zmCUtil.getTabToolbar();var j={};j.id="zmEdi_"+a,j.contentChanged=function(){zmail.showFeature&&n(a),zmComp.setLastModified(a,(new Date).getTime()),zmComp.setModified(a,1)},j=p(a,j),j=q(a,j),"plaintext"===b&&(c=ZE.getText(c),j.mode="plaintext"),j.content=c,j.isResizeRequired=!0,j.customAttachArr=function(){return["custom","Attachment","zei-attachment",function(a){zmComp.triggerCloudUpload(a)}]},ZE_Init.editorCoreLoaded.done(function(){j.defaultfontfamily=zmail.mailOpt.ff,i=ZE.create(j),zmComp.setEditor(a,i);try{var b=function(a){return function(){r(a)}};zmComp.getEditor(a).afterEditorLoad(b(a,d))}catch(c){}})},t=function(a,b,c,d){var e=c;"draft"!==b&&"template"!==b&&"outbox"!==b&&"eanew"!==b&&(e=m(a,c));var f="richtext";0===zmComp.getDefault().smType&&(f="plaintext"),s(a,f,e,b,d)},u=function(a){var b="",d=!1,e=zmComp.getMode(a);return!e||"reply"!==e&&"replyall"!==e||(d=!0),c&&c[a]&&zmComp.getShareId(a)&&d&&zmComp.delegateEID(a)&&(b=zmComp.delegateEID(a)),b},v=function(a,b,c){var d=[];c&&c.NEWATT&&"replyall"!==b&&"reply"!==b&&(d=c.NEWATT),zmComp.initAttachComp(a,d)},w=function(a){var b=[];c&&c[a]&&c[a].attCompRefList&&(b=c[a].attCompRefList),zmComp.initAttachComp(a,b)},x=function(a,b,c){var e=zmComp.getFromData(b,c),f=!1;u(a)&&(e=u(a),f=!0);var g=zmComp.getFromDispN(e);$("#zm_fromaddr_"+a).text(g),zmComp.setFromAddr(a,e);var h=zmCUtil.getReplyTo(e);if(h?($("#zm_repSel_"+a).removeClass("SC_dyn"),zmComp.setReplyto(a,h)):$("#zm_repSel_"+a).addClass("SC_dyn"),$("#zm_replyto_addr_"+a).text(h),f){var i=$("#zm_fSel_"+a),j='<font id="zm_fdeleSel_'+a+'">';j+=d.shared_from_address_info,j+="</font>",$(i).append(j)}else $("#zm_fdeleSel_"+a).remove()},y=function(a,b){var c=b.SENTTIME||"",d=b.SENDER||"",e=b.FROM||"",f=b.TO||"",g=b.CC||"",h=b.SUBJECT||"",i="";return d&&(d=_zm.escapeTags(d)),"fwdi"!==a?(i="<div id='Zm-_Id_-Sgn1'><br>",""!==c&&(i+=" ---- On "+c),""===d&&""===e||(i+=""!==d&&d!==e?"&nbsp;<b>"+d+" &lt;"+e+"&gt;</b>":"&nbsp;<b>&lt;"+e+"&gt;</b>",i+=" wrote ---- </div><br>")):(i="<div id='Zm-_Id_-Sgn1'><br>============ Forwarded message ============<br>",""===d&&""===e||(i+=""!==d&&d!==e?"From : "+d+" &lt;"+e+"&gt;":"From : "+e,i+="<br>"),""!==f&&(i+="To : "+f+"<br>"),""!==g&&(i+="Cc : "+g+"<br>"),""!==c&&(i+="Date : "+c+"<br>"),""!==h&&(i+="Subject : "+h),i+="<br>============ Forwarded message ============</div><br>"),i},z=function(a){var b={contentArray:"",compare:["fn","ln","fn_ln","eid","fn_mn_ln","nn","mn"],LType:"1",OType:"1",onBubbleDOMCreate:function(b){if(b=b||{},zmail.showFeature&&c[a].info&&c[a].info.recipientList&&b.contact&&b.dom){var d=c[a].info.recipientList;d&&b.contact.eid&&"SUCCESS"!==d[b.contact.eid]&&$(b.dom).addClass("zmfail"),d&&b.contact.eid&&"SUCCESS"===d[b.contact.eid]&&$(b.dom).addClass("zmsuc")}}};"outbox"===c[a].mode?b.actionCallback=zmComp.modifyOutbox:b.actionCallback=zmComp.modifyRecipients,b.onInputFocusBlur=function(b){var c,d,e=zmCUtil.getElemId(b);if(e){c=e.cmpId,d=e.eleType;var f=b.type,g=zmComp.getShowSuggestions(a);g&&c&&"focus"===f&&zmComp.setSugType(c,d)}zmComp.setHeight(e.cmpId)},b.onEscKeyPress=function(b){var c,d=zmCUtil.getElemId(b);d&&(c=d.cmpId,c&&(zmComp.setShowSuggestions(c,!1),zmTooltip.remove(),zmCUtil.removeSugList(a)))},zmAutoFill.setAutofill(b,$("#zmdArea_"+a+" .zm_sgst"))},A=function(a,b,d){var e="";if(d.CONTENT&&(e=d.CONTENT,d.BLCKCON&&(e+=d.BLCKCON)),e=zmComp.parseHTML(e),"reply"===b||"replyall"===b||"fwdi"===b){var f=y(b,d),g=f,h="style='border-left: 1px solid #cccccc; padding-left: 6px; margin:0 0 0 5px'";g+="<blockquote "+h+">"+e+"</blockquote>";var i=!1,j=c[a].type;if("p"!==j||"reply"!==b&&"replyall"!==b||(i=!0),zmCUtil.isIE()&&(i=!1),i){var k="name='ZM_SHWTRIM' ";k+="title='Show trimmed content' ";var l="background-image:url("+zmResource.get("image","compose/ellipse.png")+");";l+="background-position: 0 0; background-size:22px auto;",l+="background-repeat: no-repeat;cursor: pointer;",l+="display: inline-block;",l+="height: 10px;",l+="margin: 0 auto;",l+="vertical-align: middle;",l+="width: 22px;",k+="style='"+l+"'",e="<div "+k+"></div>",e+="<div class='zmail_extra' style='display:none;'>"+g+"</div>"}else e="<div class='zmail_extra'>"+g+"</div>"}return e},B=function(a,b,c){v(a,b,c),c.MAILID&&zmComp.setMailId(a,c.MAILID),c.REFHEADER&&zmComp.setRefHeader(a,c.REFHEADER),c.INREPLYTO&&zmComp.setInReplyTo(a,c.INREPLYTO),zmComp.setCmpHeader(a,b),z(a);var d=e(a,b,c),f=d.TO,g=d.CC,h=d.BCC;f&&""!==$.trim(f)&&o(a,"to",f),g&&""!==$.trim(g)&&"Not Provided"!==$.trim(g)&&(o(a,"cc",g),zmComp.shCBc(a,"c")),h&&$.trim(h)&&(o(a,"bcc",h),zmComp.shCBc(a,"b"))},C=function(a){zmComp.setFromObj(zmComp.frmListObj(zmail.cmpdata.FROM_LIST));var b=$.extend({},zmComp.getFromObj());if(u(a)){var c=u(a);b[c]=zmail.cmpdata.FROM_LIST[c]}var d,e={},f=[];for(var g in b)d={htm:zmComp.lstFromDispN(g),data:{frm:g,signId:(b[g]||{}).FRM_SIGID}},f.push(d);e.list=f,e.par=$("#zm_fSel_"+a),e.align="pleft",e.clk=function(b){zmCUtil.cmpSTVal(b.signId,b.frm,a),zmUtil.cmpHideMenu()},zmUtil.showMenu(e)},D=function(a){var b,c=zmComp.getReplyToLst(),d={},e=[];for(var f in c)b={htm:f,data:{frm:f}},e.push(b);d.list=e,d.par=$("#zmrTo_"+a),d.align="pright",d.clk=function(b){zmCUtil.repSTVal(b.frm,a)},zmUtil.showMenu(d)},E=function(a){var b=$.extend({},zmComp.getFromObj());if(u(a)){var c=u(a);b[c]=zmail.cmpdata.FROM_LIST[c]}var d=zmComp.objSize(b);1===d?$("#zm_fSel_"+a).children().eq(0).removeClass().addClass("SC_cs SC_np SC_ni"):d>1&&$("#zm_fSel_"+a).off("click").on("click",function(){C(a)});var e=zmComp.objSize(zmComp.getReplyToLst());1===e?$("#zmrTo_"+a).children().eq(0).removeClass().addClass("SC_cs SC_np SC_ni"):e>1&&$("#zmrTo_"+a).off("click").on("click",function(){D(a)})},F=function(a,b){"fwdi"===b?$("#zmto_"+a).get(0).scrollIntoView():c[a].info&&!c[a].info.disableScrollIntoView&&$("#zmEdi_"+a).get(0).scrollIntoView()},G=function(a,b,c){c&&""!==$.trim(c)&&(c=zmCUtil.getText(c),"reply"!==b&&"replyall"!==b||c.match(/^Re:/gi)?"fwdi"!==b||c.match(/^Fwd:/gi)||(c="Fwd: "+c):c="Re: "+c,c=c.substr(0,1e3),$("#zmsub_"+a).val(c),zmComp.setSubject(a,c))},H=function(a){$("#zmsub_"+a).keyup(function(){c[a]&&"t"===c[a].type&&zmComp.updateTitle(a);var b=$("#zmsub_"+a).val();b&&""!==$.trim(b)&&(zmComp.setModified(a,1),zmComp.setSubject(a,b))})},I=function(a,b){var c=zmComp.getFwdAtt(a,b.FWDMSG,b.FWDTID),d=c.fwdLst,e=[],f=[];if(d.length){for(var g=c.subject,h=d.length,i=0;i<h;i++)d[i].thrd?f.push(d[i].mId):e.push(d[i].mId),zmComp.attach_fwdme(a,d[i]);zmComp.setFwdThrd(a,f),zmComp.setFwdMsg(a,e),g&&""!==$.trim(g)&&($("#zmsub_"+a).val(b.SUBJECT),zmComp.setSubject(a,g))}},J=function(a,b){zmComp.removeDiscard();var d="CmpW"+(new Date).getTime(),e=b.mode,f=b.msgId;zmComp.frmComp(),zmComp.windowCmpId=d,b.data?(a=b.data,a.mdata&&(a=a.mdata)):a.mdata&&(a=a.mdata),c[d]=new zmComp.newInstance(e),c[d].type="w",c[d].askreceipt?zmComp.setAskReceipt(d,"yes"):zmComp.setAskReceipt(d,"no"),c[d].type=b.type,c[d].info=b.info,a&&!$.isEmptyObject(a)&&(c[d].data=a);var g={};g.cmpId=d,g.type="w";var h=zmCompOpt.headerDOM(g),i=zmCompOpt.recipientDOM(g),l=zmCompOpt.editorDOM(g),m=zmCompOpt.attDOM(g);if($("#zmComposeWrapper").append(h,i,l,m),$("#zm_repSel_"+d).addClass("SC_dyn"),zmComp.getReplyto(d)&&$("#zm_repSel_"+d).removeClass("SC_dyn"),$("#zm_fromaddr_"+d).text(zmail.fromAddr),$("#zm_replyto_addr_"+d).text(zmComp.getReplyto(d)),zmComp.setMymId(d,f),b&&b.shId&&zmComp.setShareId(d,b.shId),x(d,e,a),G(d,e,a.SUBJECT),b.isFwd&&(c[d]._referOpener=!0),b.isPopMail&&(c[d].isPopMail=!0),(a.FWDMSG||a.FWDTID)&&I(d,a),a.docsObj){for(var n=a.docsObj.docName.length,o=0;o<n;o++){var p={docName:a.docsObj.docName[o],docPath:a.docsObj.docPath[o],docStore:a.docsObj.docStore[o]};zmComp.setDocsPreview(d,p)}zmComp.setDocsObj(d,{docName:a.docsObj.docName,docPath:a.docsObj.docPath,docStore:a.docsObj.docStore})}!a.STATUS2ID||5!==a.STATUS2ID&&6!==a.STATUS2ID&&7!==a.STATUS2ID||(c[d].inlineMode=zmComp.getModeObj("string",a.STATUS2ID)),b.info&&b.info.draftId&&(a.MAILID&&(c[d].discard_mailId=a.MAILID),a.INREPLYTO&&(c[d].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(c[d].discard_refHeader=a.REFHEADER)),f&&zmCUtil.setTempFolId(d,f),k(d,e);var q=A(d,e,a);B(d,e,a,b);var r="tab";"p"===c[d].type&&(r="inline"),t(d,e,q,r);var s=!1;"reply"!==e&&"replyall"!==e&&"fwdi"!==e||(c[d].loadType="drafted",c[d].changeData=!0,s=!0),b.info&&b.info.loadType&&"drafted"===b.info.loadType&&(c[d].loadType=b.info.loadType,c[d].changeData=!1,s=!1),c[d].loadType&&"drafted"===c[d].loadType&&zmComp.updateMsgObj(f,d),s&&(c[d].loadsave=!0),"compose"!==e&&"fwdi"!==e&&"fwdme"!==e||zmComp.setElemFocus($("#zmto_"+d)),zmCUtil.resizeRepDOM(d),zmComp.setHeight(d,"w"),E(d),F(d,e),j(d),zmUtil.addCmpAppId(),H(d),"outbox"===e&&zmComp.updateOutbox(d)},K=function(a){if(a){var b=function(){var a={allowDragOver:!0};return a},c=function(b){var c,d=b.dragObj;"draggingAtt"===b.dragObj.id?c=d.type.attList:"attachView"===b.dragObj.id&&(c=d.type.attObj);var e=$(a).attr("id").split("_")[1],f={};f.NEWATT=c,zmComp.insertAttachment(e,f),zmComp.hideDrag()};if(!zmail.dndComp)return!1;var d=new zmail.dndComp.Drop;d.init(a,{onDrop:c,onDragOver:b})}},L=function(a,b){zmComp.removeDiscard();var e=zmUtil.getCmpAppId(),f=b.mode,g=b.msgId;zmComp.frmComp(),b.data?(a=b.data,a.mdata&&(a=a.mdata)):a=a.mdata?a.mdata:zmContentCache.get(g),c[e]=new zmComp.newInstance(f),c[e].askreceipt?zmComp.setAskReceipt(e,"yes"):zmComp.setAskReceipt(e,"no"),c[e].type=b.type,c[e].info=b.info,!g&&b.info.msgId?g=b.info.msgId:!g&&b.info.draftId&&(g=b.info.draftId),a&&!$.isEmptyObject(a)&&(c[e].data=a);var h=b.info.prevDOM;if(!h)return void zmComp.showMsg(e,"i","2"+d.preview_notload,"p");var i={};i.cmpId=e,i.type="p",i.msgId=g,b.info.draftId&&(i.draftId=b.info.draftId);var l=zmCompOpt.headerDOM(i),m=zmCompOpt.recipientDOM(i),n=zmCompOpt.dragDOM(i),o=zmCompOpt.editorDOM(i),p=zmCompOpt.attDOM(i),q=$("<div/>");q.attr("class","zm_cmp"),q.attr("id",e+"_"+g),q.append(l,m,o,p,n),K(n[0]),h.html(q),zmUtil.setInlineCmpScope(!0),zmComp.setMymId(e,g),b.info.draftId&&(c[e].discard_Id=b.info.draftId),b&&b.shId&&zmComp.setShareId(e,b.shId),x(e,f,a),G(e,f,a.SUBJECT),!a.STATUS2ID||5!==a.STATUS2ID&&6!==a.STATUS2ID&&7!==a.STATUS2ID||(c[e].inlineMode=zmComp.getModeObj("string",a.STATUS2ID)),b.info&&b.info.draftId&&(c[e].discard_Id=g,c[e].enableDiscard=!0,a.MAILID&&(c[e].discard_mailId=a.MAILID),a.INREPLYTO&&(c[e].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(c[e].discard_refHeader=a.REFHEADER)),g&&zmCUtil.setTempFolId(e,g),k(e,f);var r=A(e,f,a);B(e,f,a,b);var s="tab";"p"===c[e].type&&(s="inline"),t(e,f,r,s);var u=!1;"reply"!==f&&"replyall"!==f&&"fwdi"!==f||(c[e].loadType="drafted",c[e].changeData=!0,u=!0),b.info&&b.info.loadType&&"drafted"===b.info.loadType&&(c[e].loadType=b.info.loadType,c[e].changeData=!1,u=!1),c[e].loadType&&"drafted"===c[e].loadType&&zmComp.updateMsgObj(g,e),u&&(c[e].loadsave=!0),"compose"!==f&&"fwdi"!==f&&"fwdme"!==f||zmComp.setElemFocus($("#zmto_"+e)),zmCUtil.resizeRepDOM(e),zmComp.setHeight(e),zmComp.updAtMention(e),E(e),F(e,f),j(e),zmUtil.addCmpAppId(),H(e)},M=function(a,b){var c=function(){return zmText.get("mailsuite","compose")},e={appname:d.nosubject,defaultAppName:zmText.get("mailsuite","compose"),appId:a,data:{CNodes:"2"},onDelete:zmComp.delCompObj,noPreview:!0,appIcon:"msi-edit",shortcuts:zmshCut.compose,allowDefaultShortcutScope:!1,titleProvider:c,hashKey:"compose",hashChangeHandler:function(a){var b=this;zmUtil.debugLog("Compose hash url changed",a,b)}};if(zmsuite.isWorkspaceAvailable(a))b.restore&&zmsuite.resetWorkspace(a,e);else if(!zmsuite.setWorkSpace(e))return!1},N=function(a,b){zmComp.removeDiscard(),M(a,b);var c=zmsuite.getCenter(),e=c[0].getNodes(),f=["msi-send SC_thm",{txt:d.send}];zmComp.getDefault().outIntr!==-1&&f.push("msi-barrow");var g={iconList:f,tooltip:d.send,data:"s",dropAction:!0,customClass:"SCtxt SCBtn"},h={iconList:["msi-schdRecur"],tooltip:d.schedule+" / "+d.recurring,data:"cmp_schedule",separator:!0},i={iconList:["msi-mailReminder"],tooltip:zmText.get("zmreminder").watch.remind,data:"watch",separator:!0};0===zmComp.getDefault().askReceipt?zmComp.setAskReceipt(a,"yes"):zmComp.setAskReceipt(a,"no");var j=[{txt:d.save_draft,hide_txt:!0},"msi-barrow"],k={iconList:j,tooltip:d.save_as_draft,data:"svedrp",dropAction:!0},l={iconList:["msi-trash"],tooltip:d.discard_draft,data:"d",separator:!0};"outbox"===zmComp.getMode(a)&&(l.tooltip=d.discardTxt);var m={iconList:["msi-action"],tooltip:d.options,separator:!0,data:"o"},n={iconList:[{txt:d.sharedraft,hide_txt:!0}],data:"cmp_share",separator:!0},o={iconList:["msi-priority"],tooltip:d.priority,data:"p",separator:!0},p={iconList:["msi-comment"],separator:!0,data:"cmp_cmt"},q=[{groupId:"sendOptions",actionArr:[g]},{groupId:"compSchedule",actionArr:[h]}];zmUtil.isZohoAccount(zmail.accId)&&q.push({groupId:"remind",actionArr:[i]}),q.push({groupId:"compPriority",actionArr:[o]}),q.push({groupId:"compOptions",actionArr:[m]});var r=[{groupId:"saveOptions",actionArr:[k]},{groupId:"compShare",actionArr:[n]}];r.push({groupId:"discard",actionArr:[l]}),r.push({groupId:"compComment",actionArr:[p]});var s={list:{left:q,right:r},clk:function(b,c,e){var f,g,h=b.target||b.srcElement;if(f=$(h).closest("li"),"s"===e)g={},g.action="compose",g.sendIm=!1,g.cmpId=a,zmCDrop.showDropDown(b,g);else if("cmp_schedule"===e)g={},g.id=a,g.ele=f,g.title=d.schedule+" / "+d.recurring,g.component="compose",g.type=2,zmSchedule.initScRec(g);else if("d"===e){var i={};i.cmpId=a,zmComp.discardCmp(i)}else if("p"===e)g={},g.cmpId=a,g.par=f,g.id="zm_priLst",zmCDrop.show(g),zmUtil.stopEvents(b);else if("o"===e)g={},g.id="zm_compactLst",g.par=f,g.cmpId=a,zmCDrop.show(g);else if("cmp_cmt"===e)zmComp.toggleComment(a);else if("c"===e){var j={};j.cmpId=a,zmComp.comClose(j)}else"ar"===e?zmCUtil.askRepTab(a):"watch"===e?(g={},g.msgId=a,g.loadType="popup",g.openWatch="compose_tab",g.elem=f,zmWatch.showWatch(g)):"svedrp"===e&&("msi-barrow"===c?(g={},g.id="zm_SveLst",g.par=f,g.cmpId=a,zmCDrop.show(g),zmUtil.stopEvents(b)):(g={},g.cmpId=a,zmComp.updateDraft(g)))}};return e[0].push(s.list),e[0].setListener("click",s.clk),zmsuite.renderWorkSpace(),e[1].$el},O=function(a,b,c){x(a,b,c),G(a,b,c.SUBJECT),(c.FWDMSG||c.FWDTID)&&I(a,c),v(a,b,c),c.MAILID&&zmComp.setMailId(a,c.MAILID),c.REFHEADER&&zmComp.setRefHeader(a,c.REFHEADER),c.INREPLYTO&&zmComp.setInReplyTo(a,c.INREPLYTO),zmComp.setCmpHeader(a,b),z(a);var d=e(a,b,c),f=d.TO,g=d.CC,h=d.BCC;f&&""!==$.trim(f)&&o(a,"to",f),g&&""!==$.trim(g)&&"Not Provided"!==$.trim(g)&&(o(a,"cc",g),zmComp.shCBc(a,"c")),h&&$.trim(h)&&(o(a,"bcc",h),zmComp.shCBc(a,"b")),"fwdi"!==b&&"fwdme"!==b||zmComp.shCBc(a,"c")},P=function(a){c[a].discard_close=!1,c[a].viaDiscard=!1,c[a].type="t";var d=N(a),e={};e.cmpId=a,e.type="t";var f=zmCompOpt.recipientDOM(e),g=zmCompOpt.editorDOM(e),h=zmCompOpt.attDOM(e);d.append(f,g,h),d.addClass("zmCnew"),zmsuite.getCenter()[0].$el.addClass("zm_Ctab");var i=b[a],j=i.from,k=zmComp.getFromDispN(j);$("#zm_fromaddr_"+a).text(k);var l=zmComp.getSubject(a);$("#zmsub_"+a).val(l),z(a);var m=i.to,s=i.cc,t=i.bcc,u=i.isCC,v=i.isBCC;m&&""!==$.trim(m)&&o(a,"to",m),u&&zmComp.shCBc(a,"c"),s&&""!==$.trim(s)&&"Not Provided"!==$.trim(s)&&o(a,"cc",s),t&&$.trim(t)&&o(a,"bcc",t),v&&zmComp.shCBc(a,"b"),w(a),zmsuite.showWorkSpace(a),i.isPriority?(zmsuite.getCenter(a)[0].getNodes()[0].showGroup("compPriority"),zmComp.updatePriority(a)):zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("compPriority"),zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("compComment");var x=zmComp.getEditor(a),y=x.getContent(),A=x.mode,B=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==B&&(ZE_Init.defaultFontFamily=B);var C=zmCUtil.getfontSize();C&&(ZE_Init.defaultFontSize=C+"pt");var D=zmCUtil.getfontColor();D&&(ZE_Init.defaultFontColor=D);var F=zmComp.getMode(a);"compose"===F||"fwdi"===F||"fwdme"===F?ZE_Init.needEditorFocus=!1:ZE_Init.needEditorFocus=!0,ZE_Init.fileUpload=zmComp.editorDropUpload;var G={};G.id="zmEdi_"+a,G.contentChanged=function(){zmail.showFeature&&n(a),zmComp.setLastModified(a,(new Date).getTime()),zmComp.setModified(a,1)},G=p(a,G),G=q(a,G),"plaintext"===A&&(y=ZE.getText(y),G.mode="plaintext"),G.content=y,G.isResizeRequired=!0,G.customAttachArr=function(){return["custom","Attachment","zei-attachment",function(a){zmComp.triggerCloudUpload(a)}]},x=ZE.create(G),zmComp.setEditor(a,x);try{var I=function(a){return function(){zmComp.setModified(a,1),r(a,F)}};zmComp.getEditor(a).afterEditorLoad(I(a,F))}catch(J){}"compose"!==F&&"fwdi"!==F&&"fwdme"!==F||zmComp.setElemFocus($("#zmto_"+a)),zmCUtil.resizeRepDOM(a),zmComp.setHeight(a),E(a),zmComp.updateTitle(a),H(a),zmComp.updateComposer(a,"load_undo_discard")},Q=function(a,b,d,e,f){if(zmContentCache.isCached(b)&&!f.newdata)e=zmContentCache.get(b);else{var g={};g.mdata=e.mdata,f.shId||"outbox"===d||"draft"===d||"template"===d||zmUtil.prevCache(b,g),e=g.mdata}return f.data&&(e=f.data,f.data.mdata&&(e=f.data.mdata)),e&&!$.isEmptyObject(e)&&(c[a].data=e),e},R=function(a,b){for(var d in c)if(!zmComp.discard_cmpId||zmComp.discard_cmpId!==d){if(zmail.allowInline){var e=!1;"reply"!==b&&"replyall"!==b&&"fwdi"!==b||(e=!0);var f=!1;if(c[d].loadType&&"drafted"===c[d].loadType&&(f=!0),c[d].mymId===a&&f&&e)return d}if("template"===b)return!1;if(a&&c[d].mode===b&&c[d].mymId===a||c[d].dftId===a)return d}return!1},S=function(a,b){var e=R(b.msgId,b.mode);if(e){if(!zmsuite.isWorkspaceAvailable(e)&&zmComp.getSmartData(e).appId)zmsuite.showExistingApp(zmComp.getSmartData(e).appId);else if(zmsuite.isWorkspaceAvailable(e))zmsuite.showExistingfigApp(e);else{var f=d.already_editing+"(4)";c[e].loadPrevious=f}return!1}e=b.restore?b.restoreAppId:zmUtil.getCmpAppId();var g=b.mode;if(!b.restore&&zmsuite.isWorkspaceAvailable(e))return zmsuite.showExistingApp(e),!1;if(zmComp.frmComp(),c[e]=new zmComp.newInstance(g),c[e].type=b.type,b&&(c[e].prm=b),b.info&&(c[e].info=b.info),b.draft_threadId&&a.tdata){var h=zmComp.draftParentId(b.msgId,a.tdata);h&&(c[e]._draftParentId=h)}b.fol_opt&&"tmp"===b.fol_opt&&(c[e].fol_opt="tmp"),b.tempId&&zmComp.setTempId(e,b.tempId);var i=b.msgId,l=N(e,b),m={};m.cmpId=e,m.type="t";var n=zmCompOpt.recipientDOM(m),o=zmCompOpt.editorDOM(m),p=zmCompOpt.dragDOM(m),q=zmCompOpt.attDOM(m);l.append(n,o,q,p),K(p[0]),l.addClass("zmCnew"),zmsuite.getCenter()[0].$el.addClass("zm_Ctab");var r="",s=!1;if(i||b.data){if(a=Q(e,i,g,a,b),a&&a.shId||b&&b.shId){var u=a.shId||b.shId;zmComp.setShareId(e,u)}if(a&&a.groupId&&(c[e].groupId=a.groupId,c[e].streamsView=a.streamsView),c[e].info&&c[e].info.groupId&&(c[e].groupId=c[e].info.groupId),c[e].info&&c[e].info.streamsView&&(c[e].streamsView=c[e].info.streamsView),c[e].groupId&&c[e].streamsView&&a.REPLYFROM&&(c[e].groupEmailId=a.REPLYFROM),zmComp.setMymId(e,i),!a.STATUS2ID||5!==a.STATUS2ID&&6!==a.STATUS2ID&&7!==a.STATUS2ID||(c[e].inlineMode=zmComp.getModeObj("string",a.STATUS2ID)),c[e]._draftParentId&&!c[e].inlineMode&&(c[e].inlineMode=zmComp.getModeObj("string",7)),c[e]._draftParentId){var w=zmComp.getCmpObjId(c[e]._draftParentId);w.cmpId&&(c[e].update_cmpId=w.cmpId)}b.draft_opt&&(c[e].discard_Id=i,c[e].enableDiscard=!0,a.MAILID&&(c[e].discard_mailId=a.MAILID),a.INREPLYTO&&(c[e].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(c[e].discard_refHeader=a.REFHEADER)),a.PRIORITY&&(s=!0,zmComp.updPriority(e,a.PRIORITY));var x=!1;if(a.RMOBJ&&!$.isEmptyObject(a.RMOBJ)&&zmUtil.isZohoAccount(zmComp.getAccId(e))&&(x=!0),i&&(b.draft_opt||"outbox"===g)&&x&&(zmWUtil.addWatchTheme(e),c[e].RMOBJ=a.RMOBJ,c[e]._reminder_draft=!0),zmSchedule&&a.SCO&&0!==a.SCO.OT){1===a.SCO.OT?zmSchedule.processScheduleObject(e,a.SCO):2===a.SCO.OT&&zmSchedule.processRecurringObject(e,a.SCO);var y="",B=zmsuite.getCenter(e)[0].getNodes()[0].$el,C=$(B).find("[data-event='cmp_schedule']");zmSchedule.getScheduleObject(e)?y=zmSchedule.getScheduleTitle(e):zmSchedule.getRecurringObject(e)&&(y=zmSchedule.showTitle(e)),C.addClass("SC_thm"),zmComponent.tooltip({elm:C[0],text:y,arrow:"top"})}i&&zmCUtil.setTempFolId(e,i),r=A(e,g,a),O(e,g,a)}else v(e),z(e);zmsuite.showWorkSpace(e),zmComp.hideComment(e),s?zmsuite.getCenter(e)[0].getNodes()[0].showGroup("compPriority"):zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compPriority"),c&&c[e]&&c[e].prm&&"note"===c[e].prm.entityType&&zmComp.enableSave(e),i&&k(e,g,i),t(e,g,r),"reply"!==g&&"replyall"!==g&&"fwdi"!==g||(c[e].loadType="drafted",c[e].changeData=!0),b.info&&b.info.loadType&&"drafted"===b.info.loadType&&(c[e].loadType=b.info.loadType,c[e].changeData=!1),i&&c[e].loadType&&"drafted"===c[e].loadType&&zmComp.updateMsgObj(i,e),c[e].update_cmpId&&zmComp.updateComposer(c[e].update_cmpId,"open_draft_folder"),"compose"!==g&&"fwdi"!==g&&"fwdme"!==g||zmComp.setElemFocus($("#zmto_"+e)),zmCUtil.resizeRepDOM(e),zmComp.setHeight(e),zmComp.updAtMention(e),E(e),zmComp.updateTitle(e),H(e),j(e),b.restore||zmUtil.addCmpAppId(),!i||"draft"!==g&&"template"!==g||(zmComp.cmpHashURL(e,["draft",i]),zmComp.cmpRestoreState(e,{mode:"draft",msgId:i})),i&&b.draft_opt&&zmComp.setPrintId(e,i),zmail.isOrg&&zmUtil.isZohoAccount(zmComp.getAccId(e))?(i&&b.draft_opt||b.restore||b.info&&b.info.hashKey)&&zmComp.draftComments(e,i,"draft_onload"):zmsuite.getCenter(e)[0].getNodes()[0].hideGroup("compShare"),"outbox"===g&&zmCUtil.updateOutboxView()},T=function(a,e){zmComp.removeDiscard();var f=b[a],g=zmComp.getMode(a),h=e.msgId,i=e.prevDOM;if(!i)return void zmComp.showMsg(a,"i","1"+d.preview_notload,"p");var j={};j.cmpId=a,j.type="p",j.msgId=h;var l=zmCompOpt.headerDOM(j),m=zmCompOpt.recipientDOM(j),n=zmCompOpt.editorDOM(j),p=zmCompOpt.attDOM(j),q=$("<div/>");q.attr("class","zm_cmp"),q.attr("id",a+"_"+h),q.append(l,m,n,p),i.html(q),c[a].info=e,zmUtil.setInlineCmpScope(!0);var r=f.from;zmComp.setFromAddr(a,r),z(a);var t=f.to,u=f.cc,v=f.bcc,x=f.isCC,y=f.isBCC;t&&""!==$.trim(t)&&o(a,"to",t),x&&zmComp.shCBc(a,"c"),u&&""!==$.trim(u)&&"Not Provided"!==$.trim(u)&&o(a,"cc",u),v&&$.trim(v)&&o(a,"bcc",v),y&&zmComp.shCBc(a,"b"),w(a),k(a,g),c[a].aftersave="reload_preview";var A=zmComp.getEditor(a),B=A.mode,C=A.getContent();s(a,B,C,zmComp.getMode(a)),zmComp.setHeight(a),"compose"!==g&&"fwdi"!==g&&"fwdme"!==g||zmComp.setElemFocus($("#zmto_"+a)),zmCUtil.resizeRepDOM(a)},U=function(a,d){c[a].type="t";var e=N(a),f={};f.cmpId=a,f.type="t";var g=zmCompOpt.recipientDOM(f),h=zmCompOpt.editorDOM(f),i=zmCompOpt.attDOM(f);
e.append(g,h,i),e.addClass("zmCnew"),zmsuite.getCenter()[0].$el.addClass("zm_Ctab");var j=b[a],l=j.from,m=zmComp.getFromDispN(l);$("#zm_fromaddr_"+a).text(m);var n=zmComp.getSubject(a);$("#zmsub_"+a).val(n),z(a);var p=j.to,q=j.cc,r=j.bcc,t=j.isCC,u=j.isBCC;p&&""!==$.trim(p)&&o(a,"to",p),t&&zmComp.shCBc(a,"c"),q&&""!==$.trim(q)&&"Not Provided"!==$.trim(q)&&o(a,"cc",q),r&&$.trim(r)&&o(a,"bcc",r),u&&zmComp.shCBc(a,"b"),w(a),zmsuite.showWorkSpace(a),zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("compPriority"),zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("compComment"),c[a].aftersave="move_tab",c[a].enableDiscard=!0;var v=zmComp.getEditor(a),x=v.mode,y=zmComp.popupTrimmed(a,v),A="tab";"p"===c[a].type&&(A="inline"),s(a,x,y,zmComp.getMode(a),A);var B=c[a].info.msgId,C=zmComp.getMode(a);k(a,C,B),"compose"!==C&&"fwdi"!==C&&"fwdme"!==C||zmComp.setElemFocus($("#zmto_"+a)),zmCUtil.resizeRepDOM(a),zmComp.setHeight(a),zmComp.updAtMention(a),E(a),zmComp.updateTitle(a),H(a),d&&zmail.isOrg&&zmUtil.isZohoAccount(zmComp.getAccId(a))&&zmComp.draftComments(a,d,"draft_onload")},V=function(a){if(!isNaN(a)){var b=[" bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"],c=Math.floor(Math.log(Number(a))/Math.log(2));c<1&&(c=0);var d=Math.floor(c/10);return a=Number(a)/Math.pow(2,10*d),a.toString().length>a.toFixed(1).toString().length&&(a=a.toFixed(1)),a+b[d]}},W=function(a){for(var b,c=[],d=0;d<a.length;d++)a[d]!==b&&c.push(a[d]);return a=c},X=function(){var a=zmComp.getCurrentCompId();if(a&&c[a]){var b=c[a].type;a&&b&&"t"===b?(zmComp.setTabHeight(a),zmCUtil.resizeRepDOM(a)):a&&b&&"w"===b&&zmComp.setWindowHeight(a)}zmComp.resizeRepDOMList(),zmComp.resizeDialog(),zmComp.resizeAllTab()},Y=function(){zmUtil.loadZDocs(),window.onbeforeunload=function(a){if(zmComp.chkModified()){var b=d.unsent_alert;return"undefined"==typeof a&&(a=window.event),a&&(a.returnValue=b),b}},zmail.isComposeMail||($.subscribe("mail/draggingStarted",function(a,b){try{zmComp.showDrag(b.text)}catch(c){}}),$.subscribe("mail/draggingEnded",function(){try{zmComp.hideDrag()}catch(a){}}),$.subscribe("mail/draggingOnCmpMask",function(){try{zmComp.debugLog("Element on compose drag mask")}catch(a){}}),$.subscribe("/streams/comment",function(a,b){zmComp.updateComment(b)}),$.subscribe("/streams/draftShared",function(a,b){zmComp.updateNotifyAll(b)})),$.subscribe("smartCompose/onClose",function(a,b){try{if(b.mailObj){var d=b.mailObj.cmpId;b.mailObj.clearData&&zmComp.getOutboxMailId(d)&&zmCUtil.clearDraft(zmComp.getAccId(d),zmComp.getOutboxMailId(d)),c[d].discard_close||delete c[d]}zmUtil.stopEvents(a)}catch(e){}}),$(window).resize(_.debounce(X)),$.subscribe("mailsuite/appOpened",function(a,b){if(b&&zmComp.getCurrentCompId()&&c&&c[b]){if(c[b].resizeTab&&zmComp.setTabHeight(b),c[b].resizeWidth&&zmCUtil.transResizeRepDOM(b),zmComp.focusEditor(b),"undefined"!=typeof zmComp.getEditor(b).squireInstance){var d,e=zmComp.getEditor(b),f=e.squireInstance.getSelection().startContainer.parentNode.getBoundingClientRect(),g=f.y||f.height,h=f.x||f.width,i=e.iframe.scrollHeight;d=f.y>=i?g+i:g,e.iframe.contentWindow&&e.iframe.contentWindow.scrollTo(h,d)}return!1}}),$.subscribe("/announcement/show",function(){zmComp.resizeCmpTab()}),$.subscribe("/announcement/hide",function(){zmComp.resizeCmpTab()}),$.subscribe("zmsuite/lhsResize",function(a,b){b.completed&&zmComp.resizeUtil()}),$.subscribe("/integ/rhs/start",function(){var a=zmComp.getCurrentCompId();a&&zmCUtil.clearResizeRepDOM(a)}),$.subscribe("/integ/rhs",function(){zmComp.resizeUtil()})},Z={cleanArray:W,getSize:V,I18N:d,windowCmpId:null,focusEditor:function(a){var b=zmComp.getEditor(a);b&&b.squireInstance.focus()},compose:function(a,b){var c={act:"compose",mode:"compose"};a&&(c.data=a),b&&b.entityType&&(c.entityType=b.entityType),c.type="t",S({},c)},getFwdAtt:function(a,b,c){var d,e={},f=[],g="",h={};if(zmail.mailObj?h=zmail.mailObj:opener&&opener.document.domain===document.domain&&(h=opener.zmail.mailObj),b&&b.length)for(var i=b.length,j=0;j<i;j++)d={},d.mId=b[j],d.thrd=!1,d.sub=h[b[j]].SB,g=h[b[0]].SB,f.push(d);if(c&&c.length)for(var k=c.length,l=0;l<k;l++)d={},d.thrd=!0,d.mId=h[c[l]].T,d.sub=h[c[l]].SB,""===g&&(g=h[c[0]].SB),f.push(d);return e.subject=g,e.fwdLst=f,e},cmpFwd:function(a,b,c){var d,e,f={},g=zmUtil.getFwdArr(c,b);g.mId&&g.mId.length&&(f.FWDMSG=g.mId),g.tId&&g.tId.length&&(f.FWDTID=g.tId);var h={act:"compose",mode:"fwdme"};h.data=f,h.type="t",g.folderId&&(h.folderId=g.folderId),d&&zmUtil.isSharedFolder(d)&&(e=zmUtil.getShareId(d)),e&&(h.shId=e),S({},h)},dropCmpFwdMe:function(a){var b,c=a.msgList,d=c.tIds,e=c.mIds,f=a.maskElem.attr("id").split("_")[1],g=zmComp.getFwdAtt(f,e,d),h=g.fwdLst,i=[],j=[],k=[],l=-1,m=!1;if(h.length){for(var n=h.length,o=0;o<n;o++)b=h[o].mId,h[o].thrd?(k=zmComp.getFwdThrd(f),k&&k.length&&(l=k.indexOf(b)),l===-1&&(m=!0,j.push(b))):(k=zmComp.getFwdMsg(f),k&&k.length&&(l=k.indexOf(b)),l===-1&&(m=!0,i.push(b))),m&&zmComp.attach_fwdme(f,h[o]);m&&(zmComp.setFwdThrd(f,j),zmComp.setFwdMsg(f,i))}},chgReply:function(a,b,d,e){var f="";"replyall"===a?f="msi-replyall":"reply"===a?f="msi-reply":"fwdi"===a?f="msi-forward":"eanew"===a&&(f="msi-edit"),$($(e).find("i")[0]).removeClass().addClass(f);var g=$(e).parent().attr("cmprid");g||(g=$(e).closest("ul").attr("cmprid"));var h;g&&(h=g.split("_")[1]),b||(b=c[h].type);var i=!1;if(c[h].isChanged||(i=!0),c[h].changeData||(i=!1),i){var j=zmContentCache.get(d),k=A(h,a,j);k||(k="&nbsp;"),zmComp.getEditor(h).setContent(k),G(h,a,j.SUBJECT)}zmComp.updRepView(h,b,a,d),"fwdi"===a&&zmComp.setElemFocus($("#zmto_"+h))},modeInline:function(a){var b=a.mode,c=!1,d=!1;return"reply"!==b&&"replyall"!==b&&"fwdi"!==b||(d=!0),a.loadType&&"drafted"===a.loadType&&(d=!0),a.prevDOM&&a.prevDOM.length&&d&&(c=!0),c},cmpReply:function(a){var b,d,e=a.mode,f=a.type,g=a.msgId;g&&(d=zmComp.getCmpObjId(g),d.cmpId&&(b=d.cmpId));var h=e;a.loadMode&&(h=a.loadMode);var i=!1;if("reply"!==h&&"replyall"!==h&&"fwdi"!==h||(i=!0),b&&c[b]&&c[b].info){var j,k,l=c[b].info;l.viewType&&(j=l.viewType),a.viewType&&(k=a.viewType),j&&k&&j!==k&&(i=!1)}if(zmail.allowInline&&b&&i)return void zmComp.cmpRE(b,h,f,g,a);var m=!1,n=zmComp.modeInline(a);a.data&&$.isEmptyObject(a.data)&&a.reopen&&(m=!0);var o=!1;zmail.allowInline&&n&&f&&"p"===f&&!m?(!$.isEmptyObject(a.data)&&a.draftId&&(o=!0),!a.draftId&&zmContentCache.get(g)&&(o=!0),b&&(a.cmpId=b),o?zmComp.cmpPrev(a):zmComp.addComposer(a)):"fwdme"===e?zmComp.cmpFwd(e,f,g):("p"===f&&(f="t"),zmComp.cmpRF(e,f,g,a))},_initAttachComponent:function(a,b,c){v(a,b,c)},cmpRE:function(a,b,e,f){var g,h;if(!zmUtil.isChildWindow()&&zmsuite.isWorkspaceAvailable(a)){zmsuite.showExistingApp(a);var i=!1;if(c[a].isChanged||(i=!0),c[a].changeData||(i=!1),i){var j=zmContentCache.get(f),k=A(a,b,j);k||(k="&nbsp;"),zmComp.getEditor(a).setContent(k)}g=b,h="msi-reply","replyall"===g?h="msi-replyall":"fwdi"===g?h="msi-forward":"eanew"===g&&(h="msi-edit"),zmComp.setModified(a,1),$("#zmRepIcn_"+a).removeClass().addClass(h),zmComp.updRepView(a,e,b,f),"fwdi"===b&&zmComp.setElemFocus($("#zmto_"+a))}else{g=b,h="msi-reply","replyall"===g?h="msi-replyall":"fwdi"===g?h="msi-forward":"eanew"===g&&(h="msi-edit"),zmComp.setModified(a,1),$("#zmRepIcn_"+a).removeClass().addClass(h),zmComp.updRepView(a,e,b,f),F(a),"fwdi"===b?zmComp.setElemFocus($("#zmto_"+a)):zmComp.getEditor(a).win.focus();var l=d.already_editing+"(1)";c[a].loadPrevious=l}},cmpPrev:function(a){var b=a.mode,e=a.type,f=a.msgId,g=a.cmpId;if(g)if(zmsuite.isWorkspaceAvailable(g))zmsuite.showExistingApp(g);else{var h=d.already_editing+"(3)";c[g].loadPrevious=h,zmComp.loadPreview(g,a)}else{var i={mode:b,msgId:f,type:e};if(i.type="p",zmCUtil.getFolId(f)){var j=zmCUtil.getFolId(f);zmUtil.isSharedFolder(j)&&(i.shId=zmUtil.getShareId(j))}i.info=a,a.loadType&&"drafted"===a.loadType?(i.data=a.data,L({},i)):L({mdata:zmContentCache.get(f)},i)}},cmpRF:function(a,b,e,f){var g;if(e)g=e;else if("r"===b)g=zmInit.rclkId,g.indexOf("t")!==-1&&(g=zmComp.zmsubStr(g,"t"));else{var h=zmUtil.getSelectedMails(),i=[];h[0].length?i=h[0]:h[1].length&&(i=h[1]),g=i[0]}var j=R(g,a);if(j)if(!zmsuite.isWorkspaceAvailable(j)&&zmComp.getSmartData(j).appId)zmsuite.showExistingApp(zmComp.getSmartData(j).appId);else if(zmsuite.isWorkspaceAvailable(j))zmsuite.showExistingApp(j);else{var k=d.already_editing+"(4)";c[j].loadPrevious=k}else{var l={accId:zmail.accId,act:"compose"};"outbox"===a&&(l.mode=a);var m={mode:a,msgId:g};if(zmCUtil.getFolId(g)){var n=zmCUtil.getFolId(g);if(zmail.folId.teId===n&&(m.fol_opt="tmp",m.tempId=g),zmail.folId.dId===n){m.draft_opt=!0;var o=zmCUtil.draftThreadId(g);o&&(m.draft_threadId=o)}"outbox"===a&&(l.folId=n,m.folId=n),zmUtil.isSharedFolder(n)&&(l.shId=zmUtil.getShareId(n),m.shId=zmUtil.getShareId(n))}m.type="t";var p=!0;if(f&&!$.isEmptyObject(f)&&(m.info=f,f.restore&&(m.restore=f.restore,m.restoreAppId=f.restoreAppId),f.msgId&&(l.msgId=f.msgId),f.accId&&(l.accId=f.accId),f.entityId&&(l.entityId=f.entityId),f.groupId&&(l.groupId=f.groupId),f.streamsView&&(l.streamsView=f.streamsView),f.entityType&&(l.entityType=f.entityType),f.actionType&&(l.actionType=f.actionType)),zmContentCache.isCached(g)&&!zmContentCache.get(g).SHRINKED&&"outbox"!==a&&(p=!1),m.draft_opt&&(p=!0,m.newdata=!0),f.reqData&&(p=!0),p){l.msgId=g,l.vfc=!0,m.draft_threadId&&(l.summary=!0,l.thId=m.draft_threadId);var q={u:zmail.conPath+"/compose.do",t:"GET",act:"compose",fn:S,p:l,ep:m};zmAjq.XHR(q)}else S({mdata:zmContentCache.get(g)},m)}},setCmpHeader:function(a,b){var d=zmComp.getMailId(a),e=zmComp.getInReplyTo(a),f=zmComp.getRefHeader(a),g=zmCUtil.getRlyType(b);g?(d&&(c[a].data_inReplyTo=d),e&&(c[a].data_refHeader=zmCUtil.addRefHeader(f,e))):(d&&(c[a].data_mailId=d),e&&(c[a].data_inReplyTo=e),f&&(c[a].data_refHeader=f))},getCmpHeader:function(a){var b={};return c[a].data_mailId&&(b.mailId=c[a].data_mailId),c[a].data_inReplyTo&&(b.inReplyTo=c[a].data_inReplyTo),c[a].data_refHeader&&(b.refHeader=c[a].data_refHeader),b},updateAttachment:function(a,b,d){if(c[a]&&zmComp.getAttRef(a)&&"att"===b&&zmComp.setModified(a,1),"ele"===b){if("add"===d)$("#zmAtt_"+a).is(":visible")||$("#zmAtt_"+a).removeClass("SC_dyn");else if("remove"===d){var e=$("#zmAttLst_"+a+" > div");e.length||$("#zmAtt_"+a).addClass("SC_dyn")}zmComp.setHeight(a)}},delAttFwd:function(a,b,c,d){var e=[];e=c?zmComp.getFwdThrd(a):zmComp.getFwdMsg(a);var f=e.indexOf(b);f!==-1&&e.splice(f,1),d.remove(),zmComp.attachHeight(a)},modeChange:function(a,b){var c=1,d=b.split("_")[1];"plaintext"===a?(zmComp.getAttRef(d).updateConfig({showZDocsAsLinkOption:!1}),c=0):"richtext"===a&&zmComp.getAttRef(d).updateConfig({showZDocsAsLinkOption:!0}),zmail.cmpdata.HTML_ENABLED=c;var e={mode:"editor",etype:c};zmAjq.XHR({u:zmail.conPath+"/chgEditor.do",t:"POST",fn:"",p:e,csr:"s"})},resetRepView:function(a){$("#zmtotxt_"+a).parent().children(".SC_cs").each(function(){zmAutoFill.removeContact($(this))}),$("#zmcctxt_"+a).parent().children(".SC_cs").each(function(){zmAutoFill.removeContact($(this))}),$("#zmbcctxt_"+a).parent().children(".SC_cs").each(function(){zmAutoFill.removeContact($(this))})},updRepView:function(a,b,d,f,g){var h=c[a].data;if(c[a].mode=d,c[a].inlineMode=d,!$.isEmptyObject(h)){zmComp.resetRepView(a),z(a);var i=e(a,d,h),j=i.TO,k=i.CC,l=i.BCC;k&&""!==$.trim(k)&&"Not Provided"!==$.trim(k)?(o(a,"cc",k),zmComp.shCBc(a,"c",g,b,f)):($("#zmcc_"+a).hide(),$("#scc_"+a).show()),l&&$.trim(l)?(o(a,"bcc",l),zmComp.shCBc(a,"b",g,b,f)):($("#zmbcc_"+a).hide(),$("#sbcc_"+a).show()),j&&""!==$.trim(j)&&o(a,"to",j)}},shCBc:function(a,b,c){var d="#zmcc_"+a;"b"===b?(d="#zmbcc_"+a,$("#sbcc_"+a).hide()):"c"===b&&$("#scc_"+a).hide(),$(d).removeClass("SC_dyn"),"setFocus"===c&&zmComp.setElemFocus($(d)),l($(d).find("input")),zmComp.setHeight(a),window.event&&zmUtil.stopEvents(window.event)},editorDropUpload:function(a,b){var c=a.initobj.id.split("_")[1];zmComp.getAttRef(c).uploadFiles(b)},maxUpload:function aa(a,b){var c=!0,aa=20971520;zmail.maxAttSz&&(aa=zmail.maxAttSz);for(var e=b.length,f=0,g=0;g<e;g++){var h=b[g],i=h.size;try{f+=i}catch(j){f=0}var k=zmComp.getSizeAtt(a),l=k+f;if(l>aa){var m=aa/1048576;c=!1;var n=d.upload_alert_maxsize;return n=zmText.applyArgs(n,{tmpAttSz:m}),Dialog.alert(n),!1}}return c},minUpload:function ba(a){var ba=20971520;zmail.maxAttSz&&(ba=zmail.maxAttSz);var b=zmComp.getSizeAtt(a);return ba-=b},getSizeAtt:function(a){var b=0,c=0;if(zmComp.getAttEntity(a))for(var d=zmComp.getAttEntity(a),e=d.length,f=0;f<e;f++)c=parseInt(d[f].fs),isNaN(c)||(b+=c);if(zmComp.getAttTmp(a))for(var g=zmComp.getAttTmp(a),h=g.length,i=0;i<h;i++)c=parseInt(g[i].size),isNaN(c)||(b+=c);return b},smartClose:function(a,b,d,e,f,g){c[a].smartData&&c[a].smartData.afterClose&&(g.afterClose=c[a].smartData.afterClose);var h=!1;h=!(!e||"close"!==e)||zmComp.delCompObj(a,b,d,f),h&&g.afterClose&&g.afterClose()},prvClose:function(a,b,d,e,f){var g=!1;if(g=!(!e||"close"!==e)||zmComp.delCompObj(a,b,d,f),g&&d&&b&&"p"===b&&c[a]&&c[a].info.prevDOM){zmUtil.setInlineCmpScope(!1);var h="close_preview";f&&(h=f),zmComp.updateComposer(a,h);var i=c[a].info.prevDOM;i.find(".zm_cmp").remove()}},dialogClose:function(a){c[a].closeQuick?(c[a].closeQuick=!1,zmComp.closeDialog(a)):zmComp.hideDialog(a)},windowClose:function(a){var b={},c=zmComp.getOpener();window.self!==top&&(b.close=!0,window.parent.postMessage(b,"*")),c&&(b.cmpId=a,b.close=!0,c.postMessage(b,"*"));try{window.close()}catch(d){close()}},comClose:function(a){var b,d,e,f,g;b=a.cmpId,d=c[b].type,e=a.msgId,a.triggerType&&(f=a.triggerType),a.msgId&&(e=a.msgId),a.msgTxt&&(g=a.msgTxt);var h;zmail.isComposeMail&&d&&"w"===d?zmComp.windowClose(b):d&&"p"===d?zmComp.prvClose(b,d,e,h,f):d&&"d"===d?zmComp.dialogClose(b):d&&"st"===d?(e||(e=zmComp.getMymId(b),a.msgId=e),zmComp.smartClose(b,d,e,h,f,a)):(zmComp.updateComposer(b,f),zmsuite.closeWorkspace(b)),g&&zmUtil.succErrMsg("s",g)},updModified:function(a){zmComp.setModified(a,0),zmComp.setLastModified(a,0),zmComp.setPrevModified(a,0)},chkModified:function(){var a=!1;for(var b in c){var d=0,e=0;try{if(c[b].discard_close)continue;d=zmComp.getLastModified(b),e=zmComp.getPrevModified(b);var f=zmComp.getModified(b);(1===f||d>e)&&(a=!0);break}catch(g){a=!1}}return a},cmpAlt:function(a){$("#zmCmpAlt").length?$("#zmCmpAlt").html(a):$("body").append('<div id="zmCmpAlt">'+a+"</div>");var b={style:{width:"600px"},buttons:[{txt:d.ok,selected:!0,callback:function(){zmsDialog.remove()}}],drag:!0,mask:!0,pos:"center"};zmsDialog.create("zmCmpAlt",b)},triggerTemplate:function(a){var b={};b.cmpId=a.split("_")[1],zmAppLoader.load("TemplateCategory").done(function(){ZMail.Template.init({start:1,end:21},"all",b)})},tempOverWrite:function(a){var b=d.template_overwrite_alert,c="<h4>"+b+"</h4>",e=$("<div/>");e.attr("id","zmcmp_tempatt_"+a),e.html(c);var f={};f.cmpId=a,f.$content=e,f.ignoreMouseDown=!1,f.dialogDidMount=function(b){$("#zmcmp_tempatt_"+a)[0].zmcmp_confirm_dialog_ele=b;var c=b.$els.$maskWrapper;c.on("mousedown",function(a){var c=a.target||a.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):b.remove()})},f.defaultNavigator=!1,f.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_tempatt_"+a)[0].zmcmp_confirm_dialog_ele.remove()}}),f.buttons=[{name:d.ok,callback:function(b){zmComp.sendMail({action:"stemplate",sendIm:!1,cmpId:a,tmpUpdate:!0}),b.remove()}},{name:d.cancel,isCancel:!0,callback:function(a){a.remove()}}],Dialog["new"](f)},remindAtt:function(a,b){var c=d.attachment_reminder_alert;c=zmText.applyArgs(c,{USER_INPUT:'"'+b+'"'});var e="<h4>"+c+"</h4>",f=$("<div/>");f.attr("id","zmcmp_confirm_"+a),f.html(e);var g={};g.cmpId=a,g.$content=f,g.ignoreMouseDown=!1,g.dialogDidMount=function(b){$("#zmcmp_confirm_"+a)[0].zmcmp_confirm_dialog_ele=b;var c=b.$els.$maskWrapper;c.on("mousedown",function(a){var c=a.target||a.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):b.remove()})},g.defaultNavigator=!1,g.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_confirm_"+a)[0].zmcmp_confirm_dialog_ele.remove()}}),g.buttons=[{name:d.ok,callback:function(b){zmComp.sendMail({action:"compose",sendIm:zmComp.getSendImm(a),cmpId:a,actVal:"attfalse"}),b.remove()}},{name:d.cancel,isCancel:!0,callback:function(a){a.remove()}}],Dialog["new"](g)},cmpConfirm:function(a){var b,e=a.cmpId,f=a.textMsg;c[e]&&c[e].discard_Id&&(b=c[e].discard_mailId);var g=d.discardTxt;b&&(g=d.deleteTxt);var h=function(a){zmComp.sendMail({action:"sdraft",sendIm:!1,cmpId:a,actVal:"close"})},i=$("<div/>");i.attr("id","zmcmp_alt_"+e),i.text(f);var j={};j.cmpId=e,j.$content=i,j.ignoreMouseDown=!1,j.dialogDidMount=function(a){$("#zmcmp_alt_"+e)[0].zmcmp_alt_dialog_ele=a;var b=a.$els.$maskWrapper;b.on("mousedown",function(b){var c=b.target||b.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):a.remove()})},j.defaultNavigator=!1,j.navigator=new zmail.Navigator({onEscape:function(a){a.remove()}}),j.buttons=[{name:d.save_draft,callback:function(a){h(e),a.remove()}},{name:g,isCancel:!0,callback:function(a){var b={};b.cmpId=e,zmComp.discardCmp(b),a.remove()}}],Dialog["new"](j)},discardCmp:function(a){var b=a.cmpId;"outbox"===zmComp.getMode(b)?zmCUtil.discardOutboxConfirm(b):zmComp.discardDraft(a)},discardDraft:function(a){var b,d,e=a.cmpId,f=c[e].type,g={cmpId:e,type:f,_cloObj:a};if(c[e]&&c[e].discard_Id&&(b=c[e].discard_mailId,d=c[e].discard_Id),b){var h={aId:c[e].accId};h.mode="discard",h.mailId=b,g.discard_Id=d,zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmComp.discardResp,p:h,csr:"s",ep:g})}else c[e].isChanged&&(c[e].newsave=!0),zmComp.discardClose(g)},discardResp:function(a,b){"success"===a.status&&(c[b.cmpId].newsave=!0,zmComp.discardClose(b))},discardClose:function(a){var d=a._cloObj;if(c[a.cmpId].viaDiscard=!0,c[a.cmpId].enableDiscard){c[a.cmpId].discard_close=!0;var e="";"st"===c[a.cmpId].type?e=zmComp.getSubject(a.cmpId):(e=$("#zmsub_"+a.cmpId).val(),c[a.cmpId].type&&"p"===c[a.cmpId].type&&(e=zmComp.getSubject(a.cmpId))),e&&(e=e.substr(0,1e3),zmComp.setSubject(a.cmpId,e)),b[a.cmpId]=new zmComp.prevInstance,zmComp.backupAttCompRef(a.cmpId);var f="discard_preview",g=zmComp.getType(a.cmpId);"t"===g&&(f="discard_tab"),h(a.cmpId,b[a.cmpId]),d.triggerType=f,d.msgId=b[a.cmpId].msgId,zmComp.comClose(d),zmComp.discardMsg(a.cmpId),a.discard_Id&&zmUtil.deleteMsg(a.discard_Id)}else zmComp.comClose(d)},delCompObj:function(a,b,e,f){var g=!0;try{var h=!1;if(zmComp.isModified(a)&&(h=!0),c[a]&&c[a].discard_close&&(h=!1),h){var i="";if("outbox"===zmComp.getMode(a))zmComp.getOutboxClose(a)||(g=zmCUtil.closeOutboxConfirm(zmComp.getCurrentCompId()));else{i=d.save_content_alert;var j={};j.cmpId=a,j.textMsg=i,j.msgId=e,g=zmComp.cmpConfirm(j)}}else"outbox"===zmComp.getMode(a)&&(zmComp.getOutboxClose(a)||(g=zmCUtil.closeOutboxConfirm(zmComp.getCurrentCompId())));if(g){var k=W(arguments),l=k.length;if(1!==l||c[a].viaDiscard||zmComp.updateComposer(a,"close_tab"),c[a]&&c[a].type&&"d"===c[a].type)zmComp.closeDialog(a,!0);else if(g&&e&&b&&"p"===b&&c[a]&&c[a].info.prevDOM){zmUtil.setInlineCmpScope(!1);var m="close_preview";f&&(m=f),zmComp.updateComposer(a,m);var n=c[a].info.prevDOM;n.find(".zm_cmp").remove()}var o=zmComp.getCommentObj(a);o&&$.publish("smartCompose/removeComment",{msgId:o.context.draftId,prevElem:o.parentElem}),clearInterval(zmComp.getInterVal(a)),$("#zmdArea_"+a+" input").each(function(){zmAutoFill.clearData($(this))}),$("#zm_smsg_"+a)&&zmComp.hideMsg(a),c[a].discard_close||delete c[a]}}catch(p){zmComp.debugLog(p)}return g},cmpRevert:function(a){zmComp.revert_cmpId=a,P(a)},updShowMsg:function(a,b){var c,d=2e3;"u"===b&&(b="s",c=2e3),"s"===b?(d=1e3,$("#zm_smsg_"+a).attr("data-status","s")):"i"===b?$("#zm_smsg_"+a).attr("data-status","i"):"e"===b&&$("#zm_smsg_"+a).attr("data-status","e"),c&&(d=c),setTimeout(function(){"s"===$("#zm_smsg_"+a).attr("data-status")&&zmComp.hideMsg(a)},d)},hideMsg:function(a){$("#zm_smsg_"+a).removeClass().addClass("SC_msg")},removeMsg:function(){$("#zm_smsg_discard").remove()},removeDiscard:function(){clearTimeout(zmComp.discard_timer);var a=!0;zmComp.discard_cmpId&&zmComp.discard_cmpId===zmComp.revert_cmpId&&(a=!1),a&&delete c[zmComp.discard_cmpId],zmComp.removeMsg()},updateTitle:function(a,b){b||(b=$("#zmsub_"+a).val()),""===b&&(b=d.nosubject);var c=zmTab.getTabObject(a);c.appname=b,zmTab.updateTabLst(c)},discardMsg:function(a){zmComp.removeDiscard();var b="cursor:pointer;text-decoration:underline;font-weight:bold",c="<font style='font-weight:bold'>"+d.discard_msg+"</font>";if(c+="&nbsp;&nbsp;<font style='"+b+"' id='zm_discard_back'>",c+=d.undo_discard,c+="</font><i class='msi-close' onclick='zmComp.removeDiscard()'></i>",!$("#zm_smsg_discard").length){var e=["DIV",{attrs:{id:"zm_smsg_discard","class":"SC_msg SC_imsg"},child:[["SPAN",{}]]}];$("body").append(_zm.getDOM(e))}$("#zm_smsg_discard").removeClass().addClass("SC_msg SC_imsg").children("span").html(c),$("#zm_discard_back").off("click").on("click",function(){zmComp.cmpRevert(a)}),zmComp.discard_timer=setTimeout(function(){zmComp.removeDiscard()},6e3),zmComp.discard_cmpId=a},showMsg:function(a,b,d,e,f,g){var h=!1;b&&"s"!==b&&(h=!0);var i="";if("s"===b?i="SC_msg SC_smsg":"e"===b?i="SC_msg SC_emsg":"i"===b&&(i="SC_msg SC_imsg"),!e&&c[a]&&c[a].type&&(e=c[a].type),!$("#zm_smsg_"+a).length){var j=null;if(zmUtil.isChildWindow()||zmail.isComposeMail)j=$("body");else if(e&&"p"===e)j=zmsuite.getAppObj("zm_Container").centerObj.$el;else if(e&&"d"===e){var k=c[a]._dDialog;j=k.$els.$contentWrapper}else j=e&&"st"===e?c[a].errorPar:zmsuite.getAppObj(a).centerObj.$el;var l="";zmail.isComposeMail&&(l='style="top:0"');var m='id="zm_smsg_'+a+'" class="'+i+'" '+l,n='<font></font><i class="msi-close"></i>',o=["<div "+m+"><span>"+n+"</span></div>"];e&&"st"===e?j[0].appendChild($(o.join(""))[0]):j.append(o.join(""))}var p=$("#zm_smsg_"+a);g&&"HTML"===g?(d&&(d=d.replace(/&lt;/g,"<"),d=d.replace(/&gt;/g,">")),p.children("span").find("font").html(d)):p.children("span").find("font").text(d),p.removeClass().addClass(i),h?p.children("span").find("i").off("click").on("click",function(){zmComp.hideMsg(a)}):p.children("span").find("i").remove(),f&&(b=f),zmComp.updShowMsg(a,b)},loadInsertImage:function(a,b,c,d,e){var f="/mail/ImageSignature?fileName=";f+=a+"&accountId="+c+"&storeName="+b,f+="c"===e?"&frm=c":"&frm=s",ZE.activeEditor.previewImage(f)},triggerUpload:function(a){var b=zmComp.getCurrentCompId();a&&!zmComp.getCurrentCompId()&&(b=zmComp.zmsubStr(a,"zmEdi_")),zmComp.getAttRef(b).browseDesktop()},triggerCloudUpload:function(a){var b=zmComp.getCurrentCompId();!b&&a&&(b=zmComp.zmsubStr(a,"zmEdi_")),zmComp.getAttRef(b).init()},_zdocTxt:function(a,b){var c=b.docName,d=$("<span/>");d.text(c),c=d.html();var e=b.docId,f=location.protocol+"//"+zmail.urls.docsURL+"/file/"+e,g='background-color:#f5f5f5;border:#dcdcdc 1px solid;padding:1px;width:80%;"',h='id="zmdoc_share_{{CMPID}}" class="dochover" spellcheck="false" ';h+='contenteditable="false" data-avoidContext="true" ',h+='data-zmdocname="'+e+'" ',h+='data-zmdocshare="true" data-zmdoccmp="'+a+'" ',h+='style="'+g+'"';var i='name="ZM_SHAREDOC" data-hugatt="hugatt" ';i+='href="'+f+'" ',i+='target="_blank" ';var j="color:#004B91; text-decoration:none;cursor:pointer;";i+='style="'+j+'"';var k='name="ZM_SHAREDOC" data-hugatt="hugatt" ';k+='style="visibility:hidden;font-size:14px;cursor:pointer;color:#4A4A4A"';var l=["<table "+h+"><tr><td>","<a "+i+">"+c+"</a><br/>",'</td><td style="width:10px">',"<div "+k+">x</div></td>","</tr></table>"],m=l.join("");return m=m.replace(/{{CMPID}}/g,a)},getZDStr:function(a){var b="",c=zmComp.getZDObj(a);for(var d in c)""!==b&&(b+=","),b+=c[d].docId;return b},getZDArr:function(a){var b=[],c=zmComp.getZDObj(a);for(var d in c)b.push(c[d].docId);return b},docHover:function(a){var b='<style id="docHOVER_'+a+'">';return b+=".dochover {border:1px solid red} ",b+=".dochover:hover div{visibility:visible !important } ",b+=".dochover a:hover {text-decoration:underline!important;}</style>",$(b)},loadDocsLink:function(a,b){var c=b.cmpId,d=[],e=a.zohodocs;for(var f in e){var g=e[f];if(g.docId&&$.inArray(g.docId,zmComp.getZDArr(c))===-1){var h={};h.docId=g.docId,h.docName=g.docName,h.docType=g.docType,d.push("<div><br/></div>"),d.push(zmComp._zdocTxt(c,h))}}if(d.join("")){d.push("<div><br/></div>");var i=zmComp.getEditor(c),j=i.doc,k=$(j.head).find('style[id="docHOVER_'+c+'"]');k.length||$(j.head).append(zmComp.docHover(c)),i.insertHTML(d.join(""),!0)}},getZDObj:function(a){var b=zmComp.getEditor(a),c=b.doc,d=[],e=$(c).find('a[name="ZM_SHAREDOC"]');if(e.length)for(var f=e.length,g=0;g<f;g++){var h=e[g];if(!$(h).closest(".zmail_extra").length){var i=h.href;if(i){var j=i.split("/");if(j.length){var k=j[j.length-1],l=$(h).closest("table").attr("data-zmdocname");k===l&&d.push({docId:k})}}}}return d},clearZDoc:function(a,b,c){zmComp.updateZDoc(b,c);var d=$(a).parents("table").prev(),e=d.get(0);"DIV"===e.nodeName&&1===e.childNodes.length&&"BR"===e.childNodes[0].nodeName&&d.remove(),$(a).closest("table").remove()},updateZDoc:function(a,b){var c=zmComp.getZDObj(a);for(var d in c)if(c[d].docId===b){c.splice(d,1);break}},insertDocsLink:function(a){var b=a.eprm,c=a.loadType;if("link"===c){var d=$.parseJSON(a.docObj);zmComp.loadDocsLink(d,b)}},updateMsgObj:function(a,b){zmComp.setMsgId(b,a),zmComp.setCmpId(a,b)},setPrevHeight:function(a){var b;if(c[a].info&&c[a].info.prevDOM&&(b=c[a].info.prevDOM),b){var d=b.find(".zm_cmp");d.find(".zmCE").height("300px");var e=d.find(".ze_SCmb").outerHeight(),f=300-(e+4);d.find("iframe.ze_area").height(f),d.find("textarea.ze_area").height(f-30);var g=$("#zmAtt_"+a).outerHeight()+16,h=d.find("#zmDrag_"+a);h.height(f),h.css("bottom",g)}},resetHeight:function(a){var b=a.attr("id").split("_")[1];zmComp.setHeight(b)},setHeight:function(a,b){c[a]&&(b||(b=c[a].type),b&&"p"===b?zmComp.setPrevHeight(a):b&&"w"===b?zmComp.setWindowHeight(a):b&&"d"===b?zmComp.setQuickHeight(a):zmComp.setTabHeight(a))},setWindowHeight:function(a){var b=$(zmail.win).height(),d=$("#zmComposeWrapper"),e=d.find(".SCmb").eq(0).height(),f=d.find(".zmCR").height(),g=0;d.find(".zmCA").is(":visible")&&(g=d.find(".zmCA").height());var h=e+f+g,i=d.find(".ze_SCmb").height(),j=b-(h+16)+"px",k=b-(h+i+21);d.find(".zmCE").height(j),d.find("iframe.ze_area").height(k),d.find("textarea.ze_area").height(k-30),c[a]&&c[a].shareheight&&zmComp.shareHeight(a)},getCenter:function(a){var b;if(c[a]){var d;c[a].type&&(d=c[a].type),d&&"t"===d?b=zmsuite.getAppObj(a).centerObj.$el:d&&"d"===d&&(b=$("#zmQuick_compose_"+a))}return b},resizeUtil:function(){var a=zmComp.getCurrentCompId();a&&c[a]&&(zmCUtil.transResizeRepDOM(a),zmComp.setTabHeight(a)),zmComp.resizeRepDOMList()},resizeWindow:function(){try{var a=zmComp.getCmpObj();for(var b in a)c&&c[b].type&&"w"===c[b].type&&zmComp.setWindowHeight(b)}catch(d){zmComp.debugLog("ZM: Resizing",d)}},resizeRepDOMList:function(){try{for(var a in c)c&&c[a]&&(c[a].resizeWidth=!0,c[a].resizeTab=!0)}catch(b){}},resizeAllTab:function(){try{for(var a in c)c&&c[a]&&(c[a].resizeTab=!0)}catch(b){}},resizeCmpTab:function(){var a=zmComp.getCurrentCompId();a&&c[a]&&(c[a].resizeTab=!1,zmComp.setTabHeight(a)),zmComp.resizeAllTab()},getDialogObj:function(){var a=[];for(var b in c)c&&c[b]&&c[b].type&&"d"===c[b].type&&a.push(b);return a},resizeDialog:function(){var a=[],b=$(zmail.win).height();try{for(var d in c)c&&c[d]&&c[d].type&&"d"===c[d].type&&a.push(d);if(a.length)for(var e=a.length,f=0;f<e;f++){var g=a[f];g&&b>450&&zmComp.setQuickHeight(g)}}catch(h){}},setTabHeight:function(a){if(zmsuite.getAppObj()[a]){var b=zmsuite.getAppObj()[a].centerObj.$el,c=b.outerHeight(),d=b.find(".SCmb").eq(0).outerHeight(),e=b.find(".zmCR").outerHeight(),f=0;b.find(".zmCA").is(":visible")&&(f=b.find(".zmCA").outerHeight());var g=d+e+f,h=b.find(".ze_SCmb").outerHeight(),i=c-g,j=c-(g+h);b.find(".zmCE").height(i),b.find("iframe.ze_area").height(j),b.find("textarea.ze_area").height(j);var k=$("#zmAtt_"+a).outerHeight(),l=b.find("#zmDrag_"+a);l.height(j),l.css("bottom",k)}},setQuickHeight:function(a){var b=$(zmail.win).height(),d=$(".zm_compose"),e=d.offset(),f=e.top,g=$("#wmstoolbar").outerHeight(),h=c[a]._dDialog,i=f+g,j=b-i;h.$els.$contentWrapper.css({"max-width":"700px",padding:"0px"});var k=h.$els.$contentWrapper,l=k.find(".SCmb").eq(0).height(),m=k.find(".zmCR").height(),n=0;k.find(".zmCA").is(":visible")&&(n=k.find(".zmCA").height());var o=f+l+m+n+g,p=k.find(".ze_SCmb").height(),q=j-(o+16+5),r=j-(o+p+21+5);k.find(".zmCE").height(q),k.find("iframe.ze_area").height(r),k.find("textarea.ze_area").height(r-30),c[a]&&c[a].shareheight&&zmComp.shareHeight(a)},showDrag:function(a){try{for(var b in c)c&&c[b]&&zmCompOpt.showDrag(b,a)}catch(d){}},hideDrag:function(){try{for(var a in c)c&&c[a]&&zmCompOpt.hideDrag(a)}catch(b){}},isSave:function(a,b){var d=!1;return zmComp.isModified(a)&&(d=!0),!b||"move_tab"!==b&&"reload_preview"!==b||(d=!0),c[a]&&c[a].loadsave&&(d=!0),d},moveTab:function(a){var c=a.cmpId,d=a.draftId;zmUtil.setInlineCmpScope(!1),b[c]=new zmComp.prevInstance,zmComp.backupAttCompRef(c),h(c,b[c]);var e=zmComp.getType(c);zmComp.prvClose(c,e,b[c].msgId,"close","move_tab"),U(c,d)},loadPreview:function(a,c){zmUtil.setInlineCmpScope(!0),b[a]=new zmComp.prevInstance,zmComp.backupAttCompRef(a),h(a,b[a]);var d=zmComp.getType(a);zmComp.prvClose(a,d,b[a].msgId,"close","load_preview_other"),T(a,c)},backupAttCompRef:function(a){var b=zmComp.getAttRef(a);if(c&&c[a]&&b){var d=b.getAllAttachedList();b.clearStoreAttachments(),c[a].attCompRefList=d}},txtFocus:function(a){zmComp.setElemFocus($(a))},updatePriority:function(a){var b=zmComp.getPriorityDom(a).elem,c=b.find("i.msi-priority"),d=zmComp.getPriority(a);"Low"===d?c.removeClass("SC_red SC_blue").addClass("SC_blue"):"High"===d?c.removeClass("SC_red SC_blue").addClass("SC_red"):c.removeClass("SC_red SC_blue")},updPriority:function(a,b){var c="Medium",d=$(zmsuite.getCenter(a)[0].getNodes()[0].$el).find("i.msi-priority");4===b?(c="Low",d.removeClass("SC_red SC_blue").addClass("SC_blue")):2===b?(c="High",d.removeClass("SC_red SC_blue").addClass("SC_red")):d.removeClass("SC_red SC_blue"),zmComp.setPriority(a,c)},objSize:function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},updateDraft:function(a){a.action="sdraft",zmComp.sendMail(a)},updDraftText:function(a,b){zmComp.getDraftDom(a).text(b)},getPriorityDom:function(a){var b,d,e={},f=c[a].type;return"w"===f||"d"===f||"p"===f?(b=$("#zmPriorityM_"+a).find("li"),d="d"):"st"===f?(b=$(c[a].priorityDOM),d="st"):(b=zmsuite.getCenter(a)[0].getNodes()[0].$el,b=b.find("li[data-event='p']"),d="t"),e.elem=b,e.appTy=d,e},getDraftDom:function(a){var b;if(zmail.isComposeMail)b=$("#zmSaveM_"+a).find("li");else if(c[a].type&&"d"===c[a].type)b=$("#zmSaveM_"+a).find("li");else if(c[a].type&&"p"===c[a].type)b=$("#zmSaveM_"+a).find("li");else if(c[a].type&&"st"===c[a].type)b=$(c[a].saveDOM);else{var d=zmsuite.getCenter(a)[0].getNodes()[0].$el;b=d.find("li[data-event='svedrp']")}return b.find("span").eq(1)},getReplyToLst:function(){var a=zmComp.getFromObj(),b={};b[zmComp.getDefault().setRepto]="1";for(var c in a)b[c]="1";return b},saveReply:function(a){for(var b=a.deferObj,c=a.cmpList,d=c.length,e=0;e<d;e++){var f=c[e].cmpId;zmComp.afterSave(f)}b.resolve(!0)},reopenPrev:T,setCmpObj:function(a){c=a},afterSave:function(a,b,d){try{var e=!0;b&&"close_false"===b&&(e=!1);var f={action:"sdraft",sendIm:!1,cmpId:a};if(e&&(f.actVal="close"),zmComp.isSave(a,d))zmComp.sendMail(f);else{var g=c[a].type;if(g&&"p"===g&&c[a]&&c[a].info.prevDOM){zmUtil.setInlineCmpScope(!1),zmComp.updateComposer(a,"close_preview");var h=c[a].info.prevDOM;h.find(".zm_cmp").remove()}clearInterval(zmComp.getInterVal(a)),$("#zmdArea_"+a+" input").each(function(){zmAutoFill.clearData($(this))}),$("#zm_smsg_"+a)&&zmComp.hideMsg(a),c[a].discard_close||delete c[a]}}catch(i){zmComp.debugLog(i)}},send:function(a){var b={action:"compose",sendIm:!1,cmpId:a};zmComp.sendMail(b)},save:function(a,b){var c={action:"sdraft",sendIm:!1,cmpId:a};b&&(c.autosave=b),zmComp.sendMail(c)},getObj:function(a){return c[a]},confirmSend:function(){zmComp.sendMail({action:"outbox",schedule:!0,
scheduled_type:"DATE"}),zmUtil.hideMenu()},constants:{DRAFT_LOAD_TAB:"tab",DRAFT_LOAD_INLINE:"inline"},getOpener:function(){var a;return window&&window.opener&&null!==window.opener.opener?a=window.opener.opener:window&&null!==window.opener&&(a=window.opener),a},draftParentId:function(a,b){for(var c={},d=b.length,e=0;e<d;e++)if(b[e].M===a&&b[e].FD===zmail.folId.dId){c=b[e].PA;break}return c},updateOutbox:function(a){var b={aId:zmComp.getAccId(a),mode:"updOut",mId:zmComp.getMymId(a)},c={u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmCUtil.updateOutboxView,p:b};zmAjq.XHR(c)},modifyOutbox:function(a,b){var c=a.attr("id"),d=c.split("_")[1];zmComp.setModified(d,1),zmComp.modifyAtMention(d,b)},modifyAtMention:function(a,b){if(b&&b.type){var d;b.data&&b.data.eid&&(d=b.data.eid),c[a]._atMentionObj||(c[a]._atMentionObj=[]);var e;c[a]&&c[a]._atMentionObj&&(e=c[a]._atMentionObj),"add"===b.type&&d?e&&e.indexOf(d)===-1&&e.push(d):"remove"===b.type&&d&&e&&e.indexOf(d)!==-1&&e.splice(e.indexOf(d),1)}},modifyRecipients:function(a,b){var d=a.attr("id"),e=zmCUtil.getCmpIdType(d),f=e.cmpId,g=e.eleType,h=zmComp.getShowSuggestions(f);!h||"add"!==b.type&&"remove"!==b.type||zmCUtil.getSugContacts(f,g),zmComp.setModified(f,1),zmComp.modifyAtMention(f,b),"add"===b.type&&g&&"bcc"===g&&zmAutoFill.getAddress(a).length&&1===zmAutoFill.getAddress(a).length&&$.publish("/compose/bccpresent",{cmpID:f,mailID:c[f]?c[f]._draftParentId||c[f].mymId:""})},addComposer:function(a){var b={composeId:"reqDATA"};a.viewType&&(b.elemPrefix=a.viewType),a.prevDOM&&(b.prevDOM=a.prevDOM),a.msgId&&(b.msgId=a.msgId),a.draftId&&(b.draftId=a.draftId),b.actionType="replace_draft",b.composerType=zmComp.constants.DRAFT_LOAD_TAB,zmail.allowInline?$.publish("/mail/preview/draftClosed",b):$.publish("/mail/msgDiscarded",b)},updateComposer:function(a,b){if(b)try{var d,e,f,g={composeId:a};c[a]&&(c[a].info&&(c[a].info.draftId&&(d=c[a].info.draftId),c[a].info.prevDOM&&(g.prevDOM=c[a].info.prevDOM),c[a].info.msgId&&(e=c[a].info.msgId),c[a].info.elemPrefix&&(g.elemPrefix=c[a].info.elemPrefix)),c[a].draftId&&(d=c[a].draftId),c[a].msgId&&(e=c[a].msgId),c[a]._draftParentId&&(f=c[a]._draftParentId),d&&(g.draftId=d),e&&(g.msgId=e),f&&(g.msgId=f));var h;"close_view_aftersend"===b?(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"close_preview_aftersave"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"discard_preview"===b?(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_TAB):"close_preview"===b&&d?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"close_preview"===b?(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"move_tab"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_TAB):"load_preview_other"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"open_draft_folder"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_TAB):"close_tab"===b&&f?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"close_tab"===b&&d?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"close_tab"===b?(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_INLINE):"load_undo_discard"===b?(g.actionType="replace_draft",h=zmComp.constants.DRAFT_LOAD_TAB):"discard_tab"===b&&(g.actionType="discard_draft",h=zmComp.constants.DRAFT_LOAD_TAB),h&&(g.composerType=h,c[a].composerType=h),zmail.allowInline?$.publish("/mail/preview/draftClosed",g):$.publish("/mail/msgDiscarded",g)}catch(i){zmComp.debugLog(i)}},download:function(a,b,c){var d="",e={};"dwn"===c?zmUtil.downloadAttachment(b):"tmpdwn"===c&&(d+=zmail.conPath+"/FileDownload",e={mode:"tmpdwn",entityType:1,accId:zmComp.getAccId(a),fpath:b.fP,fstorename:b.sN},zmAjq.formSubmit(e,d))},fileDOM:function(){var a=['<div class="zmL SC_Pbar" id="{{AT_UID}}">','<div class="zmLst">','<div class="zmDtl">','<div class="zmSze">','<span id="{{AT_UID}}_SZE" class="sum">&nbsp;</span>',"</div>",'<div class="zmFrm">','<span id="{{AT_UID}}_FRM"></span>',"</div>",'<div class="zmImg" id="{{AT_UID}}_IMG">','<i class="{{AT_CLS}}"></i>',"</div>",'<div class="SC_icn" id="{{AT_UID}}_DEL">','<i class="msi-close"></i>',"</div>",'<div class="zm_lbl" id="{{AT_UID}}_STATUS">','<div style="width:0%"></div>',"</div>","</div>","</div>","</div>"].join("");return a},attach_insert:function(a,b){var c=$("#zmAttLst_"+a);c.append(b),$("#zmAtt_"+a).removeClass("SC_dyn"),zmComp.setHeight(a)},deleteAttach:function(a,b){var c=zmComp.getDocsObj(a),d=b.getAttribute("id");if(d)for(var e=c.docStore,f=e.length,g=0;g<f;g++)if(e[g].split(":")[1]===d){c.docName.splice(g,1),c.docPath.splice(g,1),c.docStore.splice(g,1);var h={docName:c.docName,docPath:c.docPath,docStore:c.docStore};return zmComp.setDocsObj(a,h),$(b).remove(),!1}},setDocsPreview:function(a,b){var c,d=zmComp.fileDOM(),e=b.docStore.split(":")[1],f=b.docStore.split(":")[2];c="writer"===f?"msi-attdoc zm-attIcn":"sheet"===f?"msi-attsheet zm-attIcn":"show"===f?"msi-attppt zm-attIcn":"'msi-attothers zm-attIcn",d=d.replace(/{{AT_UID}}/g,e).replace(/{{AT_CLS}}/,c),zmComp.attach_insert(a,d),$("#"+e)&&$("#"+e).off("click").on("click",function(b){b=b||window.event;var c=b.target||b.srcElement,d=!1;if("msi-close"!==c.className&&"SC_icn"!==c.className||(d=!0),d){var e=$(b.target).closest(".zmL")[0];zmComp.deleteAttach(a,e)}});var g=b.docName;g&&(g=g.substring(0,21)),$("#"+e).attr("title",g),$("#"+e+"_FRM").attr("title",g),$("#"+e+"_FRM").text(g),$("#"+e+"_STATUS").remove()},attach_fwdme:function(a,b){var c=zmComp.fileDOM(),d="",e="";if(b.thrd?(d=(new Date).getTime()+"_"+b.mId+"_thrd",e="thread"):(d=(new Date).getTime()+"_"+b.mId+"_msg",e="mail"),c=c.replace(/{{AT_UID}}/g,d).replace(/{{AT_CLS}}/,"msi-atteml zm-attIcn"),zmComp.attach_insert(a,c),$("#"+d)){$("#"+d).off("click").on("click",function(c){c=c||window.event;var d=c.target||c.srcElement,e=!1;"msi-close"!==d.className&&"SC_icn"!==d.className||(e=!0),e&&zmComp.delAttFwd(a,b.mId,b.thrd,$(this))});var f=b.sub;f&&(f=f.substring(0,21)),$("#"+d).attr("title",b.sub),$("#"+d+"_FRM").attr("title",b.sub),$("#"+d+"_FRM").text(f),$("#"+d+"_SZE").text(e),$("#"+d+"_STATUS").remove()}},attachHeight:function(a){var b=$("#zmAttLst_"+a+" > div");b.length||($("#zmAtt_"+a).addClass("SC_dyn"),zmComp.setHeight(a))},getAccId:function(a){var b=zmail.accId;return a&&c[a].accId&&(b=c[a].accId),b},zmsubStr:function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},delegateEID:function(a){var b=zmComp.getShareId(a),c=zmComp.shareListObj()[b],d="";return c&&zmail.shrTree[0][c]&&(d=zmail.shrTree[0][c].EID),d},shareListObj:function(){var a={};zmail.shrTree[0]&&(a=zmail.shrTree[0]);var b={};if(a&&!$.isEmptyObject(a))for(var c in a)a[c].SHID&&(b[a[c].SHID]=c);return b},frmListObj:function(a){var b={};for(var c in a)a[c]&&"undefined"!=typeof a[c].FRM_SIGMODE&&6!==a[c].FRM_SIGMODE&&(b[c]=a[c]);return b},boxSubject:function(a){var b=$("<input/>");b.attr("type","text"),b.attr("data-enableshortcuts",!0),b.addClass("SC_tiput"),b.width(560),b.val(""),b.attr("placeholder",d.specify_subject);var e=$("<li/>");e.addClass("SC_p10"),e.append(b);var f=$("<ul class = 'zmMenuList'/>");f.append(e);var g=$("<div/>");g.addClass("SC_p10"),g.append(f);var h=$("<h4/>"),i=$("<font/>");i.html(d.subject_alert),h.append(i),h.append(g);var j=$("<div/>");j.attr("id","zmcmp_subjalt_"+a),j.html(h);var k={};k.cmpId=a,k.$content=j,k.ignoreMouseDown=!1,k.dialogDidMount=function(b){$("#zmcmp_subjalt_"+a)[0].zmcmp_subjalt_ele=b;var c=$("#zmcmp_subjalt_"+a).find("input").eq(0);c.focus(),c.select(),c.keyup(function(){var b=$("#zmcmp_subjalt_"+a)[0].zmcmp_subjalt_ele.$els.$buttonContainer,e=c.val(),f=d.send;e&&""===$.trim(e)&&(f=d.send_anyway),b.find("span").eq(0).text(f)});var e=b.$els.$maskWrapper;e.on("mousedown",function(a){var c=a.target||a.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):b.remove()})},k.defaultNavigator=!1,k.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_subjalt_"+a)[0].zmcmp_subjalt_ele.remove()}}),k.buttons=[{name:d.send_anyway,callback:function(b){var d=b.$els.$contentWrapper.find("input").eq(0).val();d&&""!==d&&($("#zmsub_"+a).val(d),zmComp.setSubject(a,d)),c[a].subfalse=!0,zmComp.sendMail({action:"compose",sendIm:zmComp.getSendImm(a),cmpId:a,actVal:"subfalse"}),b.remove()}},{name:d.cancel,isCancel:!0,callback:function(a){a.remove()}}],Dialog["new"](k)},getContacts:function(a,b){for(var c="",d="#zm"+b+"txt_"+a,e=zmAutoFill.getAddress($(d)),f=e.length,g=0;g<f;g++)e[g].invalid||(g>0&&(c+=","),c+=e[g].fn+" <"+e[g].eid+">");return c},allContacts:function(a){var b="",c=!1,d=zmComp.getContacts(a,"to"),e=zmComp.getContacts(a,"cc"),f=zmComp.getContacts(a,"bcc");return""!==d&&(b=d,c=!0),""!==e&&c&&(b+=",",b+=e,c=!0),""!==f&&c&&(b+=",",b+=f),b},pushContacts:function(a,b){zmail.ContactBook.set({eid:a,fn:b})},addContacts:function(a){try{var b=zmComp.allContacts(a),c=zmConUtil.splitncheck(b,"object"),d="",e="";for(var f in c)c[f]&&c[f].eid&&!zmCUtil.isEmailExist(c[f].eid)&&(d=c[f].eid,c[f].fn&&(e=c[f].fn),zmComp.pushContacts(d,e))}catch(g){}},dropAttachment:function(a){var b="display:none; height: 100%; width: 100%; left: 0px; top: 0px; position: absolute;",c='<div style="'+b+'">';c+='<div class="SC_drag" style="height:70%"><span>',c+=d.dropMsg,c+="</span></div></div>";var e=$(c);e.on("drop",function(b){var c,d;return e.hide(),b=b||window.event,b.preventDefault&&b.preventDefault(),c=b.originalEvent.dataTransfer,d=c&&c.files,zmComp.getAttRef(a).uploadFiles(d),!1}),$("#zmsub_"+a).parent().on("dragover dragenter",function(a){a=a||window.event;var b=a.originalEvent.dataTransfer;if(b.types.indexOf?b.types.indexOf("Files")!==-1:b.types.contains("application/x-moz-file"))return b.dropEffect="copy",a.preventDefault&&a.preventDefault(),e.show(),!1}),e.on("dragleave",function(){return e.hide(),!1}),$("#zmsub_"+a).parent().append(e)},cmpDialog:function(a){zmComp.removeDiscard();var b=zmComp.getDialogObj();if(b.length){var d=b[0];if(c&&c[d]&&c[d]._dDialog){var e=c[d]._dDialog;return e.$els.$maskWrapper.addClass("SC_Pop"),e.show(),!1}}var f={act:"compose",mode:"compose"};a&&(f.data=a),f.type="d",zmComp.openDialog({},f)},openDialog:function(a,b){var d=zmUtil.getCmpAppId(),e=b.mode,f=b.msgId;zmComp.frmComp(),b.data?(a=b.data,a.mdata&&(a=a.mdata)):a.mdata&&(a=a.mdata),c[d]=new zmComp.newInstance(e),c[d].type="d",c[d].askreceipt?zmComp.setAskReceipt(d,"yes"):zmComp.setAskReceipt(d,"no"),c[d].info=b.info,$.isEmptyObject(a)||(c[d].data=a);var g={};g.cmpId=d,g.type="d";var h=zmCompOpt.headerDOM(g),i=zmCompOpt.recipientDOM(g),j=zmCompOpt.editorDOM(g),l=zmCompOpt.attDOM(g),m=$("<div/>");m.attr("id","zmQuick_compose_"+d),m.append(h,i,j,l);var n={};n.cmpId=d,n.$content=m,n.ignoreMouseDown=!1,n.defaultCloseIcon=!1,n.dialogDidMount=function(a){zmComp.updateDialog(a,d)},n.dialogWillMount=function(a){zmComp.modifyDialog(a,d)},n.defaultNavigator=!1,n.navigator=new zmail.Navigator({onEscape:function(){zmComp.hideDialog(d)}}),Dialog["new"](n),zmComp.setMymId(d,f),b&&b.shId&&zmComp.setShareId(d,b.shId),x(d,e,a),G(d,e,a.SUBJECT),!a.STATUS2ID||5!==a.STATUS2ID&&6!==a.STATUS2ID&&7!==a.STATUS2ID||(c[d].inlineMode=zmComp.getModeObj("string",a.STATUS2ID)),b.info&&b.info.draftId&&(a.MAILID&&(c[d].discard_mailId=a.MAILID),a.INREPLYTO&&(c[d].discard_inReplyTo=a.INREPLYTO),a.REFHEADER&&(c[d].discard_refHeader=a.REFHEADER)),f&&zmCUtil.setTempFolId(d,f),k(d,e),zmComp.loadDialog(d,e,a,b)},hideDialog:function(a){var b=c[a]._dDialog;b.$els.$maskWrapper.removeClass("SC_Pop"),b.hide()},closeDialog:function(a,b){var d=c[a]._dDialog;b?d.remove():zmComp.delCompObj(a)},updateDialog:function(a,b){c[b]._dDialog=a,a.$els.$positionWrapper.addClass("SC_PopTop");var d=$(".zm_compose"),e=d.offset(),f=e.top+"px",g=e.left+d.width()+"px";a.$els.$positionWrapper.css("top",f),a.$els.$positionWrapper.css("left",g)},modifyDialog:function(a,b){a.$els.$maskWrapper.removeClass("SC_cent"),a.$els.$content.attr("id","zmQuick_compose_"+b),a.$els.$content.removeClass()},loadDialog:function(a,b,d,e){try{var f=A(a,b,d);B(a,b,d,e);var g="tab";"p"===c[a].type&&(g="inline"),t(a,b,f,g);var h=!1;if("reply"!==b&&"replyall"!==b&&"fwdi"!==b||(c[a].loadType="drafted",c[a].changeData=!0,h=!0),e.info&&e.info.loadType&&"drafted"===e.info.loadType&&(c[a].loadType=e.info.loadType,c[a].changeData=!1,h=!1),c[a].loadType&&"drafted"===c[a].loadType){var i;zmComp.updateMsgObj(i,a)}h&&(c[a].loadsave=!0),"compose"!==b&&"fwdi"!==b&&"fwdme"!==b||zmComp.setElemFocus($("#zmto_"+a)),zmCUtil.resizeRepDOM(a),zmComp.setHeight(a),E(a),F(a,b),j(a),zmUtil.addCmpAppId()}catch(k){zmComp.debugLog(k)}},enableSave:function(a){var b;c[a]&&"d"===c[a].type?b=$("#zmSaveM_"+a).find("li"):c[a]&&"p"===c[a].type?b=$("#zmSaveM_"+a).find("li"):c[a]&&"st"===c[a].type?b=$(c[a].saveDOM):zmail.isComposeMail?b=$("#zmSaveM_"+a).find("li"):!zmUtil.isChildWindow()&&zmsuite.getAppObj(a)&&zmsuite.getAppObj(a).centerObj&&(b=$(zmsuite.getCenter(a)[0].getNodes()[0].$el).find("li[data-event='svedrp']")),a&&c[a]&&(c[a].enableDiscard=!0),b&&b.removeClass("SC_op3 SC_nopntr");var d=zmComp.getCommentObj(a);"t"!==zmComp.getType(a)||d&&(!d||d.entityExists)||zmComp.enableDraftShare(a)},updAtMention:function(a){c[a]._atMentionObj||(c[a]._atMentionObj=[]);for(var b=[$("#zmtotxt_"+a),$("#zmcctxt_"+a),$("#zmbcctxt_"+a)],d=[],e=0;e<b.length;e++){var f=zmAutoFill.getAddress(b[e]);if(f.length)for(var g=0;g<f.length;g++)d.push(f[g])}var h=d.length;if(h)for(var i=0;i<h;i++)c[a]&&c[a]._atMentionObj&&c[a]._atMentionObj.indexOf(d[i].eid)===-1&&c[a]._atMentionObj.push(d[i].eid)},parseHTML:function(a){return $("<div/>").append($.parseHTML(a)).html()},decodeEscape:function(a){return a.replace(/\\x([0-9A-Fa-f]{2})/g,function(){return String.fromCharCode(parseInt(arguments[1],16))})},shareEID:function(a){u(a)},composeMail:function(a,b){J(a,b)},debugLog:function(a){zmUtil.debugLog(a)},insertAttachment:function(a,b){zmComp.getAttRef(a).addFiles(b.NEWATT)},cmpData:function(){zmComp.frmComp();var a={};return a.askReceipt=zmComp.getDefault().askReceipt,a.charset=zmComp.getDefault().charset,a.smType=zmComp.getDefault().smType,a.outIntr=zmComp.getDefault().outIntr,a.setRepto=zmComp.getDefault().setRepto,a.showBcc=zmComp.getDefault().showBcc,a.fromObj=zmComp.getFromObj(),a.signObj=zmComp.getSignObj(),a.encode=zmComp.getEncodeList(),a.fromAddr=zmComp.getDefaultFrom(),a},loadAppObj:function(a){return c[a]=new zmComp.newInstance("compose"),c[a].type="st",c[a]},loadSharedAttachments:function(a){var b,c=a.attArr,d=c.length,e=[],f=a.pid;f=f.indexOf("#")!==-1?f.substring(f.indexOf("#")+1,f.length):f;for(var g,h=a.actionType,i=a.groupId,j=a.elm,k="",l=0;l<d;l++)g=c[l],b={Id:g.id,e:f,et:g.et,fs:g.size,ft:g.ft,l:[],fn:g.name,p:g.part,thn:g.thn,tn:!0,type:h,u:g.u,gId:i},k&&(b.dn=k),e.push(b);var m;$(j).find(".zmImg").click(function(){m=$(this).parents(".zmL").data("detail"),zmUtil.initAttSlideShow(e,m)}),$(j).find(".SC_Pbar").click(function(b){m=$(this).data("detail"),zmAttach.util.bindoptions(b,{attList:e,from:"streams",pid:f,type:a.type,index:m,attClass:"SC_Pbar"})})},getAppDOM:function(a,b){a=a.mdata;var c="CmpDft"+(new Date).getTime(),d={};d.cmpId=c,d.type="st";var e=zmCompOpt.recipientDOM(d),f=zmCompOpt.editorDOM(d),g=zmCompOpt.attDOM(d),h=$("<div/>");h.attr("class","SC_Drft zmDrftMask"),h.attr("id",d.cmpId),h.append(e,f,g),b.postElm.html(h);var i=ZE.createDraftToolbar(zmCUtil.getSmartToolbar()),j=$("#zmEdi_"+c);j.append(i);var k=$("<div/>");k.addClass("ze_body zmDrftMask");var l=$("<div/>");l.attr("id","zmeditor_content"),l.css("overflow","auto"),l.css("padding","15px"),l.html(a.CONTENT),k.append(l),j.append(k),j.height("200px");var m=j.find(".ze_SCmb").outerHeight(),n=200-(m+30);if(j.find("#zmeditor_content").height(n),$("#zm_fromaddr_"+c).text(a.FROM),$("#zmsub_"+c).val(a.SUBJECT),a.NEWATT&&a.NEWATT.length){var p=zmAttach.build(a.NEWATT,{from:"compose",attClass:"SC_Pbar"});$("#zmAttLst_"+c).html(p),$("#zmAtt_"+c).removeClass("SC_dyn");var q={};q.attArr=a.NEWATT,q.cmpId=c,q.actionType=b.actionType,q.groupId=b.groupId,q.pid=b.pid,q.elm=$("#zmAttLst_"+c),zmComp.loadSharedAttachments(q)}var r=a.TO,s=a.CC,t=a.BCC;r&&""!==$.trim(r)&&o(c,"to",r),s&&""!==$.trim(s)&&"Not Provided"!==$.trim(s)&&(o(c,"cc",s),zmComp.shCBc(c,"c")),t&&$.trim(t)&&(o(c,"bcc",t),zmComp.shCBc(c,"b")),zmCUtil.resizeRepDOM(c),b.callback()},getZDocLink:function(a){var b=zmComp.getZDocLoc(a),d=[];return c[a]&&c[a].plaindoclink&&(d=c[a].plaindoclink),b=$.grep(b,function(a){return $.inArray(a,d)<0})},loadCmpDOMProp:function(a,b){c[a].saveDOM=b.saveDOM,c[a].priorityDOM=b.priorityDOM,c[a].errorPar=b.errorPar,c[a].type=b.type;var d=b.editor;zmComp.setEditor(a,d);var e={};e=q(a,e),d.updateConfigProperties(e),zmComp.setAttRef(a,b.attRef)},getCmpData:function(){var a={},b=zmUtil.getCmpAppId();return a.data=zmComp.cmpData(),a.appobj=zmComp.loadAppObj(b),a.cmpId=b,zmUtil.addCmpAppId(),a},print:function(a){var b=a.cmpId,c={},e="",f="",g="",h={},i={},j={};h=zmComp.cmpGetAddr(b,"to"),i=zmComp.cmpGetAddr(b,"cc"),j=zmComp.cmpGetAddr(b,"bcc"),h.address&&(e=h.address),i.address&&(f=i.address),j.address&&(g=j.address),c.TO=e,c.CC=f,c.BCC=g;var k=zmComp.getFromAddr(b);c.F=k;var l=zmComp.getFromObj(),m="";l[k]&&l[k].FRM_DISN&&(m=l[k].FRM_DISN),c.SN=m,m&&(m='"'+m.replace(/(^|[^\\])"/g,'$1\\"')+'"',k=m+" <"+k+">"),c.FROM=k,zmComp.getAttRef(b)&&(c.NEWATT=zmComp.getAttRef(b).getAllAttachedList());var n=$("#zmsub_"+b).val();n=$.trim(n),""===n&&(n=d.nosubject),c.SUBJECT=n;var o=zmComp.getEditor(b),p=$(o.doc.body),q=p.find("div[name=ZM_SHWTRIM]");q.length&&q.remove();var r=p.find("div.zmail_extra");r.length&&r.show();var s=o.getContent(),t="<div style='font-size:"+zmCUtil.getfontSize()+"pt;",u=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==u&&(t+="font-family:"+u+";"),t+="color:"+zmCUtil.getfontColor()+";",t+="'>"+s+"</div>",c.CONTENT=t;var v=zmComp.getFwdMsg(b);v&&v.length&&(c.fwdMsgIds=v);var w=zmComp.getFwdThrd(b);w&&w.length&&(c.fwdtId=w);var x={mId:zmComp.getPrintId(b),contObj:c,type:"compose"},y={};if(zmComp.getMetaObj(b))y=zmComp.getMetaObj(b);else{var z="";zmail.folId&&(z=zmail.folId.dId),y.FD=z,y.SB=c.SUBJECT,y.M=zmComp.getPrintId(b),y.SN=c.SN,y.F=c.F}x.msgObj=y,zmAppLoader.load("mailPrinter").done(function(){mailPrinter.print(x)})},startClock:j,getCmpObj:function(){return c},getCurrentCompId:function(){var a;return zmail.isComposeMail?a=zmComp.windowCmpId:(!zmUtil.isChildWindow()&&zmTab&&(a=zmTab.currentTab),a&&a.indexOf("Cmp")===-1&&(a=null)),a}};return Y(),Z}(),function(a){var b=a.getCmpObj(),c={},d={},e={},f={},g={},h={},i=function(){this.to="",this.cc="",this.bcc="",this.isCC="",this.isBCC="",this.from="",this.replyto="",this.msgId="",this.askreceipt="no"},j=function(a,b){this.composeId=a,this.listObj=[],this.composerType=b},k=function(a){this.mode=a,"reply"!==a&&"replyall"!==a&&"fwdi"!==a||(this.inlineMode=a),this.modified=0,this.editor="",this.lastModified=0,this.prevModified=0,this.charset=d.charset,this.refHeader="",this.inReplyTo="",this.mailId="",this.mymId="",this.priority="Medium",this.attTmpObj=[],this.process=!1,this.subject="",this.isChanged=!1,this.accId=zmail.accId,this.dmailid="",this.dftId="",this.tempId="",this.data_mailId="",this.data_inReplyTo="",this.data_refHeader="",this.fromAddr=zmComp.getDefaultFrom(),this.replyto=zmCUtil.getReplyTo(this.fromAddr),this.uplpending=0,this.imagepending=0,this.discard_close=!1,this.inlinemapObj={},0===d.askReceipt&&(this.askreceipt="yes"),zmail.isInternalOrgUser&&(this.showSuggestionContacts="0"===zmAdHocSettings.getContactsSuggestionType())},l=function(){var a=zmail.cmpdata;d.askReceipt=a.ASKRECEIPT,d.charset=a.CHAR_SET,a.DEFFRM_ADDR&&zmComp.setDefaultFrom(a.DEFFRM_ADDR),d.smType=a.HTML_ENABLED,d.outIntr=a.OUT_INTERVAL,d.setRepto=a.SETREPTO,d.showBcc=a.SHOWBCC,zmComp.setFromObj(zmComp.frmListObj(a.FROM_LIST)),zmComp.setSignObj(a.SIGN_INFO),zmComp.setEncodeList(a.ENCODE_LIST)},m=function(a){var b="";return zmComp.getFromObj()[a]&&zmComp.getFromObj()[a].FRM_DISN&&(b=zmComp.getFromObj()[a].FRM_DISN),b},n=function(a){if(a&&""!==$.trim(a)){var b=zmComp.getDispName(a);b=zmCUtil.getText(b),b&&(a=b+" <"+a+">")}return a},o=function(a){if(a&&""!==$.trim(a)){var b=zmComp.getDispName(a);b=zmCUtil._entityText(b),b&&(a=b+"&nbsp;&lt;"+a+"&gt;")}return a},p=function(a,b){var c=b.REPLYFROM;return"outbox"===a||"draft"===a||"template"===a?c=b.FROM:"fwdi"===a&&(c=zmComp.getDefaultFrom()),zmComp.getFromObj()[c]||(c=zmComp.getDefaultFrom()),c},q={newInstance:k,prevInstance:i,prevDOM:j,prevDOMOBJ:f,frmComp:l,getDispName:m,getFromDispN:n,lstFromDispN:o,getFromData:p,getMsgObj:function(){return e},getCmpMsgObj:function(){return g},getPrvObj:function(){return zmComp.cmpPrvObj},getFromObj:function(){return c.fromObj},getTemplate:function(){return c.tempObj},setTemplate:function(a){c.tempObj=a},getEncodeList:function(){return c.encode},setEncodeList:function(a){c.encode=a.split(",")},getSignObj:function(){return c.signObj},setSignObj:function(a){c.signObj=a},getDefault:function(){return d},getDefaultFrom:function(){return zmail.fromAddr},setDefaultFrom:function(a){zmail.fromAddr=a},setFromObj:function(a){c.fromObj=a},getPriority:function(a){return b[a].priority},setPriority:function(a,c){b[a].priority=c},getMymId:function(a){return b[a].mymId},setMymId:function(a,c){b[a].mymId=c},getPrintId:function(a){return b[a].printId},setPrintId:function(a,c){b[a].printId=c},getMetaObj:function(a){return b[a].metaobj},setMetaObj:function(a,c){b[a].metaobj=c},getMailId:function(a){return b[a].mailId},setMailId:function(a,c){b[a].mailId=c},getInReplyTo:function(a){return b[a].inReplyTo},setInReplyTo:function(a,c){b[a].inReplyTo=c},setPrevModified:function(a,c){b[a].prevModified=c},getPrevModified:function(a){return b[a].prevModified},setLastModified:function(a,c){b[a].lastModified=c},getLastModified:function(a){return b[a].lastModified},getRefHeader:function(a){return b[a].refHeader},setRefHeader:function(a,c){b[a].refHeader=c},getCharSet:function(a){return b[a].charset},setCharSet:function(a,c){b[a].charset=c},setDocsObj:function(a,c){b[a].docsRef=c},getDocsObj:function(a){return b[a].docsRef},getStatus:function(a){return b[a].process},setStatus:function(a,c){b[a].process=c},getSubject:function(a){return b[a].subject},setSubject:function(a,c){b[a].subject=c},getFromAddr:function(a){return b[a].fromAddr},setFromAddr:function(a,c){b[a].fromAddr=c},getReplyto:function(a){return b[a].replyto},setReplyto:function(a,c){b[a].replyto=c},getShareId:function(a){return b[a].shareId},setShareId:function(a,c){b[a].shareId=c},getInterVal:function(a){return b[a].interval},setInterVal:function(a,c){b[a].interval=c},getAttTmp:function(a){return b[a].attTmpObj},setAttTmp:function(a,c){b[a].attTmpObj.push(c)},getFwdThrd:function(a){return b[a].fwdThrdObj},setFwdThrd:function(a,c){zmComp.getFwdThrd(a)?b[a].fwdThrdObj=b[a].fwdThrdObj.concat(c):b[a].fwdThrdObj=c},getFwdMsg:function(a){return b[a].fwdMsgObj},setFwdMsg:function(a,c){zmComp.getFwdMsg(a)?b[a].fwdMsgObj=b[a].fwdMsgObj.concat(c):b[a].fwdMsgObj=c},getAttEnt:function(a){return b[a].attEntObj},setAttEnt:function(a,c){zmComp.getAttEnt(a)?b[a].attEntObj=b[a].attEntObj.concat(c):b[a].attEntObj=c},getAttEntity:function(a){return b[a].attEntity},setAttEntity:function(a,c){zmComp.getAttEntity(a)?b[a].attEntity=b[a].attEntity.concat(c):b[a].attEntity=c},getEditor:function(a){return b[a].editor},setEditor:function(a,c){b[a].editor=c},getAttRef:function(a){return b[a].attCompRef},setAttRef:function(a,c){b[a].attCompRef=c},getType:function(a){return b[a].type},setType:function(a,c){b[a].type=c},getSmartData:function(a){return b[a].smartData},setSmartData:function(a,c){b[a].smartData=c},getFID:function(a){return b[a].fId},setFID:function(a,c){b[a].fId=c},getModified:function(a){return b[a].modified},setModified:function(a,c){1===c&&zmComp.enableSave(a),b[a].modified=c},getMode:function(a){return b[a].mode},setMode:function(a,c){b[a].mode=c},getOutboxClose:function(a){return b[a].setOutboxClose},setOutboxClose:function(a,c){b[a].setOutboxClose=!0},getSendImm:function(a){return b[a].sendImm},setSendImm:function(a,c){b[a].sendImm=c},getOutboxMailId:function(a){return b[a].outboxMailId},setOutboxMailId:function(a,c){b[a].outboxMailId=c},getAskReceipt:function(a){return b[a].askreceipt},setAskReceipt:function(a,c){b[a].askreceipt=c},getTempId:function(a){return b[a].tempId},setTempId:function(a,c){b[a].tempId=c},setCmpId:function(a,b){g[a]=b},getCmpId:function(a){return g[a]},setMsgId:function(a,b){e[a]=b},getMsgId:function(a){return e[a]},setCmtDraftId:function(a,b){h[b]=a},getCmtDraftId:function(a){return h[a]},setSugType:function(a,c){b[a].sugType=c},getSugType:function(a){return b[a].sugType},setCommentObj:function(a,c){b[a].commentObj=c},getCommentObj:function(a){return b[a].commentObj},setShowSuggestions:function(a,c){b[a].showSuggestionContacts=c},getShowSuggestions:function(a){return b[a].showSuggestionContacts}};$.extend(!0,a,q)}(window.zmComp),function(a){var b=a.getCmpObj(),c=function(a,b){var c={5:"reply",6:"replyall",7:"fwdi"},d={reply:"5",replyall:"6",fwdi:"7"},e="";return"string"===a&&(e=c[b]),"int"===a&&(e=d[b]),e},d=function(a){var c,d,e={},f=!1,g=!1,h=!1;for(var i in b){if(b[i].loadType&&"drafted"===b[i].loadType&&(f=!0,e._loadType="drafted"),b[i].discard_close||(g=!0,e._discard=!0),b[i]._draftParentId&&b[i]._draftParentId===a&&(h=!0,e._draftParentId=!0),b[i].draftId&&b[i].draftId===a&&(h=!0),h&&g){c=i;break}if(b[i].mymId===a&&f&&g){c=i;break}}if(c&&b[c].type&&"t"===b[c].type)d=zmComp.constants.DRAFT_LOAD_TAB;else if(c&&b[c].type&&"p"===b[c].type){var j=new zmComp.prevDOM(c,"p");j.listObj.push(b[c].info.prevDOM),zmComp.prevDOMOBJ[c]=j,d=zmComp.constants.DRAFT_LOAD_INLINE}return c&&(e.cmpId=c),d&&(e.composerType=d),e},e=function(a){var c=!1;if(b[a]){var d=zmComp.getLastModified(a),e=zmComp.getPrevModified(a),f=zmComp.getModified(a);(1===f||d>e)&&(c=!0)}return c},f=function(a,c){var d,e=["desktop","myAttachchment","zDocs","otherCloud"];b[a]&&zmComp.getAccId(a)&&(d=zmComp.getAccId(a));var f={componentId:"zmEdi_"+a,attachFrom:e,isNewImp:!0,currentAttachedSize:0,autoLaunch:!1,eleId:"zmAttLst_"+a,onAddElement:function(){zmComp.updateAttachment(a,"ele","add")},onRemoveElement:function(){zmComp.updateAttachment(a,"ele","remove")},onAddAttachment:function(){zmComp.updateAttachment(a,"att","add")},onRemoveAttachment:function(){zmComp.updateAttachment(a,"att","remove")},preAttachedFile:c,insertDocsLink:zmComp.insertDocsLink};d&&(f.accId=d);var g="richtext";0===zmComp.getDefault().smType&&(g="plaintext"),f.renameSupport=!0,("richtext"===g||zmail.showFeature)&&(f.showZDocsAsLinkOption=!0),zmUtil.initAttachComponent(f,function(c){b[a]&&(b[a].attCompRef=c)})},g=function(a){var b=[],c=zmComp.getEditor(a).getContent(),d=/https:\/\/docs.zoho.com\/file\/.[(a-z)(A-Z)(0-9]*/g,e=c.match(d);if(e&&e.length)for(var f=e.length,g=/https:\/\/docs.zoho.com\/file\//g,h=0;h<f;h++){var i=e[h].replace(g,"");b.push(i)}return b},h=function(a,b){var c=b.doc,d=$(c).find("[class=zmail_extra]");return d.length&&(d.show(),"ZM_SHWTRIM"===d.prev().attr("name")&&d.prev().remove()),b.getContent()},i=function(a,b){b=b||window.event;var c=b.target||b.srcElement;if(c&&"ZM_SHWTRIM"===$(c).attr("name")){b&&zmUtil.stopEvents(b),$(c).remove();var d=zmComp.getEditor(a).doc;$(d).find("[class=zmail_extra]").show()}else{if(c&&"ZM_SHAREDOC"===$(c).attr("name")&&$(c).is("a"))return window.open($(c).attr("href"),"_blank"),b&&zmUtil.stopEvents(b),!1;if(c&&"ZM_SHAREDOC"===$(c).attr("name")&&$(c).is("div")){var e=$(c).closest("table").attr("data-zmdocname");zmComp.clearZDoc(c,a,e)}else c&&$(c).closest("table").attr("data-zmdocname")&&b&&zmUtil.stopEvents(b)}},j={initAttachComp:f,getModeObj:c,isModified:e,getZDocLoc:g,popupTrimmed:h,showTrimmed:i,getCmpObjId:d,offSugDOMList:function(){try{for(var a in b)if(b&&b[a]){var c=$("#zmsuglist_"+a);c.length&&(b[a].resizeTab=!0,c.parent().hide())}}catch(d){}},offSugList:function(){try{for(var a in b)b&&b[a]&&(b[a].showSuggestionContacts=!1)}catch(c){}},onSugList:function(){try{for(var a in b)b&&b[a]&&(b[a].showSuggestionContacts=!0)}catch(c){}}};$.extend(!0,a,j)}(window.zmComp),function(a){var b=a.getCmpObj(),c=function(){var a=zmText.get("zmcompose");return a}(),d=function(a,d,e,f){var g=b[a].type,h="";if(""===d.address&&""===e.address&&""===f.address&&(h=c.please_select_recipients,d.error!==!0&&e.error!==!0&&f.error!==!0||(h=c.address_invalid)),h){zmComp.showMsg(a,"i",h,g);var i;if("st"===g){var j=b[a].smartData.domLst.toPar;i=$(j).find("input").eq(0)}else i=$("#zmto_"+a);return zmComp.setElemFocus(i),!1}return!0},e=function(a,c){var d="";c&&(d=c),"send"===d&&b[a]&&zmComp.setStatus(a,!1),"save"===d&&b[a]&&(b[a].saveReq=!1,b[a].savedraft=!1)},f=function(a){var d=a.cmpId,f=a.errType,g=a.type,h=a.resp,i=a.triggerType;if(e(d,i),f&&"serverError"===f&&h){var j="HTML";h.errorCode&&h.errorCode!==-1&&7020!==h.errorCode&&(j="TEXT"),zmComp.showMsg(d,"e",h.error,g,void 0,j)}if(f&&"sendError"===f){var k="Request failed";h&&h.msg&&(k=h.msg),zmComp.showMsg(d,"e",k,g)}if("save"===i&&b&&b[d]){var l=c.save_draft;if(b[d].draft_saved_txt){var m=c.save_lastmodified;l=zmText.applyArgs(m,{TIME:b[d].draft_saved_txt})}zmComp.updDraftText(d,l)}},g=function(a,b){var c={};c.cmpId=b.cmpId,c.resp=a,c.type=b.type,c.errType="sendError",c.triggerType=b.triggerType,f(c)},h=function(a){var b={};b.cmpId=a.cmpId,b.type=a.type,b.errType="networkError",b.triggerType=a.triggerType,f(b)},i=function(a,b){var c={};c.cmpId=b.cmpId,c.resp=a,c.type=b.type,c.errType="serverError",c.triggerType=b.triggerType,f(c)},j=function(a){if(b&&b[a]&&b[a].auto_mailId){var c=zmComp.getAccId(a),d=b[a].auto_mailId;zmCUtil.clearDraft(c,d)}},k=function(a,b){e(a,b.triggerType)},l=function(a,d){var e,f=d.cmpId,g=d.act,h=d.mode,l=d.sendImm,m=d.tempact,n=d.type,o=d.mymId;if(b&&b[f]&&b[f].capSave&&a&&a.dmailid&&(e=$.trim(a.dmailid),b[f].auto_mailId=e,b[f].capSave=!1),a.inlineImageUrls)if(Object.keys(b[f].inlinemapObj).length<1)b[f].inlinemapObj=a.inlineImageUrls||{};else{var p=b[f].inlinemapObj,q=a.inlineImageUrls||{},r=Object.keys(p),s=Object.keys(q),t=[];r.forEach(function(a){t.push(p[a])});var u=[];s.forEach(function(a){u.push(q[a])});for(var v=s.length,w=r.length,x=0;x<v;x++)for(var y=0;y<w;y++){if(t[y]===s[x]){p[r[y]]=u[x];break}y===w-1&&(p[s[x]]=u[x])}}d._dupDraft&&b&&b[f]&&j(f),k(f,d),"undefined"==typeof d.tmpUpdate||d.tmpUpdate?"draft"===d.mode&&d.mailId!==a.dmailid&&$.publish("compose/newDraft",{}):$.publish("compose/newTemplate",{});var z,A=!1,B="",C="";if(a.error)i(a,d);else{zmComp.setModified(f,0),zmComp.setLastModified(f,0),zmComp.setPrevModified(f,(new Date).getTime()),b[f].changeData=!1,zmail.userOptions&&1===zmail.userOptions.autoAddContacts&&zmComp.addContacts(f);var D={},E={};if(E.cmpId=f,E.msgId=o,"sdraft"===g||"stemplate"===g){var F=$.trim(a.msgId),G=$.trim(a.dmailid);if(G&&zmComp.setOutboxMailId(f,G),F&&zmComp.setPrintId(f,F),a.msgObj&&zmComp.setMetaObj(f,a.msgObj),"sdraft"===g&&d&&d.close)D.draftId=$.trim(a.msgId),b[f].dftId=$.trim(a.msgId),b[f]&&b[f].mymId&&(D.msgId=b[f].mymId),b[f]&&b[f]._draftParentId&&(D.msgId=b[f]._draftParentId),B="Draft saved @ "+a.dftst,zmComp.showMsg(f,"s",B,n),E.triggerType="close_preview_aftersave",zmComp.comClose(E);else if("sdraft"===g){var H=$.trim(a.msgId);$.publish("/compose/savedraft",{draftId:H,draftOj:d}),D.draftId=$.trim(a.msgId),b[f].dftId=$.trim(a.msgId),b[f]&&b[f].mymId&&(D.msgId=b[f].mymId),b[f]&&b[f]._draftParentId&&(D.msgId=b[f]._draftParentId),e=$.trim(a.dmailid);var I=$.trim(a.msgId);b[f].discard_mailId=e,b[f].discard_Id=I,I&&(b[f].draftId=I),e&&(b[f].dmailid=e),d.refHeader&&(b[f].discard_refHeader=d.refHeader),d.inReplyTo&&(b[f].discard_inReplyTo=d.inReplyTo),zmail.folId&&zmComp.setFID(f,zmail.folId.dId),C=c.save_lastmodified,B=zmText.applyArgs(C,{TIME:a.dftst}),b[f].draft_saved_txt=a.dftst,zmComp.updDraftText(f,B),!zmail.isComposeMail&&zmComp.getCurrentCompId()&&(zmComp.cmpHashURL(f,["drafts",H]),zmComp.cmpRestoreState(f,{mode:"draft",msgId:H}));var J=zmUtil.isZohoAccount(zmComp.getAccId(f));if("t"===b[f].type&&zmail.isOrg&&J){
var K=!1,L=zmComp.getCommentObj(f),M=b[f].loadDraftComment;void 0===("undefined"==typeof M?"undefined":babelHelpers["typeof"](M))||M||(K=!0),L&&K&&d.viashare?zmComp.setDraftFocus(f):!L&&b[f].loadDraftComment?zmComp.draftComments(f,I,"draft_newsave"):L&&L.entityExists?zmComp.enableNotifyAll(f,I,"draft_save"):L||zmComp.enableShare(f,I,"draft_newsave")}}else if("stemplate"===g){var N=$.trim(a.msgId);N&&zmComp.setTempId(f,N),zmail.folId&&zmComp.setFID(f,zmail.folId.teId),B=m?c.template_modified:c.template_saved,zmComp.showMsg(f,"s",B,n)}}else{var O="";zmComp.getDefault().outIntr===-1||l||(A=!0),a.scheduledTime?(C=c.scheduled_time,B=zmText.applyArgs(C,{TIME:a.scheduledTime}),O=B):A?O=c.message_scheduled:_zm._isPrivilegedUser()?zmRecall.showRecallBand(a.UUID):O=c.message_sent,z=b[f].discard_Id,"outbox"===zmComp.getMode(f)&&zmComp.setOutboxClose(f,!0),b[f]&&b[f].type&&"d"===b[f].type&&(b[f].closeQuick=!0),E.triggerType="close_view_aftersend",E.msgTxt=O,zmComp.comClose(E),d.bcc&&$.publish("/compose/bccpresent",{cmpID:f,mailID:b[f]?b[f]._draftParentId||b[f].mymId:""})}"reply"!==h&&"replyall"!==h&&"forward"!==h||$.publish("compose/mode",d);var P="";zmail.isComposeMail&&(P="w");var Q=zmComp.getOpener();Q&&Q.zmUtil.postMailActionsOnSend({action:g,msgId:o,draftObj:a.msgObj,draftDataObj:D,draftId:z,schedule:A,mode:h,cmpType:P}),zmail.isComposeMail||zmUtil.postMailActionsOnSend({action:g,msgId:o,draftObj:a.msgObj,draftDataObj:D,draftId:z,schedule:A,mode:h,cmpType:P})}},m={setDraftFocus:function(a){var b=zmsuite.getAppObj(a);if(b){var c,d=b.centerObj.$el,e=d.find(">.SCmc"),f=zmComp.getCommentObj(a),g=e.find(".zmScCmnt");e.hasClass("zmCShared")?(f.focusComments(),f.highlightComment()):(zmCUtil.clearResizeRepDOM(a),g.find(".SCS_postWra").length&&g.find(".SCS_postWra").addClass("SC_dyn"),e.addClass("zmCShared"),c=zmComponent.loadingBand({container:g[0],type:"pagination"}),setTimeout(function(){zmCUtil.transResizeRepDOM(a),c&&c(),g.find(".SCS_postWra").length?g.find(".SCS_postWra").removeClass("SC_dyn"):g.append(f.jqDOM),f.focusComments(),f.highlightComment()},300)),zmComp.tooltipComment(a)}},draftComments:function(a,d,e){zmAppLoader.load("mailCollaboration").then(function(){var f=function(){return zdom("div",{className:"zmScCmnt"},zdom("div",{className:"SCmb puClose"},zdom("ul",null,zdom("li",{className:"ScCmntClose"},zdom("b",null,zdom("span",null,zdom("i",{className:"msi-close"})))))))},g=zmsuite.getAppObj(a).centerObj.$el,h=g.find(">.SCmc");h.append($(f()));var i,j=h.find(".zmScCmnt");"draft_newsave"===e&&(zmCUtil.clearResizeRepDOM(a),h.addClass("zmCShared"),i=zmComponent.loadingBand({container:j[0],type:"pagination"}),setTimeout(function(){zmCUtil.transResizeRepDOM(a)},300));var k=j.find(".ScCmntClose");k.off("click").on("click",function(){h.removeClass("zmCShared"),setTimeout(function(){zmCUtil.transResizeRepDOM(a),j.append(zmComp.getCommentObj(a).jqDOM)},300),zmComp.tooltipComment(a)}),k.attr("data-tooltip",c.hidecomments),zmComp.tooltipComment(a);var l={draftID:d,parentElem:j,context:{composeID:a,draftID:d}};zmUtil.DraftShare.loadComments(l).done(function(f){var g,k=$(zmsuite.getCenter(a)[0].getNodes()[0].$el);if("draft_onload"===e)if(f.entityExists){zmComp.showComment(a);var m=k.find("li[data-event='cmp_cmt']"),n=m.find("span"),o=0;f.count&&(o=f.count);var p=n.find(".StCnt");!p.length&&o?n.append(zdom("span",{className:"StCnt"}," ",o," ")):o&&p.text(o),zmComp.enableNotifyAll(a,d,e)}else{g=k.find("li[data-event='cmp_share']");var q=g.find("span").eq(1);q.text(c.sharedraft),g.attr("data-tooltip",c.sharedraft),g.addClass("SC_thm"),g.removeClass("SC_op3 SC_nopntr"),g.length&&(g.off("mousedown").on("mousedown",function(a){a.preventDefault()}),g.off("click").on("click",function(){h.hasClass("zmCShared")?(f.focusComments(),f.highlightComment()):(zmCUtil.clearResizeRepDOM(a),j.find(".SCS_postWra").length&&j.find(".SCS_postWra").addClass("SC_dyn"),h.addClass("zmCShared"),i=zmComponent.loadingBand({container:j[0],type:"pagination"}),setTimeout(function(){zmCUtil.transResizeRepDOM(a),i&&i(),j.find(".SCS_postWra").length?j.find(".SCS_postWra").removeClass("SC_dyn"):j.append(f.jqDOM),f.focusComments(),f.highlightComment()},300)),zmComp.tooltipComment(a)}))}"draft_newsave"===e&&(i&&i(),j.append(f.jqDOM),g=k.find("li[data-event='cmp_share']"),g.length&&(g.off("mousedown").on("mousedown",function(a){a.preventDefault()}),g.off("click").on("click",function(){h.hasClass("zmCShared")?(f.focusComments(),f.highlightComment()):(zmCUtil.clearResizeRepDOM(a),j.find(".SCS_postWra").addClass("SC_dyn"),h.addClass("zmCShared"),i=zmComponent.loadingBand({container:j[0],type:"pagination"}),setTimeout(function(){zmCUtil.transResizeRepDOM(a),i&&i(),j.find(".SCS_postWra").removeClass("SC_dyn"),f.focusComments(),f.highlightComment()},300)),zmComp.tooltipComment(a)})),f.focusComments(),f.highlightComment()),f.parentElem=l.parentElem,b[a].loadDraftComment=!1,zmComp.setCommentObj(a,f),zmComp.setCmtDraftId(a,d)}).fail(function(){h.removeClass("zmCShared"),setTimeout(function(){zmCUtil.transResizeRepDOM(a)},300),zmComp.showMsg(a,"i",c.unable_load_comments,"t")})})},updateNotifyAll:function(a){var b=zmComp.getCmtDraftId(a.draftId);if(b&&(zmComp.enableNotifyAll(b,a.draftId,"enablevia_notify"),zmComp.isModified(b))){var c={};c.cmpId=b,c.viashare=!1,zmComp.updateDraft(c)}},updateComment:function(a){var b=zmComp.getCmtDraftId(a.entityId);if(b){var c=$(zmsuite.getCenter(b)[0].getNodes()[0].$el),d=c.find("li[data-event='cmp_cmt']"),e=d.find("span"),f=0;if(a.total&&(f=a.total),f){zmComp.showComment(b);var g=zmComp.getCommentObj(b);g.entityExists=!0}var h=e.find(".StCnt");f?!h.length&&f?e.append(zdom("span",{className:"StCnt"},f)):f&&h.text(f):h.remove()}},showComment:function(a){if(b[a]){var c;b[a].type&&(c=b[a].type),c&&"t"===c?(zmComp.getShareEle(a).liObj.addClass("SC_thm"),zmsuite.getCenter(a)[0].getNodes()[0].showGroup("compComment")):$("#zmShareM_"+a).removeClass("SC_dyn")}},tooltipComment:function(a){var b=zmsuite.getAppObj(a).centerObj.$el,d=b.find(">.SCmc").eq(0),e=$(zmsuite.getCenter(a)[0].getNodes()[0].$el),f=e.find("li[data-event='cmp_cmt']");d.hasClass("zmCShared")?f.attr("data-tooltip",c.hidecomments):f.attr("data-tooltip",c.showcomments)},toggleComment:function(a){zmCUtil.clearResizeRepDOM(a);var b=zmComp.getCommentObj(a),c=zmsuite.getAppObj(a).centerObj.$el,d=c.find(">.SCmc");if(d.hasClass("zmCShared"))d.removeClass("zmCShared"),setTimeout(function(){zmCUtil.transResizeRepDOM(a)},300);else{var e=d.find(".zmScCmnt");e.find(".SCS_postWra").length&&e.find(".SCS_postWra").addClass("SC_dyn"),d.addClass("zmCShared");var f=zmComponent.loadingBand({container:e[0],type:"pagination"});setTimeout(function(){zmCUtil.transResizeRepDOM(a),f&&f(),e.find(".SCS_postWra").length?e.find(".SCS_postWra").removeClass("SC_dyn"):e.append(b.jqDOM)},300)}zmComp.tooltipComment(a)},hideComment:function(a){if(b[a]){var c;b[a].type&&(c=b[a].type),c&&"t"===c?zmsuite.getCenter(a)[0].getNodes()[0].hideGroup("compComment"):$("#zmShareM_"+a).addClass("SC_dyn")}},getShareEle:function(a){var c,d={};if(b[a]){var e;if(b[a].type&&(e=b[a].type),e&&"t"===e){var f=$(zmsuite.getCenter(a)[0].getNodes()[0].$el);c=f.find("li[data-event='cmp_share']"),d.liObj=c,d.txtObj=c.find("span").eq(1)}else c=$("#zmShareM_"+a).find("li");d.liObj=c,d.txtObj=c.find("span").eq(1)}return d},enableDraftShare:function(a,d){var e=zmsuite.getAppObj(a).centerObj.$el,f=e.find("li[data-event='cmp_share']");f.length&&(f.removeClass("SC_op3 SC_nopntr"),f.off("click").on("click",function(){"undefined"==typeof b[a].loadDraftComment&&(b[a].loadDraftComment=!0);var c=zmComp.getCommentObj(a);if(c&&!zmComp.isModified(a))zmComp.setDraftFocus(a);else{var d={};d.cmpId=a,d.viashare=!0,zmComp.updateDraft(d)}}),f.addClass("SC_thm"),f.attr("data-tooltip",c.sharedraft))},enableShare:function(a,b,d){var e=$(zmsuite.getCenter(a)[0].getNodes()[0].$el),f=e.find("li[data-event='cmp_share']");f.length&&(f.removeClass("SC_op3 SC_nopntr"),f.off("click").on("click",function(){zmComp.draftComments(a,b,d)}),f.addClass("SC_thm"),f.attr("data-tooltip",c.sharedraft))},enableNotifyAll:function(a,b,d){var e=$(zmsuite.getCenter(a)[0].getNodes()[0].$el),f=e.find("li[data-event='cmp_share']"),g=f.find("span").eq(1);g.text(c.notify_to_all),f.attr("data-tooltip",c.notify_to_all),f.addClass("SC_thm"),"draft_onload"===d&&f.removeClass("SC_thm"),f.removeClass("SC_op3 SC_nopntr"),f.off("click").on("click",function(){zmUtil.DraftShare.notifyUpdate({draftID:b}).done(function(){f.removeClass("SC_thm")}).fail(function(){zmComp.showMsg(a,"i",c.prob_notify_invitees,"t"),f.addClass("SC_thm")})})},cmpRestoreState:function(a,b){var c=zmTab.getTabObject(a);$.publish("zmail/SaveTabState",[{appId:a,app:"cmp",appObj:{appId:c.appId,appname:c.appname,appIcon:c.appIcon,data:{cNodes:"2"}},category:"compose_tab",data:b}])},cmpHashURL:function(a,b){var c=zmsuite.getAppRouter(a);c.setParams(b),c.update()},setElemFocus:function(a){var b=a.find("input");b.length&&b.focus(),$(".SC_cs.zmfc").removeClass("zmfc")},cmpGetAddr:function(a,c){var d={};try{if(b[a])if("st"===b[a].type)b[a].smartData&&b[a].smartData.recipients&&(d=b[a].smartData.recipients[c]);else{var e="zm"+c+"txt_"+a;d=zmAutoFill.getAddress($("#"+e),"String",!0)}}catch(f){zmComp.debugLog(f)}return d},sendMail:function(a){var e,f,i,j,k,m,n,o,p;a&&(e=a.action,f=a.sendIm,i=a.cmpId,j=a.actVal,k=a.type,m=a.autosave,n=a.data,o=a.tmpUpdate,p=a.viashare),i||(i=zmComp.getCurrentCompId()),k=b[i].type;var q="compose";"sdraft"===e?q="draft":"stemplate"===e?q="template":b[i].mode&&(q=b[i].mode),"compose"!==e||"draft"!==q&&"template"!==q||(q="compose");var r="";r="template"===q?"template":"draft"!==q?"send":"save";var s=zmComp.getStatus(i),t=!1;if(s&&"send"===r&&(t=!0),s&&m&&"adraft"===m&&(t=!0),"save"===r&&b[i]&&b[i].savedraft&&!b[i].dmailid&&(t=!0),!t){var u={accId:b[i].accId},v={cmpId:i};if(v.type=k,v.viashare=p,v.tmpUpdate=!0,"stemplate"!==a.action||a.tmpUpdate||(v.tmpUpdate=!1),"template"===q&&zmComp.getTempId(i)){if(!o)return void zmComp.tempOverWrite(i);u.tempact=!0,v.tempact=!0}var w=zmComp.getMymId(i);w&&(b[i]&&"eanew"!==b[i].mode&&"template"!==r&&(u.mymId=w),v.mymId=w),u.originalMode=q,v.mode=q,v.act=e;var x=b[i].inlineMode,y=["reply","replyall","fwdi"];if(x&&y.indexOf(x)!==-1){var z=zmComp.getModeObj("int",x);z&&(u.fwdInlineMode=z,v.fwdInlineMode=z)}n&&(b[i].smartData=n);var A="",B="",C="",D={},E={},F={};D=zmComp.cmpGetAddr(i,"to"),E=zmComp.cmpGetAddr(i,"cc"),F=zmComp.cmpGetAddr(i,"bcc"),D.address&&(A=D.address),E.address&&(B=E.address),F.address&&(C=F.address);var G,H;if(zmComp.getAttRef(i)&&(H=zmComp.getAttRef(i),G=H.getStoreAttachments(!0),H.isUploadInProgress()&&(!m||"adraft"!==m)))return void zmComp.showMsg(i,"e",c.process_alert,k,"u");if(b[i].imagepending)return void zmComp.showMsg(i,"e",c.imageupload_process,k,"u");var I=!0;if("draft"!==q&&"template"!==q&&(I=d(i,D,E,F,k)),I&&I){var J=zmComp.getFromAddr(i),K=zmComp.getFromObj(),L="";K[J]&&K[J].FRM_DISN&&(L=K[J].FRM_DISN),L&&(L='"'+L.replace(/(^|[^\\])"/g,'$1\\"')+'"',J=L+" <"+J+">"),u.from=J,u.to=A,u.cc=B,u.bcc=C,v.from=J,v.to=A,v.cc=B,v.bcc=C,u.bcc&&(v.bcc=u.bcc);var M="";M="st"===k?zmComp.getSubject(i):$("#zmsub_"+i).val(),M&&(M=$.trim(M));var N=!1;"draft"!==q&&"template"!==q&&(N=!0),zmComp.setSendImm(i,!1),f&&zmComp.setSendImm(i,!0);var O=b[i].subfalse;if(""===M&&N&&!O)return void zmComp.boxSubject(i);var P=!1;if(zmComp.getDefault().outIntr===-1||f||(P=!0),P&&M&&M.length>251)return zmComp.showMsg(i,"e",c.lengthy_subject,k),void $("#zmsub_"+i).focus();var Q,R,S,T,U=!1;G&&(R=G.myAttachment,S=G.tempLocation,T=G.hugeAttachment);var V=zmComp.getEditor(i),W=!0;j&&"attfalse"===j&&(W=!1);var X=!1;switch(q){case"compose":case"reply":case"replyall":case"fwdi":case"fwdme":case"eanew":X=!0}if(X&&W){var Y=!1;if(R&&R.length?Y=!0:S&&S.length?Y=!0:T&&T.length&&(Y=!0),!Y&&(Q=V.getContent(),U="plaintext"===V.mode?zmAttReminder.isFileNeedToAttach(Q):zmAttReminder.isFileNeedToAttach(zmCUtil.removeNotToParse(Q))))return void zmComp.remindAtt(i,U)}if("richtext"===V.mode&&zmComp.getZDStr(i)&&(u.docId=zmComp.getZDStr(i),u.shareType="private"),"plaintext"===V.mode&&zmComp.getZDocLink(i).length&&(u.docId=zmComp.getZDocLink(i),u.shareType="private"),"send"===r&&zmComp.getZDStr(i)&&"send_with"===a.zDocShare){var Z=a._sReq;if(Z)for(var _ in Z)u[_]=Z[_],v[_]=Z[_]}if(!a.zDocShare&&"send"===r&&zmComp.getZDStr(i))return void zmCDoc.showBox(i,$.extend({},a));u.subject=M,v.subject=M;var aa=zmComp.getAskReceipt(i);aa&&"yes"===aa&&(u.askReceipt=aa),u.sendImm=!1,v.sendImm=!1,f&&(u.sendImm=!0,v.sendImm=!0),b[i].docsRef&&(u.attachname=b[i].docsRef.docName,u.attachpath=b[i].docsRef.docPath,u.attachstorelist=b[i].docsRef.docStore);var ba=0,ca="",da=V.mode;if(Q="send"===r?V.getRawContent():V.getContent(),"plaintext"!==da&&(ba=2,"draft"!==q&&"template"!==q&&Q.indexOf("Zm-_Id_-Sgn")!==-1&&(Q=Q.replace(/Zm-_Id_-Sgn/gi,""))),"outbox"!==q&&"plaintext"!==da){if("reply"===q||"replyall"===q||"draft"===q||"template"===q){var ea=$(V.doc.body),fa=ea.find("div[name=ZM_SHWTRIM]");fa.length&&fa.remove();var ga=ea.find("div.zmail_extra");ga.length&&ga.show(),Q="send"===r?V.getRawContent():V.getContent()}ca="<div style='font-size:"+zmCUtil.getfontSize()+"pt;";var ha=zmCUtil.getfontFamily(zmail.mailOpt.ff);"Default"!==ha&&(ca+="font-family:"+ha+";"),ca+="color:"+zmCUtil.getfontColor()+";",ca+="'>"+Q+"</div>"}else ca=Q;var ia=b[i].inlinemapObj;if(Object.keys(ia).length>=1){var ja=Object.keys(ia),ka=ja.length,la=document.createDocumentFragment();la.appendChild(document.createElement("div")),la.firstChild.innerHTML=ca;for(var ma=la.firstChild.getElementsByTagName("img"),na=ma.length,oa=0;oa<na;oa++)for(var pa=0;pa<ka;pa++)if(ma[oa].getAttribute("src")===ja[pa].replace(/&amp;/g,"&")){ma[oa].src=ia[ja[pa]].replace(/&amp;/g,"&");break}ca=la.firstChild.innerHTML}"template"===q&&b[i].categoryId&&(u.categoryId=b[i].categoryId),u.content=ca,v.content=ca,u.smType=ba,u.charSet=zmComp.getCharSet(i),u.replyTo=zmComp.getReplyto(i),u.priority=zmComp.getPriority(i);var qa=window.zmWatch,ra=!1;!zmUtil.isChildWindow()&&qa&&qa.getAvoidWatch(i)&&(ra=!0);var sa=!1;!zmUtil.isChildWindow()&&qa&&qa.getModified(i)&&(sa=!0);var ta;ra||sa||!b[i].RMOBJ?!zmUtil.isChildWindow()&&qa&&qa.allowWatch(i)&&!ra&&(ta=qa.getWatchType(i),1!==ta&&2!==ta&&3!==ta||(u.watchType=ta,u.reminderMode=0,u.reminderDesc=qa.getReminderDesc(i),!ta||1!==ta&&2!==ta||(u.reminderType=qa.getReminderType(i),u.reminderMode=qa.getReminderMode(i),u.rDate=qa.getReminderDate(i)+":00"))):(ta=b[i].RMOBJ.WT,1!==ta&&2!==ta&&3!==ta||(u.watchType=ta,u.reminderMode=0,u.reminderDesc=b[i].RMOBJ.RMDSC,1!==ta&&2!==ta||(b[i].RMOBJ.RMM&&"undefined"!=typeof b[i].RMOBJ.RMM&&(u.reminderMode=b[i].RMOBJ.RMM),b[i].RMOBJ.RMT&&"undefined"!=typeof b[i].RMOBJ.RMT&&(u.reminderType=b[i].RMOBJ.RMT),b[i].RMOBJ.RMD&&(u.rDate=b[i].RMOBJ.RMD))));var ua=window.zmSchedule;if(!zmUtil.isChildWindow()&&ua){var va=ua.getScheduleObject(i);va&&(f=!1,u.OT="1",u.SCT=va.scheduleType,""!==va.customTime&&(u.SCTI=va.customTime+":00"));var wa=ua.getRecurringObject(i);wa&&(u=$.extend(u,wa),f=!1,u.OT="2")}var xa=!0;if("eanew"!==zmComp.getMode(i)&&"fwdme"!==zmComp.getMode(i)||(xa=!1),(b[i].newsave||b[i].fol_opt&&"tmp"===b[i].fol_opt)&&(xa=!1),xa){var ya=zmComp.getCmpHeader(i);ya.mailId&&(u.mailId=ya.mailId,v.mailId=ya.mailId),ya.inReplyTo&&(u.inReplyTo=ya.inReplyTo),ya.refHeader&&(u.refHeader=ya.refHeader)}if(b[i].discard_refHeader&&(u.refHeader=b[i].discard_refHeader),b[i].discard_inReplyTo&&(u.inReplyTo=b[i].discard_inReplyTo),b[i].dmailid&&(u.mailId=b[i].dmailid,v.mailId=b[i].dmailid),"template"===r&&zmComp.getTempId(i)&&(u.mymId=zmComp.getTempId(i),v.tempId=zmComp.getTempId(i)),u.refHeader&&(v.refHeader=u.refHeader),u.inReplyTo&&(v.inReplyTo=u.inReplyTo),R&&R.length&&(u.attEntObj=JSON.stringify(R),H&&H.isStreamView()&&(u.streamsView=!0)),S&&S.length){var za=JSON.stringify(S);u.attTmpObj=za,v.attTmpObj=za}T&&T.length&&(u.hugeAttList=JSON.stringify(T));var Aa=zmComp.getFwdMsg(i);Aa&&Aa.length&&(u.fwdMsgIds=Aa);var Ba=zmComp.getFwdThrd(i);if(Ba&&Ba.length&&(u.fwdtId=Ba),j&&"close"===j)v.close=!0;else{var Ca=M&&(M.length>150?M.substring(0,150):M)||c.nosubject,Da=zmText.applyArgs(c.sending_subject,{SUBJECT:Ca}),Ea=!1;"draft"===q?(Da=b[i].newsave?c.resaving_draft:c.saving_draft,k&&"p"===k&&(Da=c.saving),Ea=!0):"template"===q&&(Da=c.saving_temp),Ea?zmComp.updDraftText(i,Da):zmComp.showMsg(i,"s",Da,k,"i")}b&&b[i]&&b[i].groupId&&(u.groupId=v.groupId=b[i].groupId,u.streamsView=v.streamsView=b[i].streamsView),zmComp.getShareId(i)&&(u.shId=zmComp.getShareId(i),v.shId=zmComp.getShareId(i)),"save"!==r||u.mailId||(b[i].savedraft=!0),"save"===r&&!u.mailId&&m&&"adraft"===m&&(b[i].capSave=!0),"send"===r&&b[i].saveReq&&b[i].capSave&&(v._dupDraft=!0),v.triggerType="send","save"===r&&(v.triggerType="save",b[i].saveReq=!0),"send"===r&&zmComp.setStatus(i,!0),zmAjq.XHR({u:zmail.conPath+"/send.do",t:"POST",fn:l,p:u,ep:v,csr:"s",onerror:g,onnetfailure:h})}}}};$.extend(!0,a,m)}(window.zmComp),window.zmCompOpt=function(){var a=function(){var a=zmText.get("zmcompose");return a}(),b={_send:function(){var b={};return b.cls="SCtxt SCBtn",b.divclass="SC_hd",b.optclass="msi-send",b.txt=a.send,b.arrow=!0,b},_discard:function(){var a={};return a.cls="SC_lbr",a.divclass="SC_hd",a.optclass="msi-trash",a.arrow_hide=!0,a.txt_hide=!0,a},_more:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-action",a.arrow_hide=!0,a.txt_hide=!0,a},_save:function(){var b={};return b.cls="SCtxt SC_op3 SC_nopntr",b.divclass="SC_hd",b.opt_hide=!0,b.txt=a.save_draft,b.arrow=!0,b},_priority:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-priority",a.divclass="SC_hd",a.arrow_hide=!0,a.txt_hide=!0,a},_share:function(){var a={};return a.cls="SC_lbr SCtxt",a.divclass="SC_hd",a.txt="Share",a.arrow_hide=!0,a},_schedule:function(){var a={};return a.cls="SC_lbr",a.divclass="SC_hd",a.optclass="msi-schdRecur",a.arrow_hide=!0,a.txt_hide=!0,a},_watch:function(){var a={};return a.cls="SC_lbr",a.divclass="SC_hd",a.optclass="msi-mailReminder",a.arrow_hide=!0,a.txt_hide=!0,a},_moveTab:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-popout",a.divclass="SC_hd",a.arrow_hide=!0,a.txt_hide=!0,a},_minimizeTab:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-minus",a.divclass="SC_hd",a.arrow_hide=!0,a.txt_hide=!0,a},_close:function(){var a={};return a.cls="SC_lbr",a.optclass="msi-close",a.divclass="SC_hd",a.arrow_hide=!0,a.txt_hide=!0,a},headerDOM:function(b){var c,d=b.cmpId,e=b.type,f=b.msgId,g='<div class="SCmb"><div class="SC_frt SC_ptit"></div><div></div></div>',h=zmCompOpt.optDOM(zmCompOpt._send()),i=zmCompOpt.optDOM(zmCompOpt._discard()),j=zmCompOpt.optDOM(zmCompOpt._more()),k=zmCompOpt.optDOM(zmCompOpt._save()),l=zmCompOpt.optDOM(zmCompOpt._priority()),m=zmCompOpt.optDOM(zmCompOpt._share()),n=zmCompOpt.optDOM(zmCompOpt._schedule()),o=zmCompOpt.optDOM(zmCompOpt._watch()),p=zmCompOpt.optDOM(zmCompOpt._minimizeTab()),q=zmCompOpt.optDOM(zmCompOpt._moveTab()),r=zmCompOpt.optDOM(zmCompOpt._close()),s=$(g),t=$(s[0].childNodes[0]),u=$(s[0].childNodes[1]),v=$(h);zmComp.getDefault().outIntr===-1&&v.find("i.msi-barrow").addClass("SC_dyn"),v.attr("id","zmSendM_"+d),v.off("click").on("click",function(a){c={},c.action="compose",c.sendIm=!1,c.cmpId=d,c.type=e,zmCDrop.showDropDown(a,c)}),zmCUtil.tooltip({ele:h,tooltip:a.send});var w=$(i);w.attr("id","zmDiscardM_"+d),w.off("click").on("click",function(){var a={};a.cmpId=d,a.msgId=f,zmComp.discardCmp(a)});var x={};x.ele=i,x.tooltip=a.discard_draft,zmCUtil.tooltip(x);var y=$(j);y.attr("id","zmMoveM_"+d),y.off("click").on("click",function(){c={},c.id="zm_compactLst",c.par=y.find(" > li").eq(0),c.cmpId=d,zmCDrop.show(c)}),zmCUtil.tooltip({ele:j,tooltip:a.options});var z=$(k);e&&"p"===e&&z.find("i.msi-barrow").addClass("SC_dyn"),z.attr("id","zmSaveM_"+d),z.off("click").on("click",function(a){var b,f,g;a&&(b=a.target||a.srcElement,f=b.nodeName,g=b.className),f&&"I"===f&&g&&"msi-barrow"===g?(c={},c.id="zm_SveLst",c.par=$(b).closest("li"),c.cmpId=d,zmCDrop.show(c),zmUtil.stopEvents(a)):(c={},c.cmpId=d,c.action="sdraft",c.type=e,c.sendIm=!1,zmComp.sendMail(c))}),zmCUtil.tooltip({ele:k,tooltip:a.save_as_draft});var A=$(l);A.attr("id","zmPriorityM_"+d),A.off("click").on("click",function(a){c={},c.cmpId=d,c.par=A.find(" > li").eq(0),c.id="zm_priLst",zmCDrop.show(c),zmUtil.stopEvents(a)}),zmCUtil.tooltip({ele:l,tooltip:a.priority});var B=$(m);B.attr("id","zmShareM_"+d),zmCUtil.tooltip({ele:m,tooltip:"Share draft"});var C=$(n);C.attr("id","zmScheduleM_"+d),C.off("click").on("click",function(){c={},c.id=d,c.ele=this,c.component="compose",c.type=2,zmSchedule.initScRec(c)}),zmCUtil.tooltip({ele:n,tooltip:a.schedule+" / "+a.recurring});var D=$(o);D.attr("id","zmWatchM_"+d),D.off("click").on("click",function(){c={},c.msgId=d,c.loadType="popup",c.openWatch="compose_tab",c.elem=$(this).find("li"),zmWatch.showWatch(c)}),zmCUtil.tooltip({ele:o,tooltip:zmText.get("zmreminder").watch.remind});var E=$(q);E.attr("id","zmMoveTabM_"+d),E.off("click").on("click",function(){zmComp.moveTab(b)}),zmCUtil.tooltip({ele:q,tooltip:"Move to Tab"});var F=$(p);F.attr("id","zmMinimizeM_"+d),F.off("click").on("click",function(){}),zmCUtil.tooltip({ele:p,tooltip:"Minimize"});var G=$(r);return G.attr("id","zmCloseM_"+d),G.off("click").on("click",function(){var a={};a.cmpId=d,a.type=e,a.msgId=f,zmComp.comClose(a)}),zmCUtil.tooltip({ele:r,tooltip:a.close}),e&&"w"===e?(u.append(v),u.append(C),u.append(D),u.append(y),t.append(z),t.append(A),A.addClass("SC_dyn"),t.append(B),B.addClass("SC_dyn"),t.append(w),t.append(G)):e&&"p"===e?(u.append(v),zmUtil.isChildWindow()||(u.append(C),u.append(D),u.append(y)),t.append(z),zmUtil.isChildWindow()||t.append(E),t.append(w),t.append(G)):e&&"d"===e&&(u.append(v),u.append(C),u.append(D),u.append(A),A.addClass("SC_dyn"),u.append(y),t.append(z),t.append(B),B.addClass("SC_dyn"),t.append(w),t.append(G)),s},fromDOM:function(b){var c=b.cmpId,d=$("<div/>");d.attr("class","zmCTxt");var e=$("<font/>");e.text(a.from);var f=$("<span/>");f.attr("id","zm_fSel_"+c),f.off("click").on("click",function(){zmCUtil.shwFrm(this)});var g=$("<div/>");g.attr("class","SC_cs SC_np");var h=$("<span/>");h.attr("id","zm_fromaddr_"+c);var i=zmComp.getFromDispN(zmail.fromAddr);h.text(i);var j=$("<i/>");j.attr("class","msi-barrow"),g.append(h,j),f.append(g);var k=$("<div/>");k.attr("id","zm_repSel_"+c),k.attr("class","SC_frt SC_dyn");var l=$("<font/>");l.text(a.replyto);var m=$("<span/>");m.attr("id","zmrTo_"+c);var n=$("<div/>");n.attr("class","SC_cs SC_np");var o=$("<span/>");o.attr("id","zm_replyto_addr_"+c),"st"!==b.type&&zmComp.getReplyto(c)&&(k.removeClass("SC_dyn"),o.text(zmComp.getReplyto(c)));var p=$("<i/>");return p.attr("class","msi-barrow"),n.append(o,p),m.append(n),k.append(l,m),d.append(e,f,k),d},_suggestionDOM:function(b){var c=$("<div/>");c.css("display","none");var d=$("<div/>");d.attr("class","zmMsgBox zmBlockBox zmTextinfoBox"),d.attr("id","zmsuglist_"+b);var e=$("<font/>");e.text(a.add),e.attr("id","zmsugflist_"+b);var f=$("<i/>");f.attr("class","msi-help"),e.append(f);var g=$("<span/>");g.attr("class","zmFR");var h=$("<span/>");h.text(a.addall),h.attr("id","zmsugfrlist_"+b),h.attr("class","SC_lnk"),h.off("mousedown").on("mousedown",function(a){zmCUtil.insertAllSugContacts(b),zmTooltip.remove(),zmCUtil.removeSugList(b),_zm.stopEvents(a)});var i=$("<span/>");i.attr("class","zmSLine");var j=$("<i/>");j.attr("class","msi-close"),j.off("mousedown").on("mousedown",function(a){zmComp.setShowSuggestions(b,!1),zmTooltip.remove(),zmCUtil.removeSugList(b),_zm.stopEvents(a)}),g.append(h,i,j);var k=$("<span/>");k.attr("class","loading_dots"),k.attr("id","zmsugloading_dots_"+b);var l=$("<span/>"),m=$("<span/>"),n=$("<span/>");k.append(l,m,n);var o=$("<span/>");o.attr("class","zmRedClr zmHideD");var p=$("<span/>");return p.attr("id","zmsugcontactslist_"+b),d.append(g,e,p,k,o),c.append(d),c},toDOM:function(b){var c=b.cmpId,d=b.type,e=$("<div/>");e.attr("class","zmCTxt zmdrop"),e.attr("id","zmto_"+c),e.off("click").on("click",function(){zmComp.txtFocus(this)});var f=function(a){zmAutoFill.fillContacts($("#zmtotxt_"+c),"",[a])},g=$("<font/>");g.text(a.to),g.off("click").on("click",function(a){zmAdd.showBook(f,"zmtotxt_"+c,a,"zmtotxt_"+c)});var h=$("<input/>");h.attr("type","text"),h.attr("id","zmtotxt_"+c),h.attr("class","zm_sgst"),d&&"p"!==d&&h.attr("data-enableShortcuts",!0);var i,j="0"===zmAdHocSettings.getShowCCOption(),k=0===zmComp.getDefault().showBcc;if(!j||!k){var l,m;i=$("<div/>"),i.attr("class","SC_frt"),j||(l=$("<em/>"),l.attr("id","scc_"+c),l.off("click").on("click",function(){zmComp.shCBc(c,"c","setFocus")}),"0"===zmAdHocSettings.getShowCCOption()&&l.addClass("SC_dyn"),l.text(a.cc)),l&&i.append(l),k||(m=$("<em/>"),m.attr("id","sbcc_"+c),m.off("click").on("click",function(){zmComp.shCBc(c,"b","setFocus")}),0===zmComp.getDefault().showBcc&&m.addClass("SC_dyn"),m.text(a.bcc)),m&&i.append(m)}return e.append(g,h),i&&e.append(i),e.append(i),e},ccDOM:function(b){var c=b.cmpId,d=b.type,e=$("<div/>");e.attr("class","zmCTxt zmdrop"),e.attr("id","zmcc_"+c),e.off("click").on("click",function(){zmComp.txtFocus(this)});var f=function(a){zmAutoFill.fillContacts($("#zmcctxt_"+c),"",[a])},g=$("<font/>");g.text(a.cc),g.off("click").on("click",function(a){zmAdd.showBook(f,"zmcctxt_"+c,a,"zmtotxt_"+c)});var h=$("<input/>");return h.attr("type","text"),h.attr("id","zmcctxt_"+c),h.attr("class","zm_sgst"),d&&"p"!==d&&h.attr("data-enableShortcuts",!0),e.append(g,h),e},bccDOM:function(b){var c=b.cmpId,d=b.type,e=$("<div/>");e.attr("class","zmCTxt zmdrop"),e.attr("id","zmbcc_"+c),e.off("click").on("click",function(){zmComp.txtFocus(this)});var f=function(a){$.subscribe("zm/framework/dialogClosed",function(b){zmAutoFill.fillContacts($("#zmbcctxt_"+c),"",[a]),$.unsubscribe("zm/framework/dialogClosed")})},g=$("<font/>");g.text(a.bcc),g.off("click").on("click",function(a){zmAdd.showBook(f,"zmbcctxt_"+c,a,"zmtotxt_"+c)});var h=$("<input/>");return h.attr("type","text"),h.attr("id","zmbcctxt_"+c),h.attr("class","zm_sgst"),d&&"p"!==d&&h.attr("data-enableShortcuts",!0),e.append(g,h),e},subDOM:function(b){var c=b.cmpId,d=b.type,e=$("<div/>");e.attr("class","zmCTxt");var f=$("<input/>");return f.attr("type","text"),f.attr("id","zmsub_"+c),f.attr("maxlength","1000"),f.attr("placeholder",a.subject),d&&"p"!==d&&f.attr("data-enableShortcuts",!0),e.append(f),e},recipientDOM:function(a){var b=a.cmpId,c="<div><div><div></div><div></div></div></div>",d=$(c)[0],e=d.childNodes[0],f=e.childNodes[1],g=$(d);g.attr("id","zmdArea_"+b),g.attr("class","zmCR");var h=$(e);h.attr("class","zmCmd");var i=$(f);i.attr("id","zmrep_"+b);var j=$("<div/>");j.attr("id","zmrepall_"+b),j.append(zmCompOpt.fromDOM(a));var k=zmCompOpt.toDOM(a),l=zmCompOpt.ccDOM(a);"1"===zmAdHocSettings.getShowCCOption()&&l.addClass("SC_dyn");var m=zmCompOpt.bccDOM(a);return 1===zmComp.getDefault().showBcc&&m.addClass("SC_dyn"),j.append(k,l,m),j.append(zmCompOpt.subDOM(a)),i.append(j),g},dragDOM:function(a){var b=a.cmpId,c=$("<div/>");c.attr("id","zmDrag_"+b),c.attr("class","SC_drag SC_thmDrag");var d=$("<span/>");return d.text("Drop message here to attach"),c.append(d),c.addClass("SC_dyn"),c},showDrag:function(a,b){var c=$("#zmDrag_"+a);$(c).children().text(b),c.removeClass("SC_dyn")},hideDrag:function(a){var b=$("#zmDrag_"+a);b.addClass("SC_dyn")},editorDOM:function(a){var b=a.cmpId,c=$("<div/>");return c.attr("id","zmEdi_"+b),c.attr("class","zmCE"),c},attDOM:function(a){var b=a.cmpId,c="<div><div></div></div>",d=$(c)[0],e=d.childNodes[0],f=$(d);f.attr("id","zmAtt_"+b),f.attr("class","zmCA SC_dyn");var g=$(e);return g.attr("id","zmAttLst_"+b),g.attr("class","zmCAt"),g.height(50),d},optDOM:function(a){var b='<span><i></i><span></span><i class="msi-barrow"></i></span>',c="<ul><li><b><div></div>"+b+"</b></li></ul>",d=$(c)[0],e=d.childNodes[0],f=e.childNodes[0].childNodes[0],g=e.childNodes[0].childNodes[1],h=g.childNodes[0],i=g.childNodes[1],j=g.childNodes[2];return a=a||{},a.cls=a.cls||"",a.divclass=a.divclass||"SC_hd",a.ret=a.ret||"string",a.evt&&$(e).attr("data-event",a.evt),a.title&&$(e).attr("title",a.title),$(e).attr("class",a.cls),$(f).attr("class",a.divclass),$(h).attr("class",a.optclass),$(i).text(a.txt),a.opt_hide&&$(h).remove(),a.arrow_hide&&$(j).remove(),a.txt_hide&&$(i).remove(),a.sc_hd_hide&&$(f).remove(),d}};return b}(),window.zmCDrop=function(){var a=zmText.get("dropMenus"),b=function(){var a=zmText.get("zmcompose");return a}(),c=function(b,c){var d,e=!1;b&&"inline"===b&&(e=!0),c&&(d=c.cmpId);var f=[],g={htm:a.send};g.data={},g.data.action="s",e&&(g.data.cmpId=d);var h={htm:a.sendNow};h.data={},h.data.action="si",e&&(h.data.cmpId=d),f.push(g,h);var i={list:f,clk:function(a){var b=a.action,c=a.cmpId;"s"===b?(zmComp.sendMail({action:"compose",cmpId:c}),zmUtil.hideMenu()):"si"===b&&(zmComp.sendMail({action:"compose",sendIm:!0,cmpId:c}),zmUtil.hideMenu())}};return i},d=function(){var b=zmComp.getCurrentCompId(),c={list:[{htm:a.draft,data:{action:"sdraft",cmpId:b}},{htm:a.template,data:{action:"stemplate",cmpId:b}}],clk:function(a){var b=a.action,c=a.cmpId,d={cmpId:c};switch(b){case"sdraft":d.action="sdraft",zmComp.sendMail(d),zmUtil.hideMenu();break;case"stemplate":d.action="stemplate",zmComp.sendMail(d),zmUtil.hideMenu()}}};return c},e=function(a){var b=a.cmpId;zmComp.setCharSet(b,a.chrset),zmComp.setModified(b,1),zmUtil.hideMenu()},f=function(a){for(var b=zmComp.getCharSet(a),c=zmComp.getEncodeList(),d=c.length,f=[],g={},h=0;h<d;h++){var i=c[h];i=i===b?'<i class="msi-none msi-tick"></i>'+i:'<i class="msi-none"></i>'+i,f.push({htm:i,data:{chrset:c[h],cmpId:a}})}return g.list=f,g.divId="zm_EncLst",g.clk=function(a){e(a)},g},g=function(a){var b=a.cmpId,c=a.askVal;c="yes"===c?"no":"yes",zmComp.setAskReceipt(b,c),zmComp.setModified(b,1)},h=function(a){zmComp.print(a)},i=function(a){var b=a.cmpId,c=a.pTy,d="Medium",e=zmComp.getPriorityDom(b),f=e.elem;"l"===c?(d="Low",f.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_blue")):"h"===c?(d="High",f.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_red")):f.find("i.msi-priority").removeClass("SC_red SC_blue"),"d"===e.appTy?$("#zmPriorityM_"+b).removeClass("SC_dyn"):"st"===e.appTy?f.removeClass("SC_dyn"):"t"===e.appTy&&zmsuite.getCenter(b)[0].getNodes()[0].showGroup("compPriority"),zmComp.setPriority(b,d),zmComp.setModified(b,1)},j=function(a,b){var c=zmComp.getSignObj(),d=zmComp.getEditor(a),e=$(d.doc.body);if(e.find("#Zm-_Id_-Sgn").remove(),b&&""!==b&&"null"!==b){var f=c[b].SIG_CONT,g=c[b].SIG_POS;if("plaintext"===d.mode)d.insertHTML(f);else{if(0===g)e.append('<div id="Zm-_Id_-Sgn"></div>');else{var h=e.find("[name='ZM_SHWTRIM']");h.length||(h=e.find(".zmail_extra")),h.length?h.before('<div id="Zm-_Id_-Sgn"></div>'):e.append('<div id="Zm-_Id_-Sgn"></div>')}e.find("#Zm-_Id_-Sgn").html(f)}d.saveCurrentState()}zmUtil.hideMenu()},k=function(a){var c=a.cmpId,d=zmComp.getSignObj(),e=!0;d&&!$.isEmptyObject(d)&&(e=!1),0===$("#zm_insSign").length&&$("body").append('<div id="zm_insSign"></div>');var f={title:b.insert_signature,style:{width:"576px",left:"400px"},mask:!0,drag:!1,hide:!1};zmsDialog.create("zm_insSign",f);var g="",h="";if(e)h=b.no_signature;else{var i='title="'+b.remove_signature+'"';i+=" onClick=\"zmCDrop.signInsert('"+c+"','null')\"",g="<div "+i+" ><h3>"+b.remove_signature+"</h3>",g+='<div class="zmSigCont">',g+="<span>"+b.none+"</span></div></div>";for(var j in d)if(d[j].SIG_IMG){var k=d[j].SIG_TIT,l="onClick=\"zmCDrop.signInsert('"+c+"','"+j+"')\"";l+=" title='"+k+"'",h+="<div "+l+">",h+="<h3 placeholder='"+b.notitle+"'>"+k+"</h3>",h+="<div class='zmSigCont'>",h+="<img src='"+zmail.conPath+"/SignatureImage?signatureId="+j+"'>",h+="</div></div>"}else{var m=d[j].SIG_TIT,n="onClick=\"zmCDrop.signInsert('"+c+"','"+j+"')\"";n+=" title='"+m+"'",h+="<div "+n+">",h+="<h3 placeholder='"+b.notitle+"'>"+m+"</h3>",h+="<div class='zmSigCont'>",h+="<span>"+d[j].SIG_TIT+"</span></div></div>"}}var o="<ul class='SC_isig'><li>"+h+g+"</li></ul>";$("#zm_insSign").html(o);
},l=function(a,c){var d=c.cmpId,e="<ul class='SC_insList SC_tmbv zmMenuList'><li>";if(a&&a[0]&&a[0].tmp&&"e"===a[0].tmp)e+="<li>"+b.no_template+"</li>";else{zmComp.setTemplate(a);for(var f in a){var g=a[f].M;e+="<div class='SC_insTem' ",e+="onClick=\"zmCDrop.tmpInsert('"+g+"','"+d+"')\">",e+="<h3><span>"+a[f].SB,e+="</span></h3><div class='SC_temMsg'>"+a[f].SM+"</div></div>"}}e+="</li></ul>";var h=$("<div/>");h.attr("id","zmcmp_temp_"+d),h.html(e);var i={};i.cmpId=d,i.$content=h,i.title=b.insert_template,i.ignoreMouseDown=!1,i.dialogDidMount=function(a){$("#zmcmp_temp_"+d)[0].zmcmp_confirm_dialog_ele=a;var b=$("body").height();a.$els.$content.css("max-height",b-15*b/100+"px"),a.$els.$contentWrapper.width("600px");var c=a.$els.$maskWrapper;c.on("mousedown",function(b){var c=b.target||b.srcElement;$(c).closest("div.SC_pe").length||a.remove()})},i.defaultNavigator=!1,i.navigator=new zmail.Navigator({onEscape:function(){$("#zmcmp_temp_"+d)[0].zmcmp_confirm_dialog_ele.remove()}}),Dialog["new"](i)},m=function(a,b){a=a.mdata;var c=b.cmpId;zmComp.setModified(c,1);var d=a.SUBJECT;d=zmCUtil.getText(d);var e=a.CONTENT,f=$.trim($("#zmsub_"+c).val());if(""===f&&$("#zmsub_"+c).val(d),e&&""!==$.trim(e)){var g=zmComp.getEditor(c);g.doc.getElementById("Zm-_Id_-Sgn")&&(e=e.replace(/Zm-_Id_-Sgn/gi,"")),g.insertHTML(e)}if(b.categoryId){var h=zmComp.getCmpObj(),i=h[c];i.categoryId=b.categoryId}a&&a.EXTIMG&&zmCUtil.loadExtImages(c,a.EXTIMG),a.NEWATT&&zmComp.insertAttachment(c,a);try{$("#zmcmp_temp_"+c)[0].zmcmp_confirm_dialog_ele.remove()}catch(j){zmComp.debugLog(j)}},n=function(a,b,c){var d={accId:zmail.accId,msgId:a,split:!1},e={msgId:a,cmpId:b};c&&(e.categoryId=c),zmail.folId&&(d.folId=zmail.folId.teId,e.folId=zmail.folId.teId),zmAjq.XHR({u:zmail.conPath+"/md.do",t:"POST",fn:m,p:d,ep:e})},o=function(a){zmAjq.XHR({u:zmail.conPath+"/cUtil.do",t:"GET",fn:l,p:{accId:zmail.accId},ep:{cmpId:a.cmpId}})},p=function(c){var d,e,j=c.cmpId,l="",m="",n="",p={},q="",r="msi-rarrow";"st"===zmComp.getType(j)&&(r="msi-larrow"),d="msi-tick",e=zmComp.getPriority(j);var s=zmComp.getAskReceipt(j);"yes"===s&&(q=d);var t="",u=zmComp.getPrintId(j);u||(t="SC_op3 SC_nopntr"),"High"===e?l=d:"Low"===e?n=d:m=d;var v={};v.htm="<b> "+a.priority+" : </b>",v.nohover="nohr";var w={};w.htm="<i class='msi-none "+l+"'></i>"+a.high,w.data={},w.data.action="h",w.data.cmpId=j;var x={};x.htm="<i class='msi-none "+m+"'></i>"+a.medium,x.data={},x.data.action="m",x.data.cmpId=j;var y={};y.htm="<i class='msi-none "+n+"'></i>"+a.low,y.data={},y.data.action="l",y.data.cmpId=j;var z={};z.sep=!0;var A={};A.htm="<b>"+a.insert+" : </b>",A.nohover="nohr";var B={};B.htm=a.template,B.data={},B.data.action="insTemplate",B.data.cmpId=j;var C={};C.htm=a.signature,C.data={},C.data.action="sig",C.data.cmpId=j;var D={};D.htm=b.print,D.noclick=t,D.data={},D.data.action="draftprint",D.data.cmpId=j;var E={};E.htm=a.encoding+"<i class='"+r+"'></i>",E.childCls="SC_tin",E.child=function(){return f(j)};var F;F=""===q?a.askreceipt:"<i class='"+q+"'></i>"+a.askreceipt;var G={};G.htm=F,G.data={},G.data.action="askReceipt",G.data.cmpId=j,G.data.actVal=s;var H=[];return H.push(v),H.push(w),H.push(x),H.push(y),H.push(z),H.push(A),H.push(B),zmail.Signature&&zmail.Signature.initialize().done(function(){if(zmail.Signature.adminAddedAcc.length>0){var a=zmComp.getFromAddr(j),b=zmail.Signature.adminAddedAcc;b.forEach(function(b){b===a&&(C.className="SC_op3 SC_nopntr")})}}).fail(function(){}),H.push(C),H.push(z),H.push(E),H.push(G),p={list:H,clk:function(a){if(null===a)return!1;var b=a.action,c=a.cmpId,d={cmpId:c},e=a.actVal;switch(b){case"sdraft":d.action="sdraft",zmComp.sendMail(d),zmUtil.hideMenu();break;case"stemplate":d.action="stemplate",zmComp.sendMail(d),zmUtil.hideMenu();break;case"insTemplate":null===zmComp.windowCmpId?zmAppLoader.load("TemplateCategory").done(function(){ZMail.Template.init({start:1,end:21},"all",d)}):o(d),zmUtil.hideMenu();break;case"sig":k(d),zmUtil.hideMenu();break;case"h":d.pTy="h",i(d),zmUtil.hideMenu();break;case"m":d.pTy="m",i(d),zmUtil.hideMenu();break;case"l":d.pTy="l",i(d),zmUtil.hideMenu();break;case"draftprint":h(d),zmUtil.hideMenu();break;case"askReceipt":d.askVal=e,g(d),zmUtil.hideMenu()}}}},q=function(b){var c,d,e=b.cmpId,f="",g="",h="",j={};return c="msi-tick",d=zmComp.getPriority(e),"High"===d?f=c:"Low"===d?h=c:g=c,j.list=[{htm:"<i class='msi-none "+f+"'></i>"+a.high,data:{action:"h",cmpId:e}},{htm:"<i class='msi-none "+g+"'></i>"+a.medium,data:{action:"m",cmpId:e}},{htm:"<i class='msi-none "+h+"'></i>"+a.low,data:{action:"l",cmpId:e}}],j.clk=function(a){var b=a.action,c={};switch(c.cmpId=a.cmpId,c.pTy=b,b){case"h":i(c),zmUtil.hideMenu();break;case"m":i(c),zmUtil.hideMenu();break;case"l":i(c),zmUtil.hideMenu()}},j},r={consDropDown:function(a){var b=new zmDropDownMenu(a);b.paint()},showDropDown:function(a,b){var c,d,e;a&&(c=a.target||a.srcElement,d=c.nodeName,e=c.className);var f,g;d&&"I"===d&&e&&"msi-barrow"===e?(f=$(c).closest("li"),b.snd_type="inline",zmDrop.show("zm_SndLst",f,g,b),zmUtil.stopEvents(a)):zmComp.sendMail(b)},getDropOptions:p,getPriorityOptions:q,tmpInsert:n,insertTemplate:o,signInsert:function(a,b){j(a,b),zmCUtil.closeDialog("zm_insSign")},signUpdate:j,show:function(a){var b=a.id,e=a.par;switch(e.find("b").addClass("SC_ddn"),b){case"zm_priLst":a.ulClass="SC_tin";var f=zmCDrop.getPriorityOptions(a);a.list=f.list,a.clk=f.clk,a.align="pright",a.parWidth=!0;break;case"zm_compactLst":a.ulClass="SC_tin";var g=zmCDrop.getDropOptions(a);a.list=g.list,a.clk=g.clk;break;case"zm_SndLst":var h=c(a);a.list=h.list,a.clk=h.clk;break;case"zm_SveLst":var i=d(a);a.list=i.list,a.clk=i.clk,a.align="pright",a.loadCopt=!0,a.parWidth=!0}a.align=a.align||"pleft","pleft"!==a.align&&"pright"!==a.align||!e.attr("data-drop")?zmDrop.consDropDown(a):(e.removeAttr("data-drop"),zmUtil.hideMenu())}};return r}(),window.zmCUtil=function(){var a=function(){var a=zmText.get("zmcompose");return a}(),b=function(a,b,c){return zmText.get("editorInteg",a,b,c)},c=function(a){var b,c,d=zmComp.getCurrentCompId(),e="",f="",g="",h={},i="";b="msi-tick",c=zmComp.getPriority(zmComp.getCurrentCompId());var j=zmComp.getAskReceipt(d);"yes"===j&&(i=b),"High"===c?e=b:"Low"===c?g=b:f=b;var k=zmText.get("dropMenus");return h={list:[{htm:"<b> "+k.priority+" : </b>",nohover:"nohr"},{htm:"<i class='msi-none "+e+"'></i>"+k.high,data:{action:"h",par:a}},{htm:"<i class='msi-none "+f+"'></i>"+k.medium,data:{action:"m",par:a}},{htm:"<i class='msi-none "+g+"'></i>"+k.low,data:{action:"l",par:a}},{sep:!0},{htm:"<b>"+k.insert+" : </b>",nohover:"nohr"},{htm:k.template,data:{action:"insTemplate",cmpId:d}},{htm:k.signature,data:{action:"sig",cmpId:d}},{sep:!0},{htm:k.encoding+"<i class='msi-rarrow'></i>",childCls:"SC_tin",child:function(){return zmCUtil.compLst("encod",d)}},{sep:!0},{htm:"<i class='"+i+"'></i>"+k.askreceipt,data:{action:"askReceipt",par:j}}],clk:function(a){var b=a.action,c=a.cmpId,d=a.par,e={cmpId:c};switch(b){case"sdraft":e.action="sdraft",zmComp.sendMail(e),zmUtil.hideMenu();break;case"stemplate":e.action="stemplate",zmComp.sendMail(e),zmUtil.hideMenu();break;case"insTemplate":zmCUtil.insTemplate(c),zmUtil.hideMenu();break;case"sig":zmCUtil.insSign(c),zmUtil.hideMenu();break;case"h":zmCUtil.chgPriority("h",d),zmUtil.hideMenu();break;case"m":zmCUtil.chgPriority("m",d),zmUtil.hideMenu();break;case"l":zmCUtil.chgPriority("l",d),zmUtil.hideMenu();break;case"askReceipt":zmCUtil.askRepChk(d,zmComp.getCurrentCompId()),zmUtil.hideMenu()}}}},d=function(){for(var a=zmComp.getCurrentCompId(),b=zmComp.getCharSet(a),c=zmComp.getEncodeList(),d=c.length,e=[],f={},g=0;g<d;g++){var h=c[g];h=h===b?'<i class="msi-none msi-tick"></i>'+h:'<i class="msi-none"></i>'+h,e.push({htm:h,data:{action:c[g]}})}return f.list=e,f.divId="zm_EncLst",f.clk=function(a){a=a.action,zmCUtil.chgEncode(a)},f},e=function(a){return a=a.replace(/&nbsp;/gi," "),a=a.replace(/&lt;/gi,"<"),a=a.replace(/&gt;/gi,">"),a=a.replace(/&amp;/gi,"&"),a=a.replace(/&#39;/g,"'"),a=a.replace(/&quot;/g,'"')},f=function(a){return a=a.replace(/</gi,"&lt;"),a=a.replace(/>/gi,"&gt;")},g={getCmpDropList:c,getfontFamily:function(a){var b="";switch(a){case"Arial":b="Arial,Helvetica,sans-serif";break;case"Courier":b="Courier New,Courier,monospace";break;case"Georgia":b="Georgia,Times New Roman,Times,serif";break;case"Tahoma":b="Tahoma,Arial,Helvetica,sans-serif";break;case"Times":case"Times New Roman":b="Times New Roman,Times,serif";break;case"Trebuchet":b="Trebuchet ms,Arial,Helvetica,sans-serif";break;case"Verdana":b="Verdana,Arial,Helvetica,sans-serif";break;case"Comic Sans MS":b="Comic Sans MS";break;case"Serif":b="Serif";break;case"Default":b="Default";break;case"Calibri":b="Calibri,Arial,Verdana,sans-serif";break;case"MS Mincho":case"MS Gothic":case"MS PMincho":case"MS PGothic":b=a;break;default:b=a+",arial,helvetica"}return b},getfontSize:function(){var a=10;return zmail.mailOpt.fs&&(a=zmail.mailOpt.fs),a},getfontColor:function(a){var b="#00000";return zmail.userOptions&&zmail.userOptions.fontColor&&"Default"!==zmail.userOptions.fontColor&&(b=zmail.userOptions.fontColor),b},closeDialog:function(a){zmsDialog.remove(),$("#"+a).remove()},chgEncode:function(a){var b=zmComp.getCurrentCompId();zmComp.setCharSet(b,a),zmComp.setModified(b,1),zmUtil.hideMenu()},loadExtImages:function(a,b){var c,d,e,f=zmComp.getEditor(a);if(b.externalURL?(c=b.externalURL,d=b.externalLink):b.exturl&&b.extlink&&(c=b.exturl.split(","),d=b.extlink.split(",")),d&&d.length){e=d.length;for(var g,h,i=f.doc,j=0;j<e;j++)g=d[j],h=c[j].replace(/&amp;/gi,"&"),$(i).find("img#"+g)[0]?$(i).find("img#"+g).attr("src",h):$(i).find('img[data-extimg_id="'+g+'"]')[0]&&$(i).find('img[data-extimg_id="'+g+'"]').attr("src",h)}},chgPriority:function(a){var b="Medium",c=zmComp.getCurrentCompId(),d=zmComp.getPriorityDom(c);zmail.isComposeMail||zmsuite.getCenter(c)[0].getNodes()[0].showGroup("compPriority"),"l"===a?(b="Low",d.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_blue")):"h"===a?(b="High",d.find("i.msi-priority").removeClass("SC_red SC_blue").addClass("SC_red")):d.find("i.msi-priority").removeClass("SC_red SC_blue"),zmComp.setPriority(c,b),zmComp.setModified(c,1)},askRepChk:function(a,b){a="yes"===a?"no":"yes",zmComp.setAskReceipt(b,a),zmComp.setModified(b,1)},shwFrm:function(a){if(a=$(a).find("> div"),$("#zm_fLst").is(":visible"))$("#zm_fLst").hide();else{var b=$(a).offset(),c=b.left,d=b.top+$(a).height();$("#zm_fLst").css({left:c+"px",top:d+"px"}).show()}},repSTVal:function(a,b){$("#zm_dropDown").remove(),zmComp.setReplyto(b,a),$("#zmrTo_"+b+" span").html(a)},cmpSTVal:function(b,c,d){var e=!1;zmComp.shareEID(d)&&(c=zmComp.shareEID(d),e=!0);var f=zmComp.getFromDispN(c);$("#zm_fromaddr_"+d).text(f),zmComp.setFromAddr(d,c);var g=zmCUtil.getReplyTo(c);if(g?($("#zm_repSel_"+d).removeClass("SC_dyn"),zmComp.setReplyto(d,g)):$("#zm_repSel_"+d).addClass("SC_dyn"),$("#zm_replyto_addr_"+d).text(g),e){var h=$("#zm_fSel_"+d),i=$("<font/>");i.attr("id","zm_fdeleSel_"+d),i.val(a.shared_from_address_info),$(h).append(i)}else $("#zm_fdeleSel_"+d).remove();zmCDrop.signUpdate(d,b)},bindDatePicker:function(a,b){if("undefined"!=typeof ZEVENTS){var c=zmail.userDateFormat.toUpperCase(),d=zmail.userDateVal;void 0!==a&&ZEVENTS(a).picker("date",{dform:c,wkst:0,mode:"popup",update:"yes",range:[d,""],minhgt:251}).on("dateclick",function(){b&&b(this.getDate().getDateBy(c))}).bind()}},bindTimePicker:function(a){"undefined"!=typeof ZEVENTS&&void 0!==a&&ZEVENTS(a).picker("time",{tform:"HH:mm ss"}).bind()},hideDatePicker:function(){$(".zcal_cn").remove()},hideTimePicker:function(){$(".zcal_tilst").remove()},_rPath:function(a){var b=!1,c=[],d=a.FROM;if(a.RETURNPATH){var e=a.RETURNPATH;e=e.replace(/</gi,""),e=e.replace(/>/gi,""),c=e.split(","),c=_.uniq(c);for(var f=0;f<=c.length;f++){var g=c[f];g&&(g.indexOf("zmgrbounces")===-1&&g.toLowerCase()!==d.toLowerCase()||(c.splice(f,1),f--))}}return c.length&&(b=!0),b},compLst:function(a){var b={};return"encod"===a&&(b=d()),b},dataURItoBlob:function(a){var b,c,d;b=a.split(",")[0].indexOf("base64")>=0?window.atob(a.split(",")[1]):window.unescape(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length);for(var e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})},getTabToolbar:function(){var a=[],c=["custom","Attachment","zei-attachment",function(a){zmComp.triggerCloudUpload(a)}],d=["bold",b("tooltip.bold"),"zei-bold"],e=["italic",b("tooltip.italic"),"zei-italic"],f=["underline",b("tooltip.underline"),"zei-underline"],g=["strikethrough",b("tooltip.strikethrough"),"zei-strike"],h=["fontfamily",b("tooltip.font"),"zei-fontfamily"],i=["fontsize",b("tooltip.fontSize"),"zei-arrow"],j=["forecolor",b("tooltip.fontColor"),"zei-textclr"],k=["backcolor",b("tooltip.backgroundColor"),"zei-bgclr"],l=["alignoptions",b("tooltip.alignOptions"),"zei-textleft"],m=["listoptions",b("tooltip.listOptions"),"zei-unorder"],n=["indentoptions",b("tooltip.indentOptions"),"zei-outdent"],o=["directionoptions",b("tooltip.directionOptions"),"zei-rtl"],p=["image",b("tooltip.insertImage"),"zei-image"],q=["link",b("tooltip.insertLink"),"zei-link"],r=["insertHTML",b("tooltip.insertHtml"),"zei-html"],s=["quote",b("tooltip.insertQuote"),"zei-quote"],t=["removeformat",b("tooltip.removeFormatting"),"zei-removeformat"],u=["format",b("tooltip.formatpainter"),"zei-formatpaint"],v=["tableGrid",b("tooltip.table"),"zei-table"],w=["inserthorizontalrule","Insert Horizontal Rule","zei-line"],x=["smiley",b("tooltip.insertSmiley"),"zei-smiley"],y=["spellcheck",b("tooltip.spellcheck"),"zei-spellCheck"],z=["otheroptions",b("tooltip.otherOptions"),"zei-arrow ze-big"],A=["superscript",b("tooltip.superScript"),"zei-superScript"],B=["subscript",b("tooltip.subscript"),"zei-subScript"],C=["lineHeight",b("tooltip.lineHeight"),"zei-lineHeight"],D=["template",b("tooltip.template"),"zei-template"],E=[c],F=[];F.push(d),F.push(e),F.push(f),F.push(g);var G=[];G.push(h);var H=[];H.push(i);var I=[];I.push(j),I.push(k);var J=[];J.push(l),J.push(m),J.push(n),J.push(o),J.push(C);var K=[];K.push(p),K.push(D),K.push(q),K.push(r);var L=[];L.push(s),L.push(t),L.push(u);var M=[];M.push(v),M.push(w);var N=[];N.push(x);var O=[];O.push(y);var P=[];P.push(z);var Q=[];return Q.push(A),Q.push(B),a.push(E),a.push(F),a.push(G),a.push(H),a.push(I),a.push(J),a.push(Q),a.push(K),a.push(L),a.push(M),a.push(N),a.push(O),a.push(P),a},getSmartToolbar:function(){var a=[[["bold","Bold (Ctrl+B)","zei-bold"],["italic","Italic (Ctrl+I)","zei-italic"],["underline","Underline (Ctrl+U)","zei-underline"],["strikethrough","Strikethrough","zei-strike"]],[["fontfamily","Font","zei-fontfamily"]],[["forecolor","Font color","zei-textclr"],["backcolor","Background Color","zei-bgclr"]],[["smiley","Insert smiley","zei-smiley"]],[["otheroptions","Spell Check Languages","zei-arrow ze-big"]]];return a},getInlineToolbar:function(){var a=["attach","Attachment","zei-attachment"],c=["custom","Attachment","zei-attachment",function(a){zmComp.triggerCloudUpload(a)}];zmail.isInternalOrgUser&&(a=c);var d=[[a],[["bold",b("tooltip.bold"),"zei-bold"],["italic",b("tooltip.italic"),"zei-italic"],["underline",b("tooltip.underline"),"zei-underline"],["strikethrough",b("tooltip.strikethrough"),"zei-strike"]],[["fontfamily",b("tooltip.font"),"zei-fontfamily"]],[["fontsize",b("tooltip.fontSize"),"zei-arrow"]],[["forecolor",b("tooltip.fontColor"),"zei-textclr"],["backcolor",b("tooltip.backgroundColor"),"zei-bgclr"]],[["alignoptions",b("tooltip.alignOptions"),"zei-textleft"],["listoptions",b("tooltip.listOptions"),"zei-unorder"],["indentoptions",b("tooltip.indentOptions"),"zei-outdent"],["directionoptions",b("tooltip.directionOptions"),"zei-rtl"]],[["superscript",b("tooltip.superScript"),"zei-superScript"],["subscript",b("tooltip.subscript"),"zei-subScript"]],[["image",b("tooltip.insertImage"),"zei-image"],["template",b("tooltip.template"),"zei-template"],["link",b("tooltip.insertLink"),"zei-link"],["insertHTML",b("tooltip.insertHtml"),"zei-html"]],[["spellcheck",b("tooltip.spellcheck"),"zei-spellCheck"]],[["quote",b("tooltip.insertQuote"),"zei-quote"],["removeformat",b("tooltip.removeFormatting"),"zei-removeformat"],["format",b("tooltip.formatpainter"),"zei-formatpaint"]],[["tableGrid",b("tooltip.table"),"zei-table"],["inserthorizontalrule",b("tooltip.insertHR"),"zei-line"]],[["smiley",b("tooltip.insertSmiley"),"zei-smiley"]],[["otheroptions",b("tooltip.otherOptions"),"zei-arrow ze-big"]]];return d},getText:e,tooltip:function(a){a.ele&&zmComponent.tooltip({elm:a.ele,text:a.tooltip,arrow:"top"})},getContactsEmails:function(a,b){for(var c="",d="#zm"+b+"txt_"+a,e=zmAutoFill.getAddress($(d)),f=e.length,g=0;g<f;g++)e[g].invalid||(g>0&&(c+=","),c+=e[g].eid);return c},contactsObj:{},fillContactObj:function(a){if(a.length)for(var b=a.length,c=0;c<b;c++)zmCUtil.contactsObj[a[c].emailAddress]=a[c]},loadingSugList:function(a){$("#zmsugfrlist_"+a).addClass("zmHideD"),$("#zmsugloading_dots_"+a).removeClass("zmHideD")},showSugList:function(a,b){var c=$("#zmsuglist_"+a);if(c.length&&!c.is(":visible")){var d=c.attr("data-type");d!==b&&c.parent().remove(),c=$("#zmsuglist_"+a)}if(c.length)c.length&&!c.is(":visible")&&c.parent().slideDown("100",function(){zmComp.setHeight(a)});else{var e=zmCompOpt._suggestionDOM(a),f=$("#zmto_"+a);"cc"===b&&(f=$("#zmcc_"+a)),f.after(e),c=$("#zmsuglist_"+a),c.attr("data-type",b),c.parent().slideDown("300",function(){zmComp.setHeight(a)})}$("#zmsugcontactslist_"+a).removeClass("zmHideD"),$("#zmsugfrlist_"+a).removeClass("zmHideD"),$("#zmsugloading_dots_"+a).addClass("zmHideD")},removeSugList:function(a){var b=$("#zmsuglist_"+a);b.length&&b.is(":visible")&&b.parent().slideUp("100",function(){zmComp.setHeight(a)}),zmCUtil.showLoading[a]=!1},insertAllSugContacts:function(a,b){var c=zmCUtil.missedSugObj[a],d=c.length;if(d)for(var e=0;e<d;e++)zmCUtil.insertSugContacts(a,b,c[e])},insertSugContacts:function(a,b,c){var d=zmComp.getSugType(a),e="zm"+d+"txt_"+a,f=zmConUtil.constructContact(zmCUtil.contactsObj[c]);zmAutoFill.contactFill(f,$("#"+e))},prevReqObj:[],showContactCard:function(a,b,c){var d=c.attr("eId");zmConUtil.showContactCard({dom:c[0],email:d,event:a,hideOnBlur:!0,source:"compose"}).done(function(a){var c=a.eventSource;if($(c).is(":visible")){var d=$("#zmsuglist_"+b);d.data({eIdElem:a.eventSource,listElem:a.component.$el})}else a.component.$el.remove()})},loadSugList:function(a,b,c){var d=$("#zmsugcontactslist_"+a),e=d.find("> span");e.remove();var f=function(b){return function(c){var d=setTimeout(function(){b.data({timer:null}),zmCUtil.showContactCard(c,a,b)},1e3);b.data({timer:d})}},g=function(a){return function(){var b=a.data("timer");b&&clearTimeout(b)}},h=function(b,c,d,e){return function(f){var g=$("#zmsuglist_"+a),h=e.data("timer");h&&(clearTimeout(h),e.data({timer:null}));var i=g.data();i&&i.listElem&&i.listElem.remove(),e.remove();var j=zmCUtil.missedSugObj[a],k=j.indexOf(d);k>-1&&j.splice(k,1),j.length||zmCUtil.removeSugList(a),zmCUtil.insertSugContacts(b,c,d),_zm.stopEvents(f)}};for(var i in c){var j=$.trim(c[i].email),k=$("<span/>");k.attr("class","SC_lnk zmNxtVal"),k.attr("eId",j),k.text($.trim(c[i].name)),k.on("mouseenter",f(k)),k.on("mouseout",g(k)),k.on("mousedown",h(a,b,j,k)),d.append(k)}},noContactsArray:function(a,b){for(var c=_.difference(a,b),d=c.length,e=[],f=0;f<d;f++){var g={};g.email=c[f],g.name=c[f],zmCUtil.contactsObj[g.email]||(zmCUtil.contactsObj[g.email]={emailAddress:g.email}),e.push(g)}return e},missedSugList:function(a,b,c){var d={eid:c,type:["personal"],excludeOrgUsers:!0};zmail.ContactBook.get(d).done(function(d){var e=d.map(function(a){return a.attrs}),f=e.map(function(a){var b={};return b.name=a.fn+" "+a.ln,b.email=a.eid,b.photo=a.photo,b}),g=[];f.forEach(function(a){g.push(a.email)});var h=zmCUtil.noContactsArray(c,g);f=f.concat(h);var i=e.map(function(a){var b={};return b.firstName=a.fn,b.lastName=a.ln,b.nickName=a.nn,b.emailAddress=a.eid,b});zmCUtil.fillContactObj(i),f.length&&(zmCUtil.showSugList(a,b),zmCUtil.loadSugList(a,b,f))})},missedSugObj:{},showLoading:{},updateSugList:function(a,b){var c=a.missedContacts||[],d=b.cmpId,e=b.type;zmCUtil.missedSugObj[d]=c,c&&!c.length?(zmCUtil.showLoading[d]=!1,zmCUtil.removeSugList(d)):c.length&&(zmCUtil.showLoading[d]=!0,zmCUtil.missedSugList(d,e,c))},getEmailsList:function(a,b){var c=zmCUtil.getContactsEmails(a,b);if("cc"===b){var d=zmCUtil.getContactsEmails(a,"to");d&&(c&&""!==c?c+=","+d:c=d)}else if("to"===b){var e=zmCUtil.getContactsEmails(a,"cc");e&&(c&&""!==c?c+=","+e:c=e)}return c},uniqSugContacts:function(a,b){var c=zmCUtil.getEmailsList(a,b);return c&&(c=c.split(","),c.length>=2&&(c=c.filter(function(a,b,c){return c.indexOf(a)===b}))),c},chkWrongContacts:function(a,b){var c=zmCUtil.uniqSugContacts(a,b);if(c.length>=3){var d={};d.cmpId=a,d.eleType=b,d.mode="wrong",d.emailLst=c,zmCUtil.reqWrongContacts(d)}},reqNewSugContacts:function(a){var b=zmCUtil.prevReqObj,c=!0,d=[];if(b.length===a.length)for(var e=b.length,f=a.length,g=0;g<e;g++)for(var h=0;h<f;h++)b[g]===a[h]&&d.push(b[g]);return d.length===a.length&&(c=!1),c},getSugContacts:function(a,b){zmCUtil.previousIcontactReq&&"pending"===zmCUtil.previousIcontactReq.state()&&zmCUtil.previousIcontactReq.abort();var c=zmCUtil.uniqSugContacts(a,b),d=!1;if(c.length&&(d=zmCUtil.reqNewSugContacts(c)),c.length>=2&&c.length<=15&&d){var e={};e.cmpId=a,e.eleType=b,e.mode="missed",e.emailLst=c,zmCUtil.showLoading&&zmCUtil.showLoading[a]&&zmCUtil.loadingSugList(a),zmCUtil.reqSugContacts(e)}else zmCUtil.removeSugList(a)},wrongContacts:function(a){zmComp.debugLog(a)},reqWrongContacts:function(a){var b=a.cmpId,c=a.eleType,d="";d=a.emailLst?a.emailLst:zmCUtil.uniqSugContacts(b,c);var e={};e.mode=a.mode,e.contact=d;var f={};f.mode=a.mode,f.contact=d,f.cmpId=b,f.type=c,zmCUtil.previousIcontactReq=zmAjq.XHR({u:zmail.conPath+"/ircontact.do",t:"POST",p:e,ep:f,csr:"s",fn:zmCUtil.wrongContacts})},reqSugContacts:function(a){var b=a.cmpId,c=a.eleType,d="";d=a.emailLst?a.emailLst:zmCUtil.uniqSugContacts(b,c);var e={};e.mode=a.mode,e.contact=d;var f={};f.mode=a.mode,f.contact=d,f.cmpId=b,f.type=c,zmCUtil.previousIcontactReq=zmAjq.XHR({u:zmail.conPath+"/ircontact.do",t:"POST",p:e,ep:f,csr:"s",fn:zmCUtil.updateSugList})},isEmailExist:function(a){var b=zmail.ContactBook.get({promise:!1,eid:a});return Boolean(b.length)},updateList:function(a,b){a&&b&&(b.list=a.list,b.render(),b.show())},getCmpIdType:function(a){var b=a.split("_")[1],c=a.split("_")[0];c&&(c=c.replace(/zm/g,""),c=c.replace(/txt/g,""));var d={};return d.cmpId=b,d.eleType=c,d},getElemId:function(a){var b=a.elem,c=null;return b&&b.id&&(c=zmCUtil.getCmpIdType(b.id)),c},_entityText:f,getContacts:function(a){var b=$.Deferred(),c={},d={str:a,type:["personal"],excludeOrgUsers:!0,expected:10};return zmail.ContactBook.get(d).done(function(a){var d=[],e=a.map(function(a){return a.attrs});e.length&&(d=e.map(function(a){var b={};return b.fn=a.fn+" "+a.ln,b.eid=a.eid,b.photo=a.photo,b})),c.result=d,b.resolve(c)}),b.promise()},getCmpObj:function(a){return zmComp.getCmpObj()[a]},setTempReqCnt:function(a,b){var c=zmCUtil.getCmpObj(a);c&&(c.tempReqCnt=b)},getTempReqCnt:function(a){var b,c=zmCUtil.getCmpObj(a);return c&&c.tempReqCnt&&(b=c.tempReqCnt),b},setTempReq:function(a,b){var c=zmCUtil.getCmpObj(a);c&&(c.tempReq=b)},getTempReq:function(a){var b,c=zmCUtil.getCmpObj(a);return c&&c.tempReq&&(b=c.tempReq),b},getSignature:function(a){var b=zmComp.getSignObj(),c="",d="";return a&&""!==a&&"null"!==a&&(c=b[a].SIG_CONT,d=b[a].SIG_POS),{SIG_CONT:c,SIG_POS:d}},trendingtags:function(a){var b,c,d=[];_.each(a,function(a){c=a.id||a.name,b=[["FONT",{attrs:{"class":"SClbl",style:"background-color:"+a.color}}],["text",a.dispName]],d.push(["SPAN",{attrs:{"data-text":c},child:b}])});var e="Filter by tag",f=["LI",{child:[["DIV",{child:[["STRONG",{child:[["text",e]]}],["DIV",{attrs:{"class":"SCS_tTags"},child:d}]]}]]}];return[_zm.getDOM(f)]},clearDraft:function(a,b){var c={aId:a};c.mode="discard",c.mailId=b;var d=$.extend({},c);zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",p:c,csr:"s",ep:d})},closeOutboxConfirm:function(b){var c=$("<div/>");c.attr("id","zmcmp_close_outbox_"+b);var d=a.outboxSending;c.text(d);var e={};e.cmpId=b,e.$content=c,e.ignoreMouseDown=!1,e.dialogDidMount=function(a){$("#zmcmp_close_outbox_"+b)[0].zmcmp_close_outbox=a;var c=a.$els.$maskWrapper;c.on("mousedown",function(b){var c=b.target||b.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):a.remove()})},e.defaultNavigator=!1,e.navigator=new zmail.Navigator({onEscape:function(){var a=$("#zmcmp_close_outbox_"+b)[0].zmcmp_close_outbox;a.remove()}});var f={};f.name="Send",f.callback=function(a){zmComp.setOutboxClose(b,!0),zmComp.sendMail({action:"compose",sendIm:!1,cmpId:b}),a.remove()};var g={};g.name="Delete",g.isCancel=!0,g.callback=function(a){zmCUtil.delOutboxReq(b,zmComp.getMymId(b)),zmComp.getOutboxMailId(b)&&zmCUtil.clearDraft(zmComp.getAccId(b),zmComp.getOutboxMailId(b)),a.remove()};var h={};h.name="Cancel",h.isCancel=!0,h.callback=function(a){a.remove()},e.buttons=[f,h,g],Dialog["new"](e)},discardOutboxConfirm:function(a){var b=$("<div/>");b.attr("id","zmcmp_discard_outbox_"+a),b.text("Do you want to delete this email from Outbox without sending?");var c={};c.cmpId=a,c.$content=b,c.ignoreMouseDown=!1,c.dialogDidMount=function(b){$("#zmcmp_discard_outbox_"+a)[0].zmcmp_discard_outbox=b;var c=b.$els.$maskWrapper;c.on("mousedown",function(a){var c=a.target||a.srcElement;$(c).closest("div.SC_pe").length?$(c).trigger("click"):b.remove()})},c.defaultNavigator=!1,c.navigator=new zmail.Navigator({onEscape:function(){var b=$("#zmcmp_discard_outbox_"+a)[0].zmcmp_discard_outbox;b.remove()}});var d={};d.name="OK",d.callback=function(b){zmCUtil.delOutboxReq(a,zmComp.getMymId(a)),zmComp.getOutboxMailId(a)&&zmCUtil.clearDraft(zmComp.getAccId(a),zmComp.getOutboxMailId(a)),b.remove()};var e={};e.name="Cancel",e.isCancel=!0,e.callback=function(a){a.remove()},c.buttons=[d,e],Dialog["new"](c)},delOutboxReq:function(a,b){var c={};c.accId=zmComp.getAccId(a),c.mode="moveto",c.viewfolId=zmail.folId.oId,c.mailId=b,c.todo=5,c.fT=6,c.folderSpec=1;var d={};d.cmpId=a,d.msgId=b,zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:zmCUtil.delOutboxResp,p:c,csr:"s",ep:d,setSessionId:!0})},updateOutboxView:function(){var a=zmInit,b=!1,c=zmail.folId;window.opener&&window.opener.zmInit&&zmail.isComposeMail&&(b=!0,a=window.opener.zmInit,c=window.opener.zmail.folId);var d=a.getListingDetObj();if(d){var e=d.fId;if(e&&e===c.oId){var f={fId:e,view:"",viewId:"",retainPreview:!0};b?window.opener.$.publish("/mail/listMails",f):$.publish("/mail/listMails",f)}}},delOutboxResp:function(a,b){if("success"===a.result){var c={};c.cmpId=b.cmpId,c.msgId=b.msgId,zmComp.setOutboxClose(c.cmpId,!0),zmComp.updModified(c.cmpId),zmComp.comClose(c),zmCUtil.updateOutboxView()}},createPopup:function(a){var b=zmCUtil.trendingtags(zmUtil.getTagList("default")),c={par:a.parent,showArrow:!0,liDom:b,ulClass:a.ulclass,spanClass:a.parentClass,id:"zms_dropdown"};return a.callback&&(c.clk=a.callback),a.buttons&&a.buttons.length>0&&(c.buttons=a.buttons),a.hoverElm&&$(a.hoverElm).addClass("SC_ddn"),a.direction&&(c.direction=a.direction),a.noArrow&&(c.showArrow=!1),void 0!==a.liHover&&(c.liHover=a.liHover),a.align&&(c.align=a.align),a.container&&(c.container=a.container),a.onhide&&(c.onHide=a.onhide),a.avoidScroll&&(c.avoidScroll=a.avoidScroll),zmsuite.showMenu(c),a.done&&a.done($("#zm_dropDown")),$("#zm_dropDown")},replyToFrm:function(a){var b="";return zmComp.getFromObj()[a]&&zmComp.getFromObj()[a].FRM_REPLY&&(b=zmComp.getFromObj()[a].FRM_REPLY),b},getReplyTo:function(a){var b=zmail.cmpdata.SETREPTO,c=zmCUtil.replyToFrm(a);return c&&(b=c),b},setTempFolId:function(a,b){var c=zmCUtil.getFolId(b);c&&(c===zmail.folId.teId&&zmComp.setTempId(a,b),zmComp.setFID(a,c))},getFolId:function(a){var b,c=zmUtil.getMailObj(a);return c&&c.FD&&(b=c.FD),b},draftThreadId:function(a){var b,c=zmUtil.getMailObj(a);return c&&c.T&&(b=c.T),b},getRlyType:function(a){var b=["outbox","draft","compose","eanew","fwdme"],c=["reply","replyall","fwdi"],d=!1;return b.indexOf(a)!==-1?d=!1:c.indexOf(a)!==-1&&(d=!0),d},addRefHeader:function(a,b){return a&&a.indexOf(b)===-1&&(a=a+" "+b),a},isIE:function(){var a=!1;return($.browser.msie||window.StyleMedia&&Boolean(document.documentMode))&&(a=!0),a},transResizeRepDOM:function(a){var b=$(zmsuite.getCenter(a)[0].getNodes()[0].$el),c=$(b).outerWidth();$("#zmrep_"+a).css({maxWidth:c+"px"}),zmAutoFill.resizeInput($("#zmto_"+a+" :input"),{resetWidth:!0}),zmAutoFill.resizeInput($("#zmcc_"+a+" :input"),{resetWidth:!0}),zmAutoFill.resizeInput($("#zmbcc_"+a+" :input"),{resetWidth:!0}),zmAutoFill.resizeInput($("#zmsub_"+a),{resetWidth:!0});try{zmComp.setTabHeight(a);var d=zmComp.getEditor(a);d&&($(d.toolbardiv).css({overflow:""}),d.regenerateToolbar())}catch(e){}},clearResizeRepDOM:function(a){var b=zmComp.getEditor(a);b&&$(b.toolbardiv).css({overflow:"hidden"}),$("#zmto_"+a+" :input").css({width:"0px"}),$("#zmcc_"+a+" :input").css({width:"0px"}),$("#zmbcc_"+a+" :input").css({width:"0px"}),$("#zmsub_"+a).css({width:"auto"})},resizeRepDOM:function(a){zmAutoFill.resizeInput($("#zmto_"+a+" :input")),zmAutoFill.resizeInput($("#zmcc_"+a+" :input")),zmAutoFill.resizeInput($("#zmbcc_"+a+" :input")),zmAutoFill.resizeInput($("#zmsub_"+a))},removeNotToParse:function(a){var b=$("<div/>");return b.html(a),b.find("div[class$='zmail_extra']").remove(),b.find("div[id$='Zm-_Id_-Sgn']").remove(),b.html()}};return g}(),window.zmCDocTemplate=function(){var a=function(){var a=zmText.get("zmcompose");return a}(),b=["<b>"+a.docshare_choosefiles+"</b>"],c=['<div class="zmL nohr" id="zmcdoc_recipients_tit_{{CMPID}}" data-shareopt="private">','<div class="zmLst">','<div class="zmFlt"><i class="msi-option" data-shareopt="option"></i></div>','<div class="zmDtl">','<div class="zmFrm"><span>'+a.docshare_recipientsthisemail+"</span></div>",'<div class="zmSub"><span class="sum">'+zmText.applyArgs(a.docshare_recipientsalone,{companyName:zmail.globalI18N.companyName})+"</span></div>","</div>","</div>","</div>",'<div class="shrPUOdata" id="zmcdoc_recipients_opt_{{CMPID}}" data-shareopt="private"><label> ',a.docshare_setpermissions+":</label>",'<div class="SC_select" style="width:135px;">','<select id="zmcdoc_recipients_select_{{CMPID}}">','<option value="1">'+a.docshare_readonly+"</option>",'<option value="2">'+a.docshare_readwrite+"</option>","</select>","</div>","</div>"],d=['<div class="zmL nohr" id="zmcdoc_org_tit_{{CMPID}}" data-shareopt="orgshare">','<div class="zmLst">','<div class="zmFlt"> <i class="msi-unoption" data-shareopt="option"></i> </div>','<div class="zmDtl">','<div class="zmFrm"><span>'+a.docshare_everyonewithme+"</span> </div>",'<div class="zmSub"><span class="sum">'+a.docshare_orgmemberhaslink+"</span></div>","</div>","</div>","</div>",'<div class="shrPUOdata" id="zmcdoc_org_opt_{{CMPID}}" data-shareopt="orgshare"><label> ',a.docshare_setpermissions+":</label>",'<div class="SC_select" style="width:135px;">','<select id="zmcdoc_org_select_{{CMPID}}">','<option value="1">'+a.docshare_readonly+"</option>",'<option value="2">'+a.docshare_readwrite+"</option>","</select>","</div>","</div>"],e=['<div class="zmL nohr" id="zmcdoc_internet_tit_{{CMPID}}" data-shareopt="linkshare">','<div class="zmLst">','<div class="zmFlt"> <i class="msi-unoption" data-shareopt="option"></i> </div>','<div class="zmDtl">','<div class="zmFrm"><span>'+a.docshare_everyoneinnet+"</span> </div>",'<div class="zmSub"><span class="sum">'+a.docshare_anyonehaslink+"</span></div>","</div>","</div>","</div>",'<div class="shrPUOdata" id="zmcdoc_internet_opt_{{CMPID}}" data-shareopt="linkshare">','<div style="min-height:39px;">','<i class="msi-uncheck" id="zmcdoc_internet_checkbox_{{CMPID}}"></i> ',a.docshare_setexpirydate,' <input id="zmcdoc_internet_text_date_{{CMPID}}" placeholder="" type="text" readonly>',"</div>","</div>"],f=['<div class="SC_PUbtm" id="button_share_{{CMPID}}">','<span class="sel" id="button_sharesend_{{CMPID}}">',a.docshare_shareandsend+'</span><span id="button_cancel_{{CMPID}}" data-val="Cancel">',a.docshare_cancel+"</span>",'<label class="SC_lnk SC_frt" id="button_sendwithout_{{CMPID}}">',a.docshare_sendwithoutshare+"</label>","</div>"],g={
_getCenter:function(){var a=b.join("");return a+=c.join(""),zmail.isOrg&&(a+=d.join("")),a+=e.join("")},_getButton:f};return g}(),window.zmCDoc=function(){var a=function(a){var b=zmCDocTemplate._getCenter();return b=b.replace(/{{CMPID}}/g,a)},b=function(a){var b=zmCDocTemplate._getButton.join("");return b=b.replace(/{{CMPID}}/g,a)},c={},d={showMore:function(a){$("#moreopt_sharedata_"+a).removeClass("SC_dyn"),$("#moreopt_share_"+a).addClass("SC_dyn")},hideMore:function(a){$("#moreopt_sharedata_"+a).addClass("SC_dyn"),$("#moreopt_share_"+a).removeClass("SC_dyn")},shareSend:function(a){var b=c[a]._sObj,d=c[a].shareType,e={};"private"===d?e.permission=$("#zmcdoc_recipients_select_"+a).find("option:selected").val():"orgshare"===d?e.permission=$("#zmcdoc_org_select_"+a).find("option:selected").val():"linkshare"===d?(e.permission=1,$("#zmcdoc_internet_checkbox_"+a).hasClass("msi-check")&&(e.expiryDate=$("#zmcdoc_internet_text_date_"+a).val())):"userpwdlink"===d&&(e.permission=1,e.sendPasswordInMail=!0,$("#zmcdoc_pwdlink_checkbox_"+a).hasClass("msi-check")&&(e.expiryDate=$("#zmcdoc_pwdlink_text_date_"+a).val()),e.password=$("#zmcdoc_pwdlink_inpPass_"+a).val()),e.expiryDate&&(e.expiryDate=zmCDoc.getDocDate(e.expiryDate)),c[a]._dialogDOCSHARE.remove(),e.shareType=d,b._sReq=e,b.zDocShare="send_with",zmComp.sendMail(b)},getDocDate:function(a){var b=zmail.userDateFormat.toUpperCase();if("DD/MM/YYYY"===b){var c=a.split("/");a=c[1]+"/"+c[0]+"/"+c[2]}return a},shareCancel:function(a){c[a]._dialogDOCSHARE.remove()},shareWithout:function(a){c[a]._dialogDOCSHARE.remove(),c[a]._sObj.zDocShare="send_without",zmComp.sendMail(c[a]._sObj)},setShowMore:function(a){$("#moreopt_share_"+a).off("click").on("click",function(){zmCDoc.showMore(a)})},setShareSend:function(a){$("#button_sharesend_"+a).off("click").on("click",function(){zmCDoc.shareSend(a)})},setShareCancel:function(a){$("#button_cancel_"+a).off("click").on("click",function(){zmCDoc.shareCancel(a)})},setShareWithout:function(a){$("#button_sendwithout_"+a).off("click").on("click",function(){zmCDoc.shareWithout(a)})},resetShareModes:function(a){for(var b=["zmcdoc_recipients_tit","zmcdoc_org_tit","zmcdoc_internet_tit","zmcdoc_pwdlink_tit"],c=0;c<b.length;c++){var d=$("#"+b[c]+"_"+a).find('i[data-shareopt="option"]').eq(0);d.removeClass("msi-option").addClass("msi-unoption")}},binderPrivate:function(a){var b=$("#zmcdoc_recipients_tit_"+a);b.off("click").on("click",function(){zmCDoc.resetShareModes(a),c[a].shareType="private";var d=b.find('i[data-shareopt="option"]').eq(0);d.removeClass("msi-unoption").addClass("msi-option")})},binderOrgshare:function(a){var b=$("#zmcdoc_org_tit_"+a);b.off("click").on("click",function(){zmCDoc.resetShareModes(a),c[a].shareType="orgshare";var d=b.find('i[data-shareopt="option"]').eq(0);d.removeClass("msi-unoption").addClass("msi-option")})},binderLinkshare:function(a){var b=zmCDoc.getDate(),d=$("#zmcdoc_internet_text_date_"+a).get(0);$("#zmcdoc_internet_text_date_"+a).val(b),zmCDoc.bindDatePicker(d,function(b){c[a]._date_val=b});var e=$("#zmcdoc_internet_tit_"+a);e.off("click").on("click",function(){zmCDoc.resetShareModes(a),c[a].shareType="linkshare";var b=e.find('i[data-shareopt="option"]').eq(0);b.removeClass("msi-unoption").addClass("msi-option")});var f=$("#zmcdoc_internet_opt_"+a).find("i").eq(0);f.off("click").on("click",function(){f.hasClass("msi-check")?f.removeClass("msi-check").addClass("msi-uncheck"):f.removeClass("msi-uncheck").addClass("msi-check")})},bindBox:function(a){zmCDoc.setShowMore(a),zmCDoc.setShareSend(a),zmCDoc.setShareCancel(a),zmCDoc.setShareWithout(a),zmCDoc.binderPrivate(a),zmCDoc.binderOrgshare(a),zmCDoc.binderLinkshare(a)},bindDatePicker:function(a,b){var c;if("undefined"!=typeof ZEVENTS){var d=zmCDoc.getDate(),e=zmail.userDateFormat.toUpperCase();void 0!==a&&(c=ZEVENTS(a).picker("date",{dform:e,wkst:0,mode:"popup",update:"yes",range:[d,""],minhgt:251}).on("dateclick",function(){b&&b(this.getDate().getDateBy(e))}).bind())}return c},getDocObj:function(a){var b={};return b.docObj=c,b.cmpId=c[a],b},getDate:function(){var a=new Date,b=2;a.setDate(a.getDate()+b);var c=a.getDate(),d=a.getMonth()+1,e=a.getFullYear();return c<10&&(c="0"+c),d<10&&(d="0"+d),a=c+"/"+d+"/"+e},shareDialog:function(a){var b={servicename:"zmail",docsURL:"//"+zmail.urls.docsURL,isnewui:!0};ATTACHDIALOG.setSharingTypeForSelectedUser(b.callback,zmComp.getZDObj(a))},showBox:function(d,e){var f=a(d),g=b(d),h=$(f),i=$(g),j={};j.cmpId=d,j.$content=h,j.title="Share Files",j.ignoreMouseDown=!1,j.dialogDidMount=function(a){a.$els.$content.attr("id","zmshare_"+d);var b=a.$els.$content;b.append(h),b.after(i),b.addClass("shrPU");var f="";try{f=ATTACHDIALOG.getDocAsLink().ZD_USER_PLAN_TYPE}catch(g){zmUtil.debugLog(g)}"FREE"===f&&$("#zmcdoc_internet_opt_"+d).remove(),zmCDoc.bindBox(d),c[d]={},c[d]._dialogDOCSHARE=a,c[d]._sObj=e,c[d].shareType="private"},Dialog["new"](j)}};return d}();
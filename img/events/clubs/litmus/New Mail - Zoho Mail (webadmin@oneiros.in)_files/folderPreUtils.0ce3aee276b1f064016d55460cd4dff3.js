"use strict";define([],function(a){var b=zmail.Core.Namespaces,c=b.create("zmfolAction");c.rgtFolId="";var d=a("zmUtil");c.loadFolderApp=function(b){var c=a("zmAppLoader");c.load("zmFolder").then(function(){b()})},c.isDeletedFolder=function(a){for(var b=c.getChildrenOf(zmail.folId.tId),d=b.length,e=0;e<d;e++)if(b[e]===a)return!0;return!1},c.getChildrenOf=function(a){var b=[],c=zmail.folTree[1],d=function e(a){var d=c[a];if(d){var f=d.CH;for(var g in f)b.push(g),c[g]&&e(g)}};return d(a),b},c.hasSharedFol=function(){return!(!zmail.shrTree||!zmail.shrTree.length)},c.getSortProperties=function(b,e,f){try{var g={sortBy:"date",sortOrder:!1,type:0};if(!b&&void 0===f)return g;if(void 0===f)if(d.isFolderId(b))if(c.isChildFol(b)){var h=c.getParentFolderId(b);f=zmail.folTree[1][h].CH[b].SMIF}else f=zmail.folTree[0][b].SMIF;else{var i=a("zmList");f=i.getListObj(b,"sortOrder")||0}return 0===f||1===f?g.sortOrder=1===f:2!==f&&3!==f||(g.sortBy="size",g.sortOrder=3===f),g.type=f||0,e?g[e]:g}catch(j){return d.debugLog(j),!1}},c.getParentFolderId=function(a){var b=zmail.folTree[1];for(var c in b)if(b[c].CH[a])return c;return 0},c.getNotificationSuppressedFolders=function(b){var c=a("zmAjq"),d=$.Deferred();return c.XHR({u:zmail.conPath+"/mailNotification.do",t:"POST",fn:function(a){a=a||{},d.resolve({folderList:a.status||[]})},p:{mode:"getSuppressedFolderList",accId:b||zmail.accId},csr:"s",efn:function(){d.reject()}}).fail(function(){d.reject()}),d.promise()},c.isChildFol=function(a){return!!c.getParentFolderId(a)},c.getFolCV=function(a){if(c.isChildFol(a)){var b=c.getParentFolderId(a);return zmail.folTree[1][b].CH[a].CV}return zmail.folTree[0][a].CV},c.getMailFolderPaths=function(){var a,b=function d(b,c){var e=[];if(c=c||{},c.pathStack=c.pathStack||[],c.idStack=c.idStack||[],c.folderMap=c.folderMap||zmail.folTree[0],!b&&!c.isSubTree)return a||d(!0);c.isSubTree||(a=[]),a=a||[];var f;for(f in c.folderMap)e[c.folderMap[f].SE-1]=f;for(var g=0,h=e.length;g<h;g++)if(e[g]){f=e[g],c.pathStack.push(c.folderMap[f].FN),c.idStack.push(f);var i=zmail.folTree[1][f]&&zmail.folTree[1][f].CH?Object.keys(zmail.folTree[1][f].CH).length:0,j=c.idStack[0],k=c.idStack[c.idStack.length-2];a.push({id:f,name:c.folderMap[f].FN,path:c.pathStack.join("/")+"/",parentName:c.pathStack.length>1?c.pathStack[0]:"",parentID:j||null,immediateParentID:k||null,levelCount:c.pathStack.length-1,childCount:i}),zmail.folTree[1][f]&&d(!1,{pathStack:c.pathStack,idStack:c.idStack,folderMap:zmail.folTree[1][f].CH,isSubTree:!0}),c.pathStack.pop(),c.idStack.pop()}else e.splice(g,1),g--,h--;return a},c=function(){a=void 0};return $.subscribe("folder/added",c),$.subscribe("folder/trashemptied",c),$.subscribe("folder/moved",c),$.subscribe("folder/renamed",c),$.subscribe("/mail/accountSwitch",function(a,b){b=b||{},"success"===b.status&&c()}),b}(),c.allowDrag=function(a){var b,c;for(b in a)c=b;return c!==zmail.folId.iId&&c!==zmail.folId.dId&&c!==zmail.folId.teId&&c!==zmail.folId.sId&&c!==zmail.folId.spId&&c!==zmail.folId.oId&&c!==zmail.folId.tId},c.allowDrop=function(a,b,d){var e,f,g,h,i;if("header"===d)return!0;for(e in b)f=e;for(e in a)h=e;if(1===zmail.mailOpt.folSort&&"inside"!==d)return i=zmail.folTree[0][f],!("next"!==d||!i||Object.keys(zmail.folTree[0]).length!==i.SE);if(f===h)return!1;if(f===zmail.folId.iId&&"inside"===d)return!0;if(f===zmail.folId.iId||f===zmail.folId.dId||f===zmail.folId.teId||f===zmail.folId.sId||f===zmail.folId.spId||f===zmail.folId.oId||f===zmail.folId.tId)return!1;for(g=c.getParentFolderId(f);g;){if(g===h)return!1;g=c.getParentFolderId(g)}return!0},c.updateFoldersCV=function(a){var b,e,f,g=zmail.folTree;for(b in g[0])if(d.hasFolSpecConversation(b)){g[0][b].CV=a;var h=c.getChildrenOf(b);for(f in h){e=h[f];var i=c.getParentFolderId(e);g[1][i].CH[e].CV=a}}},c.updateCV=function(a,b){var d=zmail.folTree,e=c.getParentFolderId(a);e?d[1][e].CH[a].CV=b:d[0][a].CV=b};var e=function(b){var c,d=a("zmText"),e=d.get("folderPreUtils").sharedFolder;switch(b){case"11":c=e.read;break;case"12":c=e.write;break;case"13":c=e.readWrite}return c};return c.updateSFProperty=function(){try{if(c.hasSharedFol()){var a,b;for(a in zmail.shrTree[0])b=zmail.shrTree[0][a],b.roleName=e(b.ROLE)}}catch(f){d.debugLog(f)}},c.isMutualFolder=function(a){try{if(c.isChildFol(a)){var b=c.getParentFolderId(a);return"-1"!==zmail.folTree[1][b].CH[a].SH}return"-1"!==zmail.folTree[0][a].SH}catch(e){return d.debugLog(e),!1}},c});
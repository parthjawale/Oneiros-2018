"use strict";!function(){var a=zmail.Core.Namespaces,b=a.create("zmHashTagAutoComplete"),c=zmail.Utils.DOM,d=zmail.Components.AutoComplete,e=d.System.AbstractTrigger,f=d.Utils,g=/(?:^[#]{1}([^\s]+))/i,h=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"textChangeAction",value:function(){var a=this,b=a._input,c=b.getCurrentTypingWord();if(/\s$/.test(c))return void a.publishNegativeTriggerEvent();a.currentText=c,g.lastIndex=0;var d=g.exec(c);if(d){var e=d[1]||"";a.publishTriggerEvent({searchToken:e})}else a.publishNegativeTriggerEvent()}},{key:"bindEvents",value:function(){var a=this,b=a._input,d=null;a._textChangeEventHandler=a._textChangeEventHandler.bind(a),a._textChangeEventHandler=f.debounce(a._textChangeEventHandler,0),d=a._textChangeEventHandler,c.element(b).on("textchange",d)}}]),b}(e);b.HashTagTrigger=h}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmHashTagAutoComplete"),c=zmail.Utils.DOM,d=zmail.Components.AutoComplete,e=d.System.AbstractListComponent,f={LIST:['<div ref="wrapper" class="SC_dd shw">','<div class="scrlldiv zmDDScroll">','<ul ref="listWrapper"></ul>',"</div>","</div>"].join("")},g=function(a){function b(){babelHelpers.classCallCheck(this,b);var a=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),c=a;return c.popUp=!0,a}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"getTemplate",value:function(){return f.LIST}},{key:"getScrollWrapperDOM",value:function(){var a=this;return a.refs.listWrapper}},{key:"handleListSpaceOverflow",value:function(a){var b=this;a=a||{};var d=b.getScrollWrapperDOM();c.setStyle(d,{height:a.height+"px"})}},{key:"positionComponent",value:function(a){var d=this,e=d.getScrollWrapperDOM();return c.setStyle(e,{height:"auto"}),babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"positionComponent",this).call(this,a)}},{key:"_mouseDownHandler",value:function(a){var b=this;b.mouseDown=!0,_zm.stopEvents(a)}},{key:"show",value:function(){var a=this;babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"show",this).call(this),a.popUp?c.setStyle(a.dom,{"z-index":"105"}):c.setStyle(a.dom,{"z-index":""}),c.show(a.dom)}},{key:"hide",value:function(){var a=this;babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"hide",this).call(this),c.hide(a.dom)}}]),b}(e);b.HashTagListComponent=g}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmHashTagAutoComplete"),c=zmail.Components.AutoComplete,d=c.System.AbstractListItemComponent,e=zmail.Utils.DOM,f={ITEM:['<li ref = "wrapper">','<span ref = "text"></span>',"</li>"].join("")},g=function(a,b,c){a=a||"",b=b||"",c=c||{};var d=[];if(!b)return d=a?[a]:[];var e=a;c.caseSensitive||(b=b.toLowerCase(),e=e.toLowerCase());var f,g,h=-1;for(f=0,g=a.length;f<g&&(h=e.indexOf(b,f),h!==-1);f++)0!==h&&d.push(a.substring(f,h)),d.push(a.substring(h,h+b.length)),f=h+b.length-1;return f<g&&d.push(a.substring(f)),d},h=function(a,b,c){c=c||{};var d=e.element(zdom("span",null));return d.text(a),c.caseSensitive||(b=b.toLowerCase(),a=a.toLowerCase()),b===a&&d.addClass("afHgl"),d},i=function(a,b,c,d){d=d||{},e.clearHTML(a);var f=g(b,c,d);f.forEach(function(b){var f=h(b,c,d);e.mount(f,a)}),e.setAttribute(a,{title:b})},j=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"getTemplate",value:function(){return f.ITEM}},{key:"render",value:function(a,b){var c=this;b=b||{},c._preRender(a),c.state.searchWord=b.searchWord||c.state.searchWord||"";var d=a.attributes,f="SC_Psli";c.state.selected?e.addClass(c.refs.wrapper,f):e.removeClass(c.refs.wrapper,f);var g=c.state.searchWord,h=d.text||"";e.clearHTML(c.refs.text),i(c.refs.text,h,g),c._postRender()}}]),b}(d);b.HashTagListItemComponent=j}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmHashTagAutoComplete"),c=zmail.Components.AutoComplete,d=c.System.AbstractListItemComponentFactory,e=c.System.AbstractListItemModel,f=zmHashTagAutoComplete.HashTagListItemComponent,g=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"createComponent",value:function(a){if(a instanceof e)return new f}}]),b}(d);b.HashTagListItemComponentFactory=g}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmHashTagAutoComplete"),c=zmail.Components.AutoComplete,d=c.System.AbstractDataProvider,e=c.System.AbstractListItemModel,f=function(a){function b(){babelHelpers.classCallCheck(this,b);var a=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),c=a;return c.searchResultLimit=10,c.priority=5,a}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"destroy",value:function(){var a=this;babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"destroy",this).call(this),a.searchResultLimit=null,a.priority=null}},{key:"searchData",value:function(a){var b=this,c=a.searchToken||"",d=c.toLowerCase(),f=null,g=null;return a=a||{},f=a.collection,g=a.deferred,d?void zmStreamsApp.GroupApp.fetchHashTags(zmail.zuid,"",function(a){if(a&&a.length)for(var c=0,h=a.length;c<h&&f.length<=b.searchResultLimit;c++){var i=(a[c].name||"").toLowerCase();if(0===i.indexOf(d)){var j=new e({text:i,id:i});f.add(j)}}g.resolve()}):void g.reject()}}]),b}(d);b.HashTagDataProvider=f}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmHashTagAutoComplete"),c=zmail.Components.AutoComplete,d=c.System.AbstractDataAccumulator,e=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"accumulateData",value:function(a){var b=this,c=a.collectionList;c.forEach(function(a){b.dataCollection.add(a.models)}),b.triggerAccumulationComplete()}}]),b}(d);b.HashTagDataAccumulator=e}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmHashTagAutoComplete"),c=zmail.Utils.DOM,d=zmail.Components.AutoComplete,e=d.System.BaseHTMLEditableAutoCompleteSystem,f=d.System.AbstractHTMLTextArea,g=zmHashTagAutoComplete.HashTagDataProvider,h=zmHashTagAutoComplete.HashTagListComponent,i=zmHashTagAutoComplete.HashTagListItemComponentFactory,j=zmHashTagAutoComplete.HashTagTrigger,k=zmHashTagAutoComplete.HashTagDataAccumulator,l={TEXTAREA:"1",EDITOR:"3",DIV:"4"},m={LIST_SHOWN:"listShown",LIST_HIDDEN:"listHidden",CLICK:"click"},n=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"initUserInput",value:function(a){var b=this,c=a.inputElement;switch(b.inputType){case"1":b.userInput=new f,b.userInput.init(c);break;case"3":b.userInput=c;break;case"4":b.userInput=c}}},{key:"createDataProviders",value:function(){return[new g]}},{key:"createTrigger",value:function(){return new j}},{key:"createDataAccumulator",value:function(){return new k}},{key:"createListComponent",value:function(){return new h}},{key:"createListItemComponentFactory",value:function(){return new i}},{key:"invokeDataProviderSearch",value:function(a){var b=this,c=b.dataProviders;b.dataAccumulator.dataCollection.reset(null),b.listModel.resetData(),b.disable||(b.listModel.set({currentSearchKey:a.searchToken}),c.forEach(function(b){b.getData({searchToken:a.searchToken,trigger:a.trigger})}))}},{key:"showComponent",value:function(){var a=this,b=a.dataAccumulator.dataCollection;if(b.length){var e=a.userInput.getListAnchorBounds();e.top-=a.userInput._element.scrollTop,e.bottom-=a.userInput._element.scrollTop,a.listComponent.positionComponent({anchorBounds:e}),a.listComponent.listItemComponents[0].model.set("selected",!0),a.listComponent.show(),c.element(a).triggerHandler(m.LIST_SHOWN),d.Utils.autoCompleteListsShown({instance:a})}}},{key:"hideComponent",value:function(){var a=this;a&&a.listComponent&&(a.listComponent.hide(),c.element(a).triggerHandler(m.LIST_HIDDEN),d.Utils.autoCompleteListsShown({instance:a,hide:!0}))}},{key:"_inputClickHandler",value:function(){var a=this;a.hideComponent()}},{key:"bindEvents",value:function(){var a=this;c.element(a.userInput._element).on(m.CLICK,a._inputClickHandler.bind(a)),babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"bindEvents",this).call(this)}},{key:"unbindEvents",value:function(){var a=this;c.element(a.userInput._element).off(m.CLICK,a._inputClickHandler),babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"unbindEvents",this).call(this)}}]),b}(e);n.INPUTS=l,n.EVENTS=m,b.HashTagAutoCompleteSystem=n}(),function(){var a=zmail.Core.Namespaces,b=a.create("zmHashTagAutoComplete"),c=zmail.Components.AutoComplete,d=c.System.AbstractAutoCompleteSystem,e=zmHashTagAutoComplete.HashTagAutoCompleteSystem,f=zmail.Utils.DOM,g=function(a){a=a||{};var b=a.input,c=new e;return"TEXTAREA"===f.element(b,!0).nodeName?c.inputType=e.INPUTS.TEXTAREA:b.editor?c.inputType=e.INPUTS.EDITOR:b.contenteditable&&(c.inputType=e.INPUTS.DIV),c.disable=a.disable||!1,c.inputInstance=a.inputInstance,c.init({inputElement:b,parentDOM:document.body}),f.element(c).on(d.EVENTS.ITEM_SELECTED,a.onSelect),f.element(c).on(e.EVENTS.LIST_SHOWN,a.listShown),f.element(c).on(e.EVENTS.LIST_HIDDEN,a.listHidden),c};b.HashTagAutoComplete=g}();
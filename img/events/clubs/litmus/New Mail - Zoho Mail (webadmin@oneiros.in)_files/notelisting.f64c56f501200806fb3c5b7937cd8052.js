"use strict";!function(){zNote.Models=zNote.Models||{},zNote.Models.Note=Zmail.Model.extend({initialize:function(){zNote.eventBus.on("editNote",this.updateModel,this),this.triggerUpdateModelSubscription=this.triggerUpdateModel.bind(this),this.renameNoteCatSubscription=this.renameNoteCat.bind(this),this.handleEditedStickyNoteSubscription=this.handleEditedStickyNote.bind(this),this.updateAttachmentDataSubscription=this.updateAttachmentData.bind(this),$.subscribe("/rename/notescat",this.renameNoteCatSubscription),$.subscribe("/rename/noteslabel",this.renameNoteCatSubscription),$.subscribe("/delete/noteslabel",this.renameNoteCatSubscription),$.subscribe("zmstreamsapp/addLabel",this.triggerUpdateModelSubscription),$.subscribe("/streams/comment",this.triggerUpdateModelSubscription),$.subscribe("attachment/addLabel",this.updateAttachmentDataSubscription),$.subscribe("attachment/removeLabel",this.updateAttachmentDataSubscription),void 0!==this.get("showStickyNote")&&$.subscribe("stickyNotes/EditNotified",this.handleEditedStickyNoteSubscription)},handleEditedStickyNote:function(a,b){var c=this;b.id===c.get("id")&&c.set(b)},triggerUpdateModel:function(a,b){var c,d={};b.id&&b.id.indexOf("#")!==-1?(d.id=b.id.slice(b.id.indexOf("#")+1,b.id.length),d.id===this.get("id")&&(void 0!==b.starred?(d.starred=b.starred,c={id:b.id,p:d},zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"starred",p:d})):b.isAddLabel===!0?(c=b.label,zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"addLabel",p:c})):b.isAddLabel===!1&&(c=b.label,zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"removeLabel",p:c})))):b.entityId===this.get("id")&&zNote.eventBus.trigger("editNote",self,{id:b.entityId,cattribute:"commentCount",p:{commentCount:b.total}})},updateModel:function(a,b){var c=this;if(b.id===c.get("id"))if("title"===b.cattribute)c.set(b.cattribute,znBox.revSpCharRep(b.p.title));else if("category"===b.cattribute)c.set("cat",b.p.catId);else if("color"===b.cattribute)c.set("color",b.p.color);else if("desc"===b.cattribute)c.set("desc",b.p.desc),c.set("updatedTime",b.p.updatedTime),c.set("summary",znBox.getTextContentFromHTML(b.p.desc));else if("starred"===b.cattribute)c.set("starred",b.p.starred);else if("addLabel"===b.cattribute)c.set("tagId",b.p);else if("removeLabel"===b.cattribute)c.set("tagId",b.p);else if("commentCount"===b.cattribute)c.set("commentCount",b.p.commentCount);else if("archive"===b.cattribute)c.set("archived",b.p.archived);else if("removeAttachment"===b.cattribute){var d=c.get("attachments").slice();$.each(d,function(a,c){if(c[b.p.attachId])return d.splice(a,1),!1}),c.set("attachments",d),c.trigger("change")}else if("addAttachment"===b.cattribute){var e=c.get("attachments")?c.get("attachments").slice():[],f=e.concat(b.p.attachments);c.set("attachments",f),c.trigger("change")}},updateAttachmentData:function(a,b){this.get("id")===b.attObj.e&&("attachment/removeLabel"===a.type?delete this.get("attachments")[0][b.attObj.Id]:this.get("attachments")[0][b.attObj.Id]=b.attObj)},openStickyNote:function(a){var b=this;a.id===b.get("id")&&(this.get("showStickyNote")===!0?this.trigger("change:addedagain"):this.showNote(!0))},addNote:function(a,b){var c=this,d={richTextSummary:a.desc||this.get("desc"),mode:"addNote",groupId:this.get("namespaceId"),entityType:zNote.CONSTANTS.entityType,streamsView:"Notes",actionType:"addEntity",catId:this.get("cat")||znBox.getGeneralCatId(this.get("namespaceId")),title:a.title||this.get("title"),color:a.color||this.get("color")};return Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(a){var d=c.toJSON(),e=zNote.getNoteDataInListFormat(a[0].data);c.set(e),c.set({type:"",oldId:d.id}),$.publish("/note/add",[e]),$.publish("/note/addNote",[a[0].data]),e.mode="addNote",$.publish("note/updateCount",[e]),b&&b.sticky&&$.publish("stickyNoteMod")}})},renameNoteCat:function(a,b){"/rename/noteslabel"!==a.type&&"/delete/noteslabel"!==a.type||this.get("tagId").indexOf(b.labId)!==-1&&("/delete/noteslabel"===a.type&&this.trigger("change:renamenotecat"),"/delete/noteslabel"===a.type&&this.removeTagDone(b.labId)),this.get("cat")===b.catId&&this.trigger("change:renamenotecat")},stopSubscriptions:function(){zNote.eventBus.off("editNote",this.updateModel,this),this.off(null,null,this),$.unsubscribe("zmstreamsapp/addLabel",this.triggerUpdateModelSubscription),$.unsubscribe("/streams/comment",this.triggerUpdateModelSubscription),$.unsubscribe("/rename/notescat",this.renameNoteCatSubscription),$.unsubscribe("/rename/noteslabel",this.renameNoteCatSubscription),$.unsubscribe("/delete/noteslabel",this.renameNoteCatSubscription),$.unsubscribe("notes/Notification",this.handleEditedStickyNoteSubscription),$.unsubscribe("zmailReconnect",this.handleEditedStickyNoteSubscription),$.unsubscribe("attachment/addLabel",this.updateAttachmentDataSubscription),$.unsubscribe("attachment/removeLabel",this.updateAttachmentDataSubscription)},deleteNote:function(){var a=this,b={entityId:this.get("id"),mode:"delNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"delEntity",entityType:zNote.CONSTANTS.entityType},c=$.extend(!0,{},b);c.cat=this.get("cat"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,success:function(){$.publish("/note/delete",[a.get("id"),a.get("namespaceId")]),$.publish("note/deleteNote",[{pid:a.get("id"),gid:a.get("namespaceId")}]),$.publish("note/updateCount",c)}})},saveTitle:function(a,b){var c=this;if(a=a||"",a!==this.get("title")){if("new"===this.get("type"))return void this.addNote({title:a},b);a.trim().length||(a=znBox.CONTS.defaultTitle);var d={title:a,entityId:this.get("id"),mode:"editNTitle",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",c,{id:d.entityId,cattribute:"title",p:d})}})}},postAsNew:function(a){var b=!1;a.comments&&(b=a.comments);var c={toNamespace:a.namespaceId,entityId:this.get("id"),mode:"changeGroup",groupId:this.get("namespaceId"),title:a.title,catId:a.catId,deleteOriginal:!1,commentsNeeded:b,entityType:zNote.CONSTANTS.entityType,actionType:"addEntity"},d=c;return Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){var b=zNote.getNoteDataInListFormat(a[0].data);_zm.succErrMsg("s",zNote.notei18n.msg.noteCopied+" "+znBox.getGroupName(d.toNamespace)),$.publish("/note/add",[b]),$.publish("note/updateCount",[{mode:"addNote",cat:b.cat,namespaceId:b.namespaceId}])}})},changeGroup:function(a,b){if("new"===this.get("type"))return void this.set("namespaceId",a.namespaceId);if(this.get("namespaceId")===a.namespaceId)return _zm.succErrMsg("e",zNote.notei18n.msg.moveNoteMsg),$.Deferred().reject();var c=this,d=void 0===a.comments||a.comments,e={toNamespace:a.namespaceId,entityId:this.get("id"),mode:"changeGroup",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addEntity",entityType:zNote.CONSTANTS.entityType,deleteOriginal:!0,commentsNeeded:d};a.title&&(e.title=a.title),a.catId&&(e.catId=a.catId);var f=$.extend(!0,{},e);return f.cat=c.get("cat"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:e,success:function(a){var c=zNote.getNoteDataInListFormat(a[0].data);_zm.succErrMsg("s",zNote.notei18n.msg.noteMoved+" "+znBox.getGroupName(f.toNamespace)),$.publish("/note/delete",[e.entityId,e.groupId]),$.publish("note/deleteNote",[{pid:e.entityId,gid:e.groupId}]),$.publish("note/updateCount",f),$.publish("/note/add",[c]),$.publish("note/updateCount",[{mode:"addNote",cat:c.cat,namespaceId:c.namespaceId}]),b&&b.sticky&&zNote.addAsStickyNote(c)}})},changeBook:function(a){if("new"===this.get("type"))return void this.set("cat",a);var b=this,c=this.get("cat"),d={catId:a,entityId:this.get("id"),mode:"moveNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"},e=$.extend(!0,{},d);e.pCatId=c,Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",b,{id:d.entityId,cattribute:"category",p:d}),$.publish("note/updateCount",e)}})},archiveOrUnarchiveNote:function(a){var b=this,c=this.get("cat"),d=a.archived?"archive":"unarchive",e={mode:d,entityId:this.get("id"),groupId:this.get("namespaceId")},f=$.extend(!0,{},e);f.pCatId=c,f.archived="archive"===d,Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:e,success:function(){var a="archive"===d?zNote.notei18n.msg.noteArchived:zNote.notei18n.msg.noteUnarchived;_zm.succErrMsg("s",a),zNote.eventBus.trigger("editNote",b,{id:e.entityId,cattribute:"archive",p:f})}})},saveAttachment:function(a){var b,c=this,d=[],e=[],f={mode:"addAttach",entityId:this.get("id"),groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addEntity",entityType:"2",attType:"attach"};if(a.tempLocation){for(var g=0;g<a.tempLocation.length;g++)"pending"!==a.tempLocation[g].virusFree&&a.tempLocation[g].virusFree!==!1&&(d.push(a.tempLocation[g].fP),e.push(a.tempLocation[g].sN));f.attachname=d,f.attachstore=e}a.myAttachment&&(b=JSON.stringify(a.myAttachment),f.attEntObj=b),(f.attachname.length||a.myAttachment.length)&&Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:f,success:function(a){zNote.eventBus.trigger("editNote",c,{id:f.entityId,cattribute:"addAttachment",p:a[0]})}})},addAttachment:function(a){zNote.eventBus.trigger("editNote",self,{id:this.get("id"),cattribute:"addAttachment",p:a[0]})},delAtt:function(a,b){$.publish("attachment/closeSlideshow");var c=this,d={mode:"delAttach",entityId:this.get("id"),groupId:this.get("namespaceId"),attachId:b,streamsView:"Notes",actionType:"delEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",c,{id:d.entityId,cattribute:"removeAttachment",p:d})}})},saveDescription:function(a,b){var c=this;if(a!==this.get("desc")&&(0!==a.trim().length||a.trim()!==this.get("desc"))){if("new"===this.get("type"))return void this.addNote({desc:a},b);var d={desc:a,entityId:this.get("id"),mode:"editNContent",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",setSessionId:!0,data:d,success:function(a){d.updatedTime=a[0].updatedTime,zNote.eventBus.trigger("editNote",c,{id:d.entityId,cattribute:"desc",p:d})}})}},sendAsMail:function(){var a={},b=[];if(a.SUBJECT=this.get("title"),a.CONTENT=this.get("desc").replace(/\n/g,"<br/>"),this.get("attachments")&&this.get("attachments").length){for(var c=this.get("attachments").length,d=0;d<c;d++){var e=this.get("attachments")[d];for(var f in e){var g={gId:this.get("namespaceId"),Id:e[f].Id,e:this.get("id"),et:2,fn:e[f].fn,fs:e[f].fs,p:e[f].p,ft:e[f].ft};b.push(g)}}a.NEWATT=b}zmUtil.compose(a,"",{entityType:"note"})},addTag:function(a){var b=this,c={tagId:a,entityId:this.get("id"),mode:"setTag",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){var d=b.get("tagId").slice();d.push(a),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"addLabel",p:d}),$.publish("note/editNote",[{mode:"addLabel",gid:b.get("namespaceId"),pid:c.entityId,labelId:a}])}})},removeTag:function(a){var b=this,c={tagId:a,entityId:this.get("id"),mode:"removeTag",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){b.removeTagDone(a)}})},removeTagDone:function(a){var b=this.get("tagId").slice();b.splice(this.get("tagId").indexOf(a),1),zNote.eventBus.trigger("editNote",this,{id:this.get("id"),cattribute:"removeLabel",p:b}),$.publish("note/editNote",[{mode:"removeLabel",pid:this.get("id"),gid:this.get("namespaceId"),labelId:a}])},saveColor:function(a){var b=this;if("new"===this.get("type"))return void this.set("color",a);var c={color:a,entityId:this.get("id"),mode:"editNColor",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"color",p:c})}})},showNote:function(a,b){this.set("showStickyNote",a),b&&b.silent||$.publish("stickyNoteMod")},closeNote:function(){"new"!==!this.get("type")&&$.publish("/note/closeStickyNote",[this.get("id"),this.get("namespaceId")])},saveFavourite:function(){var a=this,b=!this.get("starred"),c=b?"addLabel":"deleteLabel",d={starred:b,entityId:this.get("id"),mode:"editNFav",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:c,entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",a,{id:d.entityId,cattribute:"starred",p:d}),$.publish("note/editNote",[{mode:"changeFavourite",pid:d.entityId,gid:a.get("namespaceId"),starred:b}])}})}})}(),function(){zNote.Collections=zNote.Collections||{},zNote.Collections.Note=Zmail.Collection.extend({initialize:function(a,b,c,d){this.options=b,this.listInfo=c,this.mountingElem=d,this.on("change:cat",function(a){"c"===this.listInfo.mode&&this.listInfo.id!==a.get("cat")&&"zn_catAll"!==this.listInfo.id&&this.remove(a)}.bind(this)),this.on("change:archived",function(a){(a.get("archived")&&"c"===this.listInfo.mode||!a.get("archived")&&"archive"===this.listInfo.mode)&&this.remove(a)}.bind(this)),this.on("change:tagId",function(a){"l"===this.listInfo.mode&&a.get("tagId").indexOf(this.listInfo.id)===-1&&this.remove(a)}.bind(this)),this.on("change:starred",function(a){"fav"===this.listInfo.mode&&a.get("starred")===!1&&this.remove(a)}.bind(this)),this.addNoteSubscription=this.addNoteToCollection.bind(this),this.removeNoteSubscription=this.removeNoteFromCollection.bind(this),this.deleteNoteCatSubscription=this.deleteNoteCat.bind(this),$.subscribe("/note/add",this.addNoteSubscription),$.subscribe("/note/copy",this.addNoteSubscription),$.subscribe("/note/delete",this.removeNoteSubscription),$.subscribe("/delete/notescat",this.deleteNoteCatSubscription),this.listInfo&&"stickyNote"===this.listInfo.mode&&($.subscribe("/note/closeStickyNote",this.removeNoteSubscription),$.subscribe("/note/addstickynote",this.addNoteSubscription))},addNoteToCollection:function(a,b){var c=this;"mailassociated"===c.listInfo.id&&c.listInfo.msgid===b.email.msgid&&c.unshift(b),"c"===c.listInfo.mode&&("zn_catAll"===c.listInfo.id&&c.listInfo.groupId===b.namespaceId||c.listInfo.id===b.cat)&&(b.newNote=!0,c.unshift(b)),"stickyNote"===c.listInfo.mode&&void 0!==b.showStickyNote&&c.unshift(b)},removeNoteFromCollection:function(a,b){this.remove(this.get(b)),"stickyNote"===this.listInfo.mode&&$.publish("stickyNoteMod")},deleteNoteCat:function(a,b){var c=this.where({cat:b});c.length&&(this.remove(c,{silent:!0}),this.trigger("remove"))},stopSubscriptions:function(){$.unsubscribe("/note/delete",this.removeNoteSubscription),$.unsubscribe("/note/add",this.addNoteSubscription),$.unsubscribe("/delete/notescat",this.deleteNoteCatSubscription),"stickyNote"===this.listInfo.mode&&($.unsubscribe("/note/closeStickyNote",this.removeNoteSubscription),$.unsubscribe("/note/addstickynote",this.addNoteSubscription)),this.unmountCalled=!0},model:zNote.Models.Note})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteViewReact=function(n){function o(a,b){babelHelpers.classCallCheck(this,o);var c=babelHelpers.possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,a,b));return c.handleMouseUp=c.handleMouseUp.bind(c),c.handlePopOutNote=c.handlePopOutNote.bind(c),c.handleOnMinimize=c.handleOnMinimize.bind(c),c.handleOnClose=c.handleOnClose.bind(c),c.viewNote=c.viewNote.bind(c),c.handleOpenNote=c.handleOpenNote.bind(c),c}return babelHelpers.inherits(o,n),babelHelpers.createClass(o,[{key:"componentDidMount",value:function(){var a=this,b=ReactDOM.findDOMNode(this.refs.desc),c=ReactDOM.findDOMNode(this.refs.desc.refs.content);if(this.props.note.on("change",function(a){this.forceUpdate()}.bind(this)),this.props.note.on("change:renamenotecat",function(){this.forceUpdate()}.bind(this)),this.props.note.get("newNote")&&(this.props.note.set("newNote",void 0),$(ReactDOM.findDOMNode(a.refs.notebox)).addClass("zn_newNote"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_newNote")},2e3)),this.props.extraOptions&&this.props.extraOptions.stickyNote){if("restore"!==a.props.note.get("type")&&"new"!==a.props.note.get("type")&&$.publish("stickyNoteMod"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_fadeIn")},500),$(ReactDOM.findDOMNode(this.refs.notebox)).draggable({scroll:!1,containment:"window",stop:function(b,c){a.left=c.position.left,a.top=c.position.top,a.props.note.set({left:c.position.left},{silent:!0}),a.props.note.set({top:c.position.top},{silent:!0}),$.publish("stickyNoteMod")},stack:$(ReactDOM.findDOMNode(this.refs.notebox))}),$(b).resizable({containment:"document",handles:{se:".ui-resizable-se",e:".ui-resizable-e",s:".ui-resizable-s"},maxHeight:"500",maxWidth:"400",minHeight:"24",minWidth:"200",start:function(){$(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("maxHeight","500px")},resize:function(c,d){var e=d.size.width,f=d.size.height;$(ReactDOM.findDOMNode(a.refs.notebox)).css("width",e+"px"),$(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("height",f+"px"),document.body.clientHeight<$(ReactDOM.findDOMNode(a.refs.notebox)).position().top+$(ReactDOM.findDOMNode(a.refs.notebox)).outerHeight(!0)&&($(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("height",f-30+"px"),$(b).css("height",f-30+"px"),$(this).resizable("widget").trigger("mouseup"))},stop:function(b,c){a.width=c.size.width,a.height=c.size.height,a.props.note.set({width:c.size.width},{silent:!0}),a.props.note.set({height:c.size.height},{silent:!0}),$.publish("stickyNoteMod")}}),$(ReactDOM.findDOMNode(this.refs.notebox)).mousedown(function(){a.props.handleZIndex(a.props.note)}),zmail.isInternalOrgUser){var d=function(){parseInt($(c).css("height"))!==a.props.note.get("height")&&($(b).animate({height:a.props.note.get("height")+"px"},{duration:500}),$(c).animate({height:a.props.note.get("height")+"px"})),parseInt($(b).css("width"))!==a.props.note.get("width")&&($(ReactDOM.findDOMNode(a.refs.notebox)).animate({width:a.props.note.get("width")+"px"}),$(b).css("width",a.props.note.get("width")+"px")),a.actionOnParent=!1,a.pasteAction=!1},e=function(){a.actionOnParent||a.pasteAction||(parseInt($(c).css("height"))>zNote.CONSTANTS.dimensions.stickyheight?($(b).animate({height:zNote.CONSTANTS.dimensions.stickyheight+"px"},{duration:500}),$(c).animate({height:zNote.CONSTANTS.dimensions.stickyheight+"px"},{complete:function(){$(c).scrollTop(c.scrollHeight)}})):$(c).scrollTop(c.scrollHeight),parseInt($(b).css("width"))>zNote.CONSTANTS.dimensions.stickywidth&&($(ReactDOM.findDOMNode(a.refs.notebox)).animate({width:zNote.CONSTANTS.dimensions.stickywidth+"px"}),$(b).css("width",zNote.CONSTANTS.dimensions.stickywidth+"px")))};$(c).on("focus",function(){document.activeElement!==a.refs.head.refs.title&&d()}),$(a.refs.head.refs.title).on("focus",function(){d()}),$(c).on("blur",function(b){a.pasteAction||setTimeout(function(){document.activeElement!==a.refs.head.refs.title&&e()},500)}),$(a.refs.head.refs.title).on("blur",function(){a.pasteAction||setTimeout(function(){a.pasteAction||document.activeElement===c||e()},500)}),$(c).on("paste",function(b){a.pasteAction=!0}),$(ReactDOM.findDOMNode(a.refs.notebox)).on("mousedown",function(b){a.actionOnParent=!0}),$(ReactDOM.findDOMNode(a.refs.head)).on("mousedown",function(b){a.actionOnParent=!0,b.stopPropagation()})}this.props.note.on("change:addedagain",function(b){a.props.handleZIndex(a.props.note),$(ReactDOM.findDOMNode(a.refs.notebox)).addClass("zn_selNote"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_selNote")},500)}),$(ReactDOM.findDOMNode(this.refs.notebox)).on("mousedown",function(){document.activeElement.blur()})}}},{key:"componentDidUpdate",value:function(){var a=this;setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_fadeIn")},100)}},{key:"componentWillUnmount",value:function(){void 0===this.props.note.changed.showStickyNote&&this.props.note.stopSubscriptions()}},{key:"handleOnClose",value:function(){this.props.note.closeNote(),$.publish("stickyNoteMod")}},{key:"setDescriptionHeight",value:function(a){this.height=a}},{key:"getDescriptionHeight",value:function(){return this.height}},{key:"viewNote",value:function(){if(""===this.props.openedNote()){var a,b,c,d,e,f,g,h,i=this;this.props.handleOnOpenNote(this.props.note.get("id"));var j=$.extend(!0,{},this),k={};k.clientX=$(ReactDOM.findDOMNode(j.refs.notebox)).offset().left,k.clientY=$(ReactDOM.findDOMNode(j.refs.notebox)).offset().top,zNote.getNoteDetails({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}).done(function(l){if(i.props.handleOnOpenNote(""),0!==l[0]){var m=l[1],n=$(zNote.templates.noteViewMask());$("body").append(n);var o=$(n).innerHeight()-50,p=$(n).innerWidth()-50,q=zNote.previewNoteDS(m),r=function y(){i.props.handleOnOpenNote(""),n.remove(),zNote.eventBus.off("removeMask",y,i),$(ReactDOM.findDOMNode(j.refs.notebox)).show(),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts()},s=function(b){$.unsubscribe("zm/closeAllOpenDialog",f),c=b?b.top:k.clientY,d=b?b.left:k.clientX,i.props.handleOnOpenNote(""),n.find(".SC_mkStky").addClass("SC_dyn"),n.find(".SCS_post").hide(),n.find(".zn_popNote").removeClass("zn_popNote");var h=$(ReactDOM.findDOMNode(e.refs.notebox)),l=h.offset(),m=h.width();h[0].style.position="fixed",h[0].style.bottom="auto",h[0].style.width=m+"px",h[0].style.top=l.top+"px",h[0].style.left=l.left+"px",n.removeClass("blk"),$(ReactDOM.findDOMNode(e.refs.notebox)).animate({top:c+"px",left:d+"px",height:"UNMOUNTED"!==j.refs.notebox._lifeCycleState?$(ReactDOM.findDOMNode(j.refs.notebox)).height():0,width:"UNMOUNTED"!==j.refs.notebox._lifeCycleState?$(ReactDOM.findDOMNode(j.refs.notebox)).width():0},{complete:function(){"UNMOUNTED"!==j.refs.notebox._lifeCycleState&&$(ReactDOM.findDOMNode(j.refs.notebox)).show(),zmStreamsApp.util.detachAndRemove(n.find(".SC_ScrollY")).always(function(){ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(e.refs.notebox)).parent()[0]),$.unsubscribe("/note/delete",g),$.unsubscribe("/note/groupChange",a)})},always:function(){$.publish("zm/framework/dialogClosed"),n.remove()}}),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",r,i),zmUtil.hideMenu()};n.find("#npopin").on("click",function(){s(),zNote.openNoteInTab({namespaceId:i.props.note.get("namespaceId"),id:i.props.note.get("id")})}),n.find("#nclose").on("click",function(){s()}),f=function(a,b){s(b)},g=function(a,b,c){b===q.get("notes").id&&c===q.get("gnrl").group.id&&s()},a=function(a,c){zmHash.setHash("notes",["preview",c.gnrl.group.id,c.notes.id]),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:b.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:c,hideContent:!0})})},h=function(){var a=o-($(ReactDOM.findDOMNode(e.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(e.refs.desc.refs.content)).height());e.refs.desc.updateHeight({height:a})},$.subscribe("zm/closeAllOpenDialog",f),$.subscribe("/note/delete",g),$.subscribe("/note/groupChange",a);var t={};t.componentUpdated=function(a,b){h()},e=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:q,options:t,removeNotePreview:s}),n.find("#noteBox")[0]),zNote.eventBus.on("removeMask",r,i),ReactDOM.findDOMNode(e.refs.notebox).style.left="-4000px",b=$('<div class=""><div class=""><div class="SC_ScrollY"></div></div></div>');var u={by:m.gnrl.by,id:m.notes.id,etype:2,groupId:m.gnrl.group.id,showinvite:m.myact.showinvite,lockInvites:m.gnrl.lockInvites,like:m.myact.like,invitee:parseInt(m.act.invitees),inviteeList:m.myact.inviteeList,likes:parseInt(m.act.likes)};m.gnrl.group.isGroup?u.actionType="viewGroupEntity":u.actionType="viewSelfData",zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:b.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:m,hideContent:!0})}),n.find(".SC_pe").css("max-height",o),n.find(".SC_pe").css("min-width",p-200),n.find(".SC_pe").css("max-width",p-200),ReactDOM.findDOMNode(e.refs.notebox).style.left="0px",n[0].style.left="0px",n[0].style.top="0px",b.find(".SC_ScrollY").css("max-height",o),n.find("#noteBox").append(b);var v=k.clientX+100+"px",w=k.clientY+100+"px",x=o-($(ReactDOM.findDOMNode(e.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(e.refs.desc.refs.content)).height());e.refs.desc.setContentHeight({height:x}),n.css({"transform-origin":v+" "+w,transition:"transform 0.5s ease"}),n.css({transform:"scale(1)",opacity:1}),setTimeout(function(){n.removeClass("tra").addClass("blk").css({transition:"all 0.5s ease"}),"UNMOUNTED"!==j.refs.notebox._lifeCycleState&&$(ReactDOM.findDOMNode(j.refs.notebox)).hide(),zNote.setKeyBoardShortcuts({esc:s}),zmHash.setHash("notes",["preview",i.props.note.get("namespaceId"),i.props.note.get("id")])},300)}}).fail(function(){i.props.handleOnOpenNote("")})}}},{key:"handleOnMinimize",value:function(){var a=this;this.left=$(ReactDOM.findDOMNode(this.refs.notebox)).offset().left-20,this.top=$(ReactDOM.findDOMNode(this.refs.notebox)).offset().top-20;var b=$("#sNoteTab").find(".msi-stickyNote").offset().left,c=$("#sNoteTab").find(".msi-stickyNote").offset().top,d=$(ReactDOM.findDOMNode(this.refs.notebox)).outerHeight(!0),e=$(ReactDOM.findDOMNode(this.refs.notebox)).outerWidth(!0),f=$(ReactDOM.findDOMNode(this.refs.notebox)).width();$(ReactDOM.findDOMNode(this.refs.notebox)).animate({left:b-16,top:c-20,height:0,width:0},{complete:function(){ReactDOM.findDOMNode(a.refs.notebox).style.top=a.top+"px",ReactDOM.findDOMNode(a.refs.notebox).style.left=a.left+"px",$(ReactDOM.findDOMNode(a.refs.notebox)).outerHeight(d),$(ReactDOM.findDOMNode(a.refs.notebox)).outerWidth(e),$(ReactDOM.findDOMNode(a.refs.notebox)).css("height",""),$(ReactDOM.findDOMNode(a.refs.notebox)).width(f),a.props.note.showNote(!1)},duration:700})}},{key:"handleMouseUp",value:function(){this.selection=zNote.getSelectedTextWithin(ReactDOM.findDOMNode(this.refs.notebox))}},{key:"handleOpenNote",value:function(){var a=this,b=_.debounce(function(){a.viewNote(a)},1e3,{leading:!0});this.selection=zNote.getSelectedTextWithin(ReactDOM.findDOMNode(this.refs.notebox)),this.selection.length||this.props.extraOptions&&this.props.extraOptions.stickyNote&&this.props.extraOptions||b()}},{key:"handlePopOutNote",value:function(a){a.stopPropagation();var b=this,c=_.debounce(function(){b.viewNote(b)},1e3,{leading:!0});c()}},{key:"render",value:function(){var n,o,p,q,r=this.props.extraOptions&&this.props.extraOptions.stickyNote?"zn_note zn_stickyNote "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]:"zn_note cursorPointer "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")];this.props.note.get("showStickyNote")===!1&&(r+=" SC_dyn");var s={left:"-1000",width:"276"};return this.props.extraOptions&&this.props.extraOptions.stickyNote&&(q="new"===this.props.note.get("type")?"SC_dyn":"",this.props.note.get("showStickyNote")===!0&&"add"===this.props.note.get("type")&&(r+=" zn_fadeIn"),o=React.createElement("div",{className:"cursorMove",ref:"dragband",title:zNote.notei18n.holdanddrag}),n=React.createElement("div",{className:"SCmb SC_frt"},React.createElement("li",{className:q,onClick:this.handlePopOutNote},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-popout"})))),React.createElement("li",{onClick:this.handleOnMinimize},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-minus"})))),React.createElement("li",{onClick:this.handleOnClose},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-close"}))))),void 0!==this.props.note.get("top")&&(this.top=this.props.note.get("top"),this.props.note.set({top:void 0},{silent:!0})),void 0!==this.props.note.get("left")&&(this.left=this.props.note.get("left"),this.props.note.set({left:void 0},{silent:!0})),void 0!==this.left&&void 0!==this.top&&void 0!==this.props.note.get("zIndex")||(p=this.props.getAvailableTopLeft()),void 0!==this.props.note.get("width")?this.width=this.props.note.get("width"):(this.width=276,this.props.note.set({width:"276"},{silent:!0})),void 0===this.props.note.get("zIndex")&&this.props.note.set({zIndex:p.zIndex},{silent:!0}),this.left=void 0!==this.left?this.left:p.left,this.top=void 0!==this.top?this.top:p.top,this.props.note.set({left:this.left},{silent:!0}),this.props.note.set({top:this.top},{silent:!0}),s.left=this.left,s.top=this.top,s.width=this.width,s.zIndex=this.props.note.get("zIndex")),React.createElement("div",{className:r,onMouseUp:this.handleMouseUp,onClick:this.handleOpenNote,ref:"notebox",style:s},o,React.createElement("div",{className:"zn_dd"},n,React.createElement(a,{note:this.props.note}),React.createElement(b,{note:this.props.note,extraOptions:this.props.extraOptions})),React.createElement("div",null,React.createElement(k,{note:this.props.note,ref:"head",extraOptions:this.props.extraOptions,parent:this}),React.createElement(j,{note:this.props.note,print:this.props.print,parent:this,viewNote:this.viewNote,extraOptions:this.props.extraOptions,mountingElem:this.props.mountingElem,ref:"desc"})),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt"},React.createElement("ul",null,React.createElement(c,{note:this.props.note}),React.createElement(f,{note:this.props.note,extraOptions:this.props.extraOptions,parent:this}),React.createElement(d,{note:this.props.note}),React.createElement(l,{ref:"showmore",note:this.props.note,extraOptions:this.props.extraOptions,parent:this}))),React.createElement("div",{className:"SC_frt"},React.createElement("ul",null,React.createElement(h,{note:this.props.note,parent:this}),React.createElement(g,{note:this.props.note,parent:this}))))),React.createElement("div",{className:"zn_folder zn_clear"},function(a){return React.createElement(e,{note:a.props.note,extraOptions:a.props.extraOptions,parent:a,ref:"tag"})}(this),React.createElement(i,{note:this.props.note,extraOptions:this.props.extraOptions})),function(a){return React.createElement(m,{ref:"attDiv",note:a.props.note})}(this))}}]),o}(React.Component);var a=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this;zmail.ContactBook.get({zuid:a.props.note.get("ownerZUID")}).done(function(b){var c=b[0];c&&c.attrs&&c.attrs.fn&&(zmComponent.tooltip({elm:$(ReactDOM.findDOMNode(a.refs.creator))[0],text:c.attrs.fn,arrow:"top"}),$(ReactDOM.findDOMNode(a.refs.creator)).append(c.avatar()))})}},{key:"render",value:function(){return React.createElement("span",{ref:"creator"})}}]),b}(React.Component),b=function(a){function b(){babelHelpers.classCallCheck(this,b);var a=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a.timer=a.timer.bind(a),a}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){if(this.props.extraOptions&&this.props.extraOptions.stickyNote){var a=setInterval(this.timer,5e3);this.setState({
intervalId:a})}}},{key:"componentWillUnmount",value:function(){this.props.extraOptions&&this.props.extraOptions.stickyNote&&clearInterval(this.state.intervalId)}},{key:"timer",value:function(){this.forceUpdate()}},{key:"render",value:function(){if(!_zm._isPrivilegedUser())return React.createElement("span",{className:"zn_date"},this.props.note.get("disptime"));var a=void 0;return a=this.props.extraOptions&&this.props.extraOptions.stickyNote&&this.props.note.get("updatedTime")?zmComponent.dateTimeUtil.getRelativeTimeInNoteFormat(this.props.note.get("updatedTime"),"mm dd at hr:min"):this.props.note.get("disptime"),React.createElement("span",{className:"zn_date"},a)}}]),b}(React.Component),c=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetFavourite=d.handleSetFavourite.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})}},{key:"handleSetFavourite",value:function(a){a.stopPropagation(),this.props.note.saveFavourite()}},{key:"render",value:function(){if("new"===this.props.note.get("type"))return null;var a=this.props.note.get("starred")?"SC_fav":"";return React.createElement("li",{ref:"star",onClick:this.handleSetFavourite,className:a},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-fav"}))))}}]),b}(React.Component),d=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleArchive=d.handleArchive.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this.props.note.get("archived")?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"componentDidUpdate",value:function(){var a=this.props.note.get("archived")?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"handleArchive",value:function(a){a.stopPropagation();var b=!this.props.note.get("archived");this.props.note.archiveOrUnarchiveNote({archived:b})}},{key:"render",value:function(){var a=this.props.note.get("archived")?"msi-unarchive":"msi-archive",b=!1;return!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&(this.props.note.get("ownerZUID")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(b=!0),znBox.isArchiveOpen()&&b&&"new"!==this.props.note.get("type")?React.createElement("li",{ref:"archive",onClick:this.handleArchive},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:a})))):null}}]),b}(React.Component),e=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this.refs.labelicon||this.refs.plus;zmComponent.tooltip({elm:a,text:zNote.notei18n.note.addTag,arrow:"top"})}},{key:"addLabel",value:function(a,b){a.stopPropagation();var c,d=this,e={};e.parentDOM=this.refs.plus?ReactDOM.findDOMNode(this.refs.plus):b,e.displayAs="popup",e.labelState={labelList:this.props.note.get("tagId")},e.showCreate=!0,this.props.extraOptions&&this.props.extraOptions.stickyNote&&(e.spanClass="zmArmZI"),e.accType="default",e.onHide=function(){$("#zm_dropDown").remove()},e.onCreate=function(a,b){znBox.sendNewLabReq(a,b).done(function(a){a&&1===a[0]&&a[1].labelId&&(c.hide(),d.props.note.addTag(a[1].labelId))})},e.onStateChange=function(a,b){b?d.props.note.addTag(a):d.props.note.removeTag(a)},c=zmUtil.createFLComp("label",e),c.show()}},{key:"render",value:function(){if("new"===this.props.note.get("type"))return null;var a,b={backgroundColor:""},c=this,d=function(b){return function(d){b&&(a=$(ReactDOM.findDOMNode(c.refs.labelicon))[0]),c.addLabel(d,a)}};return c.props.note.get("tagId")&&c.props.note.get("tagId").length>0?React.createElement("div",{className:"zm_lbl"},React.createElement("div",{className:"zmLblGrp zmViewLtdLbl"},c.props.note.get("tagId").map(function(a){return!!zmUtil.getTagList("default")[a]&&(b={backgroundColor:zmUtil.getTagList("default")[a].color},React.createElement("div",{className:"zmLbl",title:zmUtil.getTagList("default")[a].label,onClick:d()},React.createElement("span",{style:b})))})),React.createElement("i",{className:"msi-plus",ref:"plus",onClick:d()})):React.createElement("div",{className:"zm_lbl"},React.createElement("i",{className:"msi-label",ref:"labelicon",onClick:d(!0)}))}}]),b}(React.Component),f=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetColor=d.handleSetColor.bind(d),d.handleSetAttributes=d.handleSetAttributes.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})}},{key:"handleSetColor",value:function(a){a.stopPropagation();var b=this,c="minwid";if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var d=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');d.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]).append("<i class=msi-tick></i>"),this.props.extraOptions&&this.props.extraOptions.stickyNote&&(c+=" zmArmZI");var e={par:a.target,showArrow:!0,liDom:d,direction:"bottom",ulClass:"zn_clrSel",spanClass:c};zmsuite.showMenu(e),$(d[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className])})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")}},{key:"handleSetAttributes",value:function(){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")}},{key:"render",value:function(){var a=!1;!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&(this.props.note.get("ownerZUID")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(a=!0);var b=a?"":"SC_dyn";return React.createElement("li",{className:b,ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"}))))}}]),b}(React.Component),g=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"render",value:function(){return this.props.note.get("commentCount")&&0!==this.props.note.get("commentCount")?React.createElement("li",{className:"zn_actVIcon",title:zNote.notei18n.info.commentsavailable},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,this.props.note.get("commentCount"),React.createElement("i",{className:"msi-lcmnt"})))):null}}]),b}(React.Component),h=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleViewAssociatedMail=d.handleViewAssociatedMail.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})}},{key:"handleViewAssociatedMail",value:function(a){a.stopPropagation();var b={};this.props.note.get("email").accid!==zmail.accId&&(b={actionType:"viewGroupMailEntity",entityId:this.props.note.get("email").msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("ownerZUID"),accId:this.props.note.get("email").accid}),zmList.getMailData({msgId:this.props.note.get("email").msgid,opentype:2,type:"lt",src:"external",eprm:b})}},{key:"render",value:function(){var a=this.props.note.get("email")&&!$.isEmptyObject(this.props.note.get("email"))?"zn_actVIcon":"zn_actVIcon SC_dyn";return React.createElement("li",{className:a,ref:"mailopen",onClick:this.handleViewAssociatedMail},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-mailopen"}))))}}]),b}(React.Component),i=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleChangeBook=d.handleChangeBook.bind(d),d.handleChangeGroup=d.handleChangeGroup.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){this.props.note.get("ownerZUID")===zmail.zuid&&zmComponent.tooltip({elm:this.refs.book,text:zNote.notei18n.tooltips.moveNote,arrow:"top"})}},{key:"handleChangeGroup",value:function(a){if(this.props.note.get("ownerZUID")===zmail.zuid){var b,c=this.props.extraOptions&&this.props.extraOptions.stickyNote;a.stopPropagation();var d=znBox.getGroupArray(),e=this,f={};f.parentDOM=ReactDOM.findDOMNode(this.refs.group),f.displayAs="popup",f.showCreate=!0,f.onSelect=function(a){b.hide();var d={okButtonName:zNote.notei18n.yes,cancelButtonName:zNote.notei18n.no,$content:zNote.notei18n.confirmMsg.noteMoveConfirm+" "+znBox.getGroupName(a)+"?"},f=function(){e.props.note.changeGroup({namespaceId:a},{sticky:c})};Dialog.confirm(void 0,f,void 0,d)},f.onHide=function(){$("#zm_dropDown").remove()},f.dataCallback=function(){return d},f.spanClass="zmArmZI",b=zmUtil.createFLComp("group",f),b.show()}}},{key:"handleChangeBook",value:function(a){var b=!1;if(!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&(this.props.note.get("ownerZUID")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(b=!0),b){a.stopPropagation();var c,d=znBox.getCategoryArray(this.props.note.get("namespaceId")),e=this,f={};f.parentDOM=ReactDOM.findDOMNode(this.refs.book),f.displayAs="popup",f.onSelect=function(a){e.props.note.changeBook(a),c.hide()},(this.props.note.get("namespaceId")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(f.onCreate=function(a){znBox.sendNewCatReq(a,{},e.props.note.get("namespaceId")).done(function(a){e.props.note.changeBook(a[1][0].catId),c.hide()})}),f.onHide=function(){$("#zm_dropDown").remove()},f.dataCallback=function(){return d},this.props.extraOptions&&this.props.extraOptions.stickyNote&&(f.spanClass="zmArmZI"),c=zmUtil.createFLComp("category",f),c.show()}}},{key:"render",value:function(){var a=znBox.getGroupName(this.props.note.get("namespaceId")),b=zNote.getNamefrmCatObj(this.props.note.get("cat"),this.props.note.get("namespaceId")),c=""===a?"zn_cgy SC_dyn":"zn_cgy";return React.createElement("div",{className:c,ref:"cgy"},React.createElement("font",{ref:"group",className:"zn_ngrp",onClick:this.handleChangeGroup},a),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},b))}}]),b}(React.Component),j=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c)),e=!1;return d.props.note.get("desc")&&d.props.note.get("desc").length>=255&&!d.props.print&&(e=!0),d.ispaste=!1,d.showEditor=znBox.isRichTextOpen(),d.state={height:0,readmore:e},d.handlePaste=d.handlePaste.bind(d),d.handleSaveSelection=d.handleSaveSelection.bind(d),d.handleSetDescription=d.handleSetDescription.bind(d),d.handleSetHeight=d.handleSetHeight.bind(d),d.handleOpenNote=d.handleOpenNote.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a,b=$(ReactDOM.findDOMNode(this.refs.content));this.props.extraOptions&&this.props.extraOptions.stickyNote&&(b.css({"max-height":"300px","overflow-y":"auto","overflow-x":"hidden"}),b.on("mousedown",function(a){a.stopPropagation()}),"new"===this.props.note.get("type")&&b.focus()),void 0===this.props.note.get("height")||null===this.props.note.get("height")||isNaN(parseInt(this.props.note.get("height")))?0!==b.height()&&(a=b.height()>200?200:b.height(),this.setState({height:a}),this.props.note.set({height:a},{silent:!0})):(this.setState({height:this.props.note.get("height")}),b.css("height",this.props.note.get("height")+"px"),b.css({"max-height":"500px"})),b.on("click","a",function(a){a.preventDefault()})}},{key:"handleOpenNote",value:function(a){a.stopPropagation();var b=this,c=_.debounce(function(){b.props.viewNote(b.props.parent)},1e3,{leading:!0});c()}},{key:"componentWillReceiveProps",value:function(){this.props.note.get("desc")&&this.props.note.get("desc").length>=255?this.setState({readmore:!0}):this.setState({readmore:!1})}},{key:"handleSetDescription",value:function(a){var b=this.showEditor,c=this.props.extraOptions&&this.props.extraOptions.stickyNote;this.ispaste===!1&&this.descOnFocus!==ReactDOM.findDOMNode(this.refs.content).innerHTML&&(b?this.props.note.saveDescription($(ReactDOM.findDOMNode(this.refs.content)).html(),{sticky:c}):this.props.note.saveDescription(znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.content))))))}},{key:"setImage",value:function(a){var b=this.selection;$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus",!0,!0);var c=Object.keys(a[0].inline[0])[0],d=zmail.conPath+"/FileDownload?attachId="+a[0].inline[0][c].Id+"&entityType=2&entityId="+this.props.note.get("id")+"&actionType=viewGroupEntity&groupId="+this.props.note.get("namespaceId")+"&streamsView=Notes&mode=view&app=notes&attachType=inline",e=znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),b);e||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img id="+a[0].inline[0][c].Id+" src="+d+"></img>"):document.execCommand("insertHTML",!1,"<img id="+a[0].inline[0][c].Id+" src="+d+"></img>")}},{key:"handleSetHeight",value:function(){this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)),this.state.height!==$(ReactDOM.findDOMNode(this.refs.content)).height()&&this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()})}},{key:"handleSaveSelection",value:function(a,b,c){this.descOnFocus=ReactDOM.findDOMNode(this.refs.content).innerHTML,c||(this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)))}},{key:"restoreSelection",value:function(){znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),this.selection)}},{key:"handlePaste",value:function(a){var b=this;this.ispaste=!0,znBox.handlePaste(a.target),setTimeout(function(){b.ispaste=!1},200)}},{key:"fillSummary",value:function(){this.setState({readmore:!1})}},{key:"render",value:function(){var a,b,c="",d=zNote.notei18n.placeholder.writeSome,e=Boolean(this.props.extraOptions&&this.props.extraOptions.stickyNote);"new"===this.props.note.get("type")||!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&this.props.note.get("ownerZUID")===zmail.zuid||(e=!1);var f=this.showEditor;return b=f?this.props.note.get("desc")?this.props.note.get("desc").replace(/\n/g,"<br />"):"":this.props.note.get("desc")?this.props.note.get("desc").replace(/\n/g,"<br />"):"",c=this.state.readmore&&!e?React.createElement("div",null,React.createElement("div",{className:"zn_cont zn_trunc",ref:"content","data-plhr":d,contentEditable:e,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"znMore",onClick:this.handleOpenNote},"Read More ...")):React.createElement("div",null,React.createElement("div",{className:"zn_cont",ref:"content","data-plhr":d,contentEditable:e,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"znMore SC_dyn"},"Read More ...")),this.props.extraOptions&&this.props.extraOptions.stickyNote&&(a=React.createElement("div",{className:"sticky_resizable",title:zNote.notei18n.tooltips.resize},React.createElement("div",{className:"ui-resizable-handle ui-resizable-e"}),React.createElement("div",{className:"ui-resizable-handle ui-resizable-s"}),React.createElement("div",{className:"ui-resizable-handle ui-resizable-se"}))),React.createElement("div",{className:"zn_base"},c,a)}}]),b}(React.Component),k=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetTitle=d.handleSetTitle.bind(d),d.handleKeyDown=d.handleKeyDown.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){this.props.extraOptions&&this.props.extraOptions.stickyNote&&$(ReactDOM.findDOMNode(this.refs.title)).on("mousedown",function(a){a.stopPropagation()})}},{key:"handleSetTitle",value:function(a){var b=this.props.extraOptions&&this.props.extraOptions.stickyNote;a.target.textContent.trim().length||$(ReactDOM.findDOMNode(this.refs.title)).text(""),this.props.note.saveTitle(a.target.textContent,{sticky:b})}},{key:"handleKeyDown",value:function(a){13===a.keyCode&&(a.preventDefault(),ReactDOM.findDOMNode(this.props.parent.refs.desc.refs.content).focus())}},{key:"render",value:function(){var a=zNote.notei18n.placeholder.title,b=Boolean(this.props.extraOptions&&this.props.extraOptions.stickyNote);"new"===this.props.note.get("type")||!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&this.props.note.get("ownerZUID")===zmail.zuid||(b=!1);var c=this.props.note.get("title")&&this.props.note.get("title")!==znBox.CONTS.defaultTitle?znBox.spCharRep(this.props.note.get("title")):"";return React.createElement("div",{className:"zn_tit",contentEditable:b,ref:"title",onBlur:this.handleSetTitle,onKeyDown:this.handleKeyDown,"data-plhr":a},c)}}]),b}(React.Component),l=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.showMoreOptions=d.showMoreOptions.bind(d),d.setAttributes=d.setAttributes.bind(d),d.attObj={tempLocation:[],myAttachment:[]},d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.showmoreicon,text:zNote.notei18n.tooltips.moreOptions,arrow:"top"})}},{key:"popupClick",value:function(a){znBox.hideMenu();var b={},c=this;switch(a.action){case"addAttach":this.addAttachment();break;case"stickyNote":zNote.addAsStickyNote(this.props.note.toJSON());break;case"addTag":this.props.parent.refs.tag.addLabel(ReactDOM.findDOMNode(this.props.parent.refs.showmore));break;case"sendMail":this.props.note.sendAsMail();break;case"delNote":b.onOk=function(){c.props.note.deleteNote(c.props.note.get("id"))},b.stopPropagation=!0,zmsDialog.confirm(zNote.notei18n.confirmMsg.delNote,b);break;case"copyNote":znBox.copyNote({title:this.props.note.get("title"),catId:this.props.note.get("cat"),namespaceId:this.props.note.get("namespaceId"),comments:!0},this.props.note.postAsNew.bind(this.props.note),{type:"copyNote"});break;case"moveNote":znBox.copyNote({title:this.props.note.get("title"),catId:this.props.note.get("cat"),namespaceId:this.props.note.get("namespaceId"),comments:!0},this.props.note.changeGroup.bind(this.props.note),{type:"moveNote"});break;case"print":zNote.printNote({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")});break;case"openintab":zNote.openNoteInTab({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")})}}},{key:"addAttachment",value:function(){var a=this;if(a.attRefObj)a.attRefObj.init();else{var b={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(a.props.parent.refs.attDiv)),updateVirus:function(b){a.handleUpdateVirus(b)},onAllUploadFinish:{handler:function(b){a.saveVirusPendingAttachments(b),a.props.note.saveAttachment(b)},resetData:!0,removeAttachDOM:!0}};zmUtil.initAttachComponent(b,function(b){a.attRefObj=b})}}},{key:"setAttributes",value:function(){$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","true")}},{key:"saveVirusPendingAttachments",value:function(a){if(a.tempLocation.length)for(var b=a.tempLocation.slice(),c=0;c<b.length;c++)"pending"!==b[c].virusFree&&b[c].virusFree!==!1||this.attObj.tempLocation.push(b[c])}},{key:"handleUpdateVirus",value:function(a){for(var b=this,c=this.attObj.tempLocation.length,d={tempLocation:[],myAttachment:[]},e=0;e<c;e++)this.attObj.tempLocation[e].fP===a.fp&&(this.attObj.tempLocation[e].virusFree=a.value,d.tempLocation.push(this.attObj.tempLocation[e]),this.attObj.tempLocation.splice(e,1));b.props.note.saveAttachment(d)}},{key:"showMoreOptions",value:function(a){a.stopPropagation();var b=this,c="zn_popOver",d={},e=[],f=zmCont.getGroup()[this.props.note.get("namespaceId")],g=znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")});if(d.addAttach={htm:zNote.notei18n.note.addAttach,data:{action:"addAttach"}},d.sendMail={htm:zNote.notei18n.note.sendMail,data:{action:"sendMail"}},d.makeSticky={htm:zNote.notei18n.note.makeSticky,data:{action:"stickyNote"}},d.printNote={htm:zNote.notei18n.note.printNote,data:{action:"print"}},d.openInTab={htm:zNote.notei18n.note.openTab,data:{action:"openintab"}},d.copyNote={htm:zNote.notei18n.note.copyNote,data:{action:"copyNote"}},d.moveNote={htm:zNote.notei18n.note.moveNote,data:{action:"moveNote"}},d.delNote={htm:zNote.notei18n.note.delNote,data:{action:"delNote"}},d.separator={sep:!0},(znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})||this.props.note.get("ownerZUID")!==zmail.zuid)&&(d.addAttach.state="disabled",d.addAttach.nohover=!0,(znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})||!zmCont.getGroup()[this.props.note.get("namespaceId")]||zmCont.getGroup()[this.props.note.get("namespaceId")]&&!zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(d.delNote.state="disabled",d.delNote.nohover=!0)),"disabled"!==d.addAttach.state&&e.push(d.addAttach),e.push(d.sendMail),e.push(d.openInTab),(f||this.props.note.get("namespaceId")===zmail.zuid)&&e.push(d.copyNote),!g&&(this.props.note.get("ownerZUID")===zmail.zuid||f&&f.isOwner)&&e.push(d.moveNote),this.props.extraOptions&&this.props.extraOptions.stickyNote||znBox.removeStickyIcon()||e.push(d.makeSticky),e.push(d.printNote),"disabled"!==d.delNote.state&&(e=e.concat([d.separator,d.delNote])),this.props.extraOptions&&this.props.extraOptions.stickyNote&&(c+=" zmArmZI"),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")){var h={par:a.target,showArrow:!0,spanClass:c,list:e,direction:"bottom",clk:function(a,c){$(c).hasClass("SC_op3")||b.popupClick(a)}};zmsuite.showMenu(h),$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")}}},{key:"render",value:function(){var a=this;if("new"===this.props.note.get("type"))return null;var b=function(){return function(b){a.showMoreOptions(b)}},c=function(){return function(b){a.setAttributes(b)}};return React.createElement("li",{ref:"showmoreicon",onClick:b(),onMouseDown:c()},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nmore"}))))}}]),b}(React.Component),m=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"viewImage",value:function(a,b,c){c.stopPropagation();var d=this,e=znBox.getAttSlideArray(this.props.note.get("attachments"),this.props.note.get("id"),this.props.note.get("namespaceId")),f={},g={},h=[];g.trash={"class":"msi-trash",title:zNote.notei18n.tooltips.deleteAttach,after:".msi-download",events:[{name:"click",listener:function(a,b,c){d.props.note.delAtt(b.e,b.Id,c)}}]},h.push("#etyIcon"),f.extraIcons=g,f.hideOptions=h,zmUtil.initAttSlideShow(e,b,!1,f)}},{key:"render",value:function(){var a,b,c=this;if(!this.props.note.get("attachments")||!this.props.note.get("attachments").length)return React.createElement("div",{ref:"attach",className:"zn_clear zn_attach SC_dyn"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})));var d=function(a,b){return function(d){c.viewImage(a,b,d)}};return React.createElement("div",{className:"zn_folder zn_clear zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})),this.props.note.get("attachments").map(function(e,f){var g=e[Object.keys(e)[0]],h=zmUtil.fileTyp(g.fn);if("msi-attimg"===h[1])a=c.props.note.get("namespaceId")===zmail.zuid?zmail.conPath+"/FileDownload?attachId="+g.Id+"&entityType=2&entityId="+c.props.note.get("id")+"&groupId="+c.props.note.get("namespaceId")+"&mode=thb&app=notes":zmail.conPath+"/FileDownload?attachId="+g.Id+"&entityType=2&entityId="+c.props.note.get("id")+"&groupId="+c.props.note.get("namespaceId")+"&streamsView=Notes&actionType=viewGroupEntity&mode=thb&app=notes",b=React.createElement("img",{src:a});else{var i=h[1]+" zm-attIcn";b=React.createElement("i",{className:i})}return React.createElement("div",{className:"zmL zmAch",key:g.Id,title:g.fn,onClick:d(g,f)},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},b))))}))}}]),b}(React.Component)}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteCollectionReact=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.initializeValue(),d.handleZIndex=d.handleZIndex.bind(d),d.incrementTopLeft=d.incrementTopLeft.bind(d),d.getAvailableTopLeft=d.getAvailableTopLeft.bind(d),d.incrementZIndex=d.incrementZIndex.bind(d),d.getAddNote=d.getAddNote.bind(d),d.getOpenNote=d.getOpenNote.bind(d),d.setOpenNote=d.setOpenNote.bind(d),d.openStickyNote=d.openStickyNote.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidUpdate",value:function(){(!this.props.noteList.listInfo||this.props.noteList.listInfo&&"stickyNote"!==this.props.noteList.listInfo.mode)&&this.props.noteList.length&&znBox.setTopLeft(!1,!0,this.props.noteList.mountingElem)}},{key:"componentDidMount",value:function(){var a=this;this.props.noteList.on("change",function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znBox.setTopLeft(!1,!0,this.props.noteList.mountingElem)}.bind(this)),this.props.noteList.on("reset",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("change:renamenotecat",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("remove",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("add",function(){this.forceUpdate()}.bind(this)),setTimeout(function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znBox.setTopLeft(!1,!1,a.props.noteList.mountingElem)},100),setTimeout(function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znBox.setTopLeft(!1,!1,a.props.noteList.mountingElem)},10),a.props.noteList.listInfo&&"stickyNote"===a.props.noteList.listInfo.mode&&(zNote.eventBus.on("openStickyNote",this.openStickyNote,this),this.props.noteList.on("change:showStickyNote",function(){this.forceUpdate()}.bind(this)))}},{key:"initializeValue",value:function(){this.top=this.top||30,this.left=this.left||30,this.maxZIndex=this.maxZIndex||2,this.color=_.random(0,3),this.newNoteModel=new zNote.Models.addNote({attrs:{color:self.color}}),zNote.addNoteDS(this.newNoteModel)}},{key:"openStickyNote",value:function(a){var b=this.props.noteList.get(a.id);b&&(b.get("showStickyNote")===!0?b.trigger("change:addedagain"):b.showNote(!0))}},{key:"getAvailableTopLeft",value:function(){var a=this.top,b=this.left;this.incrementTopLeft(),this.top>document.body.clientHeight-400&&(this.top=30),this.left>document.body.clientWidth-400&&(this.left=30);var c=this.maxZIndex;return this.maxZIndex<100&&this.incrementZIndex(),{top:a,left:b,zIndex:c}}},{key:"getCurrentTopLeft",value:function(){var a=this.top,b=this.left;return{top:a,left:b}}},{key:"componentWillUnmount",value:function(){this.props.noteList.stopSubscriptions()}},{key:"incrementZIndex",value:function(){this.maxZIndex=this.maxZIndex+1}},{key:"incrementTopLeft",value:function(){this.top=this.top+60,this.left=this.left+30}},{key:"handleZIndex",value:function(a){this.maxZIndex>=99&&(this.props.noteList.each(function(a){a.set({zIndex:1})}),this.maxZIndex=2),a.get("zIndex")+1!==this.maxZIndex&&(a.set({zIndex:this.maxZIndex}),this.incrementZIndex())}},{key:"appendList",value:function(){this.props.noteList.concat()}},{key:"setOpenNote",value:function(a){this.previewId=a}},{key:"getOpenNote",value:function(){return this.previewId||""}},{key:"noteView",value:function(a,b){this.noteViewList=this.noteViewList||{},this.noteViewList[b.get("id")]=a}},{key:"noteViewList",value:function(){return this.noteViewList}},{key:"getTopLeft",value:function(a){var b=this.noteViewList[a].top,c=this.noteViewList[a].left;return{top:b,left:c}}},{key:"getWidthHeight",value:function(a){var b=this.noteViewList[a].width,c=this.noteViewList[a].getDescriptionHeight();return{width:b,height:c}}},{key:"getAddNote",value:function(){var a,b;this.props.noteList.listInfo&&"zn_catAll"!==this.props.noteList.listInfo.id&&"c"===this.props.noteList.listInfo.mode?(a=this.props.noteList.listInfo.id,b=this.props.noteList.listInfo.groupId):"zn_catAll"===this.props.noteList.listInfo.id?(a=znBox.getGeneralCatId(this.props.noteList.listInfo.groupId),b=this.props.noteList.listInfo.groupId):(a=znBox.getGeneralCatId(zmail.zuid),b=zmail.zuid);var c=$(ReactDOM.findDOMNode(this.noteViewList[this.props.noteList.models[0].get("id")])),d=$(ReactDOM.findDOMNode(this.refs.quickAdd)),e={
add:{top:c.offset().top,left:c.offset().left,height:c.height(),width:c.width()},cancel:{top:d.offset().top,left:d.offset().left,height:d.height(),width:d.width()}};zNote.addNote({catId:a,color:this.color,namespaceId:b,addparams:{actionSrc:"quickadd"}},e)}},{key:"render",value:function(){var a,b,c,d,e=this,f=this.props.extraOptions,g=this.props.noteList.listInfo.mode;b="byuser"===g||"sharedtome"===g||"archive"===g||znBox.checkForGroupDisabled({groupId:this.props.noteList.listInfo.groupId})?{__html:zmText.safeText(zNote.notei18n.nonotesavailable)}:"search"===g?{__html:zmText.safeText(zNote.notei18n.nosearchnotes)}:{__html:zmText.get("noteutil","nonotescreate",{create:"<font onClick={znNote.createInlineNotes()}>"+zmText.safeText(zNote.notei18n.create)+"</font>"})},f&&(c=this.handleZIndex,d=this.getAvailableTopLeft),this.color=_.random(0,3),this.newNoteModel.set({color:e.color});var h=function(a){return function(b){e.noteView(b,a)}};if(this.props.noteList.length)return React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},function(){return znBox.checkForQuickAdd(e.props.noteList.listInfo)?React.createElement(zNote.Views.addNoteViewReact,{ref:"quickAdd",note:e.newNoteModel,options:{quickAdd:!0,addCallback:e.getAddNote}}):null}(),this.props.noteList.map(function(b){return a=b.get("oldId")||b.get("id"),b.get("showStickyNote")===!1?null:React.createElement(zNote.Views.NoteViewReact,{note:b,ref:h(b),extraOptions:f,handleOnOpenNote:e.setOpenNote,openedNote:e.getOpenNote,getAvailableTopLeft:d,handleZIndex:c,readMode:e.props.readMode,key:a,mountingElem:e.props.noteList.mountingElem})}));var i="stickyNote"===g?"SC_nmsg SC_dyn":"SC_nmsg";return React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:i,dangerouslySetInnerHTML:b}))}}]),b}(React.Component)}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteListView=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleViewNote=d.handleViewNote.bind(d),d.handleOpenNote=_.debounce(d.handleViewNote,1e3,{leading:!0}),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"handleViewNote",value:function(){"stickyNote"===this.props.note.collection.listInfo.mode?zNote.eventBus.trigger("openStickyNote",{namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}):"noteApp"===this.props.note.collection.listInfo.source?(this.props.openNoteInPreviewCard({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}),$(ReactDOM.findDOMNode(this.refs.notelist)).addClass("zmSLst")):zNote.loadAndOpenNote({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")},{type:"popup"})}},{key:"componentDidMount",value:function(){var a=this;this.props.note.on("change",function(){this.forceUpdate()}.bind(this)),this.props.note.get("newNote")&&(this.props.note.set("newNote",void 0),$(ReactDOM.findDOMNode(a.refs.notelist)).addClass("highlightClass"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notelist)).removeClass("highlightClass")},3e3))}},{key:"componentWillUnmount",value:function(){this.props.note.stopSubscriptions()}},{key:"render",value:function(){var a="zmImg SC_link "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")],b=this.props.note.get("summary")&&this.props.note.get("summary").length?this.props.note.get("summary").trim().slice(0,1):"",c=this.props.note.get("title")&&this.props.note.get("title").length?this.props.note.get("title").slice(0,1):b;return React.createElement("div",{className:"zmL zmAch zm_urd",ref:"notelist",onClick:this.handleOpenNote},React.createElement("div",{className:"zmLst"},React.createElement(zNote.Views.NoteListView.Left,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:a},React.createElement("span",null,c)),React.createElement(zNote.Views.NoteListView.Creator,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement("div",{className:"zmFrm"},React.createElement(zNote.Views.NoteListView.CommentIndicator,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement("span",{placeholder:zNote.notei18n.placeholder.title},znBox.spCharRep(this.props.note.get("title"))),React.createElement(zNote.Views.NoteListView.Description,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement("div",{className:"zmDate"},React.createElement("span",null,this.props.note.get("disptime"))),React.createElement("div",{className:"zmFdr"},React.createElement("span",null,React.createElement(zNote.Views.NoteListView.Color,{extraOptions:this.props.extraOptions,note:this.props.note,parent:this}),React.createElement(zNote.Views.NoteListView.Sticky,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.ArchiveUnArchive,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.ShowMore,{extraOptions:this.props.extraOptions,note:this.props.note,parent:this}))),React.createElement("div",{className:"zmSub"},React.createElement(zNote.Views.NoteListView.AttachIndicator,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.Book,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement("div",{className:"SC_icn"},React.createElement(zNote.Views.NoteListView.Delete,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement(zNote.Views.NoteListView.Tags,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement(zNote.Views.NoteListView.Right,{extraOptions:this.props.extraOptions,note:this.props.note})))}}]),b}(React.Component),zNote.Views.NoteListView.Left=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"render",value:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("div",{className:"zmFlt"},React.createElement(zNote.Views.NoteListView.Favourite,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.AssociatedMail,{extraOptions:this.props.extraOptions,note:this.props.note}))}}]),b}(React.Component),zNote.Views.NoteListView.Description=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"getSummary",value:function(){return this.props.note.get("summary")&&this.props.note.get("summary").length?this.props.note.get("summary"):""}},{key:"render",value:function(){return React.createElement("span",{className:"sum"}," - ",znBox.spCharRep(this.getSummary()))}}]),b}(React.Component),zNote.Views.NoteListView.Title=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"render",value:function(){var a=znBox.spCharRep(znBox.getTextContentFromHTML(this.props.note.get("desc")));return React.createElement("span",{className:"sum"}," - ",a)}}]),b}(React.Component),zNote.Views.NoteListView.Delete=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleDeleteNote=d.handleDeleteNote.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.deleteIcon,text:zNote.notei18n.tooltips.deleteNote,arrow:"top"})}},{key:"handleDeleteNote",value:function(a){var b=this,c={};a.stopPropagation(),c.onOk=function(){b.props.note.deleteNote(b.props.note.get("id"))},c.stopPropagation=!0,zmsDialog.confirm(zNote.notei18n.confirmMsg.delNote,c)}},{key:"render",value:function(){return this.props.note.get("ownerZUID")!==zmail.zuid||"mailassociated"===this.props.extraOptions.id||znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-trash",ref:"deleteIcon",onClick:this.handleDeleteNote})}}]),b}(React.Component),zNote.Views.NoteListView.AssociatedMail=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleViewAssociatedMail=d.handleViewAssociatedMail.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})}},{key:"handleViewAssociatedMail",value:function(a){var b={};a.stopPropagation(),this.props.note.get("email").accid!==zmail.accId&&(b={actionType:"viewGroupMailEntity",entityId:this.props.note.get("notes").email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("namespaceId"),accId:this.props.note.get("email").accid}),zmList.getMailData({msgId:this.props.note.get("email").msgid,opentype:2,type:"lt",src:"external",eprm:b})}},{key:"render",value:function(){return!this.props.note.get("email")||$.isEmptyObject(this.props.note.get("email"))||"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-mailopen",ref:"mailopen",onClick:this.handleViewAssociatedMail})}}]),b}(React.Component),zNote.Views.NoteListView.ArchiveUnArchive=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleArchive=d.handleArchive.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this.props.note.get("archived")?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"componentDidUpdate",value:function(){var a=this.props.note.get("archived")?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"handleArchive",value:function(a){a.stopPropagation();var b=!this.props.note.get("archived");this.props.note.archiveOrUnarchiveNote({archived:b})}},{key:"render",value:function(){var a=this.props.note.get("archived")?"msi-unarchive":"msi-archive",b=!1;return!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&(this.props.note.get("ownerZUID")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(b=!0),znBox.isArchiveOpen()&&b&&"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode?React.createElement("i",{ref:"archive",className:a,onClick:this.handleArchive}):null}}]),b}(React.Component),zNote.Views.NoteListView.CommentIndicator=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})}},{key:"render",value:function(){return"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode&&this.props.note.get("commentCount")&&0!==this.props.note.get("commentCount")?React.createElement("div",{className:"zmInfo"},React.createElement("span",{className:"zmThmClr zmCmntCt",title:zNote.notei18n.info.commentsavailable},this.props.note.get("commentCount"),React.createElement("i",{className:"msi-lcmnt"}))):null}}]),b}(React.Component),zNote.Views.NoteListView.AttachIndicator=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleShowAttachments=d.handleShowAttachments.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"handleShowAttachments",value:function(a){var b=this;a.stopPropagation();var c=this.props.note.get("attachments").map(function(a){var c=a[Object.keys(a)[0]];return c.e=b.props.note.get("id"),c.et=zNote.CONSTANTS.entityType,c.gId=b.props.note.get("namespaceId"),c}),d={app:"compose",attList:c,supportDrag:!0},e='<div class="SCmb puClose"><ul><li><b><div class="SC_hd"></div><span class="SC_ttip ttr" data-tooltip="Close"><i class="msi-close" data-msg="close"></i></span></b></li></ul></div>',f='<li class="nohr"></li>',g='<div class="SC_tp10"> '+zmText.applyArgs("{{count}} Attachments",{count:c.length})+"</div>",h=$(f);h.append(zmAttach.build(d)),h.find(".zmPAtt").prepend(g),h.append(e);var i={par:ReactDOM.findDOMNode(this.refs.attachicon),showArrow:!0,liDom:h,spanClass:"zm_attPop minwid zmAtt_mulMail",clk:function(a,b){}};zmsuite.showMenu(i),h.find(".msi-close").click(function(){$("#zm_dropDown").remove()})}},{key:"render",value:function(){return this.props.note.get("attachments")&&this.props.note.get("attachments").length&&"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode?React.createElement("i",{className:"msi-attachicon",ref:"attachicon",onClick:this.handleShowAttachments}):null}}]),b}(React.Component),zNote.Views.NoteListView.Book=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleChangeBook=d.handleChangeBook.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){this.props.note.get("ownerZUID")===zmail.zuid&&zmComponent.tooltip({elm:this.refs.book,text:zNote.notei18n.tooltips.moveNote,arrow:"top"})}},{key:"changeGroup",value:function(a){if(this.props.note.get("ownerZUID")===zmail.zuid){var b;a.stopPropagation();var c=znBox.getGroupArray(),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.group),e.displayAs="popup",e.showCreate=!0,e.onSelect=function(a){d.props.note.changeGroup(a),b.hide()},e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},b=zmUtil.createFLComp("group",e),b.show()}}},{key:"handleChangeBook",value:function(a){if(!this.props.extraOptions||"stickyNote"!==this.props.extraOptions.mode){var b=!1;if(!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&(this.props.note.get("ownerZUID")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(b=!0),b){a.stopPropagation();var c,d=znBox.getCategoryArray(this.props.note.get("namespaceId")),e=this,f={};f.parentDOM=ReactDOM.findDOMNode(this.refs.book),f.displayAs="popup",f.onSelect=function(a){e.props.note.changeBook(a),c.hide()},(this.props.note.get("namespaceId")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(f.onCreate=function(a){znBox.sendNewCatReq(a,{},e.props.note.get("namespaceId")).done(function(a){e.props.note.changeBook(a[1][0].catId),c.hide()})}),f.onHide=function(){$("#zm_dropDown").remove()},f.dataCallback=function(){return d},c=zmUtil.createFLComp("category",f),c.show()}}}},{key:"render",value:function(){var a=znBox.getGroupName(this.props.note.get("namespaceId")),b=zNote.getNamefrmCatObj(this.props.note.get("cat"),this.props.note.get("namespaceId"));return""===a?null:React.createElement("span",{className:"zm_grp"},React.createElement("span",{ref:"group"},a),React.createElement("i",{className:"msi-rarrow"}),React.createElement("span",{ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},b))}}]),b}(React.Component),zNote.Views.NoteListView.Favourite=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetFavourite=d.handleSetFavourite.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})}},{key:"handleSetFavourite",value:function(a){a.stopPropagation(),this.props.note.saveFavourite()}},{key:"render",value:function(){var a=this.props.note.get("starred")?"msi-fav SC_fav":"msi-fav";return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:a,onClick:this.handleSetFavourite,ref:"star"})}}]),b}(React.Component),zNote.Views.NoteListView.Sticky=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetAttributes=d.handleSetAttributes.bind(d),d.handleMakeSticky=d.handleMakeSticky.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.sticky,text:zNote.notei18n.note.makeSticky,arrow:"top"})}},{key:"handleMakeSticky",value:function(a){a.stopPropagation(),zNote.addAsStickyNote(this.props.note.toJSON())}},{key:"handleSetAttributes",value:function(a){$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible","true")}},{key:"render",value:function(){return znBox.removeStickyIcon()||"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-stiNotes",ref:"sticky",onMouseDown:this.handleSetAttributes,onClick:this.handleMakeSticky})}}]),b}(React.Component),zNote.Views.NoteListView.Creator=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this;zmail.ContactBook.get({zuid:a.props.note.get("ownerZUID")}).done(function(b){var c=b[0];c&&c.attrs&&c.attrs.fn&&(zmComponent.tooltip({elm:a.refs.creator,text:c.attrs.fn,arrow:"top"}),$(ReactDOM.findDOMNode(a.refs.creatorname)).text(c.attrs.fn))})}},{key:"render",value:function(){var a="zmSze";return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode||"c"===this.props.extraOptions.mode&&this.props.extraOptions.groupId===zmail.zuid?React.createElement("div",{className:a,ref:"creator"}):React.createElement("div",{className:a,ref:"creator"},React.createElement("span",{className:"sum SC_thm",ref:"creatorname"}))}}]),b}(React.Component),zNote.Views.NoteListView.Color=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetColor=d.handleSetColor.bind(d),d.handleSetAttributes=d.handleSetAttributes.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})}},{key:"handleSetColor",value:function(a){a.stopPropagation();var b=this;if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');c.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className]),$(ReactDOM.findDOMNode(b.props.parent.refs.notelist)).addClass("sel")})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notelist)).addClass("sel"),$(ReactDOM.findDOMNode(this.refs.palette)).addClass("active")}},{key:"handleSetAttributes",value:function(a){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")}},{key:"render",value:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode||znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})?null:this.props.note.get("ownerZUID")!==zmail.zuid&&zmCont.getGroup()[this.props.note.get("namespaceId")]&&!zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner?null:React.createElement("i",{className:"msi-nclr",ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor})}}]),b}(React.Component),zNote.Views.NoteListView.ShowMore=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.showmoreicon,text:zNote.notei18n.tooltips.moreOptions,arrow:"top"})}},{key:"popupClick",value:function(a){switch(znBox.hideMenu(),a.action){case"addTag":this.props.parent.refs.tag.addLabel(ReactDOM.findDOMNode(this.props.parent.refs.showmore));break;case"sendMail":this.props.note.sendAsMail();break;case"delNote":this.props.note.deleteNote(this.props.note.get("id"));break;case"print":zNote.printNote({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")});break;case"openintab":zNote.openNoteInTab({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")});break;case"copyNote":znBox.copyNote({title:this.props.note.get("title"),catId:this.props.note.get("cat"),namespaceId:this.props.note.get("namespaceId"),comments:!0},this.props.note.postAsNew.bind(this.props.note),{type:"copyNote"});break;case"moveNote":znBox.copyNote({title:this.props.note.get("title"),catId:this.props.note.get("cat"),namespaceId:this.props.note.get("namespaceId"),comments:!0},this.props.note.changeGroup.bind(this.props.note),{type:"moveNote"})}}},{key:"addAttachment",value:function(){var a=this;if(a.attRefObj)a.attRefObj.init();else{var b={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(a.props.parent.refs.attDiv)),onAllUploadFinish:{handler:function(b){a.props.note.saveAttachment(b)},resetData:!0,removeAttachDOM:!0}};zmUtil.initAttachComponent(b,function(b){a.attRefObj=b})}}},{key:"setAttributes",value:function(){$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","true")}},{key:"showMoreOptions",value:function(a){a.stopPropagation();var b,c,d=this,e={};e.sendMail={htm:zNote.notei18n.note.sendMail,data:{action:"sendMail"}},e.printNote={htm:zNote.notei18n.note.printNote,data:{action:"print"}},e.copyNote={htm:zNote.notei18n.note.copyNote,data:{action:"copyNote"}},e.moveNote={htm:zNote.notei18n.note.moveNote,data:{action:"moveNote"}},e.openInTab={htm:zNote.notei18n.note.openTab,data:{action:"openintab"}};var f=[e.sendMail,e.printNote];if(f.push(e.openInTab),c=znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")}),b=zmCont.getGroup()[this.props.note.get("namespaceId")],(b||this.props.note.get("namespaceId")===zmail.zuid)&&f.push(e.copyNote),!c&&(this.props.note.get("ownerZUID")===zmail.zuid||b&&b.isOwner)&&f.push(e.moveNote),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")){var g={par:a.target,showArrow:!0,list:f,direction:"bottom",clk:function(a,b){$(b).hasClass("SC_op3")||d.popupClick(a)}};zmsuite.showMenu(g),$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notelist)).addClass("sel")}}},{key:"render",value:function(){var a=this;if("mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode)return null;var b=function(){return function(b){a.showMoreOptions(b)}},c=function(){return function(b){a.setAttributes(b)}};return React.createElement("i",{className:"msi-nmore",ref:"showmoreicon",onClick:b(),onMouseDown:c()})}}]),b}(React.Component),zNote.Views.NoteListView.Tags=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.addLabel=d.addLabel.bind(d),d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"componentDidMount",value:function(){var a=this.refs.labelDet;zmComponent.tooltip({elm:a,text:zNote.notei18n.note.addTag,arrow:"top"})}},{key:"addLabel",value:function(a,b){a.stopPropagation();var c,d=this,e={};e.parentDOM=this.refs.labelDet?ReactDOM.findDOMNode(this.refs.labelDet):b,e.displayAs="popup",e.labelState={labelList:this.props.note.get("tagId")},e.showCreate=!0,e.accType="default",e.onHide=function(){$("#zm_dropDown").remove()},e.onCreate=function(a,b){znBox.sendNewLabReq(a,b).done(function(a){a&&1===a[0]&&a[1].labelId&&(c.hide(),d.props.note.addTag(a[1].labelId))})},e.onStateChange=function(a,b){b?d.props.note.addTag(a):d.props.note.removeTag(a)},c=zmUtil.createFLComp("label",e),c.show()}},{key:"render",value:function(){var a={backgroundColor:""},b=this;if(!this.props.note.get("tagId")||!this.props.note.get("tagId").length||"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode)return null;var c=function(a){return function(c){b.addLabel(c,a)}};return b.props.note.get("tagId")&&b.props.note.get("tagId").length>0?React.createElement("div",{className:"zm_lbl",ref:"labelDet"},React.createElement("div",{className:"zmLblGrp zmViewLtdLbl"},b.props.note.get("tagId").map(function(b){return!!zmUtil.getTagList("default")[b]&&(a={backgroundColor:zmUtil.getTagList("default")[b].color},React.createElement("div",{className:"zmLbl",title:zmUtil.getTagList("default")[b].label,onClick:c()},React.createElement("span",{style:a})))}))):void 0}}]),b}(React.Component),zNote.Views.NoteListView.Right=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"render",value:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("div",{className:"zmFrt"})}}]),b}(React.Component)}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteListCollectionView=function(a){function b(a,c){babelHelpers.classCallCheck(this,b);var d=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleOpenNoteInPreviewcard=d.handleOpenNoteInPreviewcard.bind(d),d.handleAddNote=d.handleAddNote.bind(d),d.noteOnDelete=d.noteOnDelete.bind(d),d.selectedSticky={},d}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:"initializeValue",value:function(){this.color=_.random(0,3);var a,b;this.props.noteList.listInfo&&"zn_catAll"!==this.props.noteList.listInfo.id&&"c"===this.props.noteList.listInfo.mode?(a=this.props.noteList.listInfo.id,b=this.props.noteList.listInfo.groupId):"zn_catAll"===this.props.noteList.listInfo.id?(a=znBox.getGeneralCatId(this.props.noteList.listInfo.groupId),b=this.props.noteList.listInfo.groupId):(a=znBox.getGeneralCatId(zmail.zuid),b=zmail.zuid),this.newNoteModel=new zNote.Models.addNote({attrs:{namespaceId:b,catId:a,color:this.color}}),zNote.addNoteDS(this.newNoteModel)}},{key:"componentDidMount",value:function(){this.props.noteList.on("add",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("remove",function(){this.forceUpdate()}.bind(this)),zNote.eventBus.on("removeMask",this.checkAndClosePreview,this),this.newNoteModel&&this.newNoteModel.on("change",function(a){void 0!==a.changed.color&&this.forceUpdate()}.bind(this)),$.subscribe("/note/delete",this.noteOnDelete)}},{key:"componentWillUnmount",value:function(){zNote.eventBus.off("removeMask",this.checkAndClosePreview,this),this.closePreview(),$.unsubscribe("/note/delete",this.noteOnDelete),this.props.noteList.stopSubscriptions()}},{key:"checkAndClosePreview",value:function(a){this.openPreviewNoteData&&a&&a[0]&&this.openPreviewNoteData.id===a[0].id&&this.openPreviewNoteData.namespaceId===a[0].namespaceId&&this.closePreview()}},{key:"closePreview",value:function(){if("noteApp"===this.props.noteList.listInfo.source){var a=zmsuite.getCenter("zm_notes"),b=a[0].getNodes(),c=a[1].getNodes();c[1].$el.find(".postMsg").length&&ReactDOM.unmountComponentAtNode(c[1].$el.find(".postMsg")[0]),c[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(c[0].$el.find(".noteHeader")[0]),b[2].$el.find(".zmSLst").removeClass("zmSLst"),zmsuite.getCenter("zm_notes")[1].close(),this.openPreviewNoteData={}}}},{key:"noteOnDelete",value:function(a,b,c){this.openPreviewNoteData&&this.openPreviewNoteData.id===b&&this.openPreviewNoteData.namespaceId===c&&this.closePreview()}},{key:"handleStickyListSelection",value:function(a){var b=void 0===this.selectedSticky.index?-1:this.selectedSticky.index;"downArrow"===a?(b=b===this.props.noteList.length-1?0:b+1,this.selectedSticky={index:b,model:this.props.noteList.at(b)},$(this.noteViewList[this.props.noteList.at(b).get("id")].refs.notelist).addClass("zmSLst")):"upArrow"===a?(b=0===b?0:b-1,this.selectedSticky={index:b,model:this.props.noteList.at(b)},$(this.noteViewList[this.props.noteList.at(b).get("id")].refs.notelist).addClass("zmSLst")):"enter"===a?this.noteViewList[this.props.noteList.at(b).get("id")].handleViewNote():"initial"===a&&(this.selectedSticky={index:b+1,model:this.props.noteList.at(b+1)},$(this.noteViewList[this.props.noteList.at(b+1).get("id")].refs.notelist).addClass("zmSLst"))}},{key:"noteView",value:function(a,b){this.noteViewList=this.noteViewList||{},this.noteViewList[b.get("id")]=a}},{key:"getHeaderIcons",value:function(){var a="",b=[];zmail.isOrg&&zmUtil.isChatletEnabled()&&b.push({tooltip:zmText.get("topMenus").menus.chatlet,html:[["I",{attrs:{"class":"msi-cliqColor"},child:[["I",{attrs:{"class":"path1"}}],["I",{attrs:{"class":"path2"}}]]}]],data:"chatlet"}),b.push({tooltip:zNote.notei18n.tooltips.moreOptions,iconClass:"msi-action",data:"action"}),b.push({tooltip:zNote.notei18n.preview.previous,iconClass:"msi-prev",data:"prev"}),b.push({tooltip:zNote.notei18n.preview.next,iconClass:"msi-next",data:"next"}),b.push({tooltip:zNote.notei18n.preview.close,
iconClass:"msi-close",data:"close"});var c={text:a,rIcons:[b]};return c}},{key:"handleAddNote",value:function(){zNote.loadAddNote({addparams:{msgid:this.props.noteList.listInfo.msgid,senderid:this.props.noteList.listInfo.senderid,accid:this.props.noteList.listInfo.accid}})}},{key:"handleOpenNoteInPreviewcard",value:function(a){var b,c,d,e,f,g,h,i=this,j=zmsuite.getCenter("zm_notes"),k=j[1].getNodes(),l=j[0].getNodes();l[2].$el.find(".zmSLst").removeClass("zmSLst"),k[1].$el.find(".postMsg").length&&ReactDOM.unmountComponentAtNode(k[1].$el.find(".postMsg")[0]),k[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(k[0].$el.find(".noteHeader")[0]),k[1].$el.html(""),k[1].$el.empty(),this.openPreviewNoteData=a,d=i.props.noteList.where({id:i.openPreviewNoteData.id,namespaceId:i.openPreviewNoteData.namespaceId})[0],e=i.props.noteList.indexOf(d);var m=this.getHeaderIcons();k[0].push(m),k[0].setListener("click",function(b,c){if("action"===b||"msi-action"===b.action){var d=zmStreamsApp.util.getDropdownMenu(a.namespaceId+"#"+a.id,zNote.CONSTANTS.entityType);$(c).closest("b").addClass("SC_ddn");var g={par:$(c).closest("b")[0],list:d,dir:"top",align:"pright",spanClass:"SC_dd",defaultclass:!1,clk:function(a,b){znBox.hideMenu(),a.fn()}};zmsuite.showMenu(g)}else if("close"===b||"clsPrev"===b.action)l[2].$el.find(".zmSLst").removeClass("zmSLst"),i.closePreview();else if("prev"===b||"msi-prev"===b.action)f=i.props.noteList.at(e-1),i.noteViewList[f.get("id")].handleViewNote(),$(ReactDOM.findDOMNode(i.noteViewList[f.get("id")].refs.notelist))[0].scrollIntoView(!1);else if("next"===b||"msi-next"===b.action)f=i.props.noteList.at(e+1),i.noteViewList[f.get("id")].handleViewNote(),$(ReactDOM.findDOMNode(i.noteViewList[f.get("id")].refs.notelist))[0].scrollIntoView(!1);else if("chatlet"===b||"chatlet"===b.action){var j=h&&h.get("gnrl")?h.get("gnrl").by:"";znBox.invokeChatlet(c,{id:a.id,namespaceId:a.namespaceId,ownerZUID:j})}}),j[1].show(),j[1].$el.addClass("zn_pv"),0===e&&k[0].$el.find(".msi-prev").closest("li").addClass("SC_opy3 SC_nopntr"),e===i.props.noteList.length-1&&k[0].$el.find(".msi-next").closest("li").addClass("SC_opy3 SC_nopntr");var n=zmComponent.loadingBand({container:k[1].$el[0],type:"pagination"});zNote.getNoteDetails(a).done(function(a){if(0!==a[0]){b=a[1];var d=$("<div class='SC_notePreview'></div>");c=$("<div class='postMsg'></div>"),h=zNote.previewNoteDS(b);var e=function(a){g=a};k[0].$el.append("<div class='noteHeader'></div>");var f={previewCard:"true",disableShortcuts:"true"};ReactDOM.render(React.createElement(zNote.Views.NoteHeaderPreview,{options:f,note:h}),k[0].$el.find(".noteHeader")[0]),k[1].$el.off("scroll").on("scroll",function(){znBox.hideMenu()}),zmUtil.requireStreamsApp().done(function(){n(),zmStreamsApp.PostApp.singlePost({elm:d,viewPost:!0,fixedComment:!1,isPreview:!1,response:b,hideContent:!0}),k[1].push(d[0]),d.find(".SCS_postHead").after(c),ReactDOM.render(React.createElement(zNote.Views.NotePreview,{ref:e,options:f,note:h}),c[0]);var a=$(k[1].$el).innerHeight();g.refs.desc.setContentHeight({height:.6*a}),d.find(".SCS_postHead").addClass("SC_dyn")})}})}},{key:"navigateListing",value:function(a){var b,c,d,e=this.openPreviewNoteData;if(e)switch(a){case"nextNote":b=this.props.noteList.where({id:e.id,namespaceId:e.namespaceId})[0],c=this.props.noteList.indexOf(b),d=this.props.noteList.at(c+1);break;case"previousNote":b=this.props.noteList.where({id:e.id,namespaceId:e.namespaceId})[0],c=this.props.noteList.indexOf(b),d=this.props.noteList.at(c-1)}else this.props.noteList.length&&(d=this.props.noteList.at(0));this.noteViewList[d.get("id")].handleViewNote(),this.openPreviewNoteData={id:d.get("id"),namespaceId:d.get("namespaceId")}}},{key:"render",value:function(){var a,b,c=this,d={id:this.props.noteList.listInfo.id,groupId:this.props.noteList.listInfo.groupId,mode:this.props.noteList.listInfo.mode},e=function(a){return function(b){c.noteView(b,a)}};return b="byuser"===d.mode||"sharedtome"===d.mode||"archive"===d.mode||"mailassociated"===d.id||znBox.checkForGroupDisabled({groupId:this.props.noteList.listInfo.groupId})?{__html:zmText.safeText(zNote.notei18n.nonotesavailable)}:"search"===d.mode?{__html:zmText.safeText(zNote.notei18n.nosearchnotes)}:{__html:zmText.get("noteutil","nonotescreate",{create:"<font onClick={znNote.createInlineNotes()}>"+zmText.safeText(zNote.notei18n.create)+"</font>"})},"noteApp"===this.props.noteList.listInfo.source?(this.initializeValue(),this.color=_.random(0,3),this.newNoteModel.set({color:this.color}),this.props.noteList.length?React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},function(){return znBox.checkForQuickAdd(c.props.noteList.listInfo)?React.createElement(zNote.Views.addNoteViewReact,{ref:"quickAdd",note:c.newNoteModel,options:{quickAdd:!0,list:!0}}):null}(),this.props.noteList.map(function(a){return React.createElement(zNote.Views.NoteListView,{ref:e(a),openNoteInPreviewCard:c.handleOpenNoteInPreviewcard,extraOptions:d,note:a,key:a.get("id")})})):React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:"SC_nmsg",dangerouslySetInnerHTML:b}))):this.props.noteList.length?(a=this.props.noteList.options&&this.props.noteList.options.showHeader?"multiAppHead":"multiAppHead SC_dyn",React.createElement("div",{className:"multiAppData"},React.createElement("div",{className:"multiAppInfo SC_notes zmLstvw"},React.createElement("div",{className:a}," ",React.createElement("span",null,"Notes"),React.createElement("div",{className:"SCmb SC_frt"},React.createElement("ul",null,React.createElement("li",{className:"SCtxt"},React.createElement("b",null,React.createElement("span",{onClick:this.handleAddNote},"Add Note")))))),this.props.noteList.map(function(a){return React.createElement(zNote.Views.NoteListView,{extraOptions:d,ref:e(a),note:a,key:a.get("id")})})))):(a=this.props.noteList.options&&this.props.noteList.options.showHeader?"multiAppHead":"multiAppHead SC_dyn",React.createElement("div",{className:"multiAppData"},React.createElement("div",{className:"multiAppInfo SC_notes zmLstvw"},React.createElement("div",{className:a}," ",React.createElement("span",null,"Notes"),React.createElement("div",{className:"SCmb SC_frt"},React.createElement("ul",null,React.createElement("li",{className:"SCtxt"},React.createElement("b",null,React.createElement("span",{onClick:this.handleAddNote},"Add Note")))))),React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:"SC_nmsg",dangerouslySetInnerHTML:b})))))}}]),b}(React.Component)}();
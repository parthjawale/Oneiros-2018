"use strict";define([],function(a){var b=a("zmail.Core.Namespaces"),c=b.create("zmail.userProfile"),d=function(a,b){var c=zmail.userProfile.base(a,b);return c},e=function(a){var b=zmail.userProfile.core(a);return b};return c.init=d,c.storageInfoCore=e,c.init}),define([],function(a){var b=a("zmail.Core.Namespaces"),c=a("zmAjq"),d=b.get("zmail.userProfile"),e=function(){var a=$.Deferred(),b={};return b.mode="getUserProfile",c.XHR({u:"/biz/bizApi.do",t:"post",p:b,fn:function(b){a.resolve({info:b.info,links:b.links})},csr:"s"}),a},f=function(){var a=$.Deferred(),b={};return b.mode="userUsageStatsVO",c.XHR({u:"/zm/userSettings.do",t:"POST",fn:function(b){a.resolve({curUsage:b.curUsage,docUsage:b.docsUsage,allotedUsage:b.allotedSpace})},p:b,csr:"s"}),a.promise()},g=function(){var a=$.Deferred();return c.XHR({u:"/zm/userStatus.do",t:"POST",fn:function(b){a.resolve({curUsage:b.curUsage,docUsage:b.docsUsage,allotedUsage:b.allotedSpace})},p:{mode:"refreshstorage"}}),a.promise()},h=function(){return $.when(f(),e()).done(function(a){})},i=function(){return h()};return d.getProfileInfo=i,d.refreshStorage=g,d.getStorage=f,d.usageData=f,d.getProfileInfo}),define([],function(a){var b,c,d,e,f=a("zmText"),g=a("zmail.Core.Namespaces"),h=a("_zm"),i=g.get("zmail.userProfile"),j=f.get("userProfileUtil").userProfile,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=!0,s=function(a){return parseInt(a)/Math.pow(1024,3)},t=function(a){return parseInt(a)/Math.pow(1024,2)},u=function(a,b){return a/b*100},v=function(){$(b).on("click",d),$(b).addClass("zmStorageRefresh")},w=function(){setTimeout(function(){r=!0,v()},1e5)};d=function(){$(b).addClass("rotate"),i.refreshStorage().done(function(a){r=!1,$(b).removeClass("zmStorageRefresh rotate"),a.curUsage>0&&(k=t(a.curUsage)),a.allotedUsage>0&&(l=t(a.allotedUsage)),a.docsUsage>=0?o=t(a.docsUsage):a.docUsage<0?o=0:"undefined"==typeof a.docUsage&&(o=void 0),0!==k&&0!==l&&(m=Math.round(u(k,l))),"undefined"==typeof o?n=0:0!==o&&0!==l&&(n=Math.round(u(o,l))),q=m+n,p="undefined"==typeof a.docUsage?k.toFixed(2):(k+o).toFixed(2),c=p+" GB "+j.of+" "+l+" GB "+j.used,$("#storageUsed").text(c);var d={};d.mailStorage=m,d.docStorage=n,d.percentageVal=m+n,i.storageUpdate(d)}),$(b).off("click"),w()};var x=function C(){$(e).removeClass("shw"),setTimeout(function(){return!$(e).hasClass("shw")&&($(e).remove(),void $(document.body).off("click",C))},5e3)},y=function(b,c){e=c;var d={},f=$('<li><div style = "width:350px;"><p>'+j.unique+"</p><p>"+j.identify+"</p></div></li>"),g=['<div class = "SCmb puClose" ref = "closeIcon"><ul><li><b><span><i class = "msi-close"></i></span></b></li></ul></div>'].join(""),i=['<div ref = "userInfo" class = "zmUserData"><div><div class = "zmUserImg" ref = "userImage"><a rel = "noreferrer" target = "_blank" ref = "changeProfileImage">'+j.change+"</a><img src ="+b.basicInfo.photo+'></img></div><strong ref = "uname"></strong><div class = "zmUserDtl"><p ref = "usermailid"></p><p ref = "userzuid">'+j.userId+' <span ref = "userid"> </span><span ref="helpP" style = "margin-bottom:5px;"><i ref = "help" class = "msi-help"> </i></span> </p><p id="superAdmin" ref = "superAdmin">'+j.superAdmin+' <strong id ="sText" > </strong></p><p class = "zmPadTop10" ref = "accountLink"><a ref = "_myaccount" rel = "noreferrer" target = "_blank" class = "zmLink" href = "'+b.basicInfo.myAccount+'">'+j.myAccount+'</a><a ref = "signOut" class = "zmLink zmFR">'+j.signOut+"</a></p></div></div></div>"].join(""),k=h.getDOMReferenceMap(g,!0),l=h.getDOMReferenceMap(i,!0);$(l.uname).text(b.basicInfo.name),$(l.userid).text(b.basicInfo.userId),$(l.usermailid).text(b.basicInfo.emailId),d.baseInfo=l.userInfo,d.closeIcon=k.closeIcon,l.changeProfileImage.setAttribute("href",b.basicInfo.myAccount);var m=a("zmDropDownMenu"),n=new m,o=function(){n.hide()},p=function(){var a={liDom:f,showArrow:!0,par:l.helpP,defaultclass:!1};n.setDropObj(a),n.paintArrowDrop(),$(l.help).on("mouseout",o)};return zmail.isRebranded?($(l.userzuid).remove(),$(l._myaccount).remove()):$(l.help).on("mouseenter",p),$(l.userImage).on("click",x),setTimeout(function(){$(k.closeIcon).on("click",x)},200),$(l.signOut).on("click",function(){h.clearSavedContent()}),l.signOut.setAttribute("href",b.basicInfo.signOut),d},z=function(a){var f,g,w=a,y=w.usage,z=location.protocol+"//"+zmail.zohoUrl+"/mail/",A="ios-android-apps.html",B="admin-mobile-app.html",C="streams-app.html",D="inbox-insight-app.html";y.curUsage>0&&(k=s(y.curUsage)),y.allotedUsage>0&&(l=s(y.allotedUsage)),y.docsUsage>=0?o=t(y.docsUsage):y.docsUsage<0?o=0:"undefined"==typeof y.docUsage&&(o=void 0),g=a.biz.info&&a.biz.info.planName?a.biz.info.planName:"",f=a.biz.info&&a.biz.info.planExpiry?a.biz.info.planExpiry:"",0!==k&&0!==l&&(m=Math.round(u(k,l))),"undefined"==typeof o?n=0:0!==o&&0!==l&&(n=Math.round(u(o,l))),q=m+n,p="undefined"==typeof y.docsUsage?k.toFixed(2):(k+o).toFixed(2),c=p+" GB "+j.of+" "+l+" GB "+j.used;var E=['<div class = "zmUPscroll" ref = "userPlan"><div class = "zmRowSDot"></div><div class = "zmBdrBtn" ref = "additional"><a rel = "noreferrer" target = "_blank" ref = "subscription"></a><a rel = "noreferrer" target = "_blank" ref = "controlPanel">'+j.controlPanel+'</a></div><div class = "zmUPBox zmModeBG" ref="planname"><span ref="planHeader">'+j.plan+'</span><h4 ref="plan">'+g+" "+j.planType+'</h4><i class="greyText" ref="premium">'+j.premium+'</i><a class="zmLink" rel = "noreferrer" target = "_blank" ref="checkPremium">'+j.checkit+'</a><div ref = "expires">'+j.planExpires+" "+f+'</div><div ref = "separator" class = "zmRowSDot"></div><div class = "zmSCWrapper" ref = "storage"><div class="zmStorageInfo"><div ref="upgradeClass" class="zmStorageSplit"><div><div class="greyText">'+j.mail+'</div><div><span class="zmStorageApp mail"></span><span>'+m+'%</span></div></div><div ref="docUsage"><div class="greyText">'+j.docs+'</div><div><span class="zmStorageApp docs"></span><span>'+n+'%</span></div></div></div><p id = "storageUsed" ref = "storageUsed">'+c+'</p><a rel = "noreferrer" target = "_blank" ref= "upgradepar" class="zmRedButton">Upgrade</a></div></div></div><div class = "zmUPBox zmModeBG" ref = "mobileApps"><h4>'+j.forMobile+'</h4></div><div class = "zmUPBox zmModeBG zmUPraf" ref = "referFriend"><h3>'+j.referFriend+"</h3><p>"+j.refererText+"</p></div></div>"].join(""),F=['<ul class = "zmUPmApp" ref = "mobileAppIcons"><li><a ref = "mailurl" target = "_blank" rel = "noreferrer" href="'+z+A+'"><span class = "zmMobApp mail"></span><span>Mail </span></a></li><li ref = "_mailAdmin"><a target = "_blank" rel = "noreferrer" href="'+z+B+'"><span class = "zmMobApp mailAdmin"></span><span>Mail Admin </span></a></li><li ref = "_streams"><a target = "_blank" rel = "noreferrer" href="'+z+C+'"><span class = "zmMobApp streams"></span><span>Streams </span></a></li><li ref = "_inboxSight"><a  target = "_blank" rel = "noreferrer" href="'+z+D+'"><span class = "zmMobApp inboxInsight"></span><span>Inbox Insight </span></a></li></ul>'].join(""),G=['<div class="zmUPBox zmModeBG zmDesktopApp" ref="desktop"><span>'+j.app+"</span><h4>"+j.appName+'</h4><div class="zmBdrBtn"><a target=  "_blank" rel="noreferrer" ref="linktodownload">'+j.download+"</a></div></div>"].join(""),H=h.getDOMReferenceMap(F,!0),I={mailStorage:m,docStorage:n,percentageVal:q,usedTxt:j.used,refreshTxt:j.refresh};b=i.storageTemp(I);var J=h.getDOMReferenceMap(E,!0);if("undefined"==typeof o&&$(J.docUsage).remove(),$(J.storage).prepend(b),zmail.isBaihui||zmail.isRebranded)$(J.mobileApps).remove();else if(zmail.isFuji){$(H._streams).remove(),$(H._inboxSight).remove(),$(H._mailAdmin).remove();var K="en";"ja"===zmail.user.lang&&(K="ja"),z=zmail.urls.zohoWebsiteLink+"/"+K+"/apps/mail/ios-android-apps.html",H.mailurl.setAttribute("href",z),J.mobileApps.appendChild(H.mobileAppIcons)}else J.mobileApps.appendChild(H.mobileAppIcons);r&&v(),$(b).on("click",d);var L=function(a){zmAjq.XHR({u:"/biz/cpanelUrlTracking.do",t:"POST",p:a,csr:"s"})};$(a.accountLink).on("click",x),$(J.additional).on("click",x),$(J.upgradepar).on("click",x),$(H.mobileAppIcons).on("click",x);var M=w.biz;if(M.subscription&&"SUB"===M.subscription.linkType){var N=document.createTextNode(j.subscription);J.subscription.appendChild(N),J.subscription.setAttribute("href",M.subscription.link),$(J.subscription).on("click",function(){var a={clickedFrom:"usrProfileSub"};L(a)})}else if(M.mailHosting&&"EMH"===M.mailHosting.linkType){var O=document.createTextNode(j.emailHosting);J.subscription.appendChild(O),J.subscription.setAttribute("href",M.mailHosting.link)}else $(J.subscription).remove();if(M.upgrade&&"UPG"===M.upgrade.linkType)J.upgradepar.setAttribute("href",M.upgrade.link),$(J.upgradeClass).addClass("upgrade");else if(M.mailHosting&&"EMH"===M.mailHosting.linkType){if(zmail.isFuji){var P=zmail.urls.zohoWebsiteLink+"//products/mail/functions/plans/";J.upgradepar.setAttribute("href",P)}else J.upgradepar.setAttribute("href","/biz/personalpurchase.do");$(J.upgrade).text(j.moreStorage)}else $(J.upgradepar).remove();if(M.info&&"undefined"!=typeof M.info.planName&&"undefined"==typeof M.info.superAdmin||(zmail.isFuji||!M.info||"true"===zmail.isPaidUser&&M.info.superAdmin)&&($(J.planHeader).remove(),$(J.plan).remove(),$(J.separator).remove(),$(J.premium).remove()),"undefined"!=typeof M.upgrade&&"UPG"===M.upgrade.linkType){var Q=J.checkPremium;Q&&Q.setAttribute("href",M.upgrade.link)}else J.premium&&($(J.premium).remove(),$(J.checkPremium).remove());if(M.controlPanel&&"CP"===M.controlPanel.linkType?(J.controlPanel.setAttribute("href",M.controlPanel.link),$(J.controlPanel).on("click",function(){var a={clickedFrom:"usrProfileCpanel"};L(a)})):$(J.controlPanel).remove(),M.referFriend&&"My Referrals"===M.referFriend.label?$(J.referFriend).on("click",function(){var a=location.protocol+"//"+zmail.urls.mailURL+"/"+M.referFriend.link;h.windowOpen(a)}):$(J.referFriend).remove(),!(zmail.isDesktopApp||zmail.isRebranded||zmail.isFuji||zmail.isBaihui)){var R=h.getDOMReferenceMap(G,!0);$(J.userPlan).append(R.desktop);var S=zmail.urls.zohoWebsiteLink+"desktop";$(R.linktodownload).attr("href",S)}return M.info&&"undefined"!=typeof M.info.expiryDate&&M.info.isAdmin!==!1||($(J.expires)[0].innerText=""),$(e).on("click",function(a){a.stopPropagation()}),$(document.body).on("click",x),J},A=function(a){return z(a)},B=function(a,b){return y(a,b)};return i.core=A,i.base=B,i.core}),define([],function(a){var b,c,d,e,f,g,h,i,j,k,l=a("zmail.Utils.DOM"),m=a("zmail.Core.Namespaces"),n=m.get("zmail.userProfile"),o={},p=100,q=.5,r=2;return k=function(a){var b={},c=Math.round(a.mailStorage);return j=Math.round(a.docStorage),e=c+j,0!==c&&0!==j&&100!==e||(q=0),i=1.8*q,g=i,"undefined"!=typeof a.docStorage&&(h=3.6*(c+q)-i,e<=95&&(c<=1||j<=1)&&(h=3.6*(c+q*r)-i,q=0),f=p-j+q),d=p-c+q,b.mailUsage=d,b.docUsage=f,b.totalUsage=e,b},o.getStorageTemplate=function(a){var c=Math.round(a.percentageVal),d=k(a),e=["ht","tp","://www.w3.org/2000/svg"].join(""),f=zdom("svg",{xmlns:e,viewBox:"0 0 110 110",className:"zmStroageChartSVG"},zdom("circle",{ref:"orgMail",cx:"55",cy:"55",r:"15.9",className:"zmStroageChartMail"}),zdom("circle",{ref:"orgDocs",cx:"55",cy:"55",r:"15.9",className:"zmStroageChartDocs"}),zdom("circle",{cx:"55",cy:"55",r:"15.9",className:"zmStroageChartMask"}),zdom("circle",{cx:"55",cy:"55",r:"15.9",ref:"shadowMail",className:"zmStroageChartMailShadow"}),zdom("circle",{cx:"55",cy:"55",r:"15.9",ref:"shadowDocs",className:"zmStroageChartDocsShadow"}),zdom("circle",{cx:"55",cy:"55",r:"15.9",className:"zmStroageChartMask innerMask"})).outerHTML;b=zdom("div",{className:"zmStroageChart zmStorageRefresh",ref:"storageDom"},zdom("div",{ref:"svgContainer",dangerouslySetInnerHTML:f}),zdom("div",{className:"zmStroageUsed"},zdom("font",null,a.usedTxt),zdom("span",{ref:"totalPercentage"},c+"%")),zdom("span",{className:"zmLink"},zdom("i",{className:"msi-refresh SC_thm"}),zdom("font",null,a.refreshTxt)));var g=o.update(d.mailUsage,d.docUsage);return q=.5,g},o.update=function(d,e){return c=a("_zm").getDOMReferenceMap(b,!0),o.updateUsage(d,e),c.storageDom},o.storageUpdate=function(a){var b=Math.round(a.percentageVal),d=e;if(e!==b){var f=function(){var a=setInterval(function(){l.setText(c.totalPercentage,d+"%"),b<d?(d++,b<d&&clearInterval(a)):(d--,b>d&&clearInterval(a))},100)};f()}var g=k(a);o.updateUsage(g.mailUsage,g.docUsage)},o.updateUsage=function(a,b){d=a,f=b,a=Math.round(a),a=0===a?0:a>=0&&a<.99?a.toFixed(1):Math.round(a),"undefined"!=typeof b&&(b=Math.round(b),b=0===b?0:b>=0&&b<.99?b.toFixed(1):Math.round(b)),c.orgMail.setAttribute("stroke-dashoffset",d),c.orgMail.style.transform="rotate("+g+"deg)",c.shadowMail.setAttribute("stroke-dashoffset",d),c.shadowMail.style.transform="rotate("+g+"deg)","undefined"==typeof b||b<0||0===b?(l.unmount(c.orgDocs,!0),l.unmount(c.shadowDocs,!0)):(c.orgDocs.setAttribute("stroke-dashoffset",f),c.orgDocs.style.transform="rotate("+h+"deg)",c.shadowDocs.setAttribute("stroke-dashoffset",f),c.shadowDocs.style.transform="rotate("+h+"deg)")},n.storageTemp=o.getStorageTemplate,n.updateUsage=o.updateUsage,n.storageUpdate=o.storageUpdate,n.storageTemp});
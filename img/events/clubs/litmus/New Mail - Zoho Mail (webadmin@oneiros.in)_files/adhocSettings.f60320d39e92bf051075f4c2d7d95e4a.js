"use strict";define([],function(a){var b=a("zmail.Core.Namespaces"),c=b.create("zmAdHocSettings"),d={STRING:"STRING",JSON:"JSON"},e={USER:"USER",ACCOUNT:"ACCOUNT"},f={siteTour:{"default":"unvisited",values:["visited","unvisited","v1","v2","whatsnew","TOT"]},appTour:{dataType:d.JSON,structure:{mail:{"default":"unvisited",values:["v1","v2","unvisited"]},compose:{"default":"unvisited",values:["v1","v2","unvisited"]},notes:{"default":"unvisited",values:["v1","v2","unvisited"]},task:{"default":"unvisited",values:["v1","v2","unvisited"]},calendar:{"default":"unvisited",values:["v1","v2","unvisited"]},streams:{"default":"unvisited",values:["v1","v2","unvisited"]},attachmentViewer:{"default":"unvisited",values:["v1","v2","unvisited"]},setting:{"default":"unvisited",values:["v1","v2","unvisited"]}},templateName:"AppTour"},theme:{"default":"theme1",values:["theme1","theme2","theme3","theme4","theme5","theme6","theme7","theme8","theme9","theme10"]},leftOrder:{"default":"zmStreamTree,zmlTreeH,zmlSTreeH,zmllabelH,zmlviewH,zmlSSrchTreeH",values:""},appOrder:{"default":"mail,cal,task,notes,contacts,links",values:""},lastUsedUI:{"default":"unknown",values:["unknown","biz","zm","zm_only","tot","tot_only"]},font:{"default":"Lato",values:["Lato","PT Sans","Arial"]},uiState:{dataType:d.JSON},lPageType:{"default":"none",values:""},composeType:{"default":"1",values:["1","2"]},dailyTour:{"default":"",values:""},streamsListType:{"default":"default",values:["default","grid","list"]},whatsNewSeen:{dataType:d.STRING},totUI:{"default":"false",values:["true","false"]},suppressedMessagesState:{dataType:d.JSON,structure:{conversationAction:{"default":"on",values:["on","off"]},mailShareTip:{"default":"on",values:["on","off"]},conversationShareWarning:{"default":"on",values:["on","off"]}},templateName:"SuppressedMessagesState"},leftLayerState:{dataType:d.JSON},mailViewSettings:{dataType:d.JSON,structure:{headerState:{"default":"c",values:["e","c"]}},templateName:"MailViewSettings"},helperBlockVisibility:{"default":"1",values:["0","1"]},conversationActionType:{"default":"1",values:["1","2"]},markConversationRead:{"default":"0",values:["0","1"]},bizBannerMsg:{"default":"no_msg",values:""},accountsLhsOrder:{"default":"-no_acc-",values:""},whatsNewVersion:{dataType:d.JSON},listingDisplayDensity:{"default":"0",values:["0","1","2"]},mailSoundNotifier:{"default":"0",values:["0","1","2","3","4","5"]},projectInteg:{dataType:d.JSON},nightMode:{"default":"0",values:["0","1"]},streamsGroupMgmt:{"default":"0",values:["0","1"]},streamsGroupImg:{"default":"1",values:["0","1"]},streamsAppMsg:{"default":"0",values:["0","1"]},commentBoxView:{"default":"0",values:["on","off"]},notes:{dataType:d.JSON,templateName:"Notes",structure:null},bookMarks:{dataType:d.JSON,templateName:"BookMarks",structure:null},attachComp:{dataType:d.JSON,templateName:"AttachComp",structure:null},calServiceName:{"default":"zcal",values:["zcal","zcrm"]},onBoardingPage:{dataType:d.STRING},dragNDropInfo:{dataType:d.STRING},customFontFamilyList:{dataType:d.STRING},templateView:{dataType:d.STRING},contactsSuggestionType:{"default":"0",values:["0","1"]},showCCOption:{"default":"0",values:["0","1"]},customizeMailListing:{dataType:d.JSON,structure:{envelope:{"default":"0",values:["0","1"]},flag:{"default":"0",values:["0","1"]},label:{"default":"0",values:["0","1"]},attachment:{"default":"0",values:["0","1"]},date:{"default":"0",values:["0","1"]},size:{"default":"0",values:["0","1"]},"delete":{"default":"0",values:["0","1"]},summary:{"default":"0",values:["0","1"]},commentcount:{"default":"0",values:["0","1"]},thread:{"default":"0",values:["0","1"]}},templateName:"customizeMailListing"},securedownload:{"default":"0",values:["0","1"]},mailPreviewSize:{"default":"63",values:""},lhsResize:{"default":"200",values:""},lhsAppBarView:{"default":"true",values:["true","false"]},totUIVersion:{"default":"TOT",values:""},uiStats:{dataType:d.JSON},rhsOnBoarding:{"default":"true",values:["true","false"]},archivePostDialog:{"default":"0",values:["0","1"]}};return c.initData=f,c.dataTypes=d,c.exclusivityTypes=e,c}),define([],function(a){var b=a("zmAdHocSettings"),c=a("zmail.Utils.DOM");return function(){var c=zmail.conPath+"/settings.do",d=function(b,d,e,f){var g=a("zmAjq");b=b||{},d=d||function(){},e=e||function(){},f=f||{};var h={u:c,p:b,fn:d,efn:e,ep:f,t:"post"};b.hasOwnProperty("setSessionId")&&(h.setSessionId=b.setSessionId,delete b.setSessionId),g.XHR(h)},e=function(a){return"object"===("undefined"==typeof a?"undefined":babelHelpers["typeof"](a))?Object.keys(a):[]},f=function(a,b){var c=[];if(a&&b&&a.constructor===Object&&b.constructor===Object){if(e(a).length!==e(b).length)return!1;for(var d in a)a.hasOwnProperty(d)&&(b.hasOwnProperty(d)&&babelHelpers["typeof"](a[d])===babelHelpers["typeof"](b[d])||c.push(d))}return 0===c.length},g=function(a){a=a||{};var b={},c=[],d=function e(a){for(var d in a)if(d.indexOf(".")!==-1)window.console.log("The JSON object key '"+d+"' cannot contain the character '.' !");else{if(c.push(d),a[d]&&a[d].constructor===Object)e(a[d]);else{var f=a[d];f&&f.constructor instanceof Array&&(f=JSON.stringify(f)),b[c.join(".")]=f}c.pop()}};return d(a),b},h=function(a){var b={};for(var c in a){var d=c.split("."),e=d.length||0,f=a[c];if(1===e)b[c]=f;else if(e>1){for(var g,h=d[e-1],i=b,j=0;j<e-1;j++)g=d[j],i[g]=i[g]||{},i=i[g];i[h]=f}}return b},i=function(a,b){a=a||{},b=b||{};var c={};a=g(a),b=g(b);for(var d in a)c[d]=a[d];for(var e in b)c[e]=b[e];return c=h(c)};b.ajax=d,b.hasSameStructure=f,b.flattenJSON=g,b.unflattenJSON=h,b.mergeJSON=i,b.objectKeys=e}(),function(){var a={},d=function(b,d){"function"==typeof d&&c.element(a).on(b,d)},e=function(b,d){"function"==typeof d&&c.element(a).off(b,d)},f=function(b,d){setTimeout(function(){c.element(a).trigger(b,d)},0)};b.subscribe=d,b.unsubscribe=e,b.publish=f}(),function(){function a(a,b){this.name=a,this.type=d.STRING,this.exclusivity=e.USER,this["default"]="",this.currentValue="",this.validValues="",this.wrapper=!1,this.parent=null,this.templateName="",b&&this.initFromConfig(b)}var c={},d=b.dataTypes||{},e=b.exclusivityTypes||{};a.prototype={initFromConfig:function(b){var c=this;if(b=b||{},c.wrapper=b.isWrapper||!1,c.parent=b.parent||null,b.dataType){if(!(b.dataType in d))throw new Error("data type of setting is not valid !");c.type=b.dataType}else if(b.structure){if(b.structure.constructor!==Object)throw new Error("'structure' property should be an 'Object' !");c.type=d.JSON}else if("undefined"!=typeof b["default"]){if(b["default"].constructor!==String)throw new Error("'default' property should be a 'String' !");c.type=d.STRING}else c.type=d.STRING;if(b.exclusiveTo){if(!(b.exclusiveTo in e))throw new Error("exclusivity type of setting is not valid !");c.exclusivity=b.exclusiveTo}else c.exclusivity=c.parent&&c.parent.exclusivity||e.USER;if(c.type!==d.JSON||null!==c.parent&&c.parent.wrapper!==!0||c.wrapper!==!1||(c.templateName=b.templateName||""),c.type===d.STRING&&(c["default"]=b["default"]||"",c.currentValue=c["default"],c.validValues=b.values||null),b.hasOwnProperty("sync")?c.sync=b.sync:c.sync=!0,c.type===d.JSON){c.checkStructure=null!==b.structure;for(var f in b.structure){var g=b.structure[f];g.parent=c;var h=new a(f,g);c.children=c.children||{},c.children[f]=h}c["default"]=c.toJSON()[c.name],c.currentValue=c["default"]}},toJSON:function(a){a=a||{};var c=this,f=a.fromParent||!1,g=a.exclusiveTo&&[a.exclusiveTo]||[e.USER,e.ACCOUNT];if(c.type===d.JSON&&c.templateName&&c.checkStructure){var h={};for(var i in c.children){a.fromParent=!0;var j=c.children[i];if(j.type===d.JSON||g.indexOf(j.exclusivity)!==-1){var k=j.toJSON(a);(k&&b.objectKeys(k).length||j.type===d.STRING)&&(h[j.name]=k)}}if(!c.wrapper&&null===c.parent){var l={};l[c.name]=h,h=l}return h}if(c.type===d.JSON){var m={};return m[c.name]={},g.indexOf(c.exclusivity)!==-1&&(m[c.name]=c.currentValue||{}),m}if(c.type===d.STRING){if(f)return c.currentValue;var n={};return n[c.name]=c.currentValue,n}},setJSON:function(a){var b=this;if(a)if(a.constructor===Object&&b.templateName&&b.checkStructure){for(var c in a)b.children[c]&&b.children[c].setJSON(a[c]);b.currentValue=b.toJSON()[b.name]}else a.constructor===Object?b.currentValue=JSON.parse(JSON.stringify(a)):b.currentValue=a}};var f=function(){var d,e;for(d in b.initData)e=new a(d,b.initData[d]),c[d]=e};f(),b.settings=c}(),function(){var a=b.settings||{},c=b.dataTypes||{},d=b.hasSameStructure,e=function(b,d){var e=a[b];if(e){if(e.type===c.JSON){var f;return f=d?e.toJSON({exclusiveTo:d}):e.toJSON(),f=f[b]||{}}return e.type===c.STRING?e.currentValue:void 0}},f=function(){var b={};for(var c in a)b[c]=e(c);return b},g=function(b){var d=a[b];return d.type===c.JSON?$.extend({},d["default"]):d.type===c.STRING?d["default"]:void 0},h=function(b){var d=a[b];return d.validValues?d.type===c.STRING?$.extend([],d.validValues):void 0:d.type===c.JSON&&d.children?d.children:""},i=function(c,f,h){h=h||{};var i=a[c];if(f=f||{},!h.initialize&&i.templateName&&i.checkStructure&&!d(g(c),f))return!1;if(!i.templateName||!i.checkStructure)return i.setJSON(f),!0;var j=e(c);i.setJSON(f);var k=e(c);j=b.flattenJSON(j),k=b.flattenJSON(k);var l=!1;for(var m in j)j[m]!==k[m]&&(l=!0);return l},j=function(b,c){var d=a[b],e=d.validValues||[];return c=c||"",c.constructor===String&&(c=c.trim()),(!e.length||e.indexOf(c)!==-1)&&(d.currentValue!==c&&(d.currentValue=c,!0))},k=function(d,f,g){var h=a[d],k=!1;g=g||{};var l=!g.hasOwnProperty("notify")||g.notify,m=!g.hasOwnProperty("throttle")||g.throttle,n=!g.hasOwnProperty("sync")||g.sync;if(!h)return!1;var o,p=e(d);if(h.type===c.JSON){if("object"!==("undefined"==typeof f?"undefined":babelHelpers["typeof"](f)))try{f=JSON.parse(f)}catch(q){}k=i(d,f,{initialize:g.initialize})}else h.type===c.STRING&&(k=j(d,f,{initialize:g.initialize}));if(o=e(d),k){var r={name:d,oldValue:p,value:o,throttleSave:m};l&&b.publish("settingschanged",r),n&&b.publish("internal/settingschanged",r)}return k};b.getAll=f,b.get=e,b.set=k,b.getDefault=g,b.getValidValues=h}(),function(){var a=function(a,c){b.publish("settingschanged/"+c.name,c)},c=function(){b.subscribe("settingschanged",a)};c()}(),function(){var c=b.dataTypes||{},d=b.exclusivityTypes||{},e=5e3,f={},g="",h=b.subscribe,i=function(a,c){var e={mode:"set",name:a.name,value:a.currentValue};a.exclusivity===d.ACCOUNT&&(e.accountID=zmail.accId);var f=function(){b.set(a.name,c.oldValue,{sync:!1,notify:!1,throttle:!1})};e.setSessionId=!0,b.ajax(e,void 0,f)},j=function(a,c){var e=a.toJSON({exclusiveTo:d.USER})[a.name],f=a.toJSON({exclusiveTo:d.ACCOUNT})[a.name],g=b.objectKeys(e).length>0,h=b.objectKeys(f).length>0,i={name:a.name,ignoreTemplate:!1,template:a.templateName||"no_template"};a.templateName||(i.ignoreTemplate=!0),h&&(i.accountID=zmail.accId),g&&h?(i.userValue=JSON.stringify(e),i.accountValue=JSON.stringify(f),i.mode="setFullJSON"):(i.value=JSON.stringify(g?e:f),i.mode="setJSON");var j=function(){b.set(a.name,c.oldValue,{sync:!1,notify:!1,throttle:!1})};i.setSessionId=!0,b.ajax(i,void 0,j)},k=function p(d,g){var h=g.name,k=b.settings[h];if(k&&k.sync){var l;k.type===c.JSON?l=j:k.type===c.STRING&&(l=i),g.throttleSave&&(f[h]||(f[h]=a("_").throttle(function(a,b){b.throttleSave=!1,p(null,b)},e)),l=f[h]),l(k,g)}},l=function(a,c){g="PENDING";var d=b.mergeJSON(a,c);for(var e in d)b.set(e,d[e],{sync:!1,notify:!0,initialize:!0});b.publish("settingsloaded",{success:!0}),g="SUCCESS"},m=function(){var a={mode:"getall",accountID:zmail.accId},c=function(a){a=a||{};var b=a.user||{},c=a.account||{};l(b,c),g="SUCCESS"},d=function(){b.publish("settingsloaded",{success:!1}),g="FAIL"};b.ajax(a,c,d),g="PENDING"},n=function(){b.subscribe("internal/settingschanged",k)},o=function(a,b){a&&"function"==typeof b&&("settingsloaded"===a&&("SUCCESS"===g?b(null,{success:!0}):"FAIL"===g&&b(null,{success:!1})),h(a,b))};b.subscribe=o,b.fetch=m,b.fetchFromObject=l,n()}(),window.zmAdHocSettings=function(){var a={},c=["get{{SETTING}}","set{{SETTING}}","get{{SETTING}}Default","get{{SETTING}}ValidValues","subscribe{{SETTING}}Change","unsubscribe{{SETTING}}Change"],d=/\{\{SETTING\}\}/,e=function(a,c){switch(a){case"get{{SETTING}}":return function(a){a=a||{};var d=a.exclusivity;return b.get(c,d)};case"set{{SETTING}}":return function(a,d){return b.set(c,a,d)};case"get{{SETTING}}Default":return function(){return b.getDefault(c)};case"get{{SETTING}}ValidValues":return function(){return b.getValidValues(c)};case"subscribe{{SETTING}}Change":return function(a){b.subscribe("settingschanged/"+c,a)};case"unsubscribe{{SETTING}}Change":return function(a){b.unsubscribe("settingschanged/"+c,a)}}},f=function(){var f,g,h=function(b){var c=b.replace(d,g);a[c]=e(b,f)};for(var i in b.settings)f=i,g=f.charAt(0).toUpperCase()+f.substr(1),c.forEach(h)},g=function(){a.subscribe=b.subscribe,a.unsubscribe=b.unsubscribe},h=function(){a.SETTING_DATA_TYPES=$.extend({},b.dataTypes),a.SETTING_EXCLUSIVE_TYPES=$.extend({},b.exclusivityTypes)},i=function(){a.fetch=b.fetch,a.fetchFromObject=b.fetchFromObject,a.getAll=b.getAll},j=function(){h(),g(),f(),i()};return j(),a}(),window.zmAdHocSettings});
"use strict";define(["zmText"],function(a,b){var c=a("zmText"),d=a("zmUtil"),e=a("zmsuite"),f=a("_zm"),g=a("zmAdHocSettings"),h=a("zmComponent"),i=a("zmAjq"),j=a("zmAppLoader"),k=c.get("commonUtils"),l=function(a){var b=e.getLeft(),c=b.getNodes(),d=c[0].getLayer(a);return d},m=function(b){if(!d.isChildWindow()){var c=a("zmInit"),e=c.getListingDetObj().fId,f=!1;switch(b){case"drafts":e===zmail.folId.dId&&(f=!0);break;case"templates":e===zmail.folId.teId&&(f=!0);break;case"outbox":e===zmail.folId.oId&&(f=!0)}f&&$.publish("/mail/listMails",{fId:e})}},n=function(){zmail.MailPreUtils.updateCount({fId:zmail.folId.oId,mode:"dec"})},o=function(){var a=$("#zmnotify span");if(a){var b=parseInt(a.html())+1;a.html(b)}},p=function(b,c,e,f){d.stopEvents(f);var g=a("znNote"),h=a("zmfolAction"),i=a("zmInit");"c"===e&&(c=$(c).parent().parent());var j=$(c).offset(),l=j.left,m=j.top-5,n=void 0,o=$("#zm_tAction").height();if("zn_actLst"===b&&(n=c.parentNode.parentNode.className,"zn_dd"===n?($("#"+b).html("<ul><li>"+k.common.attachFile+"</li><li>"+k.common.insertImg+"</li><li><div id='znActionAddlabel'>"+k.common.addTags+"</div></li></ul>"),d.setEditable({ele:$("#znActionAddlabel"),target:g.addTags,callback:h.sendNewFolderReq,onenter:h.isValidFolder,parentdiv:$("#zn_actLst")})):($("#"+b).html("<ul><li>"+k.common.importNotes+"</li><li>"+k.common.exportNotes+"</li><li><div id='znActionNewfolder'>"+k.common.newCat+"</div></li><li><div id='znActionNewlabel'>"+k.common.newTags+"</div></li></ul>"),d.setEditable({ele:$("#znActionNewfolder"),target:null,callback:h.sendNewFolderReq,onenter:h.isValidFolder,parentdiv:$("#zn_actLst")}),d.setEditable({ele:$("#znActionNewlabel"),target:null,callback:h.sendNewFolderReq,onenter:h.isValidFolder,parentdiv:$("#zn_actLst")}))),"r"===e){var p=$(c).width();l=i.cliWid-(l+p);var q=$(c).children("ul")[0];$(q).addClass("SC_ddr"),$("#"+b).css({right:l+"px",top:m+o+"px"}).show()}else n=c.parentNode.parentNode.className,"zn_dd"===n&&(m-=10),$("#"+b).css({left:l+"px",top:m+o+"px"}).show();$(c).find("b").addClass("SC_ddn")},q=function(){var a=arguments[0],b=arguments.length;if(void 0!==a)for(var c=1;c<b;c++)a=a.replace("{"+(c-1)+"}",arguments[c]);return a},r=function(a){zmail.folCount[a.folId]||(zmail.folCount[a.folId]={},zmail.folCount[a.folId].c="0",a.pfolId?zmail.folCount[a.folId].p=a.pfolId:a.prefolId&&(zmail.folCount[a.folId].p=zmail.folCount[a.prefolId].p))},s=function(){var a=void 0;$("#zm_overlay").length?$("#zm_overlay").show():(a=$("<div/>"),a[0].id="zm_overlay",a.addClass("SC_AtMk"),$(document.body).append(a))},t=function(b,c){var e=a("zmInit"),f="zmCntxtMenu";if(b){var g=b.length;if(g){var h=$("<div/>");f?($("#"+f).remove(),h[0].id=f):h[0].id="zmCntxtMenu",h[0].className="SC_PU",h[0].style.display="block",h.mousedown(function(a){d.stopEvents(a,!0)});var i=$("<div/>");i[0].className="SC_PUcen",h.append(i);var j=$("<ul/>");j[0].className="SC_Phr",j[0].style.display="block",i.append(j);for(var k=function(a,c){return b[a].eventName},l=0;l<g;l++){var m=$("<li/>"),n=Boolean(b[l].cEdit),o=b[l].id?b[l].id:"";if(b[l].htm)if(n){var p=$("<div/>");p[0].innerHTML=b[l].htm,p[0].id=o,m.append(p)}else m[0].innerHTML=b[l].htm,m[0].id=o;else b[l].sep&&(m[0].className="SC_lne",m[0].id=o);b[l].clk&&m.click(k(l,"clk")),b[l].mouseovr&&m.mouseover(k(l,"mouseovr")),b[l].mouseot&&m.mouseout(k(l,"mouseot")),j.append(m)}var q=e.nn6?c.clientY:c.clientY+10,r=e.nn6?c.clientX:c.clientX+10;$("body").append(h);var s=$("#"+f).height()+q,t=$("#"+f).height(),u=e.cliHgt;if(h)if(s>u&&q-t>=0){var v=u-q;h.css({bottom:v,left:r})}else h.css({top:q,left:r})}}},u=function(){return g&&"function"==typeof g.getHelperBlockVisibility&&"1"===g.getHelperBlockVisibility()},v=function(a){var b=/((?=http|https)[\S]*:\/\/[\S]*.+)|([\S]*(?:\w{2}\.\w+\.\w+)[\S]*)/gi;return b.test(a)},w=function(){var b=function(a){d.loadNotes("popup",{descHTML:a.html,desc:a.text,groupId:a.groupId||zmail.zuid,richText:!0})},c=function(a){d.loadTask({action:"addCTask",groupId:a.groupId||zmail.zuid,tasks:{SUMMARY:a.text}})},f=function(b){var c=a("zmApp");c.loadCalendar("/calendar/event",{SUM:b.text})},g=function(a){d.loadNewPostDialog({summary:a.text})},h=function(a){var b={mode:"create",groupId:zmail.zuid,catid:""},c=d.parseURLS(a.text,{httpOnly:!0});if(c.length){var e=c[0];b.link=e.url,a.text!==e.url&&(b.summary=a.text)}else b.summary=a.text;d.loadLink(b)},i=function(a,e){switch(d.hideMenu(),a){case"CreateNote":b(e);break;case"CreateTask":c(e);break;case"CreateEvent":f(e);break;case"CreatePost":g(e);break;case"CreateLink":h(e)}},j=function(){var a=0,b=0,c=0,d=0;if(window.getSelection&&document.createRange&&"undefined"!=typeof document.createRange().getBoundingClientRect){var e=window.getSelection();if(e.rangeCount>0){var f=e.getRangeAt(0).getBoundingClientRect();a=f.left,b=f.top,c=f.width,d=f.height}}else if(document.selection&&"Control"!==document.selection.type){var g=document.selection.createRange();a=g.boundingLeft,b=g.boundingTop,c=g.boundingWidth,d=g.boundingHeight}return{x:a,y:b,width:c,height:d}},l=function(){return document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:""},m=function(){var a=void 0;if(document.selection&&document.selection.createRange)return a=document.selection.createRange(),a.htmlText;if(window.getSelection){var b=window.getSelection();if(b.rangeCount>0){a=b.getRangeAt(0);var c=a.cloneContents(),d=document.createElement("div");return d.appendChild(c),d.innerHTML}return""}return""},n=function(a,b){d.isSmartMenuOptionEnabled()&&!zmail.fromOtherService&&(a.ignoreSelector=a.ignoreSelector?a.ignoreSelector:[],$(a.applyDOM).find(a.ignoreSelector.join()).on("mouseup",function(a){a.stopPropagation()}),$(a.applyDOM).not(a.ignoreSelector.join()).off("mouseup.addSelectMenu").on("mouseup.addSelectMenu",function(a){setTimeout(function(){var a=l(),c=m(),f=void 0;if(b=b||{},b.text=a,b.html=c,f=j(),a&&a.trim().length){var g=$("<li><span><i data-action='CreatePost'  class=msi-status title='"+k.create.post+"'></i></span><span><i data-action='CreateNote'  class=msi-notes title='"+k.create.note+"'></i></span><span><i data-action='CreateTask' class=msi-task title='"+k.create.task+"'></i></span><span><i data-action='CreateEvent' class=msi-calendar title='"+k.create.event+"'></i></span></li>");d.parseURLS(a,{httpOnly:!0}).length&&g.append("<span><i data-action='CreateLink'  class=msi-links title='"+k.create.link+"'></i></span>"),$(g[0]).find("span").off("click").on("click",function(a){a.stopPropagation();var c=$(this).find("i").attr("data-action");i(c,b)});var h={};h.clientX=f.x+f.width/2,h.clientX>window.innerWidth&&(h.clientX=(window.innerWidth-f.x)/2+f.x),h.clientY=f.y<0?f.y+f.height-12:f.y-12;var n={left:h.clientX,top:h.clientY,showArrow:!0,liDom:g,ulClass:"selectMenu",spanClass:"zmsmartMenu minwid"};f.y>0?n.direction="bottom":n.direction="top",d.isSmartMenuOptionEnabled()&&e.showMenu(n)}},0)}),zmail.isInternalOrgUser&&d.addAnchorTagHover(a),zmail.showFeature&&d.addTaskOnListHover(a))};return{addSelectMenu:n}}(),x=function(){var a,b,c='<i id="taskquickadd" title="Add to task"style="display:none; position: absolute"class="msi-task"></i>',e=function(){if(!(b instanceof $&&b.length)){b=$(c),$("body").append(b),b.off("mouseover").on("mouseover",function(a){a.stopPropagation()});var e=function(){b instanceof $&&b.length&&setTimeout(function(){b.hide()},500)};b.off("click").on("click",function(b){var c=a.find("li").map(function(){return $(this).text()}).get(),f={};if(c.length>0){f.TITLE=c[0],f.subtask=[];for(var g=1;g<c.length;g++)f.subtask.push({TITLE:c[g]})}d.loadTask({action:"addCTask",groupId:zmail.zuid,tasks:f}),e()})}},f=function(c,d){if(!d.relatedTarget||"I"!==d.relatedTarget.nodeName){e(),a=$(c);var f=$(c).first().offset();b.show().css({top:f.top,left:f.left})}},g=function(a){"I"!==a.relatedTarget.nodeName&&b.hide()};return function(a){var b=$(a.applyDOM[0]);if(b.hasClass("zmPCon")&&(b.find("ul").length>0||b.find("ol").length>0)){var c=b.find("ul").toArray(),d=b.find("ol").toArray(),e=c.concat(d);$.each(e,function(a,b){$(b).off("mouseover").on("mouseover",f.bind(null,b)),$(b).off("mouseout").on("mouseout",g)})}}}(),y=function(a,b,c){if(a&&b){var d={accId:a};switch(b){case"inc":d.mode="inc";break;case"upd":d.mode="update",void 0!==c?d.count=c:d.count=0}$.publish("/acc/unreadCountChange",d)}},z=function(b,c,f){var h=a("zmApp");if(b){var i=a("zmPrev"),j=a("zmTopMenus"),k=a("zmInit");g.fetchFromObject(b.adhocUserSettings,b.adhocAccountSettings),i.clsPreview("zm_Container"),d.closeMailTabs(),k.reInitListing(),zmail.accId=c.accId,zmail.folId=b.folId,zmail.folCount=b.folCount,zmail.folTree=b.folTree,zmail.mailList=b.mailList,zmail.discardFolCnt=b.discardFolCnt,b.cmpData&&"string"==typeof b.cmpData&&(zmail.updatecmp=!0,zmail.cmpdata=$.parseJSON(b.cmpData)),"m"===h.currentApp?e.showWorkSpace("zm_Container"):h.showApp("m"),zmail.savedSearchList=b.savedSearchList||{},"string"==typeof b.labInfo?zmail.labInfo=$.parseJSON(b.labInfo):zmail.labInfo=b.labInfo,zmail.accId===zmail.defAccId&&(zmail.zohoAccLabInfo=$.extend({},zmail.labInfo)),b.DEFFRM_ADDR&&(zmail.fromAddr=b.DEFFRM_ADDR),zmail.useCache=!1,zmail.applyState=!1,zmail.saveState=!1,zmail.loadCompleted=!1,zmail.accId===d.getZohoAccId()?zmail.shrTree=b.shrTree||[]:zmail.shrTree=[],k.constructView(),k.initMailList(),k.listingBand.SpamTrashBand.setBand(),k.updateCountTitle(),j.util.show({type:"listing",view:k.getListingDetObj(),tabId:"zm_Container"}),zmail.loadCompleted=!0;var l=k.getUnreadViewCount();d.updateCountForAcc(zmail.accId,"upd",l),k.getSuppressedFolders(),$.publish("/mail/accountSwitch",{status:"success",accountID:c.accId}),f&&f.resolve()}else $.publish("/mail/accountSwitch",{status:"failed",accountID:c.accId}),f&&f.reject()},A=function(a){var b=$.Deferred(),c=void 0;$.publish("/mail/switchAccount",[a]);var e=function(a,c){z(a,c,b)};return c=h.loadingMasks({maskText:k.switchAccount,extraText:zmail.aInfo[a].mailId}),i.XHR({u:zmail.conPath+"/swAcc.do",t:"POST",fn:e,onerror:function(){$.publish("/mail/accountSwitch",{status:"failed"}),b.reject()},csr:"s",p:{accId:a,mode:"json"},ep:{accId:a}}),b.always(function(){c.remove()}).done(function(){d.succErrMsg("s",k.accSwitchSuccess)}).fail(function(){d.succErrMsg("e",k.accSwitchFail,{noHide:!0})}),b.promise()},B=function(){var b=function(a){var b={};return a=a||{},b.type="checkbox",b.search=a.search||"name",b.display=a.display||"display_text",b.liAttr={},b.showTooltip=!0,b.emptyMsg=a.emptyMsg||"",b.showCreate=b.showCreate||"function"==typeof a.onCreate,b.showCheckbox=a.showCheckbox||"function"==typeof a.onStateChange,b.data=a.data&&Array.isArray(a.data)?a.data:[],"function"==typeof a.dataCallback&&(b.data=a.dataCallback()),b.showCheckbox?"function"==typeof a.onSelect?b.onSelect=a.onSelect:b.onSelect=function(b){var c=void 0,d=b.type;"uncheck"===b.type||"partial"===b.type?(b.chkboxState(b,"check"),c=!0):(b.chkboxState(b,"uncheck"),c=!1),"function"==typeof a.onStateChange&&a.onStateChange(b.id,c,function(){b.chkboxState(d)},b.name)}:b.onSelect=function(b){"function"==typeof a.onSelect&&a.onSelect(b.id)},b.showCreate&&(b.addNew=function(b,c,d){a.onCreate(c,(d||{}).clrCode)}),h.folderLabel(b)},c=function(b){var c=a("zmfolAction"),e=a("zmlab"),f={},g=zmail.labInfo,i={},j={};return f.type="label",f.search="name",f.display="display_text",f.liAttr={},f.showTooltip=!0,f.emptyMsg=b.emptyMsg||"",f.showCreate="function"==typeof b.onCreate,f.showCheckbox="function"==typeof b.onStateChange,"default"===b.accType&&(g=d.getTagList("default")),f.showCheckbox&&(b.labelState.selectedMails?i=e.labelSelectionInfo({type:"selected"}):b.labelState.mailList?i=e.labelSelectionInfo({type:"list",list:b.labelState.mailList}):b.labelState.labelList?b.labelState.labelList.forEach(function(a){i[a]="check"}):"function"==typeof b.labelState.dataCallback&&(i=b.labelState.dataCallback())),b.excludeList&&b.excludeList.forEach(function(a){j[a]=!0}),i=i||{},f.data=[],Object.keys(g).forEach(function(a){j[a]||f.data.push({id:a,name:g[a].label,display_text:c.getShortFolderPath(g[a].dispName,{maxLength:20}),color:g[a].color,type:i[a]||"uncheck",tooltip:g[a].dispName})}),b.newLabels&&b.newLabels.forEach(function(a,b){f.data.push({id:void 0,name:a,display_text:c.getShortFolderPath(a,{maxLength:20}),color:e.DEFAULT_COLOR,type:i[a]||"uncheck",tooltip:a})}),b.showAllItem&&f.data.unshift({id:"all",name:k.common.all,display_text:k.common.all,color:e.DEFAULT_COLOR,type:"uncheck",tooltip:k.common.all}),f.showCheckbox?f.onSelect=function(a){var c=void 0,d=a.type;"uncheck"===a.type||"partial"===a.type?(a.chkboxState(a,"check"),c=!0):(a.chkboxState(a,"uncheck"),c=!1),b.onStateChange(a.id,c,function(){a.chkboxState(d)},a.name)}:f.onSelect=function(a){"function"==typeof b.onSelect&&b.onSelect(a.id)},f.showCreate&&(f.addNew=function(a,c,d){b.onCreate(c,(d||{}).clrCode)}),h.folderLabel(f)},e=function(a){var b={},c=void 0;return b.type="folder",b.search="name",b.display="display_text",b.liAttr={},b.showTooltip=!0,b.onTab=a.onTab||"",b.ui=a.ui||{},b.emptyMsg=a.emptyMsg||"",b.showCreate="function"==typeof a.onCreate,c=a.showAllItemText||k.common.all,b.data=a.data||[],"function"==typeof a.dataCallback&&(b.data=a.dataCallback()),a.showAllItem&&b.data.unshift({id:"all",name:c,display_text:c,tooltip:c}),b.onSelect=function(b){"function"==typeof a.onSelect&&a.onSelect(b.id,b)},b.showCreate&&(b.addNew=function(b,c){a.onCreate(c)}),h.folderLabel(b)},f=function(a){var b={},c=void 0;return b.type="sub-folder",b.search="tooltip",b.display="name",b.liAttr={},b.showTooltip=!0,b.onTab=a.onTab||"",b.emptyMsg=a.emptyMsg||"",b.showCreate="function"==typeof a.onCreate,c=a.showAllItemText||k.common.all,b.data=[],"function"==typeof a.dataCallback&&(b.data=a.dataCallback()),a.showAllItem&&b.data.unshift({id:"all",name:c,display_text:c,tooltip:c}),b.onSelect=function(b){"function"==typeof a.onSelect&&a.onSelect(b.id,b)},b.showCreate&&(b.addNew=function(b,c,d){a.onCreate(c,(d||{}).parentId)}),h.folderLabel(b)},g=function(a){var b={},c=void 0;return b.type="folder-path",b.search="tooltip",b.display="name",b.liAttr={},b.showTooltip=!0,b.onTab=a.onTab||"",b.emptyMsg=a.emptyMsg||"",b.showCreate="function"==typeof a.onCreate,c=a.showAllItemText||k.common.all,b.data=[],"function"==typeof a.dataCallback&&(b.data=a.dataCallback()),a.showAllItem&&b.data.unshift({id:"all",name:c,display_text:c,tooltip:c}),b.onSelect=function(b){"function"==typeof a.onSelect&&a.onSelect(b.id,b)},b.showCreate&&(b.addNew=function(b,c){a.onCreate(c)}),h.folderLabel(b)},i=function(b){var c=a("zmfolAction");return!!c.isDeletedFolder(b)},j=function(b){var c=a("zmfolAction"),d={},e={},f={},g=[];return b.excludeList&&b.excludeList.forEach(function(a){e[a]=!0}),d.data=[],g=c.getMailFolderPaths()||[],g.forEach(function(a){e[a.id]||b.excludeChild&&e[a.parentID]||(f={id:a.id,name:a.name,display_text:c.getShortFolderPath(a.path,{maxLength:20}),tooltip:a.path},b.isFilterConfig&&(f.disableAddBtn=i(a.id)),b.removeDeletedFolder?(f.isDeletedFolder=i(a.id),f.isDeletedFolder||d.data.push(f)):d.data.push(f))}),b.dataCallback=function(){return d.data},b},l=function(a){return g(j(a))},m=function(a){return e(j(a))},n=function(a){return f(j(a))},o=function(a){return a=a||{},a.type="label",a.ui={search:!1,label:{color:!1}},h.folderLabel(a)},p=function(a){return a=a||{},a.type="groups",a.ui={search:!0,label:{color:!1},showUnreadCount:a.showUnread},h.folderLabel(a)},q=function(f){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h="zm_flpopup",i=g.hltClass||"SC_ddn",j=void 0,k=!0,q=$(g.parentDOM),r=void 0,s=void 0,t=q[0]&&q[0].getBoundingClientRect()||{},u=g.direction||"pleft",v=void 0,w=void 0,x=a("zmDropDownMenu");"folder"===f?j=m(g):"label"===f?j=c(g):"checkbox"===f?j=b(g):"genericWithCheckBox"===f?(j=o(g),k=!1):j="groups"===f?p(g):"folder-path"===f?l(g):"sub-folder"===f?n(g):e(g),j=$(j),j.attr("id",g.domID||h),v=j.find(".js-scrolldiv"),w=v[0].getBoundingClientRect(),g.fromSelect&&v.css({height:w.height+"px","max-height":"200px"}),"label"!==f&&g.parWidth&&t.width&&(g.fromSelect?v.css("width",t.width-2):v.css("width",t.width)),j.on("mousedown",function(a){d.stopEvents(a,!0)}),s={par:q,showArrow:"popup"===g.displayAs,liDom:[j[0]],align:u,disableShortCut:!0,container:document.body,spanElement:v,scrollElement:$(v),spanClass:g.spanClass,removeLi:!0,showSearch:k,fromSelect:g.fromSelect||!1},"popup"===g.displayAs&&(s.fromFolderLabel=!0),r=new x,g.divId&&(s.divId=g.divId),r.setDropObj(s);var y=function(){j&&(g.hltPar&&(g.hltDOM?$(g.hltDOM).removeClass(i):q.find("b").removeClass(i)),j.removeClass("shw"),j.css("display","none"),j.remove(),j=void 0,g.onHide&&g.onHide(),r&&r.remove(),r=void 0,g.onHide&&g.onHide())},z=function(){g.hltPar&&(g.hltDOM?$(g.hltDOM).addClass(i):q.find("b").addClass(i)),j.addClass("shw"),j.css("display",""),r&&r.paint(),w=v.find("ul")[0].getBoundingClientRect(),g.fromSelect?v.css({height:w.height+"px","max-height":"200px"}):"checkbox"===f&&v.css({height:w.height<50?50:w.height+"px","max-height":"200px"});var a=j.find("INPUT").eq(0);return a.length&&setTimeout(function(){a[0].focus()},300),$.publish("/mail/menuCreated",{menuHandler:y}),r&&r.dropObj.mountPosition};return{elem:j,show:z,hide:y}};return{create:q}}(),C={createFolder:function(b){var c=a("zmfolAction"),d=$.Deferred();return c.isValidName(b,void 0,{opType:"new"})?(c.sendNewFolderReq(b,{reqDoneClbk:function(a,b){a?d.resolve({folderID:b}):d.reject()}}),d.promise()):(d.reject(),d.promise())},createTag:function(b){var c=a("zmlab"),d=$.Deferred();return c.isValidName(b)?(c.labelCreate(b,"",{reqDoneClbk:function(a,b){a?d.resolve({tagID:b}):d.reject()}}),d.promise()):(d.reject(),d.promise())}},D=function(){var a=void 0,b=void 0,c={},e=void 0,f=500,g={bookmarkActionBox:'<i id="zmquickbookmark" title="'+k.common.addbookmark+'"style="display:none; position: absolute"class="msi-links zmIB"></i>'},h=function(a,b){return a instanceof b},i=function(){h(a,$)&&a.length&&(a.remove(),a=void 0)},j=function(){var a=b.attr("href");i(),d.loadLink({mode:"create",link:a,groupId:c.groupId})},l=function(){i()},m=function(a){a.stopPropagation(),window.clearTimeout(e)},n=function(){a.off("click").on("click",j),a.off("mouseleave").on("mouseleave",l),a.off("mouseover").on("mouseover",m)},o=function(){if(!h(a,$)||!a.length){a=$(g.bookmarkActionBox);var b=$("body").find("#wmstoolbar");b.length?b.before(a):$("body").append(a),n()}},p=function(a){return a.offset()},q=function(a){var b=a.attr("href");return d.isURL(b)},r=function(){$.publish("/mail/menuCreated",{menuHandler:function(){window.setTimeout(i,200)}})},s=function(b){var c;q(b)&&(o(),r(),c=p(b),a.show().css({top:c.top-5,left:c.left+b.outerWidth()+5}))},t=function(a){b.off("mouseleave.addAnchorTagHover"),e=window.setTimeout(function(){i()},f)},u=function(){b.off("mouseleave.addAnchorTagHover").on("mouseleave.addAnchorTagHover",t)},v=function(a,d,f){var g,h=f.target||f.srcElement;if("A"!==h.nodeName){if(g=$(h).closest("a").not(d.ignoreSelector.join()),!g.length)return;h=g[0]}else if(!$(h).not(d.ignoreSelector.join()).length)return;b=$(h),window.clearTimeout(e),c=a||{},u(),s(b)};return function(a,b){d.isSmartMenuOptionEnabled()&&!zmail.fromOtherService&&(b=b||{groupId:zmail.zuid},$(a.applyDOM).not(a.ignoreSelector.join()).off("mouseover.addAnchorTagHover").on("mouseover.addAnchorTagHover",v.bind(null,b,a)))}}(),E=function(){return j.load("links")},F=function(){return j.load("crminteg")},G=function(){return j.load("mailCollaboration").then(function(){d.debugLog("mailCollab JSLoad complete callback",arguments)})},H={},I=function(a){""===a&&(a="mail listing"),H.searchKey=a,zmail.supportWidget&&zmail.supportWidget.updateSearchKey(0,a)},J=function(a){H.emailId=a,zmail.supportWidget&&zmail.supportWidget.updateTicketDetails({supportId:a})},K=function(a){return H[a]},L=function(b){j.load("zmsitetour").then(function(){var c=a("zmTour");c.initAppTour(b)})},M=function(b){j.load("mailTour").then(function(){var c=a("zmTour");c.apps.mail.init({type:b})})},N=function(b,c,e){var f=a("zmTour"),g=e&&e.version?e.version:"all";b?f.callAppSpecificTour(b,c):"all"===g&&d.createTour()},O=function(a){for(var b=0,c="",d=["B","KB","MB","GB"];a>1023;)a/=1024,b++;return 0===b?c=Math.ceil(a/1024)+" KB":(a=Math.ceil(a),c=a+" "+d[b]),c},P=function(a){if(!isNaN(a)){var b=[" bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"],c=Math.floor(Math.log(Number(a))/Math.log(2));c<1&&(c=0);var d=Math.floor(c/10);return a=Number(a)/Math.pow(2,10*d),a.toString().length>a.toFixed(1).toString().length&&(a=a.toFixed(1)),a+b[d]}},Q=function(a,b){return a instanceof b},R=function(a,b){try{a||(a=window.event),a.stopPropagation?(b||a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1)}catch(c){}},S=function(a,b){var c="`~!@#$%^&*()+=[]\\';,./{}|\":<>?",d=void 0;"labelName"===b||"folderName"===b?c="`~#%^&*\\;,/|:<>?":"dispName"===b&&(c=""),d=c.length;for(var e=0;e<d;e++)if(a.indexOf(c.charAt(e))!==-1)return!0;return!1},T=function(){var a=/[{}[\]()\/'"=<>]+/gim;return function(b){a.lastIndex=0,b=b||"";var c=b.match(a);return!(!c||!c.length)}}(),U=function(){var a="";return function(b){var c=b.ele,e=b.target,f=b.callback,g=b.maxLength||50,h=b.parentdiv,i=b.initialize,j=!1,k=!0,l=void 0;b.allowCondition&&(k=b.allowCondition()),k&&(l=h.find("[contentEditable='true']"),l.length>0?c[0].id!==l[0].id&&(l[0].contentEditable="false",l.text(a),j=!0):j=!0,j&&(a=c.text(),c[0].contentEditable="true",i?(c.text(e.children("span").text()),c.focus(),document.execCommand("selectAll",!1,!1)):(c.html("&nbsp;"),c.focus()),c.off("keypress").on("keypress",function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&d.stopEvents(a)}),c.off("keydown").on("keydown",function(a){return function(b){var e=b.keyCode?b.keyCode:b.which,h=b.ctrlKey,i=String.fromCharCode(e).toLowerCase();13===e?f():27===e?(c[0].contentEditable="false",c.text(a),d.stopEvents(b)):!(8===e||46===e||e>=33&&e<=40)&&c.text().length>g-1?d.stopEvents(b):!h||"b"!==i&&"i"!==i&&"u"!==i||d.stopEvents(b)}}(a))))}}(),V=function(a,b){return a="u"===b?a.replace(/#34/gi,'"').replace(/&#39;/gi,"'"):a.replace(/"/gi,"#34")},W=function(a){return a=a.replace(/&#39;/gi,"'").replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},X=function(){for(var a in zmail.aInfo)if("1"===zmail.aInfo[a].accountType)return a},Y=function(a,b,c){var d=parseInt(b*screen.width/100),e=parseInt(c*screen.height/100),f=(screen.width-d)/2,g=(screen.height-e)/2;return window.open(a,(new Date).getTime(),"height="+e+", width="+d+",status=yes,toolbar=no,top="+g+", left="+f+",scrollbars=yes,resizable=yes")},Z=function(){zmail.IntegrationStatus.CHAT&&!zmail.fromOtherService?$(document.body).removeClass("SC_ncb"):$(document.body).addClass("SC_ncb")},_=function(){Z(),zmail.IntegrationStatus.CHAT?$("#wmstoolbar").show():$("#wmstoolbar").hide()},aa=function(){var b=a("WebMessanger"),c=a("WMSSessionConfig"),d=!1;try{zmail.isRebranded&&b.useSameDomain(),zmail.isFuji&&b.setRebrand("fuji"),b.enableTokenPairAuth(),b.setNoDomainChange()}catch(e){}b.setLocale(zmail.user.lang,zmail.user.countrycode);var f=c.CHAT|c.CHAT_PRESENCE|c.PRESENCE_ORG|c.PRESENCE_PERSONAL|c.MULTI_DISPATCH|c.CROSS_PRD;b.setConfig(f),b.setZIndex("auto"),("false"===zmail.showTop||zmail.fromOtherService)&&(d=!0),b.register("VO",zmail.zuid,d),zmail.fromOtherService||b.enableGlobalSearch()},ba=function(){Promise.all([j.loadFiles("extjs",zmail.wms.wmsjs),j.loadFiles("extcss",zmail.wms.wmscss)]).then(function(){j.load("wmsInteg").then(function(){aa(),zmail.fromOtherService||$.publish("mailsuite/chatIconsInit")})})},ca=function(){document.selection?document.selection.clear():window.getSelection().removeAllRanges()},da=function(a){var b=function(a){var b=void 0,c=void 0,d=void 0,e=void 0;b=a.target||a.srcElement,d=$(b),e=d.attr("id"),c=e&&!e.indexOf("zmW")?d.closest(".SC_pvn"):d.closest(".SC_pv"),d.scrollTop()?c.hasClass("SC_scroll")||c.addClass("SC_scroll"):c.removeClass("SC_scroll")};b({target:a[0]}),a.off("scroll",b),a.on("scroll",b)},ea=function(a){return!!zmail.folCount[a]},fa=function(a,b){try{if(a&&zmail.shrTree.length){var c=zmail.shrTree[0][a];return b&&c&&91===c.RT?"R"===b?"11"===c.ROLE:"W"===b?"12"===c.ROLE:"WD"===b?"13"===c.ROLE:"RW"===b?"11"===c.ROLE||"12"===c.ROLE:"isWritable"===b&&("12"===c.ROLE||"13"===c.ROLE):!(!c||"-1"===c.SHID)}return!1}catch(e){return d.debugLog(e),!1}},ga=function(a){return"zm_unread"===a||"zm_all"===a||"zm_flag"===a},ha=function(a){return!!zmail.labInfo[a]},ia=function(a){var b=zmail.labInfo[a];return!(!b||"1"!==b.system)},ja=function(a){var b=zmail.shrTree[0][a];return b&&"-1"!==b.SHID?b.SHID:""},ka=function(a){var b="";for(var c in zmail.shrTree[0])zmail.shrTree[0][c].SHID===a&&(b=c);return b},la=function(a){return a=a||"",a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"$&")},ma=function(a){var b=!1;return a===d.getZohoAccId()&&(b=!0),b},na=function(b){var c=a("zmDropDownMenu"),d=void 0;return d=new c,d.setDropObj(b),d.paint(),d},oa=function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},pa=function(a){j.load("crminteg").then(function(){zmail.crmInteg.init.getModel(a)})},qa=function(a){j.load("eventsinteg").done(function(){a()})},ra=function(a){j.load("projectsinteg").done(function(){a()})},sa=function(b){if(!e.isMaxLimitReached()){var c;b&&"popup"===b.type&&(c=h.loadingBand({container:document.body,type:"pagination"})),j.load("smartcompose").then(function(){var d=a("zmSCompose");c&&c(),b?d.init(b):d.init({eType:"6",type:"tab"})})}},ta=function(b){j.load("attachmentUtility").then(function(){var c=a("zmAttachUtility");c.addEventsToCal(b)})},ua=function(a){try{var b=[],c=[];"undefined"==typeof ZDDialog?(zmail.staticUrls&&zmail.staticUrls.docsJS||(zmail.staticUrls=zmail.staticUrls||{},zmail.staticUrls.docsJS="//"+zmail.jstatic+"/personal/"+zmail.docsStaticVersion+"/docscomponents/js/docscomponent_mail.js",zmail.staticUrls.docsCSS="//"+zmail.jstatic+"/personal/"+zmail.docsStaticVersion+"/docscomponents/css/lightgrey/docscomponent_mail.css"),b.push(zmail.staticUrls.docsJS),c.push(zmail.staticUrls.docsCSS),j.loadFiles("extcss",c),j.loadFiles("extjs",b).then(function(){a&&a()})):a&&a()}catch(e){d.debugLog("DEBUG",e)}},va=function(){return!("function"!=typeof window.ActiveXObject||!document.documentMode)},wa=function(a,b,c,d,e,f){var g=void 0,h=void 0;e?(g=b,h=c):(g=a.find("#"+b),h=a.find("#"+c));var i=a.scrollTop(),j=g.offset().top,k=h.offset().top,l=a.height()/2,m=void 0,n=void 0;"prev"===d?(n=k-j,a.scrollTop(i-n)):"next"===d&&(n=j-k,a.scrollTop(i+n)),f||(j<0?(m=l-j,a.scrollTop(i-m)):j>a.height()&&(m=j-l,a.scrollTop(i+m)))},xa=function(){var b=a("zmSearchUtil"),c=e.getAppObj(),d=void 0;for(d in c)d.indexOf("zm_tab")===-1&&"attView"!==d||e.closeWorkspace(d),d.indexOf("zm_srch")===-1||"m"!==b.getSearchAppType()||b.isNewSearch()||e.closeWorkspace(d)},ya=function(a){try{a=encodeURIComponent(a)}catch(b){}return a},za=function(a){var b="<div/>",c=$(b).text(a||"");return c.html()},Aa=function(a,b){var c=b?"<textarea/>":"<div/>",d=$(c).html(a||"");return b?d[0].value:d.text()},Ba=function(){var a=/(&#?[^\s&#;]+;)/gim,b=document.createElement("div"),c={};return function(d){return d?(a.lastIndex=0,d=d.replace(a,function(){var a,d=arguments[1];return d?c[d]?c[d]:(b.innerHTML=d,a=b.textContent||b.innerText,c[d]=a,a):""})):""}}(),Ca=function(){var a=f("#","wmstoolbar"),b=a?a.getBoundingClientRect().height:0;return b},Da=function(a){var b=!1;return Object.keys(zmail.folId).forEach(function(c){a===zmail.folId[c]&&(b=!0)}),b},Ea=function(a,b){var c="",e="",f="",g=/\d{1,2}/g,h=/\d{1,3}/g,i=d.reverseString;if("undefined"!=typeof a)return a<0&&(f="-"),a=String(a),a.indexOf(".")!==-1&&(c="."+a.substr(a.lastIndexOf(".")+1),a=a.substring(0,a.lastIndexOf("."))),a.length<4?f+a+c:b?f+i(i(a).match(h).join(","))+c:(e=","+a.substr(a.length-3),a=a.substr(0,a.length-3),f+i(i(a).match(g).join(","))+e+c)},Fa=function(a){var b="",c=void 0;for(a=a||"",c=a.length;c>=0;c--)b+=a.charAt(c);return b},Ga=function(b){if(b&&$(b).length){var c=a("ZMail.lConstants").cls;$(b).closest("."+c.ritClk).removeClass(c.ritClk)}},Ha=function(a,b,c){c=c||Object.keys(b);var d=c.length,e=void 0,f=void 0;for(f=0;f<d;f++)e=c[f],a[e]=b[e]},Ia=function(a,b,c){var d=a.indexOf(b),e=a.indexOf(c);return d<e?a.slice(d,e+1):a.slice(e,d+1)},Ja=function(a){var b={},c=a.input,d=a.textElem||a.input,e=a.checkInterval||200,f=a.idleTime||500,g=a.checkContent||!1,h=void 0,i=void 0,j=void 0,k=void 0,l=function(){var b=j||"",c="";c="TEXTAREA"===d.tagName||"INPUT"===d.tagName?d.value:$(d).text(),c=c||"",j=c,b.length!==c.length&&a.callback()},m=function(){var b=Date.now(),c=b-i;c>=f&&(g?l():k||(a.callback(),k=!0))},n=function(){i=Date.now(),k=!1},o=function(){n(),l(),h=setInterval(m,e)},p=function(){n(),l(),clearInterval(h)};if(c)return $(c).on("focus",o),$(c).on("blur",p),$(c).on("keyup",n),$(c).on("paste",l),$(c).on("cut",l),b.unbind=function(){$(c).off("focus",o),$(c).off("blur",p),$(c).off("keyup",n),$(c).off("paste",l),$(c).off("cut",l)},b},Ka=function(){var a=/((?=http|https)[\S]*:\/\/[\S]+)|([\S]*(?:\w{2}\.\w+\.\w+)[\S]*)/gi,b=/((?=http|https)[\S]*:\/\/[^\s"]+)/gi;return function(c,d){var e=[];d=d||{};var f=d.httpOnly||!1,g=null,h=!1,i=void 0;for(i=a,f&&(i=b),i.lastIndex=0;!h;)if(g=i.exec(c),null===g)h=!0;else{g.index===i.lastIndex&&i.lastIndex++;var j=g[0]||"";j.indexOf("@")!==-1&&j.indexOf("/")===-1||e.push({url:j,startIndex:g.index,endIndex:g.index+j.length})}return e}}(),La=function(a){var b=document.createElement("img"),c=void 0,d=!1;return b.onload=function(){d=!0,c&&c(b)},b.onerror=function(){d=!0,c&&c()},b.src=a||"",{then:function(a){"function"==typeof a&&(c=a),d&&c&&c(b)}}},Ma=function(){var a=zmail.labInfo,b=void 0,c=[];for(b in a)"1"===a[b].system&&c.push(b);return c},Na=function(){var a=document.createElement("a");return function(b){return(b=b||"")?(a.href=b,a.hostname||""):""}}(),Oa=function(a){return"default"===a?zmail.zohoAccLabInfo:zmail.labInfo},Pa=function(){var a=Array.prototype.slice.apply(arguments);a.unshift("ZM_DEBUG : ("+new Date+") > "),zmail.debug===!0&&window.console.log.apply(window.console,a)},Qa=function(b){b.appId&&b.app&&b.appObj&&b.category&&a("zmState").saveTabState(b.appId,b)},Ra=function(a,b){$(a).length&&$(b).length&&$(b).animate({scrollTop:$(b).scrollTop()+$(a).offset().top-$(b).offset().top})},Sa=function(a,b){if(e.isWorkspaceAvailable(a)){var c=e.getCenter(a)[1].getNodes()[0].$el,d=c.find(".msi-prev").parents("b"),f=c.find(".msi-next").parents("b");"prev"===b?d.unbind("click").addClass("SC_opy3"):"next"===b?f.unbind("click").addClass("SC_opy3"):(d.unbind("click").addClass("SC_opy3"),f.unbind("click").addClass("SC_opy3"))}},Ta=function(a,b){if(e.isWorkspaceAvailable(a)){var c=e.getCenter(a)[1].getNodes()[0].$el,d=c.find(".msi-prev").parents("b"),f=c.find(".msi-next").parents("b");"prev"===b?d.removeClass("SC_opy3"):"next"===b?f.removeClass("SC_opy3"):(d.removeClass("SC_opy3"),f.removeClass("SC_opy3"))}},Ua=function(){return zmail.windowVisibility},Va=function(){var a=-1;if("Notification"in window){var b=Notification&&f.getProperty(Notification,"permission");switch(b){case"default":case 1:a=1;break;case"granted":case 0:a=0;break;case"denied":case 2:a=2}}return a},Wa=function(){var a=void 0,b=zmail.aInfo||{};for(var c in b)if(c=String(c),a=b[c],"1"===String(a.accountType))return c},Xa=function(a){try{var b="",e=$(a).text(),f=zmail.Utils.TextUtil.calculateReadTime(e)/1e3/60,g=Math.floor(f),h=100*Math.round(.6*(f-g));return 0!==g?(h>30&&(g+=1),b=g>60?c.applyArgs(k.readTime.hrRead,{time:"> 1"}):c.applyArgs(k.readTime.minRead,{time:g})):h>59?(g+=1,b=c.applyArgs(k.readTime.minRead,{time:g})):b=c.applyArgs(k.readTime.minRead,{time:"< 1"}),b}catch(i){return d.debugLog(i),""}},Ya=function(a){var b="https://www.facebook.com/sharer/sharer.php?sdk=joey&u="+encodeURIComponent(a)+"&display=popup&ref=plugin&src=share_button";d.openWindow(b,500,600)},Za=function(a){var b="https://twitter.com/intent/tweet?text="+encodeURIComponent(a);d.openWindow(b,500,600)},$a=function(){return!0},_a=function(){
return zmail.isOrg&&zmail.IntegrationStatus.CHAT},ab=function(){return!0},bb=function(b){if(b&&"B"!==!$(b)[0].tagName&&(b=$(b).parents("b")),!$(b).hasClass("zm_snd")){var c,e=a("zmPrev"),g=a("_"),h=e.prevDetails().msgId,k=d.getMailObj(h);$(b).addClass("zm_snd"),h&&i.XHR({u:zmail.conPath+"/mailCollab.do",p:{mailID:h,useConversation:Boolean(k.T),zohoID:zmail.zuid,accountID:zmail.defAccId,requiredData:"recipientList",mode:"getMailShareData",streamsView:!0},t:"POST"}).done(function(a){if(a=a[1]){var d=a.recipientList;c=d[0].orgUsers}var e=k.T||h,i={id:e,groupId:zmail.zuid,elm:b,title:f.unescapeTags(k.SB)};if($.isEmptyObject(c)||(i.zuids=c),k.HC>0){var l=zmail.prevMails[e];if(l){var m=f.getProperty(l,"data.mdata.CALOBJ.attendee");if(m){var n=g.pluck(m,"zuid");i.zuids=i.zuids||[],i.zuids=i.zuids.concat(n)}}}j.load("chatlet").then(function(){zmail.Components.Chatlet.core.init(i)})})}},cb=function(){$.subscribe("contacts/openingCard",function(a,b){var c=[];b=b||{},!d.isChildWindow()&&zmail.IntegrationStatus.CRM&&zmail.isCRMServiceUser&&"mail"===b.source&&(c.push({htm:k.common.viewcrminfo,clk:function(a){d.hideMenu(),d.loadCrm(a.eid)},id:"crminfo"}),b.insertItems(c))})};cb();var db=function(){function a(b){babelHelpers.classCallCheck(this,a),this.opts=b||{},this.constructDOM()}return babelHelpers.createClass(a,[{key:"getData",value:function(){var a=this.opts;return"function"==typeof a.dataCallback?a.dataCallback():a.data}},{key:"getValue",value:function(){return this.opts.selValue}},{key:"setValue",value:function(a){var b=this.getData(),c=this.opts,d=c.defaultText||"";b.forEach(function(b){b.id===a&&(d=b.display_text,c.selValue=b.id)}),$(this.component).find("span").text(d)}},{key:"removeClass",value:function(){$(this.component).removeClass("zmSlOn").removeClass("zmSlB")}},{key:"constructDOM",value:function(){var a=this,b=this,c=this.opts,d=c.defaultText||"",e=this.getData(),f=function(b){a.component=b},g=zdom("div",{className:"zmSelect "+(c.selectClass||""),ref:f},zdom("span",null,d));$(c.parent).html(g),this.setValue(c.selValue),this.component.addEventListener("click",function(){var a=c.ui||{};a.hasOwnProperty("search")||(a.search=!1);var d,f={parentDOM:b.component,displayAs:"dropdown",parWidth:c.parWidth,emptyMsg:c.emptyMsg,fromSelect:!0,onHide:function(){b.removeClass(),c.onHide&&c.onHide()},onSelect:function(a){b.setValue(a),c.onSelect?c.onSelect(a).then(function(){b.removeClass(),d.hide()}):(b.removeClass(),d.hide())},data:e,userClassName:"test",ui:a};d=B.create("",f);var g=d.show(),h="";"top"===g?h="zmSlOn":"bottom"===g&&(h="zmSlB"),$(b.component).addClass(h)},!1)}}]),a}(),eb=function(a){return new db(a)},fb=function(a){$(a.target).on("mousedown",function(b){a.mousedownClbk(b),$(document.body).addClass("zmUserSelectNone"),$(document.body).one("mouseup",function(b){$(this).off("mousemove.zmresizehandler"),a.mouseupClbk(b),$(document.body).removeClass("zmUserSelectNone")}),$(document.body).on("mousemove.zmresizehandler",function(b){a.mousemoveClbk(b)})})},gb=function(){if("1"!==g.getStreamsAppMsg()){var a=zdom("div",{className:"zmSAppBanner"},zdom("div",{className:"zmSAppBannerCont"},zdom("div",{className:"zmSAppBannerTxt"},zdom("div",{className:"zmSAppBannerIco"},zdom("span",null),zdom("span",null),zdom("span",null),zdom("i",{className:"msi-streams"})),zdom("div",{className:"zmSAppBannerText"},zdom("span",null,k.streamsAppBanner.title),zdom("h3",null,k.streamsAppBanner.header))),zdom("div",{className:"zmSAppIcon"},zdom("span",{className:"zmSAppleIcon"}),zdom("span",{className:"zmSAndroidIcon"}))),zdom("div",{className:"zmSAppBannerClose"},zdom("i",{className:"msi-close"}))),b=function(){var b=a.getElementsByClassName("zmSAppleIcon")[0];b.onclick=function(a){window.open("https://itunes.apple.com/us/app/streams-for-zoho-mail/id1146252869?ls=1&mt=8","_blank")};var c=a.getElementsByClassName("zmSAndroidIcon")[0];c.onclick=function(a){window.open("https://play.google.com/store/apps/details?id=com.zoho.mail.streams","_blank")};var d=a.getElementsByClassName("zmSAppBannerClose")[0];d.onclick=function(b){a.remove(),g.setStreamsAppMsg("1")};var e=a.getElementsByClassName("zmSAppBannerText")[0];e.onclick=function(a){window.open("https://www.zoho.com/mail/streams-app.html","_blank")}};b(),document.body.contains(a)||document.body.appendChild(a)}},hb={resizeHandler:fb,addSelectMenu:w.addSelectMenu,switchAccount:A,createFLComp:B.create,FLCompCreateAPI:C,requireLinkModule:E,requireCrmInteg:F,updateFaqKey:I,updateSupportId:J,getfaqDetails:K,taskDeferred:void 0,loadAppTour:L,loadMailTour:M,tourVersions:N,isSmartMenuOptionEnabled:u,isURL:v,addAnchorTagHover:D,sizeConv:O,sizeValueUnround:P,checktype:Q,stopEvents:R,hasSpecialChars:S,hasXSSChars:T,setEditable:U,succErrMsg:f.succErrMsg,quotUnEscape:V,replaceHtmlInSubject:W,getZohoAccId:X,openWindow:Y,consContext:t,loadWms:ba,removeDocSelection:ca,setScrollShadow:da,isFolderId:ea,isSharedFolder:fa,isViewId:ga,isLabelId:ha,isSystemLabel:ia,getShareId:ja,getFolderIdwithShId:ka,regExpEscape:la,isZohoAccount:ma,showMenu:na,zmsubStr:oa,loadCrm:pa,loadEvents:qa,loadProjects:ra,loadSmartCompose:sa,addEventsToCal:ta,loadZDocs:ua,isIE:va,initScroll:wa,closeMailTabs:xa,encodeFileName:ya,encodeHTMLEntities:za,decodeHTMLEntities:Aa,replaceHTMLEntities:Ba,wmsBarHeight:Ca,isSystemFolder:Da,commaSeparateNum:Ea,reverseString:Fa,removeRightClickSelection:Ga,mixin:Ha,arrayExtractor:Ia,bindInputTextChange:Ja,parseURLS:Ka,loadImage:La,getSystemLabels:Ma,requireMailCollab:G,getHostName:Na,getTagList:Oa,debugLog:Pa,saveTabState:Qa,setPreviewScroll:Ra,disableNavigation:Sa,enableNavigation:Ta,updateCountForAcc:y,getWindowVisibilityStatus:Ua,getDesktopNotificationPermission:Va,getDefaultAccountID:Wa,textReadTime:Xa,isCRMIntegrationsEnabled:$a,addTaskOnListHover:x,shareonFacebook:Ya,tweet:Za,taskloaded:!1,dropDown:p,msgbean:q,addToFolderCountObj:r,showOverlay:s,getNotify:o,outboxCnt:n,getLayerObj:l,updateListingAfterCompose:m,createContexualChat:bb,isChatletEnabled:_a,toggleChatBar:Z,reRegisterWMS:_,isSelectedShareEnabled:ab,select:eb,setAppBannerDOM:gb};return $.extend(!0,d,hb)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmAjq"),e=void 0,f=!1,g=0,h=!1,i=void 0;zmail.IntegrationStatus={CRM:!1,CHAT:!1};var j=function(a){return!a||!a.integList||1===a.integList[0].status},k=function(a){var b=a.data,c={};b.forEach(function(a,b){c[a.appType]=a}),zmail.IntegrationStatus={CRM:j(c[1002]),CHAT:j(c[1005])},c[1]&&(zmail.IntegrationStatus.dropBox=j(c[1])),c[4]&&(zmail.IntegrationStatus.gDrive=j(c[4])),c[5]&&(zmail.IntegrationStatus.oneDrive=j(c[5])),c[6]&&(zmail.IntegrationStatus.box=j(c[6]))},l=function n(){return(!e||f&&h&&g<=3)&&(e=new Promise(function(a,b){d.XHR({u:"/integPlatform/integAction.do",t:"GET",fn:function(b){if(k(b),$.publish("integration/fetched"),a(b),f&&(f=!1,window.hasOwnProperty("ZMStore"))){var c=ZMStore.getInstance("IntegAppsCollection");c&&(c.afterFetchList(b),$.publish("integration/chatStatusChange"))}},efn:function(){f=!0,g+=1,h=!1,b(),clearTimeout(i),i=1===g?setTimeout(function(){h=!0,n()},2e3):setTimeout(function(){h=!0},5e3)},p:{mode:"AVAILABILITY",action:"GET_INTEG_CONFIGS"}})})),e},m={getIntegStatus:l};return $.extend(!0,c,m)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmail.Utils.DOM"),e=function(){d.removeClass(d.selector(".SC_ddnB"),"SC_ddnB"),d.removeClass(d.selector(".SC_ddn"),"SC_ddn"),d.removeClass(d.selector(".SC_bsel"),"SC_bsel")},f={removeHighlight:e};return $.extend(!0,c,f)}),define([],function(a,b){var c=a("zmUtil"),d=a("_zm"),e=a("zmail.Utils.DOM"),f=function(a,b){var c=void 0,d=void 0;return a=e.element(a),d=a.offset(),c=e.element(zdom("div",{id:"zm_dpHolder",className:"SC_calpick"},zdom("div",{style:{whiteSpace:"nowrap"}}))),b||(b={left:a.outerWidth()+d.left,top:d.top}),c.css({left:b.left,top:b.top}),e.unmount(e.selector("#zm_dpHolder"),!0),e.mount(c,document.body),$.publish("/mail/menuCreated",[{element:c[0]}]),c},g=function(b,d){var g=a("ZEVENTS"),h=void 0,i=void 0,j=void 0;h=e.element(b),i={mode:"inline",today:zmail.userDateVal,dform:zmail.userDateFormat.toUpperCase()},j=f(h),g(j.children("div")[0]).picker("date",i).on("dateclick",function(){var a=void 0;a=this.getDate(),d(a),c.hideMenu()}).bind()},h=function(b,g){var h=a("ZEVENTS"),i=void 0,j=void 0,k=void 0;i=e.element(b),j=f(i),j.mousedown(function(a){d.stopEvents(a,!0)}),k=c.getDateObjFromDate(),h(j.children("div")[0]).picker("range",{wkst:0,dform:zmail.userDateFormat,range:["",c.getDateFromDateObj(k)]}).on("select",function(){g(this.getDateRange.from,this.getDateRange.to),c.hideMenu()}).bind();var l=e.element(e.selector("div",j),!0),m=l[0].getBoundingClientRect(),n=document.body.getBoundingClientRect();m.width+m.left>n.width&&(j[0].style.left="auto",j[0].style.right=n.width-i[0].getBoundingClientRect().left+"px")},i=function(a){var b=void 0,c=void 0,d=void 0,e=void 0;return a&&(b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear()),"dd/mm/yyyy"===zmail.userDateFormat.toLowerCase()?e=b+"/"+c+"/"+d:"mm/dd/yyyy"===zmail.userDateFormat.toLowerCase()&&(e=c+"/"+b+"/"+d),e},j=function(a){var b="",c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;b=a&&a.dateFormat||zmail.userDateFormat,c=a&&a.dateValue||zmail.userDateVal;try{e=c.split("/"),"MM/dd/yyyy"===String(b)?(f=e[0],g=e[1]):"dd/MM/yyyy"===String(b)&&(f=e[1],g=e[0]),h=e[2],d=new Date(h,f-1,g)}catch(i){b="MM/dd/yyyy",d=new Date}return d},k=function(a){var b=new Date,c=a||zmail.timeZoneOffset,d=b.getTime()+6e4*b.getTimezoneOffset(),e=new Date(d+c);return e},l={showDatePicker:g,showDateRangePicker:h,getDateFromDateObj:i,getDateObjFromDate:j,getCurrentDateObj:k};return $.extend(!0,c,l)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmText"),e=a("zmAppLoader"),f=a("zmAjq"),g=a("_zm"),h=a("zmail.Utils.DOM"),i=d.get("commonUtils"),j=function(a){e.load("attachmentUtility").then(function(){c.loadZDocs(a)})},k=function(b,c){e.load("attachmentUtility").then(function(){var d=a("zmAttachUtility");c?c(d.initAttachListing(b)):d.initAttachListing(b)})},l=function(b,c){e.load("attachmentUtility").then(function(){var d=a("zmAttachUtility");c?c(d.listingComp.init(b)):d.listingComp.init(b)})},m=function(){return!zmail.isRebranded||"false"!==zmail.isCloudServiceEnabled&&!zmail.isBaihui},n=function(){var b=$.Deferred();return e.load("securedownload").then(function(){var c=a("zmComponent");c.securedownload().then(function(a){b.resolve(a)},function(){b.reject()})}),b.promise()},o=function(a){var b=void 0,c={entityType:1,accId:a.accId||zmail.accId,fpath:a.fP,fstorename:a.sN};a.name&&(c.fN=encodeURIComponent(a.name)),b=zmail.conPath+"/FileDownload?mode=tmpdwn",f.formSubmit(c,b)},p=function(a){var b=a.e,d="",e={},h=a.n||a.fn,i=void 0;e={attachId:a.Id,entityType:a.et,entityId:a.e},a.sid?(e.groupId=a.sid,e.streamsView=!0,a.gId===zmail.zuid?e.actionType="viewSelfData":e.actionType="viewGroupEntity"):a.type?(2===a.et?e.streamsView="Notes":e.streamsView=!0,e.actionType=a.type,e.groupId=a.gId):(e.groupId=zmail.zuid,1===a.et&&(e.accId=zmail.accId,e.partId=a.p));var j=c.getMailObj(b);if(j&&c.isSharedFolder(j.FD)){var k=c.getShareId(j.FD);e.shId=k,delete e.groupId}i=h.lastIndexOf("."),h=h.replace(/;/gi,""),i!==-1?(h=h.substring(0,i),h=c.encodeFileName(h+"."+c.fileTyp(a.fn)[2])):h=c.encodeFileName(h),d+=zmail.conPath+"/FileDownload?mode=dwn",g.isSecureDownloadEnabled()?n().done(function(a){a.adHocValue&&(e.pswd=a.password),f.formSubmit(e,d)}):f.formSubmit(e,d)},q=function(a,b){a=a||[],b=b||{};for(var d=[],e=void 0,h=void 0,i=void 0,j=0,k=a.length;j<k;j++){h=a[j],i=h.e,e={n:a[j].fn,et:h.et,ft:a[j].ft,e:i,Id:h.Id},h.sid?(e.groupId=h.sid,e.streamsView=!0):h.type?(2===h.et?e.streamsView="Notes":e.streamsView=!0,e.groupId=h.gId):e.groupId=zmail.zuid;var l=c.getMailObj(i);l&&c.isSharedFolder(l.FD)&&(e.shId=c.getShareId(l.FD),delete e.groupId),d.push(e)}var m=zmail.conPath+"/FileDownload?mode=seldwn",o={accId:zmail.accId,attEntObj:JSON.stringify(d)},p=void 0;b.fName&&(o.fName=b.fName),zmail.isDownloadZipOfflineEnabled&&(p={t:"POST",u:m,p:o,setSessionId:!0}),g.isSecureDownloadEnabled()?n().done(function(a){a.adHocValue&&(o.pswd=a.password),zmail.isDownloadZipOfflineEnabled?(p.p=o,f.XHR(p)):f.formSubmit(o,m)}):zmail.isDownloadZipOfflineEnabled?f.XHR(p):f.formSubmit(o,m)},r=function(a,b){var c=$.Deferred();return e.load("dragNDropUtil").then(function(){var d=new zmail.dndComp.dragSourceSibling;d.init(a[0],{onDragStart:function(c){var d=!1,e=void 0,f=void 0,g="",j=b.getAttachments();if(h.hasClass(c,"SC_check"))h.addClass(h.selector(".SC_check",a),"zm_drag"),d=!0,e=j.selectedAttachment,f=j.selectedAttachment.length;else{var k=h.getData(c,"atid");h.addClass(c,"zm_drag"),k&&(d=!0,e=[j.attDet[k]],f=1)}g=1===f?i.attachment.attachment:i.attachment.attachments;var l=zdom("div",{className:"zm_dragger"},zdom("div",{className:"zm_dragCount dragtheme"},f),zdom("div",{className:"zm_dragTxt"},g)),m={allowDrag:d,type:{attObj:e},dom:l,id:"attachView",element:c,cursorPosition:"left"};return $.publish("mail/draggingStarted",{text:i.attachment.dropMsg}),m},setDragInstance:function(a){var b=!1,c=h.element(a.target).parents(".zmL.zmAch");c.length&&(b=!0);var d={setDrag:b,element:c[0]};return d},onDragEnd:function(){h.removeClass(h.selector(".zm_drag",a),"zm_drag"),$.publish("mail/draggingEnded",{})},callback:function(){b.onDragEnd&&b.onDragEnd()}}),c.resolve(d)}),c.promise()},s=function(a){var b=c.fileTyp(a),d={txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,html:!0,htm:!0,xml:!0,go:!0,eml:!0,sh:!0,bat:!0,log:!0},e={xml:!0,js:!0,css:!0},f={mp3:!0,mp4:!0,py:!0,python:!0,properties:!0,conf:!0,text:!0,webm:!0},g=!1,h=void 0;return"msi-attimg"===b[1]||f[b[2]]?(g=!0,h="FileDownload"):"msi-attdoc"!==b[1]&&"msi-attppt"!==b[1]&&"msi-attsheet"!==b[1]||d[b[2]]?("msi-attpdf"===b[1]||"msi-attdoc"===b[1]&&d[b[2]]||"msi-atthtml"===b[1]&&d[b[2]]||"msi-attothers"===b[1]&&d[b[2]])&&(g=!0,h="FileDownload",(window.ActiveXObject||"ActiveXObject"in window)&&e[b[2]]&&(g=!1)):(g=!0,h="OpenDocument"),{isPrev:g,apiName:h}},t=function(a,b){a=a||" ";var c="",d="",e=[],f=a,g=a.length,h=a.lastIndexOf("."),i=void 0;if(h!==-1){c=a.substring(h+1,g).toLowerCase(),g>20&&16!==h&&(i=a.substring(h-1,h),f=a.substring(0,16)+"..."+i+"."+c);var j={doc:!0,docx:!0,sxw:!0,odt:!0,rtf:!0,txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,xml:!0,go:!0,sh:!0,bat:!0,log:!0},k={pps:!0,ppt:!0,pptx:!0,odp:!0,sxi:!0},l={xls:!0,xlsx:!0,sxc:!0,ods:!0,csv:!0,tsv:!0},m={mp3:!0,mpa:!0,wma:!0,wav:!0,ra:!0,m3u:!0,m4a:!0},n={avi:!0,flv:!0,mp4:!0,mpg:!0,wmv:!0,vob:!0,swf:!0,mov:!0,webm:!0,"3gp":!0,rm:!0},o={jpg:!0,jpeg:!0,gif:!0,png:!0,bmp:!0,heic:!0},p={eml:!0,msg:!0},q={ics:!0},r={html:!0,htm:!0};d=j[c]?"msi-attdoc":k[c]?"msi-attppt":l[c]?"msi-attsheet":m[c]?"msi-attaudio":n[c]?"msi-attvideo":"pdf"===c?"msi-attpdf":"zip"===c||"rar"===c?"msi-attzip":o[c]?"msi-attimg":p[c]?"msi-atteml":q[c]?"msi-attics zmDoubleIcon":r[c]?"msi-atthtml":"msi-attothers",4===b&&(d+=" zmHugeFile")}else d="msi-attothers";return e.push(f),e.push(d),e.push(c),e},u=function(a,b){e.load("attachComponent").then(function(){b.attachFrom&&b.attachFrom.indexOf("zDocs")>=0?c.loadZDocs(a):a()})},v=function(){e.load("hugeAttachment")},w=function(){var a=zmail.IntegrationStatus,b=!g.isCloudServiceIntegEnabled||!a||(a.gDrive||a.dropBox||a.oneDrive||a.box);return b},x=function(b,c){var d=function(){var d=a("zmAttachComponent");c&&"function"==typeof c?c(d.init(b)):d.init(b)};u(d,b)},y=function(a,b){var c=a.result;"success"===c?g.succErrMsg("s",i.common.succUpload):g.succErrMsg("e",i.error.errUpload)},z=function(b,d,e,f){c.loadAttachUtilFiles(function(){a("zmAttachUtility").cloudUpload(b,d,e,f)})},A=function(){c.loadAttachUtilFiles(function(){a("zmAttachUtility").addToCloudClose()})},B=function(b){function d(){a("zmAttachUtility").addToCloud(b)}c.loadAttachUtilFiles(d)},C=function(b,c,d,f,g){e.load("slideshowComp").then(function(){var e=a("zmAttachUtility"),h={};b instanceof Array?(h.startIndex=c||0,h.attObjList=b,h.hideAllOptions=d,f&&(h.hideIcons=f.hideOptions,h.addIcons=f.extraIcons),h.targetEle=g):h=b,e.initSlideshow(h)})},D=function(b,c){zmail.newSearch?(zmail.Search.setContext(zmail.Search.Models.Contexts.attachmentSearchContext),e.load("attachmentSearch").then(function(){a("zmAttachment").search.core.newSearch(b)})):e.load("attachmentSearch").then(function(){"s"===b.type||"sender"===b.type?(c=c||{dn:b.srchStr},a("zmAttachmentSearch").core.searchAttachment("sender",c,3)):"filetype"===b.type&&(c=c||{fn:b.srchStr},a("zmAttachmentSearch").core.searchAttachment("filetype",c,4))})},E=function(){var a=new Image;return h.element(a).on("load error",function(){h.unmount(this,!0)}),a},F=function(a){for(var b=void 0,d=void 0,e=void 0,f=0,g=a.length;f<g;f++)e=a[f],101===e.ft&&(d=c.getTheSrc("FileDownload",e),d+="&height=640&width=640",b=E(),h.setAttribute(b,"src",d).hide(),h.hide(b),h.mount(b,document.body))},G=function(a,b){b=b||"";var d=b.lastIndexOf(".");return d>a?b=b.substring(0,a-2)+"..."+c.fileTyp(b)[2]:d===-1&&b.length>a&&(b=b.substring(0,a-2)+"..."),b},H=function(a){a=a||" ";var b=a.substring(0,a.lastIndexOf("."));return b=b.replace(/[`~!@#$%^&*()|+\-=?;:'",.<>{}[\]\\/]/gi,""),encodeURIComponent(b+"."+c.fileTyp(a)[2])},I=function(a,b,d){var e="",f=void 0,g=void 0;void 0===d&&(d="view"),"FileDownload"===a?e=b.isEmlView?zmail.conPath+"/FileDownload?mode=mvAttachView&internalAttachId="+b.IId+"&":zmail.conPath+"/FileDownload?mode="+d+"&":"OpenDocument"===a&&(e=b.isEmlView?zmail.conPath+"/OpenDocument?internalAttachId="+b.IId+"&":zmail.conPath+"/OpenDocument?"),e+="attachId="+b.Id+"&entityType="+b.et+"&entityId="+b.e,1!==b.et||void 0!==b.gId&&b.gId!==zmail.zuid||(e+="&partId="+b.p,void 0===b.sid&&(e+="&accId="+zmail.accId)),b.sid?(f=b.sid,g=b.gId===zmail.zuid?"viewSelfData":"viewGroupEntity",e+="&streamsView=true&actionType="+g+"&groupId="+f):b.type?(f=b.gId,g=b.type,e+="&streamsView=true&actionType="+g+"&groupId="+f):b.gId&&b.gId!==zmail.zuid&&(f=b.gId,g="viewGroupData",e+="&streamsView=true&actionType="+g+"&groupId="+f);var h=c.getMailObj(b.e);return b.shId?e+="&shId="+b.shId:h&&c.isSharedFolder(h.FD)&&(e+="&shId="+c.getShareId(h.FD)),e},J=function(a,b){var d=c.isPreviewAvailable(a.name),e=void 0;return d.isPrev&&(b=b||zmail.accId,e=zmail.conPath+"/"+d.apiName,e+="?mode=tmpview&entityType=1&accId="+b+"&fpath="+encodeURIComponent(a.fP)+"&fstorename="+a.sN),e},K=function(){return zmail.isNettyUploadEnabled},L=function(){return zmail.ishugeAttachmentEnabled},M=void 0,N=function(){var a,b=document.getElementById("zmhgupldserver");a=encodeURIComponent(location.protocol+"//"+zmail.urls.uploadurl+"/home?isRebrandUser="+zmail.isRebranded+"&pd="+location.host),b&&b.parentElement.removeChild(b),b=zdom("iframe",null),b.id="zmhgupldserver",b.style.display="none",b.src=zmail.urls.accURL+"/login?client_auth=true&servicename=ZMUploadDownload&serviceurl="+a,h.mount(b,document.body)},O=function(){var a,b=document.getElementById("zmhgdwnldserver");a=encodeURIComponent(location.protocol+"//"+zmail.urls.downloadurl+"/home?isRebrandUser="+zmail.isRebranded+"&pd="+location.host),b&&b.parentElement.removeChild(b),b=zdom("iframe",null),b.id="zmhgdwnldserver",b.style.display="none",b.src=zmail.urls.accURL+"/login?client_auth=true&servicename=ZMUploadDownload&serviceurl="+a,h.mount(b,document.body)},P=function(b,c){var d=function(b){var c=a("zmAttachUtility"),d=c.errorConstants;if(b===d.authFailed)N();else if(b===d.emptyTicket){var e=document.getElementById("zmhgupldserver");M&&e?e.contentWindow.postMessage("zmudTic",location.protocol+"//"+zmail.urls.uploadurl):N()}};if(c)return void d(c);var e=new XMLHttpRequest;e.open("GET","https://"+zmail.urls.uploadurl+"/verify?isRebrandUser="+zmail.isRebranded,!0),e.withCredentials=!0,e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE){var a=JSON.parse(e.responseText);a[0]&&a[0].errorCode&&d(a[0].errorCode)}},e.send()},Q=function(b){var c=a("zmAttachUtility"),d=c.errorConstants;if(b===d.authFailed)O();else if(b===d.emptyTicket){var e=document.getElementById("zmhgdwnldserver");M&&e?e.contentWindow.postMessage("zmudTic",location.protocol+"//"+zmail.urls.downloadurl):O()}},R=function(a){var b,c=a.origin||a.originalEvent.origin;c!=="https://"+zmail.urls.downloadurl&&c!=="https://"+zmail.urls.uploadurl||(b=a.data,"init"===b?c==="https://"+zmail.urls.downloadurl?O():N():0===b.indexOf("zmud$$")&&(M=b.split("zmud$$")[1]))};(K()||L())&&(N(),window.addEventListener("message",R,!1)),L()&&O();var S={initAttachListing:k,createAttachListingWorkspace:l,isPreviewAvailable:s,fileTyp:t,downloadTempAttachment:o,downloadAttachment:p,isAddToCloudAllowed:m,initAttachComponent:x,cloudCallBack:y,cloudUpload:z,cloudClose:A,cloudUploader:B,loadAttachUtilFiles:j,initAttSlideShow:C,listAttachmentInAttSearchView:D,cacheImageForPreview:F,getSubString:G,getDummyFilename:H,getTheSrc:I,getSrcForTempAtt:J,isNettyUploadEnabled:K,isHugeAttachmentUploadEnabled:L,setHugeUploadCookie:N,validateAttachKey:P,handleNettyDownloadError:Q,downloadSelected:q,loadHugeAttachComponent:v,setDragAndDrop:r,showAddToCloudTab:w};return $.extend(!0,c,S)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmAppLoader"),e=[{value:"0",dispname:"Blue"},{value:"1",dispname:"Green"},{value:"2",dispname:"Yellow"},{value:"3",dispname:"Red"}],f=function(a){return d.load(a||"notes")},g=function(){return!0},h=function(a){if(e.value[0]===a)return e.dispname},i=function(b,d){c.requireNotesModule("noteutil").done(function(){var c=a("zNote");"removeNoteFromView"===b?c.removeNoteFromView(d.mountingElem):"removeNoteFromViewPreviewCard"===b&&c.removeNoteFromViewPreviewCard(d.mountingElem)})},j=function(b){c.requireNotesModule("noteutil").done(function(){var c=a("zNote");c.invokeNoteSearch(b)})},k=function(b,d,e){var f=$.Deferred();return c.requireNotesModule("smartnote").done(function(){var c=a("zNote");c.getSmartNote(b,d,e).done(function(a){f.resolve(a)})}),f.promise()},l=function(b){var d=$.Deferred();return c.requireNotesModule("noteutil").done(function(){var c=a("zNote");c.loadAndCategoryArray(b).done(function(a){d.resolve(a)})}),d.promise()},m=function(b){var e=a("zmHash").decode(b.href),f=e.key,g=e.params;if("notes"===f)if("preview"===g[0])c.loadNotes("openNote",{gId:g[1],e:g[2]});else if("tab"===g[0])c.loadNotes("openNoteInTab",{gId:g[1],e:g[2]});else{var h={};h.hashParams=g,h.data={router:!0},d.load("notes").done(function(){var b=a("zmApp");b.showApp("n",h)})}},n=function(){var b=a("_zm");b.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:".*/zm/#notes/.*",callback:m})},o=function(b,d,e){c.requireNotesModule("noteutil").then(function(){var f=a("zNote");if("popup"===b){var g={};d&&d.richText&&(g.richText=!0,d.richText=void 0),c.requireNotesModule("noteadd").done(function(){f.loadAddNote(d,g)})}else"openNote"===b?f.loadAndOpenNote({namespaceId:d.gId,id:d.e},{type:"popup"}):"openNoteInTab"===b?f.loadAndOpenNote({namespaceId:d.gId,id:d.e,commentId:d.commentId},{type:"tab"}):"openNoteInPreview"===b?f.loadAndOpenNote({data:d.data,options:d.options},{type:"preview"}):"addNote"===b?f.loadAddNote(d,{mountingElem:e.ele,doneCallback:e.callback}):"viewNote"===b?f.streamListNote(d,e.ele):"commentNote"===b?f.loadAddNote(d,{mountingElem:e.ele,commentNote:!0,doneCallback:e.callback}):"notelist"===b?f.getNoteList(d.data,d.extraparams,d.mountingElem,d.postCallback):"openNote"===b?f.loadAndOpenNote({namespaceId:d.gId,id:d.e},{type:"popup"}):"printNote"===b&&f.loadAndOpenNote({data:d.data},{type:"print"})},function(){c.debugLog("zmUtil.loadNotes - REQUIRE module failed to load files")})},p={requireNotesModule:f,loadNotes:o,removeComponentsFromView:i,isNoteReactUser:g,invokeNoteSearch:j,getSmartNote:k,getNoteColorName:h,noteColorArray:e,loadNoteCategories:l,addClickHandlerForNotes:n};return $.extend(!0,c,p)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmAppLoader"),e=a("zmText"),f=a("_zm"),g=a("zmTask"),h=a("zmail.Utils.DOM"),i=e.get("commonUtils"),j=function(){c.taskDeferred=c.taskDeferred?c.taskDeferred:zmail.Utils.DeferredCollection.create();var a=c.taskDeferred.has("taskUtil"),b=c.taskDeferred.get("taskUtil");return a||d.load("taskUtil").done(function(){g.Util.Init().done(function(){b.resolve()})}),b.promise()},k=function(a){var b=a||"task",c=$.Deferred();return j().done(function(){"taskReq"===b?c.resolve(g.Util.Req):"taskUtil"===b?c.resolve(g.Util):d.load(b).done(function(){c.resolve()})}),c.promise()},l=function(a,b){var d=h.selector("div.zm_compose"),e=d.offset(),f=e.top+"px",j=e.left+d.width()+"px",k=!1,l={title:i.taskApp.addTask,$content:a.$el,defaultCloseIcon:!0,buttons:[{name:i.buttonText.save,callback:function(b){var c=b.$els.$buttonContainer.find(".js-button-selector")[0];k||(c.innerText=i.buttonText.saving,k=a.addTask(b.remove.bind(b)))}},{isCancel:!0,name:i.buttonText.cancel,callback:function(a){a.remove()}}],dialogDidMount:function(d){d.$els.$contentWrapper.css("width","2000px"),"addCTask"===b?d.$els.$positionWrapper.css({position:"absolute",top:f,left:j}):c.isZohoAccount(zmail.accId)||a.$el.find("#zt_ws input").attr("disabled","disabled"),d.$els.$contentWrapper.mousedown(function(a){c.stopEvents(a,!0),g.Util.addRemoveMenu("remove"),h.unmount(h.selector(".zcal_cn"),!0),h.unmount(h.selector("#zm_dropDown"),!0),h.unmount(h.selector(".zcal_tilst"),!0)}),a.onMount()}};Dialog["new"](l)},m=function(a,b){if("viewSTask"===a.action)k("taskStreams").done(function(){var c=g.Integrations.Streams(a);b(c)});else{var c=function(){if("addSTask"===a.action)g.Create(a,b);else if("addCTask"===a.action||"addPopupTask"===a.action){var c=a.action;a.action="addCTask",g.Create(a,function(a){l(a,c)})}else"addAsTask"===a.action&&(a.action="addCTask",g.Create(a,b))};k("taskCreate").done(function(){c()})}},n=function(a,b){j().done(function(){m(a,b)})},o=function(){f.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:".*/zm/#task/.*",callback:function(b){c.requireTaskModule().done(function(){var c=a("zmHash").decode(b.href);if("task"===c.key){var d=c.params;g.restore(d)}})}})},p={requireTaskModule:k,loadTask:n,addClickHandlerForTasks:o};return $.extend(!0,c,p)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmAppLoader"),e=function(b,c){var d=a("zmLink.Component"),e=void 0;"create"===b.mode?(e=d.addLinkView(b,c),"function"==typeof c&&e&&c(e)):"viewSLink"===b.mode&&(e=d.constructLinkBox({data:b.linkapp,groupId:b.groupId,bindClick:!0,from:"streams"}),c(e))},f=function(b,d){c.bookmark.loadBookMarkComp().done(function(){var c=a("zmLink.Util");c.isProjLoaded().done(function(){e(b,d)})})},g={loadBookMark:function(a){d.load("links").then(function(){zmail.ContactBook.fetchProcess.done(a)})},loadBookMarkComp:function(){var a=$.Deferred();return d.load("bookmarkComp").then(function(){zmail.ContactBook.fetchProcess.done(a.resolve)}),a.promise()},deleteLink:function(b){this.loadBookMarkComp().then(function(){var c=a("zmLink.Util");c.deleteBookmark(b)})}},h=function(b,d){var e=void 0,f=[{entity:"stream",regex:".*/zm/#stream/.*"},{entity:"mail",regex:".*/zm/#mail/tab/.*"},{entity:"task",regex:".*/zm/#task/tab/.*"}],g=f.length,h=function(){for(var a=0;a<g;a++){var d=c.regExpEscape(f[a].regex),e=new RegExp("^"+d+"$");if(e.test(b))return f[a]}return!1};if(e=h(),!e){var i=["h tt p ://","h tt ps ://"];b.indexOf(i[0].replace(/ /g,""))===-1&&b.indexOf(i[1].replace(/ /g,""))===-1&&(b=i[0].replace(/ /g,"")+b),d=d||{};var j=window.open(b,"_blank");return d.opener||(j.opener=null),j}var k=a("zmList"),l=a("zmTask"),m=a("zmHash"),n=m.decode(b),o=n.params;if("mail"===e.entity)k.getMailData({msgId:o[1],type:"lt",opentype:2,src:"external"});else if("stream"===e.entity){"tab"===o[0]&&o.splice(0,1);var p={pid:o[1],gid:o[0],etype:o[2],actionType:o[3]};o[4]&&(p.commentId=o[4],p.allComments=!0),c.loadStreamsInTab(p)}else"task"===e.entity&&c.requireTaskModule().done(function(){l.restore(o)})},i={loadLink:f,openLink:h,bookmark:g};return $.extend(!0,c,i)}),define([],function(a,b){var c=a("zmUtil"),d=a("_zm"),e=a("zmText"),f=a("zmAppLoader"),g=a("zmComponent"),h=zmail.Utils.DOM,i=function(a){c.cmpWindow(a)},j=function(){h.hide(h.selector("#zm_afill")),h.hide(h.selector("#zm_fLst")),h.unmount(h.selector("#zm_SigLst"),!0),h.hide(h.selector("#zm_TmpLst")),h.unmount(h.selector("#zm_EncLst"),!0)},k=function(b){var d=a("zmPreviewTemplate"),e=a("zmInit");if(c.isChildWindow()){if("sdraft"===b.action){var f=b.msgId,g=b.draftObj,h=b.draftDataObj;d.postSaveDraftAction(f,g,h)}}else{var i=b.action,j=b.msgId,k=b.draftObj,l=b.draftDataObj,m=b.draftId,n=b.schedule,o=b.mode,p=e.getListingDetObj(),q=p.fId,r="";if("sdraft"!==i&&"stemplate"!==i?q!==zmail.folId.oId||!n&&"outbox"!==o?q!==zmail.folId.oId&&n?(r="",zmail.MailPreUtils.updateCount({fId:zmail.folId.oId,mode:"inc"})):q===zmail.folId.dId&&m&&!n&&c.deleteMsg(m):r=zmail.folId.oId:"sdraft"===i?r=zmail.folId.dId:"stemplate"===i&&(r=zmail.folId.teId),"sdraft"===i&&k&&k.TH&&d.postSaveDraftAction(j,k,l),r&&q===r){var s={};if(p.fId){var t=p.view,u=p.label||p.flag;s={fId:q,view:t,viewId:u}}else s={fId:"zm_"+p.view};s.retainPreview=!0,j===a("zmPrev").prevDetails("zm_Container").msgId&&(s.retainPreview=!1),$.publish("/mail/listMails",s)}}},l=function(){var a=$.Deferred();return Promise.all([f.load("zmcompose"),ZE_Init.editorCoreLoaded]).then(function(){a.resolve()}),a.promise()},m=function(){var a={0:"w",1:"t",2:"p"};return c.isChildWindow()&&1===zmail.mailOpt.compTab&&(a[1]="p"),a[parseInt(zmail.mailOpt.compTab)]},n=function(a){if(a&&a.mode){var b,d=a.msgId,e=a.draftId,f=a.mode,g=a.draftCont,h=a.prevElem||[],i=a.disableScroll||!1,j=a.loadType,k=a.reopen,l=a.cmpId,m=a.cdata,n=a.loadMode||"",o=c.isInlineCompose();b=c.getCmpViewType(),b.type=c.getComposeType(),a.recipientList&&(b.recipientList=a.recipientList),d&&(b.msgId=d),m&&(b.cdata=m),n&&(b.loadMode=n),b.mode=f,o&&(b.draftId=e,b.data=g,h.length&&(e?b.prevDOM=h.find("#zmCon"+b.elemPrefix+e):b.prevDOM=h.find("#zmCon"+b.elemPrefix+d)),j&&(b.loadType=j),k&&(b.reopen=k),l&&(b.cmpId=l),i?b.disableScroll=i:b.disableScroll=!1),a.actionSrc&&(b.actionSrc=a.actionSrc),c.cmpReply(b)}},o=function(){var a=!1;return"p"===c.getComposeType()&&(a=!0),a},p=function(a){return!!c.isInlineCompose()&&Boolean(c.getMailObj(a,"DMID"))},q=function(){var a=!1;return"w"===c.getComposeType()&&(a=!0),a},r=function(b,e){c.requireComposeModule().done(function(){var c=a("zmComp");c.cmpDialog(b)}),d.stopEvents(e)},s={cId:1,appData:{}},t=function(a,b){c.cmpObj.appData[a]=b},u=function(){c.cmpObj.cId+=1},v=function(){return"Cmp"+c.cmpObj.cId},w=function(a){a.appId&&(a.appId=c.getCmpAppId()),a.appObj.appId&&(a.appObj.appId=c.getCmpAppId()),t(a.appId,a.data),c.addCmpAppId()},x=function(){var a=window.addEventListener?"addEventListener":"attachEvent",b=window[a],d="attachEvent"===a?"onmessage":"message";b(d,function(a){c.debugLog(a)},!1)},y=function(a){c.cmpClose();var b=a.mode,d=zmail.conPath+"/comp.do?accId="+zmail.accId;d+="&originalMode="+b;var e,f,g=a.msgId,h=a.type;if(g&&(e=c.getFolIdByMsg(g),d+="&msgId="+g),"fwdme"===b){var i=c.getFwdArr(g,h);i.mId&&(d+="&fwdMsgIds="+i.mId),i.tId&&(d+="&fwdtId="+i.tId),i.folderId&&(e=i.folderId)}e&&(d+="&folId="+e),e&&c.isSharedFolder(e)&&(f=c.getShareId(e)),f&&(d+="&shareId="+f),c.openWindow(d,80,80)},z=function(){var b=$.Deferred();return c.requireComposeModule().done(function(){var c=a("zmComp"),d=c.getCmpData();b.resolve(d)}),b.promise()},A=function(b,e,f){var g=a("zmsuite"),h=void 0,i=void 0;g.isMaxLimitReached()||(i=b?function(){h.compose(b,f)}:function(){h.compose()},c.requireComposeModule().done(function(){h=a("zmComp"),i()})),d.stopEvents(e)},B=function(a,b,d){if(zmail.isComposeCreated=$.Deferred(),0!==zmail.mailOpt.compTab||a)A(a,b,d);else{var e={};e.mode="compose",c.cmpWindow(e)}},C=function(b,d){var f=a("zmComp"),g=a("Dialog"),h=a("zmInit"),i=[],j=[],k=void 0,l={};if(b)i=[b];else if("r"===d){var m=h.rclkId;m.indexOf("t")!==-1&&(m=f.zmsubStr(m,"t")),i=[m]}else{var n=c.getSelectedMails();n[0].length&&(i=n[0]),n[1].length&&(j=n[1])}if(j.length){var o=j.length;if(o>10){var p=e.get("zmcompose").message_fwdmul;return p=e.applyArgs(p,{NUMBER:o}),g.alert(p),!1}}if(i.length){var q=i.length;
if(q>100){var r=e.get("zmcompose").conversation_fwdmul;return r=e.applyArgs(r,{NUMBER:q}),g.alert(r),!1}}return i.length&&(k=1===i.length?c.getFolIdByMsg(i[0]):c.getFolId()),i.length&&(l.mId=i),j.length&&(l.tId=j),k&&(l.folderId=k),l},D=function(a,b){a?b.show():b.hide()},E=function(a){var b=a.draftId||"",c=a.msgId||"",d=a.prevDOM;if(c&&d.length){d=d.closest(".SC_Twpr");var e=d.find(".SC_pct").find("[data-mid='"+c+"']"),f=d.find(".SC_Drft").find("[data-mid='"+b+"']");f.length||(f=d.find(".SC_Drft").find("[data-mid='"+c+"']")),c=f.attr("id"),c?(c=c.substring(6),$.publish("/mail/msgDiscarded",{draftId:b,msgId:c,actionType:a.actionType})):$.publish("/mail/msgDiscarded",{draftId:b,actionType:a.actionType});var g=e.closest(".SC_pct").find(".zm_ry");D(!0,g)}},F=function(b,c){var d=a("zmPreviewTemplate");if(c&&c.prevDOM&&c.prevDOM.length){var e=c.actionType;"discard_draft"===e?E(c):"replace_draft"===e&&d.showDraftedBand(c)}},G=function(b){var d=a("zmComp"),e=a("zmPreviewTemplate");if(c.isInlineCompose()&&"template"!==b.mode){var f=b.msgId,g=c.getMailObj(f),i=void 0,j=void 0,k=void 0,l=void 0,m=void 0;g&&"p"===b.type&&"draft"!==b.mode&&"eanew"!==b.mode&&!g.DMID&&"outbox"!==b.mode&&(l=b.prevDOM.closest(".SC_Twpr"),m=b.viewType+f+"New",j="zmCon"+m,k=l.find("#"+j),k.length?e.addFocusOnclick(k,l):(D(!1,b.prevDOM.find(".zm_ry")),b.prevDOM.length&&(i=c.getCmpContainerTemplate(m,f),h.mountAfter(i,b.prevDOM.closest(".SC_pct")),b.prevDOM=h.selector("#"+j,i))))}d.cmpReply(b)},H=function(a){a=a||{},c.requireComposeModule().done(function(){G(a)})},I=function(a){var b=a.type,d=!1,e=!1;a.msgId&&(d=c.isSharedFolder(c.getFolIdByMsg(a.msgId))),"w"!==b||d||(e=!0),c.isChildWindow()&&"eanew"===a.mode&&(e=!0),e?c.cmpWindow(a):H(a)},J=function(b,d){var e=a("zmsuite");d=d||{};var f=void 0;f=b.data.obj?b.data.obj:b.data,d["new"]&&(c.modifyComposeObj(b),e.setWorkSpace(b.appObj)),c.requireComposeModule().done(function(){var c=a("zmComp"),d={};d.mode=f.mode,d.msgId=f.msgId,d.restore=!0,d.restoreAppId=b.appId,c.cmpReply(d)})},K=function(a,b){var c=zdom("div",{className:"SC_pct SC_Drft"},zdom("div",{id:"zmHdr"+a,className:"zmPHdr","data-mid":b}),zdom("div",{id:"zmCon"+a}));return c},L=function(a){c.compose({NEWATT:a})},M=function(b,c){var d=a("zmComp");"object"===("undefined"==typeof d?"undefined":babelHelpers["typeof"](d))&&"function"==typeof d.modeChange&&d.modeChange(b,c)},N=function(){function a(a,b){var c=a.split(b);return c[0]&&c[1]?c:null}var b=/\?|(?:&amp;)|&/,c={mailto:"TO",to:"TO",cc:"CC",bcc:"BCC",subject:"SUBJECT",body:"CONTENT",content:"CONTENT"};return function(d){var e=d.split(b),f={},g=e.length,h=[],i=void 0;if(e.length){for(h=a(e[0],":"),h.length>1&&(f[c[h[0].toLowerCase()]]=decodeURIComponent(h[1])),i=1;i<g;i++)h=a(e[i],"="),h.length>1&&(f[c[h[0].toLowerCase()]]=decodeURIComponent(h[1]));return f}}}(),O=function(b){var d={},e=void 0,f=void 0;return c.isChildWindow()?(e="W",f="W"):(b=b||a("zmTab").currentTab,"zm_Container"===b?(e="P",f="P"):b.indexOf("zm_srch")?b.indexOf("zm_tab")||(e="T",f="T"):(e="S",f="S")),d.viewType=e,d.elemPrefix=f,d},P=function(){d.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:"mailto:(.+)",callback:function(a){var b=a.getAttribute("href");c.compose(N(b))}})},Q=function(b){if(!c.isChildWindow())if(b)g.keybindings.setScope("inlineCmp");else{var d=g.keybindings.getScope();"inlineCmp"===d&&g.keybindings.setScope(a("zmTab").currentTab)}},R={loadComments:function(){if(zmail.isOrg&&c.isZohoAccount(zmail.accId)){var a=arguments[0]||{},b=$.Deferred();return $.publish("/draft/openedincompose",{draftID:a.draftID,appendCallback:a.appendCallback,onResize:a.onResize,deferred:b,isSmartCompose:!0,context:a.context}),b.promise()}},notifyUpdate:function(){if(zmail.isOrg&&c.isZohoAccount(zmail.accId)){var a=arguments[0]||{},b=$.Deferred();return $.publish("/draft/sharing/notifyupdates",{draftID:a.draftID,zohoID:a.zuid||zmail.zuid,accountID:a.accId||zmail.accId,deferred:b}),b.promise()}}},S={requireComposeModule:l,cmpHideMenu:j,postMailActionsOnSend:k,getComposeType:m,isInlineCompose:o,isComposeWindow:q,cmpDialog:r,modifyComposeObj:w,addCmpAppId:u,getCmpAppId:v,cmpObj:s,cmpWindow:y,getCmpData:z,cmpClose:x,compose:B,invokeComposer:n,getFwdArr:C,cmpReply:I,cmpRestore:J,getCmpContainerTemplate:K,openComposeWithAtt:L,modeChange:M,addClickHandlerForMailTo:P,getCmpViewType:O,setInlineCmpScope:Q,removeComposer:F,hasInlineDraft:p,DraftShare:R,composeWindow:i};return $.extend(!0,c,S)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmsuite"),e=a("zmText"),f=a("zmContentCache"),g=a("zmAppLoader"),h=a("zmail.Utils.DOM"),i=e.get("commonUtils"),j=function(){var a=c.getSelectedMails();return!!(a[0].length+a[1].length)},k=function(){var b=a("zmList"),c=[],d=[],e=void 0,f=a("ZMail.lConstants"),g=b.getElemObj().mainElem.find(".SC_mclst").find("."+f.cls.chkBox);return g.each(function(a,b){b=h.element(b),e=b[0].id,"t"===e.charAt(0)?d.push(e.substr(1,e.length-1)):("lt"===b.attr("data-ty")||"th"===b.attr("data-ty")&&!b.parent().prev().hasClass(f.cls.chkBox))&&c.push(e)}),[c,d]},l=function(){var a=c.getCheckedMailList();return a[0].length+c.getTotalMailCountInThreads(a[1])},m=function(b){var e=a("zmList"),f=a("zmPrev"),g=a("zmInit"),i=a("ZMail.lConstants"),j=[],k=[],l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v={};if(c.isChildWindow()){var w=a("zmWindow"),x="";return u=w.getListingDetObj(),x=h.selector("#zmWindowWrapper .SC_pct").not(".SC_pct.SC_Drft").length>1?h.selector("#zmWindowWrapper .SC_Tfcs").children().eq(0).attr("data-mid"):h.selector("#zmWindowWrapper .SC_pct").children().eq(0).attr("data-mid"),j.push(x),[j,k]}if(b=b||a("zmTab").currentTab,u=g.getListingDetObj(),v=e.getElemObj(b),"zm_Container"===b||b.indexOf("zm_srch")!==-1)if(l=v.mainElem.find("div."+i.cls.chkBox),l.length||h.selector(".SC_Tfcs .zmPHdr",v.prevElem).length||(l=v.mainElem.find("."+i.cls.sel)),l.length){var y;l.each(function(){s=this.id||h.getAttribute(this,"data-detail"),s.indexOf("t")||(s=s.substring(1,s.length)),y=e.getMailObj(s)||{},y.TH&&"lt"===h.getData(this,"ty")?k.push(s):j.push(s)})}else""!==h.getAttribute(v.prevElem,"data-mid")&&(l=h.getAttribute(h.element(v.prevElem).find(".SC_Tfcs .zmPHdr"),"data-mid"),l?j.push(l):(s=f.prevDetails(b).msgId,s&&j.push(s)));else b.indexOf("zm_tab")!==-1?(l=b.indexOf("zm_tabt")?b.substring(6,b.length):h.selector(".SC_show").find("div.SC_Tfcs").find("div.zmPHdr").attr("data-mid"),l&&j.push(l)):"zmStreamsApp"===b?j.push(d.getCenter(b)[1].$el.attr("data-mid")):"zmncenter"===b&&(s=f.prevDetails(b).msgId,s&&j.push(s));p=k.length;var z;for(m=0;m<p;m++)if(t=e.getMailObj(k[m]).T,z=e.getListObj(t))for(q=z.MO,r=q.length,n=0;n<r;n++)o=$.inArray(q[n],j),o!==-1&&j.splice(o,1);return 0!==c.getMLConversionValue()&&"zm_srch1"!==b&&("zm_Container"!==b||u.fId!==zmail.folId.tId&&u.fId!==zmail.folId.sId)||(j=j.concat(k),k=[]),[j,k]},n=function(b){var c=[],d=void 0,e=void 0;e=b.length;var f=void 0,g=a("zmList");for(d=0;d<e;d++)f=g.getMailObj(b[d]),f&&c.push(f.T);return c},o=function(a,b){var c=zmail.mailContainer,d=c.getObject(a);d?c.rememberAsRecent(d.id):c.addObject({id:a,data:b})},p=function(b,e){var f=a("zmPrev"),g=a("zmPreviewTemplate"),h=a("zmCache"),i=e.thId,j=void 0,k=void 0,l=[];if(b.tdata&&i){if(c.createListMap(i,h.dolistObj(i,b.tdata)),c.isInlineCompose()&&c.mapDraftId(i),f.prevDetails("zm_Container").msgId){var m=f.prevDetails("zm_Container").msgId;c.getMailObj(m,"T")===i&&(j=!0,l=g.getMissingMailList(i,"P"))}d.isWorkspaceAvailable("zm_tabt"+i)&&(k=!0,l=g.getMissingMailList(i,"T")),j&&$.publish("/mail/updatemailview",[{list:l,opentype:4===zmail.mailOpt.isPopup?4:0,mode:"sdraft"}]),k&&$.publish("/mail/updatemailview",[{list:l,opentype:2,mode:"sdraft"}])}},q=function(b){var c=a("zmList"),d=c.getListObj(b);if(b&&d){var e=d.MO,f=e.length,g=0,h=void 0,i=void 0;for(g=0;g<f;g++)h=c.getMailObj(e[g]),h.FD===zmail.folId.dId&&(i=h.PA&&c.getMailObj(h.PA),i&&!i.DMID&&(i.DMID=e[g]),e.splice(g,1),f--,g--);c.setListObj(b,"MO",e)}},r=function(b){var d=a("zmList"),e=a("zmInit"),f=c.getMailObj(b);if(f&&f.PA){var h=f.PA,i=c.getMailObj(h);if(i&&i.DMID&&delete i.DMID,!c.isChildWindow()){if(0!==c.getMLConversionValue()){var j=d.getViewBasedMsgList(f.T,e.getListingDetObj(),!0);if(j.length>0){var k=c.excludeDraftSentMails(j);h=k.length?k[0]:j[0]}}i=c.getMailObj(h)||{},i.DC&&i.DC>0&&(i.DC-=1),g.load("MailActions").then(function(){var b=a("zmmailAct");b.updateDraftCountInUI(h,"discard_draft",i.DC,"zm_Container")})}}},s=function(a){return c.getMailObj(a,"FD")===zmail.folId.dId},t=function(b){var e=a("zmCache"),f=a("zmInit");if(b.error){var g=b.accId||b.AID;if(zmail.accId===g){var j=f.getListingDetObj();if(d.isWorkspaceAvailable("zm_Container")&&zmail.folId.oId===j.fId?(h.clearHTML(zmail.mailCenter.listElem),e.clearListObj(),f.setListingDetObj({}),f.foldView({folId:zmail.folId.oId}),$.publish("mail/updateOutBox",b)):zmail.MailPreUtils.updateCount({fId:zmail.folId.oId,mode:"dec"}),"true"===b.error){var k=i.error.outboxErr;c.succErrMsg("e",k)}}}},u=function(a,b){var c=h.selector("#"+b);a?c.addClass("SC_redtxt"):c.removeClass("SC_redtxt")},v=function(b,c){var d=a("zmList"),e=void 0;b[c].email.accid!==zmail.accId&&(e={actionType:"viewGroupMailEntity",entityId:b[c].email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:b.gnrl.by,accId:b[c].email.accid}),d.getMailData({msgId:b[c].email.msgid,opentype:2,type:"lt",src:"external",eprm:e})},w=function(a){return c.getMailObj(a,"FD")||null},x=function(b){var d=a("zmInit"),e={},f=void 0;if(b)e=b;else if(c.isChildWindow()){var g=a("zmWindow");e=g.getListingDetObj()}else e=d.getListingDetObj();return f=e.fId||e.label||e.view||e.flag,"-1"!==f&&"1"!==f&&"2"!==f&&"3"!==f||(f="flag"),f},y=function(){return[zmail.folId.dId,zmail.folId.teId,zmail.folId.sId,zmail.folId.tId,zmail.folId.oId,zmail.folId.spId]},z=function(a){var b=c.getNonConversationFolders();return!(c.isChildWindow()||!c.isFolderId(a)||b.indexOf(a)!==-1)},A=function(b){try{var d=a("zmfolAction"),e=zmail.folTree;if(!b&&!c.isChildWindow()&&!a("zmTab").currentTab.indexOf("zm_srch"))return 0;if(b||(b=c.getFolId()),c.hasFolSpecConversation(b)||c.getNonConversationFolders().indexOf(b)!==-1){var f=d.getParentFolderId(b);return f?e[1][f].CH[b].CV:e[0][b].CV}return zmail.folviewThread}catch(g){return c.debugLog(g),zmail.folviewThread}},B=function(){var b=a("zmPreviewTemplate");return 1===b.currentWorkSpace},C=function(){var a=c.getSelectedMails(),b=a[0],d=a[1],e=void 0,f=void 0,g=void 0;for(g=0,f=b.length;g<f;)e=c.getMailObj(b[g],"TAG"),e&&e.length?g++:(b.splice(g,1),f--);for(g=0,f=d.length;g<f;)e=c.getMailObj(d[g],"TAG"),e&&e.length?g++:(d.splice(g,1),f--);return[b,d]},D=function(b){var c=0;b=b||[];var d=a("zmList"),e=void 0;return b.forEach(function(a){e=d.getMailObj(a),c+=e&&e.TC||0}),c},E=function(a,b){var c={},d=void 0,e=void 0,f=void 0;if(b)c=zmail.shrTree[0];else{var g=zmail.folTree[1],h={},i=void 0;for(i in g)$.extend(!0,h,g[i].CH);$.extend(!0,c,zmail.folTree[0],h)}for(d in c)if(f=c[d],e=b?f.SHID:f.SH,e===a)return d},F=function(b,c,e){var f=a("zmPrev"),g=void 0,h=void 0,i=void 0,j="",k=void 0,l=void 0,m=void 0;b&&0===b.indexOf("t")&&(b=b.substring(1));var n=a("zmList");if(i=n.getMailObj(b),c)switch(c){case"preview":if(e)switch(e){case"zm_Container":k=!0;break;case"zm_srch1":l=!0}else k=!0,l=!0;break;case"tab":m=!0}else k=!0,l=!0,m=!0;if(k&&d.isWorkspaceAvailable("zm_Container")){if(g=f.prevDetails("zm_Container"),("lt"===g.type||"th"===g.type)&&g.msgId===b)return!0;var o=g.msgId&&n.getMailObj(g.msgId);if(i&&o&&i.T&&i.T===o.T)return!0}if(l&&d.isWorkspaceAvailable("zm_srch1")&&(h=f.prevDetails("zm_srch1"),("lt"===h.type||"th"===h.type)&&h.msgId===b))return!0;if(m){if(j="zm_tab"+b,d.isWorkspaceAvailable(j))return!0;if(i&&i.TH&&(j="zm_tabt"+i.T,d.isWorkspaceAvailable(j)))return!0}return!1},G=function(a,b){var d=c.isMailContentInUse(a,"preview",b);return d},H=function(a){var b=zmail.folTree[0]||[],c=zmail.folTree[1]||[],d={},e=void 0,f=void 0,g=void 0;for(e in b)d[e]=b[e];for(e in c){g=c[e].CH||{};for(f in g)d[f]=g[f]}return d[a]},I=function(b){var d=a("zmList"),e=b.fId,f=b.viewId,g=[],h=void 0;if(g=c.getListMap(e,"MO")||c.getListMap(f,"MO")||[],h=g.length,g.length>0){var i=void 0,j=void 0,k={},l={},m=[],n=void 0;for(i=0;i<h;i++)if(l=c.getMailObj(g[i]),l&&l.TH)for(k={fId:e},m=d.getMailSummaryList(k,l.T),n=m.length,j=0;j<n;j++)c.discardMsg({draftId:m[j],actionType:"discard_draft"})}},J=function(b,d){var e=a("zmList"),f=e.getViewBasedMsgList(b,d,!0);return d.fId===zmail.folId.sId?f[0]:(f=c.excludeDraftSentMails(f),f[0])},K=function(a){var b=[],d=0,e=a.length,f=void 0;for(d=0;d<e;d++)f=c.getMailObj(a[d]),f.FD!==zmail.folId.sId&&f.FD!==zmail.folId.dId&&b.push(a[d]);return b},L=function(a){return Boolean(c.getMailObj(a))},M=function(a,b){b=b||{};var d=$.Deferred(),e=b.reload||!1,g=b.nocache||!1,h=b.params||{};if(a)if(!e&&f.isCached(a))d.resolve(f.get(a));else{var i={accId:zmail.accId,split:!0,summary:!0},j={};i.msgId=j.msgId=a;var k=c.getMailObj(a,"FD");k&&(i.folId=k);for(var l in h)i[l]=h[l];!e&&g||(j.forceFetch=!0),c.sendMailDataReq(i,j,function(b,c){if(c=c||{},b=b||{}){var e=Object.keys(b).length;0===e||1===e&&b.MSGID?d.reject():d.resolve(f.get(a))}else d.reject()},function(a){d.reject()})}else d.reject();return d.promise()},N=function(a){var b=c.getMailObj(a);if(b&&c.getFolId()===b.FD){var d={action:"delete"};b.TH&&b.FD!==zmail.folId.dId&&b.FD!==zmail.folId.tId&&!b.AR?(d.mailId=[],d.tmailId=[a]):(d.mailId=[a],d.tmailId=[]),zmail.MailAction.Initializer.rdoActions({result:"success"},d)}},O=function(b){var d=a("zmPreviewTemplate"),e=b.draftId,f=b.msgId;if("discard_draft"===b.actionType){var g=c.getMailObj(e),h=void 0,i=0,j=void 0;g&&g.TH&&(h=g.T,j=c.getListMap(h),j&&(i=j.MO.indexOf(e),i!==-1&&j.MO.splice(i,1),d.discardMsgPreview(e)),g.FD===zmail.folId.dId&&c.removeDraftMapping(e)),f&&c.isInlineCompose()&&d.discardMsgPreview(f)}},P=function(a,b,d,e){var g=void 0;b=b||{},"tIcon"!==b.from&&(a.comments=!0,g=c.getMailObj(a.msgId)||{},a.entityId=a.entityId||g.T||a.msgId,a.groupId=a.groupId||zmail.zuid,a.entityType=1);var h={u:zmail.conPath+"/md.do",t:"POST",fn:d,p:a,ep:b};"function"==typeof e&&(h.efn=e),f.fetch(h)},Q=function(b){var c=a("zmInit");c.foldView({folId:b,reInitialize:!0}),zmail.mailLeft.selRow(b,"zmlTreeH",!0),c.updateHeaderBand()},R=function(a){if(a)return a=h.element(a),1===a.length&&a.hasClass("SC_simg")&&(a.children().removeClass("SC_ldot"),a.children().each(function(a,b){"none"!==h.getStyle(b,"display")&&h.addClass(b,"SC_ldot")})),a},S=function(a){return zmail.labInfo[a]?zmail.labInfo[a].dispName:""},T=function(a){var b=e.get("mail"),c=b.listing.flagmenu,d={1:c.infoflag,2:c.important,3:c.followup};return d[a]||""},U=function(b,c){g.load("mail").then(function(){var d=a("zmRestore");d.restoreMailApp(b.data,c)})},V=function(b){g.load("mail").then(function(){var c=a("zmRestore");c.restoreTabs(b)})},W=function(a,b){var c={};if(b=b||{},a.length)return a=a.join(),c.SearchStr=encodeURIComponent(a),c.view="search",b.fId?c.viewfolId=b.fId:(b.flag&&(c.flag=1),b.label&&"-1"!==b.label&&(c.label=b.label),"unread"===b.view&&(c.unreadStatus=1)),c},X=function(b){try{if(zmail.isRHSEnabled){var d=a("zmWidgets");d.publishToWidget("mail_preview",zmWidgets.getMailDetails(b)),d.publishToWidget("onmailpreview",zmWidgets.getMailDetails(b))}}catch(e){c.debugLog(e)}},Y=function(){X()},Z=function(a){var b=c.getMailObj(a,"FD");return!(!b||!c.isSharedFolder(b,"R"))},_=function(b){try{var d=a("zmfolAction"),e=b.folName;if(!e||!Object.keys(b).length)return!1;var f=a("zmAjq"),g=b.type,h={accId:zmail.accId,mode:"add",fName:e};"subFol"===g&&(h.pfolId=b.parentFolId);var i=function(a,c){"subFol"===g?d.insertNewSubFolder(a,c):d.insertNewFolder(a,c),"function"==typeof b.onSuccess&&b.onSuccess(a,c)};f.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:i,efn:b.onFail,p:h,csr:"s",ep:b.eprm||{}})}catch(j){c.debugLog(j)}},aa=function(){var b=$.Deferred(),c=a("zmComponent"),d=a("zmAdHocSettings");return"1"===d.getSecuredownload()?g.load("securedownload").then(function(){c.securedownload().then(function(a){if(a.adHocValue)return void b.resolve(a)},function(){b.reject()})}):b.resolve({password:""}),b};zmail.isDL=!1;var ba={getCheckedMailList:k,getCheckedMailCount:l,getSelectedMails:m,getThreadIdArr:n,prevCache:o,cacheThreadList:p,mapDraftId:q,removeDraftMapping:r,isDraftMail:s,updOutbox:t,updSendErrorStatus:u,viewAssociatedMail:v,getFolIdByMsg:w,getFolId:x,getFolName:function(a){if(zmail.folTree[0][a])return zmail.folTree[0][a].FN;var b,c=zmail.folTree[1];for(var d in c)if(b=c[d].CH,b[a])return b[a].FN;var e=zmail.shrTree||[];for(var f in e)if(e[f][a])return e[f][a].FN;return""},hasFolSpecConversation:z,getNonConversationFolders:y,getMLConversionValue:A,isChildWindow:B,getSelectedMailsWithLabels:C,getTotalMailCountInThreads:D,getFolderForShID:E,isMailContentInUse:F,isMailOpenInPreview:G,getFolderObject:H,discardFromThread:I,getFirstMsgId:J,excludeDraftSentMails:K,isMetaDataAvailable:L,getMailContent:M,deleteMsg:N,discardMsg:O,sendMailDataReq:P,selectFolderInLHS:Q,applyLBDots:R,findTagName:S,findFlagName:T,restoreLeftState:U,restoreTabs:V,createSearchParams:W,publishMailEvents:Y,publishMPreviewEvent:X,isReadOnlyMail:Z,createNewFolder:_,secureDownloader:aa,checkSelectedMails:j,getRowModel:function(a){try{return zmail.isDL?ZMail.listing.collection.get(a):{attributes:zmail.mailObj[a]}}catch(b){return c.debugLog(b),""}},getMailObj:function(a,b){try{var d;return zmail.isDL?(d=ZMail.listing.collection.get(a),d=d&&d.attributes,b?d&&d[b]:d):(d=zmail.mailObj[a],b?d&&d[b]:d)}catch(e){return c.debugLog(e),""}},addMailData:function(a,b){zmail.isDL?ZMail.listing.collection.add(a):(b=b||a.M,zmail.mailObj[b]=a)},removeMailData:function(a){return zmail.isDL?ZMail.listing.collection.clearModel(a):void delete zmail.mailObj[a]},updateMailData:function(a,b,c){var d;zmail.isDL?(d=ZMail.listing.collection.get(c),d.set(a,b)):(d=zmail.mailObj[c],d[a]=b)},createListMap:function(a,b){zmail.isDL?ZMail.listing.collection.createListObj(a,b):zmail.listObj[a]=b},updateListMap:function(a,b,c){zmail.isDL?ZMail.listing.collection.setListObj(a,b,c):zmail.listObj[a][b]=c},getListMap:function(a,b,c){if(zmail.isDL)return ZMail.listing.collection.getListObj(a,b,c);if(c)return zmail.listObj;var d=zmail.listObj[a];return b?d&&d[b]:d},removeListMap:function(a){zmail.isDL?ZMail.listing.collection.clearMap(a):delete zmail.listObj[a]}};return $.extend(!0,c,ba)}),define([],function(a,b){var c=a("_"),d=a("_zm"),e=a("zmUtil"),f=a("zmAppLoader"),g=a("zmText"),h="CONTACT_BOOK_GROUP_CHANGED",i={},j=".*/zm/#stream/.*";return i.isNewGroupUser=function(){return zmail.isOrg},i.getStreamsEvent=function(){return ZCL_streamEve},i.requireStreamsApp=function(){var a=$.Deferred();return f.load("streamsApp").then(function(){zmail.ContactBook.fetchProcess.done(function(){a.resolve()})}),a.promise()},i.requireStreamsComments=function(){return f.load("streamsComments")},i.loadStreams=function(){return i.requireStreamsApp()},i.loadGroupManagement=function(){return new Promise(function(a,b){f.load("streamsGroupManagement").then(function(){zmail.ContactBook.fetchProcess.done(function(){a()})})})},i.isGroupMember=function(a,b){var c=zmail.ContactBook.getGroups(b)[0];if(c){c=c.attrs;var d=c.members;if(d&&d.length)return d.indexOf(a)!==-1}return!1},i.changeUnread=function(a,b,d){var e=zmail.ContactBook.groups.me.attrs||{},f=c.pluck(zmail.ContactBook.getGroups(a),"attrs");if(a&&_.size(f)||zmail.zuid===a){var g,i;i=zmail.zuid===a?e:f[0],g=void 0!==d?parseInt(d):parseInt(i.scount),b?g+=1:void 0===d&&(g-=1),$.publish(h,{props:{scount:g},id:a}),$.publish("group/unread",{groupId:a,count:g,incFlag:b})}},i.isGroup=function(a){if(a){a=String(a);var b=zmail.ContactBook.getGroups(),d=c.pluck(b,"attrs"),e=c.pluck(d,"id");return e.indexOf(a)!==-1}return!1},i.getGroupOrder=function(){var a=zmail.ContactBook.getGroups(),b=c.pluck(a,"attrs"),d=c.pluck(b,"id");return d.length||(d=[]),d},i.getEmailEnabledGroup=function(a){var b={},d=zmail.ContactBook.getGroups(),f=zmail.ContactBook.groups.me.attrs||{};if(b[f.id]=$.extend({},f),b[f.id].name=g.get("zmContacts","common.label.streamsSelfGroup"),b[f.id].order=1,d.length){var h=c.pluck(d,"attrs"),j={},k=!1,l=0,m=i.getGroupOrder(),n=m.length,o=2,p=0;for(l=0;l<h.length;l++)h[l].disabled||h[l].hidden?h[l].disabled&&(k=!0):j[h[l].id]=h[l];for(l=0;l<n;l++)c.size(j[m[l]])&&(b[m[l]]=$.extend({},j[m[l]]),b[m[l]].order=o,o++,a||(o=3===p?o+1:o,p>3&&(b[m[l]].hideNode=!0)),p++);k&&i.isNewGroupUser()&&(b.disabledGrp={name:g.get("commonUtils","streams.disGrp"),id:"disGrp",order:o++,hideNode:p>4&&!a,txtNodeClass:"SC_thm",rowTitle:g.get("commonUtils","streams.stDisGrp")}),p>4&&(b.more={name:g.get("commonUtils","streams.more"),id:"more",order:6,txtNodeClass:"SC_thm",hideNode:Boolean(a),rowTitle:g.get("commonUtils","streams.moreTitle")},b.less={name:g.get("commonUtils","streams.less"),id:"less",order:o++,hideNode:!a,txtNodeClass:"SC_thm",rowTitle:g.get("commonUtils","streams.lessTitle")})}else if(e.isNewGroupUser()&&zmail.ContactBook.isGroupsFetched()){var q,r=["SC_onBoardImgD","SC_onBoardImgL"],s=c.random(0,1),t=r[s],u=g.get("commonUtils","streams.colloborate"),v=parseInt(zmAdHocSettings.getStreamsGroupImg());q=v?zdom("div",null,zdom("div",{className:"zmTreWra zmTreCreate"},zdom("span",{className:"SC_link"},u))):zdom("div",null,zdom("span",{className:"zmTreCls toHide"},zdom("i",{className:"msi-close closeImg"})),zdom("span",{className:"SC_onBoardImg toHide "+t}),zdom("span",{className:"toHide"},g.get("commonUtils","streams.onboardContent")),zdom("div",{className:"zmTreWra alignLeft"},zdom("span",{className:"SC_link"},u))),b.createGrp={id:"createGrp",name:"",count:"",customNode:!0,order:2,customNodeHtmlTemplate:q.innerHTML}}return b},i.updateStreamUnread=function(){var b=a("zmComponent"),c=function(b,c){c=c.data||{},"string"==typeof c.group&&(c.group=$.parseJSON(c.group)),"string"==typeof c.shgroups&&(c.shgroups=$.parseJSON(c.shgroups)),c.group=c.group||{};var f,g,h,j=_.size(c.shgroups)?c.shgroups:[c.group],k=c.ntype,l="30"===k||"4"===k||"41"===k||"46"===k||"25"===k||"44"===k||"79"===k||"61"===k||"71"===k;if(l&&c.nby!==zmail.zuid||"112"===k&&c.group.id!==zmail.zuid){var m=!1;for(h in j)f=j[h],g=e.isGroup(f.id)?f.id:zmail.zuid,i.changeUnread(g,!0),g===zmail.zuid&&(m=!0);!m&&d.isAllUnreadEnabled()&&i.changeUnread(zmail.zuid,!0)}var n="31"===k||"45"===k||"38"===k;if(n&&c.nby!==zmail.zuid)for(h in j)e.streamUpdate({groupId:j[h].id,newcomment:!0,reflist:c.refList});"50"!==k&&"75"!==k&&"51"!==k||c.memberzuid!==zmail.zuid||i.requireStreamsApp().done(function(){var b=a("zmStreamsApp");b.GroupApp.requestGroupId=j[0].id,b.GroupApp.updateGroupListing(!e.isGroup(j[0].id))}),"121"===k&&(e.changeUnread(j[0].id,!1),d.isAllUnreadEnabled()&&j[0].id!==zmail.zuid&&e.changeUnread(zmail.zuid,!1))};b.notifier.addHandler("streams",c)},i.addClickHandlerForStreams=function(){d.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:j,callback:i.openStreamsUrl})},i.publishCloseNotif=function(){$.publish("/streams/closePopOut")},i.openStreamsUrl=function(b){var d=a("zmHash"),f=c.isElement(b)?b.href:b,g=d.decode(f);if("stream"===g.key){i.publishCloseNotif();var h=g.params;"tab"===h[0]&&h.splice(0,1);var j={pid:h[1],gid:h[0],etype:h[2],actionType:h[3]};h[4]&&(j.commentId=h[4],j.allComments=!0),e.loadStreamsInTab(j)}},i.isValidStreamsUrl=function(a){if(!a)return!1;var b=new RegExp(j);return b.test(a)},i.streamUpdate=function(a){var b={},d=a.groupId;if(b=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree"),b.listObject[d])if(a.newcomment){var e=c.size(a.reflist)?a.reflist.split(","):[],f=c.find(e,function(a){if(a===zmail.zuid)return!0});f||b.addClassAtStart(d,"msi-lcmnt")}else{var g=void 0!==a.incFlag&&a.incFlag;b.updateCount(d,"upd",a.count,g,!1),g||b.clearNew(d)}},i.loadStreamsInTab=function(b){i.requireStreamsApp().done(function(){a("zmStreamsApp").events.openPostInTab(b)})},i.loadNewPostDialog=function(b,c,d){void 0===c&&(c=[]),i.requireStreamsApp().done(function(){a("zmStreamsApp").updateBox.createNewPostDialog({content:b,attachment:c,mentions:d})})},i.constructStreamLHS=function(a){zmail.mailLeft&&(zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree").setListObject(e.getEmailEnabledGroup(a)),zmail.mailLeft.rerender("zmStreamTree","list"))},i.hideCommentBox=function(){var a=zmAdHocSettings.getCommentBoxView();return"0"===a&&!zmail.isOrg||zmail.isOrg&&"off"===a},i.cmpDraft=function(b,c){var d=function(){a("zmComp").getAppDOM(b,c)};e.requireComposeModule().done(function(){d()})},i.isRTEnabled=function(){return zmail.showFeature},i.isArchiveEnabled=function(){return zmail.isInternalOrgUser},zmail.ContactBook&&zmail.ContactBook.groupsFetched.done(function(){i.constructStreamLHS(!1)}),$.extend(!0,e,i)}),define([],function(a,b){var c=a("zmUtil"),d=a("_zm"),e=a("zmail.Utils.DOM"),f=[],g=function(a){f.push(a)},h=function(a){var b,c,d=f.length-1;for(c=d;c>=0;c--)if(b=f[c].element){if(document.body.contains(b))break;f.splice(c,1)}f.length&&(f[c].activeMenu=a)},i=function(a,b,c,f){var g=a.element,h=a.activeMenu||{},i=a.waitForActiveMenuHandler,j=!0;return g?(document.body.contains(g)&&(b&&!i||!h.activeMenuHandler||(j=h.activeMenuHandler.apply(a,h.activeMenuArgsArray)),j=j?!c:j,"undefined"!=typeof f&&e.element(f.target).closest(".zmcDrpDwnOpn").length>0?(e.element(f.target).closest(".SC_ddn").removeClass("SC_ddn"),e.element(f.target).closest(".sel").removeClass("sel")):e.removeClass(e.selector(".zmcDrpDwnOpn"),"zmcDrpDwnOpn"),j&&(d.blindRemoveElement(g),a.menuHandler&&a.menuHandler.apply(a,a.menuArgsArray))),j):(a.menuHandler&&a.menuHandler.apply(a,a.menuArgsArray),!0)},j=function(a,b,c){var d,e,f=a.length-1;for(e=f;e>=1;e--){if(d=a[e],!i(d,b,c))return!1;a.pop()}return!0};return c.hideMenu=function(a,b,c){var d,e=f.length,g=!0;if(e){if(d=f[0],e>1&&(g=!!j(f,a,b)&&!d.hideChildMenuFirst),!g||!i(d,a,b,c))return!1;f.pop()}return!0},c.isAnyMenuOpen=function(){return f.length>0},function(){$.subscribe("/mail/menuCreated",function(a,b){g(b)}),$.subscribe("/mail/activeMenu",function(a,b){h(b)}),$.subscribe("mailsuite/hashurl/updated",function(a){c.hideMenu()})}(),c}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=c.create("zmail.Utils.TextUtil"),e=function(a,b){a=a||"",b=b||{};var c,d=1e3,e=0,f=0,g=0;return b.breakPeriods===!0&&(a=a.replace(/\./g," ")),a=a.replace(/\s+/g," "),(a.split(" ")||[]).forEach(function(a){a=a||"",a.length>=7?g++:a.length>3?f++:e++}),c=Math.round(e/6)+Math.round(f/3)+Math.round(g/1),c=1e3*c+d};return d.calculateReadTime=e,d}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=a("zmail.Utils.EmailValidator"),e=c.create("zmail.Utils.EmailParser"),f=function(a,b){return"function"==typeof String.prototype.repeat?a.repeat(b):new Array((++b)).join(a)},g=function(a){var b;return b=a,b=b.replace(/\\"/gim,"__"),b=b.replace(/("[^"]*")/gim,function(a){return f("_",a.length)})},h=function(a){var b,c,d=/(?:([^;,]+)[;,]?)/gim,e=[];for(c=g(a),b=d.exec(c);null!==b;)e.push({index:b.index,length:b[1].length}),b=d.exec(c);return e},i=function(a){var b,c,d,e,f,h=/(?:([^ ]*)( +)([^@ ]+)(@)([^@ ]+))/gim,i=/(?:(.*)(<)([^@ ]+)(@)([^@ ]+)(>))/gim,j=0;return b=g(a),c=i.exec(b),null===c&&(c=h.exec(b)),c?(d=a.substr(j,c[1].length),d=d.trim(),j+=c[1].length+c[2].length,e=a.substr(j,c[3].length),e=e.trim(),j+=c[3].length+c[4].length,f=a.substr(j,c[5].length),f=f.trim(),'"'===d.charAt(0)&&'"'===d.charAt(d.length-1)&&(d=d.substr(1,d.length-2)),"<"===e.charAt(0)&&(e=e.substr(1)),">"===f.charAt(f.length-1)&&(f=f.substr(0,f.length-1)),{name:d,local:e,domain:f}):null},j=function(a){var b,c,e,f={},g=!1;return a=a.trim(),e=i(a),e?(g=!0,b=e.local+"@"+e.domain):b=a,c=d.validate(b),g?f.name=e.name:(f.name=a.substr(0,a.lastIndexOf("@")),f.name=f.name.replace(/[^a-z0-9\- _]*/gim,"")),f.email=b,f.valid=c.status,c.status||(f.errorCode=c.errorCode,f.errorMessage=c.errorMessage),f},k=function(a,b){var c=[],d=[];return b=b||{},a=a||"",c=h(a),c.forEach(function(b){var c=a.substr(b.index,b.length),e=j(c);d.push(e)}),d};return e.parse=k,e}),define([],function(a,b){var c=a("zmail.Utils.DOM"),d=a("zmail.Core.Namespaces"),e=a("zmail.Utils.DeferredCollection"),f=d.create("zmail.Utils.Image"),g=e.create({keepDeferreds:!1}),h=function(a,b,d){d=d||{};var e=c.element(zdom("img",null),!0),f=function(){e.onload=void 0,e.onerror=void 0,e=void 0,f=void 0};e.onload=b.resolve,e.onerror=b.reject,e.src=a,e.complete&&b.resolve(),b.always(f)},i=function(a,b){a=(a||"").trim(),b=b||{};var c=this._deferreds||g;if(!a)return $.Deferred().reject().promise();b.forceRequest===!0&&c.clear(a);var d=c.has(a),e=c.get(a);return d||h(a,e,b),e.promise()},j=function(a){a=a||{};var b={_deferreds:e.create({keepDeferreds:a.storeRequests===!0})};return b.load=i,b},k=function(a){a=a||{};var b=j(a);b.queue=[],b.maxRequests=a.maxRequests||6,b.currentRequests=0;var c,d;return d=function(){if(b.currentRequests-=1,b.queue.length>0)for(var a=b.maxRequests-b.currentRequests;a>0&&b.queue.length>0;){var d=b.queue.shift();c(d.imagePath,d.loadOpts).done(d.deferred.resolve).fail(d.deferred.reject),a--}},c=function(a,c){var e=null;if(b.currentRequests<b.maxRequests)e=i.apply(b,[a,c]).always(d),b.currentRequests+=1;else{var f=$.Deferred();b.queue.push({imagePath:a,loadOpts:c,deferred:f}),e=f.promise()}return e},b.load=c,b};return f.load=i,f.createLoader=j,f.createThrottledLoader=k,f}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=a("zmail.Utils.DOM"),e=c.create("zmail.Utils.Image"),f=e.load,g=function(a,b,c){c=c||{};var e,f=d.element(zdom("img",null)),g=d.element(zdom("canvas",null)),h=function(){try{g.css({height:f.outerHeight()+"px",width:f.outerWidth()+"px"}),e=g[0].getContext("2d"),e.drawImage(f[0],0,0),b.resolve(g[0].toDataURL())}catch(a){b.reject()}},i=function(){f.remove(),f=void 0,g.remove(),g=void 0,e=void 0,h=void 0,i=void 0},j={opacity:"0",position:"fixed",top:"0",left:"0",height:"auto",width:"auto",zIndex:"-100",overflow:"hidden"};f.css(j),g.css(j),d.mount(f,document.body),d.mount(g,document.body),f.on("load",function(){h()}),f.on("error",b.reject),f.attr({src:a}),f[0].complete&&h(),b.always(i)},h=function(a,b){b=b||{};var c=$.Deferred();return(a=a||"")?("string"!=typeof a&&(a=a.src),a=a.trim(),f(a).done(function(){g(a,c,b)}).fail(c.reject),c.promise()):c.reject().promise()};return e.getDataURL=h,e}),define([],function(a,b){var c=a("zmComponent"),d=a("zmText"),e=a("_zm"),f={},g=document,h=d.get("commonUtils").clipBoard;return f.setData=function(a,b){b=b||{};var c=g.createElement("textarea");"html"===b.type?c.appendChild(a):c.textContent=a,c.style.opacity="0",g.body.appendChild(c),c.style.opacity="",c.select(),g.execCommand("copy"),b.hasOwnProperty("onSuccess")&&"function"==typeof b.onSuccess?b.onSuccess():(b.hasOwnProperty("showSuccessMessage")||"undefined"==typeof b.showSuccessMessage)&&e.succErrMsg("s",h.success,{hide:""}),c.parentElement.removeChild(c)},f.isSupported=function(){return!!g.queryCommandSupported("copy")},Object.keys(c).length>0?c.clipBoardAPI=f:window.clipBoardAPI=f,c}),define([],function(a,b){var c=a("zmComponent"),d={},e=document;return d.download=function(a,b){var c,d,f,g,h,i,j=b||{};if(c=a,f=j.contentType,g=j.fileType,h=j.fileName,f=f?"data:application/'"+f+"';charset=utf-8,":"data:application/text;charset=utf-8,",g&&"exe"===g?g="txt":g&&""!==g||(g="txt"),i=e.createElement("a"),d=f+c,h=h?h+"."+g:"tempFile."+g,/chrome/.test(navigator.userAgent.toLowerCase())){var k=[new Blob([c],{type:g}),new Uint16Array([33])],l=new File(k,h,{lastModified:new Date(0),type:"overide/mimetype"}),m=new FileReader;return m.onload=function(a){e.body.appendChild(i),i.download=h,i.href=URL.createObjectURL(l),i.click(),i.parentNode.removeChild(i)},m.readAsText(l),!0}if(window.navigator.msSaveBlob){var n=new Blob([a],{type:"text/plain;charset=utf-8;"});window.navigator.msSaveOrOpenBlob(n,h)}else e.body.appendChild(i),i.download=h,i.href=d,i.click(),i.parentNode.removeChild(i)},d.isSupported=function(){var a=window.navigator.userAgent;if(a.indexOf("MSIE")>0||a.indexOf("rv:11")>0)return!!window.navigator.msSaveBlob;
var b=e.createElement("a");return"string"==typeof b.download},Object.keys(c).length>0?c.downloadAsFile=d:window.downloadAsFile=d,c}),function(a){var b,c,d,e,f,g,h=zmail.Utils.DOM,i=document,j=20,k=200,l={},m=function(a,b){"class"===b?this.mainContent=i.getElementsByClassName(a)[0]:"id"===b?this.mainContent=i.getElementById(a):this.mainContent=a,this.scrollContainer=i.createElement("div"),this.scroller=i.createElement("div")};m.prototype.scrollDecider=function(a){a.preventDefault();var b=this;e=b.scrollContainer.clientHeight;var c=b.scroller.offsetTop;b.scroller.style.position="relative";var d=function(d){var f=d.pageY-a.pageY,g=b.mainContent.scrollHeight,h=Math.min(e-b.scroller.clientHeight,Math.max(0,c+f));b.scroller.style.top=h+"px";var i=g*parseInt(b.scroller.style.top)/b.scrollContainer.clientHeight;b.mainContent.scrollTop=i};i.addEventListener("mousemove",d,!1),i.addEventListener("mouseup",function(){i.removeEventListener("mousemove",d,!1)},!1),a.preventDefault()},m.prototype.mousePadScroll=function(a){var b=this;a.wheelDelta>0||a.detail<0?b.scrollUp(null,a.deltaY,b):(a.wheelDelta<0||a.detail>0)&&(b.scrollContainer.getBoundingClientRect().bottom>b.scroller.getBoundingClientRect().bottom?b.scrollDown(null,a.deltaY,b):setTimeout(function(){b.windowResize(b)},1e3))},m.prototype.scrollUp=function(a,b){var f=this;e=f.scrollContainer.offsetHeight,"keyEvent"===a?f.mainContent.scrollTop-=k:void 0!==b?f.mainContent.scrollTop+=b:f.mainContent.scrollTop-=j,f.scroller.style.position="relative",f.scroller.getBoundingClientRect().top>f.scrollContainer.getBoundingClientRect().top?(f.scroller.style.top=f.mainContent.scrollTop*e/f.mainContent.scrollHeight+"px",c=f.scroller.getBoundingClientRect().top,c<d&&window.clearInterval(g)):window.clearInterval(g)},m.prototype.scrollDown=function(a,b,f){e=f.scrollContainer.offsetHeight,"keyEvent"===a?f.mainContent.scrollTop+=k:void 0!==b?f.mainContent.scrollTop+=b:f.mainContent.scrollTop+=j,f.scroller.style.position="relative",f.scroller.getBoundingClientRect().bottom<f.scrollContainer.getBoundingClientRect().bottom?(f.scroller.style.top=f.mainContent.scrollTop*e/f.mainContent.scrollHeight+"px",c=f.scroller.getBoundingClientRect().bottom,c>d&&(setTimeout(function(){f.windowResize(f)},1e3),window.clearInterval(g))):window.clearInterval(g)};var n=function(a,b){var c=null;return function(){c&&clearTimeout(c);var d=arguments;c=setTimeout(function(){b.apply(null,d)},a)}};m.prototype.monitor=function(a){var b=this,c=n(30,function(){f(b)}),d=new MutationObserver(function(a){a.forEach(function(a){c()})}),e={attributes:!0,childList:!0,subtree:!0},g=a;d.observe(g,e)},m.prototype.scrollListener=function(a){var b=this,e=function(a){return"zmScrolThumb"===a.target.className?void b.scrollDecider(a):(c=b.scroller.getBoundingClientRect().top,d=a.clientY,void(a.clientY>c?g=window.setInterval(b.scrollDown,50):a.clientY<c&&(g=window.setInterval(b.scrollUp,50))))},f=function(){window.clearInterval(g)};this.scrollContainer.addEventListener("mousedown",e,!1),this.scrollContainer.addEventListener("mouseup",f,!1),this.mainContent.addEventListener("mousewheel",b.mousePadScroll.bind(b),!1),this.mainContent.addEventListener("DOMMouseScroll",b.mousePadScroll.bind(b),!1),window.addEventListener("resize",b.windowResize.bind(a,b),!1)},m.prototype.windowResize=f=function(a){if(e=a.scrollContainer.offsetHeight,a.scrollContainer.style.height=a.mainContent.offsetHeight-3+"px",b=a.mainContent.offsetHeight*e/a.mainContent.scrollHeight,b>50&&(a.scroller.style.height=b+"px"),"zm_lftree"!==a.mainContent.id){var c=a.mainContent.getBoundingClientRect();a.scrollContainer.style.left=c.right-12+"px"}},m.prototype.create=function(){var a,c=this,d=c.mainContent,e=c.scroller,f=c.scrollContainer;f.className="zmScrollTrail shw",e.className="zmScrolThumb";var g=f.style;return a=d.getBoundingClientRect(),g.left=a.right-12+"px",g.height=d.offsetHeight+"px",g.top=a.top+"px",d.appendChild(f),d.style.overflow="hidden",g=e.style,b=d.offsetHeight*f.offsetHeight/d.scrollHeight,g.height=b+"px",f.appendChild(e),f.offsetHeight===b?(h.removeClass(c.scrollContainer,"shw"),!1):void(d.style.paddingRight="12px")},l.init=function(a,b){var c=new m(a,b);return c.create(),c.scrollListener(),c.monitor(c.mainContent),c},m.prototype.setZIndex=function(a){var b=this;b.scrollContainer.style.zIndex=a},m.prototype.resize=function(){var a=this;if(a.scrollContainer.style.height=a.mainContent.offsetHeight-3+"px",e=a.scrollContainer.offsetHeight,0===e&&(e=parseInt(a.scrollContainer.style.height)),b=a.mainContent.offsetHeight*e/a.mainContent.scrollHeight,b>50&&(a.scroller.style.height=b+"px"),e===b)return h.removeClass(a.scrollContainer,"shw"),!1;var c=a.mainContent.scrollHeight;h.addClass(a.scrollContainer,"shw"),a.scroller.style.top=a.mainContent.scrollTop*a.scrollContainer.offsetHeight/c+"px"},m.prototype.scrollView=function(){var a=this;e=a.scrollContainer.offsetHeight,a.scroller.style.position="relative",a.scroller.style.top=a.mainContent.scrollTop*e/a.mainContent.scrollHeight+"px"}}(window.zmComponent||{}),define([],function(a){var b=a("zmUtil"),c={zohoMail:"Zoho Mail"},d=function(a){var d=a.title||c.zohoMail,e=a.tag||"default",f=a.msg||"",g=a.imgUrl||zmResource.get("image","favicon.ico"),h=b.getWindowVisibilityStatus(),i=b.getDesktopNotificationPermission(),j="function"==typeof a.callback?a.callback:void 0;if(h=Boolean(h>-1&&!h),1===zmail.mailOpt.dtNotify&&i>-1&&0===i&&h){var k=window.Notification;if("Notification"in window){var l=new k(d,{icon:g,tag:e,body:f});"function"==typeof j&&(l.onclick=function(){window.focus(),j(a)}),setTimeout(l.close.bind(l),a.hideAfter||3e3)}}},e=window._zm;return e.pushDesktopNotification=d,e}),define([],function(){var a={OFFLINE:"offline",ONLINE:"online"},b={OFFLINE:"/network/offline",ONLINE:"/network/online"},c=function(a){"offline"===a.type&&(zmUtil.debugLog("Seems you have lost the internet connection"),$.publish(b.OFFLINE,"offline")),"online"===a.type&&(zmUtil.debugLog("You are back online"),$.publish(b.ONLINE,"online"))},d=function(){window.addEventListener(a.OFFLINE,c),window.addEventListener(a.ONLINE,c)};return d(),d});